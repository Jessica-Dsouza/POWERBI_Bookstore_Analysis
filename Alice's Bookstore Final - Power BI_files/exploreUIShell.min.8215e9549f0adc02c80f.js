"use strict";var powerbi,__awaiter=this&&this.__awaiter||function(e,l,a,s){return new(a=a||Promise)(function(i,t){function o(e){try{n(s.next(e))}catch(e){t(e)}}function r(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,r)}n((s=s.apply(e,l||[])).next())})},__generator=this&&this.__generator||function(o,r){var n,l,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(i){return function(e){var t=[i,e];if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,l&&(a=2&t[0]?l.return:t[0]?l.throw||((a=l.return)&&a.call(l),0):l.next)&&!(a=a.call(l,t[1])).done)return a;switch(l=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,l=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3]))s.label=t[1];else if(6===t[0]&&s.label<a[1])s.label=a[1],a=t;else{if(!(a&&s.label<a[2])){a[2]&&s.ops.pop(),s.trys.pop();continue}s.label=a[2],s.ops.push(t)}}t=r.call(o,s)}catch(e){t=[6,e],l=0}finally{n=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};!function(e){((e=e.explore||(e.explore={})).components||(e.components={})).invalidFieldWellBucketLocalizationId="Invalid_FieldWellBucket_Move"}(powerbi=powerbi||{}),function(t){var i=t.telemetry||(t.telemetry={}),e=jsCommon.Utility,o=t.telemetryEventFactory,r=t.telemetry.EventFactories;e?e.generateGuid:Function.prototype,i.EXChangeFieldWellEventName="PBI.EX.ChangeFieldWell",i.EXChangeFieldWell=r[i.EXChangeFieldWellEventName]=function(e){return o({name:i.EXChangeFieldWellEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXChangeFieldWellLoggers})},i.EXChangeAggregationEventName="PBI.EX.ChangeAggregation",i.EXChangeAggregation=r[i.EXChangeAggregationEventName]=function(e){return o({name:i.EXChangeAggregationEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXChangeAggregationLoggers})},i.EXRemoveConditionalFormattingEventName="PBI.EX.RemoveConditionalFormatting",i.EXRemoveConditionalFormatting=r[i.EXRemoveConditionalFormattingEventName]=function(e){return o({name:i.EXRemoveConditionalFormattingEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXRemoveConditionalFormattingLoggers})},i.EXRemoveDataBarsEventName="PBI.EX.RemoveDataBars",i.EXRemoveDataBars=r[i.EXRemoveDataBarsEventName]=function(e){return o({name:i.EXRemoveDataBarsEventName,baseEvent:i.Verbose(e),info:e,category:t.TelemetryCategory.Verbose,loggers:i.EXRemoveDataBarsLoggers})},i.EXAnalyticsPaneOpenEventName="PBI.EX.AnalyticsPane.Open",i.EXAnalyticsPaneOpen=r[i.EXAnalyticsPaneOpenEventName]=function(e){return o({name:i.EXAnalyticsPaneOpenEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXAnalyticsPaneOpenLoggers})},i.EXAnalyticsPaneAddInstanceEventName="PBI.EX.AnalyticsPane.AddInstance",i.EXAnalyticsPaneAddInstance=r[i.EXAnalyticsPaneAddInstanceEventName]=function(e){return o({name:i.EXAnalyticsPaneAddInstanceEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXAnalyticsPaneAddInstanceLoggers})},i.EXAnalyticsPaneRemoveInstanceEventName="PBI.EX.AnalyticsPane.RemoveInstance",i.EXAnalyticsPaneRemoveInstance=r[i.EXAnalyticsPaneRemoveInstanceEventName]=function(e){return o({name:i.EXAnalyticsPaneRemoveInstanceEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXAnalyticsPaneRemoveInstanceLoggers})},i.EXAnalyticsPaneForecastParameterUpdatedEventName="PBI.EX.AnalyticsPane.ForecastParameterUpdated",i.EXAnalyticsPaneForecastParameterUpdated=r[i.EXAnalyticsPaneForecastParameterUpdatedEventName]=function(e){return o({name:i.EXAnalyticsPaneForecastParameterUpdatedEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXAnalyticsPaneForecastParameterUpdatedLoggers})},i.EXPropertyPaneOnValueChangedEventName="PBI.EX.PropertyPane.OnValueChanged",i.EXPropertyPaneOnValueChanged=r[i.EXPropertyPaneOnValueChangedEventName]=function(e){return o({name:i.EXPropertyPaneOnValueChangedEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXPropertyPaneOnValueChangedLoggers})},i.EXDrillthroughPaneChangeLinkEventName="PBI.EX.DrillthroughPane.ChangeLink",i.EXDrillthroughPaneChangeLink=r[i.EXDrillthroughPaneChangeLinkEventName]=function(e){return o({name:i.EXDrillthroughPaneChangeLinkEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXDrillthroughPaneChangeLinkLoggers})},i.EXNavigateAndSelectVisualEventName="PBI.EX.NavigateAndSelectVisual",i.EXNavigateAndSelectVisual=r[i.EXNavigateAndSelectVisualEventName]=function(e){return o({name:i.EXNavigateAndSelectVisualEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXNavigateAndSelectVisualLoggers})},i.EXFieldWellAbnormalRenameEventName="PBI.EX.FieldWellAbnormalRename",i.EXFieldWellAbnormalRename=r[i.EXFieldWellAbnormalRenameEventName]=function(e){return o({name:i.EXFieldWellAbnormalRenameEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXFieldWellAbnormalRenameLoggers})},i.EXLaunchChangeDetectionDialogEventName="PBI.EX.LaunchChangeDetectionDialog",i.EXLaunchChangeDetectionDialog=r[i.EXLaunchChangeDetectionDialogEventName]=function(e){return o({name:i.EXLaunchChangeDetectionDialogEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXLaunchChangeDetectionDialogLoggers})},i.EXAddVisualToCanvasEventName="PBI.EX.AddVisualToCanvas",i.EXAddVisualToCanvas=r[i.EXAddVisualToCanvasEventName]=function(e){return o({name:i.EXAddVisualToCanvasEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,optionalParameters:["isCustom","isFavorite","isOutOfBox","isManaged"],loggers:i.EXAddVisualToCanvasLoggers})},i.EXAboutVisualDialogEventName="PBI.EX.AboutVisualDialog",i.EXAboutVisualDialog=r[i.EXAboutVisualDialogEventName]=function(e){return o({name:i.EXAboutVisualDialogEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXAboutVisualDialogLoggers})},i.EXPersonalizeVisualChangePerspectiveEventName="PBI.EX.PersonalizeVisual.ChangePerspective",i.EXPersonalizeVisualChangePerspective=r[i.EXPersonalizeVisualChangePerspectiveEventName]=function(e){return o({name:i.EXPersonalizeVisualChangePerspectiveEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXPersonalizeVisualChangePerspectiveLoggers})},i.EXPersonalizeVisualLoadFieldListEventName="PBI.EX.PersonalizeVisual.LoadFieldList",i.EXPersonalizeVisualLoadFieldList=r[i.EXPersonalizeVisualLoadFieldListEventName]=function(e){return o({name:i.EXPersonalizeVisualLoadFieldListEventName,baseEvent:i.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:i.EXPersonalizeVisualLoadFieldListLoggers})}}(powerbi=powerbi||{}),function(t){var i,e;function o(e,t){this.services=t,this.exploreUIShellConfig=i.modules.ExploreUIShellModule}i=t.explore||(t.explore={}),e=i.components||(i.components={}),o.createOptions=function(){return{additionalServices:["telemetryService","featureSwitchService"],scopedDependencies:["viewModeState","gettingStarted","explorationCapabilities","panesVisibility"]}},o.prototype.$onInit=function(){this.paneTitleKey=this.services.featureSwitchService.featureSwitches.onObject?this.viewModel.title:"TaskPane_Fields"},o.prototype.$onChanges=function(){var i=this;this.visibilitySubscription||(this.visibilitySubscription=this.services.gettingStarted.fieldsPaneVisibility$.subscribe(function(e){var t=i.services.explorationCapabilities.getCapabilities();i.viewModel.isPaneExpanded===e||t.forceCollapseTaskPane||i.services.panesVisibility.togglePaneExpansion(2)}))},o.prototype.$onDestroy=function(){this.visibilitySubscription.unsubscribe()},o.prototype.toggleTaskPane=function(){var e=this.services.panesVisibility.togglePaneExpansion(2);this.services.telemetryService.logEvent(t.telemetry.EXTogglePaneExpanded,{paneType:"Task",expanded:e,viewMode:i.util.getTelemetryViewMode(this.services.viewModeState.getMode())})},Object.defineProperty(o.prototype,"fieldListModulePath",{get:function(){return"./lazy-modules/field-list/field-list.module#FieldListModule"},enumerable:!1,configurable:!0}),o.prototype.close=function(){this.services.panesVisibility.closePane(2)},e.TaskPaneController=o}(powerbi=powerbi||{}),function(e){var t;(t=(t=e.explore||(e.explore={})).components||(t.components={})).TaskPane={bindings:{viewModel:"<"},controller:e.common.createController(t.TaskPaneController),templateUrl:"components/taskPane/taskPane.html"}}(powerbi=powerbi||{}),define("ExploreUIShell/components/fieldWell/fieldWell",["require","exports","ExploreUIShell/components/fieldWell/fieldWellController"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldWell=void 0;var o=powerbi.common.createController;t.FieldWell={templateUrl:"components/fieldWell/fieldWell.html",bindings:{},controller:o(i.FieldWellController)}}),function(t){var e,i,o;function r(e,t,i,o,r,n,l,a,s,c,d,u,p){this.expr=e,this.role=t,this.startIndex=i,this.endIndex=o,this.valid=r,this.displayOptions=n,this.interactivityOptions=l,this.hierarchyLevels=a,this.conditionalFormattingRepetitions=s,this.supportedOperations=67108863,this.visualContainerName=c,this.visualType=d,this.isHiddenInVisual=u,this.supportedOperations=p}function n(e,t,i,o){this.displayName=e,this.tooltipTitle=t,this.tooltipDescription=i,this.glyph=o}function l(e,t,i){this.dropDownItems=e,this.isReplaceable=t,this.isEditableField=i,this.canAppend=!0,this.canPrepend=!0,this.hasContextMenu=!0,this.isDraggableField=!0,this.isDroppableField=!0,this.isRemovableField=!0}function a(e,t,i){this.expr=e,this.displayName=t,this.tooltipTitle=i}function s(e,t,i,o,r){this.role=e,this.displayName=t,this.properties=i,this.supportsMultipleItems=o,this.description=r}function c(e,t,i){this.glyph=e,this.title=t,this.description=i}e=(e=t.explore||(t.explore={})).viewModels||(e.viewModels={}),i=jsCommon.ArrayExtensions,o=t.data.SQExpr,r.prototype.equals=function(e){return this.role===e.role&&o.equals(this.expr,e.expr)&&this.startIndex===e.startIndex&&this.endIndex===e.endIndex&&this.isEditingLabel===e.isEditingLabel&&this.valid===e.valid&&(this.displayOptions===e.displayOptions||!!(this.displayOptions&&e.displayOptions&&this.displayOptions.equals&&this.displayOptions.equals(e.displayOptions)))&&(this.interactivityOptions===e.interactivityOptions||!!(this.interactivityOptions&&e.interactivityOptions&&this.interactivityOptions.equals&&this.interactivityOptions.equals(e.interactivityOptions)))&&i.sequenceEqual(this.conditionalFormattingRepetitions,e.conditionalFormattingRepetitions,t.VisualObjectRepetition.metadataEquals)&&i.comparableSequenceEqual(this.hierarchyLevels,e.hierarchyLevels)&&this.visualContainerName===e.visualContainerName&&this.visualType===e.visualType&&this.isHiddenInVisual===e.isHiddenInVisual&&this.supportedOperations===e.supportedOperations},e.FieldWellProperty=r,n.prototype.equals=function(e){return this.displayName===e.displayName&&this.tooltipTitle===e.tooltipTitle&&this.tooltipDescription===e.tooltipDescription&&this.glyph===e.glyph},e.FieldWellPropertyDisplayOptions=n,l.prototype.disableInteractivity=function(){this.canAppend=!1,this.canPrepend=!1,this.hasContextMenu=!1,this.isDraggableField=!1,this.isDroppableField=!1,this.isEditableField=!1,this.isRemovableField=!1},l.prototype.equals=function(e){return this.canAppend===e.canAppend&&this.canPrepend===e.canPrepend&&_.isEqual(this.dropDownItems,e.dropDownItems)&&this.hasContextMenu===e.hasContextMenu&&this.isDraggableField===e.isDraggableField&&this.isDroppableField===e.isDroppableField&&this.isEditableField===e.isEditableField&&this.isRemovableField===e.isRemovableField&&this.isReplaceable===e.isReplaceable},e.FieldWellPropertyInteractivityOptions=l,a.prototype.equals=function(e){return o.equals(this.expr,e.expr)&&this.displayName===e.displayName&&this.tooltipTitle===e.tooltipTitle},e.FieldWellHierarchyLevel=a,s.prototype.equals=function(e){return this.role===e.role&&this.displayName===e.displayName&&i.comparableSequenceEqual(this.properties,e.properties)&&this.supportsMultipleItems===e.supportsMultipleItems&&this.description===e.description&&(this.warning===e.warning||!!(this.warning&&e.warning&&this.warning.equals&&this.warning.equals(e.warning)))},e.FieldWellBucket=s,c.prototype.equals=function(e){return this.glyph===e.glyph&&this.title===e.title&&this.description===e.description},e.FieldWellBucketWarning=c,e.FieldWellViewModel=function(e){this.buckets=e}}(powerbi=powerbi||{}),define("ExploreUIShell/components/fieldWell/fieldWellController",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldWellCore=t.FieldWellController=void 0;var i=powerbi,d=i.data,i=i.explore,o=i.services,r=i.viewModels,n=i.util,l=jsCommon.ArrayExtensions,a=o.events,u=powerbi.explore.util.FieldWellUtility,s=powerbi.explore.services.isRoleAllowedForSmallMultiples,c=i.services.selectionUtils,p=n.VisualContainerUtils,h=powerbi.explore.contracts.VisualTooltip,g={};function v(e,t){this.core=new m(t,!1)}v.createOptions=function(){return{additionalServices:["$element","aggrOps","conceptualSchemaProxy","featureSwitchService","lazyProviderModern","geoTaggingAnalyzerService","localizationService","promiseFactory"],scopedDependencies:["dataSources","explorationDisplayNameService","explorationNavigation","eventBridge","groupingDesignStateService","selection","showValueAsService","visualPlugin","runningVisuals","visibility"]}},v.prototype.$onInit=function(){this.core.$onInit()},v.prototype.$onDestroy=function(){this.core.$onDestroy()},t.FieldWellController=v;y.prototype.$onInit=function(){return __awaiter(this,void 0,powerbi.Promise,function(){var i=this;return __generator(this,function(e){switch(e.label){case 0:return this.viewModel=new r.FieldWellViewModel([]),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(a.modelChanged,function(){return i.requestModelAndUpdate(!0)}).subscribe(a.selectionChanged,function(){return i.requestModelAndUpdate()}).subscribe(a.visualTypeChanged,function(){return i.requestModelAndUpdate()}).subscribe(a.visualContainerChanged,function(){return i.requestModelAndUpdate(!0)}).subscribe(a.fieldWellFieldRemovedEvent,function(e,t){return i.onFieldWellFieldRemoved(t)}).subscribe(a.visualContainerDataRendered,function(){return i.requestModelAndUpdate(!0)}).subscribe(a.explorationContainerReady,function(){return i.requestModelAndUpdate()}),this.queryNameSubscription=this.services.visualCalcEagerService.getQueryName$().subscribe(function(){return i.requestModelAndUpdate()}),[4,this.requestModelAndUpdate()];case 1:return[2,e.sent()]}})})},y.prototype.$onDestroy=function(){this.subscriptionManager&&this.subscriptionManager.unsubscribeAll(),this.queryNameSubscription.unsubscribe()},y.prototype.onFieldWellFieldRemoved=function(t){jsCommon.FocusManager.focus(_.find(this.services.$element.find(".field-well-bucket-element .bucket .bucket-header .caption"),function(e){return $(e).html()===t}),!1)},y.prototype.requestModelAndUpdate=function(o){return __awaiter(this,void 0,powerbi.Promise,function(){var t,i=this;return __generator(this,function(e){return(t=this.services.dataSources.get())?[2,this.services.conceptualSchemaProxy.get(t).then(function(e){return i.update(e,o)})]:[2]})})},y.prototype.update=function(a,s){var c;return __awaiter(this,void 0,powerbi.Promise,function(){var t,i,o,r,n,l=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.services.lazyScopedProvider.get("fieldWellViewModelService")];case 1:if(t=e.sent(),i=this.getSelectedVisual(),this.deferredCreateBuckets&&(this.deferredCreateBuckets.reject(g),this.deferredCreateBuckets=void 0),a){if(i)return o=[new f(this.services.explorationNavigation,this.services.localizationService)],r=16===(null==(c=this.services.visibility.get())?void 0:c.visibility),this.services.featureSwitchService.featureSwitches.cartesianMultiplesAuthoring||o.push(new b(this.services.visualPlugin,i)),n=this.services.runningVisuals.getVisual(i),this.deferredCreateBuckets=t.createBuckets(n,i,a,this.services.groupingDesignStateService,this.services.showValueAsService,this.services.visualPlugin,this.services.explorationDisplayNameService,o,this.disableHierarchyLevelGrouping,r),[2,this.deferredCreateBuckets.promise.then(function(e){l.updateViewModel(e,s)},function(e){if(e!==g)throw e}).finally(function(){l.deferredCreateBuckets=void 0})];n=p.getDataRolesForVisualPlugin(u.getDefaultVisualPlugin(this.services.featureSwitchService)),o=t.createEmptyBuckets(n,[])}else o=null;return this.updateViewModel(o,s),[2]}})})},y.prototype.updateViewModel=function(e,t){t&&l.comparableSequenceEqual(e,this.viewModel.buckets)||(this.viewModel.buckets=e,this.onViewModelChange&&this.onViewModelChange(this.viewModel))},y.prototype.getSelectedVisual=function(){return c.getSelectedVisual(this.services.selection)};var m=y;function y(e,t,i){this.services=e,this.disableHierarchyLevelGrouping=t,this.onViewModelChange=i}t.FieldWellCore=m;w.prototype.onBucketCreated=function(t,e,i,o,r,n,l){var e=e.config.singleVisual,n=n.capabilities(e.visualType),a=!n||!n.tooltips||void 0===n.tooltips.showByDefault||n.tooltips.showByDefault,s=d.DataViewObjectDefinitions.getValue(e.vcObjects,{objectName:"visualTooltip",propertyName:"show"},void 0);if((s||a)&&(!s||s.value)){a=d.DataViewObjectDefinitions.getValue(e.vcObjects,{objectName:"visualTooltip",propertyName:"type"},void 0),s=d.DataViewObjectDefinitions.getValue(e.vcObjects,{objectName:"visualTooltip",propertyName:"section"},void 0),e=a&&a.value,a=!e||e===h.Canvas,e=s&&s.value,e=!e||e===h.SectionAuto;if(a&&!e){a=n.tooltips&&n.tooltips.roles;if(_.some(a,function(e){return e===t.role})){var c=s&&s.value,e=void 0;if(c===h.SectionAuto)e=l.get("ReportPage");else{n=this.explorationNavigation.getAllSections(),a=_.find(n,function(e){return e.name===c&&1===e.type});if(!a)return;e=a.displayName}s=new powerbi.explore.viewModels.FieldWellPropertyDisplayOptions(e,null,null,"pbi-glyph-canvas-tooltip"),l=new powerbi.explore.viewModels.FieldWellPropertyInteractivityOptions(null,!1,!1),n=(l.disableInteractivity(),new powerbi.explore.viewModels.FieldWellProperty(void 0,t.role,-1,-1,!0,s,l,void 0,void 0,void 0,void 0));t.properties.push(n),t.warning=new powerbi.explore.viewModels.FieldWellBucketWarning("pbi-glyph-info",void 0,this.localizationService.get("FieldWellBucket_Warning_CanvasTooltipDescription"))}}}},w.prototype.shouldCreateBucketForRole=function(e){return!0};var f=w;function w(e,t){this.explorationNavigation=e,this.localizationService=t}S.prototype.onBucketCreated=function(e,t,i,o,r,n,l){},S.prototype.shouldCreateBucketForRole=function(e){var t=this.visualPluginService.capabilities(this.visual.config.singleVisual.visualType);return s(e,this.visual.config.singleVisual,t)};var b=S;function S(e,t){this.visualPluginService=e,this.visual=t}}),define("ExploreUIShell/components/fieldWellField/fieldWellFieldController",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldWellFieldController=t.FieldWellFieldCore=void 0;var i=powerbi.explore,s=i.viewModels,n=powerbi.data,o=powerbi.explore.util,r=powerbi.explore.services.events.fieldWellFieldRemovedEvent,l=powerbi.explore.components.invalidFieldWellBucketLocalizationId,a=i.services.selectionUtils,c=powerbi.telemetry,d=jsCommon.ArrayExtensions,y=powerbi.data.services.DataViewObjectSerializer,u=jsCommon.DropPosition,p=jsCommon.FocusManager,h=powerbi.Promise,g=n.SQExpr,v=powerbi.data.SQExprConverter,m=powerbi.data.SQHierarchyExprUtils,f=powerbi.data.SQPropertyVariationSourceExpr,w=i.ScopeUtils,b=powerbi.data.services.SemanticQuerySerializer,S=o.VisualContainerUtils,C=(E.prototype.onDestroy=function(){this.dataBarsDialogRef&&this.dataBarsDialogRef.close()},E.prototype.getDropAction=function(e){var t=this.services.promiseFactory.defer(),i=this.services.dragDataService.getDragContext(),o=this.viewModel.interactivityOptions,r=o.canAppend?3:2;if(i&&o.isDroppableField&&(o.canAppend||o.canPrepend)){var n=i.sourceRole;if(n){var l=i.hierarchyLevelCount||1,i=i.sourceIndex,a=!o.canPrepend||u.isBelow(e);if(this.getTargetIndex(n,i,l,{role:this.viewModel.role,startIndex:this.viewModel.startIndex,hierarchyLevelsLength:this.viewModel.hierarchyLevels?this.viewModel.hierarchyLevels.length:0},a)<0)return t.resolve(0),t.promise}o.isReplaceable&&o.isReplaceOnly?r=1:u.isAbove(e)&&o.canPrepend&&(r=2)}else r=0;return t.resolve(r),t.promise},E.prototype.getFieldDropAction=function(e){var t=this.viewModel.interactivityOptions;return t.isDroppableField&&(t.canAppend||t.canPrepend)?t.isReplaceable&&t.isReplaceOnly?1:u.isAbove(e)&&t.canPrepend?2:u.isBelow(e)&&t.canAppend?3:0:0},E.prototype.drop=function(e,t,i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this.services.dragDataService.getDragContext(),[2,this.dropWithPayloadAndAction(t,i)]})})},E.prototype.dropWithPayloadAndAction=function(s,c){var d;return __awaiter(this,void 0,void 0,function(){var t,i,o,r,n,l,a;return __generator(this,function(e){return n=s,t=this.viewModel,i=this.services.dataSources.get(),o=16===(null==(d=this.services.visibilityService.get(16))?void 0:d.visibility),(a=n.sourceRole)?(r=n.hierarchyLevelCount||1,n=n.sourceIndex,[2,!((l=this.getTargetIndex(a,n,r,{role:this.viewModel.role,startIndex:this.viewModel.startIndex,hierarchyLevelsLength:this.viewModel.hierarchyLevels?this.viewModel.hierarchyLevels.length:0},3===c))<0)&&this.services.visualAuthoring.moveField(a,t.role,n,l,r,i,o)]):(a=s).field?[2,this.dropField(a.field,c)]:[2,!1]})})},E.prototype.dropField=function(r,n){var l;return __awaiter(this,void 0,void 0,function(){var t,i,o;return __generator(this,function(e){switch(e.label){case 0:return t=this.services.dataSources.get(),i=_.size(this.viewModel.hierarchyLevels),(o=16===(null==(l=this.services.visibilityService.get(16))?void 0:l.visibility))||!this.viewModel.interactivityOptions.isReplaceable||!this.viewModel.interactivityOptions.isReplaceOnly&&1!==n?[3,2]:[4,this.checkToRestoreOrMergeLevelToHierarchy(r,t)];case 1:return e.sent()?[2,!0]:[2,this.services.visualAuthoring.replaceField(r,this.viewModel.role,this.viewModel.startIndex,this.getSelectedVisual(),t,0<i?i:void 0)];case 2:return[2,this.services.visualAuthoring.addFieldInRole(r,this.viewModel.role,t,this.getSelectedVisual(),3===n?this.viewModel.startIndex+Math.max(i,1):this.viewModel.startIndex,void 0,void 0,o)]}})})},E.prototype.restoreHierarchy=function(){var e=this.getAuthoringContext();return e?this.services.visualAuthoring.expandHierarchy(e.dataSources,e.visual,this.viewModel.role,this.viewModel.startIndex,this.viewModel.hierarchyLevels.length):h.resolve(!1)},E.prototype.checkToRestoreOrMergeLevelToHierarchy=function(d,u){var p;return __awaiter(this,void 0,void 0,function(){var t,i,o,r,n,l,a,s,c=this;return __generator(this,function(e){switch(e.label){case 0:return(t=this.viewModel.hierarchyLevels,r=_.size(t),0<r)?(i=null==(p=_.first(t))?void 0:p.expr,[4,this.services.conceptualSchemaProxy.get(u)]):[2,!1];case 1:return(o=e.sent(),g.isColumn(d)&&m.isHierarchyOrVariation(o,d)&&g.equals(m.getSourceVariationExpr(i),d))?(n=m.expandExpr(o,d),_.size(n)===_.size(t)?[2,!0]:[4,this.restoreHierarchy()]):[3,3];case 2:if(e.sent())return[2,!0];e.label=3;case 3:return g.isHierarchy(d)?(d.arg instanceof f?(r=m.getHierarchySourceAsVariationSource(i),g.equals(r,d.arg)):(l=m.getSourceHierarchy(i),g.equals(l,d)))?(n=m.expandExpr(o,d),_.size(n)===_.size(t)?[2,!0]:[4,this.restoreHierarchy()]):[3,5]:[3,5];case 4:if(e.sent())return[2,!0];e.label=5;case 5:return g.isHierarchyLevel(d)?(n=m.expandExpr(o,this.viewModel.expr),_.isArray(n)&&_.find(n,function(e){return g.equals(e,d)})?_.find(this.viewModel.hierarchyLevels,function(e){return g.equals(e.expr,d)})?[2,!0]:(l=_.findIndex(n,function(e){return g.equals(e,d)}),a=-1,_.findLast(n.slice(0,l),function(t){var e=_.findIndex(c.viewModel.hierarchyLevels,function(e){return g.equals(e.expr,t)});if(-1!==e)return a=e,!0}),s=-1!==a?a+1:0,[4,this.services.visualAuthoring.addFieldInRole(d,this.viewModel.role,u,this.getSelectedVisual(),this.viewModel.startIndex+s)]):[3,7]):[3,7];case 6:if(e.sent())return[2,!0];e.label=7;case 7:return[2,!1]}})})},E.prototype.moveToBucket=function(i){return __awaiter(this,void 0,h,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this.viewModel.hierarchyLevels.length||1,[4,this.services.visualAuthoring.moveField(this.viewModel.role,i.role,this.viewModel.startIndex,i.targetIndex,t,this.services.dataSources.get(),!1)];case 1:return e.sent()||(t=this.services.localizationService.format(l,[this.viewModel.displayOptions.displayName,i.displayName]),this.services.screenReaderService.alert(t),this.onContextMenuActionFailed&&this.onContextMenuActionFailed()),[2]}})})},E.prototype.moveField=function(e,t){var i=this.viewModel.hierarchyLevels.length||1,t=this.getTargetIndex(this.viewModel.role,this.viewModel.startIndex,i,e,t);0<=t&&this.services.visualAuthoring.moveField(this.viewModel.role,e.role,this.viewModel.startIndex,t,i,this.services.dataSources.get(),!1)},E.prototype.getTargetIndex=function(e,t,i,o,r){var n=o.startIndex;if(r&&(n+=o.hierarchyLevelsLength||1),e===o.role){if(n===t||n===t+i)return-1;t<n&&(n=Math.max(n-i,0))}return n},E.prototype.deleteField=function(i){return __awaiter(this,void 0,h,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())];case 1:return t=e.sent(),this.services.visualAuthoring.removeFieldFromRole({role:this.viewModel.role,projOptions:{fieldIndex:this.viewModel.startIndex+(i||0)},count:!_.isNumber(i)&&this.viewModel.hierarchyLevels.length||1},t),this.logDeleteTelemetry(),[2]}})})},E.prototype.deleteFieldAndFocus=function(i,o){return __awaiter(this,void 0,h,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return i&&i.stopPropagation(),[4,this.deleteField(o)];case 1:return e.sent(),jsCommon.Zone.setTimeout(function(){t.services.eventBridge.publishToChannel(r,t.bucketDisplayName)}),[2]}})})},E.prototype.switchQueryParameter=function(){return __awaiter(this,void 0,h,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())];case 1:return t=e.sent(),this.services.visualAuthoring.switchQueryParameter(t,this.viewModel.startIndex,this.viewModel.role),[2]}})})},E.prototype.logDeleteTelemetry=function(){var e=w.getSchemaPromise(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy),t=o.VisualContainerUtils.getVisualType(this.getSelectedVisual());this.services.groupAuthoring.telemetry.logGroupsUsageTelemetry(e,this.viewModel.expr,t,null,this.viewModel.role,"Delete")},E.prototype.getDragContext=function(){return{sourceIndex:this.viewModel.startIndex,sourceRole:this.viewModel.role,hierarchyLevelCount:this.viewModel.hierarchyLevels.length}},E.prototype.setAggregate=function(e,t){var i,o,r=this.getAuthoringContext();if(r)return i=n.FieldExprPattern.getAggregate(e.expr),o=this.services.visualAuthoring.setAggregate(this.viewModel.role,this.viewModel.startIndex,t,r.visual,r.dataSources),s.FieldWellViewModelOperations.updateSelectedMenuItems(e,r.visual),this.services.telemetryService.logEvent(c.EXChangeAggregation,{original:n.aggregateFunctionName(i),target:n.aggregateFunctionName(t),visualName:r.visual.name}),o},E.prototype.setVariation=function(e,t){var i=this.getAuthoringContext();i&&this.services.visualAuthoring.setVariation(i.dataSources,i.visual,t,this.viewModel.role,this.viewModel.startIndex,this.viewModel.hierarchyLevels.length)},E.prototype.removeAggregate=function(e){var t=this.getAuthoringContext();t&&(this.services.visualAuthoring.removeAggregate(this.viewModel.role,this.viewModel.startIndex,t.visual,t.dataSources),s.FieldWellViewModelOperations.updateSelectedMenuItems(e,t.visual))},E.prototype.toggleShowAll=function(e){var t=this.getAuthoringContext();t&&(this.services.visualAuthoring.toggleShowAll(e.role,t.visual),s.FieldWellViewModelOperations.updateSelectedMenuItems(e,t.visual))},E.prototype.selectFieldMenuItem=function(e){switch(e.action){case 32768:this.editLabel();break;case 1:this.deleteFieldAndFocus();break;case 4:this.setAggregate(this.viewModel,e.aggregate);break;case 2:this.removeAggregate(this.viewModel);break;case 8:this.toggleShowAll(this.viewModel);break;case 128:this.setVariation(this.viewModel,e.variationExpr);break;case 32:this.setShowValueAs(this.viewModel,e.showValueAs);break;case 64:this.showQuickCalcDialog();break;case 256:this.showGroupsDialog(this.viewModel,!0);break;case 512:this.showGroupsDialog(this.viewModel,!1);break;case 1024:this.showEditClusteringDialogAsync(this.viewModel);break;case 2048:this.restoreHierarchy();break;case 4096:this.setConditionalFormatting(e.conditionalFormattingOptions);break;case 16384:this.removeConditionalFormatting(e.conditionalFormattingOptions);break;case 8192:this.removeConditionalFormattingAll();break;case 65536:this.moveField(e.moveFieldPropertyOptions,!1);break;case 131072:this.moveField(e.moveFieldPropertyOptions,!0);break;case 262144:this.moveToBucket(e.moveFieldBucketOptions);break;case 2097152:this.showSparklinesDialog(!1);break;case 33554432:this.editVisualCalculation();break;case 4194304:this.showSparklinesDialog(!0);break;case 16777216:case 8388608:this.switchQueryParameter()}},E.prototype.onKeyDown=function(e){e.stopPropagation(),13===e.keyCode&&this.editLabel()},E.prototype.editLabel=function(){var e=this.viewModel;e.interactivityOptions.isEditableField&&(e.isEditingLabel=!0,this.onLabelInEditingModeChanged)&&this.onLabelInEditingModeChanged(!0)},E.prototype.editVisualCalculation=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(e){return t=this.getSelectedVisual(),i=S.getQueryName(t,this.viewModel.role,this.viewModel.startIndex),[2,this.services.visualCalcEagerService.enterVisualCalcMode(t,i)]})})},E.prototype.rename=function(e){var t,i,o,r,n=this.viewModel.displayOptions;e!==n.displayName&&(i=(t=this.getSelectedVisual()).config.singleVisual.query,o=t&&t.name,r=t&&t.config.singleVisual.visualType,t&&i&&i.projections&&i.projections[this.viewModel.role]&&this.viewModel.visualContainerName===o?(n.displayName=e,this.services.visualAuthoring.setDisplayNameAlias(t,{fieldIndex:this.viewModel.startIndex},this.viewModel.role,e)):this.services.telemetryService.logEvent(c.EXFieldWellAbnormalRename,{originalVisualContainerName:this.viewModel.visualContainerName,originalVisualType:this.viewModel.visualType,currentVisualContainerName:o,currentVisualType:r}))},E.prototype.cancelRename=function(){this.viewModel.isEditingLabel=!1,this.onLabelInEditingModeChanged&&this.onLabelInEditingModeChanged(!1)},E.prototype.toggleFieldHidden=function(){var e=this.viewModel.role,t=this.viewModel.startIndex,i=this.getSelectedVisual();return this.services.visualAuthoring.toggleFieldHidden(e,t,i)},E.prototype.setShowValueAs=function(o,r){var n,l=this,a=this.getAuthoringContext();a&&(n=this.services.dataSources.get(),this.services.conceptualSchemaProxy.get(n).then(function(e){var t={dataSources:n,roleIndex:l.viewModel.startIndex,visual:a.visual,visualDataRole:l.getVisualDataRole()},i=o.interactivityOptions.dropDownItems.items,i=_.find(i,function(e){return e.key&&16===e.key.action}),i=_.find(i.children,function(e){return e.checked});l.services.showValueAsService.applyShowValueAs(t,i.key.showValueAs,r),s.FieldWellViewModelOperations.updateSelectedMenuItems(o,a.visual)}))},E.prototype.showQuickCalcDialog=function(){return __awaiter(this,void 0,powerbi.Promise,function(){var t,i,o,r;return __generator(this,function(e){switch(e.label){case 0:return(t=this.getAuthoringContext())?(i=this.viewModel.role,o=this.viewModel.startIndex,r=t.visual.config.singleVisual.query.tryGetExpr(i,o),[4,this.services.lazyScoped("quickMeasures")]):[2];case 1:return e.sent().launchQuickMeasures(r,"FieldWell",void 0,{visualContainer:t.visual,index:o,role:i}),[2]}})})},E.prototype.showSparklinesDialog=function(s){return __awaiter(this,void 0,powerbi.Promise,function(){var t,i,o,r,n,l,a;return __generator(this,function(e){switch(e.label){case 0:return(t=this.getAuthoringContext())?(i=this.viewModel.role,o=this.viewModel.startIndex,r=t.visual.config.singleVisual.query.tryGetExpr(i,o),s?[3,2]:[4,this.services.sparklinesService.showCreateDialog(r)]):[2];case 1:return(n=e.sent())&&(l=b.deserializeExpr(n.measure),a=b.deserializeExpr(n.grouping),this.services.sparklinesService.addSparklinesToVisual(l,a,t.visual)),[3,4];case 2:return[4,this.services.sparklinesService.showEditDialog(r)];case 3:(n=e.sent())&&(l=b.deserializeExpr(n.measure),a=b.deserializeExpr(n.grouping),this.services.sparklinesService.updateSparklinesExpr(l,a,t.visual,i,o)),e.label=4;case 4:return[2]}})})},E.prototype.showGroupsDialog=function(l,a){return __awaiter(this,void 0,powerbi.Promise,function(){var t,i,o,r,n=this;return __generator(this,function(e){switch(e.label){case 0:return t=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(t)];case 1:t=e.sent(),i=l.expr.getTargetEntity(),o=l.expr.getConceptualProperty(t),o={schema:i.schema,entity:i.entity,name:a?null:o.name,sourcePropertyName:a?o.name:null,isNew:a},r=this.services.modelChangeHandler.register(function(e){return n.handleNewGroupsBins(i,l,e),n.services.promiseFactory.resolve()}),e.label=2;case 2:return e.trys.push([2,,4,5]),[4,this.services.groupAuthoring.openGroupDialog(o)];case 3:return e.sent(),[3,5];case 4:return r.stopHandling(),[7];case 5:return[2]}})})},E.prototype.showEditClusteringDialogAsync=function(t){return __awaiter(this,void 0,h,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.services.lazyScoped("clustering")];case 1:return[4,e.sent().editClustering(v.asFieldPattern(t.expr),this.services.dataSources.get())];case 2:return e.sent(),[2]}})})},E.prototype.handleNewGroupsBins=function(e,t,i){var o,r=_.find(i.changes,function(e){return e.newBins}),r=(r&&(o=n.SQExprBuilder.columnRef(e,r.newBins.name)),_.find(i.changes,function(e){return e.newGroups}));r&&(i=n.services.SemanticGroupingSerializer.deserialize(r.newGroups.definition).groupedColumns[0],o=n.SQExprBuilder.groupRef(r.newGroups.name,e,[i])),o&&(r=this.services.dataSources.get(),this.services.visualAuthoring.replaceField(o,t.role,t.startIndex,this.getSelectedVisual(),r))},E.prototype.setConditionalFormatting=function(m){return __awaiter(this,void 0,h,function(){var t,i,o,r,n,l,a,s,c,d,u,p,h,g,v;return __generator(this,function(e){switch(e.label){case 0:return t=this.getSelectedVisual(),i=this.services,s=i.dataSources.get(),o=this.viewModel,r=this.services.featureSwitchService.featureSwitches&&this.services.featureSwitchService.featureSwitches.conditionalTablixWebURL,[4,i.conceptualSchemaProxy.get(s)];case 1:return(n=e.sent(),l=m.repetition,a=l.propertyDescriptor&&l.propertyDescriptor.type,s=l.propertyDescriptor&&l.propertyDescriptor.type.misc,c=this.viewModel.displayOptions.displayName,a&&(a.fill||a.icon||r&&s&&s.webUrl))?[4,this.services.lazyScoped("conditionalFormattingDialogLauncherService")]:[3,4];case 2:return[4,e.sent().show(t,c,o.expr,l,m.propertyDefinition)];case 3:return(p=e.sent())&&(d=y.deserializeObjectProperty(p.propertyDefinition,l.propertyDescriptor,!1),p=y.deserializeSelector(p.selector),this.services.visualAuthoring.setPropertyDefinition(t,l.propertyId,l.selector,d,p)),[3,8];case 4:return a&&a.dataBars?(d=i.explorationNavigation.getCurrentExploration().themeCollection,u=i.themeService.getVisualStyle(d),p=o.expr,h=p.getMetadata(n).type,[4,i.lazyScoped("dataBarsDialogLauncherService")]):[3,7];case 5:return g=e.sent(),v=this,[4,g.show(t,c,l,u.colorPalette,h,!1)];case 6:return v.dataBarsDialogRef=e.sent(),[3,8];case 7:e.label=8;case 8:return[2]}})})},E.prototype.removeConditionalFormatting=function(e){e.propertyDefinition;var t=this.getSelectedVisual(),e=e.repetition,i=e.propertyDescriptor&&e.propertyDescriptor.type,o=e.propertyDescriptor&&e.propertyDescriptor.type.misc,r=this.services.featureSwitchService.featureSwitches&&this.services.featureSwitchService.featureSwitches.conditionalTablixWebURL;i&&(i.fill||i.icon||r&&o&&o.webUrl)?this.services.visualAuthoring.removePropertyDefinition(t,e.propertyId,e.selector):i&&i.dataBars&&this.services.visualAuthoring.removeDataBars(t,e),this.services.telemetryService.logEvent(c.EXRemoveConditionalFormatting,{visualType:S.getVisualType(t),visualName:t.name})},E.prototype.removeConditionalFormattingAll=function(){var e=this.getSelectedVisual(),t=this.viewModel.conditionalFormattingRepetitions;this.services.visualAuthoring.removeConditionalFormattingAll(e,t),this.services.telemetryService.logEvent(c.EXRemoveConditionalFormatting,{visualType:S.getVisualType(e),visualName:e.name})},E.prototype.getSelectedVisual=function(){return a.getSelectedVisual(this.services.selection)},E.prototype.getVisualDataRole=function(){var e=S.getDataRolesForVisual(this.getSelectedVisual(),this.services.visualPlugin);if(!_.isEmpty(e))return d.findItemWithName(e,this.viewModel.role)},E.prototype.getAuthoringContext=function(){var e=this.getSelectedVisual();if(e){var t=this.services.dataSources.get();if(t)return{visual:e,dataSources:t}}},E);function E(e,t,i,o){var r=this;this.services=e,this.modernFieldlistDropElement=t,this.onContextMenuActionFailed=i,this.onLabelInEditingModeChanged=o,this.dropConfig={accept:"field",greedy:!1},this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipTitle:r.viewModel.displayOptions.tooltipTitle,tooltipDescription:r.viewModel.displayOptions.tooltipDescription}}},this.removeAriaLabel=this.services.localizationService.get("FieldWell_Remove"),this.newPaneColorsEnabled=this.services.explorationCapabilities.getCapabilities().showFluentDesign||this.services.featureSwitchService.featureSwitches&&this.services.featureSwitchService.featureSwitches.paneColorRefresh,this.getEditableLabelAriaLabel=function(){var e=r.viewModel.displayOptions.displayName;return _.isString(r.viewModel.displayOptions.tooltipTitle)&&(e=_.isString(e)?e.concat(". ",r.viewModel.displayOptions.tooltipTitle):r.viewModel.displayOptions.tooltipTitle),e=_.isString(r.viewModel.displayOptions.tooltipDescription)?_.isString(e)?e.concat(". ",r.viewModel.displayOptions.tooltipDescription):r.viewModel.displayOptions.tooltipDescription:e},t&&powerbi.explore.helpers.enableDropFromModernFieldList(t,function(e,t,i){return r.dropField(t,r.getFieldDropAction(i))},function(e){return r.getFieldDropAction(e)})}function M(e,t){var i=this;this.services=t,this.core=new C(t,this.services.$element.get(0),function(){p.focus(i.services.$element.find(".fieldWellIcon.dropDown")[0])})}t.FieldWellFieldCore=C,Object.defineProperty(M.prototype,"bucketDisplayName",{get:function(){return this.core.bucketDisplayName},set:function(e){this.core.bucketDisplayName=e},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"dropConfig",{get:function(){return this.core.dropConfig},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"getEditableLabelAriaLabel",{get:function(){return this.core.getEditableLabelAriaLabel},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"removeAriaLabel",{get:function(){return this.core.removeAriaLabel},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"tooltipConfigManager",{get:function(){return this.core.tooltipConfigManager},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"newPaneColorsEnabled",{get:function(){return this.core.newPaneColorsEnabled},enumerable:!1,configurable:!0}),M.createOptions=function(){return{additionalServices:["$element","conceptualSchemaProxy","dragDataService","dropdown","lazy","localizationService","modalDialogService","promiseFactory","telemetryService","featureSwitchService","explorationSerializer","themeService","screenReaderService","visualCalcEagerService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","groupAuthoring","modelChangeHandler","lazyScoped","selection","showValueAsService","undoRedo","visualAuthoring","visualPlugin","explorationCapabilities","sparklinesService","visibilityService"]}},M.prototype.onDestroy=function(){this.core.onDestroy()},M.prototype.getDropAction=function(e){return this.core.getDropAction(e)},M.prototype.drop=function(t,i,o){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.core.drop(t,i,o)]})})},M.prototype.deleteField=function(e){return this.core.deleteField(e)},M.prototype.deleteFieldAndFocus=function(e,t){return this.core.deleteFieldAndFocus(e,t)},M.prototype.getDragContext=function(){return this.core.getDragContext()},M.prototype.selectFieldMenuItem=function(e){this.core.selectFieldMenuItem(e)},M.prototype.showMenu=function(e){var t={anchorElement:$(e.currentTarget)};this.services.dropdown.showContextMenu(this.viewModel.interactivityOptions.dropDownItems,void 0,this.selectFieldMenuItem.bind(this),!1,void 0,void 0,!0,t),e.keyCode===$.ui.keyCode.SPACE&&e.stopPropagation()},M.prototype.onKeyDown=function(e){this.core.onKeyDown(e)},M.prototype.editLabel=function(){this.core.editLabel()},M.prototype.rename=function(e){this.core.rename(e),this.core.cancelRename()},M.prototype.cancelRename=function(){this.core.cancelRename()},t.FieldWellFieldController=M}),define("ExploreUIShell/components/fieldWellBucket/fieldWellBucketController",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldWellBucketCore=t.FieldWellBucketController=void 0;var n=powerbi.explore.contracts,i=powerbi.explore,l=powerbi.telemetry,a=powerbi.explore.util,s=powerbi.explore.util.FieldWellUtility,c=i.ScopeUtils,d=powerbi.explore.services.events,u=i.services.selectionUtils;function o(e,t){var i=this;this.services=t,this.onSourceSelected=function(e,t){i.core.onSourceSelected(e,t)},this.core=new r(t),this.scope=e}Object.defineProperty(o.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(e){this.core.viewModel=e},enumerable:!1,configurable:!0}),o.createOptions=function(){return{additionalServices:["$element","conceptualSchemaProxy","dragDataService","dropdown","featureSwitchService","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","groupAuthoring","groupingDesignStateService","selection","viewModeState","visualAuthoring"]}},o.prototype.$onInit=function(){var o=this;this.scope.drop=function(e,t,i){return o.drop(e,t,i)},this.scope.getDropAction=function(e){return o.getDropAction(e)},this.scope.dropConfig=this.core.getDropConfig(),this.scope.fieldWellAriaLabel=this.core.fieldWellAriaLabel.bind(this),this.scope.addFieldsAriaLabel=this.core.addFieldsAriaLabel(),this.scope.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDescription:o.core.getTooltipDescription()}}},this.viewModel.warning&&(this.scope.warningTooltipConfigManager={getTooltipConfig:function(){return o.core.getWarningTooltip()}}),this.core.$onInit(this.services.$element.get(0))},o.prototype.getBorderStyle=function(){return this.core.getBorderStyle()},o.prototype.getDropAction=function(e){return this.core.getDropAction(e)},o.prototype.drop=function(e,t,i){this.core.drop(e,t,i)},t.FieldWellBucketController=o;p.prototype.$onInit=function(e){var i=this;e&&powerbi.explore.helpers.enableDropFromModernFieldList(e,function(e,t){return i.dropField(t)})},p.prototype.isInlineExploreMode=function(){return 0===this.services.viewModeState.getMode()},p.prototype.getTooltipDescription=function(){return this.viewModel.description||this.viewModel.displayName},p.prototype.getWarningTooltip=function(){var e={tooltipTitle:"",tooltipDescription:""};return e=this.viewModel.warning?{tooltipTitle:this.viewModel.warning.title,tooltipDescription:this.viewModel.warning.description}:e},p.prototype.getBorderStyle=function(){if(this.isInlineExploreMode()&&0!==this.viewModel.properties.length)return"none"},p.prototype.getDropAction=function(e){var t,i=this.services.promiseFactory.defer(),o=this.services.dragDataService.getDragContext(),r=0;return o&&(t=this.viewModel,r=o.sourceRole===t.role&&_.last(t.properties).startIndex===o.sourceIndex?0:_.isEmpty(this.viewModel.properties)?1:2),i.resolve(r),i.promise},p.prototype.drop=function(e,t,i){var o=this.services.dragDataService.getDragContext();this.dropWithPayload(o)},p.prototype.dropWithPayload=function(e){var t,i,o,r,n,l;e&&(t=e,l=this.viewModel,i=this.getSelectedVisual(),t.sourceRole?($.isNumeric(t.sourceIndex),(o=0)<l.properties.length&&(o=_.last(l.properties).endIndex+1),t.sourceRole===l.role&&(o=Math.max(o-(t.hierarchyLevelCount||1),0)),r=this.services.dataSources.get(),n=16===(null==i?void 0:i.visibility),this.services.visualAuthoring.moveField(t.sourceRole,l.role,t.sourceIndex,o,t.hierarchyLevelCount||1,r,n),l=i?i.config.singleVisual.query.tryGetExpr(t.sourceRole,t.sourceIndex):null,this.logTelemetry(l,t.sourceRole,i)):e.field&&this.dropField(e.field))},p.prototype.dropField=function(r){return __awaiter(this,void 0,void 0,function(){var t,i,o;return __generator(this,function(e){switch(e.label){case 0:return(i=this.getSelectedVisual())?(o=this.services.dataSources.get(),[4,this.services.visualAuthoring.addFieldInRole(r,this.viewModel.role,o,i)]):[3,2];case 1:return t=e.sent(),[3,3];case 2:this.services.eventBridge.publishToChannel(d.addVisualContainer,{expr:r,visualType:s.getDefaultVisualPlugin(this.services.featureSwitchService).name,targetRole:this.viewModel.role,allowAggregate:!0,telemetrySource:3}),t=!0,e.label=3;case 3:return this.logTelemetry(r,null),[2,t]}})})},p.prototype.getSelectedVisual=function(){return u.getSelectedVisual(this.services.selection)},p.prototype.logTelemetry=function(e,t,i){var o,r;e&&(o="Create",t&&(o="Update",this.services.telemetryService.logEvent(l.EXChangeFieldWell,{sourceBucketRole:t,targetBucketRole:this.viewModel.role,visualName:i&&i.name})),i=a.VisualContainerUtils.getVisualType(this.getSelectedVisual()),r=c.getSchemaPromise(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy),this.services.groupAuthoring.telemetry.logGroupsUsageTelemetry(r,e,i,this.viewModel.role,t,o))},p.prototype.fieldWellAriaLabel=function(){var e=this.viewModel.displayName;return e=_.isString(this.viewModel.description)?_.isString(e)?e.concat(". ",this.viewModel.description):this.viewModel.description:e},p.prototype.getDropConfig=function(){return{accept:"field",greedy:!1}},p.prototype.addFieldsAriaLabel=function(){var e=this.services.localizationService;return e.get("FieldDropZone_NoDataFields").concat(". ",e.get("FieldDropZone_AddFields"))};var r=p;function p(e){var r=this;this.onSourceSelected=function(e,t){var i,o=u.getSelectedCanvasItems(r.services.selection);1===o.length&&(o=o[0])&&n.isVisualContainer(o)&&(i=r.services.dataSources.get(),r.services.visualAuthoring.addFieldInRole(t,r.viewModel.role,i,o))},this.services=e}t.FieldWellBucketCore=r}),function(e){function t(e,t){var r=this;this.restrict="E",this.replace=!0,this.require="ngModel",this.scope={warningMessage:"<",labelId:"<?",isDisabled:"<?"},this.templateUrl="views/toggleSwitch.html",this.link=function(t,e,i,o){o.$render=function(){t.toggleValue=o.$viewValue},t.checked=function(){o.$setViewValue(t.toggleValue)},t.handleToggleEvent=function(e){13===e.keyCode&&(t.toggleValue=!t.toggleValue)},t.$watch("toggleValue",function(e){null==e||t.isDisabled||t.checked()}),t.handleToggleFocus=function(e){t.warningMessage&&r.screenReaderService.alert(t.warningMessage.title+t.warningMessage.detail)},t.getTooltipConfig=function(){if(t.warningMessage)return{tooltipDisable:!1,tooltipTitle:t.warningMessage.title,tooltipDescription:t.warningMessage.detail}},r.initializeHighContrastRules()},this.highContrastCssGenerationService=e,this.screenReaderService=t}e=(e=e.explore||(e.explore={})).directives||(e.directives={}),t.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule(".themeableElement .toggle-switch-inner:after","{ border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .toggle-switch-checkbox:checked + .toggle-switch-label .toggle-switch-inner:after","{ background: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement  .toggle-switch .toggle-switch-label:hover .toggle-switch-inner:after","{ border-color: @selectedBackgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .toggle-switch .toggle-switch-checkbox:checked + .toggle-switch-label:hover .toggle-switch-inner:after","{ background: @selectedBackgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .toggle-switch .toggle-switch-checkbox:checked + .toggle-switch-label:hover .toggle-switch-inner","{ border-color: @selectedBackgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .inputField .toggle-switch:focus","{ outline-color: @selectedBackgroundColor !important; }")},e.ToggleSwitch=t}(powerbi=powerbi||{}),function(e){function t(){var r=this;this.restrict="A",this.scope={viewModel:"=?",sectionNumber:"=?",navMarkerParent:"@",autoWidth:"<?"},this.link=function(i,o){null!=i.viewModel?(i.$watch("viewModel.activePageSection",function(e){var t;null!=e&&(t=(e=r.getPageSectionIndexes(i.viewModel,e))[0],e=e[1],r.animateSectionSlide(i,o,t,e))}),i.$watch("viewModel.activeSection",function(e){var t;null!=e&&(t=(e=r.getSectionIndexes(i.viewModel,e))[0],e=e[1],r.animateSectionSlide(i,o,t,e))}),i.$watch("viewModel.sections.length",function(e,t){0!==e&&e!==t&&(t=(e=r.getSectionIndexes(i.viewModel,i.viewModel.activeSection))[0],e=e[1],r.animateSectionSlide(i,o,t,e))})):null!=i.sectionNumber&&i.$watch("sectionNumber",function(e){null!=e&&r.animateSectionSlide(i,o,e,Number(!e))})}}e=(e=e.explore||(e.explore={})).directives||(e.directives={}),t.prototype.animateSectionSlide=function(e,t,i,o){i<o?t.css({right:"200%"}).animate({right:0},200):o<i&&t.css({"margin-left":"200%"}).animate({"margin-left":0},200);o=$(".".concat(e.navMarkerParent,".navMarker"));e.autoWidth?0===i?o.css({"margin-left":o.width()+"px","margin-right":"auto"}).animate({"margin-left":"0"},200):o.css({"margin-right":o.width()+"px","margin-left":"auto"}).animate({"margin-right":"0"},200):o.animate({"margin-left":o.width()*i+"px"},200)},t.prototype.getSectionIndexes=function(e,i){var o=[],r=e.previousSection;return e.sections.forEach(function(e,t){if(e.sectionType===i?o[0]=t:e.sectionType===r&&(o[1]=t),2===o.length)return o}),o},t.prototype.getPageSectionIndexes=function(e,i){var o=[],r=e.previousPageSection;return e.pagePaneSections.forEach(function(e,t){if(e.sectionType===i?o[0]=t:e.sectionType===r&&(o[1]=t),2===o.length)return o}),o},e.SectionAnimationSlider=t}(powerbi=powerbi||{}),define("ExploreUIShell/components/fieldWellBucket/fieldWellBucket",["require","exports","ExploreUIShell/components/fieldWellBucket/fieldWellBucketController"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldWellBucket=void 0;t.FieldWellBucket={templateUrl:"components/fieldWellBucket/fieldWellBucket.html",bindings:{viewModel:"="},controller:powerbi.common.createController(i.FieldWellBucketController)}}),define("ExploreUIShell/components/fieldWellField/fieldWellField",["require","exports","ExploreUIShell/components/fieldWellField/fieldWellFieldController"],function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldWellField=void 0;t.FieldWellField={templateUrl:"components/fieldWellField/fieldWellField.html",bindings:{viewModel:"=",bucketDisplayName:"="},controllerAs:"ctrl",controller:powerbi.common.createController(i.FieldWellFieldController)}}),function(e){var t,v,m,y;t=(t=(t=e.explore||(e.explore={})).viewModels||(t.viewModels={})).FieldWellViewModelOperations||(t.FieldWellViewModelOperations={}),v=e.data.FieldExprPattern,m=e.data.SQExprConverter,y=e.data.SQHierarchyExpr,t.updateSelectedMenuItems=function(e,t){var i=v.getAggregate(e.expr),o=void 0!==i,r=e.interactivityOptions.dropDownItems;if(r)for(var n,l,a=0,s=r.items;a<s.length;a++){var c=s[a],d=c.key;if(d)switch(d.action){case 4:c.checked=o&&d.aggregate===i;break;case 2:c.checked=!o;break;case 8:var u=t.config.singleVisual.query.projections[e.role];c.checked=!(!u||!u.showAll);break;case 128:c.checked=(u=e,n=c.text,l=void 0,(l=function(e){if(!_.isEmpty(e.hierarchyLevels))return(e=e.hierarchyLevels[0].expr).arg instanceof y,e.arg}(u))?l.hierarchy===n:!!(l=m.asFieldPattern(u.expr))&&(l.columnAggr?l.columnAggr.name===n:l.groupingColumnAggr?l.groupingColumnAggr.name===n:l.column?l.column.name===n:!!l.groupingColumn&&l.groupingColumn.name===n));break;case 16:for(var p=0,h=c.children;p<h.length;p++){var g=h[p];g.checked=function(e,t){var i=m.asFieldPattern(e.expr);if(!i||!t)return!1;switch(t.kind){case void 0:return!i.percentOfGrandTotal&&!i.percentOfRoleTotal;case 0:return!!i.percentOfGrandTotal;case 1:var o=t;return!(!i.percentOfRoleTotal||!_.every(i.percentOfRoleTotal.roles,function(e){return _.includes(o.roles,e)}));default:return!1}}(e,g.key.showValueAs)}break;case 2048:c.checked=!1;break;default:c.checked=void 0}}}}(powerbi=powerbi||{}),define("ExploreUIShell/module.templates",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.put=void 0,t.put=function(e){e.put("components/fieldWell/fieldWell.html",'<section class="fieldWell unselectable"><ol ng-if="$ctrl.core.viewModel.buckets"><li ng-repeat="bucket in $ctrl.core.viewModel.buckets"><field-well-bucket class="field-well-bucket-element" view-model="bucket" role="list"></field-well-bucket></li></ol></section>'),e.put("components/fieldWellBucket/fieldWellBucket.html",'<li class="bucket"><div class="bucket-header"><h2 class="caption trimmedTextWithEllipsis smallFontSize" tabindex="0" role="heading" aria-label="{{::fieldWellAriaLabel()}}" ng-bind="::$ctrl.viewModel.displayName" tooltip tooltip-config="tooltipConfigManager.getTooltipConfig()"></h2><i ng-if="$ctrl.viewModel.warning" role="alert" tabindex="0" aria-label="{{warningTooltipConfigManager.getTooltipConfig().tooltipDescription}}" class="warning glyphicon glyph-mini ng-scope" ng-class="$ctrl.viewModel.warning.glyph" tooltip tooltip-config="warningTooltipConfigManager.getTooltipConfig()"></i></div><ol class="properties" ng-style="{\'border\': $ctrl.getBorderStyle()}" drop="dropConfig"><li class="bucketTopBorder"></li><li ng-repeat="property in $ctrl.viewModel.properties"><field-well-field bucket-display-name="$ctrl.viewModel.displayName" view-model="property" id="{{::\'container\'+$id}}" role="list"/></li><li drop="dropConfig" tabindex="{{$ctrl.viewModel.properties.length === 0 ? 0 : -1}}" role="heading" aria-label="{{::addFieldsAriaLabel}}" aria-level="3" drop-handler="drop(event, ui, dropAction)" drop-action="getDropAction(dropPosition)" class="trimmedTextWithEllipsis" ng-class="{\'dropzone\': $ctrl.viewModel.properties.length === 0, \'end-dropzone\': $ctrl.viewModel.properties.length > 0, \'supports-multiple-items\': $ctrl.viewModel.supportsMultipleItems}" ng-attr-localize="{{$ctrl.viewModel.properties.length === 0 ? \'FieldDropZone_AddFields\' : \'\'}}" ng-attr-localize-tooltip="{{$ctrl.viewModel.properties.length === 0 ? \'FieldDropZone_AddFields\' : \'\'}}"></li></ol></li>'),e.put("components/fieldWellField/fieldWellField.html",'<li class="fieldWellProperty" ng-class="{\'can-prepend\': !ctrl.viewModel.interactivityOptions.isReplaceable, \'not-draggable\': !ctrl.viewModel.interactivityOptions.isDraggableField}" drag="field" drag-context="ctrl.getDragContext()" drag-disabled="!ctrl.viewModel.interactivityOptions.isDraggableField" drop="ctrl.dropConfig" drop-handler="ctrl.drop(event, ui, dropAction)" drop-action="ctrl.getDropAction(dropPosition)" drop-container-id="{{::\'container\'+$parent.$id}}" tooltip tooltip-config="ctrl.tooltipConfigManager.getTooltipConfig()"><h2 class="flex smallFontSize" ng-right-click="ctrl.showMenu($event)"><i ng-if="::!ctrl.viewModel.valid" tabindex="0" role="button" accessible-click="ctrl.editLabel()" aria-label="{{::ctrl.getEditableLabelAriaLabel()}}" class="errorIcon error item-auto"><svg-use-symbol sheet="fieldListPaneIcons" symbol-id="fieldListError"></svg-use-symbol></i><i ng-if="ctrl.viewModel.displayOptions.glyph" class="field-glyph glyphicon glyph-mini" ng-class="ctrl.viewModel.displayOptions.glyph"></i><editable-label class="propertyText propertyContent caption trimmedTextWithEllipsis item-fill" tabindex="0" aria-label="{{::ctrl.getEditableLabelAriaLabel()}}" [display-name]="ctrl.viewModel.displayOptions.displayName" (on-blur)="ctrl.rename($event.newName)" (cancel)="ctrl.cancelRename()" [editable]="ctrl.viewModel.isEditingLabel" [disable-click]="true" ng-dblclick="ctrl.editLabel()" ng-keydown="ctrl.onKeyDown($event)" [custom-tooltip]="true"></editable-label> <button ng-if="ctrl.viewModel.interactivityOptions.hasContextMenu" role="button" aria-expanded="false" aria-label="{{::ctrl.getEditableLabelAriaLabel()}}" class="fieldWellIcon dropDown item-auto" ng-class="{ \'glyphicon glyph-mini pbi-glyph-chevrondownsmall\': ctrl.newPaneColorsEnabled }" ng-click="ctrl.showMenu($event)"><svg-use-symbol ng-if="!ctrl.newPaneColorsEnabled" sheet="fieldListPaneIcons" symbol-id="fieldListDropdown"></svg-use-symbol></button> <button ng-if="ctrl.viewModel.interactivityOptions.isRemovableField" aria-label="{{::ctrl.removeAriaLabel}}" ng-click="ctrl.deleteFieldAndFocus($event)" class="delete glyphicon pbi-glyph-close glyph-micro"></button></h2><ol class="hierarchyList" ng-if="::ctrl.viewModel.hierarchyLevels"><li ng-repeat="hierarchyLevel in ::ctrl.viewModel.hierarchyLevels" class="flex"><span tabindex="0" aria-label="{{::hierarchyLevel.displayName}}" class="subcaption trimmedTextWithEllipsis item-fill" ng-bind="::hierarchyLevel.displayName"></span> <button aria-label="{{ctrl.removeAriaLabel}}" ng-click="ctrl.deleteFieldAndFocus($event, $index)" class="delete glyphicon pbi-glyph-close glyph-micro"></button></li></ol></li>'),e.put("components/taskPane/taskPane.html",'<exploration-pane-downgraded [expanded]="$ctrl.viewModel.isPaneExpanded" [title]="$ctrl.paneTitleKey" [allow-toggle]="!$ctrl.viewModel.disallowExpandCollapse" [show-close]="$ctrl.viewModel.allowClosingPane" (on-close)="$ctrl.close()" (on-toggle)="$ctrl.toggleTaskPane()" disable-scroll modeling-context-changer data-automation-type="taskPaneGroup" keyboard-shortcuts="ctrl-F6" focus-nav-mode="Group" focus-priority="12"><exploration-pane-section-downgraded class=\'paneSection\' no-padding><div class="paneContents" ng-if="$ctrl.viewModel.isPaneVisible" ng-show="$ctrl.viewModel.isPaneExpanded" pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><pbi-lazy-load-modern [module-path]="$ctrl.fieldListModulePath" [component-id]="\'FieldListContainerComponentId\'"></pbi-lazy-load-modern></div><div class="paneStopBottom" tabindex="0"></div></exploration-pane-section-downgraded></exploration-pane-downgraded>')}}),define("ExploreUIShell/module",["require","exports","ExploreUIShell/module.templates","ExploreUIShell/components/fieldWell/fieldWell","ExploreUIShell/components/fieldWellField/fieldWellField","ExploreUIShell/components/fieldWellBucket/fieldWellBucket"],function(e,t,i,o,r,n){function l(){a||(angular.module("powerbi.exploreUIShell",["powerbi.explore","powerbi.common"]).run(["$templateCache",i.put]),a=!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.registerBuildingBlocksForHost=t.initializeAngularModule=void 0,t.initializeAngularModule=l;var a=!1;l(),t.registerBuildingBlocksForHost=function(e){var t=[{name:"FieldWell",factory:o.FieldWell,blockType:2,consumerHostFlags:24875},{name:"FieldWellBucket",factory:n.FieldWellBucket,blockType:2,consumerHostFlags:24875},{name:"FieldWellField",factory:r.FieldWellField,blockType:2,consumerHostFlags:24875},{name:"SectionAnimationSlider",blockType:1,consumerHostFlags:24875,factory:powerbi.explore.directives.SectionAnimationSlider},{name:"ToggleSwitch",dependencies:["highContrastCssGenerationService","screenReaderService"],blockType:1,consumerHostFlags:24591,factory:powerbi.explore.directives.ToggleSwitch},{name:"TaskPane",blockType:2,consumerHostFlags:24875,factory:powerbi.explore.components.TaskPane}];powerbi.common.registerBuildingBlocksForHost(e,t,{directivesTarget:"powerbi.exploreUIShell",componentsTarget:"powerbi.exploreUIShell"})}}),function(e){var i,t,o,r,n,l,a,s;function c(){}function d(e){this.groupingDesignStateService=e}function u(){}function p(){}i=e.explore||(e.explore={}),t=i.util||(i.util={}),o=e.explore.viewModels.FieldListConceptualHierarchy,r=e.data.SQExprBuilder,t.getFieldExprKind=function(e){switch(e){case 2:return 1;case 3:return 2;case 0:return 0;case 6:return 3;default:return 0}},t.createFieldListExprGenerator=function(e,t){switch(e){case 1:return new a;case 2:return new s;case 3:return new n;default:return new l(t)}},c.prototype.fieldExpr=function(e){e=r.entity(e.schema.name,e.contract.name);return r.aggregate(e,2)},n=c,d.prototype.fieldExpr=function(e){var t;if(void 0!==e.kind)return 0===e.kind?i.utils.GroupUtils.isGroupOrClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService)?(t=r.entity(e.entity.contractSchema.name,e.entity.name),t=i.utils.GroupUtils.getGroupedColumnsFromMetadata(e.contract.column.groupingMetadata,t),r.fieldExpr({groupingColumn:{schema:e.schema.name,entity:e.entity.name,name:e.name,groupedColumns:t}})):r.fieldExpr({column:{schema:e.schema.name,entity:(e.originalEntity||e.entity).name,name:e.name}}):1===e.kind?r.fieldExpr({measure:{schema:e.schema.name,entity:e.entity.name,name:e.name}}):void 0},l=d,u.prototype.fieldExpr=function(e){var t;return e.variation&&e.originalEntity?(t=e.parent,r.fieldExpr({columnHierarchyVariation:{source:{name:t.name,schema:t.entity.contractSchema.name,entity:t.entity.name},hierarchy:{schema:e.entity.contractSchema.name,entity:e.originalEntity.name,name:e.contract.name},variationName:e.variation}})):r.fieldExpr({hierarchy:{name:e.name,schema:e.entity.contractSchema.name,entity:(e.originalEntity||e.entity).name}})},a=u,p.prototype.fieldExpr=function(e){var t,i;return e.variation&&e.parent instanceof o?(i=(t=e.parent).parent,r.fieldExpr({columnHierarchyLevelVariation:{source:{name:i.name,schema:i.entity.contractSchema.name,entity:i.entity.name},level:{schema:i.entity.contractSchema.name,entity:e.originalEntity.name,name:t.contract.name,level:e.name},variationName:e.variation}})):r.fieldExpr({hierarchyLevel:{schema:e.entity.contractSchema.name,entity:e.entity.name,name:e.parent.name,level:e.name}})},s=p}(powerbi=powerbi||{});