"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['slicerVisual.min.js'] || (this.parseTimeMarkers['slicerVisual.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('slicerVisual.min.js');var es6,powerbi,__extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__spreadArray=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var r,o=0,n=t.length;o<n;o++)!r&&o in t||((r=r||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(i,t){function r(e){try{n(l.next(e))}catch(e){t(e)}}function o(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,o)}n((l=l.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(r,o){var n,a,s,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(i){return function(e){var t=[i,e];if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,a=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(s=0<(s=l.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))l.label=t[1];else if(6===t[0]&&l.label<s[1])l.label=s[1],s=t;else{if(!(s&&l.label<s[2])){s[2]&&l.ops.pop(),l.trys.pop();continue}l.label=s[2],l.ops.push(t)}}t=o.call(r,l)}catch(e){t=[6,e],a=0}finally{n=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};!function(r){var o,e;function t(e,t,i){this.columns=t,this.selectedDataPoints=i,this.column=e&&!_.isEmpty(e.categories)?e.categories[0]:null,this.column&&(this.objects=this.column.objects),this.count=this.column&&this.column.values?this.column.values.length:0,this.isImage=o.converterHelper.isImageUrlColumn(this.columns[0])}o=r.visuals||(r.visuals={}),e=o.readers||(o.readers={}),t.prototype.getDataPointsCount=function(){return this.count},t.prototype.getMetadataColumn=function(){return this.column&&this.column.source||this.columns[0]},t.prototype.getDataViewDataPoint=function(e){var t,i;return this.count,this.objects&&(t=this.objects[e],i=r.DataViewObjects.getValue(t,o.slicerProps.general.count,i)),{scopeId:this.column.identity[e],count:i,value:this.column.values[e]}},t.prototype.isImageData=function(){return this.isImage},t.prototype.getLevel=function(){return 0},t.prototype.hasCount=function(){return!_.isEmpty(this.objects)},t.prototype.getSelectedNodes=function(){return this.selectedDataPoints},t.prototype.getMetadataColumns=function(){return this.column&&[this.column.source]},t.prototype.getIdentityExprs=function(){return this.column&&this.column.identityFields&&[this.column.identityFields]},e.SlicerCategoricalDataReader=t}(powerbi=powerbi||{}),function(a){var s,t,i,l;function e(e){e&&(this.preventVirtualKeyboardOnTheFirstTap=e.preventVirtualKeyboardOnTheFirstTap,this.featureSwitches=e.featureSwitches),this.culture=a.formattingService.getCurrentCulture(),this.inputElements=[],this.eventsHelper=new s.SlicerUtil.EventsHelper;e=this.hostServices=e.hostServices;this.startInputLabel=e.getLocalizedString("Slicer_StartLabel"),this.endInputLabel=e.getLocalizedString("Slicer_EndLabel")}s=a.visuals||(a.visuals={}),t=a.data.RangeFilterPattern,i=a.data.SQExprBuilder,l=jsCommon.StringExtensions,e.prototype.createRange=function(e){return new s.DateRange(e.bounds.min,e.bounds.max,e.value.min,e.value.max)},e.prototype.getSliderOptions=function(e,t){return{min:0,max:s.DateUtil.getDifferenceInDays(e.bounds.max,e.bounds.min),step:1}},e.prototype.areEqual=function(e,t){return s.DateUtil.isEqual(e,t)},e.prototype.defaultValue=function(){return new Date(0)},e.prototype.startProperty=function(){return s.slicerProps.data.startDate},e.prototype.endProperty=function(){return s.slicerProps.data.endDate},e.prototype.formatValue=function(e,t){return a.formattingService.formatValue(e,"d")},e.prototype.parseSingleSliderValue=function(e,t){return null},e.prototype.inputStyleProperties=function(){return{background:s.slicerProps.date.background,fontColor:s.slicerProps.date.fontColor,textSize:s.slicerProps.date.textSize,fontFamily:s.slicerProps.date.fontFamily,bold:s.slicerProps.date.bold,italic:s.slicerProps.date.italic,underline:s.slicerProps.date.underline}},e.prototype.parseInput=function(e,t,i){return a.formattingService.parseDate(e)},e.prototype.isInputValid=function(e,t,i,r){return!(null==e||0===i&&e>t.max||1===i&&e<t.min)},e.prototype.setRange=function(e,t,i,r,o,n){null==o?(this.featureSwitches.useModernDatePickerSlicer||(i.val(a.formattingService.formatValue(e.min,"d")),r.val(a.formattingService.formatValue(e.max,"d"))),i.attr("aria-label",l.format(this.startInputLabel,a.formattingService.formatValue(n.min,"d"),a.formattingService.formatValue(e.max,"d"))),r.attr("aria-label",l.format(this.endInputLabel,a.formattingService.formatValue(e.min,"d"),a.formattingService.formatValue(n.max,"d")))):0===o?(this.featureSwitches.useModernDatePickerSlicer||i.val(a.formattingService.formatValue(e.min,"d")),i.attr("aria-label",l.format(this.startInputLabel,a.formattingService.formatValue(n.min,"d"),a.formattingService.formatValue(n.max,"d")))):1===o&&(this.featureSwitches.useModernDatePickerSlicer||r.val(a.formattingService.formatValue(e.max,"d")),r.attr("aria-label",l.format(this.endInputLabel,a.formattingService.formatValue(n.min,"d"),a.formattingService.formatValue(n.max,"d"))))},e.prototype.enumerateObjectInstances=function(e,t,i){var r;if("date"===e.objectName&&(t&&t.inputStyle))return e=s.slicerProps.date,r={selector:null,objectName:"date",properties:{fontColor:t.inputStyle.fontColor,background:t.inputStyle.background,textSize:t.inputStyle.textSize,fontFamily:t.inputStyle.fontFamily}},i&&i.enableBIU&&(r.properties[e.bold.propertyName]=t.inputStyle.labelBold,r.properties[e.italic.propertyName]=t.inputStyle.labelItalic,r.properties[e.underline.propertyName]=t.inputStyle.labelUnderline),[r]},e.prototype.getValuesCard=function(t,e){var i=this,r=s.slicerProps.date,o=new s.builder.FormattingCardBuilder(new s.builder.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[r.fontFamily,r.textSize,r.fontColor,r.background,r.bold,r.italic,r.underline],function(e){return i.hostServices.getLocalizedString(e)}),n=(new s.builder.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:t.inputStyle.fontFamily}).withFontSizeProperties({descriptor:r.textSize,value:t.inputStyle.textSize}),a=(e&&e.enableBIU&&n.withBold({descriptor:r.bold,value:t.inputStyle.labelBold}).withItalic({descriptor:r.italic,value:t.inputStyle.labelItalic}).withUnderline({descriptor:r.underline,value:t.inputStyle.labelUnderline}),n.build());return o.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values"),e.addCompositeSlice("fontselector","Font",a),e.addSimpleSlice("color",function(){var e={value:t.inputStyle.fontColor};return new s.builder.ColorPickerBuilder({descriptor:r.fontColor,value:e}).build()})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:t.inputStyle.background};return new s.builder.ColorPickerBuilder({descriptor:r.background,value:e}).build()})}),o.build()},e.prototype.getDataPointsForSingleValueRange=function(e){return[]},e.prototype.createInputElement=function(e,t){var i=this,r=this.culture.calendar.patterns.d,o=InJs.DomFactory.textBox().attr("type","text").attr(s.RangeSlicerConstants.DisableDragAttribute,"true").prop("readonly",!!this.preventVirtualKeyboardOnTheFirstTap).attr("placeholder",r).addClass(s.RangeSlicerConstants.InputClass.class).appendTo(e),n=(e.attr("tabindex","0"),e.keydown(function(e){13!==e.keyCode&&32!==e.keyCode||o.focus()}),o.datepicker({showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,nextText:"",prevText:"",firstDay:this.culture.calendar.firstDay,dayNamesMin:this.culture.calendar.days.namesAbbr,dateFormat:this.culture.calendar.patterns.d.replace("yyyy","yy").toLowerCase(),monthNamesShort:this.culture.calendar.months.names,onClose:function(){o.prop("readonly",!!i.preventVirtualKeyboardOnTheFirstTap)}}),o.on("click",function(e){i.preventVirtualKeyboardOnTheFirstTap&&o.is("[readonly]")&&(o.prop("readonly",!1),o.blur()),o.datepicker("show")}),this.preventVirtualKeyboardOnTheFirstTap&&o.on("touchstart",function(e){o.is("[readonly]")||o.is(":focus")||o.focus()}),o.datepicker("widget"));return n.attr("prevent-focus-loss","false"),o.attr("prevent-focus-loss","false"),o.datepicker("option","beforeShow",function(){n.addClass("themeableElement"),i.unregisterPopupHideEvents=i.eventsHelper.onPopupHideEvent(function(e,t){i.onPopupHideEvent(e,t)},e.get(0)),i.fixLayout(n,o,1e3)}),this.inputElements.push(o),o},e.prototype.onPopupHideEvent=function(e,t){"resize"!==e&&((e=$(t)).hasClass("hasDatepicker")||e.hasClass("ui-datepicker")||e.hasClass("ui-icon")||$(e).closest(".ui-datepicker").length)||this.hideDatepicker()},e.prototype.hideDatepicker=function(){this.unbindPopupHideEventHandlers();for(var e=0,t=this.inputElements;e<t.length;e++){var i=t[e];i.datepicker("widget").is(":visible")&&i.datepicker("hide").blur()}},e.prototype.onDestroy=function(){this.hideDatepicker()},e.prototype.unbindPopupHideEventHandlers=function(){this.unregisterPopupHideEvents&&this.unregisterPopupHideEvents()},e.prototype.fixLayout=function(e,t,i){var r=this;setTimeout(function(){e.is(":visible")?(s.SlicerHelper.fixWidgetPosition(e,t,null,!0),e.find(".ui-datepicker-current-day").addClass("backgroundToForegroundColor")):0<i&&r.fixLayout(e,t,i-20)},20)},e.prototype.filterExpr=function(e){e=t.roundUpDateRange(e);return{lower:i.dateTime(e.min),upper:i.dateTime(e.max)}},e.prototype.comparisonKind=function(){return{lower:2,upper:3}},e.prototype.addAriaDescription=function(e){var t=this.culture.calendar.patterns.d,t=a.formattingService.format(this.hostServices.getLocalizedString("DateSlicer_InputTextHint"),[t]);e.attr("aria-description",t)},s.DateSlicer=e}(powerbi=powerbi||{}),function(n){var a,o,s,l,c,i;function e(e,t){var i=this;this.DefaultRestatementColorName="foregroundDark",this.verticalSlicerRenderer=e,this.popup=$("<div ></div>").addClass("slicer-dropdown-popup"),jsCommon.BrowserUtils.isIOSWebView()&&this.popup.addClass(a.SlicerUtil.Selectors.DisableScrollHover.class),this.popup.on("slicer.dataPointSelected",function(e){i.strictSingleSelect&&(i.hidePopup(),e.stopPropagation())}),this.content=$("<div ></div>").addClass("slicer-dropdown-content"),this.loader=$("<div ></div>").addClass("slicer-dropdown-loader"),this.hostServices=t.hostServices,this.controlId="slicer-dropdown-popup-".concat(jsCommon.Utility.generateGuid()),this.popup.addClass("visual").addClass("themeableElement").attr("focus-nav-mode","Group").attr("id",this.controlId).keydown(function(e){27!==e.keyCode||i.popup.is(":hidden")?9!==e.keyCode||i.popup.is(":hidden")||(i.hidePopup(),jsCommon.FocusManager.focus(jsCommon.FocusGroupNavigation.getFocusNextElement(!0,i.menu.get(0))),e.preventDefault(),e.stopPropagation()):(i.hidePopup(),i.menu.focus(),e.preventDefault(),e.stopPropagation())}),$("body").append(this.popup),this.popup.append(this.content),this.popup.append(this.loader),this.featureSwitches=t.featureSwitches,this.eventsHelper=new a.SlicerUtil.EventsHelper}a=n.visuals||(n.visuals={}),o=jsCommon.FocusManager,s=a.Units.FontSize,l=jsCommon.PixelConverter,c="aria-expanded",i="focused",e.prototype.onClear=function(e){this.verticalSlicerRenderer.onClear(e)},e.prototype.onModeChange=function(e){this.popup.remove(),this.verticalSlicerRenderer.onModeChange(e)},e.prototype.onDataViewObjectChanged=function(e,t){e=a.SlicerUtil.getUpdatedDataViewObjects(e,t);return e},e.prototype.hasSlider=function(){return!1},e.prototype.supportsOrientation=function(){return!1},e.prototype.enumerateObjectInstances=function(e){return this.verticalSlicerRenderer.enumerateObjectInstances(e,this.featureSwitches)},e.prototype.getValuesCard=function(){return this.verticalSlicerRenderer.getValuesCard(this.featureSwitches)},e.prototype.getSlicerSettingsCardOptions=function(e,t,i,r){return this.verticalSlicerRenderer.getSlicerSettingsCardOptions(e,t,i,r)},e.prototype.getAdditionalCards=function(){return this.verticalSlicerRenderer.getAdditionalCards()},e.prototype.init=function(e,t){return this.container=t,this.style=e.visualInitOptions.style,this.slicerSelectionHandler=this.verticalSlicerRenderer.init(e,this.content),this.slicerSelectionHandler},e.prototype.onDestroy=function(){this.verticalSlicerRenderer&&this.verticalSlicerRenderer.onDestroy(),this.unbindPopupHideEventHandlers(),this.popup.remove()},e.prototype.render=function(e){this.options=e,this.data=this.verticalSlicerRenderer.converter(this.options.dataView,this.options.isSlicer),this.renderMenu(this.data.restatement),this.isExpanded&&this.showPopup(this.setFocus,!0)},e.prototype.renderMenu=function(e){var t,i,r,o=this;this.menu||(this.menu=InJs.DomFactory.div(),this.menu.addClass("slicer-dropdown-menu"),this.menu.attr(((t={role:"combobox","aria-haspopup":"listbox",tabindex:"0","aria-controls":this.controlId})[c]="false",t[a.RangeSlicerConstants.DisableDragAttribute]="true",t)),this.container.append(this.menu),this.menu.on("click touchstart keydown",function(e){o.focusEventType=e.type,e.preventDefault(),("click"===e.type||"touchstart"===e.type||40===e.keyCode&&!e.ctrlKey||38===e.keyCode&&!e.ctrlKey||32===e.keyCode||13===e.keyCode)&&o.onRenderMenuClick(e,!0)}),this.restatement=InJs.DomFactory.div(),this.restatement.addClass("slicer-restatement"),this.menu.append(this.restatement),this.icon=$("<i ></i>").addClass("dropdown-chevron"),this.icon.appendTo(this.menu)),this.menu.attr({"aria-label":this.options.restatement}),this.icon.addClass("powervisuals-glyph"),this.icon.addClass("chevron-down"),this.settings=this.defaultRestatementSetting(),this.options.dataView.metadata&&this.options.dataView.metadata.objects&&(t=this.options.dataView.metadata.objects,i=a.ColorHelper.create(this.style),r=a.FontProperties.createFromObjectOrStyle(n.DataViewObjects.getObject(t,"items"),{color:"fontColor",family:"fontFamily",size:"textSize"},i,this.style,"foregroundNeutralSecondary","lightLabel",{color:this.settings.fontColor,family:this.settings.fontFamily,size:s.createFromPt(this.settings.textSize)}),this.settings.fontColor=r.color,this.settings.fontFamily=r.family,this.settings.textSize=r.size.pt,this.settings.background=i.getColorForPropertyWithDefaultColor(t,a.slicerProps.items.background,this.settings.background),this.strictSingleSelect=n.DataViewObjects.getValue(t,a.slicerProps.selection.strictSingleSelect,this.strictSingleSelect)),this.restatement.text(e),this.menu.css({"background-color":this.settings.background||"",color:this.settings.fontColor,"font-size":l.fromPointToPixel(this.settings.textSize),"font-family":this.settings.fontFamily}),this.popup.css({"background-color":this.settings.background||""})},e.prototype.onRenderMenuClick=function(e,t){e.stopPropagation(),this.popup.is(":hidden")?(this.isExpanded=!0,this.setFocus=t,this.hostServices.setShouldDeferData(!1),this.loader.css({"background-color":this.settings.background||""}),this.loader.show(),this.popup.addClass(i),this.showPopup(!1,!1)):(this.popup.removeClass(i),this.hidePopup())},e.prototype.showPopup=function(t,i){var r=this;window.requestAnimationFrame(function(){var e;r.popup&&(r.unbindPopupHideEventHandlers(),e=r.menu.width()+10,r.popup.css({width:e}),r.menu.attr(c,"true"),r.icon.removeClass("chevron-down"),r.icon.addClass("chevron-up"),a.SlicerHelper.fixWidgetPosition(r.popup,r.menu,null,!0),i&&r.verticalSlicerRenderer.renderVerticalSlicer(r.data,r.options,function(){r.loader.hide(),r.focusCallbackTimeout&&window.clearTimeout(r.focusCallbackTimeout),r.focusCallbackTimeout=window.setTimeout(function(){t&&o.focusChildInGroup(r.popup.get(0),"keydown"===r.focusEventType),r.focusCallbackTimeout=void 0,r.setFocus=!1,r.focusEventType=void 0},0)}),r.unregisterPopupHideEvents=r.eventsHelper.onPopupHideEvent(function(e,t){r.onPopupHideEvent(e,t)},r.menu.get(0),r.popup.get(0),!0),r.popup.show())})},e.prototype.hidePopup=function(){this.popup&&(this.isResize=!1,this.isExpanded=!1,this.popup.hide(),this.hostServices.setShouldDeferData(!0),this.menu.attr(c,"false"),this.icon.removeClass("chevron-up"),this.icon.addClass("chevron-down"),this.unbindPopupHideEventHandlers())},e.prototype.onPopupHideEvent=function(e,t){"resize"===e?this.isResize=!0:("focusin"===e&&(this.isResize=!1),(e=$(t)).parents(".slicer-dropdown-popup").length||e.is(this.menu)||this.menu.find(e).length||this.isResize||this.hidePopup())},e.prototype.unbindPopupHideEventHandlers=function(){this.unregisterPopupHideEvents&&(this.unregisterPopupHideEvents(),this.unregisterPopupHideEvents=void 0)},e.prototype.defaultRestatementSetting=function(){return{textSize:10,fontFamily:a.Font.Family.regular.css,fontColor:a.ColorHelper.getThemeColor(this.style,this.DefaultRestatementColorName),background:this.style.isHighContrast?a.ColorHelper.getThemeColor(this.style,a.BackgroundColorName):void 0}},a.DropdownSlicerRenderer=e}(powerbi=powerbi||{}),function(e){var t;e=(e=(e=e.visuals||(e.visuals={})).HorizontalSlicer||(e.HorizontalSlicer={})).Selectors||(e.Selectors={}),t=jsCommon.CssConstants.createClassAndSelector,e.container=t("horizontalSlicerContainer"),e.ItemsContainer=t("slicerItemsContainer"),e.NavigationArrow=t("navigationArrow"),e.LeftNavigationArrow=t("left"),e.RightNavigationArrow=t("right"),e.MultiSelectEnabled=t("isMultiSelectEnabled"),e.FlexDisplay=t("flexDisplay"),e.CanScrollRight=t("canScrollRight"),e.CanScrollLeft=t("canScrollLeft"),e.IndividualItemContainer=t("individualItemContainer"),e.ImageContainer=t("horizontalImageContainer"),e.HorizontalSlicerImage=t("horizontalSlicerImage"),e.Input=t("slicerCheckbox")}(powerbi=powerbi||{}),function(f){var l=f.visuals||(f.visuals={}),o=jsCommon.Utility,v=jsCommon.PixelConverter,y={marginRight:2,paddingLeft:8,paddingRight:8};function e(e,t){this.viewModelAdapter=t,this.textProperties={fontFamily:l.Font.Family.regular.css,fontSize:"14px"},e&&(this.horizontalSlicerLayout=e.horizontalSlicerLayout,t=e.featureSwitches,this.featureSwitches=e.featureSwitches,this.expressionBasedFormatting=t&&t.expressionBasedFormatting),this.behavior=new l.SlicerWebBehavior,this.horizontalSlicerLayout||(this.horizontalSlicerLayout=new i),this.domHelper=new l.SlicerUtil.DOMHelper,this.dataStartIndex=0,this.searchComponent=new l.SlicerSearchInput(this.featureSwitches,null==e?void 0:e.hostServices)}e.prototype.hasSlider=function(){return!1},e.prototype.getDefaultValue=function(){if(this.data&&!_.isEmpty(this.data.defaultValueByLevel))return this.data.defaultValueByLevel[0].value},e.prototype.getIdentityFields=function(){return l.SlicerUtil.DefaultValueHandler.getIdentityFields(this.dataView)},e.prototype.supportsOrientation=function(){return!0},e.prototype.getSlicerSettings=function(e){return e&&e.slicerSettings||l.DataConversion.DefaultSlicerProperties(this.style)},e.prototype.enumerateObjectInstances=function(e){var t=this.originalData,i=this.getSlicerSettings(t);return l.SlicerUtil.ObjectEnumerator.enumerateObjectInstances(e,t,i,this.dataView,this.featureSwitches)},e.prototype.getValuesCard=function(){var e=this.originalData,t=this.getSlicerSettings(e);return l.SlicerUtil.ObjectEnumerator.getValuesCard(this.hostServices,e,t,this.expressionBasedFormatting,this.featureSwitches)},e.prototype.getSlicerSettingsCardOptions=function(e,t,i,r){var o=this.originalData,n=(n=o?o.slicerSettings:void 0)||l.DataConversion.DefaultSlicerProperties(this.style);return l.SlicerUtil.ObjectEnumerator.getSlicerSettingsFormattingOptions({cardUidBuilder:e,currentSlicerSettings:n,data:o,dataView:this.dataView,hostServices:this.hostServices,orientation:t,activeMode:i,slicerModes:r,featureSwitches:this.featureSwitches})},e.prototype.getAdditionalCards=function(){var e=this.originalData,t=(t=e?e.slicerSettings:void 0)||l.DataConversion.DefaultSlicerProperties(this.style);return l.SlicerUtil.ObjectEnumerator.getAdditionalCards(this.hostServices,e,t,this.dataView)},e.prototype.onModeChange=function(e){l.SlicerUtil.clearSlicerFilter(this.hostServices,e)},e.prototype.onDataViewObjectChanged=function(e,t){e=l.SlicerUtil.getUpdatedDataViewObjects(e,t);return e},e.prototype.getRestatement=function(){return this.data&&this.data.restatement},e.prototype.onClear=function(e){l.SlicerUtil.clearFilters(this.selectionHandler,e)},e.prototype.init=function(e,t){var r=this,t=(this.element=t,this.currentViewport=e.visualInitOptions.viewport,this.hostServices=e.visualInitOptions.host),t=(this.style=e.visualInitOptions.style,this.behavior&&(this.selectionHandler=new l.SlicerSelectionHandler(t,this.behavior)),this.loadMoreData=function(){return e.loadMoreData()},document.createElement("div")),i=(t.className=l.HorizontalSlicer.Selectors.container.class,this.container=d3.select(t)),i=(this.searchComponent.create(i),this.body=i.append("div").classed(l.SlicerUtil.Selectors.Body.class+" "+l.HorizontalSlicer.Selectors.FlexDisplay.class,!0)),o={color:l.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")},n={color:l.ColorHelper.getThemeColor(this.style,"foreground")},a=(this.leftNavigationArrow=i.append("button").call(this.horizontalSlicerLayout.getNavigationArrowsClass,!0).attr("aria-label",this.hostServices.getLocalizedString("Previous_ButtonText")).attr("tabindex",-1).styles(o).on("pointerover",function(){return r.leftNavigationArrow.styles(n)}).on("pointerleave",function(){return r.leftNavigationArrow.styles(o)}),this.itemsContainer=i.append("div").classed(l.HorizontalSlicer.Selectors.ItemsContainer.class+" "+l.HorizontalSlicer.Selectors.FlexDisplay.class,!0).attr("tabindex","0").attr("role","listbox"),this.itemsContainer.node());return $(a).on("keydown",function(e){var t=e.keyCode,i=39===t||40===t;!i&&(37!==t&&38!==t)||(r.focusNextElement(i),e.stopPropagation())}),this.rightNavigationArrow=i.append("button").call(this.horizontalSlicerLayout.getNavigationArrowsClass,!1).attr("aria-label",this.hostServices.getLocalizedString("Next_ButtonText")).attr("tabindex",-1).styles(o).on("pointerover",function(){return r.rightNavigationArrow.styles(n)}).on("pointerleave",function(){return r.rightNavigationArrow.styles(o)}),this.element.get(0).appendChild(t),this.bindNavigationEvents(),this.selectionHandler},e.prototype.render=function(e){this.hasSearchableData=e.hasSearchableData;var t=this.hostServices.getLocalizedString(l.SlicerUtil.DisplayNameKeys.SelectAll),i=e.dataView;this.originalData=this.data=l.DataConversion.convert({dataView:i,localizedSelectAllText:t,selectionHandler:this.selectionHandler,hostServices:this.hostServices,style:this.style,isSlicer:e.isSlicer,featureSwitches:this.featureSwitches,slicerType:1}),this.viewModelAdapter&&(this.data=this.viewModelAdapter.applyChanges(e.viewport,this.originalData,i)),this.updateItemsContainerLabel(),this.updateStyle(this.hasSearchableData),i&&this.data&&!_.isEmpty(this.data.slicerDataPoints)?(this.dataView=i,this.currentViewport&&e.viewport&&(this.currentViewport.height!==e.viewport.height||this.currentViewport.width!==e.viewport.width)&&!this.isMaxDimensionsNeedsReCalculate()||this.calculateAndSetMaxItemDimensions(),this.currentViewport=e.viewport,this.itemsToDisplay=this.horizontalSlicerLayout.calculateNumberOfItemsToDisplay(this.element,this.totalItemWidth,this.totalItemHeight,this.getDataPointsCount()),0!==this.itemsToDisplay&&this.renderCore()):(this.itemsContainer.selectAll("*").remove(),this.itemsToDisplay=0)},e.prototype.renderCore=function(){this.horizontalSlicerLayout.renderCore&&this.horizontalSlicerLayout.renderCore(this.container);var e,t,i,r,o,n,a,s=this.data;s&&s.slicerDataPoints&&(this.normalizePosition(),e=this.getDataPointsCount(),t=this.itemsToDisplay,r=(i=this.dataStartIndex)+this.itemsToDisplay<=e-1,o=0<i,n=this.container.classed(l.HorizontalSlicer.Selectors.CanScrollRight.class)&&!r&&document.activeElement===this.rightNavigationArrow.node(),a=this.container.classed(l.HorizontalSlicer.Selectors.CanScrollLeft.class)&&!o&&document.activeElement===this.leftNavigationArrow.node(),(n||a)&&this.itemsContainer.node().focus(),this.container.classed(l.HorizontalSlicer.Selectors.CanScrollRight.class,r),this.container.classed(l.HorizontalSlicer.Selectors.CanScrollLeft.class,o),this.renderItems(s.slicerSettings),this.bindInteractivityService(),.8*e<=i+t)&&this.loadMoreData()},e.prototype.updateStyle=function(e){var t=this.data,i=t&&t.slicerSettings,e=e&&i.search.enabled;this.searchComponent.update(i,t&&t.searchKey,e,!1),i&&this.container.classed(l.HorizontalSlicer.Selectors.MultiSelectEnabled.class,!i.selection.singleSelect)},e.prototype.renderItems=function(e){var o=this,t=this.itemsToDisplay,i=this.dataStartIndex,i=this.data.slicerDataPoints.slice(i,i+t),t=this.horizontalSlicerLayout.bindData(i,this.data,this.itemsContainer),n=t.enter().append("div").classed(l.HorizontalSlicer.Selectors.IndividualItemContainer.class,!0).classed("containerBackground",!e.items.accessibilityContrastProperties).classed("containerBackgroundContrast",e.items.accessibilityContrastProperties).attr("role","option").attr("tabindex",0).each(function(e){var t=d3.select(this);e.isImage?((e=t.append("div").classed(l.HorizontalSlicer.Selectors.ImageContainer.class,!0)).append("div").classed(l.HorizontalSlicer.Selectors.Input.class,!0).append("input").attr("type","checkbox"),e.append("img").classed(l.HorizontalSlicer.Selectors.HorizontalSlicerImage.class,!0)):t.append("div").classed(l.SlicerUtil.Selectors.LabelText.class,!0).classed(l.HorizontalSlicer.Selectors.FlexDisplay.class,!0)}).merge(t),r=this;n.each(function(e){var t=d3.select(this);l.SlicerUtil.updateDisableState(t,e),t.attr("aria-label",l.SlicerUtil.getTooltipText(r.hostServices,e.tooltip)).attr("aria-setsize",-1).attr("aria-posinset",e.levelIndex||1)}),n.attr("aria-selected",function(e){return!0===e.selected}),n.order(),n.select(l.SlicerUtil.Selectors.LabelText.selector).styles({"padding-left":v.toString(y.paddingLeft),"padding-right":v.toString(y.paddingRight)}),n.styles({"margin-right":function(e,t){return o.horizontalSlicerLayout.getDataPointRightMargin(t,o.itemsToDisplay)}}),this.domHelper.setSlicerTextStyle(n,e,this.featureSwitches),t.exit().remove(),this.animationFrameId&&window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=window.requestAnimationFrame(function(){n.select("img").attr("title",function(e){return l.SlicerUtil.getTooltipText(o.hostServices,e.tooltip)}).attr("src",function(e){return e.value}),n.select(l.SlicerUtil.Selectors.LabelText.selector).attr("title",function(e){return l.SlicerUtil.getTooltipText(o.hostServices,e.tooltip)}).text(function(e){return e.value});var e=o.element.find(l.SlicerUtil.Selectors.LabelText.selector),t=e.first(),i=t.height(),r=t.width();e.each(function(e,t){f.TextMeasurementService.wordBreakOverflowingText(t,r,i)})})},e.prototype.bindInteractivityService=function(){var e,t,i,r=l.HorizontalSlicer.Selectors.IndividualItemContainer.selector;this.selectionHandler&&this.body&&(r=this.body.selectAll(r),e=this.data,!(t=this.searchComponent.input).empty()&&(i=t.node().value,_.isEmpty(i)||_.isEmpty(e.searchKey))&&t.property("value",e.searchKey),i={slicerContainer:this.container,itemsContainer:r,settings:e.slicerSettings,searchInput:t,style:this.style},this.selectionHandler.bind(e.retainedDataPoints,{behaviorOptions:i,orientation:1})),this.behavior.renderSelection()},e.prototype.normalizePosition=function(){var e=this.getDataPointsCount(),e=this.horizontalSlicerLayout.getLastStartIndex(this.itemsToDisplay,e);this.dataStartIndex=o.clampValue(this.dataStartIndex,0,e)},e.prototype.bindNavigationEvents=function(){this.registerMouseWheelScrollEvents(),this.registerMouseClickEvents()},e.prototype.registerMouseClickEvents=function(){var e=this,t=this.container.selectAll(l.HorizontalSlicer.Selectors.RightNavigationArrow.selector),i=this.container.selectAll(l.HorizontalSlicer.Selectors.LeftNavigationArrow.selector);t.on("click",function(){e.scrollRight()}),i.on("click",function(){e.scrollLeft()})},e.prototype.registerMouseWheelScrollEvents=function(){var t=this,e=this.body.node();e.addEventListener("mousewheel",function(e){t.onMouseWheel(e.wheelDelta)}),e.addEventListener("DOMMouseScroll",function(e){t.onMouseWheel(e.detail)})},e.prototype.onMouseWheel=function(e){e<0?this.scrollRight():0<e&&this.scrollLeft()},e.prototype.scrollRight=function(){var e=this.horizontalSlicerLayout.getLastStartIndex(this.itemsToDisplay,this.getDataPointsCount());this.dataStartIndex!==e&&(this.dataStartIndex+=this.horizontalSlicerLayout.getScrollSize(this.itemsToDisplay),this.dataStartIndex=Math.min(this.dataStartIndex,e),this.renderCore())},e.prototype.scrollLeft=function(){0!==this.dataStartIndex&&(this.dataStartIndex-=this.horizontalSlicerLayout.getScrollSize(this.itemsToDisplay),this.dataStartIndex=Math.max(this.dataStartIndex,0),this.renderCore())},e.prototype.getScaledTextWidth=function(e){return e/jsCommon.TextSizeDefaults.TextSizeMin*80},e.prototype.isMaxDimensionsNeedsReCalculate=function(){var e,t,i,r,o,n;return!this.lastCalculatedProperties||(e=(o=this.data.slicerSettings).general.outlineWeight,t=(o=o.slicerText).outline,i=o.outlineStyle,r=o.textSize,o=o.fontFamily,(n=this.lastCalculatedProperties).textSize!==r)||n.fontFamily!==o||n.outline!==t||n.outlineStyle!==i||n.outlineWeight!==e||n.hasImage!==this.data.hasImages},e.prototype.calculateAndSetMaxItemDimensions=function(){var e=this.data,t=this.data.slicerSettings,i=this.getDataPointsCount(),r=0,o=0,n=t.slicerText.outline,a=t.slicerText.outlineStyle,s=t.general.outlineWeight;if(0===i)o=r=0;else if(e.hasImages)o=r=100;else{var l=e.slicerDataPoints,c=Math.min(i,50),d=jQuery.extend(!0,{},this.textProperties),u=t.slicerText.textSize,p=t.slicerText.fontFamily;d.fontSize=v.fromPoint(u),d.fontFamily=p,d.text="Sample";for(var h=jsCommon.WordBreaker.getMaxWordWidth,S=f.TextMeasurementService.measureSvgTextHeight(d),g=0;g<c;g++)var m=l[g].value,m=(d.text=m,r=Math.max(r,h(m,f.TextMeasurementService.measureSvgTextWidth,d)),Math.min(2,jsCommon.WordBreaker.wordCount(m))),o=Math.max(o,S*m);r=Math.min(r,this.getScaledTextWidth(u))}i=y.paddingLeft+y.paddingRight+y.marginRight,t=this.featureSwitches.outlineDropdownToCheckboxes?a:n,t=this.domHelper.getRowsOutlineWidth(t,s),this.totalItemWidth=r+i+t,this.totalItemHeight=o+i+t,i=this.horizontalSlicerLayout.calculateTotalItemDimensions(this.totalItemWidth,this.totalItemHeight);this.totalItemWidth=i.width,this.totalItemHeight=i.height,this.lastCalculatedProperties={outline:n,outlineStyle:a,outlineWeight:s,textSize:u,fontFamily:p,hasImage:e.hasImages}},e.prototype.focusNextElement=function(e){var t,i,r=this.horizontalSlicerLayout.findNextElement(document.activeElement,e);r||(e?this.scrollRight():this.scrollLeft(),t=this.itemsContainer.node(),i=document.activeElement,t.contains(i)||(i=t),r=this.horizontalSlicerLayout.findNextElement(i,e)),r&&r.focus()},e.prototype.updateItemsContainerLabel=function(){var e;null!=(e=this.data)&&e.categorySourceName&&this.itemsContainer.attr("aria-label",this.data.categorySourceName)},e.prototype.getDataPointsCount=function(){return _.size(this.data.slicerDataPoints)},e.prototype.addWarnings=function(e){l.SlicerUtil.addWarningsToSlicerVisual(this.data.warnings,e)},l.HorizontalSlicerRenderer=e,n.prototype.bindData=function(e,t,i){return i.selectAll(l.HorizontalSlicer.Selectors.IndividualItemContainer.selector).data(e,function(e){return l.SlicerUtil.getDataPointKey(e)})},n.prototype.calculateTotalItemDimensions=function(e,t){return{width:e,height:t}},n.prototype.calculateNumberOfItemsToDisplay=function(e,t,i,r){var e=e.find(l.SlicerUtil.Selectors.Body.selector).width()-2*n.NavigationArrowWidth;return 0===t?0:(e=Math.round(e/t),o.clampValue(e,1,r))},n.prototype.findNextElement=function(e,t){return $(e).hasClass(l.HorizontalSlicer.Selectors.ItemsContainer.class)?t?e.firstElementChild:void 0:t?e.nextElementSibling:e.previousElementSibling},n.prototype.getNavigationArrowsClass=function(e,t){t?e.classed(l.HorizontalSlicer.Selectors.NavigationArrow.class,!0).classed(l.HorizontalSlicer.Selectors.LeftNavigationArrow.class,!0):e.classed(l.HorizontalSlicer.Selectors.NavigationArrow.class,!0).classed(l.HorizontalSlicer.Selectors.RightNavigationArrow.class,!0)},n.prototype.getScrollSize=function(e){return 1===e?e:e-1},n.prototype.getLastStartIndex=function(e,t){return t-e},n.prototype.getDataPointRightMargin=function(e,t){return this.isLastRowItem(e,t)?"0px":v.toString(y.marginRight)},n.prototype.isLastRowItem=function(e,t){return e===t-1},n.NavigationArrowWidth=19;var i=n;function n(){}l.HorizontalSlicerLayout=i}(powerbi=powerbi||{}),function(e){var i;function t(){}i=e.visuals||(e.visuals={}),t.prototype.bindEvents=function(e,t){this.selectionHandler=t,this.slicerSettings=e.settings,this.style=e.style,this.items=e.itemsContainer,i.SlicerWebBehavior.bindSlicerEvents(e,this.items,t,this.slicerSettings)},t.prototype.renderSelection=function(){i.SlicerWebBehavior.setSelectionOnSlicerItems(this.items,this.selectionHandler,this.style)},i.HorizontalSlicerWebBehavior=t}(powerbi=powerbi||{}),function(e){var s,l,t,a;function i(e){this.hostServices=e.hostServices,this.startInputLabel=this.hostServices.getLocalizedString("Slicer_StartLabel"),this.endInputLabel=this.hostServices.getLocalizedString("Slicer_EndLabel")}s=e.visuals||(e.visuals={}),l=e.visuals.builder,t=e.data.SQExprBuilder,a=jsCommon.StringExtensions,s.NumericSlicerOptions=e.createEnumType([{value:s.slicerMode.between,displayName:function(e){return e.get("Visual_SliderMode_Between")}},{value:s.slicerMode.before,displayName:function(e){return e.get("Visual_SliderMode_LessThanEqualLabel")}},{value:s.slicerMode.after,displayName:function(e){return e.get("Visual_SliderMode_GreaterThanEqualLabel")}},{value:s.slicerMode.basic,displayName:function(e){return e.get("Visual_SliderMode_Basic")}},{value:s.slicerMode.dropdown,displayName:function(e){return e.get("Visual_SliderMode_Dropdown")}},{value:s.slicerMode.single,displayName:function(e){return e.get("Visual_SliderMode_SingleVal")}},{value:s.slicerMode.verticalList,displayName:function(e){return e.get("Visual_SliderMode_VerticalList")}},{value:s.slicerMode.horizontalList,displayName:function(e){return e.get("Tile_Generic")}}]),i.prototype.createRange=function(e){return new(e.isSourceInteger?s.NonScaledNumericRange:s.NumericRange)(e.bounds.min,e.bounds.max,e.value.min,e.value.max)},i.prototype.areEqual=function(e,t){return e===t},i.prototype.defaultValue=function(){return 0},i.prototype.startProperty=function(){return s.slicerProps.data.numericStart},i.prototype.endProperty=function(){return s.slicerProps.data.numericEnd},i.prototype.parseSingleSliderValue=function(e,t){t=t[e];return{min:t,max:t}},i.prototype.formatValue=function(e,t){return t?t.format(e):e.toString()},i.prototype.getSliderOptions=function(e,t){return t?{min:0,max:e.dataPoints.length-1,step:1}:e.isSourceInteger?{min:e.bounds.min,max:e.bounds.max,step:1}:{min:e.bounds.min,max:e.bounds.max,step:null}},i.prototype.inputStyleProperties=function(){return{background:s.slicerProps.numericInputStyle.background,fontColor:s.slicerProps.numericInputStyle.fontColor,textSize:s.slicerProps.numericInputStyle.textSize,fontFamily:s.slicerProps.numericInputStyle.fontFamily,bold:s.slicerProps.numericInputStyle.bold,italic:s.slicerProps.numericInputStyle.italic,underline:s.slicerProps.numericInputStyle.underline}},i.prototype.parseInput=function(e,t,i){e=parseFloat(e);return!i||!$.isNumeric(e)||-1<_.indexOf(t,e)?e:this.findClosestPoint(e,t)},i.prototype.findClosestPoint=function(e,t){for(var i=_.head(t),r=Math.abs(i-e),o=1;o<t.length;o++){var n=Math.abs(t[o]-e);n<r&&(r=n,i=t[o])}return i},i.prototype.isInputValid=function(e,t,i,r){return!(!$.isNumeric(e)||0===i&&e>t.max||1===i&&e<t.min||r&&e===t.min)},i.prototype.setRange=function(e,t,i,r,o,n){e.min,e.max,null==o?(i.val(t.format(e.min)),i.attr("aria-label",a.format(this.startInputLabel,t.format(n.min),t.format(e.max))),r.val(t.format(e.max)),r.attr("aria-label",a.format(this.endInputLabel,t.format(e.min),t.format(n.max)))):0===o?(i.val(t.format(e.min)),i.attr("aria-label",a.format(this.startInputLabel,t.format(n.min),t.format(n.max)))):1===o&&(r.val(t.format(e.max)),r.attr("aria-label",a.format(this.endInputLabel,t.format(n.min),t.format(n.max))))},i.prototype.createInputElement=function(e,t){return InJs.DomFactory.textBox().attr("type","text").attr(s.RangeSlicerConstants.DisableDragAttribute,"true").addClass(s.RangeSlicerConstants.InputClass.class).appendTo(e)},i.prototype.enumerateObjectInstances=function(e,t,i){var r;if("numericInputStyle"===e.objectName&&(t&&t.inputStyle))return e=s.slicerProps.numericInputStyle,r={selector:null,objectName:"numericInputStyle",properties:{fontColor:t.inputStyle.fontColor,background:t.inputStyle.background,textSize:t.inputStyle.textSize,fontFamily:t.inputStyle.fontFamily}},i&&i.enableBIU&&(r.properties[e.bold.propertyName]=t.inputStyle.labelBold,r.properties[e.italic.propertyName]=t.inputStyle.labelItalic,r.properties[e.underline.propertyName]=t.inputStyle.labelUnderline),[r]},i.prototype.getValuesCard=function(t,e){var i=this,r=s.slicerProps.numericInputStyle,o=new l.FormattingCardBuilder(new l.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[r.fontFamily,r.textSize,r.fontColor,r.background,r.bold,r.italic,r.underline],function(e){return i.hostServices.getLocalizedString(e)}),n=(new l.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:t.inputStyle.fontFamily}).withFontSizeProperties({descriptor:r.textSize,value:t.inputStyle.textSize}),a=(e&&e.enableBIU&&n.withBold({descriptor:r.bold,value:t.inputStyle.labelBold}).withItalic({descriptor:r.italic,value:t.inputStyle.labelItalic}).withUnderline({descriptor:r.underline,value:t.inputStyle.labelUnderline}),n.build());return o.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values"),e.addCompositeSlice("fontselector","Font",a),e.addSimpleSlice("color",function(){var e={value:t.inputStyle.fontColor};return new l.ColorPickerBuilder({descriptor:r.fontColor,value:e}).build()})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:t.inputStyle.background};return new l.ColorPickerBuilder({descriptor:r.background,value:e}).build()})}),o.build()},i.prototype.getDataPointsForSingleValueRange=function(e){e=e.categorical.categories[0],e=e&&e.values||[],e=_.filter(e,function(e){return $.isNumeric(e)}),e=_.sortBy(e,function(e){return e});return _.uniq(e)},i.prototype.filterExpr=function(e){return{lower:t.double(e.min),upper:t.double(e.max)}},i.prototype.comparisonKind=function(){return{lower:2,upper:4}},s.NumericSlicer=i}(powerbi=powerbi||{}),function(l){var c,n,e,a,s,i,d,r,u,o,p,h,S,g,m,t,f,v,y,b,C,w;function x(e,t,i,r,o){this.viewModelAdapter=o,this.isRendered=!1,e&&(this.hostServices=e.hostServices,this.preventTextSelection=e.preventTextSelection,this.featureSwitches=e.featureSwitches),this.rangeSlicerRenderer=t,this.singleValue=i,this.isCategorySourceNumeric=r,this.useModernDatePicker=!this.isCategorySourceNumeric&&this.featureSwitches.useModernDatePickerSlicer}c=l.visuals||(l.visuals={}),a=l.visuals.builder,s=jsCommon.Color,i=jsCommon.CssConstants,d=c.Units.FontSize,r=jsCommon.PixelConverter,u=l.data.SQExprBuilder,o="Segoe UI,wf_segoe-ui_normal,helvetica,arial,sans-serif",p=i.createClassAndSelector("date-slicer-range"),h=i.createClassAndSelector("date-slicer"),S=i.createClassAndSelector("date-slicer-head"),g=i.createClassAndSelector("date-slicer-slider"),m=i.createClassAndSelector("date-slicer-control"),t=i.createClassAndSelector("roundHandles"),f=i.createClassAndSelector("wrap"),c.DateSlicerClass=i.createClassAndSelector("date-slicer-datepicker"),c.DateSlicerWrapperClass=i.createClassAndSelector("date-slicer-datepicker-wrapper"),v=i.createClassAndSelector("noUi-connect"),y=i.createClassAndSelector("noUi-connects"),b=i.createClassAndSelector("noUi-background"),C=i.createClassAndSelector("noUi-handle"),w="foregroundNeutralSecondary",(e=n=c.RangeSlicerConstants||(c.RangeSlicerConstants={})).InputClass=i.createClassAndSelector("date-slicer-input"),e.DisableDragAttribute="drag-resize-disabled",c.RangeSlicerSupportedModes=[c.slicerMode.after,c.slicerMode.before,c.slicerMode.between],Object.defineProperty(x.prototype,"defaultSliderMode",{get:function(){return this.singleValue?c.slicerMode.single:c.slicerMode.between},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"activeMode",{get:function(){return this.data.mode||this.defaultSliderMode},enumerable:!1,configurable:!0}),x.prototype.init=function(e,t){this.host=t,this.style=e.visualInitOptions.style,this.featureSwitches=e.visualInitOptions.featureSwitches},x.prototype.onModeChange=function(e){-1<_.indexOf(c.RangeSlicerSupportedModes,e)?this.data&&this.updateMode(e):c.SlicerUtil.clearSlicerFilter(this.hostServices,e)},x.prototype.onDataViewObjectChanged=function(e,t){var i;if(0===t&&(1===e.length&&e[0].objectName===c.slicerProps.data.mode.objectName&&e[0].propertyName===c.slicerProps.data.mode.propertyName))return i=e[0].propertyValue,-1<_.indexOf(c.RangeSlicerSupportedModes,i)?this.buildUpdatedPropertySaveObjects(i):c.SlicerUtil.getUpdatedDataViewObjects(e,t);return e},x.prototype.buildUpdatedPropertySaveObjects=function(e){var t=[],i=(this.updateRangeSlicerState(e),this.buildRangeSlicerProperties()),r=(this.data.properties.filter=i.filter,this.data.properties.bounds=i.bounds,this.createFilter(i,e,this.data.state,this.data.identity)),r={objectName:c.slicerProps.general.filter.objectName,propertyName:c.slicerProps.general.filter.propertyName,propertyValue:r,propertyType:{filter:{}}},r=(t.push(r),this.isCategorySourceNumeric?{numeric:!0}:{dateTime:!0}),o=null,o=(1&this.data.state&&null!==i.start&&(o=i.start),{objectName:this.rangeSlicerRenderer.startProperty().objectName,propertyName:this.rangeSlicerRenderer.startProperty().propertyName,propertyValue:o,propertyType:r}),o=(t.push(o),null),i=(2&this.data.state&&null!==i.end&&(o=i.end),{objectName:this.rangeSlicerRenderer.endProperty().objectName,propertyName:this.rangeSlicerRenderer.endProperty().propertyName,propertyValue:o,propertyType:r}),o=(t.push(i),{objectName:c.slicerProps.data.mode.objectName,propertyName:c.slicerProps.data.mode.propertyName,propertyValue:e,propertyType:{enumeration:c.slicerMode.type}});return t.push(o),t},x.prototype.buildRangeSlicerProperties=function(){var e={min:this.data.value.min,max:this.data.value.max},t={min:this.data.bounds.min,max:this.data.bounds.max};return{start:1&this.data.state?this.data.value.min:null,end:2&this.data.state?this.data.value.max:null,mode:this.data.mode,filter:e,bounds:t}},x.prototype.onClear=function(){var e;this.data&&this.data.initialValue&&(this.data.value=this.data.initialValue,this.data.state=0,this.updateProperties(),e=this.hostServices.getLocalizedString("Slicer_ClearSelectionsCleared"),this.hostServices.alertWithDebounce("announce-clear-selection",e))},x.prototype.render=function(e){_.isEmpty(e.dataView)?this.hostServices.setWarnings([new c.DateSlicerNoDataWarning]):(this.dataView=e.dataView,this.reader=l.data.createDataViewCategoricalReaderAdvanced(this.dataView),this.originalData=this.data=this.converter(this.reader,e),this.isMetaColumnsValid(this.reader)&&(this.isRendered&&this.enableSlicer(),this.viewModelAdapter&&(this.data=this.viewModelAdapter.applyChanges(e.viewport,this.originalData,this.dataView)),this.isRendered||this.initControls(),this.rangeSlicerRenderer.setRange(this.data.value,this.data.formatter,this.start,this.end,null,this.data.bounds),this.range=this.rangeSlicerRenderer.createRange(this.data),this.updateInputControls(),this.updateSlider(this.activeMode),this.updateProperties(),this.isDataColumnsValid(this.reader))||(this.hostServices.setWarnings([new c.DateSlicerNoDataWarning]),this.isRendered&&this.disableSlicer()))},x.prototype.hasSlider=function(){return!!this.data&&this.data.sliderSettings.show},x.prototype.supportsOrientation=function(){return!1},x.prototype.enumerateObjectInstances=function(e){var t=this.originalData;return"date"===e.objectName||"numericInputStyle"===e.objectName?this.rangeSlicerRenderer.enumerateObjectInstances(e,t,this.featureSwitches):"slider"===e.objectName&&t?[{selector:null,objectName:"slider",properties:{show:t.sliderSettings.show,color:t.sliderSettings.color},propertyInstanceKind:{color:this.featureSwitches.expressionBasedFormatting?3:1}}]:void 0},x.prototype.getSlicerSettingsCardOptions=function(e,t,i,r){return c.SlicerUtil.ObjectEnumerator.getSlicerSettingsFormattingOptions({cardUidBuilder:e,currentSlicerSettings:void 0,data:void 0,dataView:this.dataView,hostServices:this.hostServices,orientation:t,activeMode:i,slicerModes:r,featureSwitches:this.featureSwitches})},x.prototype.getValuesCard=function(){var e=this.originalData;if(e)return this.rangeSlicerRenderer.getValuesCard(e,this.featureSwitches)},x.prototype.getAdditionalCards=function(){var e,t,i,r=this,o=this.originalData;if(o)return i=[(t=c.slicerProps.slider).show,t.color,t.handleFillColor,t.handleBorderColor,t.secondaryLineColor],(i=new a.FormattingCardBuilder(new a.FormattingCardUidBuilder("slider"),"Slicer_Slider",i,function(e){return r.hostServices.getLocalizedString(e)})).addTopLevelToggle("show",function(){return new c.builder.ToggleSwitchBuilder({descriptor:t.show,value:o.sliderSettings.show}).build()}),null!=(e=this.featureSwitches)&&e.slicerSliderColors?i.addGroup("handles",function(e){e.withDisplayName("Slicer_Handles"),r.data.sliderSettings.drawRoundSliderHandles?e.addSimpleSlice("fill",function(){var e={value:o.sliderSettings.handleFillColor};return new a.ColorPickerBuilder({descriptor:t.handleFillColor,value:e}).build()}).addSimpleSlice("border",function(){var e={value:o.sliderSettings.handleBorderColor};return new a.ColorPickerBuilder({descriptor:t.handleBorderColor,value:e}).build()}):e.addSimpleSlice("color",function(){var e={value:o.sliderSettings.handleBorderColor};return new a.ColorPickerBuilder({descriptor:t.handleBorderColor,value:e}).build()},function(e){return e.withCustomDisplayName("Generic_Color")})}).addGroup("primaryLine",function(e){e.withDisplayName("Primary_Line").addSimpleSlice("primaryLineColor",function(){var e={value:o.sliderSettings.primaryLineColor};return new a.ColorPickerBuilder({descriptor:t.color,value:e}).build()},function(e){return e.withCustomDisplayName("Visual_LegendTitleColor")})}).addGroup("secondaryLine",function(e){e.withDisplayName("Visual_Secondary_Line").addSimpleSlice("secondaryLineColor",function(){var e={value:o.sliderSettings.secondaryLineColor};return new a.ColorPickerBuilder({descriptor:t.secondaryLineColor,value:e}).build()})}):i.addGroup("colors",function(e){e.withDisplayName("Generic_Color").addSimpleSlice("color",function(){var e={value:o.sliderSettings.color};return new a.ColorPickerBuilder({descriptor:t.color,value:e}).build()})}),[i.build()]},x.prototype.isDataColumnsValid=function(e){if(this.singleValue)return 0<e.columns.getCategoryCount();e=e.columns.getMetadataColumns(c.slicerRoles.value);if(!_.isEmpty(e)){e=e[0];if(e.aggregates&&null!=e.aggregates.min&&null!=e.aggregates.max)return!0}return!1},x.prototype.isMetaColumnsValid=function(e){e=e.columns.getMetadataColumns(c.slicerRoles.value);return!_.isEmpty(e)},x.prototype.converter=function(e,t){var i={state:0,mode:null,formatter:null,identity:null,value:null,initialValue:null,bounds:null,filter:null,properties:{filter:null},sliderSettings:(i=this.style,{color:c.ColorHelper.getThemeColor(i,w),show:!0,drawRoundSliderHandles:!1,minSliderVisibilityHeight:0,minSliderVisibilityWidth:150,handleFillColor:c.ColorHelper.getThemeColor(i,"background"),handleBorderColor:c.ColorHelper.getThemeColor(i,w),primaryLineColor:c.ColorHelper.getThemeColor(i,w),secondaryLineColor:c.ColorHelper.getThemeColor(i,"foregroundNeutralLight")}),inputStyle:(i=this.style,{textSize:9,fontFamily:c.Font.Family.regular.css,fontColor:c.ColorHelper.getThemeColor(i,"foregroundDark"),background:null,labelBold:!1,labelItalic:!1,labelUnderline:!1}),dataPoints:null,wrapRangeBoxes:!1,isSourceInteger:!1,hideDatePickerButton:!0},r=e.columns.getMetadataColumns(c.slicerRoles.value)[0],o=c.valueFormatter.getFormatString(r,c.slicerProps.general.formatString),o=(i.isSourceInteger=!0===r.type.integer,i.formatter=c.valueFormatter.createDefaultFormatter(o),i.identity=r.expr,this.rangeSlicerRenderer.defaultValue()),n=this.rangeSlicerRenderer.defaultValue(),r=(this.singleValue?(i.dataPoints=this.rangeSlicerRenderer.getDataPointsForSingleValueRange(this.dataView),0<i.dataPoints.length&&(o=i.dataPoints[0],n=i.dataPoints[i.dataPoints.length-1])):(null!=(r=r.aggregates).min&&(o=r.min),null!=r.max&&(n=r.max)),i.value={min:o,max:n},i.initialValue={min:o,max:n},i.bounds={min:i.value.min,max:i.value.max},e.objects.getStaticObjects()),e=(r?(i.filter=l.DataViewObjects.getValue(r,c.slicerProps.general.filter),i.properties.start=i.filter?l.DataViewObjects.getValue(r,this.rangeSlicerRenderer.startProperty(),null):null,i.properties.end=i.filter?l.DataViewObjects.getValue(r,this.rangeSlicerRenderer.endProperty(),null):null,i.properties.mode=l.DataViewObjects.getValue(r,c.slicerProps.data.mode,null),i.hideDatePickerButton=l.DataViewObjects.getValue(r,c.slicerProps.date.hideDatePickerButton,!0),o=this.rangeSlicerRenderer.inputStyleProperties(),n=c.ColorHelper.create(this.style),e=this.rangeSlicerRenderer instanceof c.NumericSlicer?l.DataViewObjects.getObject(r,"numericInputStyle"):l.DataViewObjects.getObject(r,"date"),e=c.FontProperties.createFromObjectOrStyle(e,{color:"fontColor",family:"fontFamily",size:"textSize"},n,this.style,"foregroundDark","smallLabel",{color:i.inputStyle.fontColor,family:i.inputStyle.fontFamily,size:d.createFromPt(i.inputStyle.textSize)}),i.inputStyle.fontColor=e.color,i.inputStyle.fontFamily=e.family,i.inputStyle.textSize=e.size.pt,i.inputStyle.background=n.getColorForPropertyWithDefaultColor(r,o.background,i.inputStyle.background),i.inputStyle.labelBold=l.DataViewObjects.getValue(r,o.bold,i.inputStyle.labelBold),i.inputStyle.labelItalic=l.DataViewObjects.getValue(r,o.italic,i.inputStyle.labelItalic),i.inputStyle.labelUnderline=l.DataViewObjects.getValue(r,o.underline,i.inputStyle.labelUnderline),i.sliderSettings.color=n.getColorForPropertyWithDefaultColor(r,c.slicerProps.slider.color,i.sliderSettings.color),i.sliderSettings.show=l.DataViewObjects.getValue(r,c.slicerProps.slider.show,i.sliderSettings.show),null!=(e=this.featureSwitches)&&e.slicerSliderColors&&(i.sliderSettings.handleFillColor=n.getColorForPropertyWithDefaultColor(r,c.slicerProps.slider.handleFillColor,i.sliderSettings.handleFillColor),i.sliderSettings.primaryLineColor=n.getColorForPropertyWithDefaultColor(r,c.slicerProps.slider.color,i.sliderSettings.color),i.sliderSettings.handleBorderColor=n.getColorForPropertyWithDefaultColor(r,c.slicerProps.slider.handleBorderColor,i.sliderSettings.primaryLineColor),i.sliderSettings.secondaryLineColor=n.getColorForPropertyWithDefaultColor(r,c.slicerProps.slider.secondaryLineColor,i.sliderSettings.secondaryLineColor)),null!==i.properties.start&&(i.state|=1,i.value.min=i.properties.start,i.properties.start<i.bounds.min)&&(i.bounds.min=i.properties.start),null!==i.properties.end&&(i.state=i.state|=2,i.value.max=i.properties.end,i.properties.end>i.bounds.max)&&(i.bounds.max=i.properties.end),i.value.min>i.bounds.max&&(i.value.max=i.bounds.max=i.value.min),i.value.max<i.bounds.min&&(i.value.min=i.bounds.min=i.value.max),null!=i.properties.mode&&(i.mode=i.properties.mode),i.filter&&(i.properties.filter={min:i.value.min,max:i.value.max})):(i.state=0,i.properties.start=null,i.properties.end=null,i.properties.mode=null),s.parseColorString(null!=(o=this.featureSwitches)&&o.slicerSliderColors?i.sliderSettings.handleBorderColor:i.sliderSettings.color));return i.sliderSettings.activeColor=s.calculateHighlightColor(e,.5,.2),i.sliderSettings.hoverColor=s.hexString(s.darken(e,100)),i.sliderSettings.label=t.restatement,i.properties.bounds={min:i.bounds.min,max:i.bounds.max},i},x.prototype.initControls=function(){this.isRendered=!0,this.createHtmlControls(),this.updateMode(this.data.mode)},x.prototype.createHtmlControls=function(){var t=this,e=(this.container=InJs.DomFactory.div().addClass(h.class).appendTo(this.host),this.container.on("keyup keydown",function(e){9!==e.keyCode&&27!==e.keyCode&&e.stopPropagation()}),InJs.DomFactory.div().addClass(S.class).css(this.getFontStyles()).appendTo(this.container)),e=InJs.DomFactory.div().addClass(p.class).appendTo(e);this.startContainer=InJs.DomFactory.div().addClass(m.class).appendTo(e),this.endContainer=InJs.DomFactory.div().addClass(m.class).appendTo(e),this.useModernDatePicker?(this.data.value.min instanceof Date,this.data.value.max instanceof Date,this.data.bounds.min instanceof Date,this.data.bounds.max instanceof Date,this.startComponentRef=this.hostServices.getUIComponentFactory().createDatePicker(this.startContainer.get(0),this.data.value.min,function(e){null!==e&&t.onRangeChange(0)},jsCommon.Utility.generateGuid(),this.data.bounds.min,this.data.bounds.max,this.data.hideDatePickerButton),this.endComponentRef=this.hostServices.getUIComponentFactory().createDatePicker(this.endContainer.get(0),this.data.value.max,function(e){null!==e&&t.onRangeChange(1)},jsCommon.Utility.generateGuid(),this.data.bounds.min,this.data.bounds.max,this.data.hideDatePickerButton),this.start=this.startComponentRef.datePickerElement.find(":input").first(),this.end=this.endComponentRef.datePickerElement.find(":input").first(),this.startButton=this.startComponentRef.datePickerElement.find(":button"),this.endButton=this.endComponentRef.datePickerElement.find(":button"),this.data.hideDatePickerButton?(this.start.addClass(n.InputClass.class),this.end.addClass(n.InputClass.class)):(this.start.addClass(c.DateSlicerClass.class),this.startComponentRef.datePickerElement.addClass(c.DateSlicerWrapperClass.class),this.end.addClass(c.DateSlicerClass.class),this.endComponentRef.datePickerElement.addClass(c.DateSlicerWrapperClass.class))):(this.start=this.rangeSlicerRenderer.createInputElement(this.startContainer,0),this.end=this.rangeSlicerRenderer.createInputElement(this.endContainer,1)),this.rangeSlicerRenderer.addAriaDescription&&(this.rangeSlicerRenderer.addAriaDescription(this.start),this.rangeSlicerRenderer.addAriaDescription(this.end)),c.SlicerUtil.enableHover()&&(e=c.SlicerUtil.Selectors.EnableHover.class,this.start.addClass(e),this.end.addClass(e)),this.bindEventHandlersToInputElements(),this.sliderContainer=InJs.DomFactory.div().addClass(g.class).appendTo(this.container)},x.prototype.bindEventHandlersToInputElements=function(){var t=this;this.start.on("click touchend contextmenu",function(e){e.stopPropagation()}),this.end.on("click touchend contextmenu",function(e){e.stopPropagation()}),this.start.on("change",function(e){t.onRangeChange(0)}),this.start.on("keyup",function(e){13===e.which&&(t.start.blur(),t.start.focus())}),this.start.on("focus",function(e){t.singleValue&&!t.data.filter||(t.useModernDatePicker?(t.data.value.min instanceof Date,t.startComponentRef.writeValue(t.data.value.min)):t.start.val(t.rangeSlicerRenderer.formatValue(t.data.value.min,null))),t.preventTextSelection||t.start.select()}),this.start.on("blur",function(e){t.singleValue&&!t.data.filter||(t.useModernDatePicker?(t.data.value.min instanceof Date,t.startComponentRef.writeValue(t.data.value.min)):t.start.val(t.rangeSlicerRenderer.formatValue(t.data.value.min,t.data.formatter)))}),this.end.on("change",function(e){t.onRangeChange(1)}),this.end.on("keyup",function(e){13===e.which&&(t.end.blur(),t.end.focus())}),this.end.on("focus",function(e){t.useModernDatePicker?(t.data.value.max instanceof Date,t.endComponentRef.writeValue(t.data.value.max)):t.end.val(t.rangeSlicerRenderer.formatValue(t.data.value.max,null)),t.preventTextSelection||t.end.select()}),this.end.on("blur",function(e){t.useModernDatePicker?(t.data.value.max instanceof Date,t.endComponentRef.writeValue(t.data.value.max)):t.end.val(t.rangeSlicerRenderer.formatValue(t.data.value.max,t.data.formatter))})},x.prototype.onRangeChange=function(e){var t=(0===e?this.start:this.end).val(),t=this.rangeSlicerRenderer.parseInput(t,this.data.dataPoints,this.singleValue);this.rangeSlicerRenderer.isInputValid(t,this.data.value,e,this.singleValue)?this.updateRange({min:t,max:t},e):(this.rangeSlicerRenderer.setRange(this.data.value,this.data.formatter,this.start,this.end,e,this.data.bounds),this.useModernDatePicker&&(this.data.value.min instanceof Date,this.data.value.max instanceof Date,this.startComponentRef.writeValue(this.data.value.min),this.endComponentRef.writeValue(this.data.value.max)))},x.prototype.onDestroy=function(){this.rangeSlicerRenderer.onDestroy&&this.rangeSlicerRenderer.onDestroy()},x.prototype.getFontStyles=function(){var e={};return e["font-size"]=r.fromPointToPixel(9),e["font-family"]=o,e["font-weight"]=c.DataLabelRenderer.defaultFontProperties.weight,e},x.prototype.updateSliderControl=function(){var e,r=this,t=this.createSliderOptions(),o=(this.slider?(this.slider.updateOptions(t),e=[],this.singleValue?(i=_.indexOf(this.data.dataPoints,this.data.value.min),e.push(i)):(i=this.range.getScaledValue(),this.activeMode!==c.slicerMode.before&&e.push(i.min),this.activeMode!==c.slicerMode.after&&e.push(i.max)),this.slider.set(e)):(this.sliderOptions=t,this.slider&&(this.slider.destroy(),this.sliderContainer.empty()),this.sliderElement=InJs.DomFactory.div().attr(n.DisableDragAttribute,"true").attr("rtl",("rtl"===document.dir).toString()).appendTo(this.sliderContainer),noUiSlider.create(this.sliderElement.get(0),this.sliderOptions),this.slider=this.sliderElement.get(0).noUiSlider,this.slider.on("slide",function(e,t,i){window.requestAnimationFrame(function(){var e=r.parseSliderValue(i);r.rangeSlicerRenderer.setRange(e,r.data.formatter,r.start,r.end,null,r.data.bounds),r.useModernDatePicker&&(e.min instanceof Date,e.max instanceof Date,r.startComponentRef.writeValue(e.min),r.endComponentRef.writeValue(e.max))})}),this.slider.on("change",_.debounce(function(e,t,i){i=r.parseSliderValue(i),t=r.getChangeType(r.activeMode,t);r.updateRange(i,t)},100)),this.applyHandlesHoverState(this.sliderContainer.find(C.selector))),this.updateAccessibilityAttributes(this.data,this.sliderContainer.find(C.selector),this.activeMode),null!=(i=this.featureSwitches)&&i.slicerSliderColors?this.data.sliderSettings.handleBorderColor:this.data.sliderSettings.color),t=null!=(e=this.featureSwitches)&&e.slicerSliderColors?this.data.sliderSettings.primaryLineColor:this.data.sliderSettings.color,i=(this.sliderContainer.find(v.selector).css({"background-color":t}),this.sliderContainer.find(y.selector).css({"background-color":this.data.sliderSettings.secondaryLineColor}),this.sliderContainer.find(C.selector).each(function(e,t){var t=$(t),i=t.is(":hover")?r.data.sliderSettings.activeColor:o;r.setSliderHandleColor(t,i)}),this.sliderContainer.find(v.selector).addClass("backgroundToSelectedBackgroundColor"),this.sliderContainer.find(b.selector).addClass("backgroundToForegroundColor"),this.sliderContainer.find(C.selector));this.data.sliderSettings.drawRoundSliderHandles?(i.addClass("backgroundToSolidBackgroundColor"),i.addClass("highContrastSelectedBorderColor")):i.addClass("backgroundToSelectedBackgroundColor")},x.prototype.setSliderHandleColor=function(e,t){var i={"border-color":"","background-color":""},r=(this.data.sliderSettings.drawRoundSliderHandles&&(i["background-color"]=this.data.sliderSettings.handleFillColor),this.data.sliderSettings.drawRoundSliderHandles?"border-color":"background-color");i[r]=t,e.css(i)},x.prototype.disableSlicer=function(){this.disableSlider(),1&this.data.state||(this.useModernDatePicker?this.startComponentRef.writeValue():this.start.val(""),this.start.prop("disabled",!0),this.disableInput(this.start,this.data.inputStyle.fontColor)),2&this.data.state||(this.useModernDatePicker?this.endComponentRef.writeValue():this.end.val(""),this.end.prop("disabled",!0),this.disableInput(this.end,this.data.inputStyle.fontColor)),this.data.bounds.min=this.data.bounds.max=null,this.updateProperties()},x.prototype.disableSlider=function(){this.sliderElement&&this.sliderElement.get(0).setAttribute("disabled","true"),this.sliderContainer.css("opacity","0.1"),this.slider&&this.slider.set([0,100])},x.prototype.enableSlicer=function(){this.sliderElement&&!this.rangeSlicerRenderer.areEqual(this.data.bounds.min,this.data.bounds.max)&&this.sliderElement.get(0).removeAttribute("disabled"),this.sliderContainer.css("opacity","1.0"),this.start.prop("disabled",!1),this.end.prop("disabled",!1)},x.prototype.applyHandlesHoverState=function(e){var t,i=!1,r=!1,o=this,n=null==(t=this.featureSwitches)?void 0:t.slicerSliderColors;e.on("mouseenter",function(){r=!0,i||o.setSliderHandleColor($(this),o.data.sliderSettings.hoverColor)}).on("mouseleave",function(){r=!1,i||o.setSliderHandleColor($(this),n?o.data.sliderSettings.handleBorderColor:o.data.sliderSettings.color)}).on("mousedown touchstart",function(){var e=this,t=(i=!0,o.setSliderHandleColor($(this),o.data.sliderSettings.activeColor),function(){$(document).off("mouseup touchEnd",t),i&&(i=!1,o.setSliderHandleColor($(e),n?o.data.sliderSettings.handleBorderColor:o.data.sliderSettings.color))});$(document).on("mouseup touchEnd",t)}).on("mouseup touchend",function(){i=!1,o.setSliderHandleColor($(this),r?o.data.sliderSettings.hoverColor:n?o.data.sliderSettings.handleBorderColor:o.data.sliderSettings.color)})},x.prototype.updateInputControls=function(){this.singleValue&&!this.data.filter&&(this.useModernDatePicker?this.startComponentRef.writeValue():this.start.val(""));var e={fontSize:r.fromPoint(this.data.inputStyle.textSize),fontFamily:this.data.inputStyle.fontFamily||o,fontWeight:this.data.inputStyle.labelBold?i.boldValue:i.normalValue,fontStyle:this.data.inputStyle.labelItalic?i.italicValue:i.normalValue},t={"font-size":e.fontSize,"font-family":e.fontFamily,"font-weight":e.fontWeight,"font-style":e.fontStyle,"text-decoration":this.data.inputStyle.labelUnderline?i.underlineValue:i.noneValue},t=(this.start.parent().css(t),this.end.parent().css(t),{color:this.data.inputStyle.fontColor,"background-color":this.data.inputStyle.background||"","text-decoration":this.data.inputStyle.labelUnderline?i.underlineValue:i.noneValue});this.start.css(t),this.end.css(t),this.startButton&&this.startButton.css(t),this.endButton&&this.endButton.css(t),this.useModernDatePicker&&(this.data.value.min instanceof Date,this.data.value.max instanceof Date,this.data.bounds.min instanceof Date,this.data.bounds.max instanceof Date,this.startComponentRef.updateDateRange(this.data.bounds.min,this.data.bounds.max),this.endComponentRef.updateDateRange(this.data.bounds.min,this.data.bounds.max),this.startComponentRef.writeValue(this.data.value.min),this.endComponentRef.writeValue(this.data.value.max)),this.setInputWidth(this.start,e),this.setInputWidth(this.end,e)},x.prototype.setInputWidth=function(e,t){e.css("width","");var i,r=e.val();r&&(r=r.toString(),t=l.TextMeasurementService.measureSvgTextWidth(t,r),r=parseFloat(e.css("padding-left"))+parseFloat(e.css("padding-right")),i=2*parseFloat(e.css("border-width")),t=Math.ceil(t+r+i),e.outerWidth(!1)<t)&&e.css({width:t})},x.prototype.disableInput=function(e,t){t=s.parseColorString(t);t.A=.3,e.css({color:s.rgbString(t)})},x.prototype.createSliderOptions=function(){var e,t,i=this.rangeSlicerRenderer.getSliderOptions(this.data,this.singleValue),r=this.range.getScaledValue();switch(this.activeMode){case c.slicerMode.before:e=r.max,t=[!0,!1];break;case c.slicerMode.after:e=r.min,t=[!1,!0];break;case c.slicerMode.between:e=[r.min,r.max],t=!0;break;case c.slicerMode.single:e=_.indexOf(this.data.dataPoints,this.data.value.min),t=!1}return{connect:t,behaviour:"tap",range:{min:i.min===i.max?0:i.min,max:i.min===i.max?1:i.max},start:e,step:i.step}},x.prototype.parseSliderValue=function(e){if((this.data.isSourceInteger||this.singleValue)&&(e=_.map(e,function(e){return Math.round(e)})),this.singleValue)return this.rangeSlicerRenderer.parseSingleSliderValue(e[0],this.data.dataPoints);var t=this.range.getScaledValue();switch(this.activeMode){case c.slicerMode.before:t.max=e[0];break;case c.slicerMode.after:t.min=e[0];break;case c.slicerMode.between:t.min=e[0],t.max=e[1]}return this.range.setScaledValue(t),this.range.getValue()},x.prototype.updateSlider=function(e){e===c.slicerMode.after?(this.end.prop("disabled",!0),this.disableInput(this.end,this.data.inputStyle.fontColor),this.start.prop("disabled",!1)):e===c.slicerMode.before?(this.end.prop("disabled",!1),this.start.prop("disabled",!0),this.disableInput(this.start,this.data.inputStyle.fontColor)):(this.end.prop("disabled",!1),this.start.prop("disabled",!1)),e===c.slicerMode.single?this.endContainer.hide():this.endContainer.show(),!this.data.sliderSettings.show||this.shouldHideSmallSlider()?this.sliderContainer.hide():(this.sliderContainer.show(),this.updateSliderControl()),this.sliderContainer.toggleClass(t.class,!!this.data.sliderSettings.drawRoundSliderHandles),this.container.find(S.selector).toggleClass(f.class,!!this.data.wrapRangeBoxes),this.rangeSlicerRenderer.areEqual(this.data.bounds.min,this.data.bounds.max)&&this.disableSlider()},x.prototype.updateMode=function(e){this.updateRangeSlicerState(e),this.updateProperties()},x.prototype.updateProperties=function(){var e=this.buildRangeSlicerProperties();this.requireToUpdate(e)&&(this.data.properties.filter=e.filter,this.data.properties.bounds=e.bounds,e=this.createPersistProperties(e,this.data.identity,this.data.state),this.hostServices.persistProperties(e),this.hostServices.onSelect({type:0,visualObjects:[]}))},x.prototype.updateRangeSlicerState=function(e){var t=this.data.mode;null==e?e=this.defaultSliderMode:this.data.mode=e,e===c.slicerMode.before?(t===c.slicerMode.after&&1&this.data.state&&(this.data.value.max=this.data.value.min,this.data.value.min=this.data.bounds.min,this.data.state=2),this.data.state&=-2):e===c.slicerMode.after&&(t===c.slicerMode.before&&2&this.data.state&&(this.data.value.min=this.data.value.max,this.data.state=1),this.data.state&=-3)},x.prototype.getChangeType=function(e,t){var i=null;switch(e){case c.slicerMode.after:case c.slicerMode.single:i=0;break;case c.slicerMode.before:i=1;break;default:i=0===t?0:1}return i},x.prototype.createPersistProperties=function(e,t,i){var r=null==e.mode?this.defaultSliderMode:e.mode,r=this.createFilter(e,r,i,t),t={merge:[{objectName:"general",selector:void 0,properties:{}}],replace:[{objectName:"data",selector:void 0,properties:{}}],remove:[{objectName:"data",selector:void 0,properties:{}},{objectName:"general",selector:void 0,properties:{}}]};return null!==r?t.merge[0].properties[c.slicerProps.general.filter.propertyName]=r:t.remove[1].properties[c.slicerProps.general.filter.propertyName]=!0,1&i&&null!==e.start?t.replace[0].properties[this.rangeSlicerRenderer.startProperty().propertyName]=e.start:null==e.start&&(t.remove[0].properties[this.rangeSlicerRenderer.startProperty().propertyName]=!0),2&i&&null!==e.end?t.replace[0].properties[this.rangeSlicerRenderer.endProperty().propertyName]=e.end:null==e.end&&(t.remove[0].properties[this.rangeSlicerRenderer.endProperty().propertyName]=!0),null!=e.mode&&(t.replace[0].properties[c.slicerProps.data.mode.propertyName]=e.mode),t},x.prototype.updateRange=function(e,t){null==t?(this.data.value.min=e.min,this.data.value.max=e.max):0===t?(this.data.value.min=e.min,null===this.data.bounds.min||this.singleValue||!this.rangeSlicerRenderer.areEqual(this.data.value.min,this.data.bounds.min)||this.useModernDatePicker?this.data.state|=1:this.data.state&=-2):1===t&&(this.data.value.max=e.max,null!==this.data.bounds.max&&this.rangeSlicerRenderer.areEqual(this.data.value.max,this.data.bounds.max)&&!this.useModernDatePicker?this.data.state&=-3:this.data.state|=2),this.updateProperties()},x.prototype.createFilter=function(e,t,i,r){var o,n,a=null,e=e.filter,s=null,e=this.rangeSlicerRenderer.filterExpr(e);return t===c.slicerMode.single?a=1&i?u.compare(0,r,e.lower):null:(t=this.rangeSlicerRenderer.comparisonKind(),1&i&&2&i?(o=u.compare(t.lower,r,e.lower),n=u.compare(t.upper,r,e.upper),a=u.and(o,n)):1&i?a=u.compare(t.lower,r,e.lower):2&i&&(a=u.compare(t.upper,r,e.upper))),s=null!==a?l.data.SemanticFilter.fromSQExpr(a):s},x.prototype.requireToUpdate=function(e){return!(null===this.data.properties.filter&&0===this.data.state&&(e.mode===this.data.properties.mode||e.mode===this.defaultSliderMode&&null===this.data.properties.mode)||null!=this.data.properties.filter&&e.mode===this.data.properties.mode&&this.rangeSlicerRenderer.areEqual(e.start,this.data.properties.start)&&this.rangeSlicerRenderer.areEqual(e.end,this.data.properties.end)&&this.rangeSlicerRenderer.areEqual(e.filter.min,this.data.properties.filter.min)&&this.rangeSlicerRenderer.areEqual(e.filter.max,this.data.properties.filter.max)&&this.rangeSlicerRenderer.areEqual(e.bounds.min,this.data.properties.bounds.min)&&this.rangeSlicerRenderer.areEqual(e.bounds.max,this.data.properties.bounds.max))},x.prototype.shouldHideSmallSlider=function(){var e=this.data.sliderSettings;if((this.container.width()||0)<=e.minSliderVisibilityWidth)return!0;if(0<e.minSliderVisibilityHeight){var t=this.endContainer.position().top+this.endContainer.outerHeight();if(this.container.parent().outerHeight()-t<e.minSliderVisibilityHeight)return!0}return!1},x.prototype.updateAccessibilityAttributes=function(e,t,i){var r,o=e.value.min,n=e.value.max;switch(i){case c.slicerMode.before:r=this.hostServices.getLocalizedString("End_Date")+" "+this.getRangeText(e.bounds.min,e.bounds.max),this.addAccessibilityAttributesToSliderHandle(t,r,n);break;case c.slicerMode.after:r=this.hostServices.getLocalizedString("Start_Date")+" "+this.getRangeText(e.bounds.min,e.bounds.max),this.addAccessibilityAttributesToSliderHandle(t,r,o);break;case c.slicerMode.between:r=this.hostServices.getLocalizedString("Start_Date")+" "+this.getRangeText(e.bounds.min,e.value.max),this.addAccessibilityAttributesToSliderHandle(t.first(),r,o),r=this.hostServices.getLocalizedString("End_Date")+" "+this.getRangeText(e.value.min,e.bounds.max),this.addAccessibilityAttributesToSliderHandle(t.last(),r,n)}t.attr("aria-label",e.sliderSettings.label)},x.prototype.addAccessibilityAttributesToSliderHandle=function(e,t,i){e.attr("aria-valuetext",this.rangeSlicerRenderer.formatValue(i,this.data.formatter)).attr("aria-description",t)},x.prototype.getRangeText=function(e,t){return this.isCategorySourceNumeric?l.formattingService.format(this.hostServices.getLocalizedString("Slicer_Range_Hint"),[e,t]):l.formattingService.format(this.hostServices.getLocalizedString("Slicer_Range_Hint"),[l.formattingService.formatValue(e,"d"),l.formattingService.formatValue(t,"d")])},c.RangeSlicer=x}(powerbi=powerbi||{}),function(n){var a,s,i,r,t,o,l,c,d,u;function p(e,t){this.isRendered=!1,this.hostServices=e.hostServices,this.relativeSlicerComponent=a.RelativeSlicerUtil.relativeUnitSlicerFactory(t)}a=n.visuals||(n.visuals={}),s=a.Units.FontSize,i=n.visuals.controls.SelectMenu,r=n.data.RelativeDateRangeHelper,t=n.data.RelativeDateFilterPattern,o=n.data.SemanticFilter,l=jsCommon.PixelConverter,c=jsCommon.CssConstants,d="slicer-select-menu",u=".ui-selectmenu-button",p.prototype.init=function(e,t){this.host=t,this.isRendered=!1,this.style=e.visualInitOptions.style,this.eventsHelper=new a.SlicerUtil.EventsHelper},p.prototype.onDestroy=function(){this.unregisterSelectMenuCloseEvents&&this.unregisterSelectMenuCloseEvents(),this.rangeSelectMenu&&this.rangeSelectMenu.destroy(),this.periodSelectMenu&&this.periodSelectMenu.destroy()},p.prototype.hasSlider=function(){return!1},p.prototype.supportsOrientation=function(){return!1},p.prototype.onClear=function(){this.data.range=a.relativeSlicerRelativeQualifier.last,this.data.period=a.relativeSlicerPeriod.none,this.data.duration=1,this.data.filter=null,this.renderInternal(),a.SlicerUtil.clearSlicerFilter(this.hostServices,this.data.mode)},p.prototype.enumerateObjectInstances=function(e,t){var i=this.relativeSlicerComponent.getVisualObjectInstance(this.data);return"dateRange"===e.objectName&&i?[i]:"numericInputStyle"===e.objectName?(i=a.slicerProps.numericInputStyle,e={selector:null,objectName:"numericInputStyle",properties:{fontColor:this.data.inputStyle.fontColor,background:this.data.inputStyle.background,textSize:this.data.inputStyle.textSize,fontFamily:this.data.inputStyle.fontFamily}},t&&t.enableBIU&&(e.properties[i.bold.propertyName]=this.data.inputStyle.labelBold,e.properties[i.italic.propertyName]=this.data.inputStyle.labelItalic,e.properties[i.underline.propertyName]=this.data.inputStyle.labelUnderline),[e]):void 0},p.prototype.getValuesCard=function(e){var t=this,i=a.slicerProps.numericInputStyle,r=new a.builder.FormattingCardBuilder(new a.builder.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[i.fontFamily,i.textSize,i.fontColor,i.background,i.bold,i.italic,i.underline,a.slicerProps.dateRange.includeToday,a.slicerProps.dateRange.anchorDate],function(e){return t.hostServices.getLocalizedString(e)}),o=(new a.builder.FontControlBuilder).withFontFamily({descriptor:i.fontFamily,value:this.data.inputStyle.fontFamily}).withFontSizeProperties({descriptor:i.textSize,value:this.data.inputStyle.textSize}),n=(e&&e.enableBIU&&o.withBold({descriptor:i.bold,value:this.data.inputStyle.labelBold}).withItalic({descriptor:i.italic,value:this.data.inputStyle.labelItalic}).withUnderline({descriptor:i.underline,value:this.data.inputStyle.labelUnderline}),o.build());return r.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values"),e.addCompositeSlice("fontselector","Font",n),e.addSimpleSlice("color",function(){var e={value:t.data.inputStyle.fontColor};return new a.builder.ColorPickerBuilder({descriptor:i.fontColor,value:e}).build()}),t.relativeSlicerComponent.appendVisualSlices(e,t.data)}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:t.data.inputStyle.background};return new a.builder.ColorPickerBuilder({descriptor:i.background,value:e}).build()})}),r.build()},p.prototype.getSlicerSettingsCardOptions=function(e,t,i,r,o){return a.SlicerUtil.ObjectEnumerator.getSlicerSettingsFormattingOptions({cardUidBuilder:e,currentSlicerSettings:void 0,data:void 0,dataView:void 0,hostServices:this.hostServices,orientation:t,activeMode:i,slicerModes:r,featureSwitches:o})},p.prototype.getAdditionalCards=function(){},p.prototype.onModeChange=function(e){a.SlicerUtil.clearSlicerFilter(this.hostServices,e)},p.prototype.onDataViewObjectChanged=function(e,t){e=a.SlicerUtil.getUpdatedDataViewObjects(e,t);return e},p.converter=function(e,t,i,r){var i={mode:i,range:a.relativeSlicerRelativeQualifier.last,period:a.relativeSlicerPeriod.none,duration:1,includeToday:!0,identity:null,anchorDate:void 0,filter:null,inputStyle:{textSize:9,fontFamily:a.Font.Family.regular.css,fontColor:a.ColorHelper.getThemeColor(t,"foregroundDark"),background:null,labelBold:!1,labelItalic:!1,labelUnderline:!1}},o=e.columns.getMetadataColumns(a.slicerRoles.value),o=(o.length,o[0]),o=(i.identity=o.expr,e.objects.getStaticObjects());return o&&(e=a.ColorHelper.create(t),i.filter=n.DataViewObjects.getValue(o,a.slicerProps.general.filter,i.filter),i.range=n.DataViewObjects.getValue(o,a.slicerProps.data.relativeRange,i.range),i.period=n.DataViewObjects.getValue(o,r,i.period),i.duration=Math.abs(n.DataViewObjects.getValue(o,a.slicerProps.data.relativeDuration,i.duration)),i.includeToday=n.DataViewObjects.getValue(o,a.slicerProps.dateRange.includeToday,i.includeToday),i.anchorDate=n.DataViewObjects.getValue(o,a.slicerProps.dateRange.anchorDate,i.anchorDate),r=a.FontProperties.createFromObjectOrStyle(n.DataViewObjects.getObject(o,"numericInputStyle"),{color:"fontColor",family:"fontFamily",size:"textSize"},e,t,"foregroundDark","smallLabel",{color:i.inputStyle.fontColor,family:i.inputStyle.fontFamily,size:s.createFromPt(i.inputStyle.textSize)}),i.inputStyle.fontColor=r.color,i.inputStyle.fontFamily=r.family,i.inputStyle.textSize=r.size.pt,i.inputStyle.background=e.getColorForPropertyWithDefaultColor(o,a.slicerProps.numericInputStyle.background,i.inputStyle.background),i.inputStyle.labelBold=n.DataViewObjects.getValue(o,a.slicerProps.numericInputStyle.bold,i.inputStyle.labelBold),i.inputStyle.labelItalic=n.DataViewObjects.getValue(o,a.slicerProps.numericInputStyle.italic,i.inputStyle.labelItalic),i.inputStyle.labelUnderline=n.DataViewObjects.getValue(o,a.slicerProps.numericInputStyle.underline,i.inputStyle.labelUnderline)),i},p.prototype.render=function(e){var i=this,e=n.data.createDataViewCategoricalReaderAdvanced(e.dataView);this.data=p.converter(e,this.style,this.relativeSlicerComponent.getMode(),this.relativeSlicerComponent.getRelativePropertyId()),this.isRendered||(this.initControls(),this.unregisterSelectMenuCloseEvents=this.eventsHelper.onPopupHideEvent(function(e,t){i.onSelectMenuClose(e,t)},this.selectionContainer.get(0))),this.updateProperties(this.data.range,this.data.period,this.data.duration),this.renderInternal()},p.prototype.onSelectMenuClose=function(e,t){$(t).hasClass(d)||$(t).closest(".".concat(d)).length||(this.rangeSelectMenu.close(),this.periodSelectMenu.close())},p.prototype.initControls=function(){var t=this,e=(this.isRendered=!0,this.container=InJs.DomFactory.div().addClass("relative-slicer").appendTo(this.host),this.selectionContainer=InJs.DomFactory.div().addClass("selection-container").appendTo(this.container),this.selectionContainer.on("keyup keydown",function(e){9!==e.keyCode&&27!==e.keyCode&&e.stopPropagation()}),this.rangeSelectMenuContainer=InJs.DomFactory.div().addClass("range-menu").appendTo(this.selectionContainer),{onChange:function(e){t.rangeChanged(e)},container:this.rangeSelectMenuContainer,options:this.getSelectMenuOptions(a.relativeSlicerRelativeQualifier.type.members()),className:d,selectedValue:"Select",title:this.hostServices.getLocalizedString("Visual_Axis_Range")}),e=(this.rangeSelectMenu=new i(e),this.rangeSelectMenu.update({selectedValue:a.relativeSlicerRelativeQualifier.last}),this.durationInput=InJs.DomFactory.textBox().attr("type","number").attr("min","1").attr("drag-resize-disabled","true").addClass("duration-input").attr("aria-label",this.hostServices.getLocalizedString("Duration")).appendTo(this.selectionContainer),this.durationInput.val(this.data.duration.toString()),this.durationInput.on("change",_.debounce(function(e){t.durationChanged()},100)),this.periodSelectMenuContainer=InJs.DomFactory.div().addClass("period-menu").appendTo(this.selectionContainer),this.relativeSlicerComponent.getListOfOptions()),e={onChange:function(e){t.periodChanged(e)},container:this.periodSelectMenuContainer,options:this.getSelectMenuOptions(e),className:d,title:this.hostServices.getLocalizedString("DaxTemplates_PeriodField")};this.periodSelectMenu=new i(e),this.periodSelectMenu.disableOption(a.relativeSlicerPeriod.none),this.updatePeriod(),this.restatementContainer=InJs.DomFactory.div().addClass("restatement-container").appendTo(this.container),this.restatementIcon=$("<i ></i>").addClass("restatement-icon").addClass("pbi-glyph-datetime").appendTo(this.restatementContainer),this.restatement=InJs.DomFactory.div().addClass("restatement").appendTo(this.restatementContainer),this.restatement.text(this.hostServices.getLocalizedString("ExportData_NoAppliedFiltersText"))},p.prototype.updatePeriod=function(){var e=this.relativeSlicerComponent.getPeriods(this.data);this.periodSelectMenu.update({options:this.getSelectMenuOptions(e),selectedValue:this.data.period})},p.prototype.rangeChanged=function(e){this.data.range=e,this.data.range===a.relativeSlicerRelativeQualifier.current?(this.durationInput.attr("type","text"),this.durationInput.val("-"),this.durationInput.prop("disabled",!0),this.data.duration=0):("-"===this.durationInput.val()?(this.durationInput.attr("type","number"),this.durationInput.val("1"),this.data.duration=1):this.updateDuration(),this.durationInput.prop("disabled",!1)),this.updatePeriod();e=this.updateProperties(this.data.range,this.data.period,this.data.duration);this.hostServices.persistProperties(e),this.renderInternal()},p.prototype.periodChanged=function(e){this.updateDuration();e=this.updateProperties(this.data.range,e,this.data.duration);this.hostServices.persistProperties(e),this.renderInternal()},p.prototype.durationChanged=function(){this.updateDuration();var e=this.updateProperties(this.data.range,this.data.period,this.data.duration);this.hostServices.persistProperties(e),this.renderInternal()},p.prototype.renderInternal=function(){var e=this.relativeSlicerComponent.getSelectedPeriodOption(this.data),t=l.fromPointToPixel(this.data.inputStyle.textSize),i={"font-size":t,"font-family":this.data.inputStyle.fontFamily,color:this.data.inputStyle.fontColor,"background-color":this.data.inputStyle.background||"","font-weight":this.data.inputStyle.labelBold?c.boldValue:c.normalValue,"font-style":this.data.inputStyle.labelItalic?c.italicValue:c.normalValue,"text-decoration":this.data.inputStyle.labelUnderline?c.underlineValue:c.noneValue},t=(this.durationInput.css(i),i["font-size"]=t-1,this.restatement.css(i),this.rangeSelectMenuContainer.find(u));t.css(i);var r=a.relativeSlicerRelativeQualifier.type.members([this.data.range])[0].displayName({get:this.hostServices.getLocalizedString.bind(this.hostServices)}),t=(t.attr("title",r),this.periodSelectMenuContainer.find(u)),r=(t.css(i),e.displayName({get:this.hostServices.getLocalizedString.bind(this.hostServices)}));t.attr("title",r),this.rangeSelectMenu.update({selectedValue:this.data.range}),this.updatePeriod(),this.periodSelectMenu.disableOption(a.relativeSlicerPeriod.none),0===this.data.duration?(this.durationInput.attr("type","text"),this.durationInput.val("-"),this.durationInput.prop("disabled",!0)):(this.durationInput.attr("type","number"),this.durationInput.prop("disabled",!1),this.durationInput.val(Math.abs(this.data.duration).toString())),this.setRestatement()},p.prototype.updateProperties=function(e,t,i){this.data.range=e;var r,e=this.data.period!==t,t=(this.data.period=t,this.data.duration=i,null);if(null!==(t=this.data.period!==a.relativeSlicerPeriod.none?this.createFilter():t)||!this.data.filter)return i=t?o.fromSQExpr(t):null,o.isSameFilter(i,this.data.filter)&&!e||(r=this.createProperties(i),this.setRestatement()),r;this.onClear()},p.prototype.updateDuration=function(){this.data.range===a.relativeSlicerRelativeQualifier.current?this.data.duration=0:this.isDurationValid()&&(this.data.duration=Math.min(parseInt(this.durationInput.val(),10),this.getDurationMax()))},p.prototype.isDurationValid=function(){var e=parseInt(this.durationInput.val(),10);return $.isNumeric(e)&&0<e},p.prototype.getDurationMax=function(){var e=this.data.period!==a.relativeSlicerPeriod.none?this.data.period:a.relativeSlicerPeriod.days;return r.getDurationMax(a.RelativeSlicerUtil.toRelativeDateQualifier(this.data.range),a.RelativeSlicerUtil.toRelativeDateUnit(e))},p.prototype.createFilter=function(){var e;return this.data.identity&&(e=a.RelativeSlicerUtil.toRelativeDateRangeOptions(this.data),e=t.buildFilterCondition({field:this.data.identity,options:e})),e},p.prototype.getRelativePropertyName=function(){return this.relativeSlicerComponent.getRelativePropertyId().propertyName},p.prototype.createProperties=function(e){var t={merge:[],replace:[],remove:[]},i={objectName:"general",selector:null,properties:{}},e=((null!==e?(i.properties[a.slicerProps.general.filter.propertyName]=e,t.merge):(i.properties[a.slicerProps.general.filter.propertyName]=!0,t.remove)).push(i),{objectName:"data",selector:null,properties:{}}),i=(null!=this.data.mode&&(e.properties[a.slicerProps.data.mode.propertyName]=this.data.mode),null!=this.data.range&&(e.properties[a.slicerProps.data.relativeRange.propertyName]=this.data.range),null!=this.data.duration&&(e.properties[a.slicerProps.data.relativeDuration.propertyName]=this.data.duration),null!=this.data.period&&(i=this.getRelativePropertyName(),e.properties[i]=this.data.period),t.replace.push(e),{objectName:"dateRange",selector:null,properties:{}});return null!=this.data.includeToday&&(i.properties[a.slicerProps.dateRange.includeToday.propertyName]=this.data.includeToday),this.data.anchorDate&&(i.properties[a.slicerProps.dateRange.anchorDate.propertyName]=this.data.anchorDate),t.replace.push(i),this.hostServices.onSelect({type:0,visualObjects:[]}),t},p.prototype.setRestatement=function(){var e,t,i=this;this.data.period===a.relativeSlicerPeriod.none?this.restatement.text(this.hostServices.getLocalizedString("ExportData_NoAppliedFiltersText")):(e=a.RelativeSlicerUtil.toRelativeDateRangeOptions(this.data),t=null==(t=null==(t=this.hostServices)?void 0:t.networkAvailability())?void 0:t.isNetworkAvailable(),this.restatement.text(r.getRestatement(e,t,function(e,t){return i.hostServices.getLocalizedString(e,t)},null==(e=this.hostServices.visualTimeSynchronization())?void 0:e.getAnchorTime())))},p.prototype.getSelectMenuOptions=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=o.displayName({get:this.hostServices.getLocalizedString.bind(this.hostServices)});t.push({text:n,value:o.value})}return t},a.RelativeSlicer=p}(powerbi=powerbi||{}),function(e){var t,i;function r(){}t=e.visuals||(e.visuals={}),i=jsCommon.StringExtensions,r.prototype.getVisualObjectInstance=function(e){},r.prototype.appendVisualSlices=function(e,t){},r.prototype.getMode=function(){return t.slicerMode.relativeTime},r.prototype.getRelativePropertyId=function(){return t.slicerProps.data.relativeTimePeriod},r.prototype.getListOfOptions=function(){return t.relativeSlicerPeriod.typeTime.members()},r.prototype.getSelectedPeriodOption=function(e){return i.isNullOrUndefinedOrWhiteSpaceString(e.period),t.relativeSlicerPeriod.typeTime.members([e.period])[0]},r.prototype.getPeriods=function(e){return(e.range!==t.relativeSlicerRelativeQualifier.current?t.relativeSlicerPeriod.typeTime:t.relativeSlicerPeriod.typeTimeCurrent).members()},t.RelativeTimeComponent=r}(powerbi=powerbi||{}),function(e){var i,t;function r(){}i=e.visuals||(e.visuals={}),t=jsCommon.StringExtensions,r.prototype.getVisualObjectInstance=function(e){return{selector:null,objectName:"dateRange",properties:{includeToday:e.includeToday,anchorDate:e.anchorDate}}},r.prototype.appendVisualSlices=function(e,t){null!=t.includeToday&&e.addSimpleSlice("includeToday",function(){return new i.builder.ToggleSwitchBuilder({descriptor:i.slicerProps.dateRange.includeToday,value:t.includeToday}).build()}),e.addSimpleSlice("anchorDate",function(){return new i.builder.DatePickerBuilder({descriptor:i.slicerProps.dateRange.anchorDate,value:t.anchorDate,placeholder:""}).build()})},r.prototype.getMode=function(){return i.slicerMode.relativeDate},r.prototype.getRelativePropertyId=function(){return i.slicerProps.data.relativePeriod},r.prototype.getListOfOptions=function(){return i.relativeSlicerPeriod.typeDate.members()},r.prototype.getSelectedPeriodOption=function(e){return t.isNullOrUndefinedOrWhiteSpaceString(e.period),i.relativeSlicerPeriod.typeDate.members([e.period])[0]},r.prototype.getPeriods=function(e){var t=(e.range!==i.relativeSlicerRelativeQualifier.current?i.relativeSlicerPeriod.typeDate:i.relativeSlicerPeriod.typeDateCurrent).members();if(e.range===i.relativeSlicerRelativeQualifier.current)switch(e.period){case i.relativeSlicerPeriod.calendarWeeks:e.period=i.relativeSlicerPeriod.weeks;break;case i.relativeSlicerPeriod.calendarMonths:e.period=i.relativeSlicerPeriod.months;break;case i.relativeSlicerPeriod.calendarYears:e.period=i.relativeSlicerPeriod.years}return t},i.RelativeDateComponent=r}(powerbi=powerbi||{}),function(D){var M,e,g,m,f,v,P,R,y,t,b;function T(e,t,i,r,o,n,a,s,l,c,d,u,p,h,S){var g=S&&S.fieldParameters&&n.parameter&&2===n.parameter.kind,m=M.valueFormatter.getFormatString(n,M.slicerProps.general.formatString);l&&(l.children=[]);for(var f=0,v=i;f<v.length;f++){var y,b,C=v[f],w=void 0,x=void 0,w=t&&t.isDefaultFilter&&!_.isEmpty(t.defaultValueByLevel)&&t.defaultValueByLevel[e]?P.getTextValue(t.defaultValueByLevel[e].value):(x=function(e,t,i){if(!_.isEmpty(i)){for(var r=[],o=0,n=i;o<n.length;o++){var a=n[o];D.DataViewScopeIdentity.equals(a.identities[e],t.identity)&&r.push(a)}return r}}(e,C,o),_.isEmpty(x)?D.data.SQExprConverter.getFirstComparandValue(C.identity):x[0].valueMap[e]),w=(h.calculatedIndex++,M.valueFormatter.format(w,m)),w=function(e,t,i,r,o,n,a,s,l,c){t={value:t,tooltip:t,identity:null,selected:e,count:i?0:void 0,isImage:r,level:o,parent:a,scopeIdentity:n,partially:s,disabled:!1,index:c};F(t,l),a&&a.children.push(t);return t}(C.checked,w,s.hasCount(),s.isImageData(),e,C.identity,l,!_.isEmpty(C.children),r,h.calculatedIndex);p&&c.push(w),w.selected&&(g?(y={dataPoint:w,selectionIndex:C.index},u.push(y)):d.push(w)),_.isEmpty(C.children)||(b=a.getMetadataColumnByLevel(y=e+1),T(y,t,C.children,r,x,b,a,s,w,c,d,u,p,h,S))}}function F(e,t){for(var i=M.SelectionIdBuilder.builder(),r=e;r;)i.withColumnIdentity(r.scopeIdentity,t[e.level]),r=r.parent;e.identity=i.createSelectionId()}function C(e,t,i,r){if(_.isEmpty(t))return e.getLocalizedString("All");if(1!==t.length||i)return e.getLocalizedString("Slicer_Restatement_Multiple");var o=t[0];if(null==o.parent)return o.value;for(var n=[],i=e.getLocalizedString("MultiColumn_Join_Separator"),a=e.getLocalizedString("NamePattern_Bracket");o;){var s=r[o.level].displayName;n.unshift(jsCommon.StringExtensions.format(a,o.value,s)),o=o.parent}return n.join(i)}function w(e,t){null!=e.dataPoint.level&&t.dataPoint.level,null!=e.selectionIndex&&t.selectionIndex;var i=e.dataPoint.level-t.dataPoint.level;return 0!=i?i:(e.selectionIndex,t.selectionIndex,e.selectionIndex-t.selectionIndex)}function i(){return null!==t&&t.apply(this,arguments)||this}M=D.visuals||(D.visuals={}),e=D.data.DefaultSQExprVisitor,g=D.visuals.FontProperties,m=D.visuals.Units.FontSize,f=D.visuals.outline,v=D.data.SemanticFilter,P=D.data.SQConstantExpr,R=jsCommon.UrlUtils,(y=M.DataConversion||(M.DataConversion={})).DefaultSlicerOutlineColorName="foregroundNeutralSecondaryAlt2",y.DefaultSlicerTextColorName="foregroundNeutralSecondary",y.DefaultSlicerProperties=function(e){return{general:{outlineWeight:1,outlineColor:M.ColorHelper.getThemeColor(e,y.DefaultSlicerOutlineColorName)},slicerText:{color:M.ColorHelper.getThemeColor(e,y.DefaultSlicerTextColorName),outlineStyle:0,outline:f.none,textSize:10,fontFamily:M.Font.Family.regular.css,labelBold:!1,labelItalic:!1,labelUnderline:!1},selection:{selectAllCheckboxEnabled:!1,singleSelect:!0,strictSingleSelect:!1},search:{enabled:!1,outlineStyle:4,outline:f.bottomOnly,borderColor:"#C8C8C8",background:"#ffffff"},expandCollapse:{indentation:15,visible:!0,toggleType:0},items:{padding:void 0,accessibilityContrastProperties:!1}}},y.convert=function(e){var t=e.dataView,i=e.hostServices,r=e.selectionHandler;if(t&&t.metadata&&!_.isEmpty(t.metadata.columns)){var o,n,a,s,l,c,d,u,p=i.getLocalizedString("ListJoin_Separator"),h=new M.readers.SlicerDataViewReader(t,i.getLocalizedString("ListJoin_Separator")),S=h.getIdentityFields();if(!_.isEmpty(S))return s=t.metadata&&t.metadata.objects&&D.DataViewObjects.getValue(t.metadata.objects,M.slicerProps.general.filter),S={columns:n=h.getColumns(),defaultValuePropertyId:M.slicerProps.general.defaultValue,filter:s,fieldSQExprs:S},S=new M.SlicerFilterAnalyzer(S,i.ignoreDefaultFilter()),_.isEmpty(S.selectedIdentities)||(h=new M.readers.SlicerDataViewReader(t,p,S.selectedIdentities)),p=S.hasMappedColumn&&!M.SlicerUtil.doDataViewColumnSupportSelectAll({columns:n}),n=s,s=r,i=i,l=p,c=(a=S).filter,d=s.isSelectionModeInverted(),c&&!v.isSameFilter(c,n)&&(s.handleClearSelection(),u=M.slicerProps.general.filter,(o={})[u.propertyName]=a.filter,a={merge:[{objectName:u.objectName,selector:void 0,properties:o}]},i.persistProperties(a)),!l||!d&&v.isSameFilter(c,n)||M.SlicerUtil.clearFilters(s,!1),r.setColumns(h.getColumns()),r.setQueryNameByLevel(h.getQueryNamePerLevel()),(u=function(e,t,i,r,o){var n=r.hostServices,a=r.selectionHandler,s=r.style,l=r.localizedSelectAllText,c=null!=r.isSlicer&&r.isSlicer,d=null!=a&&a.isSelectionModeInverted();d=e.filter?e.isAnyFilter?D.DataViewObjects.getValue(t.objects,M.slicerProps.data.isInvertedSelectionMode,d):e.isNotFilter:!e.hasMappedColumn&&D.DataViewObjects.getValue(t.objects,M.slicerProps.data.isInvertedSelectionMode,d);s=function(e,t,i){var r=y.DefaultSlicerProperties(t),e=e.objects,o=M.ColorHelper.create(t);{var n,a;e&&(r.items.accessibilityContrastProperties=D.DataViewObjects.getValue(e,M.slicerProps.items.accessibilityContrastProperties,!1),a="lightLabel",n="foregroundNeutralSecondary",r.items.accessibilityContrastProperties&&0===i&&(n="foreground",a="largeLightLabel"),t=g.createFromObjectOrStyle(D.DataViewObjects.getObject(e,"items"),{color:"fontColor",family:"fontFamily",size:"textSize"},o,t,n,a,{color:r.slicerText.color,family:r.slicerText.fontFamily,size:m.createFromPt(r.slicerText.textSize)},!0),r.slicerText.color=t.color,r.slicerText.fontFamily=t.family,r.slicerText.textSize=t.size.pt,r.items.accessibilityContrastProperties&&1===i&&(r.slicerText.outline=f.frame,r.slicerText.outlineStyle=15),r.slicerText.outline=D.DataViewObjects.getValue(e,M.slicerProps.items.outline,r.slicerText.outline),r.slicerText.outlineStyle=D.DataViewObjects.getValue(e,M.slicerProps.items.outlineStyle,r.slicerText.outlineStyle),(n=o.getColorForProperty(e,M.slicerProps.items.background,void 0))&&(r.slicerText.background=n),r.search.enabled=D.DataViewObjects.getValue(e,M.slicerProps.general.selfFilterEnabled,r.search.enabled),r.search.outlineStyle=D.DataViewObjects.getValue(e,M.slicerProps.searchBox.outlineStyle,r.search.outlineStyle),r.search.outline=D.DataViewObjects.getValue(e,M.slicerProps.searchBox.outline,r.search.outline),r.search.borderColor=o.getColorForPropertyWithDefaultColor(e,M.slicerProps.searchBox.borderColor,r.search.borderColor),a=o.getColorForProperty(e,M.slicerProps.searchBox.background,void 0),r.search.background=a||r.slicerText.background||r.search.background,r.expandCollapse.toggleType=D.DataViewObjects.getValue(e,M.slicerProps.items.expandCollapseToggleType,r.expandCollapse.toggleType),r.expandCollapse.indentation=D.DataViewObjects.getValue(e,M.slicerProps.items.steppedLayoutIndentation,r.expandCollapse.indentation),r.general.outlineWeight=D.DataViewObjects.getValue(e,M.slicerProps.general.outlineWeight,r.general.outlineWeight),r.general.outlineColor=o.getColorForPropertyWithDefaultColor(e,M.slicerProps.general.outlineColor,r.general.outlineColor),r.selection.selectAllCheckboxEnabled=D.DataViewObjects.getValue(e,M.slicerProps.selection.selectAllCheckboxEnabled,r.selection.selectAllCheckboxEnabled),r.selection.singleSelect=D.DataViewObjects.getValue(e,M.slicerProps.selection.singleSelect,r.selection.singleSelect),r.selection.strictSingleSelect=D.DataViewObjects.getValue(e,M.slicerProps.selection.strictSingleSelect,r.selection.strictSingleSelect),r.slicerText.labelBold=D.DataViewObjects.getValue(e,M.slicerProps.items.bold,!1),r.slicerText.labelItalic=D.DataViewObjects.getValue(e,M.slicerProps.items.italic,!1),r.slicerText.labelUnderline=D.DataViewObjects.getValue(e,M.slicerProps.items.underline,!1),r.items.padding=D.DataViewObjects.getValue(e,M.slicerProps.items.padding,void 0))}return r}(t,s,r.slicerType);a&&(a.setSelectionModeInverted(d),a.setDefaultValueMode(v.isDefaultFilter(e.filter)));var u=i.getQueryNamePerLevel(),p=n.getFilterExpressionMetadata(),h=[],S=[],p=function e(t,i,r,o,n,a,s,l,c,d,u){var p=i.getSelectedNodes();var h=i.getDataPointsCount();var S=[];var g=i.getMetadataColumn();var m=u&&u.fieldParameters&&g.parameter&&2===g.parameter.kind;var f=M.valueFormatter.getFormatString(g,M.slicerProps.general.formatString);var v=i.getLevel();var y=0;for(var b=0;b<h;b++){var C,w,x,D,P,I,V=i.getDataViewDataPoint(b);V&&(y++,l.calculatedIndex++,C=M.SlicerUtil.tryRemoveValueFromRetainedList(V.scopeId,p),x=M.valueFormatter.format(V.value,f),P=i.isImageData()&&R.isValidImageUrl(x),D=x,I=!1,w=v+":"+y,null!=d&&d.hasMappedColumn&&null==V.value&&(I=!0,D=n.getLocalizedString("DQP_Disabled_Blank")),x={value:x,tooltip:D,identity:null,selected:null!=C&&C.checked,partially:C&&!_.isEmpty(C.children),count:V.count,isImage:P,level:v,parent:c,isCollapsed:V.isCollapsed,scopeIdentity:V.scopeId,levelIndex:y,disabled:I,index:l.calculatedIndex,id:c?c.id+","+w:w},C&&C.checked&&(m?(D={dataPoint:x,selectionIndex:C.index},o.push(D)):r.push(x)),S.push(x),c&&c.children.push(x),F(x,a),!V.isCollapsed&&V.childrenReader?(x.children=[],S.push.apply(S,e(t,V.childrenReader,r,o,n,a,s,l,x,void 0,u)||[])):C&&!_.isEmpty(C.children)&&(P=v+1,I=t.getMetadataColumnByLevel(P),T(P,d,C.children,a,s&&s.cachedValueItems,I,t,i,x,S,r,o,!1,l,u)))}_.isEmpty(p)||T(v,d,p,a,s&&s.cachedValueItems,g,t,i,c,S,r,o,!c||!1===c.isCollapsed,l,u);return S}(i,i.getDataPointsReader(),h,S,n,u,p,{calculatedIndex:0},void 0,e,r.featureSwitches);0<S.length&&(r=_.chain(S).sort(w).map(function(e){return e.dataPoint}).value(),h=h.concat(r));S=a.toFilterExpressionMetadata(h),n.setFilterExpressionMetadata(S),r=function(e){e=D.DataViewObjects.getValue(e.objects,M.slicerProps.general.selfFilter,void 0);if(!e)return"";e=e.conditions(),e.length,e=e[0];{var t;if(e)return t=new b,e.accept(t),t.getValueForField()}}(t),S=s.selection,t=S.strictSingleSelect;!t&&c&&a.isDisableMultipleSelectForMappedColumn()&&(t=!0,s.selection.strictSingleSelect=!0);S.selectAllCheckboxEnabled&&!t&&_.isEmpty(r)&&(c=o?n.getLocalizedString("DQP_Disabled_SelectAll"):l,p.unshift({value:l,tooltip:c,identity:M.SelectionId.createWithMeasure(l),selected:!1,isSelectAllDataPoint:!0,partially:0<h.length,count:void 0,disabled:o,levelIndex:0,index:0,id:"0:0"}));a&&a.setStrictSingleSelect(t,_.isEmpty(h)?p:h);return{categorySourceName:i.getDisplayName(),slicerSettings:s,slicerDataPoints:p,defaultValueByLevel:e.defaultValueByLevel,searchKey:r,restatement:C(n,h,d,i.getColumns()),warnings:new M.VisualWarningBuilder,retainedDataPoints:h,queryNameByLevel:u}}(S,t.metadata,h,e,p)).hasImages=_.some(u.slicerDataPoints,function(e){return e.isImage}),u}},y.getRestatement=C,__extends(i,t=e),i.prototype.visitConstant=function(e){e.type&&e.type.text&&(this.value=e.value)},i.prototype.visitContains=function(e){e.left.accept(this),e.right.accept(this)},i.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},i.prototype.visitColumnRef=function(e){this.fieldExpr=e},i.prototype.visitHierarchyLevel=function(e){this.fieldExpr=e},i.prototype.visitDefault=function(e){this.value=void 0,this.fieldExpr=void 0},i.prototype.getValueForField=function(){return this.fieldExpr&&this.value},b=i}(powerbi=powerbi||{}),function(p){var h,n,i,e,l,r;function S(e){return e?h.slicerMode.type.members([h.slicerMode.verticalList,h.slicerMode.horizontalList,h.slicerMode.dropdown]):h.slicerMode.type.members([h.slicerMode.basic,h.slicerMode.dropdown])}function o(e){this.areControlButtonsAlwaysVisible=!1,this.tooltip=null,this.enableInFocusRenderers=!1,this.enableMultiElementRows=!1,this.preventVirtualKeyboardOnTheFirstTap=!1,this.isInFocus=!1,this.hasSearchableData=!1,this.lockKeyboardNavigation=!0,this.isSlicer=!1,this.hasUnappliedFilters=!1,e&&(this.enableInFocusRenderers=e.enableInFocusRenderers,this.enableMultiElementRows=e.enableMultiElementRows,this.preventVirtualKeyboardOnTheFirstTap=e.preventVirtualKeyboardOnTheFirstTap,this.lockKeyboardNavigation=!1!==e.lockKeyboardNavigation,this.featureSwitches=e.featureSwitches,this.isSlicer=e.isSlicer),this.activeMode=h.slicerMode.basic,this.slicerOrientation=0,this.viewModelAdapter=new h.SlicerViewModelAdapter}h=p.visuals||(p.visuals={}),n=p.visuals.controls,i=jsCommon.FocusManagerFocusEventName,e=p.data.RelativeFilterType,l=p.visuals.builder,r="full-screen",o.prototype.init=function(e){var t=this;this.initOptions=e,this.element=e.element,this.style=e.style,this.visibilityHelper=p.responsiveVisualUtilModuleFactory().visibilityHelper(this.element,"slicerResponsiveIcon"),this.currentViewport=e.viewport,this.hostServices=e.host,this.loadMoreHandler=new h.SimpleLoadMoreDataHandler(this.hostServices),this.container=InJs.DomFactory.div().addClass("slicer-container").appendTo(this.element),this.alert=InJs.DomFactory.span().appendTo(this.container).attr("aria-live","polite").attr("role","status").hide(),this.headerContainer=InJs.DomFactory.div().appendTo(this.container).addClass("slicer-header-wrapper"),this.slicerContainer=InJs.DomFactory.div().appendTo(this.container).addClass("slicer-content-wrapper"),this.initializeSlicerRenderer(),this.container.on(i,function(){t.areControlButtonsAlwaysVisible=!0,t.container.addClass("focused"),t.alert.text(t.activeMode);var e=!!t.slicerRenderer&&t.slicerRenderer.hasSlider();t.updateSlicerHeader(e)}),this.container.on("focusin",function(){t.container.addClass("focused")})},o.prototype.destroy=function(){this.slicerRenderer.onDestroy&&this.slicerRenderer.onDestroy(),this.slicerHeader&&this.slicerHeader.destroy()},o.prototype.update=function(e){this.isInFocus=!!e.isInFocus,e.type&p.VisualUpdateType.Resize&&this.resizing(e.viewport),e.type&p.VisualUpdateType.FilterOptionsChange&&(this.hasUnappliedFilters=e.pendingChanges[0],this.updateSlicerHeader(this.slicerRenderer.hasSlider())),(!e.type||e.type&p.VisualUpdateType.Data)&&this.dataChanged(e.dataViews,e.operationKind)},o.prototype.dataChanged=function(e,t){_.isEmpty(e)||(this.dataView=e[0],e=t!==p.VisualDataChangeOperationKind.Append,this.render(e,!0))},o.prototype.resizing=function(e){this.currentViewport=e,this.render(!1)},o.prototype.enumerateObjectInstances=function(e){if(this.dataView)switch(e.objectName){case"header":case"modeSelection":return this.slicerHeader.enumerateObjectInstances(e);case"general":var t,i=this.slicerHeader.enumerateObjectInstances(e);return this.slicerRenderer&&this.slicerRenderer.supportsOrientation()&&(t=this.data?this.data.orientation:0,i[0].properties.orientation=t),this.viewModelAdapter&&this.viewModelAdapter.enumerateObjectInstances(e,i,this.dataView,this.activeMode,this.slicerOrientation),i;default:return this.slicerRenderer.enumerateObjectInstances(e,this.featureSwitches)}},o.prototype.onDataViewObjectChanged=function(e,t){return this.featureSwitches.updateFormattingPaneObjects&&this.featureSwitches.moveSlicerTypeSelection?this.slicerRenderer.onDataViewObjectChanged(e,t):e},o.prototype.getFormattingModel=function(){var e=this;if(this.dataView)return new h.builder.FormattingModelBuilder(function(){return e.getSlicerSettingsCard()},function(){return e.slicerHeader.getSlicerHeaderCard(e.hostServices)},function(){return e.slicerRenderer.getValuesCard(e.featureSwitches)},function(){return e.slicerRenderer.getAdditionalCards()}).build()},o.prototype.getSlicerSettingsCard=function(){var t=this;if(h.slicerMode.isSlicerBasicOrDropdownType(this.activeMode)||this.featureSwitches.updateFormattingPaneObjects||this.featureSwitches.moveSlicerTypeSelection){var e=new l.FormattingCardUidBuilder("slicerSettings"),i=(this.slicerRenderer&&this.slicerRenderer.supportsOrientation()&&(s=this.data?this.data.orientation:0),this.data?this.data.activeOptions:S(this.featureSwitches.updateFormattingPaneObjects&&this.featureSwitches.moveSlicerTypeSelection));if(this.data.isCategorySourceNumeric){for(var r=[],o=0,n=this.data.activeOptions;o<n.length;o++){var a=n[o];r.push(h.NumericSlicerOptions.members([a.value])[0])}i=__spreadArray([],r,!0)}var s=this.slicerRenderer.getSlicerSettingsCardOptions(e,s,this.activeMode,i,this.featureSwitches);if(s)return i=s.groups,s=s.revertToDefaultDescriptors,new l.FormattingCardBuilder(e,"Slicer_Settings",s,function(e){return t.hostServices.getLocalizedString(e)}).withGroups(i).build()}},o.prototype.resolveFormattingPlaceholder=function(e){if(h.builder.isVisualFormattingSlicePlaceholder(e)){e=e.name;if("responsive"===e)return this.getResponsiveSlice()}},o.prototype.getResponsiveSlice=function(){var t=this;return this.dataView&&this.viewModelAdapter?this.viewModelAdapter.getResponsiveSlice(this.dataView,this.activeMode,this.slicerOrientation,function(e){return t.hostServices.getLocalizedString(e)}):void 0},o.prototype.loadMoreData=function(){return this.loadMoreHandler.updateDataView(this.dataView),this.loadMoreHandler.loadMoreData()},o.prototype.onClearSelection=function(){this.slicerRenderer&&this.slicerRenderer.onClear&&this.slicerRenderer.onClear()},o.converter=function(e,t,i){var r,o,n,a,s,l,c,d,u;if(e)return c=null,s=0,o=l=!1,n=S(t=t.updateFormattingPaneObjects&&t.moveSlicerTypeSelection),a=!(u=1),e.metadata&&e.metadata.objects&&(d=e.metadata.objects,s=p.DataViewObjects.getValue(d,h.slicerProps.general.orientation,s),l=p.DataViewObjects.getValue(d,h.slicerProps.selection.strictSingleSelect,l),c=p.DataViewObjects.getValue(d,h.slicerProps.data.mode,c)),e.metadata&&e.metadata.columns&&(d=h.SlicerUtil.readMetadataColumns(e.metadata.columns),_.isEmpty(d)||(e=d[0],c=h.SlicerPluginMethods.getValidatedSlicerMode(d,c),r=_.join(_.map(d,function(e){return e.displayName}),i),a=!_.some(d,function(e){return!0!==e.type.text}),1===d.length?(a=!0===e.type.text,o=!0===e.type.numeric,e.parameter&&1===e.parameter.kind?(n=_.union(S(t),h.slicerMode.type.members([c])),l=l||!e.parameter.supportsMultipleValues):!0===e.type.dateTime?n=t?h.slicerMode.type.members([h.slicerMode.verticalList,h.slicerMode.horizontalList,h.slicerMode.dropdown,h.slicerMode.before,h.slicerMode.after,h.slicerMode.between,h.slicerMode.relativeDate,h.slicerMode.relativeTime]):h.slicerMode.type.members([h.slicerMode.basic,h.slicerMode.dropdown,h.slicerMode.before,h.slicerMode.after,h.slicerMode.between,h.slicerMode.relativeDate,h.slicerMode.relativeTime]):o&&(n=_.union(n,t?h.slicerMode.type.members([h.slicerMode.verticalList,h.slicerMode.horizontalList,h.slicerMode.dropdown,h.slicerMode.before,h.slicerMode.after,h.slicerMode.between]):h.slicerMode.type.members([h.slicerMode.basic,h.slicerMode.dropdown,h.slicerMode.before,h.slicerMode.after,h.slicerMode.between])),e.parameter)&&(n=_.union(n,h.slicerMode.type.members([h.slicerMode.single])))):(s=0,t&&(n=h.slicerMode.type.members([h.slicerMode.verticalList,h.slicerMode.dropdown]))),h.slicerMode.slicerModeSupportsMinMax(c)&&1===d.length&&(u=e.aggregates&&null!=e.aggregates.min&&null!=e.aggregates.max?u:2))),{orientation:s,categorySourceName:r,isCategorySourceNumeric:o,mode:c||h.slicerMode.basic,switchMode:u,hasSearchableData:a,activeOptions:n,showIcon:!1,showTabularSlicer:!1,warningObjectCollection:new h.VisualWarningBuilder,strictSingleSelect:l}},o.prototype.render=function(e,t){this.updateViewport(),this.previousData=this.data,this.data=this.originalData=o.converter(this.dataView,this.featureSwitches,this.hostServices.getLocalizedString("ListJoin_Separator")),this.featureSwitches.updateFormattingPaneObjects&&this.featureSwitches.moveSlicerTypeSelection&&this.clearSelectionIfNeeded(),this.viewModelAdapter&&this.dataView&&(this.data=this.viewModelAdapter.applySlicerChanges(this.currentViewport,this.originalData,this.dataView)),this.data&&(this.hasSearchableData=this.data.hasSearchableData),this.renderSlicer(e,t),this.data&&this.data.showIcon?this.visibilityHelper.updateVisibility({showIcon:!0,viewport:this.currentViewport}):this.visibilityHelper.updateVisibility({showIcon:!1})},o.prototype.renderSlicer=function(e,t){this.updateSlicerRendererIfNeeded(),this.slicerRenderer.render({dataView:this.dataView,viewport:this.currentViewport,resetScrollbarPosition:e,hasSearchableData:this.hasSearchableData,restatement:this.data&&this.data.categorySourceName,isSlicer:this.isSlicer,isSearchMode:!!this.selectionHandler&&this.selectionHandler.isSearchMode()}),this.updateSlicerHeader(this.slicerRenderer.hasSlider());e=null!=this.slicerRenderer.getRestatement;this.slicerHeader&&this.slicerHeader.setFilterRestatement(e?this.slicerRenderer.getRestatement():void 0,e),t&&this.loadMoreHandler.onLoadMoreDataCompleted(),this.updateWarnings()},o.prototype.updateSlicerRendererIfNeeded=function(){var e,t;if(this.enableInFocusRenderers&&this.container.hasClass(r)!==this.isInFocus)return this.isInFocus?this.container.addClass(r):this.container.removeClass(r),void this.initializeSlicerRenderer();this.data&&(e=this.data.mode||h.slicerMode.basic,this.activeMode!==e||h.slicerMode.isRangeSlicerMode(this.activeMode)&&this.previousData&&this.previousData.isCategorySourceNumeric!==this.data.isCategorySourceNumeric?(this.activeMode=e,this.initializeSlicerRenderer()):(e=this.data.showTabularSlicer,t=this.data.orientation||0,(this.slicerOrientation!==t||this.previousData&&this.previousData.showTabularSlicer!==e)&&this.initializeSlicerRenderer()))},o.prototype.clearSelectionIfNeeded=function(){var e;this.previousData&&this.data&&(e=this.data.mode||h.slicerMode.basic,this.previousData.mode!==e||h.slicerMode.isRangeSlicerMode(e)&&this.previousData&&this.previousData.isCategorySourceNumeric!==this.data.isCategorySourceNumeric)&&(this.hostServices.onSelect({type:0,visualObjects:[]}),e=this.hostServices.getLocalizedString("Slicer_ClearSelectionsCleared"),this.hostServices.alertWithDebounce("announce-clear-selection",e))},o.prototype.updateViewport=function(){var e={height:this.currentViewport.height};this.container.css(e)},o.prototype.updateSlicerHeader=function(i){var e,t,r,o=this;this.dataView&&(e=p.data.createDataViewCategoricalReader(this.dataView),this.slicerHeader||(t={onClear:function(){o.slicerRenderer&&o.slicerRenderer.onClear(!0)},onChange:function(e){!o.slicerRenderer||o.featureSwitches.updateFormattingPaneObjects||o.featureSwitches.moveSlicerTypeSelection||o.slicerRenderer.onModeChange(e)},host:this.headerContainer,visibilityState:this.data.switchMode,selectedValue:this.activeMode,hoverContainer:this.element,enableInFocusRenderers:this.enableInFocusRenderers,slicerModeOptions:this.slicerActiveOptions()},r={localize:this.hostServices.getLocalizedString.bind(this.hostServices),getViewMode:this.hostServices.getViewMode.bind(this.hostServices),applySlicerHeaderChanges:function(e){var t=e;return t=o.viewModelAdapter&&o.dataView&&o.data?o.viewModelAdapter.applySlicerHeaderChanges(o.currentViewport,e,o.dataView,o.data,i):t},onRenderTooltip:function(e,t){return o.getTooltipComponent(e,t)}},this.slicerHeader=new n.SlicerHeader(t,r,this.style,this.featureSwitches)),this.slicerHeader.update(e,{text:this.data.categorySourceName,restatement:this.slicerRenderer.getRestatement?this.slicerRenderer.getRestatement():void 0,selectedValue:this.activeMode,visibilityState:this.data.switchMode,isInFocus:this.isInFocus,slicerModeOptions:this.slicerActiveOptions(),areControlButtonsAlwaysVisible:this.areControlButtonsAlwaysVisible,strictSingleSelect:this.data.strictSingleSelect,hasUnappliedFilters:this.hasUnappliedFilters}))},o.prototype.getTooltipComponent=function(e,t){var i;return null!==this.tooltip&&this.tooltip.close(),this.tooltip=null==(i=this.hostServices.getUIComponentFactory())?void 0:i.createTooltip(e,t),this.tooltip},o.prototype.slicerActiveOptions=function(){if(this.data.isCategorySourceNumeric){for(var e=[],t=0,i=this.data.activeOptions;t<i.length;t++){var r=i[t];e.push(h.NumericSlicerOptions.members([r.value])[0])}return e}return this.data.activeOptions},o.prototype.initializeSlicerRenderer=function(){switch(this.slicerRenderer&&this.slicerRenderer.onDestroy&&this.slicerRenderer.onDestroy(),this.slicerOrientation=this.data&&this.data.orientation||0,this.slicerContainer.empty(),this.activeMode){case h.slicerMode.basic:return void this.initializeBasicSlicer();case h.slicerMode.dropdown:return void this.initializeDropdownSlicer();case h.slicerMode.relativeDate:return void this.initializeRelativeSlicer(e.Date);case h.slicerMode.relativeTime:return void this.initializeRelativeSlicer(e.Time);case h.slicerMode.between:case h.slicerMode.before:case h.slicerMode.after:return void this.initializeRangeSlicer(!1);case h.slicerMode.single:return void this.initializeRangeSlicer(!0);default:return this.activeMode,void this.initializeVerticalSlicer()}},o.prototype.initializeBasicSlicer=function(){if(this.enableInFocusRenderers&&this.isInFocus)this.initializeInFocusVerticalSlicer();else switch(this.slicerOrientation){case 1:this.initializeHorizontalOrTabularSlicer();break;case 0:this.initializeVerticalSlicer()}},o.prototype.initializeInFocusVerticalSlicer=function(){this.hostServices.setShouldDeferData(!1);var e=this.slicerRenderer=new h.VerticalSlicerRenderer(new h.VerticalSlicerRenderer.CheckListSlicerStrategy,{hostServices:this.hostServices,featureSwitches:this.featureSwitches},this.lockKeyboardNavigation),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},o.prototype.initializeVerticalSlicer=function(){var e=this.slicerRenderer=new h.VerticalSlicerRenderer(new h.VerticalSlicerRenderer.CheckBoxSlicerStrategy,{hostServices:this.hostServices,featureSwitches:this.featureSwitches},this.lockKeyboardNavigation),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},o.prototype.initializeRangeSlicer=function(e){this.data.isCategorySourceNumeric?(t=new h.RangeSlicerViewModelAdapter,i=new h.NumericSlicer({hostServices:this.hostServices}),this.slicerRenderer=new h.RangeSlicer({hostServices:this.hostServices,featureSwitches:this.featureSwitches},i,e,this.data.isCategorySourceNumeric,t)):(t=new h.RangeSlicerViewModelAdapter,i=new h.DateSlicer({preventVirtualKeyboardOnTheFirstTap:this.preventVirtualKeyboardOnTheFirstTap,hostServices:this.hostServices,featureSwitches:this.featureSwitches}),this.slicerRenderer=new h.RangeSlicer({preventTextSelection:this.preventVirtualKeyboardOnTheFirstTap,hostServices:this.hostServices,featureSwitches:this.featureSwitches},i,e,this.data.isCategorySourceNumeric,t));var t,i=this.createInitOptions();this.selectionHandler=this.slicerRenderer.init(i,this.slicerContainer)},o.prototype.initializeHorizontalOrTabularSlicer=function(){var e=new(!!this.data&&this.data.showTabularSlicer?h.TabularSlicerLayout:h.HorizontalSlicerLayout),t=new h.HorizontalSlicerViewModelAdapter,e=this.slicerRenderer=new h.HorizontalSlicerRenderer({hostServices:this.hostServices,horizontalSlicerLayout:e,featureSwitches:this.featureSwitches},t),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},o.prototype.initializeRelativeSlicer=function(e){var t={hostServices:this.hostServices},e=this.slicerRenderer=h.RelativeSlicerUtil.createRelativeSlicer(e,t),t=this.createInitOptions();this.selectionHandler=e.init(t,this.slicerContainer)},o.prototype.initializeDropdownSlicer=function(){var e,t;this.enableInFocusRenderers&&this.isInFocus?this.initializeInFocusVerticalSlicer():(e={hostServices:this.hostServices,featureSwitches:this.featureSwitches},t=new h.VerticalSlicerRenderer(new h.VerticalSlicerRenderer.CheckBoxSlicerStrategy,e),this.slicerRenderer=new h.DropdownSlicerRenderer(t,e),t=this.createInitOptions(),this.selectionHandler=this.slicerRenderer.init(t,this.slicerContainer))},o.prototype.createInitOptions=function(){var e=this;return{visualInitOptions:this.initOptions,loadMoreData:function(){return e.loadMoreData()},enableMultiElementRows:this.enableMultiElementRows}},o.prototype.updateWarnings=function(){this.data&&(this.slicerHeader.addWarnings(this.data.warningObjectCollection),this.slicerRenderer.addWarnings&&this.slicerRenderer.addWarnings(this.data.warningObjectCollection),this.hostServices.setWarnings(this.data.warningObjectCollection.complete()))},h.Slicer=o}(powerbi=powerbi||{}),function(e){var s,o,n,a;function l(){}s=e.visuals||(e.visuals={}),o=jsCommon.BrowserUtils,n=jsCommon.DOMConstants,a=jsCommon.KeyUtils,l.prototype.bindEvents=function(e,t){this.behavior=this.createWebBehavior(e),this.behavior.bindEvents(e.behaviorOptions,t)},l.prototype.renderSelection=function(){this.behavior&&this.behavior.renderSelection()},l.bindSlicerEvents=function(e,t,i,r){l.bindSlicerItemSelectionEvent(t,i,r),e.searchInput&&l.bindSlicerSearchEvent(e.searchInput,e.clearSearchTextButton,i)},l.setSelectionOnSlicerItems=function(e,t,o){var n=t.isSelectionModeInverted(),a=t.hasSelection();e.each(function(e,t){var i=!!e.partially||e.isSelectAllDataPoint&&a,e=!a&&n||a&&!i&&s.SlicerUtil.getSlicerDataPointCheckedState(e,n),r=($(this).toggleClass("selected",e),$(this).toggleClass("partiallySelected",!!i),o.isHighContrast&&(i=this.getElementsByTagName("span")[0],e?(r=s.ColorHelper.getThemeColor(o,"foregroundSelected"),i&&(i.style.backgroundColor=r,i.style.borderColor=r)):(r=s.ColorHelper.getThemeColor(o,"foreground"),i&&(i.style.backgroundColor="",i.style.borderColor=r,i.style.boxShadow="none"))),this.getElementsByTagName("input")[0]);r&&(r.checked=e)})},l.bindSlicerItemSelectionEvent=function(e,r,o){var n=this;e.on("keydown",function(e){var t=d3.event,i=t.keyCode;32!==i&&13!==i||(32===i&&t.preventDefault(),n.toggleItemSelection(e,r,o))}).on("click",function(e){$(d3.event.target).trigger("slicer.dataPointSelected"),n.toggleItemSelection(e,r,o)})},l.toggleItemSelection=function(e,t,i,r){e.disabled||(r=r||d3.event,e.isSelectAllDataPoint?(t.toggleSelectionModeInversion(),t.persistSelectionFilter(s.slicerProps.general.filter)):(i=l.isMultiSelect(e,r,i,t)?3:0,t.handleSelection(e,i,{x:r.clientX,y:r.clientY})&&t.persistSelectionFilter(s.slicerProps.general.filter)))},l.toggleItemSelectionFromExternal=function(e,t,i,r){this.toggleItemSelection(t,i,r,e)},l.bindSlicerSearchEvent=function(t,e,i){var r=this;t.empty()||(t.on(n.keyDownEventName,function(){var e=d3.event;o.isCtrlOrMeta(e)&&a.isCtrlShortcutKey(e.keyCode)||a.isArrowKey(e.keyCode)||a.isDeleteKey(e.keyCode)?e.stopPropagation():27===e.keyCode?(r.clearSearch(i),e.preventDefault()):13===e.keyCode&&(l.startSearch(t,i),e.stopPropagation())}).on(n.keyUpEventName,function(){var e=d3.event;_.debounce(function(){9!==e.keyCode&&16!==e.keyCode&&l.startSearch(t,i)},l.searchInputTimeoutDuration)()}),e&&!e.empty()&&e.on(n.mouseClickEventName,function(){r.clearSearch(i),d3.event.stopPropagation()}))},l.clearSearch=function(e){e.setSearchMode(!0),e.persistSelfFilter(s.slicerProps.general.selfFilter,null)},l.startSearch=function(e,t){e=e.node(),e=e&&e.value,e=_.trim(e);t.setSearchMode(!0),t.persistSelfFilter(s.slicerProps.general.selfFilter,e)},l.isMultiSelect=function(e,t,i,r){return!i.selection.strictSingleSelect&&!r.isDisableMultipleSelectForMappedColumn()&&(r.isSelectionModeInverted()||!i.selection.singleSelect||o.isCtrlOrMeta(t)||1===r.getDataMultiSelectMode()||l.hasParentSelected(e))},l.hasParentSelected=function(e){for(;e.parent;){if(e.parent.selected)return!0;e=e.parent}},l.prototype.createWebBehavior=function(e){e=new(1===e.orientation?s.HorizontalSlicerWebBehavior:s.VerticalSlicerWebBehavior);return e},l.searchInputTimeoutDuration=500,s.SlicerWebBehavior=l}(powerbi=powerbi||{}),function(o){var l,c,d,n,r,a,i,s,t,e,u,p,h,S;function g(e,t,i,r){this.services=t,this.settings=e,this.style=i,this.originalData=this.data=g.DefaultData(this.style,e.text,this.services),this.featureSwitches=r,this.render()}l=o.visuals||(o.visuals={}),c=l.controls||(l.controls={}),d=o.visuals.builder,n=o.visuals.Units.FontSize,r=l.outline,a=jsCommon.PixelConverter,i=o.visuals.controls.SelectMenu,s=jsCommon.StringExtensions,t=jsCommon.CssConstants,u="slicer-header-pending-icon-path",p="slicer-header-selectmenu",h="foregroundNeutralSecondary",S='<svg width="17" height="16" viewBox="0 0 17 16" class='.concat(e="slicer-header-pending-icon",' xmlns="http://www.w3.org/2000/svg">\n        <path class=\'').concat(u,' OfficeIconColors_HighContrast\' d="M8.00781 0C12.4261 0 16.0078 3.58172 16.0078 8C16.0078 12.4183 12.4261 \n        16 8.00781 16C3.58953 16 0.0078125 12.4183 0.0078125 8C0.0078125 3.58172 3.58953 0 8.00781 0ZM7.50781 3C7.23167 3 7.00781 3.22386 \n        7.00781 3.5V8.5L7.01587 8.58988C7.0582 8.82312 7.26235 9 7.50781 9H10.5078L10.5977 8.99194C10.8309 8.94961 11.0078 8.74546 11.0078 \n        8.5C11.0078 8.22386 10.784 8 10.5078 8H8.00781V3.5L7.99976 3.41012C7.95742 3.17688 7.75327 3 7.50781 3Z" /></svg>'),c.PendingIconSizeLowerBound=1,c.PendingIconSizeUpperBound=999,g.DefaultData=function(e,t,i){return{borderStyle:"solid",borderBottomWidth:1,show:!0,outline:r.none,outlineStyle:0,fontColor:l.ColorHelper.getThemeColor(e,"foregroundDark"),textSize:9,fontFamily:l.Font.Family.regular.css,iconColor:l.ColorHelper.getThemeColor(e,h),iconHoverColor:l.ColorHelper.getThemeColor(e,"foreground"),outlineColor:l.ColorHelper.getThemeColor(e,"foregroundNeutralSecondaryAlt2"),outlineWeight:1,searchEnabled:!1,background:null,showRestatement:!1,menu:{fontColor:l.ColorHelper.getThemeColor(e,h)},warnings:new l.VisualWarningBuilder,text:t,labelBold:!1,labelItalic:!1,labelUnderline:!1,pendingChangesIcon:{show:!0,color:l.ColorHelper.getThemeColor(e,h),transparency:0,position:"right",size:12,showTooltip:!0,tooltipText:"",tooltipLabel:i.localize("Not_Yet_Applied_With_Parentheses")}}},g.InFocusModeData=function(e,t,i){t=g.DefaultData(e,t,i);return t.borderStyle="none",t.background=l.ColorHelper.getThemeColor(e,"foregroundNeutralLight"),t.textSize=a.toPoint(13),t.fontColor=l.ColorHelper.getThemeColor(e,"foregroundNeutralDark"),t.fontFamily=l.Font.Family.regular.css,t},g.prototype.destroy=function(){this.selectMenu&&this.selectMenu.destroy()},g.prototype.enumerateObjectInstances=function(e){var t,i=this.originalData;if(i)return"header"===e.objectName?(t={selector:null,objectName:"header",properties:{text:i.text,show:i.show,fontColor:i.fontColor,background:i.background,textSize:i.textSize,fontFamily:i.fontFamily,outlineColor:i.outlineColor,outlineWeight:i.outlineWeight},propertyInstanceKind:{text:3,fontColor:this.featureSwitches.expressionBasedFormatting?3:1,background:this.featureSwitches.expressionBasedFormatting?3:1}},this.featureSwitches.outlineDropdownToCheckboxes?t.properties.outlineStyle=i.outlineStyle:t.properties.outline=i.outline,this.settings.supportsRestatement&&(t.properties.showRestatement=i.showRestatement),this.featureSwitches&&this.featureSwitches.enableBIU&&(t.properties.bold=i.labelBold,t.properties.italic=i.labelItalic,t.properties.underline=i.labelUnderline),[t]):"general"===e.objectName?[{selector:null,objectName:"general",properties:{outlineColor:i.outlineColor,outlineWeight:i.outlineWeight}}]:void 0},g.prototype.getSlicerHeaderCard=function(t){var i,r,e,o,n,a=this,s=this.originalData;if(s)return i=l.slicerProps.header,r=l.slicerProps.pendingChangesIcon,e=new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("slicerHeader"),"Slicer_Header",[i.text,i.fontFamily,i.textSize,i.bold,i.italic,i.underline,i.fontColor,i.showRestatement,i.outlineStyle,i.outline,l.slicerProps.general.outlineColor,l.slicerProps.general.outlineWeight,i.background,i.show,r.show,r.color,r.position,r.transparency,r.size,r.showTooltip,r.tooltipText,r.tooltipLabel],function(e){return t.getLocalizedString(e)}),o=(new l.builder.FontControlBuilder).withFontFamily({descriptor:i.fontFamily,value:s.fontFamily}).withFontSizeProperties({descriptor:i.textSize,value:s.textSize}),this.featureSwitches&&this.featureSwitches.enableBIU&&o.withBold({descriptor:i.bold,value:s.labelBold}).withItalic({descriptor:i.italic,value:s.labelItalic}).withUnderline({descriptor:i.underline,value:s.labelUnderline}),n=o.build(),e.addTopLevelToggle("show",function(){return new l.builder.ToggleSwitchBuilder({descriptor:i.show,value:s.show}).build()}).addGroup("text",function(e){e.withDisplayName("Text").addSimpleSlice("title",new d.TextInputBuilder({descriptor:__assign(__assign({},i.text),{instanceKind:3}),value:s.text,placeholder:""}).build()).addCompositeSlice("fontselector","Font",n).addSimpleSlice("color",function(){var e={value:s.fontColor};return new d.ColorPickerBuilder({descriptor:__assign(__assign({},i.fontColor),{instanceKind:a.featureSwitches.expressionBasedFormatting?3:1}),value:e}).build()}),a.settings.supportsRestatement&&e.addSimpleSlice("labelContents",new d.ToggleSwitchBuilder({descriptor:i.showRestatement,value:s.showRestatement}).build())}).addGroup("border",function(e){e.withDisplayName("Visual_Border"),a.featureSwitches.outlineDropdownToCheckboxes?e.addSimpleSlice("border position",new d.FlagSelectionBuilder({descriptor:i.outlineStyle,value:s.outlineStyle}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("border position",new d.DropdownBuilder({descriptor:i.outline,value:s.outline}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("color",function(){var e={value:s.outlineColor};return new d.ColorPickerBuilder({descriptor:__assign(__assign({},l.slicerProps.general.outlineColor),{instanceKind:a.featureSwitches.expressionBasedFormatting?3:1}),value:e}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")}).addSimpleSlice("lineWidth",new d.SliderBuilder({descriptor:l.slicerProps.general.outlineWeight,value:s.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}},localize:function(e){return t.getLocalizedString(e)}}).build(),function(e){return e.withCustomDisplayName("Visual_Line_Width")})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){var e={value:s.background};return new d.ColorPickerBuilder({descriptor:__assign(__assign({},i.background),{instanceKind:a.featureSwitches.expressionBasedFormatting?3:1}),value:e}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")})}),this.featureSwitches.applyAllSlicersButton&&e.addGroup("pendingChangesIcon",function(e){e.withDisplayName("PendingIcon").addTopLevelToggle("show",function(){return new d.ToggleSwitchBuilder({descriptor:r.show,value:s.pendingChangesIcon.show}).build()}).addSimpleSlice("pendingIconColor",function(){var e={value:s.pendingChangesIcon.color};return new d.ColorPickerBuilder({descriptor:r.color,value:e}).build()}).addSimpleSlice("pendingIconTransparency",d.SliderBuilder.getTransparencySliderBuilder({descriptor:r.transparency,value:s.pendingChangesIcon.transparency,localize:function(e){return t.getLocalizedString(e)}}).build()).addSimpleSlice("pendingIconPosition",new d.DropdownBuilder({descriptor:r.position,value:s.pendingChangesIcon.position,filterValues:[l.iconPlacement.left,l.iconPlacement.right]}).build()).addSimpleSlice("pendingIconSize",function(){var e={minValue:{type:0,value:c.PendingIconSizeLowerBound},maxValue:{type:1,value:c.PendingIconSizeUpperBound},unitSymbol:l.visualLocKeys.PixelUnitSymbol};return new d.NumUpDownBuilder({descriptor:r.size,value:s.pendingChangesIcon.size,options:e}).build()}).addSimpleSlice("pendingIconTooltip",function(){return new d.ToggleSwitchBuilder({descriptor:r.showTooltip,value:s.pendingChangesIcon.showTooltip}).build()}).addSimpleSlice("pendingIconTooltipText",function(){return new d.TextAreaBuilder({descriptor:r.tooltipText,placeholder:"Slicer_PendingChanges",value:s.pendingChangesIcon.tooltipText,localize:function(e){return t.getLocalizedString(e)}}).build()}).addSimpleSlice("pendingIconLabelText",function(){return new d.TextAreaBuilder({descriptor:r.tooltipLabel,placeholder:"  ",value:s.pendingChangesIcon.tooltipLabel,localize:function(e){return"  "===e?e:t.getLocalizedString(e)}}).build()})}),e.build()},g.prototype.update=function(e,t){$.extend(this.settings,t),this.settings.enableInFocusRenderers&&this.settings.isInFocus?this.data=g.InFocusModeData(this.style,t.text,this.services):(this.originalData=g.converter(e,this.style,t.text,this.services),this.data=this.services.applySlicerHeaderChanges(this.originalData)),this.addSlicerHelperTooltip(),this.maintainSelectMenu(),this.updateTitle()},g.prototype.setFilterRestatement=function(e,t){this.settings.restatement=e,this.settings.supportsRestatement=t,this.updateTitleText()},g.converter=function(e,t,i,r){i=g.DefaultData(t,i,r),r=e.objects.getStaticObjects(),e=l.ColorHelper.create(t);return r&&(t=l.FontProperties.createFromObjectOrStyle(o.DataViewObjects.getObject(r,"header"),{color:"fontColor",family:"fontFamily",size:"textSize"},e,t,"foregroundDark","title",{color:i.fontColor,family:i.fontFamily,size:n.createFromPt(i.textSize)}),i.fontColor=t.color,i.fontFamily=t.family,i.textSize=t.size.pt,i.show=o.DataViewObjects.getValue(r,l.slicerProps.header.show,i.show),i.text=o.DataViewObjects.getValue(r,l.slicerProps.header.text,i.text),i.menu.fontColor=e.getColorForPropertyWithDefaultColor(r,l.slicerProps.header.fontColor,i.menu.fontColor),i.background=e.getColorForPropertyWithDefaultColor(r,l.slicerProps.header.background,i.background),i.outlineColor=e.getColorForPropertyWithDefaultColor(r,l.slicerProps.general.outlineColor,i.outlineColor),i.outlineWeight=o.DataViewObjects.getValue(r,l.slicerProps.general.outlineWeight,i.outlineWeight),i.outlineStyle=o.DataViewObjects.getValue(r,l.slicerProps.header.outlineStyle,i.outlineStyle),i.outline=o.DataViewObjects.getValue(r,l.slicerProps.header.outline,i.outline),i.searchEnabled=o.DataViewObjects.getValue(r,l.slicerProps.general.selfFilterEnabled,i.searchEnabled),i.showRestatement=o.DataViewObjects.getValue(r,l.slicerProps.header.showRestatement,i.showRestatement),i.labelBold=o.DataViewObjects.getValue(r,l.slicerProps.header.bold,i.labelBold),i.labelItalic=o.DataViewObjects.getValue(r,l.slicerProps.header.italic,i.labelItalic),i.labelUnderline=o.DataViewObjects.getValue(r,l.slicerProps.header.underline,i.labelUnderline),i.pendingChangesIcon.show=o.DataViewObjects.getValue(r,l.slicerProps.pendingChangesIcon.show,i.pendingChangesIcon.show),i.pendingChangesIcon.color=e.getColorForPropertyWithDefaultColor(r,l.slicerProps.pendingChangesIcon.color,i.pendingChangesIcon.color),i.pendingChangesIcon.transparency=o.DataViewObjects.getValue(r,l.slicerProps.pendingChangesIcon.transparency,i.pendingChangesIcon.transparency),i.pendingChangesIcon.position=o.DataViewObjects.getValue(r,l.slicerProps.pendingChangesIcon.position,i.pendingChangesIcon.position),i.pendingChangesIcon.size=o.DataViewObjects.getValue(r,l.slicerProps.pendingChangesIcon.size,i.pendingChangesIcon.size),i.pendingChangesIcon.showTooltip=o.DataViewObjects.getValue(r,l.slicerProps.pendingChangesIcon.showTooltip,i.pendingChangesIcon.showTooltip),i.pendingChangesIcon.tooltipText=o.DataViewObjects.getValue(r,l.slicerProps.pendingChangesIcon.tooltipText,jsCommon.StringExtensions.encodeHtml(i.pendingChangesIcon.tooltipText)),i.pendingChangesIcon.tooltipLabel=o.DataViewObjects.getValue(r,l.slicerProps.pendingChangesIcon.tooltipLabel,jsCommon.StringExtensions.encodeHtml(i.pendingChangesIcon.tooltipLabel))),i},g.prototype.render=function(){this.header=InJs.DomFactory.div().addClass("slicer-header").appendTo(this.settings.host),this.addTitle(),this.addSlicerHelperTooltip(),this.maintainSelectMenu()},g.prototype.maintainSelectMenu=function(){var e;this.featureSwitches.updateFormattingPaneObjects&&this.featureSwitches.moveSlicerTypeSelection||(this.selectMenu||0===this.services.getViewMode()?this.updateSelectMenu():this.addSelectMenu(),this.selectMenuContainer&&(e=this.data,this.selectMenuContainer.find("span.ui-icon").css("color",this.data.iconColor).hover(function(){$(this).css("color",e.iconHoverColor)},function(){$(this).css("color",e.iconColor)})))},g.prototype.addSelectMenu=function(){var t=this,e=this.services.localize("Slicer_SelectMenu_Tooltip"),e=(this.selectMenuContainer=InJs.DomFactory.div().addClass(p).toggleClass(l.SlicerUtil.Selectors.EnableHover.class,l.SlicerUtil.enableHover()).appendTo(this.title),this.applyTooltip(this.selectMenuContainer,e,this.services.onRenderTooltip),{onChange:function(e){t.settings.onChange&&t.settings.onChange(e)},container:this.selectMenuContainer,options:this.getSelectMenuOptions(),selectedValue:this.settings.selectedValue,className:"slicer-select-menu",disabled:2===this.settings.visibilityState,title:e});this.selectMenu=new i(e),g.addHoverInOut(this.settings.hoverContainer,function(){0!==t.services.getViewMode()&&(t.selectMenuContainer.css("visibility","visible"),t.selectMenuContainer.css("display","flex"))},function(){t.settings.areControlButtonsAlwaysVisible||(_.isEmpty(t.data.text)?t.selectMenuContainer.css("visibility","hidden"):t.selectMenuContainer.css("display","none"))})},g.prototype.addSlicerHelperTooltip=function(){var e,t,i=this;this.featureSwitches.updateFormattingPaneObjects&&this.featureSwitches.moveSlicerTypeSelection&&(0===this.services.getViewMode()?this.selectMenuContainer&&this.selectMenuContainer.hide():this.selectMenuContainer?this.selectMenuContainer.show():(e=this.services.localize("Slicer_Helper_Tooltip"),this.selectMenuContainer=InJs.DomFactory.div().addClass(p).toggleClass(l.SlicerUtil.Selectors.EnableHover.class,l.SlicerUtil.enableHover()).appendTo(this.title),this.helperTooltipButton=InJs.DomFactory.span().addClass("slicer-helper-tooltip-button").attr("aria-label",e).attr("role","button").attr("tabindex","0"),this.applyTooltip(this.helperTooltipButton,e,this.services.onRenderTooltip),this.helperTooltipButton.appendTo(this.selectMenuContainer),t=this.data,this.helperButtonIcon=InJs.DomFactory.span().addClass("ui-icon").css("color",this.data.iconColor).hover(function(){$(this).css("color",t.iconHoverColor)},function(){$(this).css("color",t.iconColor)}),this.helperButtonIcon.appendTo(this.helperTooltipButton),g.addHoverInOut(this.settings.hoverContainer,function(){0!==i.services.getViewMode()&&(i.selectMenuContainer.css("visibility","visible"),i.selectMenuContainer.css("display","flex"))},function(){i.settings.areControlButtonsAlwaysVisible||(_.isEmpty(i.data.text)?i.selectMenuContainer.css("visibility","hidden"):i.selectMenuContainer.css("display","none"))})))},g.prototype.addPendingChangesIcon=function(){this.pendingChangesIcon=$(S).addClass(e).appendTo(this.title)},g.prototype.addPendingChangesText=function(){this.pendingChangesText=InJs.DomFactory.div().append(this.data.pendingChangesIcon.tooltipLabel).addClass("slicer-header-pending-text").appendTo(this.title)},g.prototype.updatePendingChangesIcon=function(){var e=this.data.pendingChangesIcon,t=(e.show&&this.settings.hasUnappliedFilters&&this.featureSwitches.applyAllSlicersButton?(this.pendingChangesIcon.css("display","block"),this.pendingChangesText.css("display","block")):(this.pendingChangesIcon.css("display","none"),this.pendingChangesText.css("display","none")),this.pendingChangesIcon.css("opacity","".concat(jsCommon.Color.convertTransparencyToOpacity(this.data.pendingChangesIcon.transparency))),e.size.toString());this.pendingChangesIcon.attr("height","".concat(t)),this.pendingChangesIcon.attr("width","".concat(t)),this.pendingChangesIcon.attr("viewbox","0 0 ".concat(t," ").concat(t)),this.pendingChangesIcon.children(".".concat(u)).attr("fill",e.color),e.tooltipText&&this.applyTooltip(this.pendingChangesIcon,e.tooltipText,this.services.onRenderTooltip,e.showTooltip),this.pendingChangesText.text(e.tooltipLabel),e.tooltipLabel||this.pendingChangesText.css("display","none"),"left"===e.position?(this.pendingChangesIcon.css("order","1"),this.pendingChangesText.css("order","2"),this.textElement.css("order","3")):(this.pendingChangesText.css("order","1"),this.pendingChangesIcon.css("order","3"),this.textElement.css("order","2"))},g.prototype.addSpacer=function(){this.spacer=InJs.DomFactory.div(),this.spacer.addClass("slicer-header-spacer").appendTo(this.title)},g.prototype.addTitle=function(){var t=this,e=(this.title=InJs.DomFactory.div(),this.title.addClass("slicer-header-title").appendTo(this.header),this.services.localize(l.SlicerUtil.DisplayNameKeys.Clear));this.clearButton=InJs.DomFactory.span().addClass("slicer-header-clear").toggleClass(l.SlicerUtil.Selectors.EnableHover.class,l.SlicerUtil.enableHover()).attr("aria-label",e).attr("role","button").attr("tabindex","0").on("keydown",function(e){"Space"!==e.key&&"Enter"!==e.key||t.settings.onClear&&(t.settings.onClear(),e.stopPropagation())}).appendTo(this.title),this.applyTooltip(this.clearButton,e,this.services.onRenderTooltip),this.clearButton.click(function(){t.settings.onClear&&t.settings.onClear()}),g.addHoverInOut(this.settings.hoverContainer,function(){t.settings.strictSingleSelect||(t.clearButton.css("visibility","visible"),t.clearButton.css("display","block"))},function(){t.settings.areControlButtonsAlwaysVisible||(_.isEmpty(t.data.text)?t.clearButton.css("visibility","hidden"):t.clearButton.css("display","none"))}),this.textElement=$("<h3></h3>").addClass("slicer-header-text").appendTo(this.title),this.addPendingChangesText(),this.addPendingChangesIcon(),this.addSpacer()},g.prototype.applyTooltip=function(e,t,i,r){var o=null;(r=void 0===r||r)?(e.on("focus mouseenter",function(){o=i(e.get(0),t)}),e.on("blur mouseleave",function(){null!=o&&o.close(),o=null}),e.on("keydown",function(e){null!==o&&"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),o.close(),o=null)})):(null!=o&&o.close(),e.off("focus mouseenter blur mouseleave keydown"))},g.prototype.updateTitle=function(){var e,t,i,r;this.data.show?(e=a.fromPoint(this.data.textSize),t=!1,this.settings.areControlButtonsAlwaysVisible&&(this.settings.strictSingleSelect||(this.clearButton.css("visibility","visible"),this.clearButton.css("display","block")),0!==this.services.getViewMode())&&this.selectMenuContainer&&(this.selectMenuContainer.css("visibility","visible"),this.selectMenuContainer.css("display","flex")),this.data.searchEnabled&&(i=g.DefaultData(this.style,this.settings.text,this.services),t=(this.featureSwitches.outlineDropdownToCheckboxes?this.data.outlineStyle===i.outlineStyle:this.data.outline===i.outline)&&this.data.outlineWeight===i.outlineWeight&&this.data.outlineColor===i.outlineColor),this.title.show(),i=this.featureSwitches.outlineDropdownToCheckboxes?this.data.outlineStyle:this.data.outline,this.title.css({"border-style":t?"none":this.data.borderStyle,"border-color":this.data.outlineColor,"border-width":l.VisualBorderUtil.getBorderCss(i,this.data.outlineWeight),"background-color":_.isEmpty(this.data.background)?"":this.data.background,"font-size":e}),this.clearButton.css({"font-size":e}),this.updateTextElementStyle(this.textElement),this.updateTextElementStyle(this.pendingChangesText),this.updateTitleText(),r=this.data,this.clearButton.css("color",this.data.iconColor).hover(function(){$(this).css("color",r.iconHoverColor)},function(){$(this).css("color",r.iconColor)}),this.updatePendingChangesIcon()):this.title.hide()},g.prototype.updateTextElementStyle=function(e){null!=e&&e.css({"font-size":a.fromPoint(this.data.textSize),"font-family":this.data.fontFamily,color:this.data.fontColor,"font-weight":this.data.labelBold?t.boldValue:t.normalValue,"font-style":this.data.labelItalic?t.italicValue:t.normalValue,"text-decoration":this.data.labelUnderline?t.underlineValue:t.noneValue})},g.prototype.updateTitleText=function(){var e,t=this.data.text;this.data.showRestatement&&this.settings.restatement&&(e=this.services.localize("NamePattern_Colon"),t=s.format(e,t,this.settings.restatement)),this.textElement.text(t).attr("title",t).attr("aria-label",t)},g.prototype.updateSelectMenu=function(){this.selectMenu&&0===this.services.getViewMode()?this.selectMenuContainer.hide():this.selectMenu&&(this.selectMenuContainer.show(),this.selectMenu.update({options:this.getSelectMenuOptions(),selectedValue:this.settings.selectedValue,disabled:2===this.settings.visibilityState}))},g.prototype.getSelectMenuOptions=function(){for(var e=[],t=0,i=this.settings.slicerModeOptions;t<i.length;t++){var r=i[t],o=r.displayName({get:this.services.localize});e.push({text:o,value:r.value})}return e},g.prototype.addWarnings=function(e){l.SlicerUtil.addWarningsToSlicerVisual(this.data.warnings,e)},g.addHoverInOut=function(e,t,i){l.SlicerUtil.enableHover()&&e.hover(t,i)},c.SlicerHeader=g}(powerbi=powerbi||{}),function(a){var w,r,o,n,e,x,t,i,D,s,l,c,d,u,p;function h(){}function S(){}w=a.visuals||(a.visuals={}),i=jsCommon.BrowserUtils,D=a.visuals.builder,s=jsCommon.Color,l=jsCommon.EnumExtensions,c=jsCommon.PixelConverter,d=a.data.SQExprBuilder,u=a.data.SemanticFilter,p=jsCommon.CssConstants,r=w.SlicerUtil||(w.SlicerUtil={}),e=o=r.Selectors||(r.Selectors={}),t=jsCommon.CssConstants.createClassAndSelector,e.ClearSearchTextButton=t("clearSearchTextButton"),e.HeaderContainer=t("headerContainer"),e.Header=t("slicerHeader"),e.Hidden=t("hidden"),e.Icon=t("icon"),e.TitleHeader=t("titleHeader"),e.HeaderText=t("headerText"),e.Body=t("slicerBody"),e.Label=t("slicerLabel"),e.LabelText=t("slicerText"),e.LabelImage=t("slicerImage"),e.CountText=t("slicerCountText"),e.SearchHeader=t("searchHeader"),e.SearchIconClass=t("searchIcon"),e.SearchInput=t("searchInput"),e.SearchHeaderCollapsed=t("collapsed"),e.SearchHeaderShow=t("show"),e.MultiSelectEnabled=t("isMultiSelectEnabled"),e.EnableHover=t("enable-hover"),e.DisableScrollHover=t("disableScrollHover"),(e=n=r.DisplayNameKeys||(r.DisplayNameKeys={})).SelectAll="SelectAll",e.Search="SearchBox_Text",(r.SettingsHelper||(r.SettingsHelper={})).areSettingsDefined=function(e){return null!=e&&null!=e.slicerSettings},r.readMetadataColumns=function(e){if(!_.isEmpty(e)){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];if(o.roles&&o.roles[w.slicerRoles.value]&&void 0!==o.index)if(o.rolesIndex&&o.rolesIndex[w.slicerRoles.value])for(var n=0,a=o.rolesIndex[w.slicerRoles.value];n<a.length;n++)t[a[n]]=o;else t.push(o)}return t}},r.buildDataPointInfo=function(e,t){var i={dataMap:{},metadata:[t[e.level]]},r=[],o=[],n=e;for(r.push(e),o.push(e.levelIndex);n.parent;)n=n.parent,r.unshift(n),o.unshift(n.levelIndex);for(var a=0,s=r;a<s.length;a++){var l=s[a],c=t[l.level];i.dataMap[c]=[l.scopeIdentity]}return{selector:i,path:o}},r.buildContainsFilter=function(e,t){var i;if(!_.isEmpty(t)&&!_.isEmpty(e)){for(var r=d.text(t),o=void 0,n=0,a=e;n<a.length;n++)var s=a[n],s=d.contains(s,r),o=o?d.or(o,s):s;i=u.fromSQExpr(o)}return i},(r.DefaultValueHandler||(r.DefaultValueHandler={})).getIdentityFields=function(e){if(e){e=e.categorical;if(e&&!_.isEmpty(e.categories))return e.categories[0].identityFields}},r.tryRemoveValueFromRetainedList=function(e,t,i){if(e&&!_.isEmpty(t))for(var r=0,o=t.length;r<o;r++){var n=t[r];if(a.DataViewScopeIdentity.equals(e,n.identity,i))return t.splice(r,1)[0]}},r.getSlicerDataPointCheckedState=function e(t,i){i=t.parent?e(t.parent,i):i;return t.selected?!i:i},r.clearSlicerFilter=function(e,t){var t={remove:[{objectName:"general",selector:null,properties:{filter:!0}}],replace:[{objectName:"data",selector:null,properties:((i={})[w.slicerProps.data.mode.propertyName]=t,i)}]},i=(e.persistProperties(t),e.onSelect({type:0,visualObjects:[]}),e.getLocalizedString("Slicer_ClearSelectionsCleared"));e.alertWithDebounce("announce-clear-selection",i)},r.addWarningsToSlicerVisual=function(e,t){var i,r=(e=e.complete())?e.visualObjectWarnings:void 0;for(i in r)t.addForVisualObject.apply(t,__spreadArray([i],r[i]||[],!1))},r.getDataPointKey=function(e){return e.identity.getKey()},r.clearFilters=function(e,t){e.handleClearSelection(),e.persistSelectionFilter(w.slicerProps.general.filter,null,!0!==t)},r.clearSearchFilter=function(e){e.setSearchMode(!0),e.persistSelfFilter(w.slicerProps.general.selfFilter,null)},r.isDataViewColumnMapped=function(e){return _.some(e.columns,function(e){return 1===(null==(e=e.parameter)?void 0:e.kind)})},r.doDataViewColumnSupportMultipleValues=function(e){return _.some(e.columns,function(e){return null==(e=e.parameter)?void 0:e.supportsMultipleValues})},r.doDataViewColumnSupportSelectAll=function(e){return _.some(e.columns,function(e){return null==(e=e.parameter)?void 0:e.supportsSelectAll})},r.updateDisableState=function(e,t){e.attr("disabled",!!t.disabled||void 0)},r.getTooltipText=function(e,t){return""!==t?t:e.getLocalizedString("NullValue")},h.prototype.onPopupHideEvent=function(e,t,i,r){var o=this;return this.popup=i,this.popupHideEventHandler=e,this.boundBox=t,this.originalOffset=$(t).offset(),this.scrollEventHandler=function(e){return o.scrollEventReceived(e)},this.focusEventHandler=function(e){return o.focusInEventReceived(e,r)},this.popupHideEvent=function(e){return o.popupHideEventReceived(e)},this.mouseEventHandler=function(e){return o.onMouseDown(e,r)},this.bindPopupHideHandlers(),$.proxy(this.unbindPopupHideHandlers,this)},h.prototype.popupHideEventReceived=function(e){this.popupHideEventHandler(e.type,e.target)},h.prototype.scrollEventReceived=function(e){var t;!this.boundBox||(t=$(this.boundBox).offset()).left===this.originalOffset.left&&t.top===this.originalOffset.top||(this.originalOffset=t,this.popupHideEventHandler(e.type,e.target))},h.prototype.focusInEventReceived=function(e,t){!this.popup||this.popup.contains(e.target)||t&&this.isContextMenuElement(e.target)||this.popupHideEventHandler(e.type,e.target)},h.prototype.onMouseDown=function(e,t){2===e.button&&t&&(!this.popup||this.popup.contains(e.target)||this.isContextMenuElement(e.target))||this.popupHideEventHandler(e.type,e.target)},h.prototype.bindPopupHideHandlers=function(){document.addEventListener("mousedown",this.mouseEventHandler,!0),document.addEventListener("pointerdown",this.mouseEventHandler,!0),document.addEventListener("touchstart",this.popupHideEvent,!0),$(window).on("resize",$.proxy(this.popupHideEventReceived,this)),$(this.boundBox).on("destroy",$.proxy(this.popupHideEventReceived,this)),document.addEventListener("scroll",this.scrollEventHandler,!0),document.addEventListener("focusin",this.focusEventHandler,!0)},h.prototype.unbindPopupHideHandlers=function(){document.removeEventListener("mousedown",this.mouseEventHandler,!0),document.removeEventListener("pointerdown",this.mouseEventHandler,!0),document.removeEventListener("touchstart",this.popupHideEvent,!0),$(window).off("resize",this.popupHideEventReceived),document.removeEventListener("scroll",this.scrollEventHandler,!0),$(this.boundBox).off("destroy",this.popupHideEventReceived),document.removeEventListener("focusin",this.focusEventHandler,!0)},h.prototype.isContextMenuElement=function(e){return 0<$(e).parents("drop-down-list:first").length},r.EventsHelper=h,S.prototype.addSearch=function(e,t){t=t.append("div").classed(o.SearchHeader.class,!0).classed(o.SearchHeaderCollapsed.class,!0);return t.append("span").classed("powervisuals-glyph search",!0).classed(o.Icon.class,!0).classed(o.SearchIconClass.class,!0).attr("title",e.getLocalizedString(n.Search)),t.append("input").attr("type","text").attr("aria-label",e.getLocalizedString(n.Search)).attr("placeholder",e.getLocalizedString(n.Search)).attr("spellcheck",!1).classed(o.SearchInput.class,!0).attr("drag-resize-disabled","true"),t},S.prototype.addClearSearchButton=function(e,t){var i=t.append("span").classed("powervisuals-glyph x",!0).classed(o.Icon.class,!0).classed(o.ClearSearchTextButton.class,!0);return t.select(r.Selectors.SearchInput.selector).attr("placeholder",e.getLocalizedString(n.Search)),i},S.prototype.configureSearchBoxIcon=function(e,t){t=_.isEmpty(t);e.select(r.Selectors.SearchIconClass.selector).classed(r.Selectors.Hidden.class,!t),e.select(r.Selectors.ClearSearchTextButton.selector).classed(r.Selectors.Hidden.class,t)},S.prototype.getRowHeight=function(e,t,i){i=i.outlineDropdownToCheckboxes?e.slicerText.outlineStyle:e.slicerText.outline;return a.TextMeasurementService.estimateSvgTextHeight(this.getTextProperties(e.slicerText.textSize,e.slicerText.fontFamily,t))+this.getRowsOutlineWidth(i,e.general.outlineWeight)},S.prototype.setSlicerTextStyle=function(e,t,i){var i=i.outlineDropdownToCheckboxes?t.slicerText.outlineStyle:t.slicerText.outline,r=(e.styles({color:t.slicerText.color,"background-color":t.slicerText.background,"border-style":"solid","border-color":t.general.outlineColor,"border-width":w.VisualBorderUtil.getBorderCss(i,t.general.outlineWeight),"font-size":c.fromPoint(t.slicerText.textSize),"font-family":t.slicerText.fontFamily,"line-height":Math.floor(1.79*t.slicerText.textSize)+"px","font-weight":t.slicerText.labelBold?p.boldValue:p.normalValue,"font-style":t.slicerText.labelItalic?p.italicValue:p.normalValue,"text-decoration":t.slicerText.labelUnderline?p.underlineValue:p.noneValue}),this.calculateSlicerTextHighlightColor(t.slicerText.color));e.on("mouseover",function(e){d3.select(this).styles({color:r})}),e.on("mouseout",function(e){d3.select(this).styles({color:t.slicerText.color})})},S.prototype.getRowsOutlineWidth=function(e,t){var i,r;if("number"==typeof e)return i=l.hasFlag(e,1),r=l.hasFlag(e,4),i&&r?2*t:i||r?t:0;switch(e){case w.outline.none:case w.outline.leftRight:return 0;case w.outline.bottomOnly:case w.outline.topOnly:return t;case w.outline.topBottom:case w.outline.frame:return 2*t;default:return 0}},S.prototype.calculateSlicerTextHighlightColor=function(e){e=s.parseColorString(e);return e&&255===e.R&&255===e.G&&255===e.B?"#C8C8C8":s.calculateHighlightColor(e,.8,.2)},S.prototype.getTextProperties=function(e,t,i){return i.fontSize=c.fromPoint(e),i.fontFamily=t,i},r.DOMHelper=S,r.enableHover=function(){return!i.isIOSWebView()&&!i.isAndroidWebView()},r.getUpdatedDataViewObjects=function(e,t){var i;return 0===t&&1===e.length&&e[0].objectName===w.slicerProps.data.mode.objectName&&e[0].propertyName===w.slicerProps.data.mode.propertyName?(t=[],t=(i=e[0].propertyValue)===w.slicerMode.verticalList||i===w.slicerMode.horizontalList?[{objectName:w.slicerProps.data.mode.objectName,propertyName:w.slicerProps.data.mode.propertyName,propertyValue:w.slicerMode.basic,propertyType:{enumeration:w.slicerMode.type}},{objectName:w.slicerProps.general.orientation.objectName,propertyName:w.slicerProps.general.orientation.propertyName,propertyValue:i===w.slicerMode.horizontalList?1:0,propertyType:{enumeration:w.slicerOrientation.type}}]:__spreadArray([],e,!0),i={objectName:w.slicerProps.general.filter.objectName,propertyName:w.slicerProps.general.filter.propertyName,propertyValue:null,propertyType:{filter:{}}},t.push(i),t):e},x=w.SlicerUtil||(w.SlicerUtil={}),(t=x.ObjectEnumerator||(x.ObjectEnumerator={})).enumerateObjectInstances=function(e,t,i,r,o){if(t)switch(e.objectName){case"items":var n=t,a=i,s=o,l=((c=x.SettingsHelper.areSettingsDefined(n)&&n.slicerSettings.slicerText)&&n.slicerSettings.slicerText.color?n.slicerSettings:a).slicerText.color,c=(c&&n.slicerSettings.slicerText.background?n.slicerSettings:a).slicerText.background,l={fontColor:l,background:c,textSize:a.slicerText.textSize,fontFamily:a.slicerText.fontFamily};return s.outlineDropdownToCheckboxes?l.outlineStyle=a.slicerText.outlineStyle:l.outline=a.slicerText.outline,s&&s.enableBIU&&(l.bold=a.slicerText.labelBold,l.italic=a.slicerText.labelItalic,l.underline=a.slicerText.labelUnderline),!_.isEmpty(n.queryNameByLevel)&&1<n.queryNameByLevel.length&&(l.steppedLayoutIndentation=a.expandCollapse.indentation,l.expandCollapseToggleType=a.expandCollapse.toggleType),[{selector:null,objectName:"items",properties:l}];case"selection":var c=t,s=i,n=r,a=x.SettingsHelper.areSettingsDefined(c)&&c.slicerSettings.selection,l=(a&&c.slicerSettings.selection.selectAllCheckboxEnabled?c.slicerSettings:s).selection.selectAllCheckboxEnabled,d=(a&&void 0!==c.slicerSettings.selection.singleSelect?c.slicerSettings:s).selection.singleSelect;return(a=(a&&void 0!==c.slicerSettings.selection.strictSingleSelect?c.slicerSettings:s).selection.strictSingleSelect)||!x.isDataViewColumnMapped(n.metadata)||x.doDataViewColumnSupportMultipleValues(n.metadata)||(a=!0),c={selector:null,objectName:"selection",properties:{strictSingleSelect:a}},a||(c.properties.singleSelect=d,c.properties.selectAllCheckboxEnabled=l),[c]}},t.getValuesCard=function(t,e,i,r,o){var n,a,s,l,c;if(e)return l=x.SettingsHelper.areSettingsDefined(e)&&e.slicerSettings.slicerText,n=(l&&e.slicerSettings.slicerText.color?e.slicerSettings:i).slicerText.color,a=(l&&e.slicerSettings.slicerText.background?e.slicerSettings:i).slicerText.background,s=w.slicerProps.items,l=new D.FormattingCardBuilder(new D.FormattingCardUidBuilder("values"),"Role_DisplayName_Values",[s.fontFamily,s.textSize,s.bold,s.italic,s.underline,s.fontColor,s.padding,s.outline,s.outlineStyle,w.slicerProps.general.outlineColor,w.slicerProps.general.outlineWeight,s.background],function(e){return t.getLocalizedString(e)}),e=(new w.builder.FontControlBuilder).withFontFamily({descriptor:s.fontFamily,value:i.slicerText.fontFamily}).withFontSizeProperties({descriptor:s.textSize,value:i.slicerText.textSize}),o&&o.enableBIU&&e.withBold({descriptor:s.bold,value:i.slicerText.labelBold}).withItalic({descriptor:s.italic,value:i.slicerText.labelItalic}).withUnderline({descriptor:s.underline,value:i.slicerText.labelUnderline}),c=e.build(),l.addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("fontselector","Font",c).addSimpleSlice("color",function(){return new D.ColorPickerBuilder({descriptor:s.fontColor,value:{value:n}}).build()}),o&&o.slicerAccessibility&&e.addSimpleSlice("padding",function(){return new D.NumUpDownBuilder({descriptor:s.padding,value:i.items.padding,options:{minValue:{type:0,value:0},maxValue:{type:1,value:999},unitSymbol:"Numeric_Pixel"}}).build()})}).addGroup("border",function(e){e.withDisplayName("Visual_Border"),o.outlineDropdownToCheckboxes?e.addSimpleSlice("border position",new D.FlagSelectionBuilder({descriptor:s.outlineStyle,value:i.slicerText.outlineStyle}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("border position",new D.DropdownBuilder({descriptor:s.outline,value:i.slicerText.outline}).build(),function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("color",function(){var e={value:i.general.outlineColor};return new D.ColorPickerBuilder({descriptor:__assign(__assign({},w.slicerProps.general.outlineColor),{instanceKind:r?3:1}),value:e}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")}).addSimpleSlice("lineWidth",new D.SliderBuilder({descriptor:w.slicerProps.general.outlineWeight,value:i.general.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}},localize:function(e){return t.getLocalizedString(e)}}).build(),function(e){return e.withCustomDisplayName("Visual_Line_Width")})}).addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",function(){return new D.ColorPickerBuilder({descriptor:s.background,value:{value:a}}).build()},function(e){return e.withCustomDisplayName("Visual_Background_Color")})}),l.build()},t.getAdditionalCards=function(t,e,i,r){var o,n;if(e)return o=w.slicerProps.items,n=new D.FormattingCardBuilder(new D.FormattingCardUidBuilder("hierarchy"),"Hierarchy",[o.steppedLayoutIndentation,o.expandCollapseToggleType],function(e){return t.getLocalizedString(e)}),!_.isEmpty(e.queryNameByLevel)&&1<e.queryNameByLevel.length?(n.addGroup("levels",function(e){e.withDisplayName("Slicer_Hierarchy_Levels").addSimpleSlice("steppedIndentation",function(){return new D.SliderBuilder({descriptor:o.steppedLayoutIndentation,value:i.expandCollapse.indentation,options:{minValue:{type:0,value:0},maxValue:{type:1,value:40}},localize:function(e){return t.getLocalizedString(e)}}).build()})}).addGroup("expandCollapseButtons",function(e){e.withDisplayName("Slicer_ExpandCollapse").addSimpleSlice("expand/collapseIcon",function(){return new D.DropdownBuilder({descriptor:o.expandCollapseToggleType,value:i.expandCollapse.toggleType}).build()})}),[n.build()]):void 0},t.getSlicerSettingsFormattingOptions=function(e){var t=e.cardUidBuilder,i=e.currentSlicerSettings,r=e.data,o=e.dataView,n=e.hostServices,a=e.orientation,s=e.slicerModes,l=e.featureSwitches,c=e.activeMode;if(r||!w.slicerMode.isSlicerBasicOrDropdownType(c)){var e=[],d=[],u=r&&r.slicerSettings,p=new D.FormattingGroupBuilder(new D.FormattingGroupUidBuilder(t,"options"),function(e){return n.getLocalizedString(e)});if(d.push(w.slicerProps.general.selfFilterEnabled),p.withDisplayName("Desktop_FileMenu_Options"),l.updateFormattingPaneObjects&&l.moveSlicerTypeSelection){c===w.slicerMode.basic&&(c=a&&1===a?w.slicerMode.horizontalList:w.slicerMode.verticalList);for(var h=[],S=0,g=s;S<g.length;S++){var m=g[S],f=m.displayName({get:n.getLocalizedString});h.push({value:m.value,displayName:f})}l=h.filter(function(e){return e.value===c});p.addSimpleSlice("style",new D.DropdownBuilder({descriptor:w.slicerProps.data.mode,value:l&&l[0],items:h}).build()),d.push(w.slicerProps.data.mode)}else null!=a&&(p.addSimpleSlice("orientation",new D.DropdownBuilder({descriptor:w.slicerProps.general.orientation,value:a}).build()),d.push(w.slicerProps.general.orientation));var v,y,b,C,s=p.build();return 0<s.slices.length&&e.push(s),r&&i&&o&&(l=u&&u.selection,a=i.selection,v=(l&&l.selectAllCheckboxEnabled?l:a).selectAllCheckboxEnabled,y=(l&&void 0!==l.singleSelect?l:a).singleSelect,(b=(l&&void 0!==l.strictSingleSelect?l:a).strictSingleSelect)||!x.isDataViewColumnMapped(o.metadata)||x.doDataViewColumnSupportMultipleValues(o.metadata)||(b=!0),C=w.slicerProps.selection,p=new D.FormattingGroupBuilder(new D.FormattingGroupUidBuilder(t,"selection"),function(e){return n.getLocalizedString(e)}),d.push(w.slicerProps.general.selfFilterEnabled,C.strictSingleSelect,C.singleSelect,C.selectAllCheckboxEnabled),p.withDisplayName("ExpandCollapseNode").addSimpleSlice("strictSingleSelect",function(){return new D.ToggleSwitchBuilder({descriptor:C.strictSingleSelect,value:b}).build()}),b||p.addSimpleSlice("singleSelect",function(){return new D.ToggleSwitchBuilder({descriptor:C.singleSelect,value:y}).build()}).addSimpleSlice("selectAllCheckboxEnabled",function(){return new D.ToggleSwitchBuilder({descriptor:C.selectAllCheckboxEnabled,value:v}).build()}),e.push(p.build())),{groups:e,revertToDefaultDescriptors:d}}}}(powerbi=powerbi||{}),function(e){var t;e=(e=(e=e.visuals||(e.visuals={})).SlicerUtil||(e.SlicerUtil={})).Selectors||(e.Selectors={}),t=jsCommon.CssConstants.createClassAndSelector,e.Clear=t("clear")}(powerbi=powerbi||{}),function(e){((e=(e=e.visuals||(e.visuals={})).SlicerUtil||(e.SlicerUtil={})).DisplayNameKeys||(e.DisplayNameKeys={})).Clear="Slicer_Clear"}(powerbi=powerbi||{}),function(e){var n,i,a;function s(){}n=e.visuals||(e.visuals={}),i=e.visuals.slicerMode,a=e.visuals.SlicerResponsiveBreakpoints,s.prototype.applySlicerChanges=function(e,t,i){return t=this.shouldApplyResponsiveChanges(i,t.mode,t.orientation)?this.applyResponsiveSlicerChanges(e,t):t},s.prototype.applySlicerHeaderChanges=function(e,t,i,r,o){return t=t.show&&this.shouldApplyResponsiveChanges(i,r.mode,r.orientation)?this.applyResponsiveSlicerHeaderChanges(e,t,r,o):t},s.prototype.enumerateObjectInstances=function(e,t,i,r,o){this.doesSlicerModeSupportsResponsive(r,o)&&"general"===e.objectName&&this.enumerateGeneral(i,t)},s.prototype.enumerateGeneral=function(e,t){t[0].selector;e={selector:null,properties:{responsive:n.ViewModelAdapterUtils.getResponsiveVisualProperties(e,n.slicerProps).responsive},objectName:"general"};_.merge(t[0],e)},s.prototype.getResponsiveSlice=function(e,t,i,r){if(this.doesSlicerModeSupportsResponsive(t,i))return t=n.slicerProps.general,i=n.ViewModelAdapterUtils.getResponsiveVisualProperties(e,n.slicerProps),{item:new n.builder.SimpleFormattingSliceBuilder({uidBuilder:new n.builder.FormattingSliceUidBuilder(new n.builder.FormattingGroupUidBuilder(new n.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new n.builder.ToggleSwitchBuilder({descriptor:t.responsive,value:i.responsive}).build(),localize:r}).build(),revertToDefaultDescriptors:[t.responsive]}},s.prototype.shouldApplyResponsiveChanges=function(e,t,i){return this.doesSlicerModeSupportsResponsive(t,i)&&n.ViewModelAdapterUtils.shouldApplyResponsiveChanges(e,n.slicerProps)},s.prototype.doesSlicerModeSupportsResponsive=function(e,t){return s.isRangeSlicerMode(e)||s.isHorizontalSlicer(e,t)},s.prototype.applyResponsiveSlicerChanges=function(e,t){t=n.ViewModelAdapterUtils.cloneData(t);return this.applyIconResponsiveChanges(e,t),this.applyResponsiveSlicerHorizontalChanges(t),t},s.prototype.applyResponsiveSlicerHeaderChanges=function(e,t,i,r){var o=n.ViewModelAdapterUtils.cloneData(t);return this.applyHeaderChanges(e,i,o,r),this.updateResponsiveHeaderWarnings(o,t),o},s.prototype.applyIconResponsiveChanges=function(t,e){var i;s.isRangeSlicerMode(e.mode)?i=a.rangeSlicer.iconBreakpoints:s.isHorizontalSlicer(e.mode,e.orientation)?i=a.horizontalSlicer.iconBreakpoints:"not supported slicer (mode: ".concat(e.mode,", orientation: ").concat(e.orientation,") should never arrive this function."),_.some(i,function(e){return t.height<=e.height&&t.width<=e.width})&&(e.showIcon=!0)},s.prototype.applyResponsiveSlicerHorizontalChanges=function(e){s.isHorizontalSlicer(e.mode,e.orientation)&&(e.showTabularSlicer=!0)},s.prototype.applyHeaderChanges=function(e,t,i,r){s.isRangeSlicerMode(t.mode)?(o=a.rangeSlicer,i.show=r?e.height>=o.hideHeaderHeightSlider:e.height>=o.hideHeaderHeightNoSlider):s.isHorizontalSlicer(t.mode,t.orientation)?(o=a.horizontalSlicer,i.show=e.height>=o.hideHeaderHeight):"not supported slicer (mode: ".concat(t.mode,", orientation: ").concat(t.orientation,") should never arrive this function.");var o,r=n.SlicerViewModelAdapterUtils.resolveMaxFontSizePtForViewport(e,a.slicerHeader.fontSize);i.textSize=Math.min(i.textSize,r)},s.prototype.updateResponsiveHeaderWarnings=function(e,t){var i;e.show!==t.show?i=new n.SlicerHeaderNotRenderedWarning:e.textSize!==t.textSize&&(i=new n.SlicerHeaderFontSizeWarning),i&&e.warnings.addForVisualObject("header",{selector:null,warnings:[i]})},s.isRangeSlicerMode=function(e){return i.isRangeSlicerMode(e)},s.isHorizontalSlicer=function(e,t){return e===i.basic&&1===t},n.SlicerViewModelAdapter=s}(powerbi=powerbi||{}),function(i){var r;function t(){}r=i.visuals||(i.visuals={}),t.prototype.applyChanges=function(e,t,i){return t=r.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,r.slicerProps)?this.applyResponsiveRangeSlicerChanges(e,t):t},t.prototype.applyResponsiveRangeSlicerChanges=function(e,t){t=i.Prototype.inherit(t);return this.applyRangeSlicerDataChanges(t),this.applySliderChanges(t),t},t.prototype.applySliderChanges=function(e){e.sliderSettings=i.Prototype.inherit(e.sliderSettings),e.sliderSettings.drawRoundSliderHandles=!0,e.sliderSettings.minSliderVisibilityHeight=t.MinSliderVisibilityHeight,e.sliderSettings.minSliderVisibilityWidth=t.MinSliderVisibilityWidth},t.prototype.applyRangeSlicerDataChanges=function(e){e.wrapRangeBoxes=!0},t.MinSliderVisibilityHeight=35,t.MinSliderVisibilityWidth=0,r.RangeSlicerViewModelAdapter=t}(powerbi=powerbi||{}),function(i){var o;function e(){}o=i.visuals||(i.visuals={}),e.prototype.applyChanges=function(e,t,i){var r=t;return o.ViewModelAdapterUtils.shouldApplyResponsiveChanges(i,o.slicerProps)&&(r=this.applyResponsiveSlicerChanges(e,r),this.updateWarnings(r,t)),r},e.prototype.applyResponsiveSlicerChanges=function(e,t){t=i.Prototype.inherit(t);return this.applyFontSizeChanges(e,t),t},e.prototype.applyFontSizeChanges=function(e,t){e=o.SlicerViewModelAdapterUtils.resolveMaxFontSizePtForViewport(e,o.SlicerResponsiveBreakpoints.horizontalSlicer.fontSize);t.slicerSettings.slicerText.textSize>e&&(t.slicerSettings=i.Prototype.inherit(t.slicerSettings),t.slicerSettings.slicerText=i.Prototype.inherit(t.slicerSettings.slicerText),t.slicerSettings.slicerText.textSize=e)},e.prototype.updateWarnings=function(e,t){e.slicerSettings.slicerText.textSize!==t.slicerSettings.slicerText.textSize&&(t=new o.HorizontalSlicerFontSizeWarning,e.warnings.addForVisualObject("items",{selector:null,warnings:[t]}))},o.HorizontalSlicerViewModelAdapter=e}(powerbi=powerbi||{}),function(r){var n,o,e,t,a;function s(){}n=r.visuals||(r.visuals={}),a=jsCommon.Utility,s.prototype.renderCore=function(e){e.classed(o.Tabular.class,!0)},s.prototype.bindData=function(e,t,i){return this.renderColumns(e,i).selectAll(n.HorizontalSlicer.Selectors.IndividualItemContainer.selector).data(function(e){return e},function(e){return n.SlicerUtil.getDataPointKey(e)})},s.prototype.renderColumns=function(e,t){var i=this.numberOfRows,e=_.chunk(e,i),r=t.selectAll(o.ColumnItemContainer.selector).style("height",null).data(e),r=(r.exit().remove(),r.enter().append("div").classed(o.ColumnItemContainer.class,!0).merge(r));return this.scaleLastColumnIfNeeded(i,e,t),r},s.prototype.scaleLastColumnIfNeeded=function(e,t,i){t&&_.last(t)&&(t=_.last(t).length)<e&&(i=i.select(o.ColumnItemContainer.selector+":last-child"),t=r.Double.roundToPrecision(100*t/e,.01),i.style("height",t+"%"))},s.prototype.findNextElement=function(e,t){if($(e).hasClass(n.HorizontalSlicer.Selectors.ItemsContainer.class))return t?e.firstElementChild.firstElementChild:e.lastElementChild.lastElementChild;if(t){var i=e.nextElementSibling;if(!i&&(r=e.parentElement).nextElementSibling)return r.nextElementSibling.firstElementChild}else{var r,i=e.previousElementSibling;if(!i&&(r=e.parentElement).previousElementSibling)return r.previousElementSibling.lastElementChild}return i},s.prototype.getScrollSize=function(e){return this.numberOfRows},s.prototype.getLastStartIndex=function(e,t){var i;return t<=e?0:(t=t-e+(e=(e=0)<(i=t%(t=this.numberOfRows))?t-i:e),Math.max(t,0))},s.prototype.calculateTotalItemDimensions=function(e,t){return e=Math.max(e,s.MinItemWidth),t=Math.max(t,s.MinItemHeight),{width:e+=2*s.TabularMargin,height:t+=2*s.TabularMargin}},s.prototype.calculateNumberOfItemsToDisplay=function(e,t,i,r){var e=e.find(n.SlicerUtil.Selectors.Body.selector),o=e.width()-2*s.NavigationArrowWidth,e=e.height();return this.calculateTableDimensions({height:e,width:o},{height:i,width:t},r)},s.prototype.calculateTableDimensions=function(e,t,i){var r=t.width,t=t.height,o=e.width,e=e.height;return 0===r?0:(o=Math.floor(o/r),this.numberOfRows=0===t?1:Math.floor(e/t),this.numberOfRows=a.clampValue(this.numberOfRows,1,i),(r=Math.ceil(Math.sqrt(i)))<=o&&this.numberOfRows>=r?this.numberOfRows=o=r:this.numberOfRows>=i&&1<o&&(this.numberOfRows=Math.ceil(this.numberOfRows/o)),e=this.numberOfRows*o,a.clampValue(e,this.numberOfRows,i))},s.prototype.getNavigationArrowsClass=function(e,t){t?e.classed(o.TabularNavigationArrow.class,!0).classed(n.HorizontalSlicer.Selectors.LeftNavigationArrow.class,!0).classed(o.PbiVisualsGlyph.class,!0).classed(o.TabularLeftNavigationArrow.class,!0):e.classed(o.TabularNavigationArrow.class,!0).classed(n.HorizontalSlicer.Selectors.RightNavigationArrow.class,!0).classed(o.PbiVisualsGlyph.class,!0).classed(o.TabularRightNavigationArrow.class,!0)},s.prototype.getDataPointRightMargin=function(e,t){return"0px"},s.MinItemWidth=40,s.MinItemHeight=40,s.TabularMargin=2,s.NavigationArrowWidth=19,n.TabularSlicerLayout=s,e=o=o||{},t=jsCommon.CssConstants.createClassAndSelector,e.Tabular=t("tabular"),e.ColumnItemContainer=t("columnItemContainer"),e.PbiVisualsGlyph=t("powervisuals-glyph"),e.TabularNavigationArrow=t("tabularNavigationArrow"),e.TabularLeftNavigationArrow=t("left-nav-arrow"),e.TabularRightNavigationArrow=t("right-nav-arrow")}(powerbi=powerbi||{}),function(d){var a,g=d.visuals||(d.visuals={}),t=jsCommon.BrowserUtils,c=jsCommon.PixelConverter,r=d.data.SQExpr,o=jsCommon.FocusNavigationUtility;function u(e,t,i){this.lockKeyboardNavigation=i=void 0===i?!0:i,this.hasSearchableData=!1,this.scrollPositionStack=[],this.defaultMinWidth=50,this.shouldResetScrollPosition=!1,this.isCollapse=!1,this.expandable=!1,this.pendingFocusCall=!1,this.focusCallback=null,this.verticalSlicerStrategy=e,this.behavior=new g.SlicerWebBehavior,this.domHelper=new g.SlicerUtil.DOMHelper,this.hostServices=t.hostServices,t&&(i=t.featureSwitches,this.featureSwitches=t.featureSwitches,this.expressionBasedFormatting=i&&i.expressionBasedFormatting),this.factory=d.createJQueryPromiseFactory(),this.searchComponent=new l(this.featureSwitches,this.hostServices)}function e(){}function i(){}u.prototype.hasSlider=function(){return!1},u.prototype.supportsOrientation=function(){return!this.dataView||!this.data||_.isEmpty(this.data.queryNameByLevel)||1===this.data.queryNameByLevel.length},u.prototype.enumerateObjectInstances=function(e){return g.SlicerUtil.ObjectEnumerator.enumerateObjectInstances(e,this.data,this.settings,this.dataView,this.featureSwitches)},u.prototype.getValuesCard=function(){return g.SlicerUtil.ObjectEnumerator.getValuesCard(this.hostServices,this.data,this.settings,this.expressionBasedFormatting,this.featureSwitches)},u.prototype.getSlicerSettingsCardOptions=function(e,t,i,r){return g.SlicerUtil.ObjectEnumerator.getSlicerSettingsFormattingOptions({cardUidBuilder:e,currentSlicerSettings:this.settings,data:this.data,dataView:this.dataView,hostServices:this.hostServices,orientation:t,activeMode:i,slicerModes:r,featureSwitches:this.featureSwitches})},u.prototype.getAdditionalCards=function(){return g.SlicerUtil.ObjectEnumerator.getAdditionalCards(this.hostServices,this.data,this.settings,this.dataView)},u.prototype.onModeChange=function(e){g.SlicerUtil.clearSlicerFilter(this.hostServices,e)},u.prototype.onDataViewObjectChanged=function(e,t){e=g.SlicerUtil.getUpdatedDataViewObjects(e,t);return e},u.prototype.getRestatement=function(){return this.data&&this.data.restatement},u.prototype.onClear=function(e){g.SlicerUtil.clearSearchFilter(this.selectionHandler),g.SlicerUtil.clearFilters(this.selectionHandler,e),this.searchComponent&&(this.searchComponent.input.node().value="")},u.prototype.init=function(e,t){var i,r=this,t=(this.element=t,this.currentViewport=e.visualInitOptions.viewport,this.hostServices=e.visualInitOptions.host),t=(this.style=e.visualInitOptions.style,this.settings=g.DataConversion.DefaultSlicerProperties(this.style),this.behavior&&(i=new g.SlicerSelectionHandler(t,this.behavior)),document.createElement("div")),o=(t.className=p.Container.class,this.container=d3.select(t)),o=(this.searchComponent.create(o),this.verticalSlicerStrategy.hasClearSearchButton()&&this.searchComponent.addClearButton(),this.createBodyElement(),{rowHeight:void 0,enter:function(e){r.createDataPoints(e)},update:function(e){r.updateDataPoints(e,i)},loadMoreData:function(){return e.loadMoreData()},scrollEnabled:!0,viewport:this.currentViewport,baseContainer:this.body,isReadMode:function(){return 1!==r.hostServices.getViewMode()},scrollToFrame:e.enableMultiElementRows?function(e){return r.scrollToFrameForMultiElementRow(e)}:void 0});return this.listView=g.ListViewFactory.createListView(o),this.element.get(0).appendChild(t),this.selectionHandler=i},u.prototype.onDestroy=function(){this.listView&&this.listView.destroy()},u.prototype.render=function(e){this.renderVerticalSlicer(this.converter(e.dataView,e.isSlicer),e)},u.prototype.renderVerticalSlicer=function(e,t,i){this.focusCallback&&!o.contains(this.container.node(),document.activeElement)&&(this.focusCallback=void 0,this.listView)&&this.listView.resetCallBacks(),this.currentViewport=t.viewport,this.hasSearchableData=t.hasSearchableData;var r=t.dataView;this.searchComponent.update(this.settings,this.data&&this.data.searchKey,this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData),this.verticalSlicerStrategy.hasClearSearchButton()),this.container.node().querySelector("input.searchInput")===document.activeElement&&t.isSearchMode&&this.announceSearchResults(e.slicerDataPoints.length),this.body.select(p.EmptyResult.selector).remove(),r&&this.data&&!_.isEmpty(this.data.slicerDataPoints)?(this.expandable=1<this.data.queryNameByLevel.length,this.setBodyRole(),this.setBodyAriaLabel(),this.updateSelectionStyle(),this.listView.viewport(this.currentViewport).data(this.data.slicerDataPoints,function(e){return g.SlicerUtil.getDataPointKey(e)},t.resetScrollbarPosition&&this.shouldResetScrollPosition,i)):(this.listView&&(this.listView.empty(),this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData))&&(e=this.body.insert("p",".scroll-wrapper").classed(p.EmptyResult.class,!0).text(this.hostServices.getLocalizedString("ContentList_EmptySearchResults")),this.domHelper.setSlicerTextStyle(e,this.settings,this.featureSwitches)),i&&i())},u.prototype.converter=function(e,t){void 0===t&&(t=!1);var i=this.hostServices.getLocalizedString(g.SlicerUtil.DisplayNameKeys.SelectAll),i=g.DataConversion.convert({dataView:e,localizedSelectAllText:i,selectionHandler:this.selectionHandler,hostServices:this.hostServices,style:this.style,isSlicer:t,featureSwitches:this.featureSwitches,slicerType:0});return this.shouldResetScrollPosition=this.getShouldResetScrollPosition(e,i),this.data=i,this.isCollapse=!1,e&&this.data&&(this.settings=i.slicerSettings,this.dataView=e),i},u.prototype.hasSearchEnabled=function(){return this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData)},u.prototype.updateSelectionStyle=function(){var e=this.settings;this.container.classed("isMultiSelectEnabled",e&&e.selection&&!e.selection.singleSelect)},u.prototype.createDataPoints=function(e){var i=this,a=this,r=this.settings,e=e.append("div").classed(p.ItemContainer.class,!0),t=e.append("div").classed(p.Input.class,!0).attr("aria-hidden",!0),s=(this.verticalSlicerStrategy.customizeInputElement(t,r),this.selectionHandler.isSelectionModeInverted()),l=(e.on("contextmenu",function(e,t){d3.event.stopPropagation(),d3.event.preventDefault(),i.onContextMenu(e,{x:d3.event.clientX,y:d3.event.clientY})}),e.call(u.updateTabIndex),this.getOptionRole());e.each(function(e,t){var o=this,n=d3.select(this);this.addEventListener("keydown",function(t){var i,r,e=n.data();_.isEmpty(e)||(i=e[0],e=function(e){t.preventDefault(),t.stopPropagation(),e()},39===t.keyCode&&!0===i.isCollapsed||37===t.keyCode&&!1===i.isCollapsed?(r=document.activeElement,t.stopPropagation(),a.expandCollapseNode(i),e(function(){__awaiter(o,void 0,d.Promise,function(){return __generator(this,function(e){return[2,a.focusRowAtIndex(r,a.getCurrentRowDataIndex(r),!1,!1,!1,!1,!1,!0)]})})})):39===t.keyCode&&i.children?e(function(){__awaiter(o,void 0,d.Promise,function(){return __generator(this,function(e){return[2,a.focusRowAtIndex(document.activeElement,i.children[0].index,!1,!0,!1,!1,!0,!1)]})})}):37===t.keyCode&&i.parent?e(function(){__awaiter(o,void 0,d.Promise,function(){return __generator(this,function(e){return[2,a.focusRowAtIndex(document.activeElement,i.parent.index,!1,!1,!0,!1,!0,!1)]})})}):39===t.keyCode||37===t.keyCode?t.stopPropagation():56===t.keyCode&&(t.stopPropagation(),a.expandCollapseAllNodesOnSameLevel(i)))}),a.updateItemState(n,e),a.setAccessibilityAttributes(e,n,l,s),n.attr("data-row-index",e.index).attr("data-row-id",e.id),null!=e.count&&n.append("span").classed(g.SlicerUtil.Selectors.CountText.class,!0).styles({"font-size":c.fromPoint(r.slicerText.textSize),"font-family":r.slicerText.fontFamily})})},u.prototype.getUnusedAriaStatus=function(){return this.data&&this.data.slicerSettings.selection.strictSingleSelect?"aria-checked":"aria-selected"},u.prototype.setAccessibilityAttributes=function(e,t,i,r){t.attr("role",i.role).attr(i.selected,g.SlicerUtil.getSlicerDataPointCheckedState(e,r)).attr("aria-setsize","-1").attr("aria-posinset",e.levelIndex||1)},u.updateTabIndex=function(e){var r,o=!1;e.each(function(e,t){var i=d3.select(this);0===t&&(r=i),o||"0"!==i.attr("tabindex")?o&&"0"===i.attr("tabindex")&&i.attr("tabindex",null):o=!0}),r&&!o&&r.attr("tabindex","0")},u.prototype.updateItemType=function(e,t){var i=e.select(g.SlicerUtil.Selectors.LabelImage.selector),r=e.select(g.SlicerUtil.Selectors.LabelText.selector);t.isImage?(r.remove(),(i=i.empty()?e.append("img").classed(g.SlicerUtil.Selectors.LabelImage.class,!0):i).attr("src",t.value),i.attr("role","none")):(r=r.empty()&&(i.remove(),r.empty())?e.append("span").classed(g.SlicerUtil.Selectors.LabelText.class,!0):r).text(t.value).attr("title",g.SlicerUtil.getTooltipText(this.hostServices,t.tooltip))},u.prototype.getOptionRole=function(){var e=this.data&&this.data.slicerSettings.selection.strictSingleSelect;return{role:this.expandable?"treeitem":"option",selected:e?"aria-selected":"aria-checked"}},u.prototype.updateDataPoints=function(e,t){var r,o,i,n,a,s,l=this.settings,c=this.data;c&&l&&(s=this.domHelper,r=this.selectionHandler.isSelectionModeInverted(),e.select(p.ItemContainer.selector),e.select(p.Input.selector),e.select(p.ExpandButton.selector),this.verticalSlicerStrategy.updateInputElement(e.selectAll(p.Input.selector),l),!(i=e.selectAll(g.SlicerUtil.Selectors.CountText.selector)).empty()&&this.verticalSlicerStrategy.shouldShowCount()&&(e.select(p.CountText.selector),i.text(function(e){return e.count}),s.setSlicerTextStyle(i,l,this.featureSwitches)),t&&this.body&&(i=(o=this).body.attr("width",this.currentViewport.width),n=this.getOptionRole(),(a=this.body.selectAll(p.ItemContainer.selector)).each(function(e,t){var i=d3.select(this);o.updateItemState(i,e),i.node().hasAttribute("role")&&i.attr(o.getUnusedAriaStatus(),null),o.setAccessibilityAttributes(e,i,n,r),null!=l.items.padding&&(i.style("padding-top","".concat(l.items.padding,"px")),i.style("padding-bottom","".concat(l.items.padding,"px")))}),e=e.selectAll(g.SlicerUtil.Selectors.LabelText.selector),this.verticalSlicerStrategy.setLabelTextStyle(s,e,l,this.style,this.featureSwitches),u.updateTabIndex(a),s=i.selectAll(p.Input.selector),e={slicerContainer:this.container,itemContainers:a,itemInputs:s,settings:c.slicerSettings,searchInput:this.searchComponent.input,clearSearchTextButton:this.searchComponent.clear,style:this.style},t.bind(c.retainedDataPoints,{behaviorOptions:e,orientation:0})),this.behavior.renderSelection())},u.prototype.announceSearchResults=function(e){e=0===e?this.hostServices.getLocalizedString("ContentList_EmptySearchResults"):1===e?this.hostServices.getLocalizedString("Count_SearchBox_Result_One"):this.hostServices.getLocalizedString("Count_SearchBox_Results").replace("{0}",e.toString());this.hostServices.alertWithDebounce("announce-search",e)},u.prototype.getExpandParameters=function(e){e.isCollapsed,this.isCollapse=!1===e.isCollapsed;var t=g.SlicerUtil.buildDataPointInfo(e,this.data.queryNameByLevel);return{dataRoles:[g.slicerRoles.value],data:t.selector,isCollapse:!e.isCollapsed,nodeIndex:t.path}},u.prototype.expandCollapseNode=function(e){e=this.getExpandParameters(e);this.hostServices.setNodeExpansionState({dataRoles:e.dataRoles,data:e.data,isCollapse:e.isCollapse,nodeIndex:e.nodeIndex})},u.prototype.expandCollapseAllNodesOnSameLevel=function(e){e=this.getExpandParameters(e);this.hostServices.setLevelExpansionState({dataRoles:e.dataRoles,data:e.data,isCollapse:e.isCollapse,nodeIndex:e.nodeIndex})},u.prototype.onContextMenu=function(e,t){var e=g.SlicerUtil.buildDataPointInfo(e,this.data.queryNameByLevel),i=[g.slicerRoles.value],i={nodeIndex:e.path,dataRoles:i,position:{x:d3.event.clientX,y:d3.event.clientY},data:[e.selector]};this.hostServices.onContextMenu(i)},u.prototype.getShouldResetScrollPosition=function(e,t){if(!this.dataView||!this.data||!e||!t||this.isCollapse)return!1;if(1===this.data.queryNameByLevel.length)return!d.DataViewAnalysis.hasSameCategoryIdentity(e,this.dataView);if(jsCommon.ArrayExtensions.hasSameValues(this.data.queryNameByLevel,t.queryNameByLevel,function(e,t){return e===t})){var i;if(!_.isEmpty(this.data.slicerDataPoints)&&!_.isEmpty(t.slicerDataPoints))if(this.data.slicerDataPoints.length>t.slicerDataPoints.length&&!this.isCollapse)return!(i=this.listView.getFirstVisibleRow())||void 0!==i.levelIndex&&!_.some(t.slicerDataPoints,function(e){return e.identity.equals(i.identity)});return!1}return!(this.dataView.matrix&&this.dataView.matrix.rows&&e.matrix&&e.matrix.rows&&(t=_.map(this.dataView.matrix.rows.levels,function(e){return e.sources[0].expr}),e=_.map(e.matrix.rows.levels,function(e){return e.sources[0].expr}),jsCommon.ArrayExtensions.hasSameValues(t,e,r.equals)))},u.prototype.updateExpansionState=function(e,t){var i=0;0<t.level&&(i=t.level*c.fromPointToPixel(this.data.slicerSettings.expandCollapse.indentation)),e.styles({"margin-left":"".concat(i,"px")}),this.updateExpandButton(e,t)},u.prototype.updateExpandButton=function(e,t){var i=e.select(p.ExpandButton.selector),e=(this.expandable&&(i.empty()&&(i=this.createExpandButton(e)),e.attr("aria-expanded",void 0===t.isCollapsed?null:!t.isCollapsed),void 0!==t.level)&&e.attr("aria-level",t.level+1),this.data.slicerSettings),e=c.fromPoint(e.slicerText.textSize);i.styles({"font-size":e,width:e}),i.attr("aria-hidden","true"),void 0===t.isCollapsed?this.expandable||i.empty()?i.classed(p.Hidden.class,!0):i.remove():(e=this.data.slicerSettings.expandCollapse.toggleType,i.classed(p.Hidden.class,!1),i.selectAll(".glyphicon").classed("pbi-glyph-chevrondownsmall",t.isCollapsed&&0===e).classed("pbi-glyph-chevronupsmall",!t.isCollapsed&&0===e).classed("pbi-glyph-explore-content-single",t.isCollapsed&&1===e).classed("pbi-glyph-collapse-content-single",!t.isCollapsed&&1===e).classed("pbi-glyph-caretright",t.isCollapsed&&2===e).classed("pbi-glyph-caretdownright",!t.isCollapsed&&2===e))},u.prototype.createExpandButton=function(e){var t=this,e=e.insert("div",":first-child").classed(p.ExpandButton.class,!0).on("click",function(e){d3.event.stopPropagation(),t.expandCollapseNode(e)});return e.append("i").classed("glyphicon",!0),e},u.prototype.scrollToFrameForMultiElementRow=function(e){var t,i=e.listView,r=e.loadMoreData,o=e.rowHeight,n=e.scrollTop,a=e.totalRows,s=e.visibleGroupContainer,e=e.baseContainer,n=0===n?0:Math.floor(n/o);if(!(this.currentRowPosition&&n===this.currentRowPosition||n<0))return t=g.SVGUtil.translateWithPixels(0,n*o),s.styles({transform:function(e){return t},"-webkit-transform":t}),o=s.selectAll(".row").filter(function(){return""!==this.textContent}),void 0===this.currentRowPosition?(this.currentPosition=this.getInitialPosition(a,e),o&&o.node()&&(this.currentRowPosition=n)):(this.updateCurrentPosition(n,a,e,s,o),this.currentRowPosition=n),i.performScrollToFrame(this.currentPosition.startIndex,this.currentPosition.endIndex,a,this.currentPosition.endIndex-this.currentPosition.startIndex,r)},u.prototype.getInitialPosition=function(e,t){var i=e,t=Math.ceil($(t.node()).outerHeight()/this.listView.getRowHeight())*Math.floor($(t.node()).outerWidth()/this.defaultMinWidth);return{startIndex:0,endIndex:i=0<t?Math.min(e,t):i}},u.prototype.updateCurrentPosition=function(e,t,i,r,o){var n=Math.abs(e-this.currentRowPosition);if(e===this.currentRowPosition)this.currentPosition=this.scrollPositionStack.pop()||this.getInitialPosition(t,i);else if(e<this.currentRowPosition)for(;0<n;)this.currentPosition=this.scrollPositionStack.pop()||this.currentPosition,n--;else for(;0<n;){var a=Math.ceil($(i.node()).outerHeight()/$(o.node()).outerHeight());if(this.currentPosition.startIndex>=t-1)return;this.scrollPositionStack.push(this.currentPosition);var a=this.getElementsPerRow(r,a,o),s=this.currentPosition.startIndex+a[0];this.currentPosition={startIndex:s,endIndex:Math.min(t,s+_.sum(a)+this.getMaxElementsInRow(r,o))},n--}},u.prototype.getElementsPerRow=function(e,t,i){for(var r=[],o=i.node(),n=0;n<t&&null!==o;n++){r.push(0);for(var a=$(o).position().top;null!==o&&$(o).position().top<=a+5;)r[n]++,o=o.nextElementSibling}return r},u.prototype.getMaxElementsInRow=function(e,t){t=t.node().getAttribute("min-width");return t?$(e.node()).outerWidth()/+t:Math.floor($(e.node()).outerWidth()/this.defaultMinWidth)},u.prototype.createBodyElement=function(){var l=this,c=(this.body=this.container.append("div").classed(g.SlicerUtil.Selectors.Body.class,!0),this.searchComponent.input.node());this.body.on("wheel",function(){l.focusCallback=void 0,l.listView.resetCallBacks(),l.listView.onScroll()}),c.addEventListener("keydown",function(e){40===e.keyCode?(l.searchBarFocusNextElement(),e.preventDefault(),e.stopPropagation()):70===e.keyCode&&e.ctrlKey&&(l.searchBarFocusNextElement(),l.enableSearch(),e.preventDefault(),e.stopPropagation())}),this.body.on("keydown",function(){function e(e){s.preventDefault(),s.stopPropagation(),l.pendingFocusCall||e()}var t,i,r,o,n,a,s=d3.event;40===s.keyCode?(t=document.activeElement,i=s.shiftKey,e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(t,this.getCurrentRowDataIndex(document.activeElement)+2,!1,!0,!0,i,!1,!1)]})})})):38===s.keyCode?(r=document.activeElement,o=s.shiftKey,l.settings.search.enabled&&0===l.getCurrentRowDataIndex(r)||l.settings.search.enabled&&1===l.getCurrentRowDataIndex(r)&&!l.settings.selection.selectAllCheckboxEnabled?(l.focusForJumpRow(c),e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2]})})})):e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(r,this.getCurrentRowDataIndex(document.activeElement)-3,!1,!1,!0,o,!1,!1)]})})})):9===s.keyCode?l.lockKeyboardNavigation&&l.body.node().focus():35===s.keyCode?e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(document.activeElement,this.data.slicerDataPoints.length,!1,!0,!1,!1,!1,!1)]})})}):36===s.keyCode?e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(document.activeElement,1,!1,!1,!1,!1,!1,!1)]})})}):34===s.keyCode?(n=document.activeElement,e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(n,this.getCurrentRowDataIndex(document.activeElement)+this.getRowsPerPage(),!0,!0,!1,!1,!1,!1)]})})})):33===s.keyCode?(a=document.activeElement,e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2,this.focusRowAtIndex(a,Math.max(this.getCurrentRowDataIndex(document.activeElement)-this.getRowsPerPage(),1),!1,!1,!1,!1,!1,!1)]})})})):70===s.keyCode&&s.ctrlKey&&e(function(){__awaiter(l,void 0,d.Promise,function(){return __generator(this,function(e){return[2,this.enableSearch()]})})})})},u.prototype.setBodyRole=function(){var e=this.expandable?"tree":"listbox";this.body.attr("role",e)},u.prototype.setBodyAriaLabel=function(){this.body.attr("aria-label",this.data.categorySourceName)},u.prototype.enableSearch=function(){this.settings.search&&(this.settings.search.enabled=!this.settings.search.enabled,this.searchComponent.update(this.settings,this.data&&this.data.searchKey,this.verticalSlicerStrategy.shouldShowSearchHeader(this.settings,this.hasSearchableData),this.verticalSlicerStrategy.hasClearSearchButton()))},u.prototype.focusRowAtIndex=function(n,e,t,a,s,l,c,d){var u=this,p=this.factory.defer(),h=n.getAttribute("data-row-id"),S=d3.event;return this.focusCallback=void 0,this.listView.resetCallBacks(),this.pendingFocusCall?p.resolve(1):(this.pendingFocusCall=!0,this.focusCallback=function(){var e,t,i,r=$(u.container.node()).find(".visibleGroup").get(0),o=$(r).find("[data-row-id='"+h+"']").get(0);o?t=(n=o).parentElement:e=void 0,n&&u.removeFocusForJumpRow(n),d?n?u.focusForJumpRow(n):a||t.previousElementSibling||n.addEventListener("blur",i=function(){u.focusForJumpRow(n),n.removeEventListener("blur",i)}):(s||c||!r?s&&!c&&t?!e&&a&&t.nextElementSibling?e=t.nextElementSibling.firstElementChild:e||a||!t.previousElementSibling||(e=t.previousElementSibling.firstElementChild):c&&r&&(e=a?(e=u.selectItemFromRowId(d3.select(n).data()[0].children[0].id,r),u.adjustBottomRowToInViewRow(e,r)):(e=u.selectItemFromRowId(d3.select(n).data()[0].parent.id,r),u.adjustTopRowToInViewRow(e,r))):!e&&a?(e=r.lastElementChild.firstElementChild,e=u.adjustBottomRowToInViewRow(e,r)):e||a||(e=r.firstElementChild.firstElementChild,e=u.adjustTopRowToInViewRow(e,r)),e?(u.focusForJumpRow(e),l&&u.pendingFocusCall&&((o=u.settings).selection.singleSelect=o.selection.strictSingleSelect,g.SlicerWebBehavior.toggleItemSelectionFromExternal(S,d3.select(e).data()[0],u.selectionHandler,o),u.setAccessibilityAttributes(d3.select(e).data()[0],d3.select(e),u.getOptionRole(),u.selectionHandler.isSelectionModeInverted()))):n&&u.focusForJumpRow(n)),u.pendingFocusCall=!1,p.resolve(0)},this.listView.scrollRowIntoView(e-1,this.focusCallback)),p.promise},u.prototype.getCurrentRowDataIndex=function(e){if(e){e=d3.select(e).data()[0];if(e)return e.index}return 1},u.prototype.adjustBottomRowToInViewRow=function(e,t){return e=e.getBoundingClientRect().y+e.getBoundingClientRect().height>this.container.node().getBoundingClientRect().y+this.container.node().getBoundingClientRect().height?t.lastElementChild.previousElementSibling.firstElementChild:e},u.prototype.adjustTopRowToInViewRow=function(e,t){return e=e.getBoundingClientRect().y<=t.getBoundingClientRect().y&&this.listView.canScrollTop()?t.firstElementChild.nextElementSibling.firstElementChild:e},u.prototype.getRowsPerPage=function(){return this.listView.getVisibleRowsWithoutPadding()},u.prototype.selectItemFromRowId=function(e,t){return d3.select(t).select("[data-row-id='"+e+"']").node()},u.prototype.searchBarFocusNextElement=function(){var e=$(this.container.node()).find(".visibleGroup").get(0).firstElementChild.firstElementChild;this.focusForJumpRow(e)},u.prototype.focusForJumpRow=function(e){e.setAttribute("tabindex","0"),e.setAttribute("focusable","true"),e.classList.add(g.SetFocusRingClassName);t.focus(e,{preventScroll:!0})},u.prototype.removeFocusForJumpRow=function(e){e.setAttribute("tabindex","-1"),e.removeAttribute("focusable"),e.classList.remove(g.SetFocusRingClassName)},u.prototype.updateItemState=function(e,t){this.updateExpansionState(e,t),this.updateItemType(e,t),g.SlicerUtil.updateDisableState(e,t)},g.VerticalSlicerRenderer=u,n=g.VerticalSlicerRenderer||(g.VerticalSlicerRenderer={}),e.prototype.canShowSearchHeader=function(e,t){return!!t},e.prototype.hasClearSearchButton=function(){return!1},e.prototype.setLabelTextStyle=function(e,t,i,r,o){e.setSlicerTextStyle(t,i,o)},e.prototype.shouldShowSearchHeader=function(e,t){return this.strictSingleSelect=e.selection.strictSingleSelect,e.search.enabled&&this.canShowSearchHeader(e,t)},e.prototype.shouldShowCount=function(){return!0},e.prototype.updateInputElement=function(e,t){e.selectAll("span").style("font-size",c.fromPoint(t.slicerText.textSize)).classed(this.strictSingleSelect?"radiobutton":"checkbox",!0).classed(this.strictSingleSelect?"checkbox":"radiobutton",!1)},e.prototype.customizeInputElement=function(e,t){e.append("span").style("font-size",c.fromPoint(t.slicerText.textSize)).classed("glyphicon",!0).classed(this.strictSingleSelect?"radiobutton":"checkbox",!0).classed(t.items.accessibilityContrastProperties?"checkboxOutlineContrast":"checkboxOutline",!0)},n.CheckBoxSlicerStrategy=e,a=g.Font.Family.regular.css,i.prototype.hasClearSearchButton=function(){return!0},i.prototype.setLabelTextStyle=function(e,t,i,r,o){var n=g.DataConversion.DefaultSlicerProperties(r);n.slicerText.textSize=c.toPoint(13),n.slicerText.fontFamily=a,n.slicerText.color=g.ColorHelper.getThemeColor(r,g.ForegroundColorName),e.setSlicerTextStyle(t,n,o)},i.prototype.canShowSearchHeader=function(e,t){return e.search.enabled||t},i.prototype.shouldShowSearchHeader=function(e,t){return this.canShowSearchHeader(e,t)},i.prototype.updateInputElement=function(e){},i.prototype.shouldShowCount=function(){return!1},i.prototype.customizeInputElement=function(e){e.append("span").classed("powervisuals-glyph checkmark",!0)},n.CheckListSlicerStrategy=i,h.prototype.create=function(e){this.container=this.domHelper.addSearch(this.hostServices,e),this.input=this.container.select(g.SlicerUtil.Selectors.SearchInput.selector)},h.prototype.addClearButton=function(){this.clear=this.domHelper.addClearSearchButton(this.hostServices,this.container)},h.prototype.update=function(e,t,i,r){var o,n,a,s=this.container.classed(g.SlicerUtil.Selectors.SearchHeaderShow.class);this.container.classed(g.SlicerUtil.Selectors.SearchHeaderShow.class,i),this.container.classed(g.SlicerUtil.Selectors.SearchHeaderCollapsed.class,!i),e&&i&&(o=this.container.select(g.SlicerUtil.Selectors.SearchInput.selector),n=this.container.select(g.SlicerUtil.Selectors.SearchIconClass.selector),o.empty()?r&&this.domHelper.configureSearchBoxIcon(this.container,void 0):(a=(a=o.node())&&a.value,r&&this.domHelper.configureSearchBoxIcon(this.container,a),(_.isEmpty(a)||_.isEmpty(t)&&i!==s)&&o.property("value",t),r=Math.ceil(c.fromPointToPixel(e.slicerText.textSize)),a=this.featureSwitches.outlineDropdownToCheckboxes?e.search.outlineStyle:e.search.outline,this.container.styles({color:e.slicerText.color,"border-style":a,"border-color":e.search.borderColor,background:e.search.background,height:r+"px"}),o.styles({background:e.search.background,color:e.slicerText.color,"font-size":c.fromPoint(e.slicerText.textSize),"font-family":e.slicerText.fontFamily}),n.styles({color:e.slicerText.color})))};var p,n,s,l=h;function h(e,t){this.featureSwitches=e,this.hostServices=t,this.domHelper=new g.SlicerUtil.DOMHelper}g.SlicerSearchInput=l,n=p=g.VerticalSlicerSelectors||(g.VerticalSlicerSelectors={}),s=jsCommon.CssConstants.createClassAndSelector,n.Container=s("slicerContainer"),n.ItemContainer=s("slicerItemContainer"),n.Input=s("slicerCheckbox"),n.ExpandButton=s("expandButton"),n.Hidden=s("hidden"),n.CountText=s("slicerCountText"),n.EmptyResult=s("slicerEmptyResult")}(powerbi=powerbi||{}),function(e){var i;function t(){}i=e.visuals||(e.visuals={}),t.prototype.bindEvents=function(e,t){this.itemContainers=e.itemContainers,this.itemInputs=e.itemInputs,this.selectionHandler=t,this.settings=e.settings,this.style=e.style,i.SlicerWebBehavior.bindSlicerEvents(e,this.itemContainers,t,this.settings)},t.prototype.renderSelection=function(){i.SlicerWebBehavior.setSelectionOnSlicerItems(this.itemInputs,this.selectionHandler,this.style)},i.VerticalSlicerWebBehavior=t}(powerbi=powerbi||{}),function(e){var i,t,r,o;function n(e){switch(e){case i.relativeSlicerPeriod.minutes:return r.Minute;case i.relativeSlicerPeriod.hours:return r.Hour;case i.relativeSlicerPeriod.days:return r.Day;case i.relativeSlicerPeriod.weeks:return r.Week;case i.relativeSlicerPeriod.calendarWeeks:return r.CalendarWeek;case i.relativeSlicerPeriod.months:return r.Month;case i.relativeSlicerPeriod.calendarMonths:return r.CalendarMonth;case i.relativeSlicerPeriod.years:return r.Year;case i.relativeSlicerPeriod.calendarYears:return r.CalendarYear;default:return}}function a(e){switch(e){case i.relativeSlicerRelativeQualifier.last:return t.Last;case i.relativeSlicerRelativeQualifier.current:return t.Current;case i.relativeSlicerRelativeQualifier.next:return t.Next;default:return}}i=e.visuals||(e.visuals={}),t=e.data.RelativeDateQualifier,r=e.data.RelativeDateUnit,o=e.data.RelativeFilterType,(e=i.RelativeSlicerUtil||(i.RelativeSlicerUtil={})).toRelativeDateRangeOptions=function(e){return{duration:e.duration,includeToday:e.includeToday,relativeUnit:n(e.period),relativeQualifier:a(e.range),anchorDate:e.anchorDate}},e.toRelativeDateUnit=n,e.toRelativeDateQualifier=a,e.relativeUnitSlicerFactory=function(e){switch(e){case o.Time:return new i.RelativeTimeComponent;case o.Date:return new i.RelativeDateComponent;default:o.Unsupported;return}},e.createRelativeSlicer=function(e,t){switch(e){case o.Time:return new i.RelativeSlicer(t,o.Time);case o.Date:return new i.RelativeSlicer(t,o.Date);default:o.Unsupported;return}}}(powerbi=powerbi||{}),function(e){((e=e.powerbi||(e.powerbi={})).visuals||(e.visuals={})).importSlicerModule=function(){}}(es6=es6||{}),function(c){var d,u,t,p,h;function e(e,t){this.hasMappedColumn=!1,this.filter=e.filter,this.isNotFilter=!1,this.analyze(e,t)}d=c.visuals||(c.visuals={}),u=c.data.SemanticFilter,t=c.data.SQExpr,p=c.data.SQExprConverter,h=c.data.SQExprUtils,e.prototype.analyze=function(e,t){var i=this;if(this.hasMappedColumn=d.SlicerUtil.isDataViewColumnMapped({columns:e.columns}),this.isAnyFilter=u.isAnyFilter(this.filter),!this.isAnyFilter){var r,o,n=e.fieldSQExprs;if(this.filter&&(r=p.asFilterNodes(this.filter,n))&&(this.isNotFilter=_.some(r,function(e){return!e.selected}),this.hasMappedColumn&&(o=_.some(r,function(e){return i.isSQExprBlank(e)}),this.isNotFilter||o)&&(this.isNotFilter=!1,this.filter=void 0),this.selectedIdentities=r,this.isDefaultFilter=1===this.selectedIdentities.length&&h.isDefaultValue(this.selectedIdentities[0].identity.expr)),this.defaultValueByLevel=this.getDataViewDefaultValuePerLevel(e.columns,e.defaultValuePropertyId),!_.isEmpty(_.compact(this.defaultValueByLevel))&&!t&&(this.filter||(this.filter=d.SlicerSelectionHandler.buildDefaultValueFilter(e.columns),this.selectedIdentities=p.asFilterNodes(this.filter,n),this.isDefaultFilter=!0),this.isDefaultFilter)&&!_.isEmpty(this.selectedIdentities))for(var a=this.selectedIdentities[0],s=0;a;){var l=this.defaultValueByLevel[s],l=c.data.createDataViewScopeIdentity(h.getDataViewScopeIdentityComparisonExpr(n[s],l.identityFieldsValues));this.isNotFilter=!1,a.identity=l,_.isEmpty(a.children)||a.children.length,a=_.isEmpty(a.children)?void 0:a.children[0],s++}}},e.prototype.isSQExprBlank=function(e){e=e.identity.expr;return!!t.isCompare(e)&&t.isIsBlank(e)},e.prototype.getDataViewDefaultValuePerLevel=function(e,t){if(!_.isEmpty(e))return _.map(e,function(e){return c.DataViewObjects.getValue(e.objects,t)})},d.SlicerFilterAnalyzer=e}(powerbi=powerbi||{}),function(u){var h,p,a,S;function g(e,t){this.hostService=e,this.behavior=t,this.isInvertedSelectionMode=!1,this.isSearchUpdateMode=!1,this.selected=[]}h=u.visuals||(u.visuals={}),p=u.data.SemanticFilter,a=u.data.Selector,S=u.data.SQExprBuilder,g.buildDefaultValueFilter=function(e,t){for(var i=[],r=[],o=(t=void 0===t?!1:t)?i:r,n=0,a=e;n<a.length;n++){var s=a[n],l=1===(null==(l=s.parameter)?void 0:l.kind),c=!(null==(c=s.parameter)||!c.supportsSelectAll),d=null!=u.DataViewObjects.getValue(s.objects,h.slicerProps.general.defaultValue);l&&c||d?o.push.apply(o,g.getMetadataColumnIdentityExprs(s)):o=i}if(!_.isEmpty(i)||!_.isEmpty(r))return p.getDefaultAnyValueFilter(r,i)},g.getMetadataColumnIdentityExprs=function(e){return _.isEmpty(e.identityExprs)?[e.expr]:e.identityExprs},g.prototype.setDefaultValueMode=function(e){this.useDefaultValue=e},g.prototype.bind=function(e,t){this.selected=_.filter(e,function(e){return e.selected}),this.behavior.bindEvents(t,this),this.behavior.renderSelection()},g.prototype.setSelectionModeInverted=function(e){this.previousInversionMode=this.isInvertedSelectionMode,this.isInvertedSelectionMode=e},g.prototype.setColumns=function(e){this.columns=e,this.columnExprs=_.map(e,function(e){return e.expr}),this.supportsDefaultValueByLevel=_.map(e,function(e){return null!=u.DataViewObjects.getValue(e.objects,h.slicerProps.general.defaultValue)})},g.prototype.hasSelection=function(){return!_.isEmpty(this.selected)},g.prototype.isSelectionModeInverted=function(){return this.isInvertedSelectionMode},g.prototype.setQueryNameByLevel=function(e){this.queryNameByLevel=e},g.prototype.persistSelfFilter=function(e,t){t=h.SlicerUtil.buildContainsFilter(this.columnExprs,t);this.hostService.persistProperties(g.createChangeForProperty(e,t))},g.prototype.setSearchMode=function(e){this.isSearchUpdateMode=e},g.prototype.isSearchMode=function(){return this.isSearchUpdateMode},g.prototype.handleClearSelection=function(){var e;this.previouslySelected=this.selected.slice(),this.previousInversionMode=this.isInvertedSelectionMode,this.isInvertedSelectionMode=!1,1===this.selected.length&&this.isStrictSingleSelect||this.hasDefaultValue()&&this.useDefaultValue||(e=this.hostService.getLocalizedString("Slicer_ClearSelectionsCleared"),this.hostService.alertWithDebounce("announce-clear-selection",e),this.useDefaultValue=!0,this.resetSelected(),this.behavior.renderSelection())},g.prototype.persistSelectionFilter=function(e,t,i){void 0===t&&(t=!1);var r=this.getFilterFromDataPoints(),o=(r&&!_.isEmpty(this.selected)&&(o=this.toFilterExpressionMetadata(this.selected),this.hostService.setFilterExpressionMetadata(o)),g.createChangeForProperty(e,r)),e=!(t||!this.isInvertedSelectionMode)||null,r=g.createChangeForProperty(h.slicerProps.data.isInvertedSelectionMode,e),o=this.mergeObjectInstancesToPersist(o,r);this.hostService.persistProperties(o,i),this.sendSelectionToHost()},g.prototype.getDataMultiSelectMode=function(){return this.hostService.dataMultiSelectMode()},g.prototype.sendSelectionToHost=function(){var e,i,t;this.hostService.onSelect&&(e=_.isEmpty(this.selected)?[]:_.map(this.selected,function(e){return e.identity}),e=h.InteractivityService.createSelectEventArgs(e,0),t=_.isEmpty(this.previouslySelected)?[]:_.map(this.previouslySelected,function(e){return e.identity}),i=h.InteractivityService.createSelectEventArgs(t,0),t=_.size(e.visualObjects)!==_.size(i.visualObjects)||_.some(e.visualObjects,function(e,t){return!a.equalsSelectorsByColumn(e.selectorsByColumn,i.visualObjects[t].selectorsByColumn)}),e.fireDataSelectedEvent=t||this.isInvertedSelectionMode!==this.previousInversionMode,this.hostService.onSelect(e))},g.prototype.handleSelection=function(e,t,i){var r;return!this.onSelecting(e,i)&&(i=e.partially,r=e.selected,this.useDefaultValue=!1,this.previouslySelected=this.selected.slice(),0===t||this.isStrictSingleSelect?this.resetSelected():this.clearDataPointState(e),t=this.getDataPointSelectedState(e,t,i,r),this.updateSelectedState(e,t),this.behavior.renderSelection(),!0)},g.prototype.getDataPointSelectedState=function(e,t,i,r){return i?h.SlicerUtil.getSlicerDataPointCheckedState(e,this.isInvertedSelectionMode)?e.selected:!e.selected:!!this.isStrictSingleSelect||(0===t?!r||1<this.selected.length:!r)},g.prototype.onSelecting=function(e,t){e=h.SlicerUtil.buildDataPointInfo(e,this.queryNameByLevel),e={type:0,visualObjects:[{objectName:h.InteractivityService.dataPointObjectName,selectorsByColumn:e.selector}],position:t};return this.hostService.onSelecting(e),0!==e.action&&null!=e.action},g.prototype.updateSelectedState=function(e,t){var i=e.selected;i!==(e.selected=t)&&(this.clearDataPointState(e,!0),this.updateParentState(e)),e.selected?this.selected.push(e):i&&!e.selected&&_.remove(this.selected,e)},g.prototype.setStrictSingleSelect=function(e,t){this.isStrictSingleSelect=e,this.adjustStrictSingleSelectSelection(t)},g.prototype.resetSelected=function(){_.isEmpty(this.selected)||_.each(this.selected,function(e){return e.selected=!1}),this.selected=[]},g.prototype.clearDataPointState=function(e,t){if((t=void 0===t?!1:t)||(e.selected&&_.remove(this.selected,e),e.selected=!1),!_.isEmpty(e.children)&&e.partially){e.partially=!1;for(var i=0,r=e.children;i<r.length;i++){var o=r[i];this.clearDataPointState(o)}}},g.prototype.updateParentState=function(e){if(e.parent)for(var t=e.parent;t;)e.selected?t.partially=!0:t.partially=_.some(t.children,function(e){return e.selected}),t=t.parent},g.prototype.mergeObjectInstancesToPersist=function(e,t){var i={};return i.merge=e.merge,i.remove=e.remove,_.isEmpty(t.merge)||(i.merge=i.merge||[],(e=i.merge).push.apply(e,t.merge||[])),_.isEmpty(t.remove)||(i.remove=i.remove||[],(e=i.remove).push.apply(e,t.remove||[])),i},g.prototype.toFilterExpressionMetadata=function(e){if(!_.isEmpty(e)){for(var t={expressions:this.columnExprs,cachedValueItems:[]},i=0,r=0,o=e;r<o.length;r++){for(var n=o[r],a={identities:[],valueMap:{}};n;)a.identities.unshift(n.scopeIdentity),a.valueMap[n.level]=n.value,i=Math.max(i,n.level),n=n.parent;t.cachedValueItems.push(a)}return t.expressions=this.columnExprs.slice(0,i+1),t}},g.prototype.isDisableMultipleSelectForMappedColumn=function(){var e=this.columns;return _.some(e,function(e){var t;return 1===(null==(t=e.parameter)?void 0:t.kind)&&!(null!=(t=e.parameter)&&t.supportsMultipleValues)})},g.prototype.toggleSelectionModeInversion=function(e){return void 0===e&&(e=!1),this.previouslySelected=this.selected.slice(),this.useDefaultValue=!1,this.previousInversionMode=this.isInvertedSelectionMode,this.isInvertedSelectionMode=!this.isInvertedSelectionMode,this.resetSelected(),e&&this.hostService.persistProperties(g.createChangeForProperty(h.slicerProps.data.isInvertedSelectionMode,!!this.isInvertedSelectionMode||null)),this.behavior.renderSelection(),this.isInvertedSelectionMode},g.prototype.getFilterFromDataPoints=function(){var e,t=h.SlicerUtil.isDataViewColumnMapped({columns:this.columns});return _.isEmpty(this.selected)&&(this.hasDefaultValue()||this.isInvertedSelectionMode&&t)?(e=!this.useDefaultValue||t,g.buildDefaultValueFilter(this.columns,e)):(e=this.buildSelectorsByLevel())?(t=g.buildExprForSlicerSelection(e.selected,e.unselected,t),t=this.ensureAnyFilter(t,e.maxLevel),p.fromSQExpr(t)):void 0},g.buildExprForSlicerSelection=function(e,t,i){e=g.buildExprsFromSelectorsByLevel(e),t=g.buildExprForUnselectedState(t,!i);return e&&t?e=S.and(e,t):t&&(e=t),e},g.prototype.ensureAnyFilter=function(e,t){t+=1;if(t<this.columns.length){for(var i=S.anyValue(),r=[],o=t;o<this.columns.length;o++)this.supportsDefaultValueByLevel[o]&&r.push.apply(r,g.getMetadataColumnIdentityExprs(this.columns[o]));_.isEmpty(r)||(t=Array.apply(null,Array(r.length)).map(function(){return i}),e=S.and(e,u.data.SQExprUtils.getDataViewScopeIdentityComparisonExpr(r,t)))}return e},g.getInExprByLevel=function(e){for(var t=0,i=a.filterExprsFromSelectors(e);t<i.length;t++)var r=i[t],o=u.data.ScopeIdentityExtractor.getInExpr(r),n=n?u.data.SQExprBuilder.or(n,o):o||r;return n},g.prototype.hasDefaultValue=function(){if(!_.isEmpty(this.columns))return null!=u.DataViewObjects.getValue(this.columns[0].objects,h.slicerProps.general.defaultValue)},g.buildExprsFromSelectorsByLevel=function(e,t){for(var i in void 0===t&&(t=!1),e)var i=g.getInExprByLevel(e[i]),r=r?S.or(r,i):i;return r=t?r&&S.not(r):r},g.prototype.buildSelectorsByLevel=function(){if(!_.isEmpty(this.selected)){for(var e={},t={},i={},r=0,o=0,n=this.selected;o<n.length;o++){for(var a,s,l,c=n[o],d=-1,u=c,p={data:[]};u;)p.data.unshift(u.scopeIdentity),u=u.parent,d++;r=Math.max(r,d),h.SlicerUtil.getSlicerDataPointCheckedState(c,this.isInvertedSelectionMode)?(s=e,(s=(a=this.getFirstUnselectedParent(c,this.isInvertedSelectionMode))?(l=this.ensureState(a,i)).selectedChildren:s)[d]=s[d]||[],s[d].push(p)):((l=this.ensureState(c,i)).selector=p,t[d]=t[d]||[],t[d].push(l))}return{selected:e,unselected:t,maxLevel:r}}},g.buildExprForUnselectedState=function(e,t){var i,r={};for(i in e){for(var o,n,a=[],s=[],l=0,c=e[i];l<c.length;l++){var d=c[l];_.isEmpty(d.selectedChildren)?s.push(d.selector):a.push(d)}_.isEmpty(s)||(r[i]=s),_.isEmpty(a)||(o=g.getExprForUnselectedStateWithSelection(a),n=n?S.and(o,n):o)}t=g.buildExprsFromSelectorsByLevel(r,t);return n=n?S.and(t,n):t},g.getExprForUnselectedStateWithSelection=function(e){for(var t=0,i=e;t<i.length;t++)var r=i[t],o=g.buildExprsFromSelectorsByLevel(r.selectedChildren),r=S.not(g.getInExprByLevel([r.selector])),o=S.or(o,r),n=n?S.and(o,n):o;return n},g.prototype.ensureState=function(e,t){var i=t[e.identity.getKey()];return i||(i={selector:{},selectedChildren:{}},t[e.identity.getKey()]=i),i},g.prototype.getFirstUnselectedParent=function(e,t){for(;e;){if(e.selected&&!h.SlicerUtil.getSlicerDataPointCheckedState(e,t))return e;e=e.parent}},g.createChangeForProperty=function(e,t){var i={},r={objectName:e.objectName,selector:void 0,properties:i};return null==t?(i[e.propertyName]={},{remove:[r]}):(i[e.propertyName]=t,{merge:[r]})},g.prototype.adjustStrictSingleSelectSelection=function(e){var t;if(this.isStrictSingleSelect&&!_.isEmpty(e)&&(1!==_.filter(e,function(e){return e.selected}).length||this.isInvertedSelectionMode)){if(1<e.length){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.selected&&!this.isInvertedSelectionMode||!o.selected&&this.isInvertedSelectionMode){t=o;break}}if(!t)if(h.SlicerUtil.isDataViewColumnMapped({columns:this.columns}))for(var n=0,a=e;n<a.length;n++){var s=a[n];if(!s.disabled){t=s;break}}else t=e[0]}this.isInvertedSelectionMode&&this.toggleSelectionModeInversion(null==t),t&&(t.selected=!0,this.selected=[t],this.persistSelectionFilter(h.slicerProps.general.filter,void 0,!0))}},h.SlicerSelectionHandler=g}(powerbi=powerbi||{}),function(e){var t;(t=e.visuals||(e.visuals={})).initializeSlicerFactoryES6=function(){t.setCreateSlicer(function(t){return es6.powerbi.visuals.importSlicerModule().then(function(e){return new e.Slicer(t)})})}}(powerbi=powerbi||{}),function(e){var t,r;function i(e,t,i){this.dataView=e,this.listJoinSeparator=t,this.initMetadataColumns(),e.categorical?this.reader=new r.SlicerCategoricalDataReader(e.categorical,this.columns,i):this.reader=new r.SlicerMatrixDataReader(e.matrix,this.columns,void 0,i)}t=e.visuals||(e.visuals={}),r=t.readers||(t.readers={}),i.prototype.getIdentityFields=function(){var e=this.getMetadataColumns();return this.reader.getIdentityExprs()||_.map(e,function(e){return e.identityExprs})},i.prototype.getDataPointsReader=function(){return this.reader},i.prototype.getQueryNamePerLevel=function(){var e=this.getMetadataColumns();return _.map(e,function(e){return e.queryName})},i.prototype.getDisplayNamePerLevel=function(){var e=this.getMetadataColumns();return _.map(e,function(e){return e.displayName})},i.prototype.getDisplayName=function(){var e=this.getDisplayNamePerLevel();return _.join(e,this.listJoinSeparator)},i.prototype.getColumns=function(){return this.columns},i.prototype.getMetadataColumnByLevel=function(e){return this.columns[e]},i.prototype.getMetadataColumns=function(){return this.reader.getMetadataColumns()||this.columns},i.prototype.initMetadataColumns=function(){this.columns=t.SlicerUtil.readMetadataColumns(this.dataView.metadata.columns)},r.SlicerDataViewReader=i}(powerbi=powerbi||{}),function(r){var e;function o(e,t,i,r){this.matrix=e,this.metadataColumns=t,this.root=i,this.selectedDataPoints=r,this.root=i,this.level=i&&i.level+1||0,this.root||(this.root=e&&e.rows&&e.rows.root,this.root&&(this.metadata=e.rows.levels[this.level].sources[0])),this.count=this.root&&this.root.children&&this.root.children.length||0}e=(e=r.visuals||(r.visuals={})).readers||(e.readers={}),o.prototype.getDataPointsCount=function(){return this.count},o.prototype.getMetadataColumn=function(){return this.metadata||this.metadataColumns[this.level]},o.prototype.getDataViewDataPoint=function(e){this.count;var t,i=this.root.children[e];if(!i.isSubtotal)return i.levelValues.length,_.some(i.children,function(e){return!e.isSubtotal})&&(e=_.find(this.selectedDataPoints,function(e){return r.DataViewScopeIdentity.equals(e.identity,i.identity)}),t=new o(this.matrix,this.metadataColumns,i,e&&e.children)),{scopeId:i.identity,isCollapsed:i.isCollapsed,value:i.levelValues[0].value,childrenReader:t}},o.prototype.isImageData=function(){return!1},o.prototype.getLevel=function(){return this.level},o.prototype.hasCount=function(){return!1},o.prototype.getSelectedNodes=function(){return this.selectedDataPoints},o.prototype.getMetadataColumns=function(){},o.prototype.getIdentityExprs=function(){return this.metadataColumns&&_.map(this.metadataColumns,function(e){return e.identityExprs})},e.SlicerMatrixDataReader=o}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['slicerVisual.min.js'] || (this.parseTimeMarkers['slicerVisual.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
