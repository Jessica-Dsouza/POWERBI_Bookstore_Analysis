"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['pivotTableVisuals.min.js'] || (this.parseTimeMarkers['pivotTableVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('pivotTableVisuals.min.js');var es6,powerbi,__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,a,l,s){return new(l=l||Promise)(function(i,t){function o(e){try{n(s.next(e))}catch(e){t(e)}}function r(e){try{n(s.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?i(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(o,r)}n((s=s.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(o,r){var n,a,l,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(i){return function(e){var t=[i,e];if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(l=2&t[0]?a.return:t[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,t[1])).done)return l;switch(a=0,(t=l?[2&t[0],l.value]:t)[0]){case 0:case 1:l=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(l=0<(l=s.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3]))s.label=t[1];else if(6===t[0]&&s.label<l[1])s.label=l[1],l=t;else{if(!(l&&s.label<l[2])){l[2]&&s.ops.pop(),s.trys.pop();continue}s.label=l[2],s.ops.push(t)}}t=r.call(o,s)}catch(e){t=[6,e],a=0}finally{n=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__spreadArray=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var o,r=0,n=t.length;r<n;r++)!o&&r in t||((o=o||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(i[r[o]]=e[r[o]]);return i};!function(e){function i(e,t){return void 0!==t.getLeafIndex(e)?e:i(_.head(t.getChildren(e)),t)}function o(e,t){return t.isLeaf(e)?e:o(_.last(t.getChildren(e)),t)}function r(e,t){return void 0!==t.getLeafIndex(e)?e:r(_.last(t.getChildren(e)),t)}(e=(e=(e=(e=e.visuals||(e.visuals={})).controls||(e.controls={})).pivotTable||(e.pivotTable={})).PivotTableHierarchyNavigator||(e.PivotTableHierarchyNavigator={})).getHeaderSpan=function(e,t){var i=t.getHierarchyDepth(),o=t.getChildren(e);if(!_.isEmpty(o))for(var r=0,n=o;r<n.length;r++)var a=n[r],i=Math.min(i,t.getLevel(a));return i-t.getLevel(e)},e.getFirstVisualLeaf=i,e.getLastLeaf=o,e.getLastVisualLeaf=r,e.getFirstLeafIndex=function(e,t){return t.getLeafIndex(function e(t,i){return i.isLeaf(t)?t:e(_.head(i.getChildren(t)),i)}(e,t))},e.getFirstVisualLeafIndex=function(e,t){return t.getLeafIndex(i(e,t))},e.getLastLeafIndex=function(e,t){return t.getLeafIndex(o(e,t))},e.getLastVisualLeafIndex=function(e,t){return t.getLeafIndex(r(e,t))}}(powerbi=powerbi||{}),function(e){var t,n,a,l,o;function s(t,i,e,o,r,n){var a=this;this.isA11yMatrix=n,this.elementOriginalCursor=i.style.cursor,this.verticalResizeHandler=e,this.horizontalResizeHandler=o,(e||o)&&(i.addEventListener("mousedown",function(e){return i.closest("[".concat(l,"=true]"))?null:a.onMouseDown(t,i,e)}),i.addEventListener("mousemove",function(e){return i.closest("[".concat(l,"=true]"))?null:a.onMouseMove(i,e)}),i.addEventListener("dblclick",function(e){return i.closest("[".concat(l,"=true]"))?null:a.onDoubleClick(t,i,e)})),r&&i.addEventListener("click",function(e){return a.onClick(t,i,e,r)})}function i(e,t,i){this.a11yTableFS=t,this.a11yMatrixFS=i,this.control=e}function r(e){}function u(e){}function h(e,t){this.a11yMatrixFS=t,this.control=e}t=e.visuals||(e.visuals={}),n=t.controls||(t.controls={}),a=n.pivotTable||(n.pivotTable={}),l=e.visuals.FormatModeAttribute,s.prototype.onMouseDown=function(e,t,i){var o,r=this.getActiveHandler(t,i);r?(this.resizing=!0,this.startMousePosition=s.getMouseCoordinates(i),o=n.HTMLElementUtils.getAccumulatedScale(t),this.initializeDocumentEvents(t,r,o),document.documentElement&&(this.documentOriginalCursor=document.documentElement.style.cursor,document.documentElement.style.cursor=this.getCursor(t,i)),r.onStartResize(e)):this.resizing=!1},s.prototype.onMouseMove=function(e,t){this.startMousePosition||(e.style.cursor=this.getCursor(e,t))},s.prototype.onDoubleClick=function(e,t,i){t=this.getActiveHandler(t,i);t&&t.onReset(e)},s.prototype.onClick=function(e,t,i,o){this.isA11yMatrix&&!t.closest("[".concat(l,"=true]"))&&i.stopPropagation(),this.resizing||o&&o(e,i)},s.prototype.getActiveHandler=function(e,t){return this.isMouseOnVerticalHandle(e,s.getMouseCoordinates(t))?this.verticalResizeHandler:this.isMouseOnHorizontalHandle(e,s.getMouseCoordinates(t))?this.horizontalResizeHandler:null},s.prototype.getCursor=function(e,t){return this.isMouseOnVerticalHandle(e,s.getMouseCoordinates(t))?"col-resize":this.isMouseOnHorizontalHandle(e,s.getMouseCoordinates(t))?"row-resize":this.elementOriginalCursor},s.prototype.initializeDocumentEvents=function(e,t,i){var o=this;this.documentMouseMoveListener=function(e){e.preventDefault(),t.onResize(s.getMouseCoordinatesDelta(o.startMousePosition,s.getMouseCoordinates(e),i))},document.addEventListener("mousemove",this.documentMouseMoveListener),this.documentMouseUpListener=function(e){e.preventDefault(),document.removeEventListener("mousemove",o.documentMouseMoveListener),o.documentMouseMoveListener=null,document.removeEventListener("mouseup",o.documentMouseUpListener),o.documentMouseUpListener=null,document.documentElement&&(document.documentElement.style.cursor=o.documentOriginalCursor,o.documentOriginalCursor=void 0),o.startMousePosition=null,t.onEndResize()},document.addEventListener("mouseup",this.documentMouseUpListener)},s.prototype.isMouseOnVerticalHandle=function(e,t){return!!this.verticalResizeHandler&&t.x>=e.getBoundingClientRect().right-s.HandleSize},s.prototype.isMouseOnHorizontalHandle=function(e,t){return!!this.horizontalResizeHandler&&t.y>=e.getBoundingClientRect().bottom-s.HandleSize},s.getMouseCoordinates=function(e){return{x:e.pageX,y:e.pageY}},s.getMouseCoordinatesDelta=function(e,t,i){return t&&e?{x:(t.x-e.x)/i,y:(t.y-e.y)/i}:{x:0,y:0}},s.HandleSize=4,o=s,a.HeaderResizer=o,i.prototype.onStartResize=function(e){var e=a.PivotTableHierarchyNavigator.getLastLeaf(e,this.control.getColumnNavigator()),t=this.control.getColumnNavigator().getLeafIndex(e);this.resizeState={leafToResize:e,leafToResizeIndex:t,originalWidth:this.control.getColumnWidthMeasureManager().getColumnWidth(t)}},i.prototype.onResize=function(e){var t,i;e.x&&this.resizeState&&(i=this.control.getViewport(),t=a.RowMeasurementUtil.getVisibleRange(i.top,i.height,this.control.getRowHeightMeasureManager()),i=a.ColumnMeasurementUtil.getVisibleRange(i.left,i.width,this.control.getColumnWidthMeasureManager()),t)&&i&&(this.control instanceof a.PivotTableControl&&this.control.getWorkScheduler().clear(),e=Math.max(this.resizeState.originalWidth+e.x,o.HandleSize),this.control.getColumnWidthMeasureManager().setColumnWidth(this.resizeState.leafToResizeIndex,e),a.RowMeasurementUtil.remeasureRows(this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),t.firstLeafIndex,t.lastLeafIndex,i.firstLeafIndex,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clearFloatingRows(),this.control.getColumnLevelHeightMeasureManager().clear(),this.resizeBodyPages(this.resizeState.leafToResizeIndex,t.firstLeafIndex,t.lastLeafIndex),this.resizeBorders(this.resizeState.leafToResizeIndex,t.firstLeafIndex,t.lastLeafIndex),this.control instanceof a.TablixControl?this.control.renderAsync(a.PivotTableRenderingMode.ResizeColumn):this.control.render(a.PivotTableRenderingMode.Incremental))},i.prototype.onEndResize=function(){var e,t,i,o,r,n=this;this.resizeState&&(e=this.resizeState.leafToResize,t=this.control.getColumnWidthMeasureManager().getColumnWidth(this.resizeState.leafToResizeIndex),r=this.resizeState.originalWidth,this.resizeState=void 0,i=this.control.getViewport(),o=a.RowMeasurementUtil.getVisibleRange(i.top,i.height,this.control.getRowHeightMeasureManager()))&&t!==r&&(this.control instanceof a.PivotTableControl&&this.control.getWorkScheduler().clear(),this.control.getSizeManager().setColumnWidth(e,t),r=a.RowMeasurementUtil.getVisibleRowStart(o,i.top,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clear(),this.control instanceof a.TablixControl?this.control.renderAsync(a.PivotTableRenderingMode.ClearRendering,r):this.a11yTableFS?this.control.makeVisible(a.PivotTableRenderingMode.ClearRendering,r,null,void 0,!0):this.control.makeVisible(a.PivotTableRenderingMode.Incremental,r,null,function(){return n.control.rebuildBodyPagesSync()}))},i.prototype.onReset=function(e){var t,i=this,o=this.control.getViewport(),r=a.RowMeasurementUtil.getVisibleRange(o.top,o.height,this.control.getRowHeightMeasureManager());r&&(e=a.PivotTableHierarchyNavigator.getLastLeaf(e,this.control.getColumnNavigator()),t=this.control.getColumnNavigator().getLeafIndex(e),this.control.getSizeManager().setColumnWidth(e,void 0),a.ColumnMeasurementUtil.remeasureColumn(t,this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),r.firstLeafIndex,this.control.getColumnWidthMeasureManager()),e=a.RowMeasurementUtil.getVisibleRowStart(r,o.top,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clear(),this.control.getColumnLevelHeightMeasureManager().clear(),this.control instanceof a.TablixControl?this.control.renderAsync(a.PivotTableRenderingMode.ClearRendering,e):this.a11yTableFS?this.control.makeVisible(a.PivotTableRenderingMode.ClearRendering,e,null,void 0,!0):this.control.makeVisible(a.PivotTableRenderingMode.Incremental,e,null,function(){return i.control.rebuildBodyPagesSync()}))},i.prototype.resizeBodyPages=function(e,t,i){this.control instanceof a.TablixControl||(this.control.getBodyCellRenderer().resizeRows(t,i),this.control.getFloatingBodyCellRenderer().resizeRows(0,this.control.getRowNavigator().getFloatingHierarchyLeafCount()-1),this.control.getBodyCellRenderer().resizeColumn(e),this.control.getFloatingBodyCellRenderer().resizeColumn(e))},i.prototype.resizeBorders=function(e,t,i){var o;this.a11yTableFS&&!this.a11yMatrixFS&&((o=this.control).getColumnHeaderBorderRenderer().resizeRows(t,i),o.getBodyCellBorderRenderer().resizeRows(t,i),o.getFloatingBodyCellBorderRenderer().resizeRows(t,i),o.getColumnHeaderBorderRenderer().resizeColumn(e),o.getBodyCellBorderRenderer().resizeColumn(e),o.getFloatingBodyCellBorderRenderer().resizeColumn(e))},a.ColumnWidthResizeHandler=i,r.prototype.onStartResize=function(e){},r.prototype.onResize=function(e){},r.prototype.onEndResize=function(){},r.prototype.onReset=function(e){},a.RowHeightResizeHandler=r,u.prototype.onStartResize=function(e){},u.prototype.onResize=function(e){},u.prototype.onEndResize=function(){},u.prototype.onReset=function(e){},a.ColumnLevelHeightResizeHandler=u,h.prototype.onStartResize=function(e){e=this.getLevelToResize(e);this.resizeState={cornerCellToResize:this.control.getRowNavigator().getCorner(e,this.control.getColumnNavigator().getHierarchyDepth()-1),levelToResize:e,originalWidth:this.control.getRowLevelWidthMeasureManager().getLevelWidth(e)}},h.prototype.onResize=function(e){var t,i;e.x&&this.resizeState&&(i=this.control.getViewport(),t=a.RowMeasurementUtil.getVisibleRange(i.top,i.height,this.control.getRowHeightMeasureManager()),i=a.ColumnMeasurementUtil.getVisibleRange(i.left,i.width,this.control.getColumnWidthMeasureManager()),t)&&(this.control instanceof a.PivotTableControl&&this.control.getWorkScheduler().clear(),e=Math.min(this.getMaxWidth(this.resizeState.levelToResize),Math.max(this.resizeState.originalWidth+e.x,o.HandleSize)),this.control.getRowLevelWidthMeasureManager().setLevelWidth(this.resizeState.levelToResize,e),a.RowMeasurementUtil.remeasureRows(this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),t.firstLeafIndex,t.lastLeafIndex,i?i.firstLeafIndex:0,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clearFloatingRows(),this.control.getColumnLevelHeightMeasureManager().clear(),this.resizeBodyPages(t.firstLeafIndex,t.lastLeafIndex),this.control instanceof a.TablixControl?this.control.renderAsync(a.PivotTableRenderingMode.ResizeColumn):this.control.render(a.PivotTableRenderingMode.Incremental))},h.prototype.onEndResize=function(){var e,t,i,o,r,n=this;this.resizeState&&(e=this.resizeState.cornerCellToResize,t=this.control.getRowLevelWidthMeasureManager().getLevelWidth(this.resizeState.levelToResize),r=this.resizeState.originalWidth,this.resizeState=void 0,i=this.control.getViewport(),o=a.RowMeasurementUtil.getVisibleRange(i.top,i.height,this.control.getRowHeightMeasureManager()))&&t!==r&&(this.control instanceof a.PivotTableControl&&this.control.getWorkScheduler().clear(),this.control.getSizeManager().setRowLevelWidth(e,t),r=a.RowMeasurementUtil.getVisibleRowStart(o,i.top,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clear(),this.control instanceof a.TablixControl?this.control.renderAsync(a.PivotTableRenderingMode.ClearRendering,r):this.control.makeVisible(a.PivotTableRenderingMode.Incremental,r,null,function(){return n.control.rebuildBodyPagesSync()}))},h.prototype.onReset=function(e){var t,i=this,o=this.control.getViewport(),r=a.RowMeasurementUtil.getVisibleRange(o.top,o.height,this.control.getRowHeightMeasureManager());r&&(e=this.getLevelToResize(e),t=this.control.getRowNavigator().getCorner(e,this.control.getColumnNavigator().getHierarchyDepth()-1),this.control.getSizeManager().setRowLevelWidth(t,void 0),this.control.getRowLevelWidthMeasureManager().measure(this.control.getBinder(),this.control.getRowNavigator(),this.control.getColumnNavigator(),r.firstLeafIndex,a.MeasureRowSampleCount,e),t=a.RowMeasurementUtil.getVisibleRowStart(r,o.top,this.control.getRowHeightMeasureManager()),this.control.getRowHeightMeasureManager().clear(),this.control.getColumnLevelHeightMeasureManager().clear(),this.control instanceof a.TablixControl?this.control.renderAsync(a.PivotTableRenderingMode.Incremental,t):this.control.makeVisible(a.PivotTableRenderingMode.Incremental,t,null,function(){return i.control.rebuildBodyPagesSync()}))},h.prototype.getLevelToResize=function(e){return this.control.getSteppedLayout()?0:this.control.getRowNavigator().getRowLevel(e)},h.prototype.getMaxWidth=function(e){for(var t=this.control.getClientWidth(),i=0;i<e;i++)t-=this.control.getRowLevelWidthMeasureManager().getLevelWidth(i);return t},h.prototype.resizeBodyPages=function(e,t){this.control instanceof a.TablixControl||(this.control.getBodyCellRenderer().resizeRows(e,t),this.control.getFloatingBodyCellRenderer().resizeRows(0,this.control.getRowNavigator().getFloatingHierarchyLeafCount()-1))},a.RowLevelWidthResizeHandler=h}(powerbi=powerbi||{}),function(e){var t,M,h,i,p;function o(){}function r(){}function n(){}function d(e,t){this.pageColumns=[],this.measureElement=e,this.sizeManager=t}function a(e,t,i,o){this.pageRows=[],this.measureElement=e,this.columnWidthMeasureManager=t,this.rowLevelWidthMeasureManager=i,this.sizeManager=o}function l(){return null!==i&&i.apply(this,arguments)||this}function s(){return null!==t&&t.apply(this,arguments)||this}function u(e,t,i,o){this.columnLevelHeights=[],this.measureElement=e,this.columnWidthMeasureManager=t,this.rowLevelWidthMeasureManager=i,this.sizeManager=o}function S(e,t){this.rowLevelWidths=[],this.measureElement=e,this.sizeManager=t}function c(e,t){this.measureElement=e,this.sizeManager=t}e=e.visuals||(e.visuals={}),(M=(e=e.controls||(e.controls={})).pivotTable||(e.pivotTable={})).PageColumnCount=10,M.MeasureRowSampleCount=50,M.MaxAutoPageColumnMeasure=100,M.PageRowCount=20,M.MeasureColumnSampleCount=20,M.MaxAutoPageRowMeasure=100,o.getAncestorsToMeasure=function(e,t){for(var i=[];;){var o=t.getParent(e);if(!o||!t.isLastItem(e,t.getChildren(o)))break;i.push({node:o,size:-1}),e=o}return i},o.getSizeDifference=function(e,t,i,o){for(var r=0,n=0,a=e;n<a.length;n++)var l=a[n],r=Math.max(r,this.getItemSizeDifference(l,t,i,o));return r},o.getItemSizeDifference=function(e,t,i,o){for(var r=0,n=M.PivotTableHierarchyNavigator.getFirstLeafIndex(e.node,i);n<=t;n++)if((r+=o(n))>=e.size)return 0;return e.size-r},o.getPageIndex=function(e,t){return Math.floor(e/t)},o.itemRangeToPageRange=function(e,t,i){var o=this.getPageIndex(e,i),r=this.getPageIndex(t,i);if(o===r)return[{pageIndex:o,startIndex:e%i,endIndex:t%i}];var n=[];n.push({pageIndex:o,startIndex:e%i,endIndex:i-1});for(var a=o+1;a<r;a++)n.push({pageIndex:a,startIndex:0,endIndex:i-1});return n.push({pageIndex:r,startIndex:0,endIndex:t%i}),n},h=o,M.MeasureUtil=h,r.linesOverlapVertically=function(e,t,i,o){return!(e+t<i||i+o<e)},r.isRowMeasured=function(e,t){return this.getMeasuredRowCount(t)>e},r.getMeasuredRowCount=function(e){e=e.getPageRows();return _.isEmpty(e)?0:(e.length-1)*M.PageRowCount+_.last(e).getRowHeights().length},r.remeasureRows=function(e,t,i,o,r,n,a){for(var l=0,s=h.itemRangeToPageRange(o,r,M.PageRowCount);l<s.length;l++){var u=s[l];a.measurePage(a.getPageRows()[u.pageIndex],e,t,i,o,n,M.MeasureColumnSampleCount,u.startIndex,u.endIndex-u.startIndex+1)}},r.getVisibleRowStart=function(e,t,i){i=i.getRowHeight(e.firstLeafIndex);return{rowIndex:e.firstLeafIndex,visibleHeight:i-t+e.firstLeafTop}},r.getVisibleRange=function(e,t,i,o,r){i=this.getVisiblePageRange(e,t,i);if(!i)return null;var n=this.getFirstVisibleIndex(i.firstPageRow,i.firstPageIndex,i.firstPageTop,e,t);if(null!=n){var a,i=this.getLastVisibleIndex(i.lastPageRow,i.lastPageIndex,i.lastPageTop,e,t);if(null!=i)return null!=o&&0<=o&&null!=r&&0<=r&&(a=Math.max(i,n.leafIndex+o-1),a=Math.min(a,r)),{firstLeafIndex:n.leafIndex,firstLeafTop:n.top,lastLeafIndex:null!=a?a:i}}},r.getVisiblePageRange=function(e,t,i){for(var o=0,r=0,n=null,a=0,l=i.getPageRows();a<l.length;a++){var s=l[a],u=s.getHeight();if(this.linesOverlapVertically(o,u,e,t))n?(n.lastPageRow=s,n.lastPageIndex=r,n.lastPageTop=o):n={firstPageRow:s,firstPageIndex:r,firstPageTop:o,lastPageRow:s,lastPageIndex:r,lastPageTop:o};else if(n)break;o+=u,r++}return n},r.getFirstVisibleIndex=function(e,t,i,o,r){for(var n=0,a=i,l=0,s=e.getRowHeights();l<s.length;l++){var u=s[l];if(this.linesOverlapVertically(a,u,o,r))return{leafIndex:t*M.PageRowCount+n,top:a};a+=u,n++}},r.getLastVisibleIndex=function(e,t,i,o,r){for(var n,a=0,l=i,s=0,u=e.getRowHeights();s<u.length;s++){var h=u[s];this.linesOverlapVertically(l,h,o,r)&&(n=t*M.PageRowCount+a),l+=h,a++}return n},r.getBounds=function(e,t){var i=h.getPageIndex(e,M.PageRowCount);if(!(i>=t.getPageRows().length)){for(var o=t.getPageRows()[i],r=t.getPageRowTop(o),n=e%M.PageRowCount,a=0;a<n;a++)r+=o.getRowHeights()[a];return{top:r,height:o.getRowHeights()[n]}}},r.getOffset=function(e,t){t=this.getBounds(e.rowIndex,t);return t?e.alignBottom?e.visibleHeight>=t.height?t.top+t.height:t.top+e.visibleHeight:e.visibleHeight>=t.height?t.top:t.top+t.height-e.visibleHeight:0},M.RowMeasurementUtil=r,n.linesOverlapHorizontally=function(e,t,i,o){return!(e+t<i||i+o<e)},n.isColumnMeasured=function(e,t){return this.getMeasuredColumnCount(t)>e},n.getMeasuredColumnCount=function(e){e=e.getPageColumns();return _.isEmpty(e)?0:(e.length-1)*M.PageColumnCount+_.last(e).getColumnWidths().length},n.remeasureColumn=function(e,t,i,o,r,n){var a=n.getPageColumn(e,t,i,o,r);n.measurePage(a,t,i,o,r,M.MeasureRowSampleCount,e%M.PageColumnCount,1)},n.getVisibleColumnStart=function(e,t,i){i=i.getColumnWidth(e.firstLeafIndex);return{columnIndex:e.firstLeafIndex,visibleWidth:i-t+e.firstLeafLeft}},n.getVisibleRange=function(e,t,i,o,r){i=this.getVisiblePageRange(e,t,i);if(!i)return null;var n=this.getFirstVisibleIndex(i.firstPageColumn,i.firstPageIndex,i.firstPageLeft,e,t);if(null!=n){var a,i=this.getLastVisibleIndex(i.lastPageColumn,i.lastPageIndex,i.lastPageLeft,e,t);if(null!=i)return null!=o&&0<=o&&null!=r&&0<=r&&(a=Math.max(i,n.leafIndex+o-1),a=Math.min(a,r)),{firstLeafIndex:n.leafIndex,firstLeafLeft:n.left,lastLeafIndex:null!=a?a:i}}},n.getVisiblePageRange=function(e,t,i){for(var o=0,r=0,n=null,a=0,l=i.getPageColumns();a<l.length;a++){var s=l[a],u=s.getWidth();if(this.linesOverlapHorizontally(o,u,e,t))n?(n.lastPageColumn=s,n.lastPageIndex=r,n.lastPageLeft=o):n={firstPageColumn:s,firstPageIndex:r,firstPageLeft:o,lastPageColumn:s,lastPageIndex:r,lastPageLeft:o};else if(n)break;o+=u,r++}return n},n.getFirstVisibleIndex=function(e,t,i,o,r){for(var n=0,a=i,l=0,s=e.getColumnWidths();l<s.length;l++){var u=s[l];if(this.linesOverlapHorizontally(a,u,o,r))return{leafIndex:t*M.PageColumnCount+n,left:a};a+=u,n++}return null},n.getLastVisibleIndex=function(e,t,i,o,r){for(var n,a=0,l=i,s=0,u=e.getColumnWidths();s<u.length;s++){var h=u[s];this.linesOverlapHorizontally(l,h,o,r)&&(n=t*M.PageColumnCount+a),l+=h,a++}return n},n.getBounds=function(e,t){var i=h.getPageIndex(e,M.PageColumnCount);if(!(i>=t.getPageColumns().length)){for(var i=t.getPageColumns()[i],o=t.getPageColumnLeft(i),r=e%M.PageColumnCount,n=i.getColumnWidths(),a=0;a<r;a++)o+=n[a];return{left:o,width:n[r]}}},n.getOffset=function(e,t){t=this.getBounds(e.columnIndex,t);return t?e.alignRight?e.visibleWidth>=t.width?t.left+t.width:t.left+e.visibleWidth:e.visibleWidth>=t.width?t.left:t.left+t.width-e.visibleWidth:0},M.ColumnMeasurementUtil=n,d.prototype.canAddPageColumn=function(e){return this.pageColumns.length<this.getMaxPageColumnCount(e)},d.prototype.getMaxPageColumnCount=function(e){return Math.ceil(e.getHierarchyLeafCount()/M.PageColumnCount)},d.prototype.getPageColumns=function(){return this.pageColumns},d.prototype.getPageColumnStartIndex=function(e){e=this.pageColumns.indexOf(e);return-1===e?-1:e*M.PageColumnCount},d.prototype.getPageColumnLeft=function(e){for(var t=0,i=0,o=this.pageColumns;i<o.length;i++){var r=o[i];if(e===r)break;t+=r.getWidth()}return t},d.prototype.getColumnsWidth=function(){for(var e=0,t=0,i=this.pageColumns;t<i.length;t++)e+=i[t].getWidth();return e},d.prototype.clear=function(){this.pageColumns=[]},d.prototype.measureNextPage=function(e,t,i,o){var r=new M.PivotTablePageColumn;this.getPageColumns().push(r),this.measurePage(r,e,t,i,o,M.MeasureRowSampleCount)},d.prototype.getWidestCellBindingString=function(e,t,i,o,r,n,a){for(var l={item:null,width:-1},s=0;s<n;s++)this.updateWidestItemFromBodyCell(o.getHierarchyLeafAt(s+a),e,i,o,l);if(t)for(var u=o.getFloatingHierarchyLeafCount(),s=0;s<u;s++)this.updateWidestItemFromBodyCell(o.getFloatingHierarchyLeafAt(s),e,i,o,l);var t=i.getApproximateColumnHeaderWidth(e);return t>l.width&&(l.item=e,l.width=t),t=l.item===e?i.getColumnHeaderBinding(l.item,!0):i.getBodyCellBinding(l.item,!0),M.ElementBuilder.build(t,d.measureRequiredStyle)},d.prototype.measurePage=function(e,t,i,o,r,n,a,l){for(var s=this.getPageColumnStartIndex(e),u=(void 0===a&&(a=0),void 0===l&&(l=Math.min(o.getHierarchyLeafCount()-s,M.PageColumnCount)+a),Math.min(i.getHierarchyLeafCount()-r,n)),h="",d=i.getFloatingHierarchyItems(),c=0;c<l;c++){var p=o.getHierarchyLeafAt(c+a+s);void 0===(e.getColumnWidths()[c+a]=this.sizeManager.getColumnWidth(p))&&(h+=this.getWidestCellBindingString(p,d,t,i,o,u,r))}if(h){this.measureElement.insertAdjacentHTML("beforeend",h);for(var g=this.measureElement.firstChild,c=0;c<l;c++)void 0===e.getColumnWidths()[c+a]&&(e.getColumnWidths()[c+a]=g.offsetWidth+1,g=g.nextSibling);this.measureElement.innerHTML="",this.adjustItemsWidth(e,t,o,s,a,l)}},d.prototype.updateWidestItemFromBodyCell=function(e,t,i,o,r){o=o.getIntersection(e,t),e=i.getApproximateBodyCellWidth(o);e>r.width&&(r.item=o,r.width=e)},d.prototype.adjustItemsWidth=function(e,t,i,o,r,n){for(var a=0;a<n;a++){var l=i.getHierarchyLeafAt(a+r+o);void 0===this.sizeManager.getColumnWidth(l)&&this.adjustItemWidth(e,a+r,o,t,i,l)}},d.prototype.adjustItemWidth=function(e,t,i,o,r,n){var a=this,n=h.getAncestorsToMeasure(n,r);_.isEmpty(n)||(this.measureAncestors(n,o),e.getColumnWidths()[t]+=h.getSizeDifference(n,t+i,r,function(e){return a.getColumnWidth(e)}))},d.prototype.measureAncestors=function(e,t){for(var i="",o=0,r=e;o<r.length;o++){var n=r[o],a=t.getColumnHeaderBinding(n.node,!0);i+=M.ElementBuilder.build(a,d.measureRequiredStyle)}this.measureElement.insertAdjacentHTML("beforeend",i);for(var l=this.measureElement.firstChild,s=0,u=e;s<u.length;s++)(n=u[s]).size=l.offsetWidth+1,l=l.nextSibling;this.measureElement.innerHTML=""},d.prototype.getColumnWidth=function(e,t,i,o,r){return this.getPageColumn(e,t,i,o,r).getColumnWidths()[e%M.PageColumnCount]},d.prototype.setColumnWidth=function(e,t){this.getPageColumn(e).getColumnWidths()[e%M.PageColumnCount]=t},d.prototype.getPageColumn=function(e,t,i,o,r){e=this.getPageIndex(e);if(t&&e>=this.pageColumns.length)for(var n=e-this.pageColumns.length+1,a=0;a<n;a++)this.measureNextPage(t,i,o,r);return this.pageColumns[e]},d.prototype.getPageIndex=function(e){return h.getPageIndex(e,M.PageColumnCount)},d.prototype.getLastMeasuredIndex=function(){var e,t=this.pageColumns.length;return 0===t?-1:(e=_.last(this.pageColumns),(t-1)*M.PageColumnCount+(e.getColumnWidths().length-1))},d.measureRequiredStyle={"box-sizing":"border-box",display:"inline-flex"},M.ColumnWidthMeasureManager=d,a.prototype.clear=function(){this.pageRows=[],this.clearFloatingRows()},a.prototype.clearFloatingRows=function(){this.floatingPageRow=new M.PivotTablePageRow},a.prototype.ensureLastPageComplete=function(e,t,i,o,r,n){var a,l,s;return 0!==this.pageRows.length&&(a=this.pageRows.length-1,(s=(l=this.pageRows[a]).getRowHeights().length)<M.PageRowCount)&&this.gotMoreRows(l,t)&&(this.measurePage(l,e,t,i,o,r,n,l.getRowHeights().length-1),l.getRowHeights().length>s)?a:-1},a.prototype.measureNextPage=function(e,t,i,o,r){var n=new M.PivotTablePageRow;this.getPageRows().push(n),this.measurePage(n,e,t,i,o,r,M.MeasureColumnSampleCount)},a.prototype.measureFloatingRows=function(e,t,i,o,r){if(_.isEmpty(this.floatingPageRow.getRowHeights())){var n=t.getFloatingHierarchyItems();if(!_.isEmpty(n)){for(var a=Math.min(i.getHierarchyLeafCount()-r,M.MeasureColumnSampleCount),l="",s=t.getFloatingHierarchyLeafCount(),u=0;u<s;u++){var h=t.getFloatingHierarchyLeafAt(u);this.floatingPageRow.getRowHeights()[u]=this.sizeManager.getRowHeight(h),void 0===this.floatingPageRow.getRowHeights()[u]&&(l+=this.getHeighestCellBindingString(h,e,t,i,a,r,o))}if(l){this.measureElement.insertAdjacentHTML("beforeend",l);for(var d=this.measureElement.firstChild,u=0;u<s;u++)void 0===this.floatingPageRow.getRowHeights()[u]&&(this.floatingPageRow.getRowHeights()[u]=d.offsetHeight,d=d.nextSibling);this.measureElement.innerHTML="",this.adjustItemsHeight(this.floatingPageRow,e,t,0,0,s)}}}},a.prototype.getPageIndex=function(e){return h.getPageIndex(e,M.PageRowCount)},a.prototype.getMeasureRequiredStyle=function(e){return{"box-sizing":"border-box",width:M.PivotTableControl.pixelUnits(e)}},a.prototype.gotMoreRows=function(e,t){return 0<t.getHierarchyLeafCount()-this.getPageRowStartIndex(e)-e.getRowHeights().length},a.prototype.measurePage=function(e,t,i,o,r,n,a,l,s){for(var u=this.getPageRowStartIndex(e),h=(void 0===l&&(l=0),void 0===s&&(s=Math.min(i.getHierarchyLeafCount()-u,M.PageRowCount)-l),Math.min(o.getHierarchyLeafCount()-n,a)),d="",c=0;c<s;c++){var p=i.getHierarchyLeafAt(c+l+u);void 0===(e.getRowHeights()[c+l]=this.sizeManager.getRowHeight(p))&&(d+=this.getHeighestCellBindingString(p,t,i,o,h,n,r))}if(d){this.measureElement.insertAdjacentHTML("beforeend",d);for(var g=this.measureElement.firstChild,c=0;c<s;c++)void 0===e.getRowHeights()[c+l]&&(e.getRowHeights()[c+l]=g.offsetHeight,g=g.nextSibling);this.measureElement.innerHTML="",this.adjustItemsHeight(e,t,i,u,l,s)}},a.prototype.getHeighestCellBindingString=function(e,t,i,o,r,n,a){for(var l={item:null,width:-1,height:-1},s=0;s<r;s++){var u=o.getHierarchyLeafAt(s+n),u=i.getIntersection(e,u),h=this.columnWidthMeasureManager.getColumnWidth(s+n,t,i,o,a),d=t.getApproximateBodyCellHeight(u,h);l.height<d&&(l.item=u,l.width=h,l.height=d)}var c=this.getItemWidth(e,i),p=t.getApproximateRowHeaderHeight(e,c);return l.height<p&&(l.item=e,l.height=p,l.width=c),p=l.item===e?t.getRowHeaderBinding(l.item,!0):t.getBodyCellBinding(l.item,!0),M.ElementBuilder.build(p,this.getMeasureRequiredStyle(l.width))},a.prototype.getItemWidth=function(e,t){return 0},a.prototype.adjustItemsHeight=function(e,t,i,o,r,n){},a.prototype.getMaxPageRowCount=function(e){return Math.ceil(e.getHierarchyLeafCount()/M.PageRowCount)},a.prototype.getPageRows=function(){return this.pageRows},a.prototype.getFloatingPageRow=function(){return this.floatingPageRow},a.prototype.getFloatingRowHeights=function(){return _.sum(this.floatingPageRow.getRowHeights())},a.prototype.canAddPageRow=function(e){return this.pageRows.length<this.getMaxPageRowCount(e)},a.prototype.getPageRowStartIndex=function(e){return e===this.floatingPageRow?0:-1===(e=this.pageRows.indexOf(e))?-1:e*M.PageRowCount},a.prototype.getPageRowTop=function(e){if(e===this.floatingPageRow)return 0;for(var t=0,i=0,o=this.pageRows;i<o.length;i++){var r=o[i];if(e===r)break;t+=r.getHeight()}return t},a.prototype.getRowsHeight=function(){for(var e=0,t=0,i=this.pageRows;t<i.length;t++)e+=i[t].getHeight();return e},a.prototype.getRowHeight=function(e,t,i,o,r,n){return this.getPageRow(e,t,i,o,n).getRowHeights()[e%M.PageRowCount]},a.prototype.getFloatingRowHeight=function(e){return this.floatingPageRow.getRowHeights()[e]},a.prototype.getPageRow=function(e,t,i,o,r,n){e=this.getPageIndex(e);if(t&&e>this.pageRows.length)for(var a=e-this.pageRows.length+1,l=0;l<a;l++)this.measureNextPage(t,i,o,r,n);return this.pageRows[e]},a.prototype.getLastMeasuredIndex=function(){var e,t=this.pageRows.length;return 0===t?-1:(e=_.last(this.pageRows),(t-1)*M.PageRowCount+(e.getRowHeights().length-1))},e=a,M.RowHeightMeasureManager=e,__extends(l,i=e),l.prototype.getItemWidth=function(e,t){return this.rowLevelWidthMeasureManager.getWidth(t.getLevel(e),M.PivotTableHierarchyNavigator.getHeaderSpan(e,t))},l.prototype.adjustItemsHeight=function(e,t,i,o,r,n){for(var a=0;a<n;a++){var l=i.getHierarchyLeafAt(a+r+o);void 0===this.sizeManager.getRowHeight(l)&&this.adjustItemHeight(e,a+r,o,t,i,l)}},l.prototype.adjustItemHeight=function(t,e,i,o,r,n){var a=this,n=h.getAncestorsToMeasure(n,r);_.isEmpty(n)||(this.measureAncestors(n,o,r),t.getRowHeights()[e]+=h.getSizeDifference(n,i+e,r,function(e){return t===a.getFloatingPageRow()?a.getFloatingRowHeight(e):a.getRowHeight(e)}))},l.prototype.measureAncestors=function(e,t,i){for(var o="",r=0,n=e;r<n.length;r++){var a=n[r],l=t.getRowHeaderBinding(a.node,!0);o+=M.ElementBuilder.build(l,this.getMeasureRequiredStyle(this.getItemWidth(a.node,i)))}this.measureElement.insertAdjacentHTML("beforeend",o);for(var s=this.measureElement.firstChild,u=0,h=e;u<h.length;u++)(a=h[u]).size=s.offsetHeight,s=s.nextSibling;this.measureElement.innerHTML=""},M.BlockedRowHeightMeasureManager=l,__extends(s,t=e),s.prototype.getItemWidth=function(e,t){return this.rowLevelWidthMeasureManager.getLevelWidth(t.getLevel(e))},s.prototype.adjustItemsHeight=function(e,t,i,o,r,n){},M.SteppedRowHeightMeasureManager=s,u.prototype.clear=function(){this.columnLevelHeights=[]},u.prototype.getMeasureRequiredStyle=function(e){return{"box-sizing":"border-box",width:M.PivotTableControl.pixelUnits(e)}},u.prototype.measure=function(e,t,i,o,r,n,a){if(0===this.columnLevelHeights.length){for(var l={done:!1,levels:[],spanningHeaders:[],leafCount:0},s=i.getHierarchyDepth(),u=t.getHierarchyDepth(),h=0;h<s;h++)void 0!==a&&a!==h||(this.columnLevelHeights[h]=this.sizeManager.getColumnLevelHeight(t.getCorner(u-1,h))),l.levels.push({largestItem:null,isHeader:!0,largestItemWidth:-1,largestItemHeight:-1});var d=i.getHierarchyItems();d&&this.getHeighestColumnHeaders(d,l,e,t,i,o,r,n);for(var c,p,g,m=0;m<u;m++)for(var f=0;f<s;f++)void 0===this.columnLevelHeights[f]&&(c=t.getCorner(m,f),p=this.rowLevelWidthMeasureManager.getLevelWidth(m),(g=e.getApproximateCornerCellHeight(c,p))>l.levels[f].largestItemHeight)&&(l.levels[f].isHeader=!1,l.levels[f].largestItem=c,l.levels[f].largestItemHeight=g,l.levels[f].largestItemWidth=p);for(var y,b,v="",C=0,w=l.levels;C<w.length;C++)(x=w[C]).largestItem&&(y=this.getMeasureRequiredStyle(x.largestItemWidth),b=x.isHeader?e.getColumnHeaderBinding(x.largestItem,!0):e.getCornerCellBinding(x.largestItem,!0),v+=M.ElementBuilder.build(b,y));if(v){this.measureElement.insertAdjacentHTML("beforeend",v);for(var x,S=this.measureElement.firstChild,P=0,H=0,T=l.levels;H<T.length;H++)(x=T[H]).largestItem&&(void 0!==a&&a!==P||(this.columnLevelHeights[P]=S.offsetHeight),S=S.nextSibling),P++;this.measureElement.innerHTML="",this.adjustLevelHeightsFromSpanningHeaders(l,e,t,i,o)}}},u.prototype.adjustLevelHeightsFromSpanningHeaders=function(e,t,i,o,r){for(var n="",a=0,l=e.spanningHeaders;a<l.length;a++){var s,u,h=l[a];e.levels[h.levelToAdjust].largestItem&&(s=this.getMeasureRequiredStyle(this.getHeaderWidth(h.item,t,i,o,r)),u=t.getColumnHeaderBinding(h.item,!0),n+=M.ElementBuilder.build(u,s))}if(n){this.measureElement.insertAdjacentHTML("beforeend",n);for(var d=this.measureElement.firstChild,c=0,p=e.spanningHeaders;c<p.length;c++){h=p[c];e.levels[h.levelToAdjust].largestItem&&(this.adjustLevelFromSpanningHeader(h.item,h.level,h.levelToAdjust,d.offsetHeight,o),d=d.nextSibling)}this.measureElement.innerHTML=""}},u.prototype.adjustLevelFromSpanningHeader=function(e,t,i,o,r){for(var n=0,a=t;a<=i;a++)n+=this.getLevelHeight(a);n<o&&(this.columnLevelHeights[i]+=o-n)},u.prototype.getHeighestColumnHeaders=function(e,t,i,o,r,n,a,l){for(var s=0,u=e;s<u.length;s++){var h=u[s];if(t.done)return;var d,c=r.isLeaf(h),p=r.getLevel(h),g=M.PivotTableHierarchyNavigator.getHeaderSpan(h,r),m=M.PivotTableHierarchyNavigator.getLastLeafIndex(h,r)>=a,f=(m&&(1===g?void 0===this.columnLevelHeights[p]&&(d=this.getHeaderWidth(h,i,o,r,n),(f=i.getApproximateColumnHeaderHeight(h,d))>t.levels[p].largestItemHeight)&&(t.levels[p].largestItem=h,t.levels[p].largestItemHeight=f,t.levels[p].largestItemWidth=d):t.spanningHeaders.push({item:h,level:p,levelToAdjust:g+p-1})),r.getChildren(h));f&&this.getHeighestColumnHeaders(f,t,i,o,r,n,a,l),c&&m&&t.leafCount++,t.leafCount===l&&(t.done=!0)}},u.prototype.getHeadersHeight=function(){for(var e=0,t=0,i=this.columnLevelHeights;t<i.length;t++)e+=i[t];return e},u.prototype.getLevelTop=function(e){for(var t=0,i=0;i<e;i++)t+=this.columnLevelHeights[i];return t},u.prototype.getLevelHeight=function(e){return this.columnLevelHeights[e]},u.prototype.getHeaderWidth=function(e,t,i,o,r){for(var n=M.PivotTableHierarchyNavigator.getFirstLeafIndex(e,o),a=M.PivotTableHierarchyNavigator.getLastLeafIndex(e,o),l=0,s=n;s<=a;s++)l+=this.columnWidthMeasureManager.getColumnWidth(s,t,i,o,r);return l},M.ColumnLevelHeightMeasureManager=u,S.prototype.clear=function(){this.rowLevelWidths=[]},S.prototype.measure=function(e,t,i,o,r,n){if(0===this.rowLevelWidths.length||void 0!==n){for(var a={done:!1,levels:[],spanningHeaders:[],leafCount:0},l=t.getHierarchyDepth(),s=i.getHierarchyDepth(),u=0;u<l;u++)void 0!==n&&n!==u||(this.rowLevelWidths[u]=this.sizeManager.getRowLevelWidth(t.getCorner(u,s-1))),a.levels.push({largestItem:null,isHeader:!0,largestItemWidth:-1,largestItemHeight:-1});this.getWidestRowHeaders(t.getHierarchyItems(),a,e,t,o,r);i=t.getFloatingHierarchyItems();_.isEmpty(i)||(a.done=!1,a.leafCount=0,this.getWidestRowHeaders(i,a,e,t,-1,t.getFloatingHierarchyLeafCount()));for(var h,d,c=0;c<s;c++)for(var p=0;p<l;p++)void 0===this.rowLevelWidths[p]&&(h=t.getCorner(p,c),(d=e.getApproximateCornerCellWidth(h))>a.levels[p].largestItemWidth)&&(a.levels[p].isHeader=!1,a.levels[p].largestItem=h,a.levels[p].largestItemWidth=d);for(var g,m="",f=0,y=a.levels;f<y.length;f++)(b=y[f]).largestItem&&(g=b.isHeader?e.getRowHeaderBinding(b.largestItem,!0):e.getCornerCellBinding(b.largestItem,!0),m+=M.ElementBuilder.build(g,S.measureRequiredStyles));if(m){this.measureElement.insertAdjacentHTML("beforeend",m);for(var b,v=this.measureElement.firstChild,C=0,w=0,x=a.levels;w<x.length;w++)(b=x[w]).largestItem&&(void 0!==n&&n!==C||(this.rowLevelWidths[C]=v.offsetWidth+1),v=v.nextSibling),C++;this.measureElement.innerHTML="",this.adjustLevelWidthsFromSpanningHeaders(a,e,t)}}},S.prototype.adjustLevelWidthsFromSpanningHeaders=function(e,t,i){for(var o="",r=0,n=e.spanningHeaders;r<n.length;r++){var a,l=n[r];e.levels[l.levelToAdjust].largestItem&&(a=t.getRowHeaderBinding(l.item,!0),o+=M.ElementBuilder.build(a,S.measureRequiredStyles))}if(o){this.measureElement.insertAdjacentHTML("beforeend",o);for(var s=this.measureElement.firstChild,u=0,h=e.spanningHeaders;u<h.length;u++){l=h[u];e.levels[l.levelToAdjust].largestItem&&(this.adjustLevelWidthFromSpanningHeader(l.item,l.level,l.levelToAdjust,s.offsetWidth,i),s=s.nextSibling)}this.measureElement.innerHTML=""}},S.prototype.adjustLevelWidthFromSpanningHeader=function(e,t,i,o,r){for(var n=0,a=t;a<=i;a++)n+=this.getLevelWidth(a);n<o&&(this.rowLevelWidths[i]+=o-n)},S.prototype.getWidestRowHeaders=function(e,t,i,o,r,n){for(var a=0,l=e;a<l.length;a++){var s=l[a];if(t.done)return;var u=o.isLeaf(s),h=o.getLevel(s),d=M.PivotTableHierarchyNavigator.getHeaderSpan(s,o),c=M.PivotTableHierarchyNavigator.getLastLeafIndex(s,o)>=r,p=(c&&(1===d?void 0===this.rowLevelWidths[h]&&(p=i.getApproximateRowHeaderWidth(s))>t.levels[h].largestItemWidth&&(t.levels[h].largestItem=s,t.levels[h].largestItemWidth=p):t.spanningHeaders.push({item:s,level:h,levelToAdjust:d+h-1})),o.getChildren(s));p&&this.getWidestRowHeaders(p,t,i,o,r,n),u&&c&&t.leafCount++,t.leafCount===n&&(t.done=!0)}},S.prototype.getHeadersWidth=function(){for(var e=0,t=0,i=this.rowLevelWidths;t<i.length;t++)e+=i[t];return e},S.prototype.getLevelLeft=function(e){for(var t=0,i=0;i<e;i++)t+=this.rowLevelWidths[i];return t},S.prototype.getLevelWidth=function(e){return this.rowLevelWidths[e]},S.prototype.setLevelWidth=function(e,t){this.rowLevelWidths[e]=t},S.prototype.getWidth=function(e,t){for(var i=0,o=e;o<e+t;o++)i+=this.getLevelWidth(o);return i},S.measureRequiredStyles={"box-sizing":"border-box",display:"inline-flex"},p=S,M.BlockedRowLevelWidthMeasureManager=p,c.prototype.clear=function(){this.width=void 0},c.prototype.getHeaderBindingString=function(e,t){t=t.getRowHeaderBinding(e,!0);return M.ElementBuilder.build(t,p.measureRequiredStyles)},c.prototype.measure=function(e,t,i,o,r,n){if((void 0===this.width||void 0!==n)&&(this.width=this.sizeManager.getRowLevelWidth(t.getCorner(0,i.getHierarchyDepth()-1)),void 0===this.width)){for(var a="",l=Math.min(t.getHierarchyLeafCount()-o,r),s=0;s<l;s++)a+=this.getHeaderBindingString(t.getHierarchyLeafAt(s+o),e);n=t.getFloatingHierarchyItems();if(!_.isEmpty(n))for(var u=t.getFloatingHierarchyLeafCount(),s=0;s<u;s++)a+=this.getHeaderBindingString(t.getFloatingHierarchyLeafAt(s),e);if(0<t.getHierarchyDepth())for(s=0;s<i.getHierarchyDepth();s++){var h=t.getCorner(0,s),h=e.getCornerCellBinding(h,!0);a+=M.ElementBuilder.build(h,p.measureRequiredStyles)}this.measureElement.insertAdjacentHTML("beforeend",a);for(var d=this.measureElement.firstChild,c=0;d;)c=Math.max(c,d.offsetWidth+1),d=d.nextSibling;this.measureElement.innerHTML="",this.width=c}},c.prototype.getHeadersWidth=function(){return this.width},c.prototype.getLevelWidth=function(e){return this.width},c.prototype.setLevelWidth=function(e,t){this.width=t},c.prototype.getLevelLeft=function(e){return 0},M.SteppedRowLevelWidthMeasureManager=c}(powerbi=powerbi||{}),function(e){var t,p,i,o,g,s;function r(e,t,i,o,r,n,a,l,s){this.element=e,this.rowHeightMeasureManager=t,this.rowLevelWidthMeasureManager=i,this.rowHeightResizeHandler=o,this.clickHandler=r,this.contextMenuHandler=n,this.interactionHandler=a,this.isA11yTable=l,this.isA11yMatrix=s}function n(){return null!==i&&i.apply(this,arguments)||this}function a(){return null!==t&&t.apply(this,arguments)||this}function l(e,t,i,o,r,n,a,l,s,u){this.element=e,this.columnWidthMeasureManager=t,this.columnLevelHeightMeasureManager=i,this.columnWidthResizeHandler=o,this.clickHandler=r,this.contextMenuHandler=n,this.interactionHandler=a,this.isA11yTable=l,this.isA11yMatrix=s,this.onObject=u}function u(e,t,i,o,r,n,a){this.element=e,this.columnWidthMeasureManager=t,this.rowHeightMeasureManager=i,this.clickHandler=o,this.contextMenuHandler=r,this.interactionHandler=n,this.workScheduler=a}function h(e,t,i,o,r,n,a,l,s){var u=this;this.element=e,this.columnWidthMeasureManager=t,this.rowHeightMeasureManager=i,this.clickHandler=o,this.contextMenuHandler=r,this.interactionHandler=n,this.section=a,this.renderType=l,this.onObject=s,this.viewSync={},this.clickHandler&&this.element.addEventListener("click",function(e){var t=u.getItemByElement(e.target);t&&u.clickHandler(t,e,void 0,u.section)}),this.contextMenuHandler&&this.element.addEventListener("contextmenu",function(e){var t=u.getItemByElement(e.target);t&&u.contextMenuHandler(t,e)}),this.renderType===g.RenderType.Table&&this.element.addEventListener("change",function(e){e=d3.select(e.target).attr("checkbox-rowindex");null!=e&&u.clickHandler(void 0,void 0,+e,u.section)})}function d(e,t,i,o,r,n){this.columnWidthMeasureManager=e,this.rowHeightMeasureManager=t,this.columnLevelHeightMeasureManager=i,this.svgTopLayer=o,this.svgBottomLayer=r,this.section=n,this.viewSync={rows:{},columns:{}}}function c(e,t,i,o,r,n,a,l,s){this.element=e,this.columnLevelHeightMeasureManager=t,this.rowLevelWidthMeasureManager=i,this.columnLevelHeightResizeHandler=o,this.rowLevelWidthResizeHandler=r,this.clickHandler=n,this.contextMenuHandler=a,this.interactionHandler=l,this.isA11yMatrix=s,this.headers={}}e=e.visuals||(e.visuals={}),o=e.controls||(e.controls={}),g=o.pivotTable||(o.pivotTable={}),s=e.shapes.Rect.isIntersecting,(e=p=g.HeaderRendererUtil||(g.HeaderRendererUtil={})).getHeaderIndices=function e(t,i,o){var r=o.getParent(t);r&&e(r,i,o),i.push(o.getIndex(t))},e.getHeaderKey=function(e){for(var t="",i=0,o=e;i<o.length;i++)t+=o[i]+"_";return t},e.ensureLevelContext=function(e,t){t===e.length&&(t=e[t-1].currentPosition,e.push({startItem:null,startPosition:t,currentPosition:t}))},r.prototype.clear=function(){this.element.innerHTML="",this.headers={}},r.prototype.getHierarchyLeafAt=function(e,t,i){return e?i.getFloatingHierarchyLeafAt(t):i.getHierarchyLeafAt(t)},r.prototype.removeUnusedHeaders=function(e){for(var t=0,i=this.getUnusedHeaders(e);t<i.length;t++){var o=i[t];this.element.removeChild(this.getHeader(o).getElement()),this.removeHeader(o)}},r.prototype.addHeader=function(e){var t=new g.PivotTableHeader;return this.headers[e]=t},r.prototype.removeHeader=function(e){delete this.headers[e]},r.prototype.getHeader=function(e){return this.headers[e]},r.prototype.getOrAddHeader=function(e){return this.getHeader(e)||this.addHeader(e)},r.prototype.getUnusedHeaders=function(e){var t,i=[];for(t in this.headers)e[t]||i.push(t);return i},e=r,g.RowHeaderRenderer=e,__extends(n,i=e),n.prototype.update=function(e,t,i,o,r,n){o=this.getRenderingContext(t,i,o,n);o&&(e&&this.render(e,t,0,n.getIndex(o.levelsContext[0].startItem),o,i,r,n),this.removeUnusedHeaders(o.addedHeaders))},n.prototype.getRenderingContext=function(e,t,i,o){i=e?{firstLeafIndex:0,firstLeafTop:0,lastLeafIndex:o.getFloatingHierarchyLeafCount()-1}:g.RowMeasurementUtil.getVisibleRange(t,i,this.rowHeightMeasureManager);if(!i)return null;var r=this.getHierarchyLeafAt(e,i.firstLeafIndex,o),n=[],e=i.firstLeafTop;for(n.push({startItem:r,currentPosition:e,startPosition:e});r;){var a,l=n[0];(r=o.getParent(r))&&(a=void 0,a=o.isLastItem(l.startItem,o.getChildren(r))&&l.currentPosition-t<0?l.currentPosition:t,n.unshift({startItem:r,currentPosition:a,startPosition:a}))}return{currentLeafIndex:i.firstLeafIndex,lastVisibledLeafIndex:i.lastLeafIndex,levelsContext:n,addedHeaders:{},done:!1}},n.prototype.render=function(e,t,i,o,r,n,a,l){for(var s=e.length,u=0,h=o;h<s&&(this.isA11yTable?u+=this.renderSelectionHeader(e[h],e,i,r,a,l):u+=this.renderHeader(e[h],e,t,i,r,n,a,l),!r.done);h++);return u},n.prototype.renderSelectionHeader=function(e,t,i,o,r,n){var a,l=0===n.getLeafIndex(e),t=n.isLastItem(e,t),r=r.getRowHeaderBinding(e,!1,this.isA11yTable,l,t),l=this.rowHeightMeasureManager.getRowHeight(o.currentLeafIndex);return r.styleProperties&&(p.getHeaderIndices(e,t=[],n),t=p.getHeaderKey(t),a=this.getOrAddHeader(t),(o.addedHeaders[t]=a).build(this.element,r,e,null,this.rowHeightResizeHandler,this.clickHandler,this.contextMenuHandler,this.interactionHandler,!1,!0,!1),a.getElement().style.height=l+"px",a.setWidth(g.SelectionIndicatorWidth),a.setTop(o.levelsContext[i].currentPosition),a.setLeft(this.rowLevelWidthMeasureManager.getLevelLeft(n.getLevel(e)))),p.ensureLevelContext(o.levelsContext,i),o.currentLeafIndex===o.lastVisibledLeafIndex?o.done=!0:(o.currentLeafIndex++,o.levelsContext[0].currentPosition+=l),l},n.prototype.renderHeader=function(e,t,i,o,r,n,a,l){var s,u=a.getRowHeaderBinding(e,!1),h=[],h=(p.getHeaderIndices(e,h,l),p.getHeaderKey(h)),d=this.getOrAddHeader(h);if((r.addedHeaders[h]=d).build(this.element,u,e,null,this.rowHeightResizeHandler,this.clickHandler,this.contextMenuHandler,this.interactionHandler,!1,this.isA11yTable,this.isA11yMatrix),d.setLeft(this.rowLevelWidthMeasureManager.getLevelLeft(l.getLevel(e))),p.ensureLevelContext(r.levelsContext,o),l.isLeaf(e))if(s=i?this.rowHeightMeasureManager.getFloatingRowHeight(r.currentLeafIndex):this.rowHeightMeasureManager.getRowHeight(r.currentLeafIndex),d.setTop(r.levelsContext[o].currentPosition),d.setHeight(s),r.currentLeafIndex===r.lastVisibledLeafIndex)r.done=!0;else{r.currentLeafIndex++;for(var c=o;c<r.levelsContext.length;c++)r.levelsContext[c].currentPosition+=s}else{h=void 0,h=r.levelsContext[o].startItem===e?l.getIndex(r.levelsContext[o+1].startItem):0,u=this.render(l.getChildren(e),i,o+1,h,r,n,a,l);d.setTop(r.levelsContext[o].currentPosition),s=r.levelsContext[o].startItem===e&&r.levelsContext[o].startPosition===n?u+r.levelsContext[o+1].startPosition-n:u,d.setHeight(s),r.levelsContext[o].currentPosition+=s}return d.setWidth(this.rowLevelWidthMeasureManager.getWidth(l.getLevel(e),g.PivotTableHierarchyNavigator.getHeaderSpan(e,l))),s},n.prototype.getCellAt=function(e){e=this.getHeader(p.getHeaderKey(e));return this.isA11yMatrix?e.getElement().firstChild:e.getElement()},g.BlockedRowHeaderRenderer=n,__extends(a,t=e),a.prototype.update=function(e,t,i,o,r,n){i=this.getRenderingContext(t,i,o,n);if(!i)return null;this.render(t,i,r,n),this.removeUnusedHeaders(i.addedHeaders)},a.prototype.clear=function(){this.element.innerHTML="",this.headers={}},a.prototype.render=function(e,t,i,o){for(var r=t.startTop,n=t.currentLeafIndex;n<=t.lastVisibledLeafIndex;n++){var a=[],l=this.getHierarchyLeafAt(e,n,o),a=(p.getHeaderIndices(l,a,o),p.getHeaderKey(a)),s=this.getOrAddHeader(a),l=(s.build(this.element,i.getRowHeaderBinding(l,!1),l,null,this.rowHeightResizeHandler,this.clickHandler,this.contextMenuHandler,this.interactionHandler,!1,!1,this.isA11yMatrix),void 0),l=e?this.rowHeightMeasureManager.getFloatingRowHeight(n):this.rowHeightMeasureManager.getRowHeight(n);s.setTop(r),s.setHeight(l),(t.addedHeaders[a]=s).setWidth(this.rowLevelWidthMeasureManager.getHeadersWidth()),r+=l}},a.prototype.getRenderingContext=function(e,t,i,o){e=e?{firstLeafIndex:0,firstLeafTop:0,lastLeafIndex:o.getFloatingHierarchyLeafCount()-1}:g.RowMeasurementUtil.getVisibleRange(t,i,this.rowHeightMeasureManager);return e?{currentLeafIndex:e.firstLeafIndex,lastVisibledLeafIndex:e.lastLeafIndex,startTop:e.firstLeafTop,addedHeaders:{},done:!1}:null},a.prototype.getCellAt=function(e){e=this.getHeader(p.getHeaderKey(e));return this.isA11yMatrix?e.getElement().firstChild:e.getElement()},g.SteppedRowHeaderRenderer=a,l.prototype.clear=function(){this.element.innerHTML="",this.headers={}},l.prototype.update=function(e,t,i,o){var r,t=this.getRenderingContext(e,t,o);t&&((r=o.getHierarchyItems())&&this.render(r,0,o.getIndex(t.levelsContext[0].startItem),t,e,i,o),this.removeUnusedHeaders(t.addedHeaders))},l.prototype.getRenderingContext=function(e,t,i){t=g.ColumnMeasurementUtil.getVisibleRange(e,t,this.columnWidthMeasureManager,g.PageColumnCount,this.columnWidthMeasureManager.getLastMeasuredIndex());if(!t)return null;var o=i.getHierarchyLeafAt(t.firstLeafIndex),r=[],n=t.firstLeafLeft;for(r.push({startItem:o,currentPosition:n,startPosition:n});o;){var a,l=r[0];(o=i.getParent(o))&&(a=void 0,a=i.isLastItem(l.startItem,i.getChildren(o))&&l.currentPosition-e<0?l.currentPosition:e,r.unshift({startItem:o,currentPosition:a,startPosition:a}))}return{currentLeafIndex:t.firstLeafIndex,lastVisibledLeafIndex:t.lastLeafIndex,levelsContext:r,addedHeaders:{},done:!1}},l.prototype.removeUnusedHeaders=function(e){for(var t=0,i=this.getUnusedHeaders(e);t<i.length;t++){var o=i[t];this.element.removeChild(this.getHeader(o).getElement()),this.removeHeader(o)}},l.prototype.render=function(e,t,i,o,r,n,a){for(var l=e.length,s=0,u=i;u<l&&(s+=this.renderHeader(e[u],e,t,o,r,n,a),!o.done);u++);return s},l.prototype.getHeight=function(e,t){for(var i=0,o=e;o<e+t;o++)i+=this.columnLevelHeightMeasureManager.getLevelHeight(o);return i},l.prototype.renderHeader=function(e,t,i,o,r,n,a){var l,s=[],s=(p.getHeaderIndices(e,s,a),p.getHeaderKey(s)),u=this.getOrAddHeader(s);if((o.addedHeaders[s]=u).build(this.element,n.getColumnHeaderBinding(e,!1,this.isA11yTable||this.isA11yMatrix,this.onObject),e,this.columnWidthResizeHandler,null,this.clickHandler,this.contextMenuHandler,this.interactionHandler,this.isA11yTable,!1,this.isA11yMatrix),u.setTop(this.columnLevelHeightMeasureManager.getLevelTop(a.getLevel(e))),p.ensureLevelContext(o.levelsContext,i),a.isLeaf(e))if(l=this.columnWidthMeasureManager.getColumnWidth(o.currentLeafIndex),u.setLeft(o.levelsContext[i].currentPosition),u.setWidth(l),o.currentLeafIndex===o.lastVisibledLeafIndex)o.done=!0;else{o.currentLeafIndex++;for(var h=i;h<o.levelsContext.length;h++)o.levelsContext[h].currentPosition+=l}else{s=void 0,s=o.levelsContext[i].startItem===e?a.getIndex(o.levelsContext[i+1].startItem):0,s=this.render(a.getChildren(e),i+1,s,o,r,n,a);u.setLeft(o.levelsContext[i].currentPosition),l=o.levelsContext[i].startItem===e&&o.levelsContext[i].startPosition===r?s+o.levelsContext[i+1].startPosition-r:s,u.setWidth(l),o.levelsContext[i].currentPosition+=l}return u.setHeight(this.getHeight(a.getLevel(e),g.PivotTableHierarchyNavigator.getHeaderSpan(e,a))),l},l.prototype.addHeader=function(e){var t=new g.PivotTableHeader;return this.headers[e]=t},l.prototype.removeHeader=function(e){delete this.headers[e]},l.prototype.getHeader=function(e){return this.headers[e]},l.prototype.getOrAddHeader=function(e){return this.getHeader(e)||this.addHeader(e)},l.prototype.getUnusedHeaders=function(e){var t,i=[];for(t in this.headers)e[t]||i.push(t);return i},l.prototype.getCellAt=function(e){e=this.getHeader(p.getHeaderKey(e));return this.isA11yTable||this.isA11yMatrix?e.getElement().firstChild:e.getElement()},g.ColumnHeaderRenderer=l,u.prototype.removeRowPages=function(e){for(var t=0;t<this.columnWidthMeasureManager.getPageColumns().length;t++){var i=this.getPage(e,t);i&&(this.element.removeChild(i.getElement()),this.removePage(e,t))}},u.prototype.update=function(e,t,i,o,r,n){for(var a=0,l=0,s=0,u=this.columnWidthMeasureManager.getPageColumns();s<u.length;s++){for(var h=u[s],d=0,c=0,p=h.getWidth(),g=0,m=t?[this.rowHeightMeasureManager.getFloatingPageRow()]:this.rowHeightMeasureManager.getPageRows();g<m.length;g++){var f=m[g],y=f.getHeight();this.rectsOverlap(a,d,p,y,e.left,e.top,e.width,e.height)?this.addBodyPage(e,c,l,a,d,p,y,f,h,t,i,o,r,n):this.getPage(c,l)&&this.removeBodyPageAsync(e,c,l,a,d,p,y),d+=y,c++}a+=p,l++}},u.prototype.clear=function(){this.element.innerHTML="",this.pages={}},u.prototype.resizeColumn=function(e){var t,i=g.MeasureUtil.getPageIndex(e,g.PageColumnCount),o=e%g.PageColumnCount;for(t in this.pages){var r=this.pages[t],n=this.columnWidthMeasureManager.getPageColumns()[r.columnIndex];r.columnIndex===i?r.resizeColumn(o,n):r.columnIndex>i&&(r.getElement().style.left=g.PivotTableControl.pixelUnits(this.columnWidthMeasureManager.getPageColumnLeft(n)))}},u.prototype.resizeRows=function(e,t){var i,o=g.MeasureUtil.itemRangeToPageRange(e,t,g.PageRowCount);for(i in this.pages)for(var r=this.pages[i],n=0,a=o;n<a.length;n++){var l=a[n];if(l.pageIndex===r.rowIndex){this.resizePageRows(r,this.rowHeightMeasureManager.getPageRows()[l.pageIndex],l.startIndex,l.endIndex);break}}for(i in this.pages){var r=this.pages[i],s=this.rowHeightMeasureManager.getPageRows()[r.rowIndex];r.getElement().style.top=g.PivotTableControl.pixelUnits(this.rowHeightMeasureManager.getPageRowTop(s))}},u.prototype.resizePageRows=function(e,t,i,o){e=e.getElement();if(e){for(var r=e.firstChild;r;)this.resizeCellsHeight(r,t,i,o),r=r.nextSibling;e.style.height=g.PivotTableControl.pixelUnits(t.getHeight())}},u.prototype.resizeCellsHeight=function(e,t,i,o){var r=e.firstChild;if(r){for(var n=0;n<i;n++)if(!(r=r.nextSibling))return;for(n=i;n<=o;n++)if(r.style.height=g.PivotTableControl.pixelUnits(t.getRowHeights()[n]),!(r=r.nextSibling))return}},u.prototype.addPage=function(e,t){var i=new g.PivotTableBodyPage(e,t);return this.pages[this.getPageKey(e,t)]=i},u.prototype.removePage=function(e,t){delete this.pages[this.getPageKey(e,t)]},u.prototype.getPage=function(e,t){return this.pages[this.getPageKey(e,t)]},u.prototype.getPageKey=function(e,t){return e.toString()+"_"+t.toString()},u.prototype.addBodyPage=function(i,o,r,n,a,l,s,u,h,d,c,p,g,e){function t(){var e,t;m.rectsOverlap(n,a,l,s,i.left,i.top,i.width,i.height)&&!m.getPage(o,r)&&(e=m.rowHeightMeasureManager.getPageRowStartIndex(u),t=m.columnWidthMeasureManager.getPageColumnStartIndex(h),-1!==e)&&-1!==t&&m.addPage(o,r).build(m.element,e,t,m.rowHeightMeasureManager,m.columnWidthMeasureManager,u,h,d,p,g,c,m.clickHandler,m.contextMenuHandler,m.interactionHandler)}var m=this;e?this.workScheduler.scheduleAnimationFrameTask(t):t()},u.prototype.removeBodyPageAsync=function(t,i,o,r,n,a,l){var s=this;this.workScheduler.scheduleAnimationFrameTask(function(){var e;s.rectsOverlap(r,n,a,l,t.left,t.top,t.width,t.height)||(e=s.getPage(i,o))&&(s.element.removeChild(e.getElement()),s.removePage(i,o))})},u.prototype.rectsOverlap=function(e,t,i,o,r,n,a,l){return s({left:e,top:t,width:i,height:o},{left:r,top:n,width:a,height:l})},u.prototype.getCellAt=function(e){var t=this.getPage(Math.floor(e.rowIndex/g.PageRowCount),Math.floor(e.columnIndex/g.PageColumnCount));return t.getCellAt(e.rowIndex%g.PageRowCount,e.columnIndex%g.PageColumnCount)},g.BodyCellRenderer=u,h.prototype.update=function(e,t,i,o,r){var n=this,a=this.rowHeightMeasureManager.getLastMeasuredIndex(),l=this.columnWidthMeasureManager.getLastMeasuredIndex();if(-1!==a&&-1!==l){var s,u,h,d=g.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager,g.PageRowCount,a),a=g.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,this.columnWidthMeasureManager,g.PageColumnCount,l);if((this.section!==g.TablixSection.Body||null!=d)&&null!=a){switch(this.section){case g.TablixSection.Header:s=[0,r.getHierarchyDepth()-1];break;case g.TablixSection.Body:s=[d.firstLeafIndex,d.lastLeafIndex],u=this.rowHeightMeasureManager.getPageRows(),h=this.columnWidthMeasureManager.getPageColumns();break;case g.TablixSection.Footer:s=[0,o.getFloatingHierarchyLeafCount()-1],u=[this.rowHeightMeasureManager.getFloatingPageRow()],h=this.columnWidthMeasureManager.getPageColumns();break;default:this.section}l=[a.firstLeafIndex,a.lastLeafIndex];this.renderMeta={viewport:e,binder:i,rowNavigator:o,columnNavigator:r,visibleRowRange:s,visibleColumnRange:l,pageRows:u,pageColumns:h},this.updateRendering(),this.interactionHandler&&(this.interactionHandler.isTooltipEnabledGeneric()&&!this.isTooltipSet?(this.interactionHandler.setTooltipDelegate(function(e){return n.getItemByElement(e.context)},this.element),this.isTooltipSet=!0):!this.interactionHandler.isTooltipEnabledGeneric()&&this.isTooltipSet&&(this.interactionHandler.removeTooltip(void 0,this.element),this.isTooltipSet=!1))}}},h.prototype.resizeColumn=function(t){var i,o,e,r;this.section,g.TablixSection.Header,this.renderMeta&&(i=this,e=g.MeasureUtil.getPageIndex(t,g.PageColumnCount),e=this.renderMeta.pageColumns[e],o=e.getColumnWidths()[t%g.PageColumnCount],e=this.columnWidthMeasureManager.getPageColumnLeft(e)+_.sum(e.getColumnWidths().slice(0,t%g.PageColumnCount)),r=this.getAriaColIndex(t),d3.select(this.element).selectAll('[aria-colindex="'.concat(r,'"]')).style("width",g.PivotTableControl.pixelUnits(o)).style("padding-right",function(){var e=parseFloat(d3.select(this).style("--padding-left")),t=(isNaN(e),parseFloat(d3.select(this).style("--padding-right")));return isNaN(t),o-e<t?g.PivotTableControl.pixelUnits(Math.max(o-e,0)):g.PivotTableControl.pixelUnits(t)}).style("padding-left",function(){var e=parseFloat(d3.select(this).style("--padding-left"));return isNaN(e),o<e?g.PivotTableControl.pixelUnits(o):g.PivotTableControl.pixelUnits(e)}).style("position",null).style("left",null).style("float","left").style("transform","translateX(".concat(e,"px)")),d3.select(this.element).selectAll('[role="gridcell"]').filter(function(){var e=i.getColumnIndex(this);return t<e}).style("position",null).style("left",null).style("float","left").style("transform","translateX(".concat(e,"px)")))},h.prototype.resizeRows=function(e,t){if(this.section,g.TablixSection.Header,this.renderMeta){for(var o=this,i=e;i<=t;i++){var r,n=g.MeasureUtil.getPageIndex(i,g.PageRowCount),n=this.renderMeta.pageRows[n].getRowHeights()[i%g.PageRowCount];(this.section===g.TablixSection.Body?(r=this.getAriaRowIndex(i),d3.select(this.element).select('[aria-rowindex="'.concat(r,'"]'))):d3.select(this.element).select('[role="row"]')).style("height",g.PivotTableControl.pixelUnits(n))}this.section===g.TablixSection.Body&&d3.select(this.element).selectAll('[role="row"]').style("top",function(){var e=o.getRowIndex(this),t=g.MeasureUtil.getPageIndex(e,g.PageRowCount),t=o.renderMeta.pageRows[t],i=o.rowHeightMeasureManager.getPageRowTop(t),t=_.sum(t.getRowHeights().slice(0,e%g.PageRowCount));return g.PivotTableControl.pixelUnits(i+t)})}},h.prototype.removeRowPages=function(){},h.prototype.clear=function(){d3.select(this.element).html(""),this.viewSync={},this.renderMeta=void 0},h.prototype.getCellAt=function(e){var t=this.getAriaColIndex(e.columnIndex);switch(this.section){case g.TablixSection.Header:break;case g.TablixSection.Body:var i=this.getAriaRowIndex(e.rowIndex),o=d3.select(this.element).select('[aria-rowindex="'.concat(i,'"] [aria-colindex="').concat(t,'"]')).node();break;case g.TablixSection.Footer:o=d3.select(this.element).select('[rowIndex="'.concat(e.rowIndex,'"] [aria-colindex="').concat(t,'"]')).node();break;default:this.section}return o},h.prototype.getItemByElement=function(e){e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches('[role="gridcell"]')},this.element,!0);return e?d3.select(e).datum():void 0},h.prototype.updateRendering=function(){var t=this,e=[],i=[];this.clearUnusedElements(),this.setGroupLocations(e,i),e.forEach(function(e){return t.insertRowGroup(e)}),i.forEach(function(e){return t.insertCellGroup(e)})},h.prototype.clearUnusedElements=function(){var e,t=this;for(e in this.viewSync)if(+e<this.renderMeta.visibleRowRange[0]||+e>this.renderMeta.visibleRowRange[1])delete this.viewSync[e];else for(var i in this.viewSync[e])(+i<this.renderMeta.visibleColumnRange[0]||+i>this.renderMeta.visibleColumnRange[1])&&delete this.viewSync[e][i];this.section===g.TablixSection.Body&&d3.select(this.element).selectAll('[role="row"]').filter(function(){var e=t.getRowIndex(this);return e<t.renderMeta.visibleRowRange[0]||e>t.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.element).selectAll('[role="columnheader"]').filter(function(){var e=t.getColumnIndex(this);return 0<=e&&(e<t.renderMeta.visibleColumnRange[0]||e>t.renderMeta.visibleColumnRange[1])}).remove(),d3.select(this.element).selectAll('[role="gridcell"]').filter(function(){var e=t.getColumnIndex(this);return 0<=e&&(e<t.renderMeta.visibleColumnRange[0]||e>t.renderMeta.visibleColumnRange[1])}).remove()},h.prototype.setGroupLocations=function(e,t){for(var i=this.renderMeta.visibleRowRange[0];i<=this.renderMeta.visibleRowRange[1];i++)if(this.viewSync[i])for(var o=!1,r=void 0,n=this.renderMeta.visibleColumnRange[0];n<=this.renderMeta.visibleColumnRange[1];n++)this.viewSync[i][n]?r=!1:(r?_.last(t).columnEnd++:(t.push({rowIndex:i,columnStart:n,columnEnd:n}),r=!0),this.viewSync[i][n]=!0);else{o?_.last(e).rowEnd++:(e.push({rowStart:i,rowEnd:i}),o=!0),this.viewSync[i]={};for(var n=this.renderMeta.visibleColumnRange[0];n<=this.renderMeta.visibleColumnRange[1];n++)this.viewSync[i][n]=!0}},h.prototype.insertRowGroup=function(e){for(var t,i=this.element.children,o=i.length-1;0<=o;o--){this.section,g.TablixSection.Body;var r=this.getRowIndex(i[o]);if(e.rowStart>r){t=i[o];break}}var n=[],a=this.section===g.TablixSection.Header?this.getRowGroupBindingsHeader(e.rowStart,e.rowEnd,n):this.getRowGroupBindings(e.rowStart,e.rowEnd,n),l=t?(t.insertAdjacentHTML("afterend",g.ElementBuilder.buildMultiple(a)),t.nextElementSibling):(this.element.insertAdjacentHTML("afterbegin",g.ElementBuilder.buildMultiple(a)),_.first(this.element.children));g.ElementBuilder.attachEventHandlersMultiple(l,a),this.bindRowGroupData(l,n)},h.prototype.insertCellGroup=function(e){l=this.section===g.TablixSection.Footer?this.element.firstElementChild:(l=this.getAriaRowIndex(e.rowIndex),d3.select(this.element).select('[aria-rowindex="'.concat(l,'"]')).node());for(var t,i=(this.section===g.TablixSection.Header?d3.select(l).selectAll('[role="columnheader"]'):d3.select(l).selectAll('[role="gridcell"]')).nodes(),o=i.length-1;0<=o;o--){var r=this.getColumnIndex(i[o]);if(e.columnStart>r){t=i[o];break}}var n=[],a=this.getCellGroupBindings(e.rowIndex,e.columnStart,e.columnEnd,n,!1),l=t?(t.insertAdjacentHTML("afterend",g.ElementBuilder.buildMultiple(a)),t.nextElementSibling):(l.insertAdjacentHTML("afterbegin",g.ElementBuilder.buildMultiple(a)),_.first(l.children));g.ElementBuilder.attachEventHandlersMultiple(l,a),this.bindCellGroupData(l,n)},h.prototype.getRowGroupBindingsHeader=function(e,t,i){for(var o,r=[],n=e;n<=t;n++){var a={classNames:["visually-hidden"],attributes:{role:"row","aria-rowindex":this.getAriaRowIndex(n).toString()},styleProperties:{},children:[]},l=this.getCellGroupBindings(n,this.renderMeta.visibleColumnRange[0],this.renderMeta.visibleColumnRange[1],i,!0);(o=a.children).push.apply(o,l),r.push(a)}return r},h.prototype.getRowGroupBindings=function(e,t,i){this.section,g.TablixSection.Header;for(var o=[],r=e;r<=t;r++){var n,a,l=this.renderMeta.pageRows[g.MeasureUtil.getPageIndex(r,g.PageRowCount)],s=l.getRowHeights()[r%g.PageRowCount],l=this.rowHeightMeasureManager.getPageRowTop(l)+_.sum(l.getRowHeights().slice(0,r%g.PageRowCount)),u=void 0,h=((u=this.renderType===g.RenderType.Table?(h=this.section===g.TablixSection.Body?this.renderMeta.rowNavigator.getHierarchyLeafAt(r):this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(r),n=(n=this.renderMeta.columnNavigator.getColumnIndexFromQueryName(this.renderMeta.binder.getRowReferenceQueryName()))?this.renderMeta.rowNavigator.getIntersection(h,n):void 0,a=h===_.first(this.renderMeta.rowNavigator.getHierarchyItems()),d=h===_.last(this.renderMeta.rowNavigator.getHierarchyItems()),a=this.renderMeta.binder.getBorderInfo(a,d,!0,!0,void 0,this.section),d=this.section===g.TablixSection.Footer,this.renderMeta.binder.getRowBinding(h,d,n,a)):{classNames:[],attributes:{},styleProperties:{},children:[]}).attributes.role="row",this.section!==g.TablixSection.Footer?u.attributes["aria-rowindex"]=this.getAriaRowIndex(r).toString():u.attributes.rowIndex=r.toString(),u.styleProperties.position="absolute",u.styleProperties.height=g.PivotTableControl.pixelUnits(s),u.styleProperties.top=g.PivotTableControl.pixelUnits(l),u.styleProperties.width="100%",this.renderType===g.RenderType.Matrix),d=this.getCellGroupBindings(r,this.renderMeta.visibleColumnRange[0],this.renderMeta.visibleColumnRange[1],i,h);(n=u.children).push.apply(n,d),o.push(u)}return o},h.prototype.getCellGroupBindings=function(e,t,i,o,r){var n=[];if(this.section!==g.TablixSection.Header){r&&n.push.apply(n,this.getRowHeaderBindings(e));for(var a=this.renderMeta.pageRows[g.MeasureUtil.getPageIndex(e,g.PageRowCount)].getRowHeights()[e%g.PageRowCount],l=t;l<=i;l++){var s=this.renderMeta.pageColumns[g.MeasureUtil.getPageIndex(l,g.PageColumnCount)],u=s.getColumnWidths()[l%g.PageColumnCount],h=this.columnWidthMeasureManager.getPageColumnLeft(s),s=_.sum(s.getColumnWidths().slice(0,l%g.PageColumnCount));n.push(this.getCellBinding(e,l,a,u,h+s,o))}}else{r&&n.push.apply(n,this.getCornerBindings(e));for(l=t;l<=i;l++)n.push(this.getColumnHeaderBinding(e,l))}return n},h.prototype.getCornerBindings=function(e){for(var t=[],i=this.renderMeta.rowNavigator.getHierarchyDepth(),o=0;o<i;o++){var r=this.renderMeta.rowNavigator.getCorner(o,e),r=this.renderMeta.binder.getCornerCellBinding(r,!1);r.attributes||(r.attributes={}),r.styleProperties||(r.styleProperties={}),r.attributes.role="columnheader",r.attributes["aria-colindex"]=(o+1).toString(),r.styleProperties.position="absolute",r.styleProperties.height="0",r.styleProperties.width="0",r.styleProperties.padding="0",r.styleProperties.overflow="hidden",r.styleProperties["white-space"]="nowrap",t.push(r)}return t},h.prototype.getColumnHeaderBinding=function(e,t){this.renderType,g.RenderType.Table;var i=this.renderMeta.columnNavigator.getHierarchyLeafAt(t);return this.renderMeta.columnNavigator.getLevel(i)<e?{attributes:{role:"columnheader","aria-colindex":this.getAriaColIndex(t).toString()},classNames:[],styleProperties:{}}:(i=this.renderMeta.columnNavigator.getLeafAncestorAtLevel(i,e),(e=this.renderMeta.binder.getColumnHeaderBinding(i,!1,!1)).attributes.role="columnheader",e.attributes["aria-colindex"]=this.getAriaColIndex(t).toString(),e.styleProperties.position="absolute",e.styleProperties.height="0",e.styleProperties.width="0",e.styleProperties.padding="0",e.styleProperties.overflow="hidden",e.styleProperties["white-space"]="nowrap",e)},h.prototype.getRowHeaderBindings=function(e){this.section,g.TablixSection.Header;for(var t,i=[],o=this.renderMeta.rowNavigator.getHierarchyDepth(),r=this.section===g.TablixSection.Body?this.renderMeta.rowNavigator.getHierarchyLeafAt(e):this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(e),n=this.renderMeta.rowNavigator.getLevel(r),a=0;a<o;a++)n<a?i.push({attributes:{role:"rowheader","aria-colindex":(a+1).toString()},classNames:[],styleProperties:{}}):(t=this.renderMeta.rowNavigator.getLeafAncestorAtLevel(r,a),(t=this.renderMeta.binder.getRowHeaderBinding(t,!1)).attributes||(t.attributes={}),t.styleProperties||(t.styleProperties={}),t.attributes.role="rowheader",t.attributes["aria-colindex"]=(a+1).toString(),t.styleProperties.position="absolute",t.styleProperties.height="0",t.styleProperties.width="0",t.styleProperties.padding="0",t.styleProperties.overflow="hidden",t.styleProperties["white-space"]="nowrap",i.push(t));return i},h.prototype.getCellBinding=function(e,t,i,o,r,n){this.section,g.TablixSection.Header;var e=this.section===g.TablixSection.Body?this.renderMeta.rowNavigator.getHierarchyLeafAt(e):this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(e),a=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),e=this.renderMeta.rowNavigator.getIntersection(e,a),a=this.renderMeta.binder.getBodyCellBinding(e,!1,i,o,!0,this.onObject),i=(a.attributes||(a.attributes={}),a.styleProperties||(a.styleProperties={}),a.attributes.role="gridcell",a.attributes["aria-colindex"]=this.getAriaColIndex(t).toString(),a.attributes.tabindex="0",a.styleProperties.position="absolute",a.styleProperties["box-sizing"]="border-box",a.styleProperties.height="100%",a.styleProperties.width=g.PivotTableControl.pixelUnits(o),a.styleProperties.left=g.PivotTableControl.pixelUnits(r),parseFloat(a.styleProperties["padding-left"])),t=(isNaN(i),parseFloat(a.styleProperties["padding-right"]));return isNaN(t),a.styleProperties["--padding-left"]=a.styleProperties["padding-left"],a.styleProperties["--padding-right"]=a.styleProperties["padding-right"],o-i<t&&(a.styleProperties["padding-right"]=g.PivotTableControl.pixelUnits(Math.max(o-i,0))),o<i&&(a.styleProperties["padding-left"]=g.PivotTableControl.pixelUnits(o)),n.push(e),a},h.prototype.bindRowGroupData=function(e,t){for(var i=e,o=0;o<t.length;)d3.select(i).selectAll('[role="gridcell"]:not([selection-cell])').each(function(){d3.select(this).data([t[o]]),o++}),i=i.nextElementSibling},h.prototype.bindCellGroupData=function(e,t){for(var i=e,o=0,r=t;o<r.length;o++){var n=r[o];d3.select(i).data([n]),i=i.nextElementSibling}},h.prototype.getAriaRowIndex=function(e){switch(this.section){case g.TablixSection.Header:t=e+1;break;case g.TablixSection.Body:var t=e+1+this.renderMeta.columnNavigator.getHierarchyDepth();break;case g.TablixSection.Footer:break;default:this.section}return t},h.prototype.getAriaColIndex=function(e){return e+1+this.renderMeta.rowNavigator.getHierarchyDepth()},h.prototype.getRowIndex=function(e){var t=this.renderMeta.columnNavigator.getHierarchyDepth();return o.internal.TableExUtils.getTablixRowIndex(e,this.section,t)},h.prototype.getColumnIndex=function(e){var t=this.renderType===g.RenderType.Table?1:this.renderMeta.rowNavigator.getHierarchyDepth();return o.internal.TableExUtils.getTablixColumnIndex(e,t)},g.TablixRenderer=h,d.prototype.update=function(e,t,i,o){var r;switch(this.section){case g.TablixSection.Header:r={firstLeafIndex:0,firstLeafTop:0,lastLeafIndex:0};break;case g.TablixSection.Body:r=g.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager);break;case g.TablixSection.Footer:r=1===i.getFloatingHierarchyLeafCount()?{firstLeafIndex:0,firstLeafTop:0,lastLeafIndex:0}:void 0;break;default:this.section}var n,a=g.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,this.columnWidthMeasureManager);r&&a&&(n=[r.firstLeafIndex,r.lastLeafIndex],a=[a.firstLeafIndex,a.lastLeafIndex],this.renderMeta={binder:t,rowNavigator:i,columnNavigator:o,visibleRowRange:n,visibleColumnRange:a},this.updateRendering())},d.prototype.updateMeasureManagers=function(e,t,i,o,r){this.rowHeightMeasureManager=t,this.columnWidthMeasureManager=i,this.columnLevelHeightMeasureManager=r},d.prototype.resizeColumn=function(o){var r,e;this.renderMeta&&(r=this,e=function(){var e,t,i=+d3.select(this).attr("border-column-index");i<o||d3.select(this).classed("border-left")||(t=g.MeasureUtil.getPageIndex(i,g.PageColumnCount),e=(t=r.columnWidthMeasureManager.getPageColumns()[t]).getColumnWidths()[i%g.PageColumnCount],t=r.columnWidthMeasureManager.getPageColumnLeft(t)+_.sum(t.getColumnWidths().slice(0,i%g.PageColumnCount))+e-+d3.select(this).style("stroke-width")/2,d3.select(this).attr("x1",t).attr("x2",t))},d3.select(this.svgBottomLayer).selectAll("[border-column-index]").each(e),d3.select(this.svgTopLayer).selectAll("[border-column-index]").each(e))},d.prototype.resizeRows=function(o,r){var n,e;this.renderMeta&&(e=(n=this).section===g.TablixSection.Body?function(){var e,t,i=+d3.select(this).attr("border-row-index");i<o||r<i||d3.select(this).classed("border-top")||(t=g.MeasureUtil.getPageIndex(i,g.PageRowCount),e=(t=n.rowHeightMeasureManager.getPageRows()[t]).getRowHeights()[i%g.PageRowCount],t=n.rowHeightMeasureManager.getPageRowTop(t)+_.sum(t.getRowHeights().slice(0,i%g.PageRowCount))+e-+d3.select(this).style("stroke-width")/2,d3.select(this).attr("y1",t).attr("y2",t))}:function(){var e;d3.select(this).classed("border-top")||(e=+d3.select(this).style("stroke-width"),isNaN(+d3.select(this).attr("y1")))||(d3.select(this).attr("y1","100%").attr("y2","100%"),d3.select(this).style("stroke-width",2*e))},d3.select(this.svgBottomLayer).selectAll("[border-row-index]").each(e),d3.select(this.svgTopLayer).selectAll("[border-row-index]").each(e))},d.prototype.clear=function(){d3.select(this.svgTopLayer).html(""),d3.select(this.svgBottomLayer).html(""),this.viewSync={rows:{},columns:{}}},d.prototype.updateRendering=function(){var t=this,e=[];this.clearUnusedElements(),this.setGroupLocations(e),e.forEach(function(e){return t.insertBorder(e)})},d.prototype.clearUnusedElements=function(){var e,t,i=this;for(e in this.viewSync.rows)(+e<this.renderMeta.visibleRowRange[0]||+e>this.renderMeta.visibleRowRange[1])&&delete this.viewSync.rows[e];for(t in this.viewSync.columns)(+t<this.renderMeta.visibleColumnRange[0]||+t>this.renderMeta.visibleColumnRange[1])&&delete this.viewSync.columns[t];d3.select(this.svgTopLayer).selectAll("[border-row-index]").filter(function(){var e=+d3.select(this).attr("border-row-index");return e<i.renderMeta.visibleRowRange[0]||e>i.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.svgTopLayer).selectAll("[border-column-index]").filter(function(){var e=+d3.select(this).attr("border-column-index");return e<i.renderMeta.visibleColumnRange[0]||e>i.renderMeta.visibleColumnRange[1]}).remove(),d3.select(this.svgBottomLayer).selectAll("[border-row-index]").filter(function(){var e=+d3.select(this).attr("border-row-index");return e<i.renderMeta.visibleRowRange[0]||e>i.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.svgBottomLayer).selectAll("[border-column-index]").filter(function(){var e=+d3.select(this).attr("border-column-index");return e<i.renderMeta.visibleColumnRange[0]||e>i.renderMeta.visibleColumnRange[1]}).remove()},d.prototype.setGroupLocations=function(e){for(var t=this.renderMeta.visibleRowRange[0];t<=this.renderMeta.visibleRowRange[1];t++)this.viewSync.rows[t]||(e.push({delegateRowIndex:t,delegateColumnIndex:this.renderMeta.visibleColumnRange[0],orientation:"horizontal"}),this.viewSync.rows[t]=!0);for(var i=this.renderMeta.visibleColumnRange[0];i<=this.renderMeta.visibleColumnRange[1];i++)this.viewSync.columns[i]||(e.push({delegateRowIndex:this.renderMeta.visibleRowRange[0],delegateColumnIndex:i,orientation:"vertical"}),this.viewSync.columns[i]=!0)},d.prototype.insertBorder=function(e){var t,i,o,r,n,a=this,l=e.delegateRowIndex,s=e.delegateColumnIndex,u=(this.section===g.TablixSection.Header?i=this.renderMeta.columnNavigator.getHierarchyItems()[e.delegateColumnIndex]:this.section===g.TablixSection.Body?(u=this.renderMeta.rowNavigator.getHierarchyLeafAt(l),h=this.renderMeta.columnNavigator.getHierarchyLeafAt(s),i=this.renderMeta.rowNavigator.getIntersection(u,h),l+1<=this.renderMeta.rowNavigator.getHierarchyLeafCount()-1&&(t=this.renderMeta.rowNavigator.getHierarchyLeafAt(l+1))):this.section===g.TablixSection.Footer&&(u=this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(l),h=this.renderMeta.columnNavigator.getHierarchyLeafAt(s),i=this.renderMeta.rowNavigator.getIntersection(u,h)),[]),h=[];"horizontal"===e.orientation?(this.section===g.TablixSection.Header?(o=this.columnLevelHeightMeasureManager.getLevelHeight(0),this.renderMeta.binder.getHorizontalBorderBindings(i,t,0,o,this.section,u,h)):(e=this.section===g.TablixSection.Footer?[this.rowHeightMeasureManager.getFloatingPageRow()]:this.rowHeightMeasureManager.getPageRows(),r=g.MeasureUtil.getPageIndex(l,g.PageRowCount),n=this.rowHeightMeasureManager.getPageRowTop(e[r])+_.sum(e[r].getRowHeights().slice(0,l%g.PageRowCount)),o=e[r].getRowHeights()[l%g.PageRowCount],this.renderMeta.binder.getHorizontalBorderBindings(i,t,n,o,this.section,u,h)),h.forEach(function(e){a.svgTopLayer.insertAdjacentHTML("afterbegin",g.ElementBuilder.build(e))}),u.forEach(function(e){a.svgBottomLayer.insertAdjacentHTML("afterbegin",g.ElementBuilder.build(e))})):(e=this.columnWidthMeasureManager.getPageColumns(),r=g.MeasureUtil.getPageIndex(s,g.PageColumnCount),l=this.columnWidthMeasureManager.getPageColumnLeft(e[r])+_.sum(e[r].getColumnWidths().slice(0,s%g.PageColumnCount)),n=e[r].getColumnWidths()[s%g.PageColumnCount],this.renderMeta.binder.getVerticalBorderBindings(i,t,l,n,this.section,u,h),h.forEach(function(e){a.svgTopLayer.insertAdjacentHTML("beforeend",g.ElementBuilder.build(e))}),u.forEach(function(e){a.svgBottomLayer.insertAdjacentHTML("beforeend",g.ElementBuilder.build(e))}))},g.BorderRenderer=d,c.prototype.update=function(e,t,i){for(var o=t.getHierarchyDepth(),r=i.getHierarchyDepth(),n=0;n<o;n++)for(var a=0;a<r;a++)this.renderHeader(n,a,e,t)},c.prototype.clear=function(){this.element.innerHTML="",this.headers={}},c.prototype.renderHeader=function(e,t,i,o){var o=o.getCorner(e,t),r=p.getHeaderKey([e,t]),r=this.getOrAddHeader(r),i=i.getCornerCellBinding(o,!1),i=(r.build(this.element,i,o,this.rowLevelWidthResizeHandler,this.columnLevelHeightResizeHandler,this.clickHandler,this.contextMenuHandler,this.interactionHandler,!1,!1,this.isA11yMatrix),this.rowLevelWidthMeasureManager.getLevelWidth(e)),o=this.rowLevelWidthMeasureManager.getLevelLeft(e),e=this.columnLevelHeightMeasureManager.getLevelHeight(t),t=this.columnLevelHeightMeasureManager.getLevelTop(t);r.setHeight(e),r.setWidth(i),r.setTop(t),r.setLeft(o)},c.prototype.addHeader=function(e){var t=new g.PivotTableHeader;return this.headers[e]=t},c.prototype.getHeader=function(e){return this.headers[e]},c.prototype.getOrAddHeader=function(e){return this.getHeader(e)||this.addHeader(e)},c.prototype.getCellAt=function(e){e=this.headers[p.getHeaderKey([e.rowLevel,e.columnLevel])];return e.getElement().firstElementChild},g.CornerRenderer=c}(powerbi=powerbi||{}),function(y){var e,c,b,o,t,v,s,p,l,i,S,P;function C(e,t,i,o,r,n,a,l,s){var u,h,d=this;this.hostServices=s,this.isA11yTable=o,this.isA11yMatrix=r,this.onObject=n,this.workScheduler=new y.WorkScheduler,this.sizeManager=t,this.isA11yTable?(n=s.getLocalizedString(c.internal.TablixUtils.RowSelection),t=s.getLocalizedString(c.internal.TablixUtils.ScrollUpLabel),u=s.getLocalizedString(c.internal.TablixUtils.ScrollDownLabel),h=s.getLocalizedString(c.internal.TablixUtils.ScrollLeftLabel),s=s.getLocalizedString(c.internal.TablixUtils.ScrollRightLabel),t="<div style='position:relative' role='document'>"+"<button class='scrollUp visually-hidden'>".concat(t,"</button>")+"<button class='scrollDown visually-hidden'>".concat(u,"</button>")+"<button class='scrollLeft visually-hidden'>".concat(h,"</button>")+"<button class='scrollRight visually-hidden'>".concat(s,"</button>")+"<div role='grid' ignore-focus-loss='true' class='innerContainer' style='position:absolute;left:0;top:0;right:0;bottom:0'><div class='corner'></div><div role='row' aria-rowindex='1' class='columnHeaders' style='position:absolute;overflow:auto;right:0;top:0;-ms-overflow-style:none'>"+"<div role='columnheader' aria-colindex='1' tabindex='0' class='visually-hidden'>".concat(n,"</div>")+"<div role='presentation'></div><svg class='columnHeaderSVGBottom' style='position:absolute;top:0;pointer-events:none'></svg><svg class='columnHeaderSVGTop' style='position:absolute;top:0;pointer-events:none'></svg></div><div class='rowHeaders' style='position:absolute;overflow:auto;left:0;bottom:0;-ms-overflow-style:none'><div></div></div><div role='presentation' class='bodyCells' style='position:absolute;overflow:auto;left:0;top:0;right:0;bottom:0;-ms-overflow-style:none;box-sizing:border-box'><div role='presentation' style='position:absolute;overflow:hidden'></div><svg class='bodySVGBottom' style='position:absolute;pointer-events:none'></svg><svg class='bodySVGTop' style='position:absolute;pointer-events:none'></svg></div><div class='floatingRowHeader' style='position:absolute;left:0'></div><div class='floatingBodyCells' style='position:absolute;overflow:auto;right:0;-ms-overflow-style:none'><div style='position:absolute;overflow:hidden'></div><svg class='floatingBodySVGBottom' style='position:absolute;pointer-events:none'></svg><svg class='floatingBodySVGTop' style='position:absolute;pointer-events:none'></svg></div></div><div class='measureElement' style='position:absolute;left:0;top:0;visibility:hidden'></div></div>",e.insertAdjacentHTML("beforeend",t)):this.isA11yMatrix?e.insertAdjacentHTML("beforeend","<div style='position:relative'><div role='treegrid' ignore-focus-loss='true' class='innerContainer' style='position:absolute;left:0;top:0;right:0;bottom:0'><div class='corner' ></div><div class='columnHeaders' style='position:absolute;overflow:auto;right:0;top:0;-ms-overflow-style:none'><div></div></div><div class='semanticColumnHeaders' style='position:absolute;overflow:auto;right:0;top:0;-ms-overflow-style:none'><div></div></div><div class='rowHeaders' style='position:absolute;overflow:auto;left:0;bottom:0;-ms-overflow-style:none'><div></div></div><div class='bodyCells' style='position:absolute;overflow:auto;left:0;top:0;right:0;bottom:0;-ms-overflow-style:none;box-sizing:border-box'><div style='position:absolute;overflow:hidden'></div></div><div class='floatingRowHeader' style='position:absolute;left:0'></div><div class='floatingBodyCells' style='position:absolute;overflow:auto;right:0;-ms-overflow-style:none'><div></div></div></div><div class='measureElement' style='position:absolute;left:0;top:0;visibility:hidden'></div></div>"):e.insertAdjacentHTML("beforeend","<div style='position:relative' tabindex='0' aria-label='Grid'><div class='innerContainer' style='position:absolute;left:0;top:0;right:0;bottom:0'><div class='corner' ></div><div class='columnHeaders' style='position:absolute;overflow:auto;right:0;top:0;-ms-overflow-style:none'><div></div></div><div class='rowHeaders' style='position:absolute;overflow:auto;left:0;bottom:0;-ms-overflow-style:none'><div></div></div><div class='bodyCells' style='position:absolute;overflow:auto;left:0;top:0;right:0;bottom:0;-ms-overflow-style:none;box-sizing:border-box'><div style='position:absolute;overflow:hidden'></div></div><div class='floatingRowHeader' style='position:absolute;left:0'></div><div class='floatingBodyCells' style='position:absolute;overflow:auto;right:0;-ms-overflow-style:none'><div></div></div></div><div class='measureElement' style='position:absolute;left:0;top:0;visibility:hidden'></div></div>"),this.element=e.lastChild,this.innerContainer=this.element.querySelector(".innerContainer"),this.measureElement=this.element.querySelector(".measureElement"),this.cornerContainer=this.element.querySelector(".corner"),this.cornerContainer.setAttribute("drag-resize-disabled","true"),this.columnHeaderContainer=this.element.querySelector(".columnHeaders"),this.isA11yTable?(this.innerColumnHeaderContainer=this.columnHeaderContainer.children[1],this.columnHeaderSVGBottomContainer=this.columnHeaderContainer.children[2],this.columnHeaderSVGTopContainer=this.columnHeaderContainer.children[3]):this.innerColumnHeaderContainer=this.columnHeaderContainer.firstChild,this.innerColumnHeaderContainer.setAttribute("drag-resize-disabled","true"),this.isA11yMatrix&&(this.semanticColumnHeaderContainer=this.element.querySelector(".semanticColumnHeaders"),this.innerSemanticColumnHeaderContainer=this.semanticColumnHeaderContainer.firstChild,this.innerSemanticColumnHeaderContainer.setAttribute("drag-resize-disabled","true")),this.rowHeaderContainer=this.element.querySelector(".rowHeaders"),this.innerRowHeaderContainer=this.rowHeaderContainer.firstChild,this.innerRowHeaderContainer.setAttribute("drag-resize-disabled","true"),this.bodyCellContainer=this.element.querySelector(".bodyCells"),this.innerBodyCellContainer=this.bodyCellContainer.firstChild,this.isA11yTable&&(this.bodySVGTopContainer=this.element.querySelector(".bodySVGTop"),this.bodySVGBottomContainer=this.element.querySelector(".bodySVGBottom")),this.floatingRowHeaderContainer=this.element.querySelector(".floatingRowHeader"),this.floatingBodyCellContainer=this.element.querySelector(".floatingBodyCells"),this.innerFloatingBodyCellContainer=this.floatingBodyCellContainer.firstChild,this.isA11yTable&&(this.floatingBodySVGTopContainer=this.element.querySelector(".floatingBodySVGTop"),this.floatingBodySVGBottomContainer=this.element.querySelector(".floatingBodySVGBottom")),d3.select(this.element).select(".scrollUp").on("click",function(){null!=(e=d.rowScrollbar)&&e.scrollPageUp();var e=d.getViewport(),e=v.RowMeasurementUtil.getVisibleRange(e.top,e.height,d.rowHeightMeasureManager,v.PageRowCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());a(e.firstLeafIndex,e.lastLeafIndex)}),d3.select(this.element).select(".scrollDown").on("click",function(){null!=(e=d.rowScrollbar)&&e.scrollPageDown();var e=d.getViewport(),e=v.RowMeasurementUtil.getVisibleRange(e.top,e.height,d.rowHeightMeasureManager,v.PageRowCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());a(e.firstLeafIndex,e.lastLeafIndex)}),d3.select(this.element).select(".scrollLeft").on("click",function(){null!=(e=d.columnScrollbar)&&e.scrollPageUp();var e=d.getViewport(),e=v.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,d.columnWidthMeasureManager,v.PageColumnCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());l(e.firstLeafIndex,e.lastLeafIndex)}),d3.select(this.element).select(".scrollRight").on("click",function(){null!=(e=d.columnScrollbar)&&e.scrollPageDown();var e=d.getViewport(),e=v.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,d.columnWidthMeasureManager,v.PageColumnCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());l(e.firstLeafIndex,e.lastLeafIndex)}),this.options=i,this.initializeContainersForScrolling(this.options.scrollingEnabled),this.initializeScrollbars(),this.options.whitespaceClickHandler&&this.innerContainer.addEventListener("click",function(e){return d.onClick(e)}),this.options.columnResizingEnabled&&(this.columnWidthResizeHandler=new v.ColumnWidthResizeHandler(this,this.isA11yTable,this.isA11yMatrix)),this.options.rowLevelResizingEnabled&&(this.rowLevelWidthResizeHandler=new v.RowLevelWidthResizeHandler(this,this.isA11yMatrix)),o||r?$(this.element).on(p,function(){return d.onFocusManagerEnter()}):($(this.element).on(p,function(){return d.onFocus()}),this.element.addEventListener("blur",function(e){return d.onBlur(e)})),this.element.addEventListener("keydown",function(e){return d.onKeyDown(e)}),this.focusManager=new v.PivotTableFocusManager(function(){return d.onFocusChanged()},this.isA11yTable,this.isA11yMatrix,this.columnHeaderContainer,this.bodyCellContainer,this.cornerContainer,this.rowHeaderContainer,this.floatingRowHeaderContainer,this.floatingBodyCellContainer),this.setSteppedLayout(!1)}function r(e,t){this.rowIndex=e,this.columnIndex=t}function n(){this.columnWidths=[]}function a(){this.rowHeights=[]}function w(){}function u(){}e=y.visuals||(y.visuals={}),c=e.controls||(e.controls={}),v=c.pivotTable||(c.pivotTable={}),s=jsCommon.BrowserUtils,p=jsCommon.FocusManagerFocusEventName,l=y.visuals.PivotTableAttributeDelimiter,v.ScrollbarWidth=9,v.SelectionIndicatorWidth=4,i="<div style='position:absolute;overflow:hidden'></div>",(e=b=v.PivotTableRenderingMode||(v.PivotTableRenderingMode={}))[e.Incremental=0]="Incremental",e[e.ClearRendering=1]="ClearRendering",e[e.ClearMeasurement=2]="ClearMeasurement",e[e.ClearMeasurementOnly=3]="ClearMeasurementOnly",e[e.ResizeColumn=4]="ResizeColumn",(e=o=v.TablixSection||(v.TablixSection={}))[e.Header=0]="Header",e[e.Body=1]="Body",e[e.Footer=2]="Footer",e[e.FooterHeader=3]="FooterHeader",e[e.MatrixRowHeader=4]="MatrixRowHeader",e[e.MatrixCorner=5]="MatrixCorner",(e=t=v.RenderType||(v.RenderType={}))[e.Table=0]="Table",e[e.Matrix=1]="Matrix",(e=v.RowHeaderType||(v.RowHeaderType={}))[e.Blocked=0]="Blocked",e[e.Stepped=1]="Stepped",(e=v.TablixRegion||(v.TablixRegion={}))[e.Prefix=0]="Prefix",e[e.Main=1]="Main",C.prototype.updateOptions=function(e){this.options=e},C.prototype.onFocusManagerEnter=function(){this.hostServices.telemetry().trace(2,"TableKeyboardFocused"),this.focusManager.updateFocus(),this.getFocusedCell(this.focusManager.CurrentFocus).focus()},C.prototype.onFocus=function(){this.hasFocus=!0,this.focusManager.initialize()},C.prototype.onBlur=function(e){this.hasFocus=!1,this.clearFocusStyle()},C.prototype.onKeyDown=function(t){var i=this;if(this.isA11yTable||this.isA11yMatrix||this.hasFocus){(this.isA11yTable||this.isA11yMatrix)&&this.focusManager.updateFocus();var e=t.code||t.key,o=t.shiftKey,r=s.isCtrlOrMeta(t),n=t.altKey,a=this.isA11yTable,l=this.isA11yMatrix;if("Escape"===e||"Esc"===e)this.runIfFrameReady(function(){i.hasFocus=!1});else if("ArrowRight"===e||"Right"===e)t.stopPropagation(),t.preventDefault(),this.runIfFrameReady(function(){o?i.focusManager.CurrentFocus.columnHeader&&i.columnWidthResizeHandler?(i.columnWidthResizeHandler.onStartResize(i.focusManager.CurrentFocus.item),i.columnWidthResizeHandler.onResize({x:1,y:0}),i.columnWidthResizeHandler.onEndResize()):i.options.rowHeaderExpandCollapseHandler&&i.focusManager.CurrentFocus.rowHeader&&1===i.rowNavigator.getExpansionState(i.focusManager.CurrentFocus.item)&&i.options.rowHeaderExpandCollapseHandler(i.focusManager.CurrentFocus.item,!1):i.focusManager.moveFocus("right",r,a,l)});else if("ArrowLeft"===e||"Left"===e)t.stopPropagation(),t.preventDefault(),this.runIfFrameReady(function(){o?i.focusManager.CurrentFocus.columnHeader&&i.columnWidthResizeHandler?(i.columnWidthResizeHandler.onStartResize(i.focusManager.CurrentFocus.item),i.columnWidthResizeHandler.onResize({x:-1,y:0}),i.columnWidthResizeHandler.onEndResize(),t.preventDefault(),t.stopPropagation()):i.options.rowHeaderExpandCollapseHandler&&i.focusManager.CurrentFocus.rowHeader&&0===i.rowNavigator.getExpansionState(i.focusManager.CurrentFocus.item)&&i.options.rowHeaderExpandCollapseHandler(i.focusManager.CurrentFocus.item,!0):i.focusManager.moveFocus("left",r,a,l)});else if("ArrowUp"===e||"Up"===e)t.stopPropagation(),t.preventDefault(),this.runIfFrameReady(function(){(a||l)&&o&&!r?(i.selectFocus(t),i.focusManager.moveFocus("up",r,a,l),i.selectFocus(t)):i.focusManager.moveFocus("up",r,a,l)});else if("ArrowDown"===e||"Down"===e)t.stopPropagation(),t.preventDefault(),this.runIfFrameReady(function(){(a||l)&&o&&!r?(i.selectFocus(t),i.focusManager.moveFocus("down",r,a,l),i.selectFocus(t)):i.focusManager.moveFocus("down",r,a,l)});else{if(a||l){if("Tab"===e)return t.stopPropagation(),void t.preventDefault();if("Home"===e)return t.stopPropagation(),t.preventDefault(),void this.runIfFrameReady(function(){i.focusManager.moveFocus("home",r,a,l)});if("End"===e)return t.stopPropagation(),t.preventDefault(),void this.runIfFrameReady(function(){i.focusManager.moveFocus("end",r,a,l)});if(this.focusManager.CurrentFocus&&this.focusManager.CurrentFocus.bodyCell){if("PageDown"===e)return t.stopPropagation(),t.preventDefault(),void this.runIfFrameReady(function(){i.focusManager.moveFocus("pagedown",r,a,l,i.getNumberOfVisibleRows())});if("PageUp"===e)return t.stopPropagation(),t.preventDefault(),void this.runIfFrameReady(function(){i.focusManager.moveFocus("pageup",r,a,l,i.getNumberOfVisibleRows())})}}"F10"===e&&o?r||(t.preventDefault(),t.stopPropagation(),this.runIfFrameReady(function(){i.showContextMenuForFocus(t)})):"Enter"===e||"Space"===e||"Spacebar"===e||" "===e?(t.preventDefault(),t.stopPropagation(),this.runIfFrameReady(function(){i.selectFocus(t)})):("KeyO"===e&&r&&n&&(t.preventDefault(),t.stopPropagation(),this.runIfFrameReady(function(){i.activateCellContent()})),("KeyC"===e||"c"===e)&&r&&o?(t.stopPropagation(),t.preventDefault(),this.runIfFrameReady(function(){i.options.whitespaceClickHandler(null,!0)})):"KeyH"!==e&&"h"!==e||!r||(t.stopPropagation(),t.preventDefault(),this.runIfFrameReady(function(){var e;a?document.activeElement.dispatchEvent(new KeyboardEvent(t.type,t)):null!=(e=i.focusedElement)&&e.dispatchEvent(new KeyboardEvent(t.type,t))})))}}},C.prototype.runIfFrameReady=function(e){var t=this;this.navigationFrameHandle||(this.navigationFrameHandle=this.workScheduler.scheduleAnimationFrameTask(function(){t.navigationFrameHandle=void 0,e()}))},C.prototype.notifyVisual=function(e){e.bodyCell&&this.options.bodyCellFocusHandler?this.options.bodyCellFocusHandler(e.item,e.bodyCell.rowIndex):e.columnHeader&&this.options.columnHeaderFocusHandler?this.options.columnHeaderFocusHandler(e.item):e.rowHeader&&this.options.rowHeaderFocusHandler?this.options.rowHeaderFocusHandler(e.item):e.cornerCell&&this.options.cornerCellFocusHandler?this.options.cornerCellFocusHandler(e.item):e.floatingBodyCell&&this.options.bodyCellFocusHandler?this.options.bodyCellFocusHandler(e.item):void 0!==e.floatingRowHeader&&this.options.rowHeaderFocusHandler&&this.options.rowHeaderFocusHandler(e.item)},C.prototype.setAsFocusTableEx=function(e,t,i){this.focusManager.setAsFocusTableEx(e,t,i)},C.prototype.onFocusChanged=function(){var e,t,i,o,r,n=this,a=this.focusManager.CurrentFocus,l=(this.notifyVisual(a),this.clearFocusStyle(),this.getBodyCellViewPort());a.bodyCell?(0<=a.bodyCell.columnIndex&&(t=a.bodyCell.columnIndex),o=a.bodyCell.rowIndex):a.rowHeader?o=v.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(a.item,this.rowNavigator):a.columnHeader?t=v.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(a.item,this.columnNavigator):a.floatingBodyCell&&(t=a.floatingBodyCell.columnIndex),void 0!==o&&this.rowScrollbar.visible&&(r=v.RowMeasurementUtil.getVisibleRange(l.top,l.height,this.rowHeightMeasureManager))&&(o<=r.firstLeafIndex?e={rowIndex:o,visibleHeight:Number.MAX_VALUE,alignBottom:!1}:o>=r.lastLeafIndex&&(e={rowIndex:o,visibleHeight:Number.MAX_VALUE,alignBottom:!0})),void 0!==t&&this.columnScrollbar.visible&&(r=v.ColumnMeasurementUtil.getVisibleRange(l.left,l.width,this.columnWidthMeasureManager))&&(t<=r.firstLeafIndex?i={columnIndex:t,visibleWidth:Number.MAX_VALUE,alignRight:!1}:t>=r.lastLeafIndex&&(i={columnIndex:t,visibleWidth:Number.MAX_VALUE,alignRight:!0})),this.isA11yTable||this.isA11yMatrix?(l=o=void 0,e&&(o=v.RowMeasurementUtil.getOffset(e,this.rowHeightMeasureManager),e.alignBottom)&&(o-=this.rowScrollbar.viewSize),i&&(l=v.ColumnMeasurementUtil.getOffset(i,this.columnWidthMeasureManager),i.alignRight)&&(l-=this.columnScrollbar.viewSize),(e||i)&&this.scrollTo(o,l),this.getFocusedCell(a).focus()):(r=function(){n.rebuildBodyPagesSync(),n.focusedElement=n.getFocusedCell(a),n.focusedElement,n.setFocusStyle()},e||i?this.makeVisible(b.Incremental,e,i,r):r())},C.prototype.setFocusStyle=function(){this.hasFocus&&this.focusedElement&&this.focusedElement.classList.add("hasFocus")},C.prototype.clearFocusStyle=function(){this.focusedElement&&this.focusedElement.classList.remove("hasFocus")},C.prototype.getFocusedCell=function(e){var t;return e.bodyCell?this.bodyCellRenderer.getCellAt(e.bodyCell):e.columnHeader?this.columnHeaderRenderer.getCellAt(e.columnHeader):e.rowHeader?(v.HeaderRendererUtil.getHeaderIndices(e.item,t=[],this.rowNavigator),this.rowHeaderRenderer.getCellAt(t)):e.cornerCell?this.cornerRenderer.getCellAt(e.cornerCell):e.floatingBodyCell?this.floatingBodyCellRenderer.getCellAt(e.floatingBodyCell):void 0!==e.floatingRowHeader?this.floatingRowHeaderRenderer.getCellAt([e.floatingRowHeader]):void 0},C.prototype.getCurrentFocusBoundingRect=function(){var e=this.isA11yTable?document.activeElement:this.focusedElement;return e?{top:(e=e.getBoundingClientRect()).top,left:e.left,width:e.width,height:e.height}:{top:0,left:0,width:0,height:0}},C.prototype.selectFocus=function(e){var t=this.focusManager.CurrentFocus,i=t.item,e=this.createMouseEvent(e);t.bodyCell?this.options.bodyCellClickHandler&&this.options.bodyCellClickHandler(i,e,t.bodyCell.rowIndex,o.Body):t.floatingBodyCell?this.options.bodyCellClickHandler&&this.options.bodyCellClickHandler(i,e,void 0,o.Footer):t.rowHeader||void 0!==t.floatingRowHeader?this.options.rowHeaderClickHandler&&this.options.rowHeaderClickHandler(i,e):t.columnHeader?this.options.columnHeaderClickHandler&&this.options.columnHeaderClickHandler(i,e):t.cornerCell&&this.options.cornerCellClickHandler&&this.options.cornerCellClickHandler(i,e)},C.prototype.activateCellContent=function(){var e=this.focusManager.CurrentFocus,t=this.isA11yTable?document.activeElement:this.focusedElement;t&&e&&this.options.cellContentActivationHandler&&(e=this.createSimpleMouseClickEvent(),this.options.cellContentActivationHandler(t,e))},C.prototype.createSimpleMouseClickEvent=function(){var e=this.getCurrentFocusBoundingRect();return new MouseEvent("click",{clientX:e.left,clientY:e.top,ctrlKey:!1,metaKey:!1,shiftKey:!1,altKey:!1})},C.prototype.createMouseEvent=function(e){var t=this.getCurrentFocusBoundingRect();return new MouseEvent("click",{clientX:t.left,clientY:t.top,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey})},C.prototype.showContextMenuForFocus=function(e){var t,i,o=this.focusManager.CurrentFocus;-1!==(null==(t=o.bodyCell)?void 0:t.columnIndex)&&(o&&o.item,t=o.item,i=this.getCurrentFocusBoundingRect(),i=new MouseEvent("contextmenu",{clientX:i.left,clientY:i.top,ctrlKey:e.ctrlKey,metaKey:e.metaKey}),o.bodyCell||o.floatingBodyCell?this.options.bodyCellContextMenuHandler&&this.options.bodyCellContextMenuHandler(t,i):o.rowHeader||void 0!==o.floatingRowHeader?this.options.rowHeaderContextMenuHandler&&this.options.rowHeaderContextMenuHandler(t,i):o.columnHeader?this.options.columnHeaderContextMenuHandler&&this.options.columnHeaderContextMenuHandler(t,i):o.cornerCell&&this.options.cornerCellContextMenuHandler&&this.options.cornerCellContextMenuHandler(t,i))},C.prototype.initializeContainersForScrolling=function(e){var t=this;e?(this.bodyCellContainer.addEventListener("scroll",function(){return t.onBodyCellContainerScroll()}),this.columnHeaderContainer.addEventListener("scroll",function(){return t.onColumnHeaderContainerScroll()}),this.rowHeaderContainer.addEventListener("scroll",function(){return t.onRowHeaderContainerScroll()}),this.floatingBodyCellContainer.addEventListener("scroll",function(){return t.onFloatingBodyCellContainerScroll()}),this.columnHeaderContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),this.cornerContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),this.floatingRowHeaderContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),this.floatingBodyCellContainer.addEventListener("wheel",function(e){return t.onWheel(e)}),s.isFirefox()&&(this.columnHeaderContainer.style.overflow=this.rowHeaderContainer.style.overflow=this.bodyCellContainer.style.overflow=this.floatingBodyCellContainer.style.overflow="-moz-scrollbars-none",this.columnHeaderContainer.style["scrollbar-width"]=this.rowHeaderContainer.style["scrollbar-width"]=this.bodyCellContainer.style["scrollbar-width"]=this.floatingBodyCellContainer.style["scrollbar-width"]="none")):this.columnHeaderContainer.style.overflow=this.bodyCellContainer.style.overflow=this.rowHeaderContainer.style.overflow=this.floatingBodyCellContainer.style.overflow="hidden"},C.prototype.onBodyCellContainerScroll=function(){this.scriptUpdatedBodyVerticalToggle?this.scriptUpdatedBodyVerticalToggle=!1:(this.scriptUpdatedRowToggle=!0,this.rowScrollbar.viewMin=this.rowHeaderContainer.scrollTop=this.bodyCellContainer.scrollTop),this.scriptUpdatedBodyHorizontalToggle?this.scriptUpdatedBodyHorizontalToggle=!1:(this.scriptUpdatedColumnToggle=!0,this.scriptUpdatedFloatingBodyToggle=!0,this.columnScrollbar.viewMin=this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.bodyCellContainer.scrollLeft),(this.scriptUpdatedRowToggle||this.scriptUpdatedColumnToggle)&&this.refreshScrollbarsAndRender()},C.prototype.onColumnHeaderContainerScroll=function(){this.scriptUpdatedColumnToggle?this.scriptUpdatedColumnToggle=!1:(this.scriptUpdatedBodyHorizontalToggle=!0,this.scriptUpdatedFloatingBodyToggle=!0,this.columnScrollbar.viewMin=this.bodyCellContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.columnHeaderContainer.scrollLeft,this.refreshScrollbarsAndRender())},C.prototype.onRowHeaderContainerScroll=function(){this.scriptUpdatedRowToggle?this.scriptUpdatedRowToggle=!1:(this.scriptUpdatedBodyVerticalToggle=!0,this.rowScrollbar.viewMin=this.bodyCellContainer.scrollTop=this.rowHeaderContainer.scrollTop,this.refreshScrollbarsAndRender())},C.prototype.onFloatingBodyCellContainerScroll=function(){this.scriptUpdatedFloatingBodyToggle?this.scriptUpdatedFloatingBodyToggle=!1:(this.scriptUpdatedBodyHorizontalToggle=!0,this.scriptUpdatedColumnToggle=!0,this.columnScrollbar.viewMin=this.bodyCellContainer.scrollLeft=this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft,this.refreshScrollbarsAndRender())},C.prototype.scrollTo=function(e,t){null!=e&&(this.rowHeaderContainer.scrollTop=this.bodyCellContainer.scrollTop=e),null!=t&&(this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.bodyCellContainer.scrollLeft=t),this.rowScrollbar.viewMin=Math.max(this.rowHeaderContainer.scrollTop,this.bodyCellContainer.scrollTop),this.columnScrollbar.viewMin=Math.max(this.columnHeaderContainer.scrollLeft,this.floatingBodyCellContainer.scrollLeft,this.bodyCellContainer.scrollLeft),this.render(b.Incremental)},C.prototype.onWheel=function(e){this.rowScrollbar.visible&&e.deltaY&&this.rowScrollbar.onMouseWheel(-e.deltaY)},C.prototype.onClick=function(e){var t,i=this.rowLevelWidthMeasureManager.getHeadersWidth()+this.columnWidthMeasureManager.getColumnsWidth(),o=this.columnLevelHeightMeasureManager.getHeadersHeight()+this.rowHeightMeasureManager.getRowsHeight()+this.rowHeightMeasureManager.getFloatingRowHeights();i>=this.width&&o>=this.height||((t=c.HTMLElementUtils.getRelativeMouseCoordinates(this.element,e)).x>i||t.y>o)&&this.options.whitespaceClickHandler(e)},C.prototype.initializeScrollbars=function(){var t=this;this.columnScrollbar=new c.HorizontalScrollbar(this.element,0),this.columnScrollbar.smallIncrement=20,this.columnScrollbar.min=0,this.columnScrollbar.height=C.pixelUnits(v.ScrollbarWidth),this.columnScrollbar.element.style.position="absolute",this.columnScrollbar.element.style.left="0",this.columnScrollbar.element.style.bottom="0",this.columnScrollbar.element.style.right=C.pixelUnits(v.ScrollbarWidth),this.columnScrollbar._onscroll.push(function(e){return t.onHorizontalScroll()}),this.rowScrollbar=new c.VerticalScrollbar(this.element,0),this.rowScrollbar.smallIncrement=20,this.rowScrollbar.min=0,this.rowScrollbar.width=C.pixelUnits(v.ScrollbarWidth),this.rowScrollbar.element.style.position="absolute",this.rowScrollbar.element.style.right="0",this.rowScrollbar.element.style.top="0",this.rowScrollbar.element.style.bottom=C.pixelUnits(v.ScrollbarWidth),this.rowScrollbar._onscroll.push(function(e){return t.onVerticalScroll()}),this.rowScrollbar.element.setAttribute("aria-hidden","true"),this.columnScrollbar.element.setAttribute("aria-hidden","true"),this.scriptUpdatedBodyHorizontalToggle=!1,this.scriptUpdatedBodyVerticalToggle=!1,this.scriptUpdatedColumnToggle=!1,this.scriptUpdatedRowToggle=!1},C.prototype.refreshScrollbarsAndRender=function(){var e=this;(this.isA11yTable||this.isA11yMatrix)&&this.skipNextScroll?this.skipNextScroll=!1:(this.rowScrollbar.refresh(),this.columnScrollbar.refresh(),this.options.onScroll&&this.options.onScroll(),this.isA11yTable||this.isA11yMatrix?this.render(b.Incremental):this.workScheduler.scheduleTimeoutTask(function(){return e.render(b.Incremental)},0))},C.prototype.setSteppedLayout=function(e){e!==this.steppedLayout&&(this.steppedLayout=e,this.columnWidthMeasureManager=new v.ColumnWidthMeasureManager(this.measureElement,this.sizeManager),this.steppedLayout?(this.rowLevelWidthMeasureManager=new v.SteppedRowLevelWidthMeasureManager(this.measureElement,this.sizeManager),this.rowHeightMeasureManager=new v.SteppedRowHeightMeasureManager(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager)):(this.rowLevelWidthMeasureManager=new v.BlockedRowLevelWidthMeasureManager(this.measureElement,this.sizeManager),this.rowHeightMeasureManager=new v.BlockedRowHeightMeasureManager(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager)),this.columnLevelHeightMeasureManager=new v.ColumnLevelHeightMeasureManager(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager),this.steppedLayout?(this.rowHeaderRenderer=new v.SteppedRowHeaderRenderer(this.innerRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler,this.isA11yTable,this.isA11yMatrix),this.floatingRowHeaderRenderer=new v.SteppedRowHeaderRenderer(this.floatingRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler,this.isA11yTable,this.isA11yMatrix)):(this.rowHeaderRenderer=new v.BlockedRowHeaderRenderer(this.innerRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler,this.isA11yTable,this.isA11yMatrix),this.floatingRowHeaderRenderer=new v.BlockedRowHeaderRenderer(this.floatingRowHeaderContainer,this.rowHeightMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightResizeHandler,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.rowHeaderInteractionHandler,this.isA11yTable,this.isA11yMatrix)),this.columnHeaderRenderer=new v.ColumnHeaderRenderer(this.innerColumnHeaderContainer,this.columnWidthMeasureManager,this.columnLevelHeightMeasureManager,this.columnWidthResizeHandler,this.options.columnHeaderClickHandler,this.options.columnHeaderContextMenuHandler,this.options.columnHeaderInteractionHandler,this.isA11yTable,this.isA11yMatrix,this.onObject),this.isA11yTable?this.bodyCellRenderer=new v.TablixRenderer(this.innerBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,o.Body,t.Table,this.onObject):this.isA11yMatrix?(this.innerBodyCellContainer=this.resetElement(this.innerBodyCellContainer,i),this.bodyCellRenderer=new v.TablixRenderer(this.innerBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,o.Body,t.Matrix,this.onObject)):this.bodyCellRenderer=new v.BodyCellRenderer(this.innerBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,this.workScheduler),this.cornerRenderer=new v.CornerRenderer(this.cornerContainer,this.columnLevelHeightMeasureManager,this.rowLevelWidthMeasureManager,this.columnLevelHeightResizeHandler,this.rowLevelWidthResizeHandler,this.options.cornerCellClickHandler,this.options.cornerCellContextMenuHandler,this.options.cornerCellInteractionHandler,this.isA11yMatrix),this.isA11yTable?this.floatingBodyCellRenderer=new v.TablixRenderer(this.innerFloatingBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,o.Footer,t.Table,this.onObject):this.isA11yMatrix?(this.innerFloatingBodyCellContainer=this.resetElement(this.innerFloatingBodyCellContainer,"<div></div>"),this.floatingBodyCellRenderer=new v.TablixRenderer(this.innerFloatingBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,o.Footer,t.Matrix,this.onObject)):this.floatingBodyCellRenderer=new v.BodyCellRenderer(this.innerFloatingBodyCellContainer,this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,this.workScheduler),this.isA11yTable&&(this.columnHeaderBorderRenderer=new v.BorderRenderer(this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.columnLevelHeightMeasureManager,this.columnHeaderSVGTopContainer,this.columnHeaderSVGBottomContainer,o.Header),this.bodyCellBorderRenderer=new v.BorderRenderer(this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.columnLevelHeightMeasureManager,this.bodySVGTopContainer,this.bodySVGBottomContainer,o.Body),this.floatingBodyCellBorderRenderer=new v.BorderRenderer(this.columnWidthMeasureManager,this.rowHeightMeasureManager,this.columnLevelHeightMeasureManager,this.floatingBodySVGTopContainer,this.floatingBodySVGBottomContainer,o.Footer)),this.focusManager.updateMeasureManagers(this.rowHeightMeasureManager,this.columnWidthMeasureManager),this.clear(b.ClearMeasurement))},C.prototype.resetElement=function(e,t){e.insertAdjacentHTML("afterend",t);t=e.nextElementSibling;return e.remove(),t},C.prototype.clearBodyPages=function(){this.bodyCellRenderer.clear(),this.floatingBodyCellRenderer.clear()},C.prototype.rebuildBodyPagesSync=function(){this.isA11yTable,this.isA11yMatrix,this.clearBodyPages();var e,t=this.getViewport();this.bodyCellRenderer.update(t,!1,this.binder,this.rowNavigator,this.columnNavigator,!1),this.rowNavigator.getFloatingHierarchyItems()&&(e=this.rowHeightMeasureManager.getFloatingRowHeights(),this.floatingBodyCellRenderer.update({left:t.left,top:0,width:t.width,height:e},!0,this.binder,this.rowNavigator,this.columnNavigator,!1))},C.prototype.setWidth=function(e){this.width=e,this.element.style.width=C.pixelUnits(this.width),this.columnScrollbar.invalidateArrange()},C.prototype.setHeight=function(e){this.height=e,this.element.style.height=C.pixelUnits(this.height),this.rowScrollbar.invalidateArrange()},C.prototype.getCornerContainer=function(){return this.cornerContainer},C.prototype.getColumnHeaderContainer=function(){return this.columnHeaderContainer},C.prototype.getRowHeaderContainer=function(){return this.rowHeaderContainer},C.prototype.getBodyCellContainer=function(){return this.bodyCellContainer},C.prototype.getFloatingRowHeaderContainer=function(){return this.floatingRowHeaderContainer},C.prototype.getFloatingBodyCellContainer=function(){return this.floatingBodyCellContainer},C.prototype.setClassName=function(e){this.element.className=e},C.prototype.setColumnNavigator=function(e){this.columnNavigator=e,this.focusManager.columnNavigator=e},C.prototype.setRowNavigator=function(e){this.rowNavigator=e,this.focusManager.rowNavigator=e},C.prototype.setBinder=function(e){this.binder=e},C.prototype.getSteppedLayout=function(){return this.steppedLayout},C.prototype.getColumnNavigator=function(){return this.columnNavigator},C.prototype.getRowNavigator=function(){return this.rowNavigator},C.prototype.getSizeManager=function(){return this.sizeManager},C.prototype.getBinder=function(){return this.binder},C.prototype.getColumnWidthMeasureManager=function(){return this.columnWidthMeasureManager},C.prototype.getRowHeightMeasureManager=function(){return this.rowHeightMeasureManager},C.prototype.getColumnLevelHeightMeasureManager=function(){return this.columnLevelHeightMeasureManager},C.prototype.getRowLevelWidthMeasureManager=function(){return this.rowLevelWidthMeasureManager},C.prototype.getRowHeaderRenderer=function(){return this.rowHeaderRenderer},C.prototype.getColumnHeaderRenderer=function(){return this.columnHeaderRenderer},C.prototype.getBodyCellRenderer=function(){return this.bodyCellRenderer},C.prototype.getCornerRenderer=function(){return this.cornerRenderer},C.prototype.getFloatingRowHeaderRenderer=function(){return this.floatingRowHeaderRenderer},C.prototype.getFloatingBodyCellRenderer=function(){return this.floatingBodyCellRenderer},C.prototype.getColumnHeaderBorderRenderer=function(){return this.columnHeaderBorderRenderer},C.prototype.getBodyCellBorderRenderer=function(){return this.bodyCellBorderRenderer},C.prototype.getFloatingBodyCellBorderRenderer=function(){return this.floatingBodyCellBorderRenderer},C.prototype.getViewport=function(){return{left:this.columnScrollbar.viewMin,top:this.rowScrollbar.viewMin,width:this.width,height:this.height}},C.prototype.getBodyCellViewPort=function(){return{left:this.columnScrollbar.viewMin,top:this.rowScrollbar.viewMin,width:this.columnScrollbar.viewSize,height:this.rowScrollbar.viewSize}},C.prototype.getClientWidth=function(){return this.width-(this.rowScrollbar.visible?v.ScrollbarWidth:0)},C.prototype.getWorkScheduler=function(){return this.workScheduler},C.prototype.restoreFocusOnNextBlur=function(){this.element.contains(document.activeElement)&&(this.shouldRestoreFocus=!0)},C.prototype.restoreFocus=function(){var e;this.isA11yTable&&this.shouldRestoreFocus?(this.shouldRestoreFocus=!1,(e=this.focusManager.CurrentFocus?this.getFocusedCell(this.focusManager.CurrentFocus):void 0)||(this.focusManager.updateFocus(),e=this.getFocusedCell(this.focusManager.CurrentFocus)),e.focus()):this.hasFocus&&this.focusManager.initialize()},C.prototype.render=function(e,t){var i=this;try{this.clear(e);var o,r=this.getViewport(),n=v.RowMeasurementUtil.getVisibleRange(r.top,r.height,this.rowHeightMeasureManager),a=n?n.firstLeafIndex:0,l=v.ColumnMeasurementUtil.getVisibleRange(r.left,r.width,this.columnWidthMeasureManager),s=l?l.firstLeafIndex:0,u=(this.rowLevelWidthMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,a,v.MeasureRowSampleCount),this.ensureLastPageComplete(a,s),this.columnWidthMeasureManager.canAddPageColumn(this.columnNavigator)&&!this.isFilledHorizontally(r.left,r.width)),h=this.rowHeightMeasureManager.canAddPageRow(this.rowNavigator)&&!this.isFilledVertically(r.top,r.height),d=(u&&this.measureNextPageColumn(a),h&&this.measureNextPageRow(a,s),this.rowHeightMeasureManager.measureFloatingRows(this.binder,this.rowNavigator,this.columnNavigator,a,s),this.columnLevelHeightMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,a,s,v.MeasureColumnSampleCount),this.isA11yTable||this.isA11yMatrix||(this.updateRegionsPosition(),this.updateScrollRegionWidth(),this.updateScrollRegionHeight(),this.updateScrollbars()),this.measureNextPageColumnAsync(a),this.measureNextPageRowAsync(a,s),this.columnHeaderRenderer.update(r.left,r.width,this.binder,this.columnNavigator),this.isA11yMatrix&&this.semanticColumnHeaderRenderer.update(r,!1,this.binder,this.rowNavigator,this.columnNavigator),this.rowHeaderRenderer.update(this.rowNavigator.getHierarchyItems(),!1,r.top,r.height,this.binder,this.rowNavigator),this.bodyCellRenderer.update(r,!1,this.binder,this.rowNavigator,this.columnNavigator,!0),this.cornerRenderer.update(this.binder,this.rowNavigator,this.columnNavigator),this.rowNavigator.getFloatingHierarchyItems());d&&(o=this.rowHeightMeasureManager.getFloatingRowHeights(),this.floatingRowHeaderRenderer.update(d,!0,0,o,this.binder,this.rowNavigator),this.floatingBodyCellRenderer.update({left:r.left,top:0,width:r.width,height:o},!0,this.binder,this.rowNavigator,this.columnNavigator,!0),this.isA11yTable)&&this.floatingBodyCellBorderRenderer.update(r,this.binder,this.rowNavigator,this.columnNavigator),this.isA11yTable&&(this.columnHeaderBorderRenderer.update(r,this.binder,this.rowNavigator,this.columnNavigator),this.bodyCellBorderRenderer.update(r,this.binder,this.rowNavigator,this.columnNavigator)),(this.isA11yTable||this.isA11yMatrix)&&(this.updateRegionsPosition(),this.updateScrollRegionWidth(),this.updateScrollRegionHeight(),this.updateScrollbars()),h||u?this.isA11yTable||this.isA11yMatrix?this.render(b.Incremental,t):this.workScheduler.scheduleTimeoutTask(function(){return i.render(b.Incremental,t)},0):(e!==b.Incremental&&this.restoreFocus(),t&&t())}catch(e){t&&t(e)}},C.prototype.ensureLastPageComplete=function(e,t){e=this.rowHeightMeasureManager.ensureLastPageComplete(this.binder,this.rowNavigator,this.columnNavigator,e,t,v.MeasureColumnSampleCount);-1!==e&&(this.bodyCellRenderer.removeRowPages(e),this.updateScrollRegionHeight())},C.prototype.makeVisible=function(e,t,i,o,r){var n=this;try{r?e===b.ClearMeasurement&&this.clear(b.ClearMeasurementOnly):this.clear(e);var a,l,s,u,h=this.getViewport(),d=void 0,c=void 0,p=(i?(d=i.columnIndex,c=v.ColumnMeasurementUtil.getOffset(i,this.columnWidthMeasureManager),i.alignRight&&(c-=this.columnScrollbar.viewSize)):(d=(a=v.ColumnMeasurementUtil.getVisibleRange(h.left,h.width,this.columnWidthMeasureManager))?a.firstLeafIndex:0,c=this.columnScrollbar.viewMin),d=Math.max(0,d-v.MeasureColumnSampleCount/2),void 0),g=void 0,m=(t?(p=t.rowIndex,g=v.RowMeasurementUtil.getOffset(t,this.rowHeightMeasureManager),t.alignBottom&&(g-=this.rowScrollbar.viewSize)):(p=(l=v.RowMeasurementUtil.getVisibleRange(h.top,h.height,this.rowHeightMeasureManager))?l.firstLeafIndex:0,g=this.rowScrollbar.viewMin),this.rowLevelWidthMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,p,v.MeasureRowSampleCount),this.ensureLastPageComplete(p,d),this.columnWidthMeasureManager.canAddPageColumn(this.columnNavigator)&&(!v.ColumnMeasurementUtil.isColumnMeasured(d,this.columnWidthMeasureManager)||this.width>this.columnWidthMeasureManager.getColumnsWidth()-c)),f=this.rowHeightMeasureManager.canAddPageRow(this.rowNavigator)&&(!v.RowMeasurementUtil.isRowMeasured(p,this.rowHeightMeasureManager)||this.height>this.rowHeightMeasureManager.getRowsHeight()-g);m&&this.measureNextPageColumn(p),f&&this.measureNextPageRow(p,d),f||m?this.workScheduler.scheduleTimeoutTask(function(){return n.makeVisible(b.Incremental,t,i,o,r)},0):(r&&(this.restoreFocusOnNextBlur(),this.clear(b.ClearRendering)),this.rowHeightMeasureManager.measureFloatingRows(this.binder,this.rowNavigator,this.columnNavigator,p,d),this.columnLevelHeightMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,p,d,v.MeasureColumnSampleCount),this.updateRegionsPosition(),this.updateScrollRegionWidth(),this.updateScrollRegionHeight(),this.updateScrollbars(),this.scrollTo(g,c),r&&this.restoreFocus(),s=y.Double.equalWithPrecision(this.rowScrollbar.viewMin,g,C.ScrollOffsetPrecision),u=y.Double.equalWithPrecision(this.columnScrollbar.viewMin,c,C.ScrollOffsetPrecision),s&&u?o&&o():(s||(t=t&&this.getVisibleRowStart()),u||(i=i&&this.getVisibleColumnStart()),this.makeVisible(b.ClearMeasurement,t,i,o,this.isA11yTable||this.isA11yMatrix)))}catch(e){o&&o(e)}},C.prototype.getVisibleRowStart=function(){var e=this.getViewport(),t=v.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager);return t?v.RowMeasurementUtil.getVisibleRowStart(t,e.top,this.rowHeightMeasureManager):null},C.prototype.getVisibleColumnStart=function(){var e=this.getViewport(),t=v.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,this.columnWidthMeasureManager);return t?v.ColumnMeasurementUtil.getVisibleColumnStart(t,e.left,this.columnWidthMeasureManager):null},C.prototype.clearRendering=function(){this.workScheduler.clear(),this.bodyCellRenderer.clear(),this.rowHeaderRenderer.clear(),this.columnHeaderRenderer.clear(),this.cornerRenderer.clear(),this.floatingRowHeaderRenderer.clear(),this.floatingBodyCellRenderer.clear(),this.isA11yTable&&(this.columnHeaderBorderRenderer.clear(),this.bodyCellBorderRenderer.clear(),this.floatingBodyCellBorderRenderer.clear()),this.isA11yMatrix&&this.semanticColumnHeaderRenderer.clear(),this.navigationFrameHandle=void 0},C.prototype.clearMeasurement=function(){this.workScheduler.clear(),this.columnWidthMeasureManager.clear(),this.rowHeightMeasureManager.clear(),this.columnLevelHeightMeasureManager.clear(),this.rowLevelWidthMeasureManager.clear(),this.navigationFrameHandle=void 0},C.prototype.clear=function(e){switch(e=void 0===e?b.ClearMeasurement:e){case b.ClearRendering:this.clearRendering();break;case b.ClearMeasurement:this.clearRendering(),this.clearMeasurement();break;case b.ClearMeasurementOnly:this.clearMeasurement()}},C.prototype.onHorizontalScroll=function(){(this.isA11yTable||this.isA11yMatrix)&&(this.render(b.Incremental),this.skipNextScroll=!0),this.columnHeaderContainer.scrollLeft=this.floatingBodyCellContainer.scrollLeft=this.bodyCellContainer.scrollLeft=this.columnScrollbar.viewMin},C.prototype.onVerticalScroll=function(){(this.isA11yTable||this.isA11yMatrix)&&(this.render(b.Incremental),this.skipNextScroll=!0),this.rowHeaderContainer.scrollTop=this.bodyCellContainer.scrollTop=this.rowScrollbar.viewMin},C.prototype.updateRegionsPosition=function(){var e=C.pixelUnits(this.columnLevelHeightMeasureManager.getHeadersHeight()),e=(this.bodyCellContainer.style.top=this.rowHeaderContainer.style.top=this.cornerContainer.style.height=this.innerColumnHeaderContainer.style.height=e,this.isA11yTable&&(this.columnHeaderSVGTopContainer.style.height=this.columnHeaderSVGBottomContainer.style.height=e),this.bodyCellContainer.style.left=this.columnHeaderContainer.style.left=this.cornerContainer.style.width=this.floatingBodyCellContainer.style.left=this.floatingRowHeaderContainer.style.width=C.pixelUnits(this.rowLevelWidthMeasureManager.getHeadersWidth()),this.isA11yTable?this.innerRowHeaderContainer.style.width=C.pixelUnits(v.SelectionIndicatorWidth):this.innerRowHeaderContainer.style.width=C.pixelUnits(this.rowLevelWidthMeasureManager.getHeadersWidth()),C.pixelUnits(this.rowHeightMeasureManager.getFloatingRowHeights()));this.floatingRowHeaderContainer.style.height=this.floatingBodyCellContainer.style.height=this.innerFloatingBodyCellContainer.style.height=e,this.isA11yTable&&(this.floatingBodySVGTopContainer.style.height=this.floatingBodySVGBottomContainer.style.height=e)},C.prototype.updateScrollbars=function(){var e,t=this.rowHeightMeasureManager.getFloatingRowHeights(),i=this.height-this.columnLevelHeightMeasureManager.getHeadersHeight()-t,o=this.width-this.rowLevelWidthMeasureManager.getHeadersWidth(),r=this.rowHeightMeasureManager.getRowsHeight(),n=this.columnWidthMeasureManager.getColumnsWidth(),a=this.options.scrollingEnabled&&0<r&&i<r,l=this.options.scrollingEnabled&&0<n&&o<n,n=(!a&&l&&0<r&&(a=r>i-v.ScrollbarWidth),!l&&a&&0<n&&(l=n>o-v.ScrollbarWidth),this.bodyCellContainer.style.right=this.columnHeaderContainer.style.right=this.floatingBodyCellContainer.style.right=a?this.rowScrollbar.width:C.pixelUnits(0),l?v.ScrollbarWidth:0),o=i-n<r?(e=n+t,n):(e=i+t-r,i-r);this.bodyCellContainer.style.bottom=this.rowHeaderContainer.style.bottom=C.pixelUnits(e),this.floatingRowHeaderContainer.style.bottom=this.floatingBodyCellContainer.style.bottom=C.pixelUnits(o),this.rowScrollbar.show(a),this.rowScrollbar.viewSize=this.bodyCellContainer.clientHeight,this.rowScrollbar.refresh(),this.columnScrollbar.show(l),this.columnScrollbar.viewSize=this.bodyCellContainer.clientWidth,this.columnScrollbar.refresh()},C.prototype.measureNextPageColumnAsync=function(e){var t=this;this.workScheduler.scheduleTimeoutTask(function(){t.columnWidthMeasureManager.canAddPageColumn(t.columnNavigator)&&t.columnWidthMeasureManager.getPageColumns().length<v.MaxAutoPageColumnMeasure&&(t.measureNextPageColumn(e),t.updateScrollRegionWidth(),t.measureNextPageColumnAsync(e))},C.AutoMeasureDelay)},C.prototype.measureNextPageRowAsync=function(e,t){var i=this;this.workScheduler.scheduleTimeoutTask(function(){i.rowHeightMeasureManager.canAddPageRow(i.rowNavigator)&&i.rowHeightMeasureManager.getPageRows().length<v.MaxAutoPageRowMeasure&&(i.measureNextPageRow(e,t),i.updateScrollRegionHeight(),i.measureNextPageRowAsync(e,t))},C.AutoMeasureDelay)},C.prototype.updateScrollRegionWidth=function(){var e=this.columnWidthMeasureManager.getColumnsWidth(),t=this.bodyCellContainer.clientWidth,i=C.pixelUnits(Math.max(e,this.isA11yTable||this.isA11yMatrix?1:t));this.innerColumnHeaderContainer.style.width=this.innerBodyCellContainer.style.width=this.innerFloatingBodyCellContainer.style.width=i,this.isA11yTable&&(this.columnHeaderSVGTopContainer.style.width=this.columnHeaderSVGBottomContainer.style.width=this.bodySVGTopContainer.style.width=this.bodySVGBottomContainer.style.width=this.floatingBodySVGTopContainer.style.width=this.floatingBodySVGBottomContainer.style.width=i),this.columnScrollbar.max=e,this.columnScrollbar.viewSize=t,this.columnScrollbar.refresh()},C.prototype.updateScrollRegionHeight=function(){var e=this.rowHeightMeasureManager.getRowsHeight(),t=this.bodyCellContainer.clientHeight,i=C.pixelUnits(Math.max(e,t));this.innerRowHeaderContainer.style.height=this.innerBodyCellContainer.style.height=i,this.isA11yTable&&(this.bodySVGTopContainer.style.height=this.bodySVGBottomContainer.style.height=i),this.rowScrollbar.max=e,this.rowScrollbar.viewSize=t,this.rowScrollbar.refresh()},C.prototype.isFilledHorizontally=function(e,t){return this.columnWidthMeasureManager.getColumnsWidth()-e>t+C.MeasureBuffer},C.prototype.isFilledVertically=function(e,t){return this.rowHeightMeasureManager.getRowsHeight()-e>t+C.MeasureBuffer},C.prototype.measureNextPageColumn=function(e){this.columnWidthMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,e)},C.prototype.measureNextPageRow=function(e,t){this.rowHeightMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,e,t)},C.pixelUnits=function(e){return 0===e?e.toString():e+"px"},C.prototype.getNumberOfVisibleRows=function(){var e=this.getBodyCellViewPort(),e=v.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager);if(e)return 0===e.firstLeafIndex?e.lastLeafIndex-e.firstLeafIndex:e.lastLeafIndex-e.firstLeafIndex-1},C.MeasureBuffer=50,C.AutoMeasureDelay=250,C.ScrollOffsetPrecision=1,S=C,v.PivotTableControl=S,r.prototype.build=function(e,t,i,o,r,n,a,l,s,u,h,d,c,p){for(var g=l?s.getFloatingHierarchyLeafCount():s.getHierarchyLeafCount(),m=Math.min(t+n.getRowHeights().length,g)-t,f=Math.min(i+a.getColumnWidths().length,u.getHierarchyLeafCount())-i,g=r.getPageColumnLeft(a),r=o.getPageRowTop(n),o={position:"absolute",left:S.pixelUnits(g),top:S.pixelUnits(r),width:S.pixelUnits(a.getWidth()),height:S.pixelUnits(n.getHeight())},y=[],b=0;b<m;b++)y[b]=[];for(var v={children:new Array(f),classNames:[],styleProperties:{},attributes:{}},C=0,w=0;w<f;w++){var x=a.getColumnWidths()[w];v.children[w]=this.buildColumn(m,t,w,i,n,a,l,s,u,h,y,C,x),C+=x}e.insertAdjacentHTML("beforeend",P.build(v,o)),this.element=e.lastChild,P.attachEventHandlers(this.element,v),(d||c)&&this.addEventListeners(m,f,y,d,c,p)},r.prototype.resizeColumn=function(e,t){if(this.element){for(var i,o=t.getColumnWidths(),r=o.length,n=0,a=0;a<r&&(i=0===a?this.element.firstChild:i.nextSibling);a++){var l=o[a];a===e?i.style.width=S.pixelUnits(l):e<a&&(i.style.left=S.pixelUnits(n)),n+=l}this.element.style.width=S.pixelUnits(t.getWidth())}},r.prototype.getHierarchyLeafAt=function(e,t,i){return e?i.getFloatingHierarchyLeafAt(t):i.getHierarchyLeafAt(t)},r.prototype.buildColumn=function(e,t,i,o,r,n,a,l,s,u,h,d,c){for(var p={children:new Array(e),classNames:[],attributes:{},styleProperties:{overflow:"hidden",position:"absolute",left:S.pixelUnits(d),width:S.pixelUnits(c)}},g=s.getHierarchyLeafAt(i+o),m=0;m<e;m++)p.children[m]=this.buildCell(m,this.getHierarchyLeafAt(a,m+t,l),i,g,r,n,l,u,h);return p},r.prototype.buildCell=function(e,t,i,o,r,n,a,l,s){a=a.getIntersection(t,o),s[e][i]=a,t=r.getRowHeights()[e],o=n.getColumnWidths()[i],s=l.getBodyCellBinding(a,!1,t,o);return s.styleProperties["box-sizing"]="border-box",s.styleProperties.height=S.pixelUnits(t),s},r.prototype.addEventListeners=function(e,t,i,o,r,n){for(var a=0;a<t;a++)for(var l=0===a?this.element.firstChild:l.nextSibling,s=void 0,u=0;u<e;u++)!function(e){s=0===e?l.firstChild:s.nextSibling;var t=i[e][a];o&&s.addEventListener("click",function(e){o(t,e)}),r&&s.addEventListener("contextmenu",function(e){r(t,e)}),n&&(n.isTooltipEnabled(t)?n.addTooltip(t,s):n.removeTooltip(t,s))}(u)},r.prototype.getElement=function(){return this.element},r.prototype.getCellAt=function(e,t){return this.element.children[t].children[e]},v.PivotTableBodyPage=r,n.prototype.getColumnWidths=function(){return this.columnWidths},n.prototype.getWidth=function(){return _.sum(this.columnWidths)},v.PivotTablePageColumn=n,a.prototype.getRowHeights=function(){return this.rowHeights},a.prototype.getHeight=function(){return _.sum(this.rowHeights)},a.prototype.clear=function(){this.rowHeights=[]},v.PivotTablePageRow=a,w.prototype.build=function(e,t,i,o,r,n,a,l,s,u,h){if(!this.element){(s||h)&&(t.attributes||(t.attributes={}),t.attributes.tabindex="0");h={content:P.build(t,w.headerRequiredStyles),classNames:null,styleProperties:{},attributes:{}};if(u&&(h.styleProperties["z-index"]="1"),s){h.attributes.role="presentation";for(var d=+t.attributes["aria-colindex"],u=e.children,c=void 0,p=0,g=_.toArray(u);p<g.length;p++){var m=g[p],f=+m.firstElementChild.getAttribute("aria-colindex");if(isNaN(f),d<f){c=m;break}}c?(c.insertAdjacentHTML("beforebegin",P.build(h,w.containerRequiredStyles)),this.element=c.previousElementSibling):(e.insertAdjacentHTML("beforeend",P.build(h,w.containerRequiredStyles)),this.element=e.lastChild)}else e.insertAdjacentHTML("beforeend",P.build(h,w.containerRequiredStyles)),this.element=e.lastChild;(o||r||n)&&this.createHeaderResizer(i,o,r,n),a&&this.element.addEventListener("contextmenu",function(e){a(i,e)}),l&&(l.isTooltipEnabled(i)?l.addTooltip(i,this.element,s):l.removeTooltip(i,this.element)),P.attachEventHandlers(this.element.firstChild,t)}},w.prototype.createHeaderResizer=function(e,t,i,o){return new v.HeaderResizer(e,this.element,t,i,o)},w.prototype.setWidth=function(e){this.element.style.width=S.pixelUnits(e)},w.prototype.setHeight=function(e){this.element.lastChild.style.height=S.pixelUnits(e)},w.prototype.setLeft=function(e){this.element.style.left=S.pixelUnits(e)},w.prototype.setTop=function(e){this.element.style.top=S.pixelUnits(e)},w.prototype.getElement=function(){return this.element},w.headerRequiredStyles={"box-sizing":"border-box"},w.containerRequiredStyles={position:"absolute",overflow:"hidden"},v.PivotTableHeader=w,u.build=function(e,t){if(void 0===t&&(t={}),null===e.tagName)return e.content;var i=e.tagName||"div",o="<"+i+" "+this.buildAttributes(e.attributes)+this.buildClassNames(e.classNames)+this.buildStyles(e.styleProperties,t)+">";if(_.isEmpty(e.children))null!=e.content&&(o+=e.content);else for(var r=0,n=e.children;r<n.length;r++){var a=n[r];o+=u.build(a,null)}return o+="</"+i+">"},u.buildMultiple=function(e){return _.map(e,function(e){return u.build(e)}).join("")},u.buildAttributes=function(e){var t="";if(e)for(var i in e)t+=i+"="+l+e[i]+l;return t},u.buildClassNames=function(e){if(!e||0===e.length)return"";for(var t='class="',i=0,o=e;i<o.length;i++)t+=o[i]+" ";return t+='"'},u.buildStyles=function(e,t){var i=!_.isEmpty(t),o=!_.isEmpty(e);if(!i&&!o)return"";var r="style="+l;if(o)for(var n in e)r+=n+":"+e[n]+";";if(i)for(var a in t)r+=a+":"+t[a]+";";return r+=l},u.attachEventHandlers=function(e,t){if(t.clickHandler&&e.addEventListener("click",function(e){return t.clickHandler(e)}),t.contextMenuHandler&&e.addEventListener("contextmenu",function(e){return t.contextMenuHandler(e)}),t.scrollHandler&&jsCommon.Zone.runOutsideAngular(function(){e.addEventListener("scroll",function(e){return t.scrollHandler(e)})}),!_.isEmpty(t.children)){t.children.length,e.childNodes.length;for(var i=0;i<t.children.length;i++)null!==t.children[i].tagName&&u.attachEventHandlers(e.childNodes[i],t.children[i])}},u.attachEventHandlersMultiple=function(e,t){var i=e;t.forEach(function(e){u.attachEventHandlers(i,e),i=i.nextElementSibling})},P=u,v.ElementBuilder=P}(powerbi=powerbi||{}),function(r){var e,c,g,s,p;function a(e,t,i,o,r,n,a,l,s,u,h){var d=this,l=(this.hostServices=a,this.visualStyle=l,this.isA11yTable=o,this.isA11yMatrix=r,this.renderIteration=0,this.onObject=n,this.sizeManager=t,a.getLocalizedString(c.internal.TablixUtils.ScrollUpLabel)),o=a.getLocalizedString(c.internal.TablixUtils.ScrollDownLabel),r=a.getLocalizedString(c.internal.TablixUtils.ScrollLeftLabel),n=a.getLocalizedString(c.internal.TablixUtils.ScrollRightLabel),t=h?"interactive-grid":"",a="<div role='document' ignore-focus-loss='true' style='position:relative'>\n                    <button class='scrollUp visually-hidden'>".concat(l,"</button>\n                    <button class='scrollDown visually-hidden'>").concat(o,"</button>\n                    <button class='scrollLeft visually-hidden'>").concat(r,"</button>\n                    <button class='scrollRight visually-hidden'>").concat(n,"</button>\n                    <div role='grid' class='").concat(t," innerContainer' style='position:absolute;left:0;top:0;right:0;bottom:0'>\n                        <div role='presentation' class='top-viewport' drag-resize-disabled='true' style='position:absolute;overflow:clip;left:0;right:0;top:0'></div>\n                        <div role='presentation' class='mid-viewport' style='position:absolute;overflow:clip;left:0;top:0;right:0;bottom:0;box-sizing:border-box'>\n                            <div role='presentation' style='position:relative'></div>\n                        </div>\n                        <div role='presentation' class='bot-viewport' style='position:absolute;overflow:clip;left:0;right:0'></div>\n                    </div>\n                    <div class='measureElement' style='position:absolute;left:0;top:0;visibility:hidden'></div>\n                </div>");e.insertAdjacentHTML("beforeend",a),this.element=e.lastChild,this.innerContainer=this.element.querySelector(".innerContainer"),this.measureElement=this.element.querySelector(".measureElement"),this.topViewport=this.element.querySelector(".top-viewport"),this.midViewport=this.element.querySelector(".mid-viewport"),this.innerBodyCellContainer=this.midViewport.firstElementChild,this.botViewport=this.element.querySelector(".bot-viewport"),d3.select(this.element).select(".scrollUp").on("click",function(){null!=(e=d.rowScrollbar)&&e.scrollPageUp();var e=d.getViewport(),e=g.RowMeasurementUtil.getVisibleRange(e.top,e.height,d.rowHeightMeasureManager,g.PageRowCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());s(e.firstLeafIndex,e.lastLeafIndex)}),d3.select(this.element).select(".scrollDown").on("click",function(){null!=(e=d.rowScrollbar)&&e.scrollPageDown();var e=d.getViewport(),e=g.RowMeasurementUtil.getVisibleRange(e.top,e.height,d.rowHeightMeasureManager,g.PageRowCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());s(e.firstLeafIndex,e.lastLeafIndex)}),d3.select(this.element).select(".scrollLeft").on("click",function(){null!=(e=d.columnScrollbar)&&e.scrollPageUp();var e=d.getViewport(),e=g.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,d.columnWidthMeasureManager,g.PageColumnCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());u(e.firstLeafIndex,e.lastLeafIndex)}),d3.select(this.element).select(".scrollRight").on("click",function(){null!=(e=d.columnScrollbar)&&e.scrollPageDown();var e=d.getViewport(),e=g.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,d.columnWidthMeasureManager,g.PageColumnCount,null==(e=d.rowHeightMeasureManager)?void 0:e.getLastMeasuredIndex());u(e.firstLeafIndex,e.lastLeafIndex)}),this.options=i,this.initializeScrollbars(),this.options.whitespaceClickHandler&&this.innerContainer.addEventListener("click",function(e){return d.onClick(e)}),this.options.columnResizingEnabled&&(this.columnWidthResizeHandler=new g.ColumnWidthResizeHandler(this,!0,!0)),this.options.rowLevelResizingEnabled&&(this.rowLevelWidthResizeHandler=new g.RowLevelWidthResizeHandler(this,!0)),$(this.element).on(p,function(){return d.onFocusManagerEnter()}),this.element.addEventListener("keydown",function(e){return d.onKeyDown(e)}),this.focusManager=new g.PivotTableFocusManager(function(){return d.onFocusChanged()},this.isA11yTable,this.isA11yMatrix,this.topViewport,this.midViewport,void 0,void 0,void 0,this.botViewport),this.createRenderers(),this.setSteppedLayout(!1),i.scrollingEnabled&&this.attachScrollEventHandlers()}e=r.visuals||(r.visuals={}),c=e.controls||(e.controls={}),g=c.pivotTable||(c.pivotTable={}),s=jsCommon.BrowserUtils,p=jsCommon.FocusManagerFocusEventName,a.prototype.updateOptions=function(e){this.options=e},a.prototype.attachScrollEventHandlers=function(){var n=this;jsCommon.Zone.runOutsideAngular(function(){n.element.addEventListener("wheel",function(e){var t=Math.max(Math.min(e.deltaX,a.ScrollDeltaMax),-a.ScrollDeltaMax),i=Math.max(Math.min(e.deltaY,a.ScrollDeltaMax),-a.ScrollDeltaMax),o=n.columnScrollbar.viewMin,r=n.rowScrollbar.viewMin,t=(n.scrollBy(t,i),n.columnScrollbar.viewMin),i=n.rowScrollbar.viewMin;o===t&&r===i||(e.stopPropagation(),e.preventDefault())}),n.element.addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault(),n.touchPreviousX=e.touches[0].clientX,n.touchPreviousY=e.touches[0].clientY}),n.element.addEventListener("touchmove",function(e){e.stopPropagation(),e.preventDefault();var t=n.touchPreviousX-e.touches[0].clientX,i=n.touchPreviousY-e.touches[0].clientY;n.touchPreviousX=e.touches[0].clientX,n.touchPreviousY=e.touches[0].clientY,n.scrollBy(t,i)})})},a.prototype.onFocusManagerEnter=function(){var e;null!=(e=this.hostServices.telemetry())&&e.trace(2,"TableKeyboardFocused"),this.updateFocus(),this.getFocusedCell(this.focusManager.CurrentFocus).focus({preventScroll:!0})},a.prototype.onKeyDown=function(i){var o=this,e=(this.updateFocus(),i.code||i.key),r=i.shiftKey,n=s.isCtrlOrMeta(i),t=i.altKey,a=this.isA11yTable,l=this.isA11yMatrix;if("Escape"!==e&&"Esc"!==e&&"Tab"!==e)if("ArrowRight"===e||"Right"===e)i.stopPropagation(),i.preventDefault(),this.runIfFrameReady(function(){r?o.focusManager.CurrentFocus.columnHeader&&o.columnWidthResizeHandler?(o.columnWidthResizeHandler.onStartResize(o.focusManager.CurrentFocus.item),o.columnWidthResizeHandler.onResize({x:1,y:0}),o.columnWidthResizeHandler.onEndResize()):o.options.rowHeaderExpandCollapseHandler&&o.focusManager.CurrentFocus.rowHeader&&1===o.rowNavigator.getExpansionState(o.focusManager.CurrentFocus.item)&&o.options.rowHeaderExpandCollapseHandler(o.focusManager.CurrentFocus.item,!1):o.focusManager.moveFocus("right",n,a,l)});else if("ArrowLeft"===e||"Left"===e)i.stopPropagation(),i.preventDefault(),this.runIfFrameReady(function(){r?o.focusManager.CurrentFocus.columnHeader&&o.columnWidthResizeHandler?(o.columnWidthResizeHandler.onStartResize(o.focusManager.CurrentFocus.item),o.columnWidthResizeHandler.onResize({x:-1,y:0}),o.columnWidthResizeHandler.onEndResize(),i.preventDefault(),i.stopPropagation()):o.options.rowHeaderExpandCollapseHandler&&o.focusManager.CurrentFocus.rowHeader&&0===o.rowNavigator.getExpansionState(o.focusManager.CurrentFocus.item)&&o.options.rowHeaderExpandCollapseHandler(o.focusManager.CurrentFocus.item,!0):o.focusManager.moveFocus("left",n,a,l)});else if("ArrowUp"===e||"Up"===e)i.stopPropagation(),i.preventDefault(),this.runIfFrameReady(function(){var e,t;r&&!n?a&&(e=o.focusManager.CurrentFocus,o.focusManager.moveFocus("up",n,a,l),t=o.focusManager.CurrentFocus,o.selectFocus(i,e),o.selectFocus(i,t)):o.focusManager.moveFocus("up",n,a,l)});else if("ArrowDown"===e||"Down"===e)i.stopPropagation(),i.preventDefault(),this.runIfFrameReady(function(){var e,t;r&&!n?a&&(e=o.focusManager.CurrentFocus,o.focusManager.moveFocus("down",n,a,l),t=o.focusManager.CurrentFocus,o.selectFocus(i,e),o.selectFocus(i,t)):o.focusManager.moveFocus("down",n,a,l)});else if("Home"===e)i.stopPropagation(),i.preventDefault(),this.runIfFrameReady(function(){o.focusManager.moveFocus("home",n,a,l)});else if("End"===e)i.stopPropagation(),i.preventDefault(),this.runIfFrameReady(function(){o.focusManager.moveFocus("end",n,a,l)});else{if(this.focusManager.CurrentFocus&&(this.focusManager.CurrentFocus.bodyCell||this.focusManager.CurrentFocus.rowHeader)){if("PageDown"===e)return i.stopPropagation(),i.preventDefault(),void this.runIfFrameReady(function(){o.focusManager.moveFocus("pagedown",n,a,l,o.getNumberOfVisibleRows())});if("PageUp"===e)return i.stopPropagation(),i.preventDefault(),void this.runIfFrameReady(function(){o.focusManager.moveFocus("pageup",n,a,l,o.getNumberOfVisibleRows())})}"F10"===e&&r?n||(i.preventDefault(),i.stopPropagation(),this.runIfFrameReady(function(){o.showContextMenuForFocus(i)})):"Enter"===e||"Space"===e||"Spacebar"===e||" "===e?(i.preventDefault(),i.stopPropagation(),this.runIfFrameReady(function(){o.selectFocus(i,o.focusManager.CurrentFocus)})):("KeyO"===e&&n&&t&&(i.preventDefault(),i.stopPropagation(),this.runIfFrameReady(function(){o.activateCellContent()})),("KeyC"===e||"c"===e)&&n&&r&&(i.stopPropagation(),i.preventDefault(),this.runIfFrameReady(function(){o.options.whitespaceClickHandler(null,!0)})))}},a.prototype.runIfFrameReady=function(t){return __awaiter(this,void 0,r.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return this.renderLock||this.keyboardLock?[2]:(this.keyboardLock=!0,t(),[4,this.requestAnimationFrameAsync()]);case 1:return e.sent(),this.keyboardLock=!1,[2]}})})},a.prototype.notifyVisual=function(e){e.bodyCell&&this.options.bodyCellFocusHandler?this.options.bodyCellFocusHandler(e.item,e.bodyCell.rowIndex):e.columnHeader&&this.options.columnHeaderFocusHandler?this.options.columnHeaderFocusHandler(e.item):e.rowHeader&&this.options.rowHeaderFocusHandler?this.options.rowHeaderFocusHandler(e.item):e.cornerCell&&this.options.cornerCellFocusHandler?this.options.cornerCellFocusHandler(e.item):e.floatingBodyCell&&this.options.bodyCellFocusHandler?this.options.bodyCellFocusHandler(e.item):void 0!==e.floatingRowHeader&&this.options.rowHeaderFocusHandler&&this.options.rowHeaderFocusHandler(e.item)},a.prototype.setAsFocusTableEx=function(e,t,i){this.focusManager.setAsFocusTableEx(e,t,i)},a.prototype.onFocusChanged=function(){var e,t,i,o,r,n,a,l,s,u,h,d,c=this.focusManager.CurrentFocus,p=(this.notifyVisual(c),this.getViewport());c.bodyCell?(0<=c.bodyCell.columnIndex&&(i=c.bodyCell.columnIndex),e=c.bodyCell.rowIndex):c.rowHeader?(s=g.RowMeasurementUtil.getVisibleRange(p.top,p.height,this.rowHeightMeasureManager),n=g.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(c.item,this.rowNavigator),a=g.PivotTableHierarchyNavigator.getLastVisualLeafIndex(c.item,this.rowNavigator),r=s.lastLeafIndex-s.firstLeafIndex+1,r=n<=s.firstLeafIndex||r<=a-n+1?(e=n,!1):(e=Math.min(a,this.rowHeightMeasureManager.getLastMeasuredIndex()),!0)):c.columnHeader?(u=g.ColumnMeasurementUtil.getVisibleRange(p.left,p.width,this.columnWidthMeasureManager),n=g.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(c.item,this.columnNavigator),a=g.PivotTableHierarchyNavigator.getLastVisualLeafIndex(c.item,this.columnNavigator),l=u.lastLeafIndex-u.firstLeafIndex+1,l=n<=u.firstLeafIndex||l<=a-n+1?(i=n,!1):(i=Math.min(a,this.columnWidthMeasureManager.getLastMeasuredIndex()),!0)):c.floatingBodyCell&&(i=c.floatingBodyCell.columnIndex),void 0!==e&&this.rowScrollbar.visible&&(s=g.RowMeasurementUtil.getVisibleRange(p.top,p.height,this.rowHeightMeasureManager))&&(e<=s.firstLeafIndex?t={rowIndex:e,visibleHeight:Number.MAX_VALUE,alignBottom:null!=r&&r}:e>=s.lastLeafIndex&&(t={rowIndex:e,visibleHeight:Number.MAX_VALUE,alignBottom:null==r||r})),void 0!==i&&this.columnScrollbar.visible&&(u=g.ColumnMeasurementUtil.getVisibleRange(p.left,p.width,this.columnWidthMeasureManager))&&(i<=u.firstLeafIndex?o={columnIndex:i,visibleWidth:Number.MAX_VALUE,alignRight:null!=l&&l}:i>=u.lastLeafIndex&&(o={columnIndex:i,visibleWidth:Number.MAX_VALUE,alignRight:null==l||l})),t&&(h=g.RowMeasurementUtil.getOffset(t,this.rowHeightMeasureManager),t.alignBottom)&&(h-=this.rowScrollbar.viewSize),o&&(d=g.ColumnMeasurementUtil.getOffset(o,this.columnWidthMeasureManager),o.alignRight)&&(d-=this.columnScrollbar.viewSize),(t||o)&&this.scrollTo(d,h),null!=(n=this.getFocusedCell(c))&&n.focus({preventScroll:!0})},a.prototype.getFocusedCell=function(e){var t,i,o,r;return e.bodyCell?-1===e.bodyCell.columnIndex?this.midRenderer.getElementByIndex(e.bodyCell.rowIndex,0,g.TablixRegion.Prefix):this.midRenderer.getElementByIndex(e.bodyCell.rowIndex,e.bodyCell.columnIndex,g.TablixRegion.Main):e.columnHeader?(t=e.item,o=this.columnNavigator.getLevel(t),r=void 0,r=this.isA11yTable?this.columnNavigator.getIndexOfFirstLeaf(t):null!=(i=this.rowNavigator.getLeafIndex(t))?i:this.rowNavigator.getIndexOfFirstLeaf(t),this.topRenderer.getElementByIndex(o,r,g.TablixRegion.Main)):e.rowHeader?(i=e.item,o=null!=(t=this.columnNavigator.getLeafIndex(i))?t:this.columnNavigator.getIndexOfFirstLeaf(i),r=this.steppedLayout?0:this.rowNavigator.getLevel(i),this.midRenderer.getElementByIndex(o,r,g.TablixRegion.Prefix)):e.cornerCell?this.topRenderer.getElementByIndex(e.cornerCell.columnLevel,e.cornerCell.rowLevel,g.TablixRegion.Prefix):e.floatingBodyCell?this.botRenderer.getElementByIndex(e.floatingBodyCell.rowIndex,e.floatingBodyCell.columnIndex,g.TablixRegion.Main):null!=e.floatingRowHeader?this.botRenderer.getElementByIndex(e.floatingRowHeader,0,g.TablixRegion.Prefix):void 0},a.prototype.getCurrentFocusBoundingRect=function(){var e=document.activeElement;return e?{top:(e=e.getBoundingClientRect()).top,left:e.left,width:e.width,height:e.height}:{top:0,left:0,width:0,height:0}},a.prototype.selectFocus=function(e,t){var i=t.item,e=this.createMouseEvent(e);t.bodyCell?this.options.bodyCellClickHandler&&this.options.bodyCellClickHandler(i,e,t.bodyCell.rowIndex,g.TablixSection.Body):t.floatingBodyCell?this.options.bodyCellClickHandler&&this.options.bodyCellClickHandler(i,e,void 0,g.TablixSection.Footer):t.rowHeader||void 0!==t.floatingRowHeader?this.options.rowHeaderClickHandler&&this.options.rowHeaderClickHandler(i,e):t.columnHeader?this.options.columnHeaderClickHandler&&this.options.columnHeaderClickHandler(i,e):t.cornerCell&&this.options.cornerCellClickHandler&&this.options.cornerCellClickHandler(i,e)},a.prototype.activateCellContent=function(){var e=this.focusManager.CurrentFocus,t=document.activeElement;t&&e&&this.options.cellContentActivationHandler&&(e=this.createSimpleMouseClickEvent(),this.options.cellContentActivationHandler(t,e))},a.prototype.createSimpleMouseClickEvent=function(){var e=this.getCurrentFocusBoundingRect();return new MouseEvent("click",{clientX:e.left,clientY:e.top,ctrlKey:!1,metaKey:!1,shiftKey:!1,altKey:!1})},a.prototype.createMouseEvent=function(e){var t=this.getCurrentFocusBoundingRect();return new MouseEvent("click",{clientX:t.left,clientY:t.top,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey})},a.prototype.showContextMenuForFocus=function(e){var t,i,o=this.focusManager.CurrentFocus;-1!==(null==(t=o.bodyCell)?void 0:t.columnIndex)&&(o&&o.item,t=o.item,i=this.getCurrentFocusBoundingRect(),i=new MouseEvent("contextmenu",{clientX:i.left,clientY:i.top,ctrlKey:e.ctrlKey,metaKey:e.metaKey}),o.bodyCell||o.floatingBodyCell?this.options.bodyCellContextMenuHandler&&this.options.bodyCellContextMenuHandler(t,i):o.rowHeader||void 0!==o.floatingRowHeader?this.options.rowHeaderContextMenuHandler&&this.options.rowHeaderContextMenuHandler(t,i):o.columnHeader?this.options.columnHeaderContextMenuHandler&&this.options.columnHeaderContextMenuHandler(t,i):o.cornerCell&&this.options.cornerCellContextMenuHandler&&this.options.cornerCellContextMenuHandler(t,i))},a.prototype.onClick=function(e){var t,i=this.rowLevelWidthMeasureManager.getHeadersWidth()+this.columnWidthMeasureManager.getColumnsWidth(),o=this.columnLevelHeightMeasureManager.getHeadersHeight()+this.rowHeightMeasureManager.getRowsHeight()+this.rowHeightMeasureManager.getFloatingRowHeights();i>=this.width&&o>=this.height||((t=c.HTMLElementUtils.getRelativeMouseCoordinates(this.element,e)).x>i||t.y>o)&&this.options.whitespaceClickHandler(e)},a.prototype.initializeScrollbars=function(){var e=this;this.columnScrollbar=new c.HorizontalScrollbar(this.element,0,!0),this.columnScrollbar.smallIncrement=20,this.columnScrollbar.min=0,this.columnScrollbar.height=g.PivotTableControl.pixelUnits(g.ScrollbarWidth),this.columnScrollbar.element.style.position="absolute",this.isA11yTable?this.columnScrollbar.element.style.left="1px":this.columnScrollbar.element.style.left="0",this.columnScrollbar.element.style.bottom="0",this.columnScrollbar._onscroll.push(function(){return e.refresh()}),this.rowScrollbar=new c.VerticalScrollbar(this.element,0,!0),this.rowScrollbar.smallIncrement=20,this.rowScrollbar.min=0,this.rowScrollbar.width=g.PivotTableControl.pixelUnits(g.ScrollbarWidth),this.rowScrollbar.element.style.position="absolute",this.rowScrollbar.element.style.right="0",this.rowScrollbar.element.style.top="0",this.rowScrollbar._onscroll.push(function(){return e.refresh()}),this.rowScrollbar.element.setAttribute("aria-hidden","true"),this.columnScrollbar.element.setAttribute("aria-hidden","true")},a.prototype.setSteppedLayout=function(e){e!==this.steppedLayout&&(e=(this.steppedLayout=e)?g.RowHeaderType.Stepped:g.RowHeaderType.Blocked,this.columnWidthMeasureManager=new g.ColumnWidthMeasureManager(this.measureElement,this.sizeManager),this.rowLevelWidthMeasureManager=new(this.steppedLayout?g.SteppedRowLevelWidthMeasureManager:g.BlockedRowLevelWidthMeasureManager)(this.measureElement,this.sizeManager),this.rowHeightMeasureManager=new(this.steppedLayout?g.SteppedRowHeightMeasureManager:g.BlockedRowHeightMeasureManager)(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager),this.columnLevelHeightMeasureManager=new g.ColumnLevelHeightMeasureManager(this.measureElement,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.sizeManager),this.topRenderer.updateMeasureManagers(e,this.rowHeightMeasureManager,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.columnLevelHeightMeasureManager),this.midRenderer.updateMeasureManagers(e,this.rowHeightMeasureManager,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.columnLevelHeightMeasureManager),this.botRenderer.updateMeasureManagers(e,this.rowHeightMeasureManager,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.columnLevelHeightMeasureManager),this.focusManager.updateMeasureManagers(this.rowHeightMeasureManager,this.columnWidthMeasureManager),this.clearMeasurement())},a.prototype.createRenderers=function(){var e=this.isA11yTable?g.RenderType.Table:g.RenderType.Matrix;this.topRenderer=new g.TablixRendererTop(this.topViewport,this.options.cornerCellClickHandler,this.options.cornerCellContextMenuHandler,this.options.columnHeaderClickHandler,this.options.columnHeaderContextMenuHandler,this.options.columnHeaderInteractionHandler,g.TablixSection.Header,e,void 0,this.onObject),this.topRenderer.setResizeHandlers(this.columnWidthResizeHandler,this.rowLevelWidthResizeHandler),this.midRenderer=new g.TablixRendererMid(this.innerBodyCellContainer,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,g.TablixSection.Body,e,void 0,this.onObject),this.botRenderer=new g.TablixRendererBot(this.botViewport,this.options.rowHeaderClickHandler,this.options.rowHeaderContextMenuHandler,this.options.bodyCellClickHandler,this.options.bodyCellContextMenuHandler,this.options.bodyCellInteractionHandler,g.TablixSection.Footer,e,void 0,this.onObject)},a.prototype.setWidth=function(e){this.width=e,this.element.style.width=g.PivotTableControl.pixelUnits(this.width),this.columnScrollbar.invalidateArrange()},a.prototype.setHeight=function(e){this.height=e,this.element.style.height=g.PivotTableControl.pixelUnits(this.height),this.rowScrollbar.invalidateArrange()},a.prototype.setClassName=function(e){this.element.className=e},a.prototype.setColumnNavigator=function(e){this.columnNavigator=e,this.focusManager.columnNavigator=e},a.prototype.setRowNavigator=function(e){this.rowNavigator=e,this.focusManager.rowNavigator=e},a.prototype.setBinder=function(e){this.binder=e},a.prototype.getSteppedLayout=function(){return this.steppedLayout},a.prototype.getColumnNavigator=function(){return this.columnNavigator},a.prototype.getRowNavigator=function(){return this.rowNavigator},a.prototype.getSizeManager=function(){return this.sizeManager},a.prototype.getBinder=function(){return this.binder},a.prototype.getColumnWidthMeasureManager=function(){return this.columnWidthMeasureManager},a.prototype.getRowHeightMeasureManager=function(){return this.rowHeightMeasureManager},a.prototype.getColumnLevelHeightMeasureManager=function(){return this.columnLevelHeightMeasureManager},a.prototype.getRowLevelWidthMeasureManager=function(){return this.rowLevelWidthMeasureManager},a.prototype.getTopRenderer=function(){return this.topRenderer},a.prototype.getMidRenderer=function(){return this.midRenderer},a.prototype.getBotRenderer=function(){return this.botRenderer},a.prototype.getViewport=function(){return{left:this.columnScrollbar.viewMin,top:this.rowScrollbar.viewMin,width:this.columnScrollbar.viewSize,height:this.rowScrollbar.viewSize}},a.prototype.getClientWidth=function(){return this.width-(this.rowScrollbar.visible?g.ScrollbarWidth:0)},a.prototype.storeFocus=function(){var e,t,i,o=document.activeElement;o=this.topViewport.contains(o)?this.topRenderer.isPrefixCell(o)?(e=this.topRenderer.getRowIndex(o),t=this.isA11yTable?-1:this.topRenderer.getColumnIndex(o),i=g.TablixSection.Header,g.TablixRegion.Prefix):(e=this.topRenderer.getRowIndex(o),t=this.topRenderer.getColumnIndex(o),i=g.TablixSection.Header,g.TablixRegion.Main):this.midViewport.contains(o)?this.midRenderer.isPrefixCell(o)?(e=this.midRenderer.getRowIndex(o),t=this.isA11yTable?-1:this.midRenderer.getColumnIndex(o),i=g.TablixSection.Body,g.TablixRegion.Prefix):(e=this.midRenderer.getRowIndex(o),t=this.midRenderer.getColumnIndex(o),i=g.TablixSection.Body,g.TablixRegion.Main):this.botViewport.contains(o)?this.botRenderer.isPrefixCell(o)?(e=this.botRenderer.getRowIndex(o),t=this.isA11yTable?-1:this.midRenderer.getColumnIndex(o),i=g.TablixSection.Footer,g.TablixRegion.Prefix):(e=this.botRenderer.getRowIndex(o),t=this.botRenderer.getColumnIndex(o),i=g.TablixSection.Footer,g.TablixRegion.Main):this.isA11yTable?(o=d3.select(this.topViewport).select(".main-cell").node(),e=this.topRenderer.getRowIndex(o),t=this.topRenderer.getColumnIndex(o),i=g.TablixSection.Header,g.TablixRegion.Main):(o=d3.select(this.topViewport).select(".prefix-cell").node(),e=this.topRenderer.getRowIndex(o),t=this.topRenderer.getColumnIndex(o),i=g.TablixSection.Header,g.TablixRegion.Prefix),this.tempFocus={rowIndex:e,columnIndex:t,section:i,region:o}},a.prototype.restoreFocus=function(){var e;this.tempFocus,this.tempFocus.section===g.TablixSection.Header?e=this.topRenderer.getElementByIndex(this.tempFocus.rowIndex,this.tempFocus.columnIndex,this.tempFocus.region):this.tempFocus.section===g.TablixSection.Body?e=-1===this.tempFocus.columnIndex?this.midRenderer.getElementByIndex(this.tempFocus.rowIndex,0,g.TablixRegion.Prefix):this.midRenderer.getElementByIndex(this.tempFocus.rowIndex,this.tempFocus.columnIndex,this.tempFocus.region):this.tempFocus.section===g.TablixSection.Footer&&(e=this.botRenderer.getElementByIndex(this.tempFocus.rowIndex,this.tempFocus.columnIndex,this.tempFocus.region)),e||(this.updateFocus(),e=this.getFocusedCell(this.focusManager.CurrentFocus)),e.focus({preventScroll:!0})},a.prototype.updateFocus=function(){var e,t,i,o,r,n=document.activeElement;this.topViewport.contains(n)?this.topRenderer.isPrefixCell(n)?(o=this.topRenderer.getRowIndex(n),r=this.isA11yTable?-1:this.topRenderer.getColumnIndex(n),e=this.isA11yTable?g.TablixSection.Header:g.TablixSection.MatrixCorner):(i=this.topRenderer.getItemByElement(n),e=g.TablixSection.Header,t=this.columnNavigator.getPathIndices(i)):this.midViewport.contains(n)?this.midRenderer.isPrefixCell(n)?this.isA11yTable?(o=this.midRenderer.getRowIndex(n),r=-1,e=g.TablixSection.Body):(i=this.midRenderer.getItemByElement(n),e=g.TablixSection.MatrixRowHeader,t=this.rowNavigator.getPathIndices(i)):(o=this.midRenderer.getRowIndex(n),r=this.midRenderer.getColumnIndex(n),e=g.TablixSection.Body):e=this.botViewport.contains(n)?this.botRenderer.isPrefixCell(n)?this.isA11yTable?(o=this.botRenderer.getRowIndex(n),r=-1,g.TablixSection.Footer):(o=this.botRenderer.getRowIndex(n),g.TablixSection.FooterHeader):(o=this.botRenderer.getRowIndex(n),r=this.botRenderer.getColumnIndex(n),g.TablixSection.Footer):this.isA11yTable?(i=d3.select(this.topViewport).select(".main-cell").node(),o=this.topRenderer.getRowIndex(i),r=this.topRenderer.getColumnIndex(i),g.TablixSection.Header):(n=d3.select(this.topViewport).select(".prefix-cell").node(),o=this.topRenderer.getRowIndex(n),r=this.topRenderer.getColumnIndex(n),g.TablixSection.MatrixCorner),this.focusManager.setAsFocusTableEx(o,r,e,t)},a.prototype.scrollBy=function(e,t){!this.renderLock&&(e&&(this.columnScrollbar.scrollBy(e,!0),this.columnScrollbar.refresh()),t&&(this.rowScrollbar.scrollBy(t,!0),this.rowScrollbar.refresh()),e||t)&&(this.options.onScroll&&this.options.onScroll(),this.refresh())},a.prototype.scrollTo=function(e,t){this.renderLock||(this.options.onScroll&&this.options.onScroll(),null!=e&&(this.columnScrollbar.scrollTo(e,!0),this.columnScrollbar.refresh()),null!=t&&(this.rowScrollbar.scrollTo(t,!0),this.rowScrollbar.refresh()),this.refresh())},a.prototype.refresh=function(){var e,t,i;this.renderLock||(e=this.columnScrollbar.viewMin,t=this.rowScrollbar.viewMin,i=this.getViewport(),this.topRenderer.scrollToX(e),this.midRenderer.scrollToX(e),this.botRenderer.scrollToX(e),this.midRenderer.scrollToY(t),this.topRenderer.update(i,this.binder,this.rowNavigator,this.columnNavigator),this.midRenderer.update(i,this.binder,this.rowNavigator,this.columnNavigator),this.botRenderer.update(i,this.binder,this.rowNavigator,this.columnNavigator))},a.prototype.renderAsync=function(n,a,l){return __awaiter(this,void 0,r.Promise,function(){var t,i,o,r;return __generator(this,function(e){switch(e.label){case 0:return t=++this.renderIteration,n===g.PivotTableRenderingMode.ClearMeasurement&&this.clearMeasurement(),this.renderLock=!0,[4,this.measureAsync(a,l,t)];case 1:return o=e.sent(),i=o[0],o=o[1],t!==this.renderIteration||(this.renderLock=!1,(r=this.element.contains(document.activeElement))&&this.storeFocus(),n!==g.PivotTableRenderingMode.ClearRendering&&n!==g.PivotTableRenderingMode.ClearMeasurement||this.clearRendering(),this.updateRegionsPosition(),this.updateScrollbars(),this.updateScrollRegionWidth(),this.updateScrollRegionHeight(),this.scrollTo(i,o),n===g.PivotTableRenderingMode.ResizeColumn&&(this.topRenderer.onColumnResize(),this.midRenderer.onColumnResize(),this.botRenderer.onColumnResize()),!r)||n!==g.PivotTableRenderingMode.ClearRendering&&n!==g.PivotTableRenderingMode.ClearMeasurement||this.restoreFocus(),[2]}})})},a.prototype.measureAsync=function(n,a,l){return __awaiter(this,void 0,r.Promise,function(){var t,i,o,r;return __generator(this,function(e){switch(e.label){case 0:if(r=this.getViewport(),o=n?n.rowIndex:(o=g.RowMeasurementUtil.getVisibleRange(r.top,r.height,this.rowHeightMeasureManager))?o.firstLeafIndex:0,r=a?a.columnIndex:(r=g.ColumnMeasurementUtil.getVisibleRange(r.left,r.width,this.columnWidthMeasureManager))?r.firstLeafIndex:0,r=Math.max(0,Math.floor(r-g.MeasureColumnSampleCount/2)),!a)return[3,4];e.label=1;case 1:return this.columnWidthMeasureManager.canAddPageColumn(this.columnNavigator)&&a.columnIndex>this.columnWidthMeasureManager.getLastMeasuredIndex()?(this.columnWidthMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,o),[4,this.setTimeoutAsync()]):[3,3];case 2:return e.sent(),l!==this.renderIteration?[2,[0,0]]:[3,1];case 3:return t=g.ColumnMeasurementUtil.getOffset(a,this.columnWidthMeasureManager),a.alignRight&&(t-=this.columnScrollbar.viewSize),[3,5];case 4:t=this.columnScrollbar.viewMin,e.label=5;case 5:return this.columnWidthMeasureManager.canAddPageColumn(this.columnNavigator)&&this.columnWidthMeasureManager.getColumnsWidth()-t<=this.width?(this.columnWidthMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,o),[4,this.setTimeoutAsync()]):[3,7];case 6:return e.sent(),l!==this.renderIteration?[2,[0,0]]:[3,5];case 7:if(this.rowLevelWidthMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,o,g.MeasureRowSampleCount),this.rowHeightMeasureManager.ensureLastPageComplete(this.binder,this.rowNavigator,this.columnNavigator,o,r,g.MeasureColumnSampleCount),!n)return[3,11];e.label=8;case 8:return this.rowHeightMeasureManager.canAddPageRow(this.rowNavigator)&&n.rowIndex>this.rowHeightMeasureManager.getLastMeasuredIndex()?(this.rowHeightMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,o,r),[4,this.setTimeoutAsync()]):[3,10];case 9:return e.sent(),l!==this.renderIteration?[2,[0,0]]:[3,8];case 10:return i=g.RowMeasurementUtil.getOffset(n,this.rowHeightMeasureManager),n.alignBottom&&(i-=this.rowScrollbar.viewSize),[3,12];case 11:i=this.rowScrollbar.viewMin,e.label=12;case 12:return this.rowHeightMeasureManager.canAddPageRow(this.rowNavigator)&&this.rowHeightMeasureManager.getRowsHeight()-i<=this.height?(this.rowHeightMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,o,r),[4,this.setTimeoutAsync()]):[3,14];case 13:return e.sent(),l!==this.renderIteration?[2,[0,0]]:[3,12];case 14:return this.rowHeightMeasureManager.measureFloatingRows(this.binder,this.rowNavigator,this.columnNavigator,o,r),this.columnLevelHeightMeasureManager.measure(this.binder,this.rowNavigator,this.columnNavigator,o,r,g.MeasureColumnSampleCount),this.measurePageColumnsAsync(o,l),this.measurePageRowsAsync(o,r,l),[2,[t,i]]}})})},a.prototype.setTimeoutAsync=function(t){return void 0===t&&(t=0),__awaiter(this,void 0,r.Promise,function(){return __generator(this,function(e){return[2,new r.Promise(function(e){return jsCommon.Zone.setTimeout(function(){return e()},t)})]})})},a.prototype.requestAnimationFrameAsync=function(){return __awaiter(this,void 0,r.Promise,function(){return __generator(this,function(e){return[2,new r.Promise(function(e){return jsCommon.Zone.requestAnimationFrame(function(){return e()})})]})})},a.prototype.getVisibleRowStart=function(){var e=this.getViewport(),t=g.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager);return t?g.RowMeasurementUtil.getVisibleRowStart(t,e.top,this.rowHeightMeasureManager):null},a.prototype.getVisibleColumnStart=function(){var e=this.getViewport(),t=g.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,this.columnWidthMeasureManager);return t?g.ColumnMeasurementUtil.getVisibleColumnStart(t,e.left,this.columnWidthMeasureManager):null},a.prototype.clearRendering=function(){this.midRenderer.clear(),this.topRenderer.clear(),this.botRenderer.clear()},a.prototype.clearMeasurement=function(){this.columnWidthMeasureManager.clear(),this.rowHeightMeasureManager.clear(),this.columnLevelHeightMeasureManager.clear(),this.rowLevelWidthMeasureManager.clear()},a.prototype.clear=function(){this.renderIteration++,this.renderLock=!1,this.clearRendering(),this.clearMeasurement()},a.prototype.updateRegionsPosition=function(){this.midViewport.style.top=this.topViewport.style.height=g.PivotTableControl.pixelUnits(this.columnLevelHeightMeasureManager.getHeadersHeight()),this.topRenderer.updateBodyLeft(),this.midRenderer.updateBodyLeft(),this.botRenderer.updateBodyLeft();var e=g.PivotTableControl.pixelUnits(this.rowHeightMeasureManager.getFloatingRowHeights());this.botViewport.style.height=e},a.prototype.updateScrollbars=function(){this.rowScrollbar.invalidateArrange(),this.columnScrollbar.invalidateArrange();var e,t=this.rowHeightMeasureManager.getFloatingRowHeights(),i=this.height-this.columnLevelHeightMeasureManager.getHeadersHeight()-t,o=this.width-this.rowLevelWidthMeasureManager.getHeadersWidth(),r=this.rowHeightMeasureManager.getRowsHeight(),n=this.columnWidthMeasureManager.getColumnsWidth(),a=this.options.scrollingEnabled&&0<r&&i<r,l=this.options.scrollingEnabled&&0<n&&o<n,n=(!a&&l&&0<r&&(a=r>i-g.ScrollbarWidth),!l&&a&&0<n&&(l=n>o-g.ScrollbarWidth),this.midViewport.style.right=this.topViewport.style.right=this.botViewport.style.right=a?this.rowScrollbar.width:g.PivotTableControl.pixelUnits(0),l?g.ScrollbarWidth:0),o=i-n<r?(e=n+t,n):(e=i+t-r,i-r);this.midViewport.style.bottom=g.PivotTableControl.pixelUnits(e),this.botViewport.style.bottom=g.PivotTableControl.pixelUnits(o),this.rowScrollbar.show(a),this.rowScrollbar.viewSize=this.midViewport.clientHeight,this.rowScrollbar.element.style.bottom=l?g.ScrollbarWidth+"px":"0",this.rowScrollbar.refresh(),this.columnScrollbar.show(l),this.columnScrollbar.viewSize=this.getBodyCellWidth(),this.columnScrollbar.element.style.right=a?g.ScrollbarWidth+"px":"0",this.columnScrollbar.refresh()},a.prototype.getBodyCellWidth=function(){var e=this.rowLevelWidthMeasureManager.getHeadersWidth(),t=this.columnWidthMeasureManager.getColumnsWidth();return Math.min(this.midViewport.clientWidth-e,t)},a.prototype.measurePageColumnsAsync=function(t,i){return __awaiter(this,void 0,r.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.setTimeoutAsync(g.PivotTableControl.AutoMeasureDelay)];case 1:if(e.sent(),i!==this.renderIteration)return[2];e.label=2;case 2:return this.columnWidthMeasureManager.canAddPageColumn(this.columnNavigator)?(this.columnWidthMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,t),this.updateScrollRegionWidth(),[4,this.setTimeoutAsync(g.PivotTableControl.AutoMeasureDelay)]):[3,4];case 3:return e.sent(),i!==this.renderIteration?[2]:[3,2];case 4:return[2]}})})},a.prototype.measurePageRowsAsync=function(t,i,o){return __awaiter(this,void 0,r.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.setTimeoutAsync(g.PivotTableControl.AutoMeasureDelay)];case 1:if(e.sent(),o!==this.renderIteration)return[2];e.label=2;case 2:return this.rowHeightMeasureManager.canAddPageRow(this.rowNavigator)?(this.rowHeightMeasureManager.measureNextPage(this.binder,this.rowNavigator,this.columnNavigator,t,i),this.updateScrollRegionHeight(),[4,this.setTimeoutAsync(g.PivotTableControl.AutoMeasureDelay)]):[3,4];case 3:return e.sent(),o!==this.renderIteration?[2]:[3,2];case 4:return[2]}})})},a.prototype.updateScrollRegionWidth=function(){var e=this.rowLevelWidthMeasureManager.getHeadersWidth(),t=this.columnWidthMeasureManager.getColumnsWidth(),i=this.midViewport.clientWidth;this.columnScrollbar.max=t,this.columnScrollbar.viewSize=i-e,this.columnScrollbar.refresh(),this.topRenderer.setRowWidth(),this.midRenderer.setRowWidth(),this.botRenderer.setRowWidth()},a.prototype.updateScrollRegionHeight=function(){var e=this.rowHeightMeasureManager.getRowsHeight(),t=this.midViewport.clientHeight,i=g.PivotTableControl.pixelUnits(Math.max(e,t));this.innerBodyCellContainer.style.height=i,this.rowScrollbar.max=e,this.rowScrollbar.viewSize=t,this.rowScrollbar.refresh()},a.prototype.getNumberOfVisibleRows=function(){var e=this.getViewport(),e=g.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager);if(e)return e=0===e.firstLeafIndex?e.lastLeafIndex-e.firstLeafIndex:e.lastLeafIndex-e.firstLeafIndex-1,Math.max(e,1)},a.prototype.getMidViewportBoundingClientRect=function(){return this.midViewport.getBoundingClientRect()},a.prototype.getTopViewportBoundingClientRect=function(){return this.topViewport.getBoundingClientRect()},a.prototype.getBotViewportBoundingClientRect=function(){return this.botViewport.getBoundingClientRect()},a.ScrollDeltaMax=200,g.TablixControl=a}(powerbi=powerbi||{}),function(e){var t,i,o,d;function r(e,t,i,o,r,n,a,l,s,u){var h=this;this.element=e,this.prefixCellClickHandler=t,this.prefixCellContextMenuHandler=i,this.mainCellClickHandler=o,this.mainCellContextMenuHandler=r,this.interactionHandler=n,this.section=a,this.renderType=l,this.onScrollX=s,this.onObject=u,this.viewSync={},this.xPosition=0,this.element.addEventListener("click",function(e){var t=e.target,i=h.getItemByElement(t);i&&(h.isPrefixCell(t)?null!=(t=h.prefixCellClickHandler)&&t.call(h,i,e,void 0,h.section):null!=(t=h.mainCellClickHandler)&&t.call(h,i,e,void 0,h.section))}),this.element.addEventListener("contextmenu",function(e){var t=e.target,i=h.getItemByElement(t);i&&(h.isPrefixCell(t)?null!=(t=h.prefixCellContextMenuHandler)&&t.call(h,i,e):null!=(t=h.mainCellContextMenuHandler)&&t.call(h,i,e))}),this.renderType===d.RenderType.Table&&this.element.addEventListener("change",function(e){var t,e=d3.select(e.target).attr("checkbox-rowindex");null!=e&&null!=(t=h.mainCellClickHandler)&&t.call(h,void 0,void 0,+e,h.section)}),null!=(e=this.interactionHandler)&&e.setTooltipDelegate(function(e){return h.getItemByElement(e.context)},this.element,this.getRegion.bind(this),!0,function(e){return h.shouldHideDefaultTooltip(e.context)})}function n(){return null!==o&&o.apply(this,arguments)||this}function a(){return null!==t&&t.apply(this,arguments)||this}function l(){return null!==i&&i.apply(this,arguments)||this}e=e.visuals||(e.visuals={}),d=(e=e.controls||(e.controls={})).pivotTable||(e.pivotTable={}),r.prototype.update=function(e,t,i,o){var r=this.rowHeightMeasureManager.getLastMeasuredIndex(),n=this.columnWidthMeasureManager.getLastMeasuredIndex(),a=d.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager,d.PageRowCount,r),r=d.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,this.columnWidthMeasureManager,d.PageColumnCount,n);if(this.section!==d.TablixSection.Body||a){var l,s,u,r=r||{firstLeafIndex:-1,firstLeafLeft:0,lastLeafIndex:-2};switch(this.section){case d.TablixSection.Header:l=[0,o.getHierarchyDepth()-1],s=this.rowHeightMeasureManager.getPageRows(),u=this.columnWidthMeasureManager.getPageColumns();break;case d.TablixSection.Body:l=[a.firstLeafIndex,a.lastLeafIndex],s=this.rowHeightMeasureManager.getPageRows(),u=this.columnWidthMeasureManager.getPageColumns();break;case d.TablixSection.Footer:l=[0,i.getFloatingHierarchyLeafCount()-1],s=[this.rowHeightMeasureManager.getFloatingPageRow()],u=this.columnWidthMeasureManager.getPageColumns();break;default:this.section}n=[r.firstLeafIndex,r.lastLeafIndex];this.renderMeta={viewport:e,binder:t,rowNavigator:i,columnNavigator:o,visibleRowRange:l,visibleColumnRange:n,pageRows:s,pageColumns:u},this.updateRendering()}},r.prototype.setRowWidth=function(){var e=this.columnWidthMeasureManager.getColumnsWidth();d3.select(this.element).selectAll(".scrollable-cells-container").style("width",e+"px")},r.prototype.updateBodyLeft=function(){var e=this.rowLevelWidthMeasureManager.getHeadersWidth();d3.select(this.element).selectAll(".scrollable-cells-viewport").style("left",e+"px")},r.prototype.shouldHideDefaultTooltip=function(e){return!d3.select(e).classed("pivotTableCellWrap")&&!d3.select(e).classed("pivotTableCellNoWrap")||e.scrollHeight===e.clientHeight&&e.scrollWidth===e.clientWidth},r.prototype.updateMeasureManagers=function(e,t,i,o,r){this.rowHeaderType=e,this.rowHeightMeasureManager=t,this.columnWidthMeasureManager=i,this.rowLevelWidthMeasureManager=o,this.columnLevelHeightMeasureManager=r},r.prototype.scrollToX=function(e){d3.select(this.element).selectAll(".scrollable-cells-container").style("left",-e+"px"),this.xPosition=e},r.prototype.onColumnResize=function(){var n=this;d3.select(this.element).selectAll(".row").each(function(){var e=n.getRowIndex(this),t=n.getRowHeight(e),e=n.getRowTop(e);d3.select(this).style("height",t+"px").style("top",e+"px")}),d3.select(this.element).selectAll(".prefix-cell:not(.filler-cell)").each(function(){var e=n.getRowIndex(this),t=n.getColumnIndex(this),i=n.isFillerCell(this),o=i?0:n.getPrefixCellHeight(e,t),i=i?0:n.getPrefixCellWidth(e,t),e=n.getPrefixCellLeft(e,t),t=parseFloat(d3.select(this).style("--padding-left")),r=parseFloat(d3.select(this).style("--padding-right")),t=n.getAdjustedPaddings(i,t,r),r=t[0],t=t[1];d3.select(this).style("height",o+"px").style("width",i+"px").style("left",e+"px").style("padding-left",r+"px").style("padding-right",t+"px")}),d3.select(this.element).selectAll(".main-cell:not(.filler-cell)").each(function(){var e=n.getRowIndex(this),t=n.getColumnIndex(this),i=n.getMainCellHeight(e,t),o=n.getMainCellWidth(e,t),e=n.getMainCellLeft(e,t),t=parseFloat(d3.select(this).style("--padding-left")),r=parseFloat(d3.select(this).style("--padding-right")),t=n.getAdjustedPaddings(o,t,r),r=t[0],t=t[1];d3.select(this).style("height",i+"px").style("width",o+"px").style("left",e+"px").style("padding-left",r+"px").style("padding-right",t+"px")}),this.adjustHeaders()},r.prototype.clear=function(){this.viewSync={},d3.select(this.element).html("")},r.prototype.getElementByIndex=function(e,t,i){i=i===d.TablixRegion.Prefix?".prefix-cell":".main-cell";return d3.select(this.element).select('[row-index="'.concat(e,'"] ').concat(i,'[column-index="').concat(t,'"]')).node()},r.prototype.getItemByElement=function(e){var t=this.getRowIndex(e);if(null!=t){var i=this.getColumnIndex(e);if(null!=i)return e=this.isPrefixCell(e),this.getCellItem(t,i,e)}},r.prototype.updateRendering=function(){var t=this,e=[],i=[];this.clearUnusedElements(),this.setGroupLocations(e,i),e.forEach(function(e){return t.insertRowGroup(e)}),i.forEach(function(e){return t.insertCellGroup(e)}),this.scrollToX(this.xPosition),this.adjustHeaders()},r.prototype.clearUnusedElements=function(){var e,t=this;for(e in this.viewSync)if(+e<this.renderMeta.visibleRowRange[0]||+e>this.renderMeta.visibleRowRange[1])delete this.viewSync[e];else for(var i in this.viewSync[e])0<=+i&&(+i<this.renderMeta.visibleColumnRange[0]||+i>this.renderMeta.visibleColumnRange[1])&&delete this.viewSync[e][i];d3.select(this.element).selectAll(".row").filter(function(){var e=t.getRowIndex(this);return e<t.renderMeta.visibleRowRange[0]||e>t.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.element).selectAll(".main-cell").filter(function(){var e=t.getColumnIndex(this);return e<t.renderMeta.visibleColumnRange[0]||e>t.renderMeta.visibleColumnRange[1]}).remove()},r.prototype.setGroupLocations=function(e,t){for(var i=this.renderMeta.visibleRowRange[0];i<=this.renderMeta.visibleRowRange[1];i++)if(this.viewSync[i]){var o=!1,r=void 0;this.viewSync[i][-1]||t.push({rowIndex:i,columnStart:-1,columnEnd:-1});for(n=this.renderMeta.visibleColumnRange[0];n<=this.renderMeta.visibleColumnRange[1];n++)this.viewSync[i][n]?r=!1:(r?_.last(t).columnEnd++:(t.push({rowIndex:i,columnStart:n,columnEnd:n}),r=!0),this.viewSync[i][n]=!0)}else{o?_.last(e).rowEnd++:(e.push({rowStart:i,rowEnd:i}),o=!0),this.viewSync[i]={"-1":!0};for(var n=this.renderMeta.visibleColumnRange[0];n<=this.renderMeta.visibleColumnRange[1];n++)this.viewSync[i][n]=!0}},r.prototype.insertRowGroup=function(e){for(var t,i=d3.select(this.element).selectAll(".row").nodes(),o=i.length-1;0<=o;o--){this.section,d.TablixSection.Body;var r=this.getRowIndex(i[o]);if(e.rowStart>r){t=i[o];break}}var n=this.getRowGroupBindings(e.rowStart,e.rowEnd),a=t?(t.insertAdjacentHTML("afterend",d.ElementBuilder.buildMultiple(n)),t.nextElementSibling):(this.element.insertAdjacentHTML("afterbegin",d.ElementBuilder.buildMultiple(n)),_.first(this.element.children));d.ElementBuilder.attachEventHandlersMultiple(a,n)},r.prototype.insertCellGroup=function(e){for(var t,i=-1===e.columnStart,o=d3.select(this.element).select('[row-index="'.concat(e.rowIndex,'"]')).node(),r=d3.select(o).selectAll(i?".prefix-cell":".main-cell").nodes(),n=r.length-1;0<=n;n--){var a=this.getColumnIndex(r[n]);if(e.columnStart>a){t=r[n];break}}var l=i?this.getPrefixBindings(e.rowIndex):this.getMainBindings(e.rowIndex,e.columnStart,e.columnEnd),o=t?(t.insertAdjacentHTML("afterend",d.ElementBuilder.buildMultiple(l)),t.nextElementSibling):((i=i?o:d3.select(o).select(".scrollable-cells-container").node()).insertAdjacentHTML("afterbegin",d.ElementBuilder.buildMultiple(l)),_.first(i.children));d.ElementBuilder.attachEventHandlersMultiple(o,l)},r.prototype.getRowGroupBindings=function(e,t){for(var i,o=[],r=e;r<=t;r++){var n=this.getRowHeight(r),a=this.getRowTop(r),n={classNames:["row"],attributes:{role:"row","row-index":r.toString(),"aria-rowindex":this.getAriaRowIndex(r).toString()},styleProperties:{position:"absolute",height:n+"px",width:"100%",top:a+"px","pointer-events":"none"},children:[]},a=this.rowLevelWidthMeasureManager.getHeadersWidth(),l=this.columnWidthMeasureManager.getColumnsWidth(),s=this.getPrefixBindings(r),u=this.getMainBindings(r,this.renderMeta.visibleColumnRange[0],this.renderMeta.visibleColumnRange[1]);this.renderType===d.RenderType.Matrix&&(i=n.children).push.apply(i,s),n.children.push({attributes:{role:"presentation"},classNames:["scrollable-cells-viewport"],styleProperties:{position:"absolute","overflow-x":"clip",height:"100%",left:a+"px",right:"0"},children:[{attributes:{role:"presentation"},classNames:["scrollable-cells-container"],styleProperties:{position:"absolute",height:"100%",width:l+"px"},children:this.renderType===d.RenderType.Table?__spreadArray(__spreadArray([],s,!0),u,!0):u}]}),o.push(n)}return o},r.prototype.getPrefixBindings=function(e){for(var t=[],i=this.renderMeta.rowNavigator.getHierarchyDepth(),o=0;o<i;o++){var r=this.getPrefixCellBinding(e,o);t.push(r)}return t},r.prototype.getMainBindings=function(e,t,i){for(var o=[],r=t;r<=i;r++){var n=this.getMainCellBinding(e,r);o.push(n)}return o},r.prototype.adjustCellBindingPadding=function(e,t){var i=parseFloat(e.styleProperties["padding-left"]),o=parseFloat(e.styleProperties["padding-right"]),t=(isNaN(i)&&(i=0),isNaN(o)&&(o=0),this.getAdjustedPaddings(t,i,o)),r=t[0],t=t[1];e.styleProperties["padding-left"]=r+"px",e.styleProperties["padding-right"]=t+"px",e.styleProperties["--padding-left"]=i.toString(),e.styleProperties["--padding-right"]=o.toString()},r.prototype.getAdjustedPaddings=function(e,t,i){var o=Math.max(e-t,0),i=Math.min(i,o);return[Math.min(t,e),i]},r.prototype.getRowIndex=function(e){e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[row-index]")},this.element,!0);return e&&+e.getAttribute("row-index")},r.prototype.getColumnIndex=function(e){e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[column-index]")},this.element,!0);return e&&+e.getAttribute("column-index")},r.prototype.isPrefixCell=function(e){return!!jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches(".prefix-cell")},this.element,!0)},r.prototype.getRegion=function(e){return this.isPrefixCell(e)?d.TablixRegion.Prefix:d.TablixRegion.Main},r.prototype.isFillerCell=function(e){return!!jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches(".filler-cell")},this.element,!0)},r.prototype.getFirstScrollableCellsContainer=function(){return d3.select(this.element).select(".scrollable-cells-container").node()},r.prototype.getAriaColIndex=function(e,t){return t?e+1:e+1+this.renderMeta.rowNavigator.getHierarchyDepth()},r.prototype.getColumnWidth=function(e,t){return t?this.rowLevelWidthMeasureManager.getLevelWidth(e):this.columnWidthMeasureManager.getPageColumns()[d.MeasureUtil.getPageIndex(e,d.PageColumnCount)].getColumnWidths()[e%d.PageColumnCount]},r.prototype.getColumnLeft=function(e,t){return t?this.rowLevelWidthMeasureManager.getLevelLeft(e):(t=this.columnWidthMeasureManager.getPageColumns()[d.MeasureUtil.getPageIndex(e,d.PageColumnCount)],this.columnWidthMeasureManager.getPageColumnLeft(t)+_.sum(t.getColumnWidths().slice(0,e%d.PageColumnCount)))},e=r,d.TablixRendererFS=e,__extends(n,o=e),n.prototype.setResizeHandlers=function(e,t){this.columnWidthResizeHandler=e,this.rowLevelWidthResizeHandler=t},n.prototype.adjustHeaders=function(){var e,t,i,r=this;for(e in d3.select(this.element).selectAll(".primary-columnheader, .secondary-columnheader").each(function(){var e=r.getRowIndex(this),t=r.getColumnIndex(this),e=r.getMainCellWidth(e,t),i=t===r.renderMeta.visibleColumnRange[0],o=d3.select(this).classed("secondary-columnheader")&&!i;d3.select(this).classed("visually-hidden",o),i&&!d3.select(this).classed("last-secondary-columnheader")?(t=e-(i=r.getColumnHeaderOffset(t)),d3.select(this).style("transform","translateX(".concat(i,"px)")),d3.select(this).style("width",t+"px")):o||(d3.select(this).style("transform",null),d3.select(this).style("width",e+"px"))}),this.viewSync)for(var o in this.viewSync[e])"resizable"!==this.viewSync[e][o]&&("-1"===o?d3.select(this.element).select('[row-index="'.concat(e,'"]')).selectAll(".prefix-cell").each(function(){var e;r.isFillerCell(this)||(e=r.getItemByElement(this),new d.HeaderResizer(e,this,r.rowLevelWidthResizeHandler,null,r.prefixCellClickHandler,!0))}):(t=this.getElementByIndex(e,o,d.TablixRegion.Main),this.isFillerCell(t)||(i=this.getItemByElement(t),new d.HeaderResizer(i,t,this.columnWidthResizeHandler,null,this.mainCellClickHandler,!0))),this.viewSync[e][o]="resizable")},n.prototype.getPrefixCellBinding=function(e,t){var i=t,o=this.renderMeta.rowNavigator.getCorner(i,e),o=this.renderMeta.binder.getCornerCellBinding(o,!1,!0),r=this.rowLevelWidthMeasureManager.getLevelLeft(i),e=this.columnLevelHeightMeasureManager.getLevelHeight(e),i=this.rowLevelWidthMeasureManager.getLevelWidth(i);return o.classNames||(o.classNames=[]),o.attributes||(o.attributes={}),o.styleProperties||(o.styleProperties={}),o.classNames.push("prefix-cell"),o.attributes.role="columnheader",o.attributes["column-index"]=t.toString(),o.attributes["aria-colindex"]=this.getAriaColIndex(t,!0).toString(),o.attributes.tabindex="0",o.styleProperties.position="absolute",o.styleProperties.left=r+"px",o.styleProperties.height=e+"px",o.styleProperties.width=i+"px",o.styleProperties["box-sizing"]="border-box",o.styleProperties["pointer-events"]="auto",this.adjustCellBindingPadding(o,i),o},n.prototype.getMainCellBinding=function(e,t){var i,o,r,n,a=e,l=this.columnWidthMeasureManager.getPageColumns()[d.MeasureUtil.getPageIndex(t,d.PageColumnCount)],l=this.columnWidthMeasureManager.getPageColumnLeft(l)+_.sum(l.getColumnWidths().slice(0,t%d.PageColumnCount)),s=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),s=this.renderMeta.columnNavigator.getLeafAncestorAtLevel(s,a,!0);return s?((i=this.renderMeta.columnNavigator.getHierarchyLeafAt(t+1))&&(o=this.renderMeta.columnNavigator.getLeafAncestorAtLevel(i,a,!0)),i=this.renderMeta.binder.getColumnHeaderBinding(s,!1,!0,this.onObject,o=o===s?void 0:o),a=this.getMainCellHeight(e,t),o=this.getMainCellWidth(e,t),e=this.renderMeta.columnNavigator.isLeaf(s),r=this.renderMeta.columnNavigator.getIndexOfFirstLeaf(s),r=this.renderMeta.columnNavigator.getNodeLeafCount(s)-(t-r),n=!e&&this.renderMeta.columnNavigator.getIndexOfFirstLeaf(s)===t,s=(e=!e&&this.renderMeta.columnNavigator.getIndexOfFirstLeaf(s)!==t)&&1==r,i.classNames||(i.classNames=[]),i.attributes||(i.attributes={}),i.styleProperties||(i.styleProperties={}),i.classNames.push("main-cell"),n&&i.classNames.push("primary-columnheader"),e&&i.classNames.push("secondary-columnheader"),s&&i.classNames.push("last-secondary-columnheader"),i.attributes.role="columnheader",i.attributes["column-index"]=t.toString(),i.attributes["aria-colindex"]=this.getAriaColIndex(t,!1).toString(),i.attributes.tabindex="0",i.styleProperties.position="absolute",i.styleProperties.left=l+"px",i.styleProperties.width=o+"px",i.styleProperties.height=a+"px",i.styleProperties["box-sizing"]="border-box",i.styleProperties["pointer-events"]="auto",this.adjustCellBindingPadding(i,o),i):{attributes:{role:"columnheader","column-index":t.toString(),"aria-colindex":this.getAriaColIndex(t,!1).toString()},classNames:["main-cell","filler-cell","visually-hidden"],styleProperties:{position:"absolute",left:l+"px",height:"0",width:"0","box-sizing":"border-box","--padding-left":"0","--padding-right":"0"}}},n.prototype.getAriaRowIndex=function(e){return e+1},n.prototype.getRowHeight=function(e){return this.columnLevelHeightMeasureManager.getLevelHeight(e)},n.prototype.getRowTop=function(e){return this.columnLevelHeightMeasureManager.getLevelTop(e)},n.prototype.getPrefixCellWidth=function(e,t){return this.rowLevelWidthMeasureManager.getLevelWidth(t)},n.prototype.getPrefixCellHeight=function(e,t){return this.columnLevelHeightMeasureManager.getLevelHeight(e)},n.prototype.getPrefixCellLeft=function(e,t){return this.rowLevelWidthMeasureManager.getLevelLeft(t)},n.prototype.getMainCellWidth=function(e,t){var i=this,o=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),o=this.renderMeta.columnNavigator.getLeafAncestorAtLevel(o,e),e=this.renderMeta.columnNavigator.getIndexOfFirstLeaf(o),o=this.renderMeta.columnNavigator.getNodeLeafCount(o)-(t-e),e=this.columnWidthMeasureManager.getLastMeasuredIndex(),o=Math.min(t+o-1,e);return _.sum(_.range(t,o+1).map(function(e){return i.columnWidthMeasureManager.getColumnWidth(e)}))},n.prototype.getMainCellHeight=function(e,t){var i=this,o=e,t=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),t=this.renderMeta.columnNavigator.getLeafAncestorAtLevel(t,o),t=d.PivotTableHierarchyNavigator.getHeaderSpan(t,this.renderMeta.columnNavigator);return _.sum(_.range(e,1+(o+t-1)).map(function(e){return i.columnLevelHeightMeasureManager.getLevelHeight(e)}))},n.prototype.getMainCellLeft=function(e,t){var i=this.columnWidthMeasureManager.getPageColumns()[d.MeasureUtil.getPageIndex(t,d.PageColumnCount)];return this.columnWidthMeasureManager.getPageColumnLeft(i)+_.sum(i.getColumnWidths().slice(0,t%d.PageColumnCount))},n.prototype.getCellItem=function(e,t,i){return i?this.renderMeta.rowNavigator.getCorner(t,e):(i=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),this.renderMeta.columnNavigator.getLeafAncestorAtLevel(i,e))},n.prototype.getColumnHeaderOffset=function(e){return this.renderMeta.viewport.left-this.getColumnLeft(e,!1)},d.TablixRendererTop=n,__extends(a,t=e),a.prototype.scrollToY=function(e){this.element.style.top=-e+"px"},a.prototype.adjustHeaders=function(){var r;this.rowHeaderType!==d.RowHeaderType.Stepped&&(r=this,d3.select(this.element).selectAll(".primary-rowheader, .secondary-rowheader").each(function(){var e=r.getRowIndex(this),t=r.getColumnIndex(this),t=r.getPrefixCellHeight(e,t),i=e===r.renderMeta.visibleRowRange[0],o=d3.select(this).classed("secondary-rowheader")&&!i;d3.select(this).classed("visually-hidden",o),i&&!d3.select(this).classed("last-secondary-rowheader")?(e=t-(i=r.getRowHeaderOffset(e)),d3.select(this).style("transform","translateY(".concat(i,"px)")),d3.select(this).style("height",e+"px")):o||(d3.select(this).style("transform",null),d3.select(this).style("height",t+"px"))}))},a.prototype.getPrefixCellBinding=function(e,t){var i=t,o=this.renderMeta.rowNavigator.getHierarchyLeafAt(e),o=this.renderMeta.rowNavigator.getLeafAncestorAtLevel(o,i,!0),r=this.rowLevelWidthMeasureManager.getLevelLeft(i);if(!o)return{attributes:{role:"rowheader","column-index":t.toString(),"aria-colindex":this.getAriaColIndex(t,!0).toString()},classNames:["prefix-cell","filler-cell","visually-hidden"],styleProperties:{position:"absolute",left:r+"px",height:"0",width:"0","box-sizing":"border-box","--padding-left":"0","--padding-right":"0"}};this.renderType===d.RenderType.Table&&(a=this.renderMeta.rowNavigator.getHierarchyLeafAt(e),a=(n=this.renderMeta.columnNavigator.getColumnIndexFromQueryName(this.renderMeta.binder.getRowReferenceQueryName()))?this.renderMeta.rowNavigator.getIntersection(a,n):void 0);var n=this.renderMeta.rowNavigator.getHierarchyLeafAt(e+1),n=(n&&(l=this.renderMeta.rowNavigator.getLeafAncestorAtLevel(n,i,!0)),this.renderMeta.binder.getRowHeaderBinding(o,!1,!0,void 0,void 0,!1,a,l=l===o?void 0:l)),i=this.getPrefixCellWidth(e,t),a=this.getPrefixCellHeight(e,t),l=this.renderMeta.rowNavigator.isLeaf(o),s=this.rowHeaderType===d.RowHeaderType.Stepped,u=this.renderMeta.rowNavigator.getIndexOfFirstLeaf(o),u=this.renderMeta.rowNavigator.getNodeLeafCount(o)-(e-u),h=!l&&!s&&this.renderMeta.rowNavigator.getIndexOfFirstLeaf(o)===e,l=!l&&!s&&this.renderMeta.rowNavigator.getIndexOfFirstLeaf(o)!==e,s=l&&1==u;return n.classNames||(n.classNames=[]),n.attributes||(n.attributes={}),n.styleProperties||(n.styleProperties={}),n.classNames.push("prefix-cell"),h&&n.classNames.push("primary-rowheader"),l&&n.classNames.push("secondary-rowheader"),s&&n.classNames.push("last-secondary-rowheader"),n.attributes["column-index"]=t.toString(),n.attributes["aria-colindex"]=this.getAriaColIndex(t,!0).toString(),n.attributes.tabindex="0",n.styleProperties.position="absolute",n.styleProperties.left=r+"px",n.styleProperties.height=a+"px",n.styleProperties.width=this.renderType===d.RenderType.Table?this.columnWidthMeasureManager.getColumnsWidth()+"px":i+"px",n.styleProperties["box-sizing"]="border-box",n.styleProperties["pointer-events"]=this.renderType===d.RenderType.Table?"none":"auto",this.renderType===d.RenderType.Table&&(e=o===_.first(this.renderMeta.rowNavigator.getHierarchyItems()),u=this.renderMeta.rowNavigator.isLastItem(o,this.renderMeta.rowNavigator.getHierarchyItems()),h=this.renderMeta.binder.getBorderInfo(e,u,!0,!0,!0,d.TablixSection.Body),n.styleProperties["--outline-top"]=h.weightTop+1+"px",n.styleProperties["--outline-right"]=h.weightRight+1+"px",n.styleProperties["--outline-bottom"]=h.weightBottom+1+"px",n.styleProperties["--outline-left"]=h.weightLeft+1+"px",n.styleProperties["z-index"]="1"),this.adjustCellBindingPadding(n,i),n},a.prototype.getMainCellBinding=function(e,t){var i=this.renderMeta.rowNavigator.getHierarchyLeafAt(e),o=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),i=this.renderMeta.rowNavigator.getIntersection(i,o),r=this.getRowHeight(e),n=this.getColumnWidth(t,!1),a=this.getColumnLeft(t,!1),e=this.renderMeta.rowNavigator.getHierarchyLeafAt(e+1),e=e&&this.renderMeta.rowNavigator.getIntersection(e,o),o=this.renderMeta.binder.getBodyCellBinding(i,!1,r,n,!0,this.onObject,e);return o.classNames||(o.classNames=[]),o.attributes||(o.attributes={}),o.styleProperties||(o.styleProperties={}),o.classNames.push("main-cell"),o.attributes.role="gridcell",o.attributes["column-index"]=t.toString(),o.attributes["aria-colindex"]=this.getAriaColIndex(t,!1).toString(),o.attributes.tabindex="0",o.styleProperties.position="absolute",o.styleProperties["box-sizing"]="border-box",o.styleProperties.height="100%",o.styleProperties.width=d.PivotTableControl.pixelUnits(n),o.styleProperties.left=d.PivotTableControl.pixelUnits(a),o.styleProperties["pointer-events"]="auto",this.adjustCellBindingPadding(o,n),o},a.prototype.getAriaRowIndex=function(e){return e+1+this.renderMeta.columnNavigator.getHierarchyDepth()},a.prototype.getRowHeight=function(e){return this.rowHeightMeasureManager.getPageRows()[d.MeasureUtil.getPageIndex(e,d.PageRowCount)].getRowHeights()[e%d.PageRowCount]},a.prototype.getRowTop=function(e){var t=this.rowHeightMeasureManager.getPageRows()[d.MeasureUtil.getPageIndex(e,d.PageRowCount)];return this.rowHeightMeasureManager.getPageRowTop(t)+_.sum(t.getRowHeights().slice(0,e%d.PageRowCount))},a.prototype.getPrefixCellWidth=function(e,t){var i=this;return this.rowHeaderType===d.RowHeaderType.Stepped?this.rowLevelWidthMeasureManager.getHeadersWidth():(t=t,e=this.renderMeta.rowNavigator.getHierarchyLeafAt(e),e=this.renderMeta.rowNavigator.getLeafAncestorAtLevel(e,t),e=d.PivotTableHierarchyNavigator.getHeaderSpan(e,this.renderMeta.rowNavigator),_.sum(_.range(t,1+(t+e-1)).map(function(e){return i.rowLevelWidthMeasureManager.getLevelWidth(e)})))},a.prototype.getPrefixCellHeight=function(e,t){var i,o=this;return this.renderType===d.RenderType.Table||this.rowHeaderType===d.RowHeaderType.Stepped?this.rowHeightMeasureManager.getRowHeight(e):(t=t,i=this.renderMeta.rowNavigator.getHierarchyLeafAt(e),i=this.renderMeta.rowNavigator.getLeafAncestorAtLevel(i,t),t=this.renderMeta.rowNavigator.getIndexOfFirstLeaf(i),i=this.renderMeta.rowNavigator.getNodeLeafCount(i)-(e-t),t=this.rowHeightMeasureManager.getLastMeasuredIndex(),i=Math.min(e+i-1,t),_.sum(_.range(e,i+1).map(function(e){return o.rowHeightMeasureManager.getRowHeight(e)})))},a.prototype.getPrefixCellLeft=function(e,t){return this.getColumnLeft(t,!0)},a.prototype.getMainCellWidth=function(e,t){return this.getColumnWidth(t,!1)},a.prototype.getMainCellHeight=function(e,t){return this.getRowHeight(e)},a.prototype.getMainCellLeft=function(e,t){return this.getColumnLeft(t,!1)},a.prototype.getCellItem=function(e,t,i){var o;return i?(i=t,o=this.renderMeta.rowNavigator.getHierarchyLeafAt(e),this.renderMeta.rowNavigator.getLeafAncestorAtLevel(o,i)):(o=this.renderMeta.rowNavigator.getHierarchyLeafAt(e),i=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),this.renderMeta.rowNavigator.getIntersection(o,i))},a.prototype.getRowHeaderOffset=function(e){return this.renderMeta.viewport.top-this.getRowTop(e)},d.TablixRendererMid=a,__extends(l,i=e),l.prototype.adjustHeaders=function(){},l.prototype.getPrefixCellBinding=function(e,t){var i=this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(e),i=this.renderMeta.binder.getRowHeaderBinding(i,!1,void 0,void 0,void 0,!0),e=this.rowHeightMeasureManager.getFloatingRowHeight(e),o=this.rowLevelWidthMeasureManager.getHeadersWidth();return i.classNames||(i.classNames=[]),i.attributes||(i.attributes={}),i.styleProperties||(i.styleProperties={}),i.classNames.push("prefix-cell"),i.attributes.role="rowheader",i.attributes["column-index"]=t.toString(),i.attributes["aria-colindex"]=this.getAriaColIndex(t,!0).toString(),i.attributes.tabindex="0",i.styleProperties.position="absolute",i.styleProperties.left="0",i.styleProperties.height=e+"px",i.styleProperties.width=o+"px",i.styleProperties["box-sizing"]="border-box",i.styleProperties["pointer-events"]="auto",this.adjustCellBindingPadding(i,o),i},l.prototype.getMainCellBinding=function(e,t){var i=this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(e),o=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),i=this.renderMeta.rowNavigator.getIntersection(i,o),o=this.getRowHeight(e),e=this.getColumnWidth(t,!1),r=this.getColumnLeft(t,!1),i=this.renderMeta.binder.getBodyCellBinding(i,!1,o,e,!0,this.onObject);return i.classNames||(i.classNames=[]),i.attributes||(i.attributes={}),i.styleProperties||(i.styleProperties={}),i.classNames.push("main-cell"),i.attributes.role="gridcell",i.attributes["column-index"]=t.toString(),i.attributes["aria-colindex"]=this.getAriaColIndex(t,!1).toString(),i.attributes.tabindex="0",i.styleProperties.position="absolute",i.styleProperties["box-sizing"]="border-box",i.styleProperties.height="100%",i.styleProperties.width=d.PivotTableControl.pixelUnits(e),i.styleProperties.left=d.PivotTableControl.pixelUnits(r),i.styleProperties["pointer-events"]="auto",this.adjustCellBindingPadding(i,e),i},l.prototype.getAriaRowIndex=function(e){return-1},l.prototype.getRowHeight=function(e){return this.rowHeightMeasureManager.getFloatingPageRow().getRowHeights()[e]},l.prototype.getRowTop=function(e){var t=this.rowHeightMeasureManager.getFloatingPageRow();return this.rowHeightMeasureManager.getPageRowTop(t)+_.sum(t.getRowHeights().slice(0,e))},l.prototype.getPrefixCellWidth=function(e,t){return this.rowLevelWidthMeasureManager.getHeadersWidth()},l.prototype.getPrefixCellHeight=function(e,t){return this.rowHeightMeasureManager.getFloatingRowHeight(e)},l.prototype.getPrefixCellLeft=function(e,t){return 0},l.prototype.getMainCellWidth=function(e,t){return this.getColumnWidth(t,!1)},l.prototype.getMainCellHeight=function(e,t){return this.getRowHeight(e)},l.prototype.getMainCellLeft=function(e,t){return this.getColumnLeft(t,!1)},l.prototype.getCellItem=function(e,t,i){return i?this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(e):(i=this.renderMeta.rowNavigator.getFloatingHierarchyLeafAt(e),e=this.renderMeta.columnNavigator.getHierarchyLeafAt(t),this.renderMeta.rowNavigator.getIntersection(i,e))},d.TablixRendererBot=l}(powerbi=powerbi||{}),function(e){var a;function t(e,t){this.svgLayer=e,this.section=t,this.viewSync={leftRows:{},rightRows:{},columns:{},leftBorders:{},rightBorders:{},cornerColumnLevels:{},cornerRowLevels:{}},this.generateSvgGroups(),this.leftBorderMaskId="left-border-mask".concat(this.section),this.rightBorderMaskId="right-border-mask".concat(this.section),this.tablixBorderManager=new a.TablixBorderManager}e=(e=e.visuals||(e.visuals={})).controls||(e.controls={}),a=e.pivotTable||(e.pivotTable={}),t.prototype.update=function(e,t,i,o){var r=this.getVisibleRows(e,i,o),e=a.ColumnMeasurementUtil.getVisibleRange(e.left,e.width,this.columnWidthMeasureManager);r&&e&&(r=[r.firstLeafIndex,r.lastLeafIndex],e=[e.firstLeafIndex,e.lastLeafIndex],this.renderMeta={binder:t,rowNavigator:i,columnNavigator:o,visibleRowRange:r,visibleColumnRange:e},this.generateMasks(),this.updateRendering())},t.prototype.getVisibleRows=function(e,t,i){switch(this.section){case a.TablixSection.Header:var o=i.getHierarchyDepth();return{firstLeafIndex:0,firstLeafTop:this.columnLevelHeightMeasureManager.getHeadersHeight(),lastLeafIndex:o};case a.TablixSection.Body:return a.RowMeasurementUtil.getVisibleRange(e.top,e.height,this.rowHeightMeasureManager);case a.TablixSection.Footer:return{firstLeafIndex:0,firstLeafTop:0,lastLeafIndex:t.getFloatingHierarchyLeafCount()-1};default:this.section}},t.prototype.resizeColumn=function(o){var r,e;this.renderMeta&&(r=this,e=function(){var e,t,i=+d3.select(this).attr("border-column-index");i<o||d3.select(this).classed("border-left")||(t=a.MeasureUtil.getPageIndex(i,a.PageColumnCount),e=(t=r.columnWidthMeasureManager.getPageColumns()[t]).getColumnWidths()[i%a.PageColumnCount],t=r.columnWidthMeasureManager.getPageColumnLeft(t)+_.sum(t.getColumnWidths().slice(0,i%a.PageColumnCount))+e-+d3.select(this).style("stroke-width")/2,d3.select(this).attr("x1",t).attr("x2",t))},d3.select(this.leftVerticalBorderGroup).selectAll("[border-column-index]").each(e),d3.select(this.leftVerticalGridlineGroup).selectAll("[border-column-index]").each(e),d3.select(this.rightVerticalBorderGroup).selectAll("[border-column-index]").each(e),d3.select(this.rightVerticalGridlineGroup).selectAll("[border-column-index]").each(e))},t.prototype.resizeRows=function(o,r){var n,e;this.renderMeta&&(e=(n=this).section===a.TablixSection.Body?function(){var e,t,i=+d3.select(this).attr("border-row-index");i<o||r<i||d3.select(this).classed("border-top")||(t=a.MeasureUtil.getPageIndex(i,a.PageRowCount),e=(t=n.rowHeightMeasureManager.getPageRows()[t]).getRowHeights()[i%a.PageRowCount],t=n.rowHeightMeasureManager.getPageRowTop(t)+_.sum(t.getRowHeights().slice(0,i%a.PageRowCount))+e-+d3.select(this).style("stroke-width")/2,d3.select(this).attr("y1",t).attr("y2",t))}:function(){var e;d3.select(this).classed("border-top")||(e=+d3.select(this).style("stroke-width"),isNaN(+d3.select(this).attr("y1")))||(d3.select(this).attr("y1","100%").attr("y2","100%"),d3.select(this).style("stroke-width",2*e))},d3.select(this.leftHorizontalBorderGroup).selectAll("[border-row-index]").each(e),d3.select(this.leftHorizontalGridlineGroup).selectAll("[border-row-index]").each(e),d3.select(this.rightHorizontalBorderGroup).selectAll("[border-row-index]").each(e),d3.select(this.rightHorizontalGridlineGroup).selectAll("[border-row-index]").each(e))},t.prototype.clear=function(){d3.select(this.leftHorizontalBorderGroup).html(""),d3.select(this.leftHorizontalGridlineGroup).html(""),d3.select(this.leftVerticalBorderGroup).html(""),d3.select(this.leftVerticalGridlineGroup).html(""),d3.select(this.rightHorizontalBorderGroup).html(""),d3.select(this.rightHorizontalGridlineGroup).html(""),d3.select(this.rightVerticalBorderGroup).html(""),d3.select(this.rightVerticalGridlineGroup).html(""),this.viewSync={leftRows:{},rightRows:{},columns:{},leftBorders:{},rightBorders:{},cornerColumnLevels:{},cornerRowLevels:{}}},t.prototype.updateMeasureManagers=function(e,t,i,o,r){this.rowHeaderType=e,this.rowHeightMeasureManager=t,this.columnWidthMeasureManager=i,this.rowLevelWidthMeasureManager=o,this.columnLevelHeightMeasureManager=r},t.prototype.scrollToY=function(e){this.rightHorizontalGridlineGroup.style.transform="translateY(".concat(-e,"px)"),this.rightHorizontalBorderGroup.style.transform="translateY(".concat(-e,"px)"),this.section!==a.TablixSection.Header&&(this.leftHorizontalGridlineGroup.style.transform="translateY(".concat(-e,"px)"),this.leftHorizontalBorderGroup.style.transform="translateY(".concat(-e,"px)"))},t.prototype.scrollToX=function(e){this.rightVerticalGridlineGroup.style.transform="translateX(".concat(-e,"px)"),this.rightVerticalBorderGroup.style.transform="translateX(".concat(-e,"px)")},t.prototype.setSectionHeight=function(e){this.sectionHeight=e},t.prototype.updateRendering=function(){var t=this,e=[];this.clearUnusedElements(),this.tablixBorderManager.setGroupLocations(e,this.section,this.svgLayer,this.columnLevelHeightMeasureManager,this.columnWidthMeasureManager,this.rowLevelWidthMeasureManager,this.rowHeightMeasureManager,this.viewSync,this.renderMeta,this.rowHeaderType),e.forEach(function(e){return t.insertBorder(e)})},t.prototype.getTablixSection=function(e){var t;switch(this.section){case a.TablixSection.Body:case a.TablixSection.Footer:t=e?a.TablixSection.MatrixRowHeader:a.TablixSection.Body;break;default:t=a.TablixSection.Header}return t},t.prototype.insertBorder=function(e){var t=this.getTablixSection(e.isLeftSection),t=this.renderMeta.binder.getTablixBorderBindings(e,t);t&&(e.isLeftSection?e.outline?"horizontal"===e.orientation?this.leftHorizontalBorderGroup:this.leftVerticalBorderGroup:"horizontal"===e.orientation?this.leftHorizontalGridlineGroup:this.leftVerticalGridlineGroup:e.outline?"horizontal"===e.orientation?this.rightHorizontalBorderGroup:this.rightVerticalBorderGroup:"horizontal"===e.orientation?this.rightHorizontalGridlineGroup:this.rightVerticalGridlineGroup).insertAdjacentHTML("afterbegin",a.ElementBuilder.build(t))},t.prototype.clearUnusedElements=function(){var e,t,i=this;for(e in this.viewSync.rightRows)(+e<this.renderMeta.visibleRowRange[0]||+e>this.renderMeta.visibleRowRange[1])&&delete this.viewSync.rightRows[e];for(e in this.viewSync.leftRows)(+e<this.renderMeta.visibleRowRange[0]||+e>this.renderMeta.visibleRowRange[1])&&delete this.viewSync.leftRows[e];for(t in this.viewSync.columns)(+t<this.renderMeta.visibleColumnRange[0]||+t>this.renderMeta.visibleColumnRange[1])&&delete this.viewSync.columns[t];switch(this.section){case a.TablixSection.Header:this.renderMeta.visibleColumnRange[1]<this.renderMeta.columnNavigator.getHierarchyLeafCount()-1&&delete this.viewSync.rightBorders[2];break;case a.TablixSection.Body:this.renderMeta.visibleColumnRange[1]<this.renderMeta.columnNavigator.getHierarchyLeafCount()-1&&delete this.viewSync.rightBorders[2],0!==this.renderMeta.visibleColumnRange[0]&&delete this.viewSync.rightBorders[8],this.renderMeta.visibleRowRange[1]<this.renderMeta.rowNavigator.getHierarchyLeafCount()-1&&(delete this.viewSync.rightBorders[4],delete this.viewSync.leftBorders[4]),0!==this.renderMeta.visibleRowRange[0]&&(delete this.viewSync.rightBorders[1],delete this.viewSync.leftBorders[1]);break;case a.TablixSection.Footer:}d3.select(this.rightHorizontalBorderGroup).selectAll("[border-row-index]").filter(function(){var e=+d3.select(this).attr("border-row-index");return e<i.renderMeta.visibleRowRange[0]||e>i.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.rightVerticalBorderGroup).selectAll("[border-column-index]").filter(function(){var e=+d3.select(this).attr("border-column-index");return e<i.renderMeta.visibleColumnRange[0]||e>i.renderMeta.visibleColumnRange[1]}).remove(),d3.select(this.rightHorizontalGridlineGroup).selectAll("[border-row-index]").filter(function(){var e=+d3.select(this).attr("border-row-index");return e<i.renderMeta.visibleRowRange[0]||e>i.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.rightVerticalGridlineGroup).selectAll("[border-column-index]").filter(function(){var e=+d3.select(this).attr("border-column-index");return e<i.renderMeta.visibleColumnRange[0]||e>i.renderMeta.visibleColumnRange[1]}).remove(),d3.select(this.leftHorizontalBorderGroup).selectAll("[border-row-index]").filter(function(){var e=+d3.select(this).attr("border-row-index");return e<i.renderMeta.visibleRowRange[0]||e>i.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.leftVerticalBorderGroup).selectAll("[border-column-index]").filter(function(){var e=+d3.select(this).attr("border-column-index");return e<i.renderMeta.visibleColumnRange[0]||e>i.renderMeta.visibleColumnRange[1]}).remove(),d3.select(this.leftHorizontalGridlineGroup).selectAll("[border-row-index]").filter(function(){var e=+d3.select(this).attr("border-row-index");return e<i.renderMeta.visibleRowRange[0]||e>i.renderMeta.visibleRowRange[1]}).remove(),d3.select(this.leftVerticalGridlineGroup).selectAll("[border-column-index]").filter(function(){var e=+d3.select(this).attr("border-column-index");return e<i.renderMeta.visibleColumnRange[0]||e>i.renderMeta.visibleColumnRange[1]}).remove()},t.prototype.generateSvgGroups=function(){d3.select(this.svgLayer).append("g").attr("class","left-borders");var e=d3.select(this.svgLayer).select(".left-borders"),e=(e.append("g").attr("class","horizontal-gridline-group-svg"),e.append("g").attr("class","vertical-gridline-group-svg"),e.append("g").attr("class","horizontal-border-group-svg"),e.append("g").attr("class","vertical-border-group-svg"),this.leftHorizontalGridlineGroup=this.svgLayer.querySelector(".left-borders > .horizontal-gridline-group-svg"),this.leftVerticalGridlineGroup=this.svgLayer.querySelector(".left-borders > .vertical-gridline-group-svg"),this.leftHorizontalBorderGroup=this.svgLayer.querySelector(".left-borders > .horizontal-border-group-svg"),this.leftVerticalBorderGroup=this.svgLayer.querySelector(".left-borders > .vertical-border-group-svg"),d3.select(this.svgLayer).append("g").attr("class","right-borders"),d3.select(this.svgLayer).select(".right-borders"));e.append("g").attr("class","horizontal-gridline-group-svg"),e.append("g").attr("class","vertical-gridline-group-svg"),e.append("g").attr("class","horizontal-border-group-svg"),e.append("g").attr("class","vertical-border-group-svg"),this.rightHorizontalGridlineGroup=this.svgLayer.querySelector(".right-borders > .horizontal-gridline-group-svg"),this.rightVerticalGridlineGroup=this.svgLayer.querySelector(".right-borders > .vertical-gridline-group-svg"),this.rightHorizontalBorderGroup=this.svgLayer.querySelector(".right-borders > .horizontal-border-group-svg"),this.rightVerticalBorderGroup=this.svgLayer.querySelector(".right-borders > .vertical-border-group-svg")},t.prototype.generateMasks=function(){var e=d3.select("#".concat(this.leftBorderMaskId)),t=d3.select("#".concat(this.rightBorderMaskId)),i=(e.empty()&&(e=d3.select(this.svgLayer).append("mask").attr("id",this.leftBorderMaskId)).append("rect"),t.empty()&&(t=d3.select(this.svgLayer).append("mask").attr("id",this.rightBorderMaskId)).append("rect"),this.rowLevelWidthMeasureManager.getHeadersWidth()),e=(e.select("rect").attr("width",i).attr("fill","white").attr("height",this.sectionHeight),t.select("rect").attr("x",i).attr("width",this.svgLayer.clientWidth).attr("height",this.sectionHeight).attr("fill","white"),d3.select(this.svgLayer).select(".left-borders")),t=d3.select(this.svgLayer).select(".right-borders");e.attr("mask","url(#".concat(this.leftBorderMaskId,")")),t.attr("mask","url(#".concat(this.rightBorderMaskId,")"))},a.TablixBorderRenderer=t}(powerbi=powerbi||{}),function(e){var y,r,b;function t(e,t,i,o,r,n,a,l,s){this.onFocusChangedHandler=e,this.isA11yTable=t,this.isA11yMatrix=i,this.headerContainer=o,this.bodyContainer=r,this.cornerContainer=n,this.rowHeaderContainer=a,this.footerRowHeaderContainer=l,this.footerBodyContainer=s}y=e.visuals||(e.visuals={}),r=y.controls||(y.controls={}),b=r.pivotTable||(r.pivotTable={}),Object.defineProperty(t.prototype,"CurrentFocus",{get:function(){return this.currentFocus},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){this.isA11yTable,this.currentFocus&&this.isFocusValid(this.currentFocus)||(this.currentFocus=this.getInitialFocus()),this.updateFocusedItem(),this.currentFocus,this.onFocusChangedHandler&&this.onFocusChangedHandler()},t.prototype.updateMeasureManagers=function(e,t){this.rowHeightMeasureManager=e,this.columnWidthMeasureManager=t},t.prototype.setAsFocusTableEx=function(e,t,i,o){null==e&&b.TablixSection.Body,i===b.TablixSection.Header?this.currentFocus=o?{columnHeader:o}:{columnHeader:[t]}:i===b.TablixSection.Body?this.currentFocus={bodyCell:{rowIndex:e,columnIndex:t}}:i===b.TablixSection.Footer?this.currentFocus={floatingBodyCell:{rowIndex:null!=e?e:0,columnIndex:t}}:i===b.TablixSection.FooterHeader?this.currentFocus={floatingRowHeader:e}:i===b.TablixSection.MatrixCorner?this.currentFocus={cornerCell:{rowLevel:t,columnLevel:e}}:i===b.TablixSection.MatrixRowHeader&&(this.currentFocus=o?{rowHeader:o}:{rowHeader:[e]}),this.updateFocusedItem()},t.prototype.updateFocus=function(){var e,t,i=document.activeElement,o=this.columnNavigator.getHierarchyDepth();this.headerContainer.contains(i)?this.isA11yMatrix?this.setAsFocusTableEx(void 0,void 0,b.TablixSection.Header,r.internal.TableExUtils.getHierarchyIndices(i)):this.setAsFocusTableEx(void 0,r.internal.TableExUtils.getColumnIndex(i),b.TablixSection.Header):this.bodyContainer.contains(i)?this.isA11yMatrix?(e=r.internal.TableExUtils.getTablixRowIndex(i,b.TablixSection.Body,o),t=r.internal.TableExUtils.getTablixColumnIndex(i,this.rowNavigator.getHierarchyDepth()),this.setAsFocusTableEx(e,t,b.TablixSection.Body)):this.setAsFocusTableEx(r.internal.TableExUtils.getRowIndex(i),r.internal.TableExUtils.getColumnIndex(i),b.TablixSection.Body):this.footerBodyContainer.contains(i)?(e=r.internal.TableExUtils.getTablixRowIndex(i,b.TablixSection.Footer,o),this.setAsFocusTableEx(e,r.internal.TableExUtils.getColumnIndex(i),b.TablixSection.Footer)):this.isA11yMatrix?this.rowHeaderContainer.contains(i)||(this.cornerContainer.contains(i)?(t=this.rowNavigator instanceof y.PivotTableSteppedHierarchyNavigator?0:r.internal.TableExUtils.getRowLevel(i),this.setAsFocusTableEx(t,r.internal.TableExUtils.getColumnLevel(i),b.TablixSection.MatrixCorner)):this.footerRowHeaderContainer.contains(i)?(e=r.internal.TableExUtils.getTablixRowIndex(i,b.TablixSection.FooterHeader,o),this.setAsFocusTableEx(e,void 0,b.TablixSection.FooterHeader)):this.setAsFocusTableEx(0,0,b.TablixSection.MatrixCorner)):(t=d3.select(this.headerContainer).select('[role="columnheader"]:not([aria-colindex="1"])').node(),this.setAsFocusTableEx(void 0,r.internal.TableExUtils.getColumnIndex(t),b.TablixSection.Header))},t.prototype.getInitialFocus=function(){this.isA11yTable;var e=this.rowNavigator.getHierarchyLeafCount(),t=this.columnNavigator.getHierarchyLeafCount();return 0<e&&0<t?{bodyCell:{rowIndex:0,columnIndex:0}}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:0,columnLevel:this.columnNavigator.getHierarchyDepth()-1}}:(this.columnNavigator.hasHierarchy(),{columnHeader:[0]})},t.prototype.isFocusValid=function(e){this.isA11yTable;var t,i,o=this.rowNavigator.getHierarchyLeafCount(),r=this.columnNavigator.getHierarchyLeafCount(),n=this.rowNavigator.getFloatingHierarchyLeafCount();return e.bodyCell?(t=e.bodyCell.rowIndex,i=e.bodyCell.columnIndex,0<=t&&t<o&&0<=i&&i<r):e.floatingBodyCell?(t=e.floatingBodyCell.rowIndex,i=e.floatingBodyCell.columnIndex,0<=t&&t<n&&0<=i&&i<r):e.columnHeader?!!this.columnNavigator.getNodeFromPath(e.columnHeader):e.rowHeader?!!this.rowNavigator.getNodeFromPath(e.rowHeader):e.cornerCell?(o=this.rowNavigator.getHierarchyDepth(),t=this.columnNavigator.getHierarchyDepth(),i=e.cornerCell.rowLevel,r=e.cornerCell.columnLevel,0<=i&&i<o&&0<=r&&r<t):e.floatingRowHeader?0<=(i=e.floatingRowHeader)&&i<n:void 0},t.prototype.updateFocusedItem=function(){var e,t;this.currentFocus,this.currentFocus.columnHeader&&-1===this.currentFocus.columnHeader[0]||this.currentFocus.bodyCell&&-1===this.currentFocus.bodyCell.columnIndex||this.currentFocus.floatingBodyCell&&-1===this.currentFocus.floatingBodyCell.columnIndex?this.currentFocus.item=void 0:(this.currentFocus.bodyCell?(e=this.rowNavigator.getHierarchyLeafAt(this.currentFocus.bodyCell.rowIndex),t=this.columnNavigator.getHierarchyLeafAt(this.currentFocus.bodyCell.columnIndex),this.currentFocus.item=this.rowNavigator.getIntersection(e,t)):this.currentFocus.columnHeader?this.currentFocus.item=this.columnNavigator.getNodeFromPath(this.currentFocus.columnHeader):this.currentFocus.rowHeader?this.currentFocus.item=this.rowNavigator.getNodeFromPath(this.currentFocus.rowHeader):this.currentFocus.cornerCell?this.currentFocus.item=this.rowNavigator.getCorner(this.currentFocus.cornerCell.rowLevel,this.currentFocus.cornerCell.columnLevel):this.currentFocus.floatingBodyCell?(e=this.rowNavigator.getFloatingHierarchyLeafAt(this.currentFocus.floatingBodyCell.rowIndex),t=this.columnNavigator.getHierarchyLeafAt(this.currentFocus.floatingBodyCell.columnIndex),this.currentFocus.item=this.rowNavigator.getIntersection(e,t)):void 0!==this.currentFocus.floatingRowHeader&&(this.currentFocus.item=this.rowNavigator.getFloatingHierarchyLeafAt(this.currentFocus.floatingRowHeader)),this.currentFocus)},t.prototype.moveFocus=function(e,t,i,o,r,n){this.currentFocus;var i=!o&&!i,a=this.currentFocus;this.currentFocus.bodyCell?this.currentFocus=i?this.moveBodyCellFocus(e):this.moveBodyCellFocusTableEx(e,t,r,o):this.currentFocus.rowHeader?this.currentFocus=o?this.moveRowHeaderFocusTableEx(e,t,r,n):this.moveRowHeaderFocus(e):this.currentFocus.columnHeader?this.currentFocus=i?this.moveColumnHeaderFocus(e):this.moveColumnHeaderFocusTableEx(e,t,o):this.currentFocus.cornerCell?this.currentFocus=o?this.moveCornerCellFocusTableEx(e,t):this.moveCornerCellFocus(e):void 0!==this.currentFocus.floatingRowHeader?this.currentFocus=o?this.moveFloatingRowHeaderFocusTableEx(e,t):this.moveFloatingRowHeaderFocus(e):this.currentFocus.floatingBodyCell&&(this.currentFocus=i?this.moveFloatingBodyCellFocus(e):this.moveFloatingBodyCellFocusTableEx(e,t)),this.currentFocus,this.updateFocusedItem(),this.onFocusChangedHandler&&this.onFocusChangedHandler(),this.previousFocus=a},t.prototype.moveBodyCellFocusTableEx=function(e,t,i,o){var r=this.currentFocus.bodyCell.rowIndex,n=this.currentFocus.bodyCell.columnIndex,a=0<this.rowNavigator.getFloatingHierarchyLeafCount(),l=-1===n,s=this.rowHeightMeasureManager.getPageRows().length,u=_.last(this.rowHeightMeasureManager.getPageRows()),s=(s-1)*b.PageRowCount+(u.getRowHeights().length-1),u=this.columnWidthMeasureManager.getPageColumns().length,h=_.last(this.columnWidthMeasureManager.getPageColumns()),u=(u-1)*b.PageColumnCount+(h.getColumnWidths().length-1);if(t){if("home"===e)return o?{cornerCell:{rowLevel:0,columnLevel:0}}:{columnHeader:[0]};if("end"===e)return o?this.getBottomRightCell():a?{floatingBodyCell:{rowIndex:0,columnIndex:u}}:{bodyCell:{rowIndex:s,columnIndex:u}};if("up"===e)return o?{columnHeader:[this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(n))[0]]}:l?{bodyCell:{rowIndex:0,columnIndex:n}}:{columnHeader:[n]};if("down"===e)return l||!a?{bodyCell:{rowIndex:s,columnIndex:n}}:{floatingBodyCell:{rowIndex:this.rowNavigator.getFloatingHierarchyLeafCount()-1,columnIndex:n}};if("left"===e)return o?{rowHeader:[this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(r))[0]]}:{bodyCell:{rowIndex:r,columnIndex:0}};if("right"===e)return{bodyCell:{rowIndex:r,columnIndex:u}}}else{if("home"===e)return o?(h=this.rowNavigator.getHierarchyLeafAt(r),t=this.rowNavigator.getLeafAncestorAtLevel(h,0),{rowHeader:this.rowNavigator.getPathIndices(t)}):{bodyCell:{rowIndex:r,columnIndex:0}};if("end"===e)return o?{bodyCell:{rowIndex:r,columnIndex:this.columnWidthMeasureManager.getLastMeasuredIndex()}}:{bodyCell:{rowIndex:r,columnIndex:u}};if("pageup"===e&&i)return{bodyCell:{rowIndex:Math.max(r-i,0),columnIndex:n}};if("pagedown"===e&&i)return{bodyCell:{rowIndex:Math.min(r+i,s),columnIndex:n}};if("up"===e)return r-1<0?l?{bodyCell:{rowIndex:0,columnIndex:n}}:o&&this.columnNavigator.hasHierarchy()?{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(n))}:{columnHeader:[n]}:{bodyCell:{rowIndex:r-1,columnIndex:n}};if("down"===e){if(!(s<r+1))return{bodyCell:{rowIndex:r+1,columnIndex:n}};if(l||!a&&!o)return{bodyCell:{rowIndex:s,columnIndex:n}};if(!o||a)return{floatingBodyCell:{rowIndex:0,columnIndex:n}}}if("left"===e)return o&&0===n?this.rowNavigator.hasHierarchy()?{rowHeader:this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(r))}:{rowHeader:[r]}:{bodyCell:{rowIndex:r,columnIndex:Math.max(n-1,-1)}};if("right"===e)return{bodyCell:{rowIndex:r,columnIndex:Math.min(n+1,u)}}}return this.currentFocus},t.prototype.moveBodyCellFocus=function(e){var t,i=this.rowNavigator.getHierarchyLeafCount(),o=this.columnNavigator.getHierarchyLeafCount(),r=this.rowNavigator.getFloatingHierarchyLeafCount(),n=this.currentFocus.bodyCell.columnIndex,a=this.currentFocus.bodyCell.rowIndex;switch(e){case"left":n--;break;case"right":n++;break;case"up":a--;break;case"down":a++}return 0<=a&&0<=n&&a<i&&n<o?{bodyCell:{rowIndex:a,columnIndex:n}}:a<0?this.columnNavigator.hasHierarchy()?{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(n))}:0<r?{floatingBodyCell:{rowIndex:r-1,columnIndex:n}}:{bodyCell:{rowIndex:i-1,columnIndex:n}}:i<=a?0<r?{floatingBodyCell:{rowIndex:0,columnIndex:n}}:this.columnNavigator.hasHierarchy()?(e=this.columnNavigator.getHierarchyLeafAt(n),t=this.columnNavigator.getLeafAncestorAtLevel(e,0),{columnHeader:this.columnNavigator.getPathIndices(t)}):{bodyCell:{rowIndex:0,columnIndex:n}}:n<0?this.rowNavigator.hasHierarchy()?{rowHeader:this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(a))}:0<a?{bodyCell:{rowIndex:a-1,columnIndex:o-1}}:{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(o-1))}:o<=n?a<i-1?(e=a+1,this.rowNavigator.hasHierarchy()?(o=this.rowNavigator.getHierarchyLeafAt(e),t=this.rowNavigator.getLeafAncestorAtLevel(o,0),{rowHeader:this.rowNavigator.getPathIndices(t)}):{bodyCell:{rowIndex:e,columnIndex:0}}):0<r?{floatingRowHeader:0}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:this.rowNavigator.getHierarchyDepth()-1,columnLevel:0}}:{columnHeader:[0]}:void 0},t.prototype.moveRowHeaderFocusTableEx=function(e,t,i,o){var r=this.columnWidthMeasureManager.getLastMeasuredIndex(),n=this.columnNavigator.getHierarchyDepth(),a=this.currentFocus.rowHeader,l=this.rowNavigator.getNodeFromPath(a),s=this.rowNavigator instanceof y.PivotTableSteppedHierarchyNavigator?0:this.rowNavigator.getLevel(l),u=this.rowNavigator.getItemsByLevel(s),h=u.indexOf(l),d=0<this.rowNavigator.getFloatingHierarchyLeafCount();if(!l)return this.getInitialFocus();if(t){if("home"===e)return{cornerCell:{rowLevel:0,columnLevel:0}};if("end"===e)return this.getBottomRightCell();if("up"===e)return{cornerCell:{rowLevel:s,columnLevel:0}};if("down"===e)return this.getBottomFooterHeaderCell(s)}else{if("left"===e&&1<a.length)return{rowHeader:_.dropRight(a,1)};if("right"===e){if(null!=(c=this.previousFocus)&&c.rowHeader&&_.isEqual(_.dropRight(this.previousFocus.rowHeader,1),this.currentFocus.rowHeader))return this.previousFocus;var c=this.rowNavigator.getLeafIndex(l);if(void 0===c)return{rowHeader:__spreadArray(__spreadArray([],a||[],!0),[0],!1)};if(-1<r)return{bodyCell:{rowIndex:c,columnIndex:0}}}if("up"===e)return 0<h?{rowHeader:this.rowNavigator.getPathIndices(u[h-1])}:{cornerCell:{rowLevel:s,columnLevel:n-1}};if("down"===e){if(h<u.length-1)return{rowHeader:this.rowNavigator.getPathIndices(u[h+1])};if(d)return{floatingRowHeader:0}}if("pagedown"===e)return c=this.rowHeightMeasureManager.getLastMeasuredIndex(),g=b.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(this.currentFocus.item,this.rowNavigator),m=Math.min(g+i,c),f=this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(m)),this.rowNavigator.isLeaf(l)||this.rowNavigator instanceof y.PivotTableSteppedHierarchyNavigator?{rowHeader:f}:(p=_.take(f,Math.min(this.currentFocus.rowHeader.length,f.length-1)),_.isEqual(p,this.currentFocus.rowHeader)&&h<u.length-1?{rowHeader:this.rowNavigator.getPathIndices(u[h+1])}:{rowHeader:p});if("pageup"===e){var p,g=b.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(this.currentFocus.item,this.rowNavigator),m=Math.max(g-i,0),f=this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(m));if((p=_.dropRight(f,f.length-s-1))!==this.currentFocus.rowHeader)return{rowHeader:p}}}return 1<a.length&&(t&&"left"===e||"home"===e)?{rowHeader:[a[0]]}:t&&"right"===e||"end"===e?{bodyCell:{rowIndex:b.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(l,this.rowNavigator),columnIndex:r}}:this.currentFocus},t.prototype.moveRowHeaderFocus=function(e){var t,i=this.rowNavigator.getHierarchyLeafCount(),o=this.columnNavigator.getHierarchyLeafCount(),r=this.rowNavigator.getFloatingHierarchyLeafCount(),n=this.rowNavigator.getHierarchyDepth(),a=this.columnNavigator.getHierarchyDepth(),l=this.currentFocus.rowHeader,s=this.rowNavigator.getNodeFromPath(l),u=l.length-1;return s?"left"===e?1<l.length?{rowHeader:_.dropRight(l,1)}:0<l[0]?(t=b.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(s,this.rowNavigator)-1,0<o?{bodyCell:{rowIndex:t,columnIndex:o-1}}:{rowHeader:this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(t))}):0<o?{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(o-1))}:{cornerCell:{rowLevel:n-1,columnLevel:0}}:"right"===e?void 0===(t=this.rowNavigator.getLeafIndex(s))?{rowHeader:__spreadArray(__spreadArray([],l||[],!0),[0],!1)}:0<o?{bodyCell:{rowIndex:t,columnIndex:0}}:t<i-1?(n=this.rowNavigator.getLeafAncestorAtLevel(this.rowNavigator.getHierarchyLeafAt(t+1),0),{rowHeader:this.rowNavigator.getPathIndices(n)}):0<r?{floatingRowHeader:0}:{cornerCell:{rowLevel:0,columnLevel:a-1}}:(o=(l=this.rowNavigator.getItemsByLevel(u)).indexOf(s),"up"===e?0<o?{rowHeader:this.rowNavigator.getPathIndices(l[o-1])}:{cornerCell:{rowLevel:u,columnLevel:a-1}}:"down"===e?o<l.length-1?{rowHeader:this.rowNavigator.getPathIndices(l[o+1])}:0<r?{floatingRowHeader:0}:{cornerCell:{rowLevel:u,columnLevel:a-1}}:void 0):this.getInitialFocus()},t.prototype.moveColumnHeaderFocusTableEx=function(e,t,i){var o=this.currentFocus.columnHeader[0],r=0<this.rowNavigator.getFloatingHierarchyLeafCount(),n=this.rowHeightMeasureManager.getPageRows().length,a=_.last(this.rowHeightMeasureManager.getPageRows()),n=a?(n-1)*b.PageRowCount+(a.getRowHeights().length-1):-1,a=this.columnWidthMeasureManager.getPageColumns().length,l=_.last(this.columnWidthMeasureManager.getPageColumns()),a=(a-1)*b.PageColumnCount+(l.getColumnWidths().length-1),l=this.currentFocus.columnHeader,s=this.columnNavigator.getNodeFromPath(l),u=this.columnNavigator.getLevel(s),h=this.rowNavigator.getHierarchyDepth();if(t){if("home"===e)return i?{cornerCell:{rowLevel:0,columnLevel:0}}:{columnHeader:[0]};if("end"===e){if(i)return this.getBottomRightCell();if(r)return{floatingBodyCell:{rowIndex:0,columnIndex:a}};if(-1!=n)return{bodyCell:{rowIndex:n,columnIndex:a}}}if("down"===e)return d=this.columnNavigator.hasHierarchy?this.getFirstColumnLeafFromAncestor(s):o,this.getBottomFooterBodyCell(d,n);if("up"===e)return{columnHeader:[l[0]]}}else{if("up"===e&&i&&this.columnNavigator.hasHierarchy()&&1<l.length)return{columnHeader:_.dropRight(l,1)};if("down"===e){if(i){if(null!=(d=this.previousFocus)&&d.columnHeader&&_.isEqual(_.dropRight(this.previousFocus.columnHeader,1),this.currentFocus.columnHeader))return this.previousFocus;l=this.columnNavigator.getLeafIndex(s);if(!this.columnNavigator.isLeaf(s))return{columnHeader:__spreadArray(__spreadArray([],this.currentFocus.columnHeader,!0),[0],!1)};if(0<=n)return{bodyCell:{rowIndex:0,columnIndex:l}};if(r)return{floatingBodyCell:{rowIndex:0,columnIndex:l}}}if(-1!=n)return{bodyCell:{rowIndex:0,columnIndex:o}}}var d=this.columnNavigator.getItemsByLevel(u),r=d.indexOf(s);if("left"===e){if(i){if(0<r)return{columnHeader:this.columnNavigator.getPathIndices(d[r-1])};if(this.rowNavigator.hasHierarchy())return{cornerCell:{rowLevel:h-1,columnLevel:u}}}return{columnHeader:[Math.max(o-1,0)]}}if("right"===e)return i&&-1!==r?{columnHeader:this.columnNavigator.getPathIndices(d[Math.min(r+1,d.length-1)])}:{columnHeader:[Math.min(o+1,a)]}}return"home"===e||t&&"left"===e?i?{cornerCell:{rowLevel:0,columnLevel:u}}:{columnHeader:[0]}:"end"===e||t&&"right"===e?i?this.getLastMatrixColumnCell(this.currentFocus.columnHeader.length-1):{columnHeader:[a]}:this.currentFocus},t.prototype.moveColumnHeaderFocus=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),i=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount(),r=this.rowNavigator.getHierarchyDepth(),n=this.columnNavigator.getHierarchyDepth(),a=this.currentFocus.columnHeader,l=this.columnNavigator.getNodeFromPath(a),s=this.columnNavigator.getLevel(l);if(!l)return this.getInitialFocus();if("up"===e){if(1<a.length)return{columnHeader:_.dropRight(a,1)};var u=b.PivotTableHierarchyNavigator.getFirstVisualLeafIndex(l,this.columnNavigator);if(0<o)return{floatingBodyCell:{rowIndex:o-1,columnIndex:u}};if(0<t)return{bodyCell:{rowIndex:t-1,columnIndex:u}}}return"down"===e?void 0===(u=this.columnNavigator.getLeafIndex(l))?{columnHeader:__spreadArray(__spreadArray([],a||[],!0),[0],!1)}:0<t?{bodyCell:{rowIndex:0,columnIndex:u}}:0<o?{floatingBodyCell:{rowIndex:0,columnIndex:u}}:(a=this.columnNavigator.getLeafAncestorAtLevel(l,0),{columnHeader:this.columnNavigator.getPathIndices(a)}):(a=(u=this.columnNavigator.getItemsByLevel(s)).indexOf(l),"left"===e?0<a?{columnHeader:this.columnNavigator.getPathIndices(u[a-1])}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:r-1,columnLevel:s}}:0<s?{columnHeader:this.columnNavigator.getPathIndices(_.last(this.columnNavigator.getItemsByLevel(s-1)))}:0<o?{floatingBodyCell:{rowIndex:o-1,columnIndex:i-1}}:0<t?{bodyCell:{rowIndex:t-1,columnIndex:i-1}}:{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getHierarchyLeafAt(i-1))}:"right"===e?a<u.length-1?{columnHeader:this.columnNavigator.getPathIndices(u[a+1])}:s<n-1?this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:r-1,columnLevel:s+1}}:{columnHeader:this.columnNavigator.getPathIndices(this.columnNavigator.getItemsByLevel(s+1)[0])}:0<t?this.rowNavigator.hasHierarchy()?{rowHeader:[0]}:{bodyCell:{rowIndex:0,columnIndex:0}}:0<o?this.rowNavigator.hasHierarchy()?{floatingRowHeader:0}:{floatingBodyCell:{rowIndex:0,columnIndex:0}}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:1===n?0:r-1,columnLevel:0}}:{columnHeader:[0]}:void 0)},t.prototype.moveCornerCellFocus=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),i=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount(),r=this.rowNavigator.getHierarchyDepth(),n=this.columnNavigator.getHierarchyDepth(),a=this.currentFocus.cornerCell.rowLevel,l=this.currentFocus.cornerCell.columnLevel,s=this.rowNavigator.getItemsByLevel(a),u=this.columnNavigator.getItemsByLevel(l);return"up"===e?a===r-1&&0<l?{cornerCell:{rowLevel:a,columnLevel:l-1}}:0<o?{floatingRowHeader:o-1}:0<t?{rowHeader:this.rowNavigator.getPathIndices(_.last(s))}:{cornerCell:{rowLevel:a,columnLevel:n-1}}:"down"===e?a===r-1&&l<n-1?{cornerCell:{rowLevel:a,columnLevel:l+1}}:0<t?{rowHeader:this.rowNavigator.getPathIndices(s[0])}:0<o?{floatingRowHeader:0}:{cornerCell:{rowLevel:a,columnLevel:a===r-1?0:n-1}}:"right"===e?_.isEmpty(u)?l<n-1?{cornerCell:{rowLevel:a===r-1?0:r-1,columnLevel:l+1}}:0<t?{rowHeader:[0]}:{cornerCell:{rowLevel:1===n?0:r-1,columnLevel:0}}:{columnHeader:this.columnNavigator.getPathIndices(u[0])}:"left"===e?0<a&&l===n-1?{cornerCell:{rowLevel:a-1,columnLevel:l}}:0<l?(s=l-1,0<i?{columnHeader:this.columnNavigator.getPathIndices(_.last(this.columnNavigator.getItemsByLevel(s)))}:{cornerCell:{rowLevel:r-1,columnLevel:s}}):0<o&&0<i?{floatingBodyCell:{rowIndex:o-1,columnIndex:i-1}}:0<t&&0<i?{bodyCell:{rowIndex:t-1,columnIndex:i-1}}:0<t?{rowHeader:this.rowNavigator.getPathIndices(this.rowNavigator.getHierarchyLeafAt(t-1))}:{cornerCell:{rowLevel:r-1,columnLevel:n-1}}:void 0},t.prototype.moveCornerCellFocusTableEx=function(e,t){var i=this.currentFocus.cornerCell.rowLevel,o=this.currentFocus.cornerCell.columnLevel,r=this.rowNavigator.getItemsByLevel(i),n=this.columnNavigator.getItemsByLevel(o),a=this.rowNavigator.getHierarchyLeafCount(),l=this.rowNavigator.getHierarchyDepth(),s=this.columnNavigator.getHierarchyDepth(),u=0<this.rowNavigator.getFloatingHierarchyLeafCount();if(t){if("home"===e)return{cornerCell:{rowLevel:0,columnLevel:0}};if("end"===e)return this.getBottomRightCell();if("up"===e)return{cornerCell:{rowLevel:i,columnLevel:0}};if("down"===e)return this.getBottomFooterHeaderCell(i)}else{if("up"===e&&0<o)return{cornerCell:{rowLevel:i,columnLevel:o-1}};if("down"===e){if(o<s-1)return{cornerCell:{rowLevel:i,columnLevel:o+1}};if(0<a)return{rowHeader:this.rowNavigator.getPathIndices(r[0])};if(u)return{floatingRowHeader:0}}if("right"===e){if(i<l-1)return{cornerCell:{rowLevel:i+1,columnLevel:o}};if(!_.isEmpty(n))return{columnHeader:this.columnNavigator.getPathIndices(n[0])}}if("left"===e&&0<i)return{cornerCell:{rowLevel:i-1,columnLevel:o}}}return 0<i&&("home"===e||t&&"left"===e)?{cornerCell:{rowLevel:0,columnLevel:o}}:"end"===e||t&&"right"===e?this.getLastMatrixColumnCell(this.currentFocus.cornerCell.columnLevel):this.currentFocus},t.prototype.moveFloatingRowHeaderFocusTableEx=function(e,t){var i=this.rowNavigator.getHierarchyLeafCount(),o=this.columnWidthMeasureManager.getLastMeasuredIndex(),r=this.columnNavigator.getHierarchyDepth(),n=this.currentFocus.floatingRowHeader;if(t){if("home"===e||"up"===e)return{cornerCell:{rowLevel:0,columnLevel:0}};if("end"===e)return this.getBottomRightCell();if("down"===e&&n<this.rowNavigator.getFloatingHierarchyLeafCount()-1)return{floatingRowHeader:this.rowNavigator.getFloatingHierarchyLeafCount()-1}}else{if("right"===e)return{floatingBodyCell:{rowIndex:n,columnIndex:0}};if("up"===e)return 0<n?{floatingRowHeader:n-1}:0<i?{rowHeader:[this.rowNavigator.getItemsByLevel(0).length-1]}:{cornerCell:{rowLevel:0,columnLevel:r-1}};if("down"===e&&n<this.rowNavigator.getFloatingHierarchyLeafCount()-1)return{floatingRowHeader:n+1}}return t&&"right"===e||"end"===e?{floatingBodyCell:{rowIndex:n,columnIndex:o}}:this.currentFocus},t.prototype.moveFloatingRowHeaderFocus=function(e){var t=this.rowNavigator.getHierarchyLeafCount(),i=this.columnNavigator.getHierarchyLeafCount(),o=this.rowNavigator.getFloatingHierarchyLeafCount(),r=this.rowNavigator.getHierarchyDepth(),n=this.columnNavigator.getHierarchyDepth(),a=this.currentFocus.floatingRowHeader;return"left"===e?0<a?{floatingBodyCell:{rowIndex:a-1,columnIndex:i-1}}:0<t?{bodyCell:{rowIndex:t-1,columnIndex:i-1}}:(i=this.columnNavigator.getHierarchyLeafAt(i-1),{columnHeader:this.columnNavigator.getPathIndices(i)}):"right"===e?{floatingBodyCell:{rowIndex:a,columnIndex:0}}:"up"===e?0<a?{floatingRowHeader:a-1}:0<t?{rowHeader:[this.rowNavigator.getItemsByLevel(0).length-1]}:{cornerCell:{rowLevel:0,columnLevel:n-1}}:"down"===e?a<o-1?{floatingRowHeader:a+1}:{cornerCell:{rowLevel:0,columnLevel:1===r?0:n-1}}:void 0},t.prototype.moveFloatingBodyCellFocusTableEx=function(e,t){var i,o=this.currentFocus.floatingBodyCell.columnIndex,r=this.currentFocus.floatingBodyCell.rowIndex,n=-1===o,a=this.rowHeightMeasureManager.getPageRows().length,l=_.last(this.rowHeightMeasureManager.getPageRows()),a=l?(a-1)*b.PageRowCount+(l.getRowHeights().length-1):-1,l=this.columnWidthMeasureManager.getPageColumns().length,s=_.last(this.columnWidthMeasureManager.getPageColumns()),l=(l-1)*b.PageColumnCount+(s.getColumnWidths().length-1);if(t){if("home"===e)return this.isA11yMatrix?{cornerCell:{rowLevel:0,columnLevel:0}}:{columnHeader:[0]};if("end"===e)return this.isA11yMatrix?this.getBottomRightCell():{floatingBodyCell:{rowIndex:0,columnIndex:l}};if("up"===e)return this.isA11yMatrix?(i=this.columnNavigator.getLeafAncestorAtLevel(this.columnNavigator.getHierarchyLeafAt(o),0),{columnHeader:[this.columnNavigator.getIndex(i)]}):n?{bodyCell:{rowIndex:0,columnIndex:o}}:{columnHeader:[o]};if("down"===e)return{floatingBodyCell:{rowIndex:this.rowNavigator.getFloatingHierarchyLeafCount()-1,columnIndex:o}};if("left"===e)return this.isA11yMatrix?{floatingRowHeader:r}:{floatingBodyCell:{rowIndex:0,columnIndex:0}};if("right"===e)return{floatingBodyCell:{rowIndex:r,columnIndex:l}}}else{if("home"===e)return this.isA11yMatrix?{floatingRowHeader:r}:{floatingBodyCell:{rowIndex:0,columnIndex:0}};if("end"===e)return{floatingBodyCell:{rowIndex:0,columnIndex:l}};if("up"===e)return 0===r?0<=a?{bodyCell:{rowIndex:a,columnIndex:o}}:(i=this.columnNavigator.getLeafAncestorAtLevel(this.columnNavigator.getHierarchyLeafAt(o),0),{columnHeader:[this.columnNavigator.getIndex(i)]}):{floatingBodyCell:{rowIndex:r-1,columnIndex:o}};if("down"===e&&r<this.rowNavigator.getFloatingHierarchyLeafCount()-1)return{floatingBodyCell:{rowIndex:r+1,columnIndex:o}};if("left"===e)return 0===o&&this.isA11yMatrix?{floatingRowHeader:r}:{floatingBodyCell:{rowIndex:r,columnIndex:Math.max(o-1,0)}};if("right"===e)return{floatingBodyCell:{rowIndex:r,columnIndex:Math.min(o+1,l)}}}return this.currentFocus},t.prototype.moveFloatingBodyCellFocus=function(e){var t,i=this.rowNavigator.getHierarchyLeafCount(),o=this.columnNavigator.getHierarchyLeafCount(),r=this.rowNavigator.getFloatingHierarchyLeafCount(),n=this.rowNavigator.getHierarchyDepth(),a=this.columnNavigator.getHierarchyDepth(),l=this.currentFocus.floatingBodyCell.columnIndex,s=this.currentFocus.floatingBodyCell.rowIndex;switch(e){case"left":l--;break;case"right":l++;break;case"up":s--;break;case"down":s++}return 0<=s&&0<=l&&s<r&&l<o?{floatingBodyCell:{rowIndex:s,columnIndex:l}}:s<0?0<i?{bodyCell:{rowIndex:i-1,columnIndex:l}}:(t=this.columnNavigator.getHierarchyLeafAt(l),{columnHeader:this.columnNavigator.getPathIndices(t)}):r<=s?(t=this.columnNavigator.getHierarchyLeafAt(l),e=this.columnNavigator.getLeafAncestorAtLevel(t,0),{columnHeader:this.columnNavigator.getPathIndices(e)}):l<0?{floatingRowHeader:s}:o<=l?s<r-1?{floatingRowHeader:s+1}:this.rowNavigator.hasHierarchy()?{cornerCell:{rowLevel:0,columnLevel:1===n?0:a-1}}:{columnHeader:[0]}:void 0},t.prototype.getBottomRightCell=function(){var e=this.rowNavigator.getFloatingHierarchyLeafCount(),t=this.columnWidthMeasureManager.getLastMeasuredIndex(),i=this.rowNavigator.getHierarchyLeafCount()-1;return 0<e?{floatingBodyCell:{rowIndex:e-1,columnIndex:t}}:{bodyCell:{rowIndex:i,columnIndex:t}}},t.prototype.getLastMatrixColumnCell=function(e){var t=this.columnNavigator.getHierarchyLeafCount(),t=this.columnNavigator.getHierarchyLeafAt(t-1),t=this.columnNavigator.getPathIndices(t);return{columnHeader:_.dropRight(t,t.length-(e+1))}},t.prototype.getFirstColumnLeafFromAncestor=function(e){return this.columnNavigator.isLeaf(e)?this.columnNavigator.getLeafIndex(e):this.getFirstColumnLeafFromAncestor(this.columnNavigator.getChildren(e)[0])},t.prototype.getBottomFooterBodyCell=function(e,t){var i=0<this.rowNavigator.getFloatingHierarchyLeafCount();return-1===e||!i?-1===t?this.currentFocus:{bodyCell:{rowIndex:t,columnIndex:e}}:{floatingBodyCell:{rowIndex:this.rowNavigator.getFloatingHierarchyLeafCount()-1,columnIndex:e}}},t.prototype.getBottomFooterHeaderCell=function(e){e=this.rowNavigator.getItemsByLevel(e);return 0<this.rowNavigator.getFloatingHierarchyLeafCount()?{floatingRowHeader:this.rowNavigator.getFloatingHierarchyLeafCount()-1}:{rowHeader:this.rowNavigator.getPathIndices(e[e.length-1])}},b.PivotTableFocusManager=t}(powerbi=powerbi||{}),function(e){var o,r=e.visuals||(e.visuals={}),n=r.controls||(r.controls={}),a="unselectable";function i(e,t){if(e)for(var i=0,o=e;i<o.length;i++)(0,o[i])(t)}n.fire=i,Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),t.prototype.createView=function(){var e="http://www.w3.org/2000/svg",e=(this._polygon=document.createElementNS(e,"polygon"),this._polygon.setAttributeNS(null,"points","3,3 6,3 13,8 6,13 3,13 10,8"),this._polygon.setAttributeNS(null,"fill",t.ARROW_COLOR),this._svg=document.createElementNS(e,"svg"),this._svg.style);e.position="absolute",e.left="0px",e.top="0px",this._svg.appendChild(this._polygon),this._element=document.createElement("div"),this._element.className=u.arrowClassName,this._element.appendChild(this._svg),this._owner.element.appendChild(this._element)},t.prototype.onMouseDown=function(e){var t,i=this;clearTimeout(this._timerHandle),this._mouseUpWrapper||(e.cancelBubble=!0,(t=this)._mouseUpWrapper=function(e){t.onMouseUp(e)},u.addDocumentMouseUpEvent(this._mouseUpWrapper)),this._owner._scrollSmallIncrement(this._direction),this._owner.refresh(),this._timerHandle=setTimeout(function(){i.onMouseDown(e)},100),e.preventDefault&&e.preventDefault()},t.prototype.onMouseUp=function(e){clearTimeout(this._timerHandle),u.removeDocumentMouseUpEvent(this._mouseUpWrapper),this._mouseUpWrapper=void 0},t.prototype.arrange=function(e,t,i){var o=Math.min(e,t);this._polygon.setAttributeNS(null,"transform","translate("+(e-o)/2+", "+(t-o)/2+") scale("+o/16+") rotate("+i+",8,8)"),this._svg.setAttributeNS(null,"width",e+"px"),this._svg.setAttributeNS(null,"height",t+"px"),n.HTMLElementUtils.setElementWidth(this._element,e),n.HTMLElementUtils.setElementHeight(this._element,t)},t.MIN_WIDTH=26,t.ARROW_COLOR="#404040";var l=t;function t(e,t){this._owner=e,this._direction=t,this._timerHandle=void 0,this.createView();var i=this;this._element.addEventListener("mousedown",function(e){i.onMouseDown(e)}),$(this._element).addClass(a),$(this._svg).addClass(a),$(this._polygon).addClass(a)}n.ScrollbarButton=l,h.prototype.scrollBy=function(e,t){this.scrollTo(this.viewMin+e,t)},h.prototype.scrollUp=function(){this.scrollBy(-this.smallIncrement)},h.prototype.scrollDown=function(){this.scrollBy(this.smallIncrement)},h.prototype.scrollPageUp=function(){this.scrollBy(-this.viewSize)},h.prototype.scrollPageDown=function(){this.scrollBy(this.viewSize)},Object.defineProperty(h.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this._element.style.width=e,this.invalidateArrange()},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e,this._element.style.height=e,this.invalidateArrange()},enumerable:!1,configurable:!0}),h.prototype.refresh=function(){},Object.defineProperty(h.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"maxButton",{get:function(){return this._maxButton},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"middleBar",{get:function(){return this._middleBar},enumerable:!1,configurable:!0}),h.prototype._scrollSmallIncrement=function(e){this.scrollBy(this.smallIncrement*e)},Object.defineProperty(h.prototype,"visible",{get:function(){return this._visible},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isInMouseCapture",{get:function(){return void 0!==this._timerHandle},enumerable:!1,configurable:!0}),h.prototype.show=function(e){this._visible=e,this.element.style.visibility=e?"visible":"hidden",this.invalidateArrange()},h.prototype._getMouseOffset=function(e){return void 0!==e.offsetX?{x:e.offsetX,y:e.offsetY}:void 0!==e.layerX?{x:e.layerX,y:e.layerY}:{x:e.screenX,y:e.screenY}},h.prototype._getOffsetXDelta=function(e){return(e.screenX-this._screenPrevMousePos.x)/this._screenToOffsetScale},h.prototype._getOffsetYDelta=function(e){return(e.screenY-this._screenPrevMousePos.y)/this._screenToOffsetScale},h.prototype._getOffsetXTouchDelta=function(e){return this._getMouseOffset(e).x-this._offsetTouchPrevPos.x},h.prototype._getOffsetYTouchDelta=function(e){return this._getMouseOffset(e).y-this._offsetTouchPrevPos.y},h.prototype.onTouchStart=function(e){1===e.touches.length&&this.onTouchMouseDown(e.touches[0])},h.prototype.onTouchMove=function(e){1===e.touches.length&&(e.preventDefault&&e.preventDefault(),this.onTouchMouseMove(e.touches[0]))},h.prototype.onTouchEnd=function(e){this.onTouchMouseUp(1===e.touches.length?e.touches[0]:e,!0)},h.prototype.onTouchMouseDown=function(e){!this._allowMouseDrag&&e.pointerType===MSPointerEvent.MSPOINTER_TYPE_MOUSE||(this._offsetTouchPrevPos=this._offsetTouchStartPos=null,this._touchStarted=!0)},h.prototype._getOffsetTouchDelta=function(e){return null},h.prototype.onTouchMouseMove=function(e){var t;this._touchStarted&&(this._offsetTouchStartPos||(this._offsetTouchPrevPos=this._offsetTouchStartPos=this._getMouseOffset(e)),0!==(t=this._getOffsetTouchDelta(e))&&(this.scrollBy(-t/this._getRunningSize(!1)*this.viewSize),this._offsetTouchPrevPos=this._getMouseOffset(e)),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0)},h.prototype.onTouchMouseUp=function(e,t){var i;this._touchStarted&&this._offsetTouchStartPos&&(i=this._getMouseOffset(e),!t)&&(3<Math.abs(this._offsetTouchStartPos.x-i.x)||3<Math.abs(this._offsetTouchStartPos.y-i.y))&&(e.preventDefault&&e.preventDefault(),e.cancelBubble=!0),this._touchStarted=!1},h.prototype.createView=function(e,t){this._element=document.createElement("div"),this._element.className=h.className,this._element.setAttribute("drag-resize-disabled","true"),this._element.style.zIndex="2",this.isModern&&(this._element.style.setProperty("--background","white"),this._element.style.borderRadius=Math.ceil(n.pivotTable.ScrollbarWidth/2)+"px",this._element.style.setProperty("--opacity",".5"),this._element.style.setProperty("--opacity-hover",".6")),0===t&&e.appendChild(this._element),this.isModern||(this._minButton=new l(this,-1),this._maxButton=new l(this,1)),this._middleBar=document.createElement("div"),this._middleBar.className=h.barClassName,this.isModern&&(this._middleBar.style.setProperty("--bar-color","#605E5C"),this._middleBar.style.setProperty("--bar-color-hover","#605E5C"),this._middleBar.style.borderRadius=Math.ceil(n.pivotTable.ScrollbarWidth/2)+"px",this._middleBar.style.border="1px solid white",this._middleBar.style.boxSizing="border-box"),this._element.appendChild(this._middleBar)},h.prototype.scrollTo=function(e,t){e=Math.min(this.max-this.viewSize,Math.max(this.min,e));(e=Math.max(this.min,e))!==this.viewMin&&(this.viewMin=e,t||i(this._onscroll,null))},h.prototype._scrollByPage=function(e){},h.prototype._getRunningSize=function(e){return null},h.prototype._getOffsetDelta=function(e){return null},h.prototype.scroll=function(e){var t=this._getOffsetDelta(e)/this._getRunningSize(!0)*(this.max-this.min);if(t<0){if(this._getScreenMousePos(e)>=this._screenMaxMousePos)return}else if(0<t&&this._getScreenMousePos(e)<=this._screenMinMousePos)return;this.scrollBy(t)},Object.defineProperty(h.prototype,"actualWidth",{get:function(){return void 0===this._actualWidth&&this.arrange(),this._actualWidth},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"actualHeight",{get:function(){return void 0===this._actualHeight&&this.arrange(),this._actualHeight},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"actualButtonWidth",{get:function(){return this.isModern?-1:(this._actualButtonWidth,this._actualButtonWidth)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"actualButtonHeight",{get:function(){return this.isModern?-1:(this._actualButtonHeight,this._actualButtonHeight)},enumerable:!1,configurable:!0}),h.prototype.arrange=function(){this._actualWidth&&this._actualHeight||(this._actualWidth=this._element.offsetWidth,this._actualHeight=this._element.offsetHeight,this._actualButtonWidth=-1,this._actualButtonHeight=-1,this.isModern)||(this._actualButtonWidth=this._calculateButtonWidth(),this._actualButtonHeight=this._calculateButtonHeight(),this._minButton.arrange(this._actualButtonWidth,this._actualButtonHeight,this._getMinButtonAngle()),this._maxButton.arrange(this._actualButtonWidth,this._actualButtonHeight,this._getMaxButtonAngle()),this._setMaxButtonPosition())},h.prototype._calculateButtonWidth=function(){return null},h.prototype._calculateButtonHeight=function(){return null},h.prototype._getMinButtonAngle=function(){return null},h.prototype._getMaxButtonAngle=function(){return null},h.prototype._setMaxButtonPosition=function(){},h.prototype.invalidateArrange=function(){this._actualWidth=void 0,this._actualHeight=void 0,this._actualButtonWidth=void 0,this._actualButtonHeight=void 0},h.prototype.onHoldBackgroundMouseDown=function(e){var t=this,i=this._timerHandle?h.ScrollbarBackgroundMousedownHoldDelay:h.ScrollbarBackgroundFirstTimeMousedownHoldDelay;this._timerHandle=setTimeout(function(){t.onBackgroundMouseDown(e)},i)},h.prototype.onBackgroundMouseDown=function(e){var t=this;clearTimeout(this._timerHandle),this._backgroundMouseUpWrapper||(e.cancelBubble=!0,this._backgroundMouseUpWrapper=function(e){t.onBackgroundMouseUp(e)},h.addDocumentMouseUpEvent(this._backgroundMouseUpWrapper)),this._scrollByPage(e),this.refresh(),this.onHoldBackgroundMouseDown(e),e.preventDefault&&e.preventDefault()},h.prototype.onBackgroundMouseUp=function(e){clearTimeout(this._timerHandle),this._timerHandle=void 0,h.removeDocumentMouseUpEvent(this._backgroundMouseUpWrapper),this._backgroundMouseUpWrapper=void 0},h.prototype.getPinchZoomY=function(){return document.documentElement.clientHeight/window.innerHeight},h.prototype.onMiddleBarMouseDown=function(e){e.cancelBubble=!0,this._screenPrevMousePos={x:e.screenX,y:e.screenY},this.isModern?(this._screenMinMousePos=this._getScreenMousePos(e)-(this._getScreenContextualLeft(this._middleBar)-this._getScreenContextualLeft(this.element)),this._screenMaxMousePos=this._getScreenMousePos(e)+(this._getScreenContextualRight(this.element)-this._getScreenContextualRight(this._middleBar))):(this._screenMinMousePos=this._getScreenMousePos(e)-(this._getScreenContextualLeft(this._middleBar)-this._getScreenContextualRight(this._minButton.element)),this._screenMaxMousePos=this._getScreenMousePos(e)+(this._getScreenContextualLeft(this._maxButton.element)-this._getScreenContextualRight(this._middleBar))),this._screenToOffsetScale=n.HTMLElementUtils.getAccumulatedScale(this.element)*this.getPinchZoomY();var t=this;this._middleBarMouseMoveWrapper=function(e){t.onMiddleBarMouseMove(e)},h.addDocumentMouseMoveEvent(this._middleBarMouseMoveWrapper),this._middleBarMouseUpWrapper=function(e){t.onMiddleBarMouseUp(e)},h.addDocumentMouseUpEvent(this._middleBarMouseUpWrapper),e.preventDefault&&e.preventDefault()},h.prototype.onMiddleBarMouseMove=function(e){this._screenPrevMousePos&&(this.scroll(e),this.refresh(),this._screenPrevMousePos={x:e.screenX,y:e.screenY})},h.prototype.onMiddleBarMouseUp=function(e){this._screenPrevMousePos=void 0,h.removeDocumentMouseMoveEvent(this._middleBarMouseMoveWrapper),this._middleBarMouseMoveWrapper=void 0,h.removeDocumentMouseUpEvent(this._middleBarMouseUpWrapper),this._middleBarMouseUpWrapper=void 0,e.preventDefault&&e.preventDefault()},h.prototype._getScreenContextualLeft=function(e){return null},h.prototype._getScreenContextualRight=function(e){return null},h.prototype.onMouseWheel=function(e){e&&this.mouseWheel(e)},h.prototype.mouseWheel=function(e){this.visible&&(e<0?e=Math.min(-h.MouseWheelRange,e):0<e&&(e=Math.max(h.MouseWheelRange,e)),this.scrollBy(-e/h.MouseWheelRange*this.smallIncrement))},h.prototype._getScreenMousePos=function(e){return null},h.addDocumentMouseUpEvent=function(e){document.addEventListener("mouseup",e)},h.removeDocumentMouseUpEvent=function(e){document.removeEventListener("mouseup",e)},h.addDocumentMouseMoveEvent=function(e){document.addEventListener("mousemove",e)},h.removeDocumentMouseMoveEvent=function(e){document.removeEventListener("mousemove",e)},h.DefaultScrollbarWidth="15px",h.ScrollbarBackgroundFirstTimeMousedownHoldDelay=500,h.ScrollbarBackgroundMousedownHoldDelay=50,h.MouseWheelRange=120,h.className="scroll-bar-div",h.barClassName="scroll-bar-part-bar",h.arrowClassName="scroll-bar-part-arrow";var s,u=h;function h(e,t,i){this.isModern=i,this.MIN_BAR_SIZE=10,this.min=0,this.max=10,this.viewMin=0,this.viewSize=2,this.smallIncrement=1,this._onscroll=[],this._screenToOffsetScale=1,this.createView(e,t);var o=this;this._element.addEventListener("mousedown",function(e){o.onBackgroundMouseDown(e)}),this._element.addEventListener("dblclick",function(e){r.EventBubblingUtil.markAsHandled(e)}),this._middleBar.addEventListener("mousedown",function(e){o.onMiddleBarMouseDown(e)}),this._timerHandle=void 0,this._visible=!0,this.element.winControl=this,$(this._touchPanel).addClass(a)}function d(e,t,i){e=s.call(this,e,t,i)||this;return e.height=u.DefaultScrollbarWidth,e}function c(e,t,i){e=o.call(this,e,t,i)||this;return e.width=u.DefaultScrollbarWidth,e}n.Scrollbar=u,__extends(d,s=u),d.prototype._calculateButtonWidth=function(){return Math.min(this.actualWidth/2,Math.max(this.actualHeight,l.MIN_WIDTH))},d.prototype._calculateButtonHeight=function(){return this.actualHeight},d.prototype._getMinButtonAngle=function(){return-180},d.prototype._getMaxButtonAngle=function(){return 0},d.prototype._setMaxButtonPosition=function(){n.HTMLElementUtils.setElementLeft(this.maxButton.element,this.actualWidth-this.actualButtonWidth)},d.prototype.refresh=function(){this.arrange();var e=this.actualWidth-2*this.actualButtonWidth-2,t=this.viewSize/(this.max-this.min)*e,e=(t<this.MIN_BAR_SIZE&&(e-=this.MIN_BAR_SIZE-t,t=this.MIN_BAR_SIZE),e<0&&(t=e=0),t=Math.min(t,e),this.viewMin/(this.max-this.min)*e),t=(n.HTMLElementUtils.setElementWidth(this.middleBar,t),n.HTMLElementUtils.setElementHeight(this.middleBar,this.actualHeight),this.actualButtonWidth+1+e);this.isModern?this.middleBar.style.transform="translateX(".concat(t,"px)"):n.HTMLElementUtils.setElementLeft(this.middleBar,t)},d.prototype.show=function(e){e!==this.visible&&(s.prototype.show.call(this,e),e?this.element.style.height=this.height:n.HTMLElementUtils.setElementHeight(this.element,0))},d.prototype._scrollByPage=function(e){var t,i=(t=this.isModern?(t=window.getComputedStyle(this.middleBar),new WebKitCSSMatrix(t.transform).m41):this.middleBar.offsetLeft)+this.middleBar.offsetWidth,e=void 0===e.offsetX?e.layerX:e.offsetX;i<e?this.scrollPageDown():e<t&&this.scrollPageUp()},d.prototype._getRunningSize=function(e){var t=this.actualWidth;return e&&(e=(t-=2*(this.actualButtonWidth+1))*(this.viewSize/(this.max-this.min)))<this.MIN_BAR_SIZE&&(t-=this.MIN_BAR_SIZE-e),t},d.prototype._getOffsetDelta=function(e){return this._getOffsetXDelta(e)},d.prototype._getOffsetTouchDelta=function(e){return this._getOffsetXTouchDelta(e)},d.prototype._getScreenContextualLeft=function(e){return e.getBoundingClientRect().left},d.prototype._getScreenContextualRight=function(e){return e.getBoundingClientRect().right},d.prototype._getScreenMousePos=function(e){return e.screenX},n.HorizontalScrollbar=d,__extends(c,o=u),c.prototype._calculateButtonWidth=function(){return this.actualWidth},c.prototype._calculateButtonHeight=function(){return Math.min(this.actualHeight/2,Math.max(this.actualWidth,l.MIN_WIDTH))},c.prototype._getMinButtonAngle=function(){return-90},c.prototype._getMaxButtonAngle=function(){return 90},c.prototype._setMaxButtonPosition=function(){n.HTMLElementUtils.setElementTop(this.maxButton.element,this.actualHeight-this.actualButtonHeight)},c.prototype.refresh=function(){this.arrange();var e=this.actualHeight-2*this.actualButtonHeight-2,t=this.viewSize/(this.max-this.min)*e,e=(t<this.MIN_BAR_SIZE&&(e-=this.MIN_BAR_SIZE-t,t=this.MIN_BAR_SIZE),e<0&&(t=e=0),this.viewMin/(this.max-this.min)*e),t=(n.HTMLElementUtils.setElementWidth(this.middleBar,this.actualWidth),n.HTMLElementUtils.setElementHeight(this.middleBar,t),this.actualButtonHeight+1+e);this.isModern?this.middleBar.style.transform="translateY(".concat(t,"px)"):n.HTMLElementUtils.setElementTop(this.middleBar,t)},c.prototype.show=function(e){e!==this.visible&&(o.prototype.show.call(this,e),e?this.element.style.width=this.width:n.HTMLElementUtils.setElementWidth(this.element,0))},c.prototype._scrollByPage=function(e){var t,i=(t=this.isModern?(t=window.getComputedStyle(this.middleBar),new WebKitCSSMatrix(t.transform).m42):this.middleBar.offsetTop)+this.middleBar.offsetHeight,e=void 0===e.offsetY?e.layerY:e.offsetY;i<e?this.scrollPageDown():e<t&&this.scrollPageUp()},c.prototype._getRunningSize=function(e){var t=this.actualHeight;return e&&(e=(t-=2*(this.actualButtonHeight+1))*(this.viewSize/(this.max-this.min)))<this.MIN_BAR_SIZE&&(t-=this.MIN_BAR_SIZE-e),t},c.prototype._getOffsetDelta=function(e){return this._getOffsetYDelta(e)},c.prototype._getOffsetTouchDelta=function(e){return this._getOffsetYTouchDelta(e)},c.prototype._getScreenContextualLeft=function(e){return e.getBoundingClientRect().top},c.prototype._getScreenContextualRight=function(e){return e.getBoundingClientRect().bottom},c.prototype._getScreenMousePos=function(e){return e.screenY},n.VerticalScrollbar=c}(powerbi=powerbi||{}),function(e){var t,e=e.visuals||(e.visuals={}),i=e.controls||(e.controls={}),o=i.internal||(i.internal={}),r="unselectable",n=(a.addDocumentMouseUpEvent=function(e){document.addEventListener("mouseup",e)},a.removeDocumentMouseUpEvent=function(e){document.removeEventListener("mouseup",e)},a.addDocumentMouseMoveEvent=function(e){document.addEventListener("mousemove",e)},a.removeDocumentMouseMoveEvent=function(e){document.removeEventListener("mousemove",e)},a.getMouseCoordinates=function(e){return{x:e.pageX,y:e.pageY}},a.getMouseCoordinateDelta=function(e,t){return{x:t.x-e.x,y:t.y-e.y}},a.prototype.initialize=function(){var t=this;this._elementMouseDownWrapper=function(e){return t.onElementMouseDown(e)},this._element.addEventListener("mousedown",this._elementMouseDownWrapper),this._elementMouseMoveWrapper=function(e){return t.onElementMouseMove(e)},this._element.addEventListener("mousemove",this._elementMouseMoveWrapper),this._elementMouseOutWrapper=function(e){return t.onElementMouseOut(e)},this._element.addEventListener("mouseout",this._elementMouseOutWrapper),this._elementMouseDoubleClickOutWrapper=function(e){return t.onElementMouseDoubleClick(e)},this._element.addEventListener("dblclick",this._elementMouseDoubleClickOutWrapper)},a.prototype.uninitialize=function(){this._element.removeEventListener("mousedown",this._elementMouseDownWrapper),this._elementMouseDownWrapper=null,this._element.removeEventListener("mousemove",this._elementMouseMoveWrapper),this._elementMouseMoveWrapper=null,this._element.removeEventListener("mouseout",this._elementMouseOutWrapper),this._elementMouseOutWrapper=null,this._element.removeEventListener("dblclick",this._elementMouseDoubleClickOutWrapper),this._elementMouseDoubleClickOutWrapper=null},Object.defineProperty(a.prototype,"cell",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),a.prototype._hotSpot=function(e){return!1},a.prototype.onElementMouseDown=function(e){var t=this,i=a.getMouseCoordinates(e);this._hotSpot(i)&&(e.cancelBubble=!0,this._startMousePosition=i,this._documentMouseMoveWrapper=function(e){return t.onDocumentMouseMove(e)},a.addDocumentMouseMoveEvent(this._documentMouseMoveWrapper),this._documentMouseUpWrapper=function(e){return t.onDocumentMouseUp(e)},a.addDocumentMouseUpEvent(this._documentMouseUpWrapper),document.documentElement&&(this._originalCursor=document.documentElement.style.cursor,document.documentElement.style.cursor=a.resizeCursor),this._handler.onStartResize(this.cell,this._startMousePosition.x,this._startMousePosition.y))},a.prototype.onElementMouseMove=function(e){this._startMousePosition||(this._hotSpot(a.getMouseCoordinates(e))?null===this._originalCursor&&(this._originalCursor=this._element.style.cursor,this._element.style.cursor=a.resizeCursor):null!==this._originalCursor&&(this._element.style.cursor=this._originalCursor,this._originalCursor=null))},a.prototype.onElementMouseOut=function(e){this._startMousePosition||null!==this._originalCursor&&(this._element.style.cursor=this._originalCursor,this._originalCursor=null)},a.prototype.onElementMouseDoubleClick=function(e){this._hotSpot(a.getMouseCoordinates(e))&&this._handler.onReset(this.cell)},a.prototype.onDocumentMouseMove=function(e){var t;this._startMousePosition&&(t=a.getMouseCoordinateDelta(this._startMousePosition,a.getMouseCoordinates(e)),this._handler.onResize(this.cell,t.x,t.y),e.preventDefault())},a.prototype.onDocumentMouseUp=function(e){this._startMousePosition=null,a.removeDocumentMouseMoveEvent(this._documentMouseMoveWrapper),this._documentMouseMoveWrapper=null,a.removeDocumentMouseUpEvent(this._documentMouseUpWrapper),this._documentMouseUpWrapper=null,document.documentElement&&(document.documentElement.style.cursor=this._originalCursor),e.preventDefault&&e.preventDefault(),this._handler.onEndResize(this.cell)},a.resizeHandleSize=4,a.resizeCursor="e-resize",a);function a(e,t){this._element=e,this._handler=t,this._elementMouseDownWrapper=null,this._elementMouseMoveWrapper=null,this._elementMouseOutWrapper=null,this._documentMouseMoveWrapper=null,this._documentMouseUpWrapper=null,this._startMousePosition=null,this._originalCursor=null}o.TablixResizer=n,__extends(u,l=n),Object.defineProperty(u.prototype,"cell",{get:function(){return this._cell},enumerable:!1,configurable:!0}),u.prototype._hotSpot=function(e){return e.x>=this.element.getBoundingClientRect().right-n.resizeHandleSize};var l,s=u;function u(e,t,i){t=l.call(this,t,i)||this;return t._cell=e,t}o.TablixDomResizer=s,d.prototype.initialize=function(e){this._owner=e},Object.defineProperty(d.prototype,"owner",{get:function(){return this._owner},enumerable:!1,configurable:!0}),d.prototype.registerTableCell=function(e){(this._tableCell=e).appendChild(this._contentElement)},Object.defineProperty(d.prototype,"tableCell",{get:function(){return this._tableCell},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"contentElement",{get:function(){return this._contentElement},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"contentHost",{get:function(){return this._contentHost},enumerable:!1,configurable:!0}),d.prototype.registerClickHandler=function(e){this._contentElement.onclick=e},d.prototype.unregisterClickHandler=function(){this._contentElement.onclick=null},d.prototype.onContainerWidthChanged=function(e){i.HTMLElementUtils.setElementWidth(this._contentElement,e)},d.prototype.onContinerHeightChanged=function(e){i.HTMLElementUtils.setElementHeight(this._contentElement,e)},d.prototype.onColumnSpanChanged=function(e){this._tableCell.colSpan=e},d.prototype.onRowSpanChanged=function(e){this._tableCell.rowSpan=e},d.prototype.onTextAlignChanged=function(e){this._tableCell.style.textAlign=e},d.prototype.onClear=function(){this._contentHost.className="",this._tableCell.className=""},d.prototype.onHorizontalScroll=function(e,t){i.HTMLElementUtils.setElementLeft(this._contentHost,t),i.HTMLElementUtils.setElementWidth(this._contentHost,e)},d.prototype.onVerticalScroll=function(e,t){i.HTMLElementUtils.setElementTop(this._contentHost,t),i.HTMLElementUtils.setElementHeight(this._contentHost,e)},d.prototype.onInitializeScrolling=function(){i.HTMLElementUtils.setElementLeft(this._contentHost,0),i.HTMLElementUtils.setElementTop(this._contentHost,0),i.HTMLElementUtils.setElementWidth(this._contentHost,-1),i.HTMLElementUtils.setElementHeight(this._contentHost,-1)},d.prototype.enableHorizontalResize=function(e,t){e!==(null!==this._resizer)&&(e?(this._resizer=new s(this._owner,this._tableCell,t),this._resizer.initialize()):(this._resizer.uninitialize(),this._resizer=null))},d.prototype.disableDragResize=function(){this._tableCell.setAttribute(d._dragResizeDisabledAttributeName,"true")},d._dragResizeDisabledAttributeName="drag-resize-disabled";var h=d;function d(e,t){this._tableCell=null,this._contentElement=o.TablixUtils.createDiv(),this._contentHost=o.TablixUtils.createDiv(),this.layoutKind=t,this._contentElement.appendChild(this._contentHost),this._resizer=null}function c(e){this._tableRow=null,this._fitProportionally=e}o.TablixCellPresenter=h,c.prototype.initialize=function(e){this._row=e},c.prototype.createCellPresenter=function(e){return new h(this._fitProportionally,e)},c.prototype.registerRow=function(e){this._tableRow=e},c.prototype.onAppendCell=function(e){var t,e=e._presenter;null===e.tableCell?(t=this._tableRow.insertCell(-1),e.registerTableCell(t)):this._tableRow.appendChild(e.tableCell)},c.prototype.onInsertCellBefore=function(e,t){t._presenter.tableCell;var i,o=e._presenter;null===o.tableCell?(i=this._tableRow.insertCell(Math.max(0,t._presenter.tableCell.cellIndex-1)),o.registerTableCell(i)):this._tableRow.insertBefore(e._presenter.tableCell,t._presenter.tableCell)},c.prototype.onRemoveCell=function(e){this._tableRow.removeChild(e._presenter.tableCell)},c.prototype.getHeight=function(){return this.getCellHeight(this._row.getTablixCell())},c.prototype.getCellHeight=function(e){return-1},c.prototype.getCellContentHeight=function(e){return-1},Object.defineProperty(c.prototype,"tableRow",{get:function(){return this._tableRow},enumerable:!1,configurable:!0}),e=c,o.TablixRowPresenter=e,__extends(m,p=e),m.prototype.getCellHeight=function(e){return e.containerHeight},m.prototype.getCellContentHeight=function(e){return e.contentHeight};var p,g=m;function m(e,t){return p.call(this,t)||this}o.DashboardRowPresenter=g,__extends(b,f=e),b.prototype.getCellHeight=function(e){return e.containerHeight},b.prototype.getCellContentHeight=function(e){return e.contentHeight};var f,y=b;function b(){return null!==f&&f.apply(this,arguments)||this}function v(){}o.CanvasRowPresenter=y,v.prototype.initialize=function(e){this._column=e},v.prototype.getWidth=function(){var e=this.getPersistedWidth();return e=null==e?this.getCellWidth(this._column.getTablixCell()):e},v.prototype.getPersistedWidth=function(){return-1},v.prototype.getCellWidth=function(e){return-1},e=v,o.TablixColumnPresenter=e,__extends(x,C=e),x.prototype.getPersistedWidth=function(){return this._gridPresenter.sizeComputationManager.cellWidth},x.prototype.getCellWidth=function(e){return this._gridPresenter.sizeComputationManager.cellWidth};var C,w=x;function x(e){var t=C.call(this)||this;return t._gridPresenter=e,t}o.DashboardColumnPresenter=w,__extends(T,S=e),T.prototype.getPersistedWidth=function(){return this._gridPresenter.getPersistedColumnWidth(this._column)},T.prototype.getCellWidth=function(e){return e._presenter?e.contentWidth:0};var S,P,H=T;function T(e,t){var i=S.call(this)||this;return i._gridPresenter=e,i}function M(e){this._table=o.TablixUtils.createTable(),this._table.className=r,this._footerTable=o.TablixUtils.createTable(),this._footerTable.className=r,this._columnWidthManager=e}function R(e){var t=P.call(this)||this;return t._sizeComputationManager=e,t}function _(e){return t.call(this,e)||this}o.CanvasColumnPresenter=H,M.prototype.initialize=function(e,t,i,o){this._owner=e,t.appendChild(this._table),i.appendChild(this._footerTable)},M.prototype.getWidth=function(){return-1},M.prototype.getHeight=function(){return-1},M.prototype.getScreenToCssRatioX=function(){return 1},M.prototype.getScreenToCssRatioY=function(){return 1},M.prototype.createRowPresenter=function(){return null},M.prototype.createColumnPresenter=function(e){return null},M.prototype.onAppendRow=function(e){var t,i=e.presenter;null===i.tableRow?(t=this._table.insertRow(-1),i.registerRow(t)):this._table.tBodies[0].appendChild(e.presenter.tableRow)},M.prototype.onInsertRowBefore=function(e,t){t.presenter.tableRow;var i,o=e.presenter;null===o.tableRow?(i=this._table.insertRow(Math.max(0,t.presenter.tableRow.rowIndex-1)),o.registerRow(i)):this._table.tBodies[0].insertBefore(e.presenter.tableRow,t.presenter.tableRow)},M.prototype.onRemoveRow=function(e){this._table.tBodies[0].removeChild(e.presenter.tableRow)},M.prototype.onAddFooterRow=function(e){var t,i=e.presenter;null===i.tableRow?(t=this._footerTable.insertRow(-1),i.registerRow(t)):this._footerTable.tBodies[0].appendChild(e.presenter.tableRow)},M.prototype.onClear=function(){i.HTMLElementUtils.clearChildren(this._table),i.HTMLElementUtils.clearChildren(this._footerTable)},M.prototype.onFillColumnsProportionallyChanged=function(e){e?(this._table.style.width="100%",this._footerTable.style.width="100%"):(this._table.style.width="auto",this._footerTable.style.width="auto")},M.prototype.invokeColumnResizeEndCallback=function(e,t){this._columnWidthManager&&this._columnWidthManager.onColumnWidthChanged(i.TablixColumnWidthManager.getColumnQueryName(e),t)},M.prototype.getPersistedColumnWidth=function(e){if(this._columnWidthManager)return this._columnWidthManager.getPersistedColumnWidth(i.TablixColumnWidthManager.getColumnQueryName(e))},e=M,o.TablixGridPresenter=e,__extends(R,P=e),R.prototype.createRowPresenter=function(){return new g(this,this._owner.fillColumnsProportionally)},R.prototype.createColumnPresenter=function(e){return new w(this)},Object.defineProperty(R.prototype,"sizeComputationManager",{get:function(){return this._sizeComputationManager},enumerable:!1,configurable:!0}),R.prototype.getWidth=function(){return this._sizeComputationManager.gridWidth},R.prototype.getHeight=function(){return this._sizeComputationManager.gridHeight},o.DashboardTablixGridPresenter=R,__extends(_,t=e),_.prototype.createRowPresenter=function(){return new y(this._owner.fillColumnsProportionally)},_.prototype.createColumnPresenter=function(e){return new H(this,e)},_.prototype.getWidth=function(){return i.HTMLElementUtils.getElementWidth(this._table)},_.prototype.getHeight=function(){return i.HTMLElementUtils.getElementHeight(this._table)},o.CanvasTablixGridPresenter=_}(powerbi=powerbi||{}),function(m){var e,t,i,f,a,c;function o(e){this._binder=e,this._adjustmentFactor=1}function r(){return null!==i&&i.apply(this,arguments)||this}function n(){return null!==t&&t.apply(this,arguments)||this}e=m.visuals||(m.visuals={}),f=(e=e.controls||(e.controls={})).internal||(e.internal={}),o.prototype._getOwner=function(){return null},Object.defineProperty(o.prototype,"binder",{get:function(){return this._binder},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"adjustmentFactor",{get:function(){return this._adjustmentFactor},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"itemsToRealizeCount",{get:function(){return this._itemsToRealizeCount},set:function(e){this._itemsToRealizeCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"itemsEstimatedContextualWidth",{get:function(){return this._itemsEstimatedContextualWidth},set:function(e){this._itemsEstimatedContextualWidth=e},enumerable:!1,configurable:!0}),o.prototype.onStartRenderingIteration=function(){var e=this._getOwner();e.measureEnabled&&!e.done&&this._getEstimatedItemsToRealizeCount(),this._realizedLeavesCount=0},o.prototype.onEndRenderingIteration=function(e,t){t||this._getOwner().allItemsRealized||(this._adjustmentFactor*=this._getSizeAdjustment(e))},o.prototype.onEndRenderingSession=function(){this._adjustmentFactor=1},o.prototype.onCornerCellRealized=function(e,t){},o.prototype.onHeaderRealized=function(e,t,i){i&&this._realizedLeavesCount++},Object.defineProperty(o.prototype,"needsToRealize",{get:function(){return this._realizedLeavesCount<this._itemsToRealizeCount},enumerable:!1,configurable:!0}),o.prototype._getEstimatedItemsToRealizeCount=function(){},o.prototype._getSizeAdjustment=function(e){return 1},e=o,f.TablixDimensionRealizationManager=e,__extends(r,i=e),Object.defineProperty(r.prototype,"owner",{set:function(e){this._owner=e},enumerable:!1,configurable:!0}),r.prototype._getOwner=function(){return this._owner},r.prototype._getEstimatedItemsToRealizeCount=function(){this.estimateRowsToRealizeCount()},r.prototype.estimateRowsToRealizeCount=function(){this._owner,this._owner.dimension.model?this._owner.alignToEnd?this.itemsToRealizeCount=this._owner.dimension.getItemsCount()-this._owner.dimension.getIntegerScrollOffset()+1:this.itemsToRealizeCount=Math.ceil(this._owner.contextualWidthToFill/(this._owner.owner.getEstimatedRowHeight()*this.adjustmentFactor)+this._owner.dimension.getFractionScrollOffset())-this._owner.otherLayoutManager.dimension.getDepth()+1:this.itemsToRealizeCount=0},r.prototype.getEstimatedRowHierarchyWidth=function(){if(!this._owner.dimension.model||0===this._owner.dimension.getItemsCount())return 0;for(var e=new a,t=(this.updateRowHiearchyEstimatedWidth(this._owner.dimension.model,this._owner.dimension._hierarchyNavigator.getIndex(this._owner.dimension.getFirstVisibleItem(0)),e),e.items),i=t.length,o=0,r=0;r<i;r++){var n=t[r];0!==n.maxNonLeafWidth?o+=n.maxNonLeafWidth:o+=n.maxLeafWidth}return o},r.prototype.updateRowHiearchyEstimatedWidth=function(e,t,i){if(!(t<0))for(var o=this._owner.owner.owner.hierarchyNavigator,r=this.binder,n=o.getCount(e),a=t;a<n;a++){if(i.leafCount===this.itemsToRealizeCount)return;var l=o.getAt(e,a),s=r.getHeaderLabel(l),s=this._owner.getEstimatedHeaderWidth(s,t),u=o.isLeaf(l),h=o.getLevel(l),d=i.items[h];d||(d=new c,i.items[h]=d),u?(d.maxLeafWidth=Math.max(d.maxLeafWidth,s),i.leafCount=i.leafCount+1):(d.maxNonLeafWidth=Math.max(d.maxNonLeafWidth,s),this.updateRowHiearchyEstimatedWidth(o.getChildren(l),this._owner.dimension.getFirstVisibleChildIndex(l),i))}},r.prototype._getSizeAdjustment=function(e){return e/((this._owner.getRealizedItemsCount()-this._owner.dimension.getFractionScrollOffset())*this._owner.owner.getEstimatedRowHeight())},f.RowRealizationManager=r,__extends(n,t=e),Object.defineProperty(n.prototype,"owner",{set:function(e){this._owner=e},enumerable:!1,configurable:!0}),n.prototype._getOwner=function(){return this._owner},n.prototype._getEstimatedItemsToRealizeCount=function(){this.estimateColumnsToRealizeCount(this.getEstimatedRowHierarchyWidth())},Object.defineProperty(n.prototype,"rowRealizationManager",{get:function(){return this._owner.otherLayoutManager.realizationManager},enumerable:!1,configurable:!0}),n.prototype.getEstimatedRowHierarchyWidth=function(){return this._owner.otherLayoutManager.done?this._owner.getOtherHierarchyContextualHeight():this.rowRealizationManager.getEstimatedRowHierarchyWidth()*this.adjustmentFactor},n.prototype.estimateColumnsToRealizeCount=function(e){var t=this._owner.contextualWidthToFill-e;if(!this._owner.dimension.model||m.Double.lessOrEqualWithPrecision(t,0,f.DimensionLayoutManager._pixelPrecision))this.itemsToRealizeCount=0;else{var i=this.binder,o=this._owner.owner.owner.hierarchyNavigator,r=this._owner.dimension.getIntegerScrollOffset(),n=this._owner.dimension.getItemsCount(),e=n-r,a=this._owner.otherLayoutManager.dimension.getIntegerScrollOffset(),l=this._owner.otherLayoutManager.dimension.getItemsCount();if(this.itemsEstimatedContextualWidth=0,!this._owner.alignToEnd)for(var s=r;s<n;s++){if(m.Double.greaterOrEqualWithPrecision(this.itemsEstimatedContextualWidth,t,f.DimensionLayoutManager._pixelPrecision))return void(this.itemsToRealizeCount=s-r);var u=0,h=void 0,h=s===r?this._owner.getVisibleSizeRatio():1,d=o.getLeafAt(this._owner.dimension.model,s),c=i.getHeaderLabel(d);u=Math.max(u,this._owner.getEstimatedHeaderWidth(c,s));for(var p=a;p<l;p++)var g=o.getIntersection(o.getLeafAt(this._owner.otherLayoutManager.dimension.model,p),d),c=i.getCellContent(g),u=Math.max(u,this._owner.getEstimatedBodyCellWidth(c));this.itemsEstimatedContextualWidth+=u*h*this.adjustmentFactor}this.itemsToRealizeCount=e}},n.prototype._getSizeAdjustment=function(e){return e/(this.getEstimatedRowHierarchyWidth()+this.itemsEstimatedContextualWidth)},f.ColumnRealizationManager=n,a=function(){this.items=[],this.leafCount=0},f.RowWidths=a,c=function(){this.maxLeafWidth=0,this.maxNonLeafWidth=0},f.RowWidth=c}(powerbi=powerbi||{}),function(e){var o,i,r,n;function t(e,t,i){this._scrollable=!1,this._presenter=e,this.extension=t,this._presenter.initialize(this),this._row=i,this.item=null,this.type=null,this._horizontalOffset=0,this._verticalOffset=0,this._colSpan=1,this._rowSpan=1,this._containerWidth=-1,this._containerHeight=-1,this.contentHeight=this.contentWidth=0,this.position=new o.TablixUtils.CellPosition}function a(e,t){this._presenter=e,this._presenter.initialize(this),this._containerWidth=-1,this._width=-1,this._sizeFixed=!1,this._aligningWidth=-1,this._fixedToAligningWidth=!1,this._items=[],this._itemType=null,this._footerCell=null,this.isColumnResizing=!1}function l(e){this._containerHeight=-1,this._presenter=e,this._presenter.initialize(this),this._allocatedCells=[],this._heightFixed=!1,this._containerHeight=-1,this._height=-1}function s(e){this._presenter=e,this._footerRow=null}e=(e=e.visuals||(e.visuals={})).controls||(e.controls={}),o=e.internal||(e.internal={}),t.prototype.unfixRowHeight=function(){this._row.unfixSize()},Object.defineProperty(t.prototype,"colSpan",{get:function(){return this._colSpan},set:function(e){this._colSpan!==e&&(this._presenter.onColumnSpanChanged(e),this._colSpan=e,this._presenter.onContainerWidthChanged(-1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowSpan",{get:function(){return this._rowSpan},set:function(e){this._rowSpan!==e&&(this._presenter.onRowSpanChanged(e),this._rowSpan=e,this._row.unfixSize())},enumerable:!1,configurable:!0}),t.prototype.getCellSpanningHeight=function(){return this._row.getCellSpanningHeight(this)},Object.defineProperty(t.prototype,"textAlign",{get:function(){return this._textAlign},set:function(e){e!==this._textAlign&&(this._presenter.onTextAlignChanged(e),this._textAlign=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"horizontalOffset",{get:function(){return this._horizontalOffset},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalOffset",{get:function(){return this._verticalOffset},enumerable:!1,configurable:!0}),t.prototype.isScrollable=function(){return this._scrollable},t.prototype.clear=function(){this.isScrollable()&&this.initializeScrolling(),this._presenter.onClear(),this.setContainerWidth(-1),this.setContainerHeight(-1),this.contentHeight=this.contentWidth=0},t.prototype.initializeScrolling=function(){this._presenter.onInitializeScrolling(),(this._horizontalOffset=0)!==this._verticalOffset&&(this._verticalOffset=0),1===this.colSpan&&this.setContainerWidth(-1),1===this.rowSpan&&this.setContainerHeight(-1)},t.prototype.prepare=function(e){this.isScrollable()&&this.initializeScrolling(),this._scrollable=e},t.prototype.scrollVertically=function(e,t){t=Math.ceil(-e*t);this._verticalOffset=t,this.isScrollable()?(this._presenter.onVerticalScroll(e,t),this.setContainerHeight(e+t)):this.setContainerHeight(this._row.getCellSpanningHeight(this)+t)},t.prototype.scrollHorizontally=function(e,t){this.isScrollable()&&(this._presenter.onHorizontalScroll(e,t),this.setContainerWidth(e+t))},t.prototype.setContainerWidth=function(e){e!==this._containerWidth&&(this._containerWidth=e,this._presenter.onContainerWidthChanged(e))},Object.defineProperty(t.prototype,"containerWidth",{get:function(){return this._containerWidth},enumerable:!1,configurable:!0}),t.prototype.setContainerHeight=function(e){var t,i;(e=e<0?-1:e)!==this._containerHeight&&(this._containerHeight=e,i=(t=this._row.owner.owner).getBinder(),t.wordWrapRowHeaders&&null!=i.applyWordWrapping&&-1!==e&&1===this.type&&!this.position.column.isLast&&i.applyWordWrapping(this.item,this),this._presenter.onContinerHeightChanged(e))},Object.defineProperty(t.prototype,"containerHeight",{get:function(){return this._containerHeight},enumerable:!1,configurable:!0}),t.prototype.applyStyle=function(e){e&&(e.applyStyle(this),this.contentHeight+=e.getExtraBottom()+e.getExtraTop(),this.contentWidth+=e.getExtraLeft()+e.getExtraRight())},t.prototype.enableHorizontalResize=function(e,t){this._presenter.enableHorizontalResize(e,t)},t.prototype.isColumnResizing=function(){return this._column&&this._column.isResizing()},i=t,o.TablixCell=i,a.prototype.initialize=function(e){this._owner=e,this._realizedRowHeaders=[],this._realizedColumnHeaders=[],this._realizedCornerCells=[],this._realizedBodyCells=[]},Object.defineProperty(a.prototype,"owner",{get:function(){return this._owner},enumerable:!1,configurable:!0}),a.prototype.getType=function(){return 0<this._realizedCornerCells.length?0:2},a.prototype.getColumnHeadersOrCorners=function(){return 0<this._realizedCornerCells.length?this._realizedCornerCells:this._realizedColumnHeaders},a.prototype.columnHeadersOrCornersEqual=function(e,t,i){if(this._items.length!==t.length)return!1;for(var o=this._items.length,r=0;r<o;r++)if(!this.columnHeaderOrCornerEquals(this._itemType,this._items[r],e,t[r].item,i))return!1;return!0},Object.defineProperty(a.prototype,"itemType",{get:function(){return this._itemType},enumerable:!1,configurable:!0}),a.prototype.getLeafItem=function(){return 0===this._items.length?null:this._items[this._items.length-1]},a.prototype.columnHeaderOrCornerEquals=function(e,t,i,o,r){if(e!==i)return!1;if(0===e){if(!r.cornerCellItemEquals(t,o))return!1}else if(!r.headerItemEquals(t,o))return!1;return!0},a.prototype.OnLeafRealized=function(e){var t=this.getType(),i=this.getColumnHeadersOrCorners();if(this.columnHeadersOrCornersEqual(t,i,e))this.clearSpanningCellsWidth(this._realizedColumnHeaders);else{var o=i.length;this._items=[];for(var r=0;r<o;r++)this._items.push(i[r].item);this._itemType=t,this.clearSize()}},a.prototype.clearSpanningCellsWidth=function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];1<o.colSpan&&o.setContainerWidth(-1)}},a.prototype.addCornerCell=function(e){(e._column=this)._realizedCornerCells.push(e),e.setContainerWidth(this._containerWidth)},a.prototype.addRowHeader=function(e){(e._column=this)._realizedRowHeaders.push(e),e.setContainerWidth(this._containerWidth)},a.prototype.addColumnHeader=function(e,t){(e._column=this)._realizedColumnHeaders.push(e),t&&e.setContainerWidth(this._containerWidth)},a.prototype.addBodyCell=function(e){(e._column=this)._realizedBodyCells.push(e),e.setContainerWidth(this._containerWidth)},Object.defineProperty(a.prototype,"footer",{get:function(){return this._footerCell},set:function(e){(this._footerCell=e)._column=this,e.setContainerWidth(this._containerWidth)},enumerable:!1,configurable:!0}),a.prototype.isResizing=function(){return this.isColumnResizing},a.prototype.onResize=function(e){this.isColumnResizing=!0,e!==this.getContentContextualWidth()&&(this._containerWidth=e,this.setContainerWidth(this._containerWidth),this._sizeFixed=!0,this._fixedToAligningWidth=!1,this._aligningWidth=-1)},a.prototype.onResizeEnd=function(e){this.isColumnResizing=!1;var t=this.owner._presenter;t&&t.invokeColumnResizeEndCallback(this,e)},a.prototype.fixSize=function(){var e=-1!==this._aligningWidth,t=e!==this._fixedToAligningWidth;this._sizeFixed&&!t&&!e||(-1===this._aligningWidth?this.setContainerWidth(this._containerWidth):this.setContainerWidth(this._aligningWidth),this._sizeFixed=!0,this._fixedToAligningWidth=-1!==this._aligningWidth)},a.prototype.clearSize=function(){this._containerWidth=-1,this.setContainerWidth(this._containerWidth),this._sizeFixed=!1},a.prototype.getContentContextualWidth=function(){return this._containerWidth},a.prototype.getCellIContentContextualWidth=function(e){return this._presenter.getCellWidth(e)},a.prototype.getContextualWidth=function(){return-1!==this._width&&-1!==this._containerWidth||(this._width=this._presenter.getWidth()),this._width},a.prototype.calculateSize=function(){if(this._sizeFixed)return this._containerWidth;var e=0,t=this._presenter.getPersistedWidth();if(null!=t)for(var e=t,i=0,o=this._realizedColumnHeaders.length;i<o-1;i++)1===(h=this._realizedColumnHeaders[i]).colSpan&&(e=Math.max(e,this._presenter.getCellWidth(h)));else{for(var r=0,n=this._realizedColumnHeaders;r<n.length;r++)1===(h=n[r]).colSpan&&(e=Math.max(e,this._presenter.getCellWidth(h)));for(var a=0,l=this._realizedRowHeaders;a<l.length;a++)1===(h=l[a]).colSpan&&(e=Math.max(e,this._presenter.getCellWidth(h)));for(var s=0,u=this._realizedCornerCells;s<u.length;s++){var h=u[s];e=Math.max(e,this._presenter.getCellWidth(h))}for(var d=0,c=this._realizedBodyCells;d<c.length;d++){h=c[d];e=Math.max(e,this._presenter.getCellWidth(h))}null!==this._footerCell&&1===this._footerCell.colSpan&&(e=Math.max(e,this._presenter.getCellWidth(this._footerCell)))}return this._containerWidth=e},a.prototype.setAligningContextualWidth=function(e){this._aligningWidth=e},a.prototype.getAligningContextualWidth=function(){return this._aligningWidth},a.prototype.setContainerWidth=function(e){for(var t=0,i=this._realizedColumnHeaders;t<i.length;t++)1===(l=i[t]).colSpan&&l.setContainerWidth(e);for(var o=0,r=this._realizedRowHeaders;o<r.length;o++)1===(l=r[o]).colSpan&&l.setContainerWidth(e);for(var n=0,a=this._realizedCornerCells;n<a.length;n++)(l=a[n]).setContainerWidth(e);for(var l,s=0,u=this._realizedBodyCells;s<u.length;s++)(l=u[s]).setContainerWidth(e);null!==this._footerCell&&1===this._footerCell.colSpan&&this._footerCell.setContainerWidth(e),this._width=e},a.prototype.getTablixCell=function(){var e=0<this._realizedColumnHeaders.length?this._realizedColumnHeaders:this._realizedCornerCells;return e[e.length-1]},a.prototype.getIndex=function(e){return e.realizedColumns.indexOf(this)},a.prototype.getHeaders=function(){return this._realizedColumnHeaders},a.prototype.getOtherDimensionHeaders=function(){return this._realizedRowHeaders},a.prototype.getCellContextualSpan=function(e){return e.colSpan},a.prototype.getOtherDimensionOwner=function(e){return e._row},r=a,o.TablixColumn=r,l.prototype.initialize=function(e){this._owner=e,this._realizedRowHeaders=[],this._realizedBodyCells=[],this._realizedCornerCells=[],this._realizedColumnHeaders=[],this._realizedCellsCount=0},Object.defineProperty(l.prototype,"presenter",{get:function(){return this._presenter},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"owner",{get:function(){return this._owner},enumerable:!1,configurable:!0}),l.prototype.releaseUnusedCells=function(e){this.releaseCells(e,this._realizedCellsCount)},l.prototype.releaseAllCells=function(e){this.releaseCells(e,0)},l.prototype.releaseCells=function(e,t){for(var i=this._allocatedCells,o=i.length,r=t;r<o;r++){var n=i[r];e._unbindCell(n),n.clear()}},l.prototype.moveScrollableCellsToEnd=function(e){for(var t=Math.max(this._realizedRowHeaders.length,this._realizedCornerCells.length),i=t;i<t+e;i++){var o=this._allocatedCells[i];this._presenter.onRemoveCell(o),this._presenter.onAppendCell(o),this._allocatedCells.push(o)}this._allocatedCells.splice(t,e)},l.prototype.moveScrollableCellsToStart=function(e){for(var t=Math.max(this._realizedRowHeaders.length,this._realizedCornerCells.length),i=t;i<t+e;i++){var o=this._allocatedCells.pop();this._presenter.onRemoveCell(o),this._presenter.onInsertCellBefore(o,this._allocatedCells[t]),this._allocatedCells.splice(t,0,o)}},l.prototype.getOrCreateCornerCell=function(e){var t=this.getOrCreateCell();return t.prepare(!1),e.addCornerCell(t),this._realizedCornerCells.push(t),t.setContainerHeight(this._containerHeight),t},l.prototype.getOrCreateRowHeader=function(e,t,i){var o=this.getOrCreateCell();return o.prepare(t),e.addRowHeader(o),this._realizedRowHeaders.push(o),i&&o.setContainerHeight(this._containerHeight),o},l.prototype.getOrCreateColumnHeader=function(e,t,i){var o=this.getOrCreateCell();return o.prepare(t),e.addColumnHeader(o,i),this._realizedColumnHeaders.push(o),o.setContainerHeight(this._containerHeight),o},l.prototype.getOrCreateBodyCell=function(e,t){var i=this.getOrCreateCell();return i.prepare(t),e.addBodyCell(i),this._realizedBodyCells.push(i),i.setContainerHeight(this._containerHeight),i},l.prototype.getOrCreateFooterRowHeader=function(e){var t=this.getOrCreateCell();return t.prepare(!1),e.footer=t,this._realizedRowHeaders.push(t),t.setContainerHeight(this._containerHeight),t},l.prototype.getOrCreateFooterBodyCell=function(e,t){var i=this.getOrCreateCell();return i.prepare(t),e.footer=i,this._realizedBodyCells.push(i),i.setContainerHeight(this._containerHeight),i},l.prototype.getRowHeaderLeafIndex=function(){for(var e=-1,t=this._allocatedCells.length,i=0;i<t&&1===this._allocatedCells[i].type;i++)e++;return e},l.prototype.getAllocatedCellAt=function(e){return this._allocatedCells[e]},l.prototype.moveCellsBy=function(e){if(0!==this._allocatedCells.length)if(0<e)for(var t=this._allocatedCells[0],i=0;i<e;i++){var o=this.createCell(this);this._presenter.onInsertCellBefore(o,t),this._allocatedCells.unshift(o),t=o}else{e=-e;for(i=0;i<e;i++)this._presenter.onRemoveCell(this._allocatedCells[i]);this._allocatedCells.splice(0,e)}},l.prototype.getRealizedCellCount=function(){return this._realizedCellsCount},l.prototype.getRealizedHeadersCount=function(){return this._realizedRowHeaders.length},l.prototype.getRealizedHeaderAt=function(e){return this._realizedRowHeaders[e]},l.prototype.getTablixCell=function(){var e=0<this._realizedRowHeaders.length?this._realizedRowHeaders:0<this._realizedCornerCells.length?this._realizedCornerCells:this._realizedColumnHeaders;return e[e.length-1]},l.prototype.getOrCreateEmptySpaceCell=function(){var e=this._allocatedCells[this._realizedCellsCount];return void 0===e&&(e=this.createCell(this),this._allocatedCells[this._realizedCellsCount]=e,this._presenter.onAppendCell(e)),e},l.prototype.createCell=function(e){var t=this._presenter.createCellPresenter(this._owner.owner.layoutManager.getLayoutKind());return new i(t,t,this)},l.prototype.getOrCreateCell=function(){var e=this._allocatedCells[this._realizedCellsCount];return void 0===e?(e=this.createCell(this),this._allocatedCells[this._realizedCellsCount]=e,this._presenter.onAppendCell(e)):(e.colSpan=1,e.rowSpan=1),this._realizedCellsCount=this._realizedCellsCount+1,e},l.prototype.isResizing=function(){return!1},l.prototype.onResize=function(e){e!==this.getContentContextualWidth()&&(this._containerHeight=e,this.setContentHeight(),this._heightFixed=!0,this.setAligningContextualWidth(-1))},l.prototype.onResizeEnd=function(e){},l.prototype.fixSize=function(){this.setContentHeight(),this._heightFixed=!0},l.prototype.unfixSize=function(){this._heightFixed=!1,this._height=-1},l.prototype.getContentContextualWidth=function(){return this._containerHeight},l.prototype.getCellIContentContextualWidth=function(e){return this.presenter.getCellContentHeight(e)},l.prototype.getCellSpanningHeight=function(e){var t=this.getContextualWidth();if(1<e.rowSpan)for(var i=this.getIndex(this.owner),o=this.owner.realizedRows,r=1;r<e.rowSpan;r++)t+=o[r+i].getContextualWidth();return t},l.prototype.getContextualWidth=function(){return-1!==this._height&&-1!==this._containerHeight||(this._height=this._presenter.getHeight()),this._height},l.prototype.sizeFixed=function(){return this._heightFixed},l.prototype.calculateSize=function(){if(this._heightFixed)return this._containerHeight;for(var e=0,t=this._realizedRowHeaders.length,i=0;i<t;i++)1===(o=this._realizedRowHeaders[i]).rowSpan&&(e=Math.max(e,this._presenter.getCellContentHeight(o)));for(t=this._realizedCornerCells.length,i=0;i<t;i++)e=Math.max(e,this._presenter.getCellContentHeight(this._realizedCornerCells[i]));t=this._realizedColumnHeaders.length;for(var o,i=0;i<t;i++)1===(o=this._realizedColumnHeaders[i]).rowSpan&&(e=Math.max(e,this._presenter.getCellContentHeight(o)));t=this._realizedBodyCells.length;for(i=0;i<t;i++)e=Math.max(e,this._presenter.getCellContentHeight(this._realizedBodyCells[i]));return this._containerHeight=e},l.prototype.setAligningContextualWidth=function(e){},l.prototype.getAligningContextualWidth=function(){return-1},l.prototype.setContentHeight=function(){for(var e=this._realizedRowHeaders.length-1;0<=e;e--)-1!==(n=this._realizedRowHeaders[e]).containerHeight&&n._row.sizeFixed()||(n.setContainerHeight(this._containerHeight),1<n.rowSpan&&n.setContainerHeight(this.getCellSpanningHeight(n)));for(var t=0,i=this._realizedCornerCells;t<i.length;t++)-1!==(n=i[t]).containerHeight&&n._row.sizeFixed()||n.setContainerHeight(this._containerHeight);for(var o=0,r=this._realizedColumnHeaders;o<r.length;o++)-1!==(n=r[o]).containerHeight&&n._row.sizeFixed()||(n.setContainerHeight(this._containerHeight),1<n.rowSpan&&n.setContainerHeight(this.getCellSpanningHeight(n)));this._realizedBodyCells.length;for(var n,a=0,l=this._realizedBodyCells;a<l.length;a++)-1!==(n=l[a]).containerHeight&&n._row.sizeFixed()||n.setContainerHeight(this._containerHeight);this._height=-1},l.prototype.getIndex=function(e){return e.realizedRows.indexOf(this)},l.prototype.getHeaders=function(){return this._realizedRowHeaders},l.prototype.getOtherDimensionHeaders=function(){return this._realizedColumnHeaders},l.prototype.getCellContextualSpan=function(e){return e.rowSpan},l.prototype.getOtherDimensionOwner=function(e){return e._column},n=l,o.TablixRow=n,s.prototype.initialize=function(e,t,i){this._owner=e,this._presenter.initialize(this,t,i,e),this.fillColumnsProportionally=!1,this._realizedRows=[],this._realizedColumns=[],this._emptySpaceHeaderCell=null,this._emptyFooterSpaceCell=null},Object.defineProperty(s.prototype,"owner",{get:function(){return this._owner},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fillColumnsProportionally",{get:function(){return this._fillColumnsProportionally},set:function(e){this._fillColumnsProportionally!==e&&(this._fillColumnsProportionally=e,this._presenter.onFillColumnsProportionallyChanged(e))},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"realizedColumns",{get:function(){return this._realizedColumns},set:function(e){this._realizedColumns=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"realizedRows",{get:function(){return this._realizedRows},set:function(e){this._realizedRows=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"footerRow",{get:function(){return this._footerRow},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"emptySpaceHeaderCell",{get:function(){return this._emptySpaceHeaderCell},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"emptySpaceFooterCell",{get:function(){return this._emptyFooterSpaceCell},enumerable:!1,configurable:!0}),s.prototype.ShowEmptySpaceCells=function(e,t){0!==this._realizedRows.length&&(0===this._realizedRows.length||this._emptySpaceHeaderCell||(this._emptySpaceHeaderCell=this._realizedRows[0].getOrCreateEmptySpaceCell(),this._emptySpaceHeaderCell.rowSpan=e,this._emptySpaceHeaderCell.colSpan=1,this._emptySpaceHeaderCell.setContainerWidth(t)),this._footerRow)&&null===this._emptyFooterSpaceCell&&(this._emptyFooterSpaceCell=this._footerRow.getOrCreateEmptySpaceCell(),this._emptyFooterSpaceCell.rowSpan=1,this._emptyFooterSpaceCell.colSpan=1,this._emptyFooterSpaceCell.setContainerWidth(t))},s.prototype.HideEmptySpaceCells=function(){this._emptySpaceHeaderCell&&(this._emptySpaceHeaderCell.clear(),this._emptySpaceHeaderCell=null),this._emptyFooterSpaceCell&&(this._emptyFooterSpaceCell.clear(),this._emptyFooterSpaceCell=null)},s.prototype.onStartRenderingSession=function(e){e&&(this.clearRows(),this.clearColumns())},s.prototype.onStartRenderingIteration=function(){this.initializeRows(),this.initializeColumns()},s.prototype.onEndRenderingIteration=function(){var e=this._rows;if(void 0!==e)for(var t=e.length,i=0;i<t;i++)e[i].releaseUnusedCells(this._owner);this._footerRow&&this._footerRow.releaseUnusedCells(this._owner)},s.prototype.getOrCreateRow=function(e){var t=this._rows[e];return void 0===t&&((t=new n(this._presenter.createRowPresenter())).initialize(this),this._presenter.onAppendRow(t),this._rows[e]=t),void 0===this._realizedRows[e]&&(this._realizedRows[e]=t),t},s.prototype.getOrCreateFootersRow=function(){return null===this._footerRow&&(this._footerRow=new n(this._presenter.createRowPresenter()),this._footerRow.initialize(this),this._presenter.onAddFooterRow(this._footerRow)),this._footerRow},s.prototype.moveRowsToEnd=function(e,t){for(var i=0;i<t;i++){var o=this._rows[i+e];o.unfixSize(),this._presenter.onRemoveRow(o),this._presenter.onAppendRow(o),this._rows.push(o)}this._rows.splice(e,t)},s.prototype.moveRowsToStart=function(e,t){for(var i=this._rows[e],o=0;o<t;o++){var r=this._rows.pop();r.unfixSize(),this._presenter.onRemoveRow(r),this._presenter.onInsertRowBefore(r,i),this._rows.splice(e+o,0,r)}},s.prototype.moveColumnsToEnd=function(e,t){for(var i=this._rows[0]._realizedCornerCells.length,o=Math.max(this._columns[i]._realizedColumnHeaders.length-1,0);o<this._rows.length;o++)this._rows[o].moveScrollableCellsToEnd(t);for(o=0;o<t;o++){var r=this._columns[o+e];this._columns.push(r)}this._columns.splice(e,t)},s.prototype.moveColumnsToStart=function(e,t){for(var i=this._rows[0]._realizedCornerCells.length,o=Math.max(this._columns[i]._realizedColumnHeaders.length-1,0);o<this._rows.length;o++)this._rows[o].moveScrollableCellsToStart(t);for(o=0;o<t;o++){var r=this._columns.pop();this._columns.splice(e+o,0,r)}},s.prototype.getOrCreateColumn=function(e){var t=this._columns[e];return void 0===t&&((t=new r(this._presenter.createColumnPresenter(e),e)).initialize(this),this._columns[e]=t),void 0===this._realizedColumns[e]&&(this._realizedColumns[e]=t),t},s.prototype.initializeColumns=function(){this._columns||(this._columns=[]);for(var e=this._columns.length,t=0;t<e;t++)this._columns[t].initialize(this);this._realizedColumns=[]},s.prototype.clearColumns=function(){this._columns=null,this._realizedColumns=null},s.prototype.initializeRows=function(){for(var e=this._owner.rowDimension.hasFooter()&&null!==this._footerRow,t=(this._realizedRows=[],this._rows||(this._rows=[]),this._rows),i=t.length,o=0;o<i;o++)t[o].initialize(this);e&&(this._footerRow||this.getOrCreateFootersRow(),this._footerRow.initialize(this))},s.prototype.clearRows=function(){var e=this._rows;if(e){for(var t=e.length,i=0;i<t;i++)e[i].releaseAllCells(this._owner);this._footerRow&&this._footerRow.releaseAllCells(this._owner),this._presenter.onClear(),this._footerRow=null,this._rows=null,this._realizedRows=null}},s.prototype.getWidth=function(){return this._presenter.getWidth()},s.prototype.getHeight=function(){return this._presenter.getHeight()},o.TablixGrid=s}(powerbi=powerbi||{}),function(h){var e,r,a,i,t,o,n,l,s,u,d,c,p,g,m,f,y,b,v;function C(){}function w(e,t,i){this._owner=e,this._grid=t,this._lastScrollOffset=null,this._isScrolling=!1,this._fixedSizeEnabled=!0,this._done=!1,this._realizationManager=i}function x(e,t,i){this.column=e,this.item=e.getLeafItem(),this.itemType=e.itemType,this.startColumnWidth=t,this.resizingDelta=0,this.animationFrame=null,this.scale=i}function S(e,t,i){e=s.call(this,e,t,i)||this;return(i.owner=e).fillProportionally=!1,e._resizeState=null,e}function P(){return null!==u&&u.apply(this,arguments)||this}function H(){return null!==c&&c.apply(this,arguments)||this}function T(e,t,i){e=g.call(this,e,t,i)||this;return i.owner=e}function M(){return null!==m&&m.apply(this,arguments)||this}function R(){return null!==y&&y.apply(this,arguments)||this}function _(e,t,i,o){this._allowHeaderResize=!0,this._binder=e,this._grid=t,this._columnLayoutManager=i,this._rowLayoutManager=o,this._columnWidthsToPersist=[]}function I(e,t,i,o,r){var n=this,r=new d(null,i,r),o=new f(null,i,o),n=b.call(this,e,i,r,o)||this;return r.owner=n,(o.owner=n)._sizeComputationManager=t,n}function L(e,t,i,o){o=new p(null,t,o),i=new v(null,t,i),e=r.call(this,e,t,o,i)||this;return o.owner=e,i.owner=e}e=h.visuals||(h.visuals={}),a=e.controls||(e.controls={}),i=a.internal||(a.internal={}),t=jsCommon.PixelConverter,Object.defineProperty(C.prototype,"visibleWidth",{get:function(){return this._viewport?this._viewport.width:0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"visibleHeight",{get:function(){return this._viewport?this._viewport.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"gridWidth",{get:function(){return this.visibleWidth},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"gridHeight",{get:function(){return this.visibleHeight},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"rowHeight",{get:function(){return this._cellHeight},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"cellWidth",{get:function(){return this._cellWidth},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"cellHeight",{get:function(){return this._cellHeight},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"contentWidth",{get:function(){return this._cellWidth},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"contentHeight",{get:function(){return this._cellHeight},enumerable:!1,configurable:!0}),C.prototype.updateColumnCount=function(e){this._columnCount=e},C.prototype.updateRowHeight=function(e){this._cellHeight=e},C.prototype.updateScalingFactor=function(e){this._scalingFactor=e,this._cellWidth=this.computeColumnWidth(this._columnCount)},C.prototype.updateViewport=function(e){this._viewport=e,this._cellWidth=this.computeColumnWidth(this._columnCount),this._cellHeight=this.computeColumnHeight()},C.prototype.computeColumnWidth=function(e){var t=(t=this._scalingFactor)||1,t=Math.floor(this._viewport.width/(t*C.TablixMinimumColumnWidth));return this.fitToColumnCount(t,e)},C.prototype.computeColumnHeight=function(){var e;return this.hasImageContent?(e=this._viewport.width)<=250?20:e<=510?51:e<=770?52:void 0:this._cellHeight},C.prototype.fitToColumnCount=function(e,t){e=Math.min(e,t);return Math.floor(this._viewport.width/e)},C.TablixMinimumColumnWidth=75,o=C,i.SizeComputationManager=o,Object.defineProperty(w.prototype,"owner",{get:function(){return this._owner},set:function(e){this._owner=e},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"realizationManager",{get:function(){return this._realizationManager},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"fixedSizeEnabled",{get:function(){return this._fixedSizeEnabled},set:function(e){this._fixedSizeEnabled=e},enumerable:!1,configurable:!0}),w.prototype.onCornerCellRealized=function(e,t,i){this._realizationManager.onCornerCellRealized(e,t)},w.prototype.onHeaderRealized=function(e,t,i){this._realizationManager.onHeaderRealized(e,t,i)},Object.defineProperty(w.prototype,"needsToRealize",{get:function(){return this._realizationManager.needsToRealize},enumerable:!1,configurable:!0}),w.prototype.getVisibleSizeRatio=function(){return 1-this.dimension.getFractionScrollOffset()},Object.defineProperty(w.prototype,"alignToEnd",{get:function(){return this._alignToEnd},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"done",{get:function(){return this._done},enumerable:!1,configurable:!0}),w.prototype._requiresMeasure=function(){return!0},w.prototype.startScrollingSession=function(){this._isScrolling=!0},w.prototype.endScrollingSession=function(){this._isScrolling=!1},w.prototype.isScrolling=function(){return this._isScrolling},w.prototype.isResizing=function(){return!1},w.prototype.getOtherHierarchyContextualHeight=function(){var e=this.dimension.otherDimension.getDepth(),t=0,i=this._getRealizedItems();if(0<i.length)for(var o=0;o<e;o++)t+=i[o].getContextualWidth();return t},w.prototype._isAutoSized=function(){return!1},w.prototype.onStartRenderingSession=function(){this._measureEnabled=this._requiresMeasure(),this._gridOffset=this.dimension.otherDimension.getDepth()},w.prototype.onEndRenderingSession=function(){this._realizationManager.onEndRenderingSession(),this._alignToEnd=!1,this._done=!1,this._measureEnabled=!0,this._sendDimensionsToControl()},w.prototype._sendDimensionsToControl=function(){},Object.defineProperty(w.prototype,"measureEnabled",{get:function(){return this._measureEnabled},enumerable:!1,configurable:!0}),w.prototype.getFooterContextualWidth=function(){return 0},w.prototype.onStartRenderingIteration=function(e,t){this._measureEnabled&&!this._done&&(this._contextualWidthToFill=(t-this.otherScrollbarContextualWidth)*this.getGridScale()-this.getFooterContextualWidth()),this._realizationManager.onStartRenderingIteration(),e?this._lastScrollOffset=null:null!==this._lastScrollOffset&&this.swapElements()},Object.defineProperty(w.prototype,"allItemsRealized",{get:function(){return this.getRealizedItemsCount()-this._gridOffset===this.dimension.getItemsCount()||0===this.dimension.getItemsCount()},enumerable:!1,configurable:!0}),w.prototype.onEndRenderingIteration=function(){var e,t,i,o,r;this._done||(this._measureEnabled?(e=this.getGridContextualWidth(),t=h.Double.greaterOrEqualWithPrecision(e,this._contextualWidthToFill,w._pixelPrecision),i=this.allItemsRealized,o=t?this.scrollForwardToAlignEnd(e):this.scrollBackwardToFill(e),this._realizationManager.onEndRenderingIteration(e,t),r=this.dimension.scrollbar.visible,this.updateScrollbar(e),this._done=(t||i)&&this.dimension.scrollbar.visible===r&&h.Double.equalWithPrecision(o,this.dimension.scrollOffset,w._scrollOffsetPrecision),this.dimension.scrollOffset=o,this._lastScrollOffset=this.dimension.scrollOffset):(this._lastScrollOffset=this.dimension.scrollOffset,this._done=!0))},w.prototype.getScrollDeltaWithinPage=function(){if(null!==this._lastScrollOffset){var e=this.dimension.getIntegerScrollOffset()-Math.floor(this._lastScrollOffset);if(Math.abs(e)<this.getRealizedItemsCount()-this.dimension.otherDimension.getDepth())return e}return null},w.prototype.swapElements=function(){var e,t=this.getScrollDeltaWithinPage();null!==t&&(e=this.dimension.otherDimension.getDepth(),Math.abs(t)<this.getRealizedItemsCount()-e)&&(0<t?this._moveElementsToBottom(e,t):t<0&&this._moveElementsToTop(e,-t))},w.prototype._getRealizedItems=function(){return null},w.prototype.getRealizedItemsCount=function(){return this._getRealizedItems().length},w.prototype._moveElementsToBottom=function(e,t){},w.prototype._moveElementsToTop=function(e,t){},w.prototype.isScrollingWithinPage=function(){return null!==this.getScrollDeltaWithinPage()},w.prototype.getGridContextualWidth=function(){return 0},w.prototype.updateScrollbar=function(e){var t=this.dimension.scrollbar;t.viewMin=this.dimension.scrollOffset,t.min=0,t.max=this.dimension.getItemsCount(),t.viewSize=this.getViewSize(e),this.dimension.scrollbar.show(this.canScroll(e))},w.prototype.getViewSize=function(e){var t=this.getRealizedItemsCount();if(0===t)return 0;for(var i=this._gridOffset,o=0,r=0,n=this._contextualWidthToFill-this.getOtherHierarchyContextualHeight(),a=this.getMeaurementError(e),l=i;l<t;l++){var s=void 0,s=l===i?this.getVisibleSizeRatio():1,u=this.getItemContextualWidthWithScrolling(l)*a;if(r+=u,o+=s,h.Double.greaterWithPrecision(r,n,w._pixelPrecision)){o-=(r-n)/u*s;break}}return o},w.prototype.isScrollableHeader=function(e,t,i){if(0!==i||0===this.dimension.getFractionScrollOffset())return!1;var o=this.dimension._hierarchyNavigator;if(!o.isLeaf(e)){var r,n=e;do{if(r=o.getChildren(n),void 0===(n=this.dimension.getFirstVisibleItem(o.getLevel(n)+1)))break;if(!o.isLastItem(n,r))return!1}while(!o.isLeaf(n))}return!0},w.prototype.reachedEnd=function(){return this.dimension.getIntegerScrollOffset()+(this.getRealizedItemsCount()-this._gridOffset)>=this.dimension.getItemsCount()},w.prototype.scrollBackwardToFill=function(e){var t,i=this.dimension.scrollOffset;return this.reachedEnd()&&(t=this._contextualWidthToFill-e,0<this.dimension.getItemsCount()&&(e=e/(this.getRealizedItemsCount()-this.dimension.getFractionScrollOffset()),i=this.dimension.getValidScrollOffset(Math.floor(this.dimension.scrollOffset-t/e))),this._alignToEnd=!h.Double.equalWithPrecision(i,this.dimension.scrollOffset,w._scrollOffsetPrecision)),i},w.prototype.getItemContextualWidth=function(e){var t=this._getRealizedItems();return e>=t.length?null:t[e].getContextualWidth()},w.prototype.getItemContextualWidthWithScrolling=function(e){return this.getSizeWithScrolling(this.getItemContextualWidth(e),e)},w.prototype.getSizeWithScrolling=function(e,t){t=this._gridOffset===t?this.getVisibleSizeRatio():1;return e*t},w.prototype.getGridContextualWidthFromItems=function(){for(var e=this.getRealizedItemsCount(),t=0,i=0;i<e;i++)t+=this.getItemContextualWidthWithScrolling(i);return t},w.prototype.getMeaurementError=function(e){return e/this.getGridContextualWidthFromItems()},w.prototype.scrollForwardToAlignEnd=function(e){var t=this.dimension.scrollOffset;if(this._alignToEnd){var i=h.Double.equalWithPrecision(e,this._contextualWidthToFill,w._pixelPrecision);if(!i)for(var o=this.getRealizedItemsCount(),r=this._gridOffset,n=e-this._contextualWidthToFill,a=this.getMeaurementError(e),l=r;l<o;l++){var s=this.getItemContextualWidth(l)*a;if(!h.Double.lessWithPrecision(s,n,w._pixelPrecision)){var u=r===l?1-this.dimension.getFractionScrollOffset():1,t=this.dimension.getValidScrollOffset(this.dimension.scrollOffset+(l-r)+n*u/s);break}n-=s}this._alignToEnd=!i}return t},Object.defineProperty(w.prototype,"dimension",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"otherLayoutManager",{get:function(){return this.dimension.otherDimension.layoutManager},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"contextualWidthToFill",{get:function(){return this._contextualWidthToFill},enumerable:!1,configurable:!0}),w.prototype.getGridScale=function(){return 0},Object.defineProperty(w.prototype,"otherScrollbarContextualWidth",{get:function(){return 0},enumerable:!1,configurable:!0}),w.prototype.getActualContextualWidth=function(e){return this._isAutoSized()&&!this.canScroll(e)?e:this._contextualWidthToFill},w.prototype.canScroll=function(e){return!1},w.prototype.calculateSizes=function(){this.fixedSizeEnabled&&(this.calculateContextualWidths(),this.calculateSpans())},w.prototype._calculateSize=function(e){return null},w.prototype.calculateContextualWidths=function(){for(var e=this._getRealizedItems(),t=e.length,i=0;i<t;i++){var o=e[i];this.measureEnabled&&o.setAligningContextualWidth(-1),this._calculateSize(o)}},w.prototype.calculateSpans=function(){this.measureEnabled&&(this.updateNonScrollableItemsSpans(),this.updateScrollableItemsSpans())},w.prototype.updateNonScrollableItemsSpans=function(){for(var e=this.otherLayoutManager._getRealizedItems(),t=e.length,i=this.dimension.getDepth();i<t;i++){var o=e[i];this.updateSpans(o,o.getHeaders(),!1)}},w.prototype.updateScrollableItemsSpans=function(){for(var e=this.otherLayoutManager._getRealizedItems(),t=Math.min(this.dimension.getDepth(),e.length),i=0;i<t;i++){var o=e[i];this.updateSpans(o,o.getOtherDimensionHeaders(),!0)}},w.prototype.fixSizes=function(){if(this.fixedSizeEnabled)for(var e=this._getRealizedItems(),t=e.length-1;0<=t;t--)e[t].fixSize()},w.prototype.updateSpans=function(e,t,i){for(var o=this._getRealizedItems(),r=t.length,n=0;n<r;n++){var a=t[n],l=e.getOtherDimensionOwner(a),s=l.getCellContextualSpan(a);if(1<s)for(var u=0,h=l.getIndex(this._grid),d=0;d<s;d++){var c=o[d+h],p=c.getContentContextualWidth();u+=p=i&&0===n&&0===d?Math.floor((1-this.dimension.getFractionScrollOffset())*p):p,d===s-1&&this.updateLastChildSize(a,c,u)}}},w.prototype.updateLastChildSize=function(e,t,i){e=t.getCellIContentContextualWidth(e)-i;0<e&&t.setAligningContextualWidth(Math.max(t.getAligningContextualWidth(),e+t.getContentContextualWidth()))},w._pixelPrecision=1.0001,w._scrollOffsetPrecision=.01,n=w,i.DimensionLayoutManager=n,x.prototype.getNewSize=function(){return this.startColumnWidth+this.resizingDelta},l=x,i.ResizeState=l,__extends(S,s=n),Object.defineProperty(S.prototype,"dimension",{get:function(){return this.owner.owner.columnDimension},enumerable:!1,configurable:!0}),S.prototype.isResizing=function(){return null!==this._resizeState},Object.defineProperty(S.prototype,"fillProportionally",{get:function(){return this._grid.fillColumnsProportionally},set:function(e){this._grid.fillColumnsProportionally=e},enumerable:!1,configurable:!0}),S.prototype.getGridScale=function(){return this._grid._presenter.getScreenToCssRatioX()},Object.defineProperty(S.prototype,"otherScrollbarContextualWidth",{get:function(){return this.dimension.otherDimension.scrollbar.visible?a.HTMLElementUtils.getElementWidth(this.dimension.otherDimension.scrollbar.element):0},enumerable:!1,configurable:!0}),S.prototype._getRealizedItems=function(){return this._grid.realizedColumns||(this._grid.realizedColumns=[]),this._grid.realizedColumns},S.prototype._moveElementsToBottom=function(e,t){this._grid.moveColumnsToEnd(e,t)},S.prototype._moveElementsToTop=function(e,t){this._grid.moveColumnsToStart(e,t)},S.prototype._requiresMeasure=function(){return!this.isScrolling()&&!this.otherLayoutManager.isScrolling()||this.isScrolling()||this.isResizing()},S.prototype.getGridContextualWidth=function(){return this._grid.getWidth()},S.prototype.getFirstVisibleColumn=function(){return this._grid.realizedColumns[this._gridOffset]},S.prototype._isAutoSized=function(){return this.owner.owner.autoSizeWidth},S.prototype.applyScrolling=function(){var e=this.dimension.getFractionScrollOffset(),t=0,i=this.getFirstVisibleColumn();void 0!==i&&(t=i.getContextualWidth(),e=Math.ceil(-t*e),this.scroll(i,t,e))},S.prototype.scroll=function(e,t,i){this.scrollCells(e._realizedColumnHeaders,t,i),this.scrollBodyCells(this._grid.realizedRows,t,i),null!==e.footer&&e.footer.scrollHorizontally(t,i)},S.prototype.scrollCells=function(e,t,i){for(var o=e.length,r=0;r<o;r++)e[r].scrollHorizontally(t,i)},S.prototype.scrollBodyCells=function(e,t,i){for(var o,r=e.length,n=0;n<r;n++)void 0!==(o=e[n]._realizedBodyCells)&&void 0!==(o=o[0])&&o.scrollHorizontally(t,i)},S.prototype.onStartResize=function(e,t,i){this._resizeState=new l(e._column,e._column.getContentContextualWidth(),a.HTMLElementUtils.getAccumulatedScale(this.owner.owner.container))},S.prototype.onResize=function(e,t,i){var o=this;this.isResizing()&&(this.owner.owner.wordWrapColumnHeaders&&e.unfixRowHeight(),this._resizeState.resizingDelta=Math.round(Math.max(t/this._resizeState.scale,S.minColumnWidth-this._resizeState.startColumnWidth)),null===this._resizeState.animationFrame)&&(this._resizeState.animationFrame=requestAnimationFrame(function(){return o.performResizing()}))},S.prototype.onEndResize=function(e){this.isResizing()&&null!==this._resizeState.animationFrame&&this.performResizing(),this.endResizing(),this._resizeState=null},S.prototype.onReset=function(e){this.owner.owner.wordWrapColumnHeaders&&e.unfixRowHeight(),this._resizeState=new l(e._column,-1,1),e._column.clearSize(),this.endResizing(),this.owner.owner.refresh(!1),this._resizeState=null},S.prototype.updateItemToResizeState=function(e){if(null!==this._resizeState)for(var t=e.length,i=this.owner.owner.hierarchyNavigator,o=this.otherLayoutManager.dimension.getDepth();o<t;o++){var r=e[o];if(r.columnHeaderOrCornerEquals(this._resizeState.itemType,this._resizeState.item,r.itemType,r.getLeafItem(),i)&&r!==this._resizeState.column){(this._resizeState.column=r).onResize(this._resizeState.getNewSize());break}}},S.prototype.performResizing=function(){var e;null!==this._resizeState&&(this._resizeState.animationFrame=null,e=this._resizeState.getNewSize(),this._resizeState.column.onResize(e),this.owner.owner.refresh(!1))},S.prototype.endResizing=function(){var e;null!==this._resizeState&&(e=this._resizeState.getNewSize(),this._resizeState.column.onResizeEnd(e))},S.prototype._sendDimensionsToControl=function(){var e=this.getGridContextualWidth(),t=this.getActualContextualWidth(e),i=this.getOtherHierarchyContextualHeight(),o=this.getGridScale();this.owner.owner.updateColumnDimensions(i/o,(t-i)/o,this.getViewSize(e))},S.prototype.getEstimatedHeaderWidth=function(e,t){return-1},S.prototype.getEstimatedBodyCellWidth=function(e){return-1},S.minColumnWidth=10,e=S,i.ColumnLayoutManager=e,__extends(P,u=e),P.prototype.getEstimatedHeaderWidth=function(e,t){return this.ignoreColumn(t)?0:this.owner.getCellWidth(void 0)},P.prototype.getEstimatedBodyCellWidth=function(e){return this.owner.getCellWidth(void 0)},P.prototype.canScroll=function(e){return!1},P.prototype._calculateSize=function(e){var t=e.getIndex(this._grid),i=0;return this.ignoreColumn(t)||(i=this.owner.getContentWidth(void 0)),e.onResize(i),e.onResizeEnd(i),i},P.prototype.ignoreColumn=function(e){return 0===e&&!this.owner.binder.hasRowGroups()},d=P,i.DashboardColumnLayoutManager=d,__extends(H,c=e),H.prototype.getEstimatedHeaderWidth=function(e,t){return this.owner.getEstimatedTextWidth(e)},H.prototype.getEstimatedBodyCellWidth=function(e){return this.owner.getEstimatedTextWidth(e)},H.prototype.calculateContextualWidths=function(){for(var e=this._getRealizedItems(),t=[],i=0,o=e.length;i<o;i++){var r=e[i],n=(this.measureEnabled&&r.setAligningContextualWidth(-1),a.TablixColumnWidthManager.getColumnQueryName(r));null!=n&&t.push({queryName:n,width:this._calculateSize(r),isFixed:!1})}this.owner.columnWidthsToPersist=t},H.prototype.canScroll=function(e){return!h.Double.equalWithPrecision(this.dimension.scrollOffset,0,n._scrollOffsetPrecision)||this.getRealizedItemsCount()-this._gridOffset<this.dimension.getItemsCount()&&0<this._contextualWidthToFill||h.Double.greaterWithPrecision(e,this._contextualWidthToFill,n._pixelPrecision)},H.prototype._calculateSize=function(e){return e.calculateSize()},p=H,i.CanvasColumnLayoutManager=p,__extends(T,g=n),Object.defineProperty(T.prototype,"dimension",{get:function(){return this.owner.owner.rowDimension},enumerable:!1,configurable:!0}),T.prototype.getGridScale=function(){return this._grid._presenter.getScreenToCssRatioY()},Object.defineProperty(T.prototype,"otherScrollbarContextualWidth",{get:function(){return this.dimension.otherDimension.scrollbar.visible?a.HTMLElementUtils.getElementHeight(this.dimension.otherDimension.scrollbar.element):0},enumerable:!1,configurable:!0}),T.prototype.startScrollingSession=function(){g.prototype.startScrollingSession.call(this)},T.prototype._getRealizedItems=function(){return this._grid.realizedRows||(this._grid.realizedRows=[]),this._grid.realizedRows},T.prototype._moveElementsToBottom=function(e,t){this._grid.moveRowsToEnd(e,t)},T.prototype._moveElementsToTop=function(e,t){this._grid.moveRowsToStart(e,t)},T.prototype._requiresMeasure=function(){return!this.isScrolling()&&!this.otherLayoutManager.isScrolling()&&!this.otherLayoutManager.isResizing()||this.isScrolling()&&this.dimension.getIntegerScrollOffset()+(this.getRealizedItemsCount()-this._gridOffset)>=this.dimension.getItemsCount()},T.prototype.getGridContextualWidth=function(){return this._grid.getHeight()},T.prototype.getFirstVisibleRow=function(){return this._grid.realizedRows[this._gridOffset]},T.prototype._isAutoSized=function(){return this.owner.owner.autoSizeHeight},T.prototype.applyScrolling=function(){var e,t=this.dimension.getFractionScrollOffset(),i=this.getFirstVisibleRow();i&&(e=i.getContextualWidth(),this.scroll(i,e,t))},T.prototype.scroll=function(e,t,i){this.scrollCells(e._realizedRowHeaders,t,i),this.scrollCells(e._realizedBodyCells,t,i)},T.prototype.scrollCells=function(e,t,i){for(var o=e.length,r=0;r<o;r++)e[r].scrollVertically(t,i)},T.prototype.getFooterContextualWidth=function(){return this.owner.owner.rowDimension.hasFooter()&&this.owner.grid.footerRow?this.owner.grid.footerRow.getContextualWidth():0},T.prototype.calculateContextualWidths=function(){var e;g.prototype.calculateContextualWidths.call(this),this.fixedSizeEnabled&&(e=this._grid.footerRow)&&this._calculateSize(e)},T.prototype.fixSizes=function(){g.prototype.fixSizes.call(this),this.fixedSizeEnabled&&this._grid.footerRow&&this._grid.footerRow.fixSize()},T.prototype._sendDimensionsToControl=function(){var e=this.getGridContextualWidth(),t=this.getActualContextualWidth(e),i=this.getOtherHierarchyContextualHeight(),o=this.getGridScale();this.owner.owner.updateRowDimensions(i/o,(t-i)/o,e/o,this.getViewSize(e),this._grid.footerRow?this._grid.footerRow.getContextualWidth()/o:0)},T.prototype.getEstimatedHeaderWidth=function(e,t){return-1},e=T,i.RowLayoutManager=e,__extends(M,m=e),M.prototype.getEstimatedHeaderWidth=function(e,t){return this.getHeaderWidth(t)},M.prototype.canScroll=function(e){return!1},M.prototype._calculateSize=function(e){return e.calculateSize()},M.prototype.getHeaderWidth=function(e){return 0!==e||this.owner.binder.hasRowGroups()?this.owner.getEstimatedTextWidth(void 0):0},f=M,i.DashboardRowLayoutManager=f,__extends(R,y=e),R.prototype.getEstimatedHeaderWidth=function(e,t){return this.owner.getEstimatedTextWidth(e)},R.prototype.canScroll=function(e){return!h.Double.equalWithPrecision(this.dimension.scrollOffset,0,n._scrollOffsetPrecision)||this.getRealizedItemsCount()-this._gridOffset<this.dimension.getItemsCount()&&0<this._contextualWidthToFill||h.Double.greaterWithPrecision(e,this._contextualWidthToFill,n._pixelPrecision)},R.prototype._calculateSize=function(e){return e.calculateSize()},v=R,i.CanvasRowLayoutManager=v,_.prototype.initialize=function(e){this._owner=e,this._container=e.container,this._gridHost=e.contentHost,this._footersHost=e.footerHost,this._grid.initialize(e,this._gridHost,this._footersHost)},Object.defineProperty(_.prototype,"owner",{get:function(){return this._owner},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"binder",{get:function(){return this._binder},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"columnWidthsToPersist",{get:function(){return this._columnWidthsToPersist},set:function(e){this._columnWidthsToPersist=e},enumerable:!1,configurable:!0}),_.prototype.getTablixClassName=function(){return null},_.prototype.getLayoutKind=function(){return null},_.prototype.getOrCreateColumnHeader=function(e,t,i,o){var r=this.owner.hierarchyNavigator,i=this._grid.getOrCreateRow(i),n=this._grid.getOrCreateColumn(o+this._columnLayoutManager._gridOffset),a=r.isLeaf(e),i=i.getOrCreateColumnHeader(n,this._columnLayoutManager.isScrollableHeader(e,t,o),a),n=r.getLevel(e),o=(i.position.row.index=i.position.row.indexInSiblings=n,i.position.row.isFirst=0===n,i.position.row.isLast=a,r.getIndex(e));return i.position.column.index=i.position.column.indexInSiblings=o,i.position.column.isFirst=r.areAllParentsFirst(e,t),i.position.column.isLast=r.areAllParentsLast(e,t),this.enableCellHorizontalResize(a,i),i},_.prototype.getOrCreateRowHeader=function(e,t,i,o){var r=this.owner.hierarchyNavigator,n=this._grid.getOrCreateRow(i+this._rowLayoutManager._gridOffset),o=this._grid.getOrCreateColumn(o),a=r.isLeaf(e),i=this._rowLayoutManager.isScrollableHeader(e,t,i),n=(0===n.getRealizedCellCount()&&this.alignRowHeaderCells(e,n),n.getOrCreateRowHeader(o,i,r.isLeaf(e))),o=r.getIndex(e),i=(n.position.row.index=n.position.row.indexInSiblings=o,n.position.row.isFirst=r.areAllParentsFirst(e,t),n.position.row.isLast=r.areAllParentsLast(e,t),r.getLevel(e));return n.position.column.index=n.position.column.indexInSiblings=i,n.position.column.isFirst=0===i,n.position.column.isLast=a,n.enableHorizontalResize(!1,this._columnLayoutManager),n},_.prototype.getOrCreateCornerCell=function(e,t,i){var o=this._grid.getOrCreateRow(i),r=this._grid.getOrCreateColumn(t),n=i===this._columnLayoutManager.dimension.getDepth()-1,o=o.getOrCreateCornerCell(r),r=i,i=(o.position.row.index=o.position.row.indexInSiblings=r,o.position.row.isFirst=0===r,o.position.row.isLast=n,t);return o.position.column.index=o.position.column.indexInSiblings=i,o.position.column.isFirst=0===i,o.position.column.isLast=i===this._rowLayoutManager.dimension.getDepth()-1,this.enableCellHorizontalResize(n,o),o},_.prototype.getOrCreateBodyCell=function(e,t,i,o,r){var n=this._grid.getOrCreateRow(o+this._rowLayoutManager._gridOffset),r=this._grid.getOrCreateColumn(r+this._columnLayoutManager._gridOffset),t=0===n._realizedBodyCells.length&&0!==this._owner.columnDimension.getFractionScrollOffset()||this._rowLayoutManager.isScrollableHeader(t,i,o),i=n.getOrCreateBodyCell(r,t);return i.position=e.position,i.enableHorizontalResize(!1,this._columnLayoutManager),i},_.prototype.getOrCreateFooterBodyCell=function(e,t){var i=this._grid.getOrCreateFootersRow(),t=this._grid.getOrCreateColumn(t+this._columnLayoutManager._gridOffset),o=0===i._realizedBodyCells.length&&0!==this._owner.columnDimension.getFractionScrollOffset(),i=i.getOrCreateFooterBodyCell(t,o);return i.position=e.position,i.enableHorizontalResize(!1,this._columnLayoutManager),i},_.prototype.getOrCreateFooterRowHeader=function(e,t){var i=this._grid.getOrCreateFootersRow(),o=this._grid.getOrCreateColumn(0),i=i.getOrCreateFooterRowHeader(o);return i.position=void 0,i.enableHorizontalResize(!1,this._columnLayoutManager),i},_.prototype.getVisibleWidth=function(){return-1},_.prototype.getVisibleHeight=function(){return-1},_.prototype.updateColumnCount=function(e,t){},_.prototype.updateViewport=function(e){},_.prototype.getEstimatedRowHeight=function(){return-1},_.prototype.getCellWidth=function(e){return-1},_.prototype.getContentWidth=function(e){return-1},_.prototype.adjustContentSize=function(e){},_.prototype.alignRowHeaderCells=function(e,t){var i,o=t.getRowHeaderLeafIndex();-1!==o&&(i=this._owner.rowDimension.getFirstVisibleChildLeaf(e),this.owner.hierarchyNavigator.headerItemEquals(i,t.getAllocatedCellAt(o).item))&&t.moveCellsBy(this.owner.hierarchyNavigator.getLevel(i)-this.owner.hierarchyNavigator.getLevel(e)-o)},Object.defineProperty(_.prototype,"grid",{get:function(){return this._grid},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"rowLayoutManager",{get:function(){return this._rowLayoutManager},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"columnLayoutManager",{get:function(){return this._columnLayoutManager},enumerable:!1,configurable:!0}),_.prototype.showEmptySpaceHeader=function(){return!1},_.prototype.onStartRenderingSession=function(e,t,i){var o;this.showEmptySpaceHeader()&&((o=this._grid.emptySpaceHeaderCell)&&this._binder.unbindEmptySpaceHeaderCell(o),(o=this._grid.emptySpaceFooterCell)&&this._binder.unbindEmptySpaceFooterCell(o),this._grid.HideEmptySpaceCells()),this._scrollingDimension=e,this._scrollingDimension&&this._scrollingDimension.layoutManager.startScrollingSession(),this._rowLayoutManager.onStartRenderingSession(),this._columnLayoutManager.onStartRenderingSession(),this._grid.onStartRenderingSession(i),(this._columnLayoutManager.measureEnabled||this._rowLayoutManager.measureEnabled)&&this.measureSampleText(t)},_.prototype.onEndRenderingSession=function(){var e;this._rowLayoutManager.onEndRenderingSession(),this._columnLayoutManager.onEndRenderingSession(),this._scrollingDimension&&this._scrollingDimension.layoutManager.endScrollingSession(),this._scrollingDimension=null,this.showEmptySpaceHeader()&&0<(e=this._columnLayoutManager.contextualWidthToFill-this._columnLayoutManager.getGridContextualWidth())&&(this._grid.ShowEmptySpaceCells(this._owner.columnDimension.getDepth(),e),(e=this._grid.emptySpaceHeaderCell)&&this._binder.bindEmptySpaceHeaderCell(e),e=this._grid.emptySpaceFooterCell)&&this._binder.bindEmptySpaceFooterCell(e)},_.prototype.onStartRenderingIteration=function(e){this._rowLayoutManager.onStartRenderingIteration(e,this.getVisibleHeight()),this._columnLayoutManager.onStartRenderingIteration(e,this.getVisibleWidth()),this._grid.onStartRenderingIteration()},_.prototype.onEndRenderingIteration=function(){return this._grid.onEndRenderingIteration(),this._columnLayoutManager.calculateSizes(),this._rowLayoutManager.calculateSizes(),this._columnLayoutManager.fixSizes(),this._rowLayoutManager.fixSizes(),this._columnLayoutManager.updateItemToResizeState(this._grid.realizedColumns),this._columnLayoutManager.applyScrolling(),this._rowLayoutManager.applyScrolling(),this._columnLayoutManager.onEndRenderingIteration(),this._rowLayoutManager.onEndRenderingIteration(),this._columnLayoutManager.done&&this._rowLayoutManager.done},_.prototype.onCornerCellRealized=function(e,t){var i=this.owner.hierarchyNavigator.isColumnHierarchyLeaf(e),o=this.owner.hierarchyNavigator.isRowHierarchyLeaf(e);i&&t._column.OnLeafRealized(this._owner.hierarchyNavigator),this._columnLayoutManager.onCornerCellRealized(e,t,i),this._rowLayoutManager.onCornerCellRealized(e,t,o)},_.prototype.onRowHeaderRealized=function(e,t){var i=this._owner.hierarchyNavigator.isLeaf(e),o=t;1<o.colSpan&&o.setContainerWidth(-1),this._rowLayoutManager.onHeaderRealized(e,t,i)},_.prototype.onRowHeaderFooterRealized=function(e,t){},_.prototype.onColumnHeaderRealized=function(e,t){var i=this._owner.hierarchyNavigator.isLeaf(e);i&&t._column.OnLeafRealized(this._owner.hierarchyNavigator),this._columnLayoutManager.onHeaderRealized(e,t,i)},_.prototype.onBodyCellRealized=function(e,t){},_.prototype.onBodyCellFooterRealized=function(e,t){},_.prototype.setAllowHeaderResize=function(e){this._allowHeaderResize=e},_.prototype.enableCellHorizontalResize=function(e,t){e=e&&this._allowHeaderResize;t.enableHorizontalResize(e,this._columnLayoutManager)},_.prototype.getEstimatedTextWidth=function(e){return-1},_.prototype.measureSampleText=function(e){},e=_,i.TablixLayoutManager=e,__extends(I,b=e),I.createLayoutManager=function(e){var t=new o;return new I(e,t,new i.TablixGrid(new i.DashboardTablixGridPresenter(t)),new i.RowRealizationManager(e),new i.ColumnRealizationManager(e))},I.prototype.getTablixClassName=function(){return"tablixDashboard"},I.prototype.getLayoutKind=function(){return 1},I.prototype.showEmptySpaceHeader=function(){return!1},I.prototype.measureSampleText=function(e){e=h.TextMeasurementService.getSvgMeasurementProperties(e);this._characterHeight=h.TextMeasurementService.estimateSvgTextHeight(e),this._sizeComputationManager.updateRowHeight(this._characterHeight);e=t.toPoint(parseFloat(e.fontSize))/a.TablixDefaultTextSize;this._sizeComputationManager.updateScalingFactor(h.Double.toIncrement(e,.05))},I.prototype.getVisibleWidth=function(){return this._sizeComputationManager.visibleWidth},I.prototype.getVisibleHeight=function(){return this._sizeComputationManager.visibleHeight},I.prototype.getCellWidth=function(e){return this._sizeComputationManager.cellWidth},I.prototype.getContentWidth=function(e){return this._sizeComputationManager.contentWidth},I.prototype.getEstimatedTextWidth=function(e){return this._sizeComputationManager.contentWidth},I.prototype.adjustContentSize=function(e){this._sizeComputationManager.hasImageContent=e},I.prototype.updateColumnCount=function(e,t){e=(e?e.getDepth():0)+(t?t.getItemsCount():0);this.binder.hasRowGroups()||e--,this._sizeComputationManager.updateColumnCount(e)},I.prototype.updateViewport=function(e){this._sizeComputationManager.updateViewport(e)},I.prototype.getEstimatedRowHeight=function(){return this._characterHeight},i.DashboardTablixLayoutManager=I,__extends(L,r=e),L.createLayoutManager=function(e,t){return new L(e,new i.TablixGrid(new a.internal.CanvasTablixGridPresenter(t)),new i.RowRealizationManager(e),new i.ColumnRealizationManager(e))},L.prototype.getTablixClassName=function(){return"tablixCanvas"},L.prototype.getLayoutKind=function(){return 0},L.prototype.measureSampleText=function(e){var t=a.internal.TablixUtils.createDiv(),i=(t.style.cssFloat="left",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.lineHeight="normal",e.appendChild(t),document.createTextNode("a"));t.appendChild(i),this.characterWidth=a.HTMLElementUtils.getElementWidth(t),this.characterHeight=a.HTMLElementUtils.getElementHeight(t),t.removeChild(i),e.removeChild(t)},L.prototype.showEmptySpaceHeader=function(){return!this._columnLayoutManager.fillProportionally},L.prototype.getVisibleWidth=function(){return this._columnLayoutManager.measureEnabled?this._owner.autoSizeWidth&&this._owner.maxWidth?this._owner.maxWidth:a.HTMLElementUtils.getElementWidth(this._container):-1},L.prototype.getVisibleHeight=function(){return this._rowLayoutManager.measureEnabled?this._owner.autoSizeHeight&&this._owner.maxHeight?this._owner.maxHeight:a.HTMLElementUtils.getElementHeight(this._container):-1},L.prototype.getCellWidth=function(e){return e.containerWidth},L.prototype.getContentWidth=function(e){return e.contentWidth},L.prototype.getEstimatedTextWidth=function(e){return e?e.length*this.characterWidth:0},L.prototype.updateColumnCount=function(e,t){},L.prototype.updateViewport=function(e){},L.prototype.getEstimatedRowHeight=function(){return this.characterHeight},i.CanvasTablixLayoutManager=L}(powerbi=powerbi||{}),function(e){var o;e=(e=e.visuals||(e.visuals={})).controls||(e.controls={}),(o=e.HTMLElementUtils||(e.HTMLElementUtils={})).clearChildren=function(e){if(e)for(;e.hasChildNodes();)e.removeChild(e.firstChild)},o.setElementTop=function(e,t){e.style.top=t+"px"},o.setElementLeft=function(e,t){e.style.left=t+"px"},o.setElementHeight=function(e,t){o.isAutoSize(t)?e.style.height="":e.style.height=t+"px"},o.setElementWidth=function(e,t){o.isAutoSize(t)?e.style.width="":e.style.width=t+"px"},o.getElementWidth=function(e){return e.offsetWidth},o.getElementHeight=function(e){return e.offsetHeight},o.isAutoSize=function(e){return-1===e},o.getAccumulatedScale=function(e){var t=e.offsetWidth;return 0===t?1:e.getBoundingClientRect().width/t},o.getRelativeMouseCoordinates=function(e,t){var i=e.getBoundingClientRect(),e=o.getAccumulatedScale(e);return{x:(t.pageX-i.left)/e,y:(t.pageY-i.top)/e}}}(powerbi=powerbi||{}),function(i){var o,t,r,n,a,l,s,h,u,d,e,c;function p(e,t){this.applyParams(!0,e,t)}function g(e,t){void 0===e&&(e=h.CellPaddingLeft),void 0===t&&(t=h.CellPaddingRight),this.borders={},this.paddings={top:0,left:e,bottom:0,right:t},this.fontColor="",this.fontFamily="",this.backColor=""}function m(){this.row=new c,this.column=new c}function f(e,t,i,o,r,n,a,l,s,u){this.dataPoint=e,this.objects=t,this.isRowSubTotal=i,this.isColumnSubTotal=o,this.isRowGrandTotal=r,this.isColumnGrandTotal=n,this.columnMetadata=a,this.formatter=l,this.tooltipFormatter=s,this.type=u,this.position=new h.CellPosition,l?this.cachedTextContent=this.formatter.format(e,t):null!=this.dataPoint?this.cachedTextContent=e:this.cachedTextContent=""}function y(){var e=document.createElement("div");return e.className=h.CssClassTablixDiv,e}function b(e,t){e=o.KpiUtil.getClassForKpi(e,t)||"";return n.div().addClass(e).css({display:"inline-block","vertical-align":"bottom",margin:"0"})}function v(e,t){return o.converterHelper.isImageUrlColumn(t)&&!e.isSubtotal&&!!e.identity}function C(e,t){return!(!e||void 0===t||!o.KpiUtil.getClassForKpi(e,t))}function w(e){return 2===e?1:2}function x(e,t){var i=document.createElement("i");return i.className=d+" "+(t?"sorted":"future")+" "+(1===e?"powervisuals-glyph caret-up":"powervisuals-glyph caret-down"),i}function S(e){var t,i,o,r=[];for(e.sort(function(e,t){return e.left-t.left});0<e.length;)if(1===e.length)r.push(e.shift());else{for(var n=e[0],a=1;a<e.length;++a)i=n,o=e[a],(Math.abs(i.left+i.width-o.left)<=4||Math.abs(o.left+o.width-i.left)<=4)&&i.top===o.top&&i.height===o.height&&(i=n,o=e[a],t=void 0,t=i.left<o.left,n={left:Math.min(i.left,o.left),width:t?o.left+o.width-i.left:i.left+i.width-o.left,top:i.top,height:i.height},e.splice(a,1),--a);r.push(n),e.shift()}var l,s,u,h=[];for(r.sort(function(e,t){return e.top-t.top});0<r.length;)if(1===r.length)h.push(r.shift());else{for(n=r[0],a=1;a<r.length;++a)s=n,u=r[a],(Math.abs(s.top+s.height-u.top)<=4||Math.abs(u.top+u.height-s.top)<=4)&&s.left===u.left&&s.width===u.width&&(s=n,u=r[a],l=void 0,l=s.top<u.top,n={left:s.left,width:s.width,top:Math.min(s.top,u.top),height:l?u.top+u.height-s.top:s.top+s.height-u.top},r.splice(a,1),--a);h.push(n),r.shift()}return h}function P(e){return e+2}function H(e){return e+2}o=i.visuals||(i.visuals={}),t=o.controls||(o.controls={}),r=t.internal||(t.internal={}),n=InJs.DomFactory,a=jsCommon.UrlUtils.UrlScheme,l=jsCommon.UrlUtils,s=i.visuals.controls.pivotTable.TablixSection,(h=r.TablixUtils||(r.TablixUtils={})).PreferredLoadMoreThreshold=.8,h.TotalLabel="TableTotalLabel",h.ValueLabel="Visual_LabelText_Value",h.RowSelection="Row_Selection",h.SelectRow="SelectRow",h.SelectedLabel="Row_Selected",h.UnselectedLabel="Row_Unselected",h.AdditionalConditionalFormatting="Additional_Conditional_Formatting",h.ScrollUpLabel="DecompositionTree_ScrollLevelUp_Tooltip",h.ScrollDownLabel="DecompositionTree_ScrollLevelDown_Tooltip",h.ScrollLeftLabel="Scroll_Left",h.ScrollRightLabel="Scroll_Right",h.CssClassTablixDiv="tablixDiv",h.CssClassContentElement="tablixCellContentElement",h.CssClassContentHost="tablixCellContentHost",h.CssClassWrappingContainer="tablixWrappingContainer",h.CssClassTablixHeader="tablixHeader",h.CssClassTablixColumnHeaderLeaf="tablixColumnHeaderLeaf",h.CssClassTablixValueNumeric="tablixValueNumeric",h.CssClassTablixValueTotal="tablixValueTotal",h.CssClassValueURLIcon="powervisuals-glyph tablixUrlIconGlyph",h.CssClassValueURLIconContainer="tablixValueUrlIcon",h.CssClassImageContainer="tablixImageContainer",h.CssClassMatrixRowHeaderLeaf="matrixRowHeaderLeaf",h.CssClassMatrixRowHeaderSubTotal="matrixRowHeaderSubTotal",h.CssClassTableFooter="tableFooterCell",h.CssClassTableBodyCell="tableBodyCell",h.CssClassTableBodyCellBottom="tableBodyCellBottom",h.CssClassPivotTableCell="tablixCell",h.CSSClassPivotTableAlignLeft="tablixAlignLeft",h.CSSClassPivotTableAlignCenter="tablixAlignCenter",h.CSSClassPivotTableAlignRight="tablixAlignRight",h.StringNonBreakingSpace="&nbsp;",h.UnitOfMeasurement="px",d="tablixSortIconContainer",h.CellPaddingLeft=10,h.CellPaddingRight=5,h.CellPaddingLeftMatrixTotal=5,h.SortIconPadding=5,h.ImageDefaultAspectRatio=1,h.FontFamilyCell=o.Font.Family.regular.css,h.FontFamilyHeader=o.Font.Family.regular.css,h.FontFamilyTotal=o.Font.Family.bold.css,h.FontFamilyGlyphs=o.Font.Family.glyphs.css,h.FontColorCells="#333",h.FontColorHeaders="#666",h.WordWrappingMaxLines=Number.POSITIVE_INFINITY,h.SortIconFontSizeRatio=.71,(e=u=h.EdgeType||(h.EdgeType={}))[e.Outline=0]="Outline",e[e.Gridline=1]="Gridline",p.prototype.applyParams=function(e,t,i,o){e?(this.weight=null==t?0:t,this.color=null==i?"black":i,this.type=null==o?u.Gridline:o):(this.weight=0,this.color="black",this.type=u.Gridline)},p.prototype.getCSS=function(){var e=[];return _.isNumber(this.weight)&&(e.push(this.weight+h.UnitOfMeasurement),this.color&&e.push(this.color),e.push("solid")),e.join(" ")},p.prototype.getPriority=function(e){return this===e.top||this===e.bottom?this.type===u.Outline?2:0:this===e.right||this===e.left?this.type===u.Outline?3:1:-1},p.prototype.getShadowCss=function(e){var t=this.weight?this.weight+5:0,i="inset ";if(this===e.left)i+=t+h.UnitOfMeasurement+" 0";else if(this===e.right)i+="-"+t+h.UnitOfMeasurement+" 0";else if(this===e.top)i+="0 "+t+h.UnitOfMeasurement;else{if(this!==e.bottom)return"";i+="0 -"+t+h.UnitOfMeasurement}return i+" 0 -".concat(5,"px ")+this.color},e=p,h.EdgeSettings=e,g.prototype.applyStyle=function(e){var e=e.extension.contentHost.style,t=this.buildFontAttributeValue();null!=t?e.font=t:(e.fontFamily=this.fontFamily,e.fontSize=this.fontSize?jsCommon.PixelConverter.toString(this.fontSize.px):void 0,e.fontWeight=this.fontWeight,e.fontStyle=this.fontStyle,e.textDecoration=this.textDecoration),e.color=this.fontColor,e.backgroundColor=this.backColor,e.boxShadow=this.getBoxShadow(),e.border="none",e.paddingTop=this.getPaddingTop(),e.paddingRight=this.getPaddingRight(),e.paddingBottom=this.getPaddingBottom(),e.paddingLeft=this.getPaddingLeft(),e.maxWidth=this.maxWidth},g.prototype.getPaddingTop=function(){return(null==this.paddings.top?0:this.paddings.top)+(null==this.borders.top?0:this.borders.top.weight)+h.UnitOfMeasurement},g.prototype.getPaddingBottom=function(){return(null==this.paddings.bottom?0:this.paddings.bottom)+(null==this.borders.bottom?0:this.borders.bottom.weight)+h.UnitOfMeasurement},g.prototype.getPaddingRight=function(){return(null==this.paddings.right?h.CellPaddingRight:this.paddings.right)+(null==this.borders.right?0:this.borders.right.weight)+h.UnitOfMeasurement},g.prototype.getPaddingLeft=function(){return(null==this.paddings.left?h.CellPaddingLeft:this.paddings.left)+(null==this.borders.left?0:this.borders.left.weight)+h.UnitOfMeasurement},g.prototype.getBoxShadow=function(){var e,t=[];return(null==(e=this.borders.left)?void 0:e.type)===u.Outline&&0!==this.borders.left.weight&&t.push(this.borders.left.getShadowCss(this.borders)),(null==(e=this.borders.right)?void 0:e.type)===u.Outline&&0!==this.borders.right.weight&&t.push(this.borders.right.getShadowCss(this.borders)),(null==(e=this.borders.bottom)?void 0:e.type)===u.Outline&&0!==this.borders.bottom.weight&&t.push(this.borders.bottom.getShadowCss(this.borders)),(null==(e=this.borders.top)?void 0:e.type)===u.Outline&&0!==this.borders.top.weight&&t.push(this.borders.top.getShadowCss(this.borders)),(null==(e=this.borders.left)?void 0:e.type)===u.Gridline&&0!==this.borders.left.weight&&t.push(this.borders.left.getShadowCss(this.borders)),(null==(e=this.borders.right)?void 0:e.type)===u.Gridline&&0!==this.borders.right.weight&&t.push(this.borders.right.getShadowCss(this.borders)),(null==(e=this.borders.bottom)?void 0:e.type)===u.Gridline&&0!==this.borders.bottom.weight&&t.push(this.borders.bottom.getShadowCss(this.borders)),(null==(e=this.borders.top)?void 0:e.type)===u.Gridline&&0!==this.borders.top.weight&&t.push(this.borders.top.getShadowCss(this.borders)),t.join(", ")},g.prototype.setAttributes=function(e,t,i,o){e["padding-top"]=this.getPaddingTop(),e["padding-right"]=this.getPaddingRight(),e["padding-bottom"]=this.getPaddingBottom(),e["padding-left"]=this.getPaddingLeft();var r=this.buildFontAttributeValue();null!=r?e.font=r:(_.isEmpty(this.fontFamily)||(e["font-family"]=this.fontFamily),null!=this.fontSize&&(e["font-size"]=jsCommon.PixelConverter.toString(this.fontSize.px)),null!=this.fontWeight&&(e["font-weight"]=this.fontWeight),_.isEmpty(this.fontStyle)||(e["font-style"]=this.fontStyle)),_.isEmpty(this.textDecoration)||(e["text-decoration"]=this.textDecoration),_.isEmpty(this.fontColor)||(e.color=this.fontColor),_.isEmpty(this.backColor)||(e["background-color"]=this.backColor),!o&&(t||i)||(r=this.getBoxShadow(),_.isEmpty(r))||(e["box-shadow"]=r),_.isEmpty(this.maxWidth)||(e["max-width"]=this.maxWidth),(t||i)&&(e["--outline-top"]=this.borders.top?this.borders.top.weight+1+"px":"1px",e["--outline-right"]=this.borders.right?this.borders.right.weight+1+"px":"1px",e["--outline-bottom"]=this.borders.bottom?this.borders.bottom.weight+1+"px":"1px",e["--outline-left"]=this.borders.left?this.borders.left.weight+1+"px":"1px")},g.prototype.getAttributes=function(e,t,i){var o={};return this.setAttributes(o,e,t,i),o},g.prototype.getExtraTop=function(){var e=0;return this.paddings.top&&(e+=this.paddings.top),this.borders.top&&(e+=this.borders.top.weight),e},g.prototype.getExtraBottom=function(){var e=0;return this.paddings.bottom&&(e+=this.paddings.bottom),this.borders.bottom&&(e+=this.borders.bottom.weight),e},g.prototype.getExtraRight=function(){var e=0;return this.paddings.right&&(e+=this.paddings.right),this.borders.right&&(e+=this.borders.right.weight),e},g.prototype.getExtraLeft=function(){var e=0;return this.paddings.left&&(e+=this.paddings.left),this.borders.left&&(e+=this.borders.left.weight),e},g.prototype.buildFontAttributeValue=function(){var e=!_.isEmpty(this.fontFamily),t=null!=this.fontSize,i=null!=this.fontWeight,o=null!=this.fontStyle;return e&&t?(i?"".concat(this.fontWeight," "):"")+(o?"".concat(this.fontStyle," "):"")+"".concat(jsCommon.PixelConverter.toString(this.fontSize.px)," ").concat(this.fontFamily):null},h.CellStyle=g,c=function(){},h.DimensionPosition=c,m.prototype.isMatch=function(e){return this.column.index===e.column.index&&this.row.index===e.row.index},e=m,h.CellPosition=e,Object.defineProperty(f.prototype,"isTotal",{get:function(){return this.isSubtotal||this.isGrandTotal},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isSubtotal",{get:function(){return this.isColumnSubTotal||this.isRowSubTotal},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isGrandTotal",{get:function(){return this.isColumnGrandTotal||this.isRowGrandTotal},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"textContent",{get:function(){return this.cachedTextContent},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"tooltipContent",{get:function(){return void 0===this.cachedTooltipContent&&(this.tooltipFormatter?this.cachedTooltipContent=this.tooltipFormatter.format(this.dataPoint,this.objects):this.cachedTooltipContent=this.textContent),this.cachedTooltipContent},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isKpi",{get:function(){return this.columnMetadata&&C(this.columnMetadata.kpi,this.textContent)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"kpiContent",{get:function(){if(this.isKpi)return b(this.columnMetadata.kpi,this.textContent)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isNumeric",{get:function(){if(this.columnMetadata)return this.columnMetadata.type.numeric&&!this.columnMetadata.kpi},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isUrl",{get:function(){if(this.columnMetadata)return o.converterHelper.isWebUrlColumn(this.columnMetadata)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isImage",{get:function(){if(this.columnMetadata)return o.converterHelper.isImageUrlColumn(this.columnMetadata)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isValidUrl",{get:function(){return h.getUrlScheme(this.columnMetadata,this.textContent)!==a.NONE},enumerable:!1,configurable:!0}),f.prototype.isMatch=function(e){return this.position.isMatch(e.position)&&this.backColor===e.backColor},e=f,h.TablixVisualCell=e,h.createTable=function(){return document.createElement("table")},h.createDiv=y,h.resetCellCssClass=function(e){e.extension.contentElement.className=h.CssClassTablixDiv+" "+h.CssClassContentElement,e.extension.contentHost.className=h.CssClassTablixDiv+" "+h.CssClassContentHost},h.addCellCssClass=function(e,t){e.extension.contentHost.className+=" "+t},h.clearCellStyle=function(e){e.extension.contentHost.className="",e.extension.contentHost.style.cssText=""},h.clearCellTextAndTooltip=function(e){e.extension.contentHost.textContent="",e.extension.contentHost.removeAttribute("title"),e.contentHeight=e.contentWidth=0,t.HTMLElementUtils.clearChildren(e.extension.contentHost)},h.setCellTextAndTooltip=function(e,t,i){h.setCellText(e,t),h.setCellTooltip(e,i||t)},h.setCellText=function(e,t){t.textContent=o.TextUtil.replaceSpaceWithNBSP(e)},h.setCellTooltip=function(e,t){t.title=e},h.appendDiv=function(e,t){var i=y();return e.appendChild(i),t&&(i.textContent=t),i},h.isValidSortClick=function(e){var t=e.target;return 0<=(e=e.offsetX)&&e<t.offsetWidth-r.TablixResizer.resizeHandleSize},h.appendATagToBodyCell=function(e,t,i){var o=null;0===t.childElementCount?(o=document.createElement("a"),t.appendChild(o)):o=t.children[0],o.href=e,o.target="_blank",o.rel="noopener noreferrer",o.title=e,null!=i?(o.className=h.CssClassValueURLIcon+" "+i,$(t).addClass(h.CssClassValueURLIconContainer)):o.innerText=e},h.appendImgTagToBodyCell=function(e,t,i){var o=h.createDiv(),r=document.createElement("img");o.style.height=i+"px",o.style.width="100%",o.style.textAlign="center",r.src=e,r.style.maxHeight="100%",r.style.maxWidth="100%",o.appendChild(r),t.appendChild(o),t.title=e},h.createKpiDom=b,h.getUrlScheme=function(e,t){return o.converterHelper.isWebUrlColumn(e)?l.getUrlScheme(t):a.NONE},h.getUrlIconName=function(e){switch(e){case a.file:case a.ftp:return"page2";case a.mailto:return"mail";case a.news:return"link";case a.telnet:return"pc1";case a.http:case a.https:return"link";default:return null}},h.isValidImage=function(e,t,i){return v(e,t)&&l.isValidImageUrl(i)},h.isImage=v,h.isValidStatusGraphic=C,h.getCustomSortEventArgs=function(e,t){return{sortDescriptors:[{queryName:e,sortDirection:t}]}},h.reverseSort=w,h.addSortIconToColumnHeader=function(e,t){var i=h.createDiv(),e=(e?(i.appendChild(x(e,!0)),i.appendChild(x(w(e),!1))):i.appendChild(x(2,!1)),h.createDiv());return i.appendChild(e),t.appendChild(i),e},h.removeSortIcons=function(e){!function(e){for(var t=0,i=e.extension.contentElement.childElementCount;t<i;t++)if(e.extension.contentElement.children.item(t).classList.contains(d))return 1}(e)||$(e.extension.contentElement).find("."+d).remove()},h.convertValueToString=function(e,t){return t&&i.isDateWithEpochValue(e)&&(e=i.PBIFormattingDate.fromDateWithEpochValue(e).toString()),String(e)},h.mergeAdjacentCellsIntoRegions=function(e){return S(e.nodes().map(function(e){e=e.getBoundingClientRect();return{left:e.x,top:e.y,width:e.width,height:e.height}}))},h.mergeAdjacentRectsIntoRegions=S,(e=r.TableExUtils||(r.TableExUtils={})).getItemByElement=function(e,t){return(t=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(t,function(e){return e.matches('[role="gridcell"]')},e,!0))?d3.select(t).datum():void 0},e.getHeaderCell=function(e,t){return t+=2,d3.select(e).select('[aria-colindex="'.concat(t,'"]')).node()},e.getBodyCell=function(e,t,i){return t+=2,i+=2,d3.select(e).select('[aria-rowindex="'.concat(t,'"] [aria-colindex="').concat(i,'"]')).node()},e.getFooterCell=function(e,t){return t+=2,d3.select(e).select('[aria-colindex="'.concat(t,'"]')).node()},e.getAriaRowIndex=P,e.getAriaColIndex=H,e.getRowIndex=function(e){return+(e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[aria-rowindex]")},void 0,!0)).getAttribute("aria-rowindex")-2},e.getColumnIndex=function(e){return+(e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[aria-colindex]")},void 0,!0)).getAttribute("aria-colindex")-2},e.getRowLevel=function(e){return+(e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[rowLevel]")},void 0,!0)).getAttribute("rowLevel")},e.getColumnLevel=function(e){return+(e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[columnLevel]")},void 0,!0)).getAttribute("columnLevel")},e.getTablixRowIndex=function(e,t,i){var o=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[aria-rowindex]")||e.matches("[rowIndex]")},void 0,!0);if(!o&&t===s.Footer)return 0;var r,n=+o.getAttribute("aria-rowindex");switch(t){case s.Header:r=n-1;break;case s.Body:r=n-1-i;break;case s.FooterHeader:case s.Footer:r=+o.getAttribute("rowIndex");break;case s.MatrixRowHeader:case s.MatrixCorner:}return r},e.getTablixColumnIndex=function(e,t){return+(e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[aria-colindex]")},void 0,!0)).getAttribute("aria-colindex")-1-t},e.getHierarchyIndices=function(e){return(e=jsCommon.FocusNavigationUtility.getFirstMatchingAncestor(e,function(e){return e.matches("[hierarchyIndices]")},void 0,!0)).getAttribute("hierarchyIndices").split(",").map(function(e){return Number(e)})}}(powerbi=powerbi||{}),function(e){var l;function u(e,t,i,o,r){var n=this,a=(this.scrollBarElementWidth=9,(this.options=r).interactive);this.isTouchEnabled=a&&r.enableTouchSupport,this.mainDiv=l.internal.TablixUtils.createDiv(),this.mainDiv.classList.add(u.TablixTableAreaClassName),this.footerDiv=l.internal.TablixUtils.createDiv(),this.footerDiv.classList.add(u.TablixFooterClassName),this.gridDimensions={},this.containerElement=l.internal.TablixUtils.createDiv(),this.className=t.getTablixClassName(),this.autoSizeWidth=!1,this.autoSizeHeight=!1,this.fontFamily=l.internal.TablixUtils.FontFamilyCell,this.fontColor=l.internal.TablixUtils.FontColorCells,this.fontSize=r.fontSize,o.className=u.TablixContainerClassName,o.appendChild(this.containerElement),this.containerElement.addEventListener("wheel",function(e){n.onWheel(e)}),this.containerElement.appendChild(this.mainDiv),this.containerElement.appendChild(this.footerDiv),this.isTouchEnabled&&(this.InitializeTouchSupport(),this.bindTouchEvents()),this.controlLayoutManager=t,this.controlLayoutManager.initialize(this),this.hierarchyTablixNavigator=e,this.binder=i,this.columnDim=new l.TablixColumnDimension(this),this.rowDim=new l.TablixRowDimension(this),this.columnDim._otherDimension=this.rowDimension,this.rowDim._otherDimension=this.columnDimension,this.InitializeScrollbars(),a||(this.scrollbarWidth=0),this.updateHorizontalPosition(),this.updateVerticalPosition(),this.updateFooterVisibility(),this.lastRenderingArgs={}}e=e.visuals||(e.visuals={}),(l=e.controls||(e.controls={})).TablixDefaultTextSize=jsCommon.TextSizeDefaults.TextSizeMin,u.prototype.InitializeTouchSupport=function(){this.isTouchEventsBound=!1,this.touchManager=new l.TouchUtils.TouchManager,this.touchInterpreter=new l.TouchUtils.TouchEventInterpreter(this.touchManager),this.footerTouchInterpreter=new l.TouchUtils.TouchEventInterpreter(this.touchManager),this.columnTouchDelegate=new l.ColumnTouchDelegate(new l.TouchUtils.Rectangle),this.rowTouchDelegate=new l.RowTouchDelegate(new l.TouchUtils.Rectangle),this.bodyTouchDelegate=new l.BodyTouchDelegate(new l.TouchUtils.Rectangle),this.footerTouchDelegate=new l.ColumnTouchDelegate(new l.TouchUtils.Rectangle),this.columnTouchDelegate.setHandler(this,this.onTouchEvent),this.rowTouchDelegate.setHandler(this,this.onTouchEvent),this.bodyTouchDelegate.setHandler(this,this.onTouchEvent),this.footerTouchDelegate.setHandler(this,this.onTouchEvent),this.touchManager.addTouchRegion(this.columnTouchDelegate.dimension,this.columnTouchDelegate,this.columnTouchDelegate),this.touchManager.addTouchRegion(this.rowTouchDelegate.dimension,this.rowTouchDelegate,this.rowTouchDelegate),this.touchManager.addTouchRegion(this.bodyTouchDelegate.dimension,this.bodyTouchDelegate,this.bodyTouchDelegate),this.touchManager.addTouchRegion(this.footerTouchDelegate.dimension,this.footerTouchDelegate,this.footerTouchDelegate)},u.prototype.unBindTouchEvents=function(){this.isTouchEventsBound&&(this.touchInterpreter.clearAllTouchEvents(),this.footerTouchInterpreter.clearAllTouchEvents(),this.isTouchEventsBound=!1)},u.prototype.bindTouchEvents=function(){this.isTouchEventsBound||(this.touchInterpreter.initTouch(this.mainDiv,null),this.footerTouchInterpreter.initTouch(this.footerDiv,this.mainDiv),this.isTouchEventsBound=!0)},u.prototype.InitializeScrollbars=function(){this.rowDim._initializeScrollbar(this.containerElement,null,this.options.layoutKind);var e=this.rowDim.scrollbar.element.style,e=(e.position="absolute",e.top="0"+u.UnitOfMeasurement,e.right="0"+u.UnitOfMeasurement,this.rowDim.scrollbar.width=this.scrollBarElementWidth+u.UnitOfMeasurement,this.rowDim.scrollbar.show(!0),this.columnDim._initializeScrollbar(this.containerElement,null,this.options.layoutKind),this.columnDim.scrollbar.element.style);e.position="absolute",e.left="0"+u.UnitOfMeasurement,e.bottom="0"+u.UnitOfMeasurement,this.columnDim.scrollbar.height=this.scrollBarElementWidth+u.UnitOfMeasurement,this.columnDim.scrollbar.show(!1)},u.prototype.toggleTouchBindings=function(e){this.isTouchEnabled&&(e?this.bindTouchEvents():this.unBindTouchEvents())},Object.defineProperty(u.prototype,"container",{get:function(){return this.containerElement},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"contentHost",{get:function(){return this.mainDiv},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"footerHost",{get:function(){return this.footerDiv},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"className",{set:function(e){this.containerElement.className=e},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"hierarchyNavigator",{get:function(){return this.hierarchyTablixNavigator},enumerable:!1,configurable:!0}),u.prototype.getBinder=function(){return this.binder},Object.defineProperty(u.prototype,"autoSizeWidth",{get:function(){return this._autoSizeWidth},set:function(e){(this._autoSizeWidth=e)||(this.containerElement.style.minWidth=this.containerElement.style.maxWidth="none")},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"autoSizeHeight",{get:function(){return this._autoSizeHeight},set:function(e){e||(this.containerElement.style.minHeight=this.containerElement.style.maxHeight="none")},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"maxWidth",{get:function(){return this.maximumWidth},set:function(e){this.maximumWidth=e,this.containerElement.style.maxWidth=this.maximumWidth+u.UnitOfMeasurement},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"viewport",{get:function(){return this.viewPort},set:function(e){this.viewPort=e,this.containerElement.style.width=this.viewPort.width+u.UnitOfMeasurement,this.containerElement.style.height=this.viewPort.height+u.UnitOfMeasurement,this.rowDim.scrollbar.invalidateArrange(),this.columnDim.scrollbar.invalidateArrange(),this.controlLayoutManager.updateViewport(this.viewPort)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"maxHeight",{get:function(){return this.maximumHeight},set:function(e){this.maximumHeight=e,this.containerElement.style.maxHeight=this.maximumHeight+u.UnitOfMeasurement},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"minWidth",{get:function(){return this.minimumWidth},set:function(e){this.minimumWidth=e,this.containerElement.style.minWidth=this.minimumWidth+u.UnitOfMeasurement},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"minHeight",{get:function(){return this.minimumHeight},set:function(e){this.minimumHeight=e,this.containerElement.style.minHeight=this.minimumHeight+u.UnitOfMeasurement},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"fontSize",{get:function(){return this.textFontSize},set:function(e){this.textFontSize=e||u.DefaultFontSize,this.containerElement.style.fontSize=this.textFontSize},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"fontFamily",{get:function(){return this.textFontFamily},set:function(e){this.textFontFamily=e,this.containerElement.style.fontFamily=e},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"fontColor",{get:function(){return this.textFontColor},set:function(e){this.textFontColor=e,this.containerElement.style.color=e},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"scrollbarWidth",{set:function(e){this.scrollBarElementWidth=e,this.rowDim.scrollbar.width=this.scrollBarElementWidth+u.UnitOfMeasurement,this.columnDim.scrollbar.height=this.scrollBarElementWidth+u.UnitOfMeasurement},enumerable:!1,configurable:!0}),u.prototype.getIsTouchEventsBound=function(){return!!this.isTouchEventsBound},u.prototype.updateModels=function(e,t,i){this.rowDim.model=t,this.rowDim.modelDepth=this.hierarchyNavigator.getRowHierarchyDepth(),this.columnDim.model=i,this.columnDim.modelDepth=this.hierarchyNavigator.getColumnHierarchyDepth(),e&&(this.rowDim.scrollOffset=0,this.columnDim.scrollOffset=0),this.layoutManager.updateColumnCount(this.rowDim,this.columnDim)},u.prototype.updateColumnDimensions=function(e,t,i){var o=this.gridDimensions;o.columnCount=i,o.rowHierarchyWidth=e,o.columnHierarchyWidth=t},u.prototype.updateRowDimensions=function(e,t,i,o,r){var n=this.gridDimensions;n.rowCount=o,n.rowHierarchyHeight=t,n.rowHierarchyContentHeight=i,n.columnHierarchyHeight=e,n.footerHeight=r},u.prototype.updateTouchDimensions=function(){var e=this.gridDimensions;this.columnTouchDelegate.resize(e.rowHierarchyWidth,0,e.columnHierarchyWidth,e.columnHierarchyHeight),this.columnTouchDelegate.setScrollDensity(e.columnCount/e.columnHierarchyWidth),this.rowTouchDelegate.resize(0,e.columnHierarchyHeight,e.rowHierarchyWidth,e.rowHierarchyHeight),this.rowTouchDelegate.setScrollDensity(e.rowCount/e.rowHierarchyHeight),this.bodyTouchDelegate.resize(e.rowHierarchyWidth,e.columnHierarchyHeight,e.columnHierarchyWidth,e.rowHierarchyHeight),this.bodyTouchDelegate.setScrollDensity(e.columnCount/e.columnHierarchyWidth,e.rowCount/e.rowHierarchyHeight),this.footerTouchDelegate.resize(e.rowHierarchyWidth,e.columnHierarchyHeight+e.rowHierarchyHeight,e.columnHierarchyWidth,e.footerHeight),this.footerTouchDelegate.setScrollDensity(e.columnCount/e.columnHierarchyWidth)},u.prototype.onWheel=function(e){this.determineDimensionToScroll(e,function(e,t){e.scrollbar.onMouseWheel(-1*t)}),0===this.options.layoutKind&&e.preventDefault()},u.prototype.determineDimensionToScroll=function(e,t){this.rowDim.scrollbar.visible?(e.deltaY&&t(this.rowDim,e.deltaY),e.deltaX&&this.columnDim.scrollbar.visible&&t(this.columnDim,e.deltaX)):this.columnDim.scrollbar.visible&&(e.deltaX?t(this.columnDim,e.deltaX):e.deltaY&&t(this.columnDim,e.deltaY))},Object.defineProperty(u.prototype,"layoutManager",{get:function(){return this.controlLayoutManager},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"columnDimension",{get:function(){return this.columnDim},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rowDimension",{get:function(){return this.rowDim},enumerable:!1,configurable:!0}),u.prototype.refresh=function(e){this.render(e,null)},u.prototype._onScrollAsync=function(e){var t=this;requestAnimationFrame(function(){t.performPendingScroll(e)})},u.prototype.performPendingScroll=function(e){this.render(!1,e)},u.prototype.updateHorizontalPosition=function(){this.rowDim.scrollbar.visible?(this.columnDim.scrollbar.element.style.right=this.scrollBarElementWidth+u.UnitOfMeasurement,this.footerDiv.style.right=this.scrollBarElementWidth+u.UnitOfMeasurement,this.mainDiv.style.right=this.scrollBarElementWidth+u.UnitOfMeasurement):(this.columnDim.scrollbar.element.style.right="0"+u.UnitOfMeasurement,this.mainDiv.style.right="0"+u.UnitOfMeasurement,this.footerDiv.style.right="0"+u.UnitOfMeasurement)},u.prototype.updateFooterVisibility=function(){(this.rowDim.hasFooter()?"block"!==this.footerDiv.style.display:"none"!==this.footerDiv.style.display)&&(this.rowDim.hasFooter()?this.footerDiv.style.display="block":this.footerDiv.style.display="none")},u.prototype.updateVerticalPosition=function(){var e,t=this.rowDim.scrollbar.visible,i=1===this.controlLayoutManager.getLayoutKind();t||i?(t=this.footerDiv.offsetHeight,e=i=0,this.columnDim.scrollbar.visible&&(t+=this.scrollBarElementWidth,i+=this.scrollBarElementWidth,e=this.scrollBarElementWidth),this.mainDiv.style.bottom=t+u.UnitOfMeasurement,this.rowDim.scrollbar.element.style.bottom=e+u.UnitOfMeasurement,this.footerDiv.style.bottom=i+u.UnitOfMeasurement,this.footerDiv.style.removeProperty("top")):(this.footerDiv.style.top=this.gridDimensions.rowHierarchyContentHeight+u.UnitOfMeasurement,this.footerDiv.style.removeProperty("bottom"),this.mainDiv.style.removeProperty("bottom"))},u.prototype.alreadyRendered=function(e){return e===this.lastRenderingArgs.scrollingDimension&&this.rowDimension.scrollOffset===this.lastRenderingArgs.rowScrollOffset&&this.columnDimension.scrollOffset===this.lastRenderingArgs.columnScrollOffset},u.prototype.render=function(e,t){if(this.columnDim.makeScrollOffsetValid(),this.rowDim.makeScrollOffsetValid(),e||null===t)this.lastRenderingArgs={};else if(this.alreadyRendered(t))return;for(var i=!1,o=(this.renderIterationCount=0,this.controlLayoutManager.onStartRenderingSession(t,this.mainDiv,e),this.binder),r=(o.onStartRenderingSession(),this.gridDimensions.footerHeight),n=this.gridDimensions.rowHierarchyHeight,a=this.gridDimensions.rowHierarchyContentHeight;!i&&this.renderIterationCount<u.MaxRenderIterationCount;){var l=this.columnDim.scrollbar.visible,s=this.rowDim.scrollbar.visible;this.columnDim._onStartRenderingIteration(),this.rowDim._onStartRenderingIteration(),this.controlLayoutManager.onStartRenderingIteration(e),this.renderCorner(),this.columnDim._render(),this.rowDim._render(),i=this.controlLayoutManager.onEndRenderingIteration(),this.columnDim._onEndRenderingIteration(),this.rowDim._onEndRenderingIteration(),l!==this.columnDim.scrollbar.visible&&this.updateVerticalPosition(),s!==this.rowDim.scrollbar.visible&&this.updateHorizontalPosition(),this.renderIterationCount++}this.controlLayoutManager.onEndRenderingSession(),o.onEndRenderingSession(),this.isTouchEnabled&&this.updateTouchDimensions(),this.lastRenderingArgs.rowScrollOffset=this.rowDimension.scrollOffset,this.lastRenderingArgs.columnScrollOffset=this.columnDimension.scrollOffset,this.updateContainerDimensions();o=this.lastRenderingArgs;o.rowScrollOffset=this.rowDimension.scrollOffset,o.columnScrollOffset=this.columnDimension.scrollOffset,o.scrollingDimension=t,r===this.gridDimensions.footerHeight&&n===this.gridDimensions.rowHierarchyHeight&&a===this.gridDimensions.rowHierarchyContentHeight||this.updateVerticalPosition(),this.options.interactive&&(this.columnDim.scrollbar.refresh(),this.rowDim.scrollbar.refresh())},u.prototype.updateContainerDimensions=function(){var e,t=this.gridDimensions;this._autoSizeWidth&&(e=this.rowDim.scrollbar.visible?this.scrollBarElementWidth:0,this.containerElement.style.width=t.rowHierarchyWidth+t.columnHierarchyWidth+e+u.UnitOfMeasurement),this._autoSizeHeight&&(e=this.columnDim.scrollbar.visible?this.scrollBarElementWidth:0,this.containerElement.style.height=t.columnHierarchyHeight+t.rowHierarchyHeight+t.footerHeight+e+u.UnitOfMeasurement)},u.prototype.cornerCellMatch=function(e,t){var i=t.item;return 0===t.type&&i&&this.hierarchyTablixNavigator.cornerCellItemEquals(e,i)},u.prototype.renderCorner=function(){for(var e=this.columnDim.getDepth(),t=this.rowDim.getDepth(),i=0;i<e;i++)for(var o=0;o<t;o++){var r=this.hierarchyTablixNavigator.getCorner(o,i),n=this.controlLayoutManager.getOrCreateCornerCell(r,o,i);this.cornerCellMatch(r,n)||(this._unbindCell(n),n.type=0,n.item=r,this.binder.bindCornerCell(r,n)),this.controlLayoutManager.onCornerCellRealized(r,n)}},u.prototype._unbindCell=function(e){switch(e.type){case 3:this.binder.unbindBodyCell(e.item,e);break;case 2:this.binder.unbindColumnHeader(e.item,e);break;case 1:this.binder.unbindRowHeader(e.item,e);break;case 0:this.binder.unbindCornerCell(e.item,e)}e.item=null,e.type=null},u.prototype.onTouchEvent=function(e){var t,i;e&&0<e.length&&"columnDim"in e[0]&&"rowDim"in e[0]&&(t=(i=e[0]).columnDim.scrollbar.visible?e[1]:0,e=i.rowDim.scrollbar.visible?e[2]:0,i.columnDim.scrollbar.viewMin=Math.max(0,i.columnDim.scrollbar.viewMin+t),i.columnDim.scrollOffset=Math.max(0,i.columnDim.scrollOffset+t),i.rowDim.scrollbar.viewMin=Math.max(0,i.rowDim.scrollbar.viewMin+e),i.rowDim.scrollOffset=Math.max(0,i.rowDim.scrollOffset+e),0===t?i._onScrollAsync(i.rowDim):0===e?i._onScrollAsync(i.columnDim):i._onScrollAsync(null))},u.UnitOfMeasurement="px",u.TablixContainerClassName="tablixContainer",u.TablixTableAreaClassName="tablixTableArea",u.TablixFooterClassName="tableFooterArea",u.DefaultFontSize=jsCommon.PixelConverter.fromPoint(l.TablixDefaultTextSize),u.MaxRenderIterationCount=10,l.TablixControl=u}(powerbi=powerbi||{}),function(e){var t,i,o=(e=e.visuals||(e.visuals={})).controls||(e.controls={}),e=(r.prototype._onStartRenderingIteration=function(){this.updateScrollPosition()},r.prototype._onEndRenderingIteration=function(){},r.prototype.getValidScrollOffset=function(e){return Math.min(Math.max(e,0),Math.max(this.getItemsCount()-this._scrollStep,0))},r.prototype.makeScrollOffsetValid=function(){this.scrollOffset=this.getValidScrollOffset(this.scrollOffset)},r.prototype.getIntegerScrollOffset=function(){return Math.floor(this.scrollOffset)},r.prototype.getFractionScrollOffset=function(){return this.scrollOffset-this.getIntegerScrollOffset()},Object.defineProperty(r.prototype,"scrollbar",{get:function(){return this._scrollbar},enumerable:!1,configurable:!0}),r.prototype.getFirstVisibleItem=function(e){return this._scrollItems[e]},r.prototype.getFirstVisibleChild=function(e){return this._hierarchyNavigator.getAt(this._hierarchyNavigator.getChildren(e),this.getFirstVisibleChildIndex(e))},r.prototype.getFirstVisibleChildIndex=function(e){var t=this.getFirstVisibleItem(this._hierarchyNavigator.getLevel(e)+1),e=void 0===t||void 0!==t&&this._hierarchyNavigator.getParent(t)!==e?0:this._hierarchyNavigator.getIndex(t);return e},r.prototype._initializeScrollbar=function(e,t,i){var o=this;this._scrollbar=this._createScrollbar(e,i),this._scrollbar._onscroll.push(function(e){return o.onScroll()})},r.prototype.getItemsCount=function(){return this.model?this._hierarchyNavigator.getLeafCount(this.model):0},r.prototype.getDepth=function(){return this.modelDepth},r.prototype.onScroll=function(){this.scrollOffset=this._scrollbar.viewMin,this._owner._onScrollAsync(this)},Object.defineProperty(r.prototype,"otherDimension",{get:function(){return this._otherDimension},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layoutManager",{get:function(){return this._layoutManager},enumerable:!1,configurable:!0}),r.prototype._createScrollbar=function(e,t){return null},r.prototype.updateScrollPosition=function(){if(this._scrollItems=[],this.model){var e=this.getIntegerScrollOffset(),t=this._hierarchyNavigator.getLeafAt(this.model,e);if(t)for(;this._scrollItems[this._hierarchyNavigator.getLevel(t)]=t,null!==(t=this._hierarchyNavigator.getParent(t)););}},r);function r(e){this._scrollStep=.1,this._owner=e,this._hierarchyNavigator=e.hierarchyNavigator,this._binder=e.getBinder(),this._tablixLayoutManager=e.layoutManager,this.scrollOffset=0}function n(e){e=i.call(this,e)||this;return e._layoutManager=e._tablixLayoutManager.rowLayoutManager,e._footer=null,e}function a(e){e=t.call(this,e)||this;return e._layoutManager=e._tablixLayoutManager.columnLayoutManager,e}o.TablixDimension=e,__extends(n,i=e),n.prototype.setFooter=function(e){this._footer=e,this._owner.updateFooterVisibility()},n.prototype.hasFooter=function(){return null!==this._footer},n.prototype._render=function(){var e=this.getFirstVisibleItem(0);this.hasFooter()&&(this.addFooterRowHeader(this._footer),this.addFooterBodyCells(this._footer)),void 0!==e&&this.addNodes(this.model,0,this.getDepth(),this._hierarchyNavigator.getIndex(e))},n.prototype._createScrollbar=function(e,t){return new o.VerticalScrollbar(e,t)},n.prototype.addNodes=function(e,t,i,o){for(var r=this._hierarchyNavigator.getCount(e),n=o;n<r;n++){if(!this._layoutManager.needsToRealize)return;var a=this._hierarchyNavigator.getAt(e,n);t+=this.addNode(a,e,t,i).rowSpan}},n.prototype.getFirstVisibleChildLeaf=function(e){for(var t=e;!this._hierarchyNavigator.isLeaf(t);)t=this.getFirstVisibleChild(t);return t},n.prototype.bindRowHeader=function(e,t){this._binder.bindRowHeader(e,t)},n.prototype.addNode=function(e,t,i,o){var r=this._tablixLayoutManager.getOrCreateRowHeader(e,t,i,this._hierarchyNavigator.getLevel(e)),n=this.rowHeaderMatch(e,r);return n||(this._owner._unbindCell(r),r.type=1,r.item=e),this._hierarchyNavigator.isLeaf(e)?(r.colSpan=o-this._hierarchyNavigator.getLevel(e),r.rowSpan=1,n||this.bindRowHeader(e,r),this._tablixLayoutManager.onRowHeaderRealized(e,r),this.addBodyCells(e,t,i)):(t=this._layoutManager.getRealizedItemsCount(),this.addNodes(this._hierarchyNavigator.getChildren(e),i,o,this.getFirstVisibleChildIndex(e)),r.colSpan=1,r.rowSpan=this._layoutManager.getRealizedItemsCount()-t+1,n||this.bindRowHeader(e,r),this._tablixLayoutManager.onRowHeaderRealized(e,r)),r},n.prototype.rowHeaderMatch=function(e,t){var i=t.item;return 1===t.type&&i&&this._hierarchyNavigator.headerItemEquals(e,i)},n.prototype.addBodyCells=function(e,t,i){for(var o=this._otherDimension.getIntegerScrollOffset(),r=this._otherDimension._layoutManager.getRealizedItemsCount()-this.getDepth(),n=this._hierarchyNavigator,a=this._otherDimension.model,l=this._tablixLayoutManager,s=0;s<r;s++){var u=n.getIntersection(e,n.getLeafAt(a,o+s)),h=l.getOrCreateBodyCell(u,e,t,i,s);this.bindBodyCell(u,h),l.onBodyCellRealized(u,h)}},n.prototype.bindBodyCell=function(e,t){this.bodyCelMatch(e,t)||(this._owner._unbindCell(t),t.type=3,t.item=e,this._binder.bindBodyCell(e,t))},n.prototype.addFooterRowHeader=function(e){var t=this._tablixLayoutManager.getOrCreateFooterRowHeader(e,this.model);t.colSpan=this.getDepth(),this.rowHeaderMatch(e,t)||(this._owner._unbindCell(t),t.type=1,t.item=e,this.bindRowHeader(e,t),this._tablixLayoutManager.onRowHeaderFooterRealized(e,t))},n.prototype.addFooterBodyCells=function(e){for(var t=this._otherDimension.getIntegerScrollOffset(),i=this._otherDimension.layoutManager.getRealizedItemsCount()-this.getDepth(),o=this._tablixLayoutManager,r=0;r<i;r++){var n=this._hierarchyNavigator.getLeafAt(this._otherDimension.model,t+r),n=this._hierarchyNavigator.getIntersection(e,n),a=o.getOrCreateFooterBodyCell(n,r);this.bindBodyCell(n,a),o.onBodyCellFooterRealized(n,a)}},n.prototype.bodyCelMatch=function(e,t){var i=t.item;return 3===t.type&&i&&this._hierarchyNavigator.bodyCellItemEquals(e,i)},o.TablixRowDimension=n,__extends(a,t=e),a.prototype._render=function(){var e=this.getFirstVisibleItem(0);void 0!==e&&this.addNodes(this.model,0,this.getDepth(),this._hierarchyNavigator.getIndex(e))},a.prototype._createScrollbar=function(e,t){e=new o.HorizontalScrollbar(e,t);return e.smallIncrement=.2,e},a.prototype.addNodes=function(e,t,i,o){for(var r=this._hierarchyNavigator.getCount(e),n=o;n<r;n++){if(!this._layoutManager.needsToRealize)return;t+=this.addNode(this._hierarchyNavigator.getAt(e,n),e,t,i).colSpan}},a.prototype.addNode=function(e,t,i,o){var r,t=this._tablixLayoutManager.getOrCreateColumnHeader(e,t,this._hierarchyNavigator.getLevel(e),i),n=this.columnHeaderMatch(e,t);return n||(this._owner._unbindCell(t),t.type=2,t.item=e),this._hierarchyNavigator.isLeaf(e)?t.rowSpan=o-this._hierarchyNavigator.getLevel(e):(r=this._layoutManager.getRealizedItemsCount(),this.addNodes(this._hierarchyNavigator.getChildren(e),i,o,this.getFirstVisibleChildIndex(e)),i=this._hierarchyNavigator.getChildrenLevelDifference(e),t.rowSpan=i===1/0?1:i,t.colSpan=this._layoutManager.getRealizedItemsCount()-r+1),n||this._binder.bindColumnHeader(e,t),this._tablixLayoutManager.onColumnHeaderRealized(e,t),t},a.prototype.columnHeaderMatch=function(e,t){var i=t.item;return!this._owner.wordWrapColumnHeaders&&2===t.type&&i&&this._hierarchyNavigator.headerItemEquals(e,i)},o.TablixColumnDimension=a}(powerbi=powerbi||{}),function(e){var n;function t(e){this.dim=e,this.averageSize=1,this.handlers=null,this.tablixControl=null}function i(e){this.dim=e,this.averageSize=30,this.handlers=null,this.tablixControl=null}function o(e){this.dim=e,this.averageSizeX=o.DefaultAverageSizeX,this.averageSizeY=o.DefaultAverageSizeY,this.handlers=null,this.tablixControl=null}e=e.visuals||(e.visuals={}),n=e.controls||(e.controls={}),Object.defineProperty(t.prototype,"dimension",{get:function(){return this.dim},enumerable:!1,configurable:!0}),t.prototype.setScrollDensity=function(e){this.averageSize=e},t.prototype.resize=function(e,t,i,o){this.dim.x=e,this.dim.y=t,this.dim.width=i,this.dim.height=o},t.prototype.getPixelToItem=function(e,t,i,o,r){return new n.TouchUtils.TouchEvent(e*this.averageSize,0,r,-i*this.averageSize,0)},t.prototype.touchEvent=function(e){var t=[];t[0]=this.tablixControl,t[1]=e.dx,t[2]=e.dy,this.handlers&&n.fire([this.handlers],t)},t.prototype.setHandler=function(e,t){this.handlers=t,this.tablixControl=e},n.ColumnTouchDelegate=t,Object.defineProperty(i.prototype,"dimension",{get:function(){return this.dim},enumerable:!1,configurable:!0}),i.prototype.setScrollDensity=function(e){this.averageSize=e},i.prototype.resize=function(e,t,i,o){this.dim.x=e,this.dim.y=t,this.dim.width=i,this.dim.height=o},i.prototype.getPixelToItem=function(e,t,i,o,r){return new n.TouchUtils.TouchEvent(0,t*this.averageSize,r,0,-o*this.averageSize)},i.prototype.touchEvent=function(e){var t=[];t[0]=this.tablixControl,t[1]=e.dx,t[2]=e.dy,this.handlers&&n.fire([this.handlers],t)},i.prototype.setHandler=function(e,t){this.handlers=t,this.tablixControl=e},n.RowTouchDelegate=i,Object.defineProperty(o.prototype,"dimension",{get:function(){return this.dim},enumerable:!1,configurable:!0}),o.prototype.setScrollDensity=function(e,t){this.averageSizeX=e,this.averageSizeY=t},o.prototype.resize=function(e,t,i,o){var r=this.dim;r.x=e,r.y=t,r.width=i,r.height=o},o.prototype.getPixelToItem=function(e,t,i,o,r){return new n.TouchUtils.TouchEvent(e*this.averageSizeX,t*this.averageSizeY,r,-i*this.averageSizeX,-o*this.averageSizeY)},o.prototype.touchEvent=function(e){e=[this.tablixControl,e.dx,e.dy];this.handlers&&n.fire([this.handlers],e)},o.prototype.setHandler=function(e,t){this.handlers=t,this.tablixControl=e},o.DefaultAverageSizeX=30,o.DefaultAverageSizeY=30,n.BodyTouchDelegate=o}(powerbi=powerbi||{}),function(e){var t,n,r,o,i,u;function a(e,t){this.x=e||0,this.y=t||0}function l(e,t,i,o){e=r.call(this,e,t)||this;return e.width=i||0,e.height=o||0,e}function s(e,t,i,o,r){this._x=e,this._y=t,this.isMouseButtonDown=i,this._dx=o||0,this._dy=r||0}function h(){this.touchList=[],this.swipeDirection=2,this.matchingDirectionCount=0,this.lockThreshold=!0,this.scrollThreshold=!0,this.lastTouchEvent=new u(0,0,!1)}function d(e){this.manager=e,this.touchPanel=null,this.scale=1,this.documentCallbacksWrapper=null,this.panelCallbacksWrapper=null,this.sliding=!1}e=e.visuals||(e.visuals={}),e=(t=e.controls||(e.controls={})).TouchUtils||(t.TouchUtils={}),a.prototype.offset=function(e,t){this.x+=e,this.y+=t},n=a,e.Point=n,__extends(l,r=n),Object.defineProperty(l.prototype,"point",{get:function(){return new n(this.x,this.y)},enumerable:!1,configurable:!0}),l.prototype.contains=function(e){return l.contains(this,e)},l.contains=function(e,t){return!(!t||l.isEmpty(e))&&e.x<=t.x&&t.x<e.x+e.width&&e.y<=t.y&&t.y<e.y+e.height},l.isEmpty=function(e){return!(void 0!==e&&0<=e.width&&0<=e.height)},i=l,e.Rectangle=i,(i=o=e.MouseButton||(e.MouseButton={}))[i.NoClick=0]="NoClick",i[i.LeftClick=1]="LeftClick",i[i.RightClick=2]="RightClick",i[i.CenterClick=3]="CenterClick",Object.defineProperty(s.prototype,"x",{get:function(){return this._x},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"y",{get:function(){return this._y},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dx",{get:function(){return this._dx},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"dy",{get:function(){return this._dy},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isMouseDown",{get:function(){return this.isMouseButtonDown},enumerable:!1,configurable:!0}),u=s,e.TouchEvent=u,Object.defineProperty(h.prototype,"lastEvent",{get:function(){return this.lastTouchEvent},enumerable:!1,configurable:!0}),h.prototype.addTouchRegion=function(e,t,i){t={lastPoint:new u(0,0,!1),handler:t,region:e,converter:i};this.touchList=this.touchList.concat([t])},h.prototype.upAllTouches=function(){for(var e,t=this.touchList.length,i=0;i<t;i++)this.touchList[i].lastPoint.isMouseDown&&(e=this.touchList[i].converter.getPixelToItem(this.touchList[i].lastPoint.x,this.touchList[i].lastPoint.y,0,0,!1),this.touchList[i].handler.touchEvent(e)),this.touchList[i].lastPoint=new u(this.touchList[i].lastPoint.x,this.touchList[i].lastPoint.y,!1);this.lastTouchEvent=new u(0,0,!1)},h.prototype.touchEvent=function(e){var t,i,o,r=0,n=0,a=this._getActive();!this.lastTouchEvent.isMouseDown&&e.isMouseDown&&(a=this._findRegions(e)),r=this.lastTouchEvent.x-e.x,n=this.lastTouchEvent.y-e.y,this.lastTouchEvent=new u(e.x,e.y,e.isMouseDown,r,n);for(var l=a.length,s=0;s<l;s++)t=e.x-a[s].region.point.x,i=e.y-a[s].region.point.y,a[s].lastPoint.isMouseDown&&e.isMouseDown?(r=t-a[s].lastPoint.x,n=i-a[s].lastPoint.y,o=Math.abs(180/Math.PI*Math.atan(n/r)),this.scrollThreshold&&(this.lockThreshold&&5<this.matchingDirectionCount?1===this.swipeDirection?n=0:0===this.swipeDirection&&(r=0):o<20?(n=0,1===this.swipeDirection?this.matchingDirectionCount++:(this.matchingDirectionCount=1,this.swipeDirection=1)):Math.abs(180/Math.PI*Math.atan(r/n))<20?(r=0)===this.swipeDirection?this.matchingDirectionCount++:(this.matchingDirectionCount=1,this.swipeDirection=0):2===this.swipeDirection?this.matchingDirectionCount++:(this.swipeDirection=2,this.matchingDirectionCount=1))):(n=r=0,this.swipeDirection=2,this.matchingDirectionCount=0),a[s].lastPoint=new u(t,i,e.isMouseDown,r,n),o=a[s].converter.getPixelToItem(t,i,r,n,e.isMouseDown),a[s].handler.touchEvent(o)},h.prototype._findRegions=function(e){for(var t=[],i=this.touchList.length,o=0;o<i;o++)this.touchList[o].region.contains(new n(e.x,e.y))&&(t=t.concat([this.touchList[o]]));return t},h.prototype._getActive=function(){for(var e=[],t=this.touchList.length,i=0;i<t;i++)this.touchList[i].lastPoint.isMouseDown&&(e=e.concat([this.touchList[i]]));return e},e.TouchManager=h,d.prototype.initTouch=function(e,t){e.style.setProperty("-ms-touch-action","pinch-zoom"),this.touchReferencePoint=t,this.touchPanel=e,this.startTouchPanelEvents()},d.prototype.startTouchPanelEvents=function(){var t=this;"ontouchmove"in this.touchPanel&&(this.panelCallbacksWrapper={startCallback:function(e){return t.onTouchStart(e)},endCallback:function(e){return t.onTouchEnd(e)}},this.touchPanel.addEventListener("touchstart",this.panelCallbacksWrapper.startCallback),this.touchPanel.addEventListener("touchend",this.panelCallbacksWrapper.endCallback))},d.prototype.clearTouchPanelEvents=function(){null!==this.panelCallbacksWrapper&&("ontouchmove"in this.touchPanel&&(this.touchPanel.removeEventListener("touchstart",this.panelCallbacksWrapper.startCallback),this.touchPanel.removeEventListener("touchend",this.panelCallbacksWrapper.endCallback)),this.panelCallbacksWrapper=null)},d.prototype.getXYByClient=function(e,t,i){var o=i.left,i=i.top,r=(void 0!==window.scrollX&&(o+=window.scrollX,i+=window.scrollY),new n(0,0));return r.offset(e-o,t-i),r},d.prototype.onTouchStart=function(e){1===e.touches.length&&(e.cancelBubble=!0,e=e.touches[0],this.touchStartTime=(new Date).getTime(),this.touchStartPageY=e.pageY,this.onTouchMouseDown(e))},d.prototype.onTouchMove=function(e){1===e.touches.length&&(e.preventDefault&&e.preventDefault(),e=e.touches[0],this.touchLastPageY=e.pageY,this.touchLastPageX=e.pageX,this.sliding||this.onTouchMouseMove(e))},d.prototype.onTouchEnd=function(e){this.clearTouchDocumentEvents();var t=this.getSwipeInfo();this.didUserSwipe(t)?this.startSlideAffect(t):this.sliding||this.upAllTouches()},d.prototype.onTouchMouseDown=function(e){this.scale=t.HTMLElementUtils.getAccumulatedScale(this.touchPanel),document.getSelection().removeAllRanges(),this.rect=(this.touchReferencePoint||this.touchPanel).getBoundingClientRect(),this.startTouchDocumentEvents()},d.prototype.startTouchDocumentEvents=function(){var t=this;"ontouchmove"in this.touchPanel&&(this.documentCallbacksWrapper={moveCallback:function(e){return t.onTouchMove(e)},endCallback:function(e){return t.onTouchEnd(e)}},document.addEventListener("touchend",this.documentCallbacksWrapper.endCallback),document.addEventListener("touchmove",this.documentCallbacksWrapper.moveCallback))},d.prototype.onTouchMouseMove=function(e){var t=this.rect,i=null!==t&&e.which!==o.NoClick;i&&!this.sliding&&(t=this.getXYByClient(e.pageX,e.pageY,t),t=new u(t.x/this.scale,t.y/this.scale,i),this.manager.touchEvent(t),e.preventDefault?e.preventDefault():"returnValue"in e&&(e.returnValue=!1))},d.prototype.getSwipeInfo=function(){var e=(new Date).getTime(),t=e-this.touchStartTime,i=this.touchLastPageY-this.touchStartPageY;return{direction:i<0?-1:1,distance:i,endTime:e,time:t}},d.prototype.didUserSwipe=function(e){return e.time<600&&80<e.distance*e.direction},d.prototype.startSlideAffect=function(e){var t,i=this;this.sliding||null===this.rect||(this.sliding=!0,t=this.getXYByClient(this.touchLastPageX,this.touchLastPageY,this.rect),this.slide(t,300,e),requestAnimationFrame(function(){i.didUserChangeDirection(e)||i.slide(t,200,e),i.clearSlide()}))},d.prototype.didUserChangeDirection=function(e){return!(this.touchStartTime<=e.endTime)&&(this.touchLastPageY-this.touchStartPageY<0?-1:1)!==e.direction},d.prototype.slide=function(e,t,i){var o=this.touchStartTime>i.endTime?this.touchLastPageY-this.touchStartPageY:0,t=(e.y+=t*i.direction+o,new u(e.x/this.scale,e.y/this.scale,!0));this.manager.touchEvent(t)},d.prototype.clearSlide=function(){this.sliding=!1,this.upAllTouches()},d.prototype.upAllTouches=function(){null===this.documentCallbacksWrapper&&(this.rect=null,this.manager.upAllTouches())},d.prototype.clearTouchDocumentEvents=function(){null!==this.documentCallbacksWrapper&&("ontouchmove"in this.touchPanel&&(document.removeEventListener("touchmove",this.documentCallbacksWrapper.moveCallback),document.removeEventListener("touchend",this.documentCallbacksWrapper.endCallback)),this.documentCallbacksWrapper=null)},d.prototype.clearAllTouchEvents=function(){this.clearTouchDocumentEvents(),this.clearTouchPanelEvents()},e.TouchEventInterpreter=d}(powerbi=powerbi||{}),function(e){(e=(e=(e=e.visuals||(e.visuals={})).controls||(e.controls={})).TablixType||(e.TablixType={}))[e.Matrix=0]="Matrix",e[e.Table=1]="Table",e[e.PivotTable=2]="PivotTable",e[e.TableEx=3]="TableEx"}(powerbi=powerbi||{}),function(h){var R=h.visuals||(h.visuals={}),I=h.visuals.builder,i=h.data.DataViewMatrixUtils,t=h.data.DataViewRoleWildcard,o=h.data.DataViewWildcard,M=R.Units.FontSize,c=h.visuals.builder.FormattingModelBuilder,L=R.controls.TablixType,F=h.visuals.controls.internal.TablixUtils,r=h.visuals.TextHelper,N=R.valueFormatter.VariantValueFormatter;function B(e){this.tablixProperties=new R.TablixProperties(e)}B.getMetadataObjects=function(e){return e&&e.metadata?e.metadata.objects:null},B.prototype.enumerateObjectRepetition=function(e,t,i,o){var r=this.getSelectorData(i);switch(i){case L.Table:case L.TableEx:n=this.getTableColumnMetadata(t);break;case L.Matrix:case L.PivotTable:n=this.getMatrixValuesColumnMetadata(t);break;default:return}if(n)for(var n=_.uniq(n),a=i===L.PivotTable||i===L.TableEx,l=0,s=n;l<s.length;l++){var u,h=s[l],d=h.isMeasure&&h.type.numeric,c=null==(c=h.type.misc)?void 0:c.sparkline;a?(u={containerName:h.displayName,selector:this.getSelector(h.queryName,r),allowOverrideSubtotalMatching:!0,objects:((u={})[this.tablixProperties.PropValuesBackColor.objectName]={formattingProperties:[this.tablixProperties.PropValuesBackColor.propertyName]},u)},u=(e.push(u),c||(u={containerName:h.displayName,selector:this.getSelector(h.queryName,r),allowOverrideSubtotalMatching:!0,objects:((u={})[this.tablixProperties.PropValuesFontColor.objectName]={formattingProperties:[this.tablixProperties.PropValuesFontColor.propertyName]},u)},e.push(u)),d&&!c&&(u={containerName:h.displayName,selector:this.getSelector(h.queryName),objects:((u={})[R.TablixProperties.PropColumnFormattingDataBars.objectName]={formattingProperties:[R.TablixProperties.PropColumnFormattingDataBars.propertyName]},u)},e.push(u)),{containerName:h.displayName,selector:this.getSelector(h.queryName,r),altStaticSelector:this.getSelector(h.queryName),allowOverrideSubtotalMatching:!0,objects:((u={})[R.TablixProperties.PropValuesIcon.objectName]={formattingProperties:[R.TablixProperties.PropValuesIcon.propertyName]},u)}),e.push(u),a&&o&&!R.converterHelper.isWebUrlColumn(h)&&!c&&(c={containerName:h.displayName,selector:this.getSelector(h.queryName,r),allowOverrideSubtotalMatching:!0,objects:((u={})[R.TablixProperties.PropValuesWebURL.objectName]={formattingProperties:[R.TablixProperties.PropValuesWebURL.propertyName]},u)},e.push(c))):d&&(c={containerName:h.displayName,selector:this.getSelector(h.queryName,r),objects:((u={})[this.tablixProperties.PropValuesBackColor.objectName]={formattingProperties:[this.tablixProperties.PropValuesBackColor.propertyName]},u)},e.push(c))}},B.prototype.getSelectorData=function(e){switch(e){case L.Table:return[t.fromRoles(["Values"])];case L.TableEx:return[o.create(1)];case L.Matrix:return[t.fromRoles(["Rows","Columns"])];case L.PivotTable:return[o.create(1)];default:return}},B.prototype.getConditionalFormattingSelector=function(e,t,i){i=(i=void 0===i?!0:i)?this.getSelectorData(e):void 0;return this.getSelector(t,i)},B.prototype.getSelector=function(e,t){e={metadata:e};return t&&(e.data=t),e},B.prototype.getFormattingModel=function(e,t,i,o,r,n,a){void 0===r&&(r=!1);var l=B.getMetadataObjects(i),s=t,u=t,h=!0,d=this.getColumnsMetadata(i,o),h=o===L.Table?this.shouldShowTableTotalsOption(i)&&R.TablixProperties.PropGeneralTableTotals.getValue(l):this.shouldShowColumnSubtotalsOption(i)&&R.TablixProperties.PropGeneralMatrixColumnSubtotals.getValue(l)||this.shouldShowRowSubtotalsOption(i)&&R.TablixProperties.PropGeneralMatrixRowSubtotals.getValue(l),a=this.getTablixTextClassProperties(a),a=new c(this.getGridCard(e,t,o,l,a,n),this.getValueCard(e,t,o,l,n),this.getColumnHeadersCard(e,t,o,n),this.getRowHeadersCard(e,s,o,l,r,n),this.getTotalsCard(e,u,o,n),this.getColumnSubtotalCard(e,s,i,o,h,n),this.getRowSubTotalsCard(e,s,i,o,h,n),this.getColumnGrandTotalsCard(e,s,o,n),this.getRowGrandTotalsCard(e,s,o,n),this.getColumnFormattingCard(e,t,d,o),this.getCellColumnCard(e,o,i,n),this.getUrlIconCard(e,t,o),this.getImageSizeCard(e,t,o,n),this.getSparklinesCard(d,e,o));return n.a11yTable&&(l=this.getAccessibilityCard(d,e,u,o))&&a.addCards(l),a.build()},B.prototype.getGridCard=function(t,i,o,r,n,a){function l(e){return t.getLocalizedString(e)}var e=(o===L.TableEx?R.tableExProps:R.pivotTableProps).grid,s=(o===L.TableEx?R.tableExProps:R.pivotTableProps).values,u=s.outline,h=s.outlineStyle,d=s.outlineWeight,c=s.outlineColor,s=(o===L.TableEx?R.tableExProps:R.pivotTableProps).columnHeaders,p=s.outline,g=s.outlineStyle,m=s.outlineWeight,f=s.outlineColor,s=(o===L.TableEx?R.tableExProps:R.pivotTableProps).total,y=s.outline,b=s.outlineStyle,v=s.outlineWeight,C=s.outlineColor,s=R.pivotTableProps.rowHeaders,w=s.outline,x=s.outlineStyle,S=s.outlineWeight,P=s.outlineColor,s=(e.imageHeight,e.imageWidth,e.outline),H=e.outlineStyle,T=__rest(e,["imageHeight","imageWidth","outline","outlineStyle"]),M=(a.upgradeOutlineProperties&&(T=__assign(__assign({},T),{outline:s,outlineStyle:H,valuesOutline:u,valuesOutlineStyle:h,valuesOutlineWeight:d,valuesOutlineColor:c,columnHeadersOutline:p,columnHeadersOutlineStyle:g,columnHeadersOutlineWeight:m,columnHeadersOutlineColor:f}),o===L.TableEx&&(T=__assign(__assign({},T),{totalsOutline:y,totalsOutlineStyle:b,totalsOutlineColor:C,totalsOutlineWeight:v})),o===L.PivotTable)&&(T=__assign(__assign({},T),{rowHeaderOutline:w,rowHeaderOutlineStyle:x,rowHeaderOutlineWeight:S,rowHeaderOutlineColor:P})),i.grid),e=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("grid"),"Visual_Grid",T,l);return e.addGroup("gridHorizontal",function(e){e.withDisplayName("Visual_Gridline_Horizontal").addTopLevelToggle("gridHorizontal",function(){return new I.ToggleSwitchBuilder({descriptor:T.gridHorizontal,value:M.gridHorizontal}).build()}).addSimpleSlice("gridHorizontalColor",function(){var e={value:M.gridHorizontalColor};return new I.ColorPickerBuilder({descriptor:T.gridHorizontalColor,value:e}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("gridHorizontalWeight",new I.NumUpDownBuilder({descriptor:T.gridHorizontalWeight,value:M.gridHorizontalWeight,options:{minValue:{type:0,value:0},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}),e.addGroup("gridVertical",function(e){e.withDisplayName("Visual_Gridline_Vertical").addTopLevelToggle("gridVertical",function(){return new I.ToggleSwitchBuilder({descriptor:T.gridVertical,value:M.gridVertical}).build()}).addSimpleSlice("gridVerticalColor",function(){var e={value:M.gridVerticalColor};return new I.ColorPickerBuilder({descriptor:T.gridVerticalColor,value:e}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("gridVerticalWeight",new I.NumUpDownBuilder({descriptor:T.gridVerticalWeight,value:M.gridVerticalWeight,options:{minValue:{type:0,value:0},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}),a.upgradeOutlineProperties?e.addGroup("border",function(e){e.withDisplayName("Visual_Border").addContainer("outline",function(e){e.withDisplayName("Section"),e.addContainerItem("all",l("All"),function(e){a.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyle",function(){return new I.FlagSelectionBuilder({descriptor:T.outlineStyle,value:M.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("outline",function(){return new I.DropdownBuilder({descriptor:T.outline,value:M.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("outlineColor",function(){return new I.ColorPickerBuilder({descriptor:T.outlineColor,value:{value:M.outlineColor}}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("outlineWeight",new I.NumUpDownBuilder({descriptor:T.outlineWeight,value:M.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}).addContainerItem("columnHeaders",l("Visual_Tablix_ColumnHeader"),function(e){var t=i.columnHeaders;a.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyleColumnHeaders",function(){return new I.FlagSelectionBuilder({descriptor:g,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("outlineColumnHeaders",function(){return new I.DropdownBuilder({descriptor:p,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("outlineColorColumnHeaders",function(){return new I.ColorPickerBuilder({descriptor:f,value:{value:t.outlineColor}}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("outlineWeightColumnHeaders",new I.NumUpDownBuilder({descriptor:m,value:t.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}),o===L.PivotTable&&e.addContainerItem("rowHeaders",l("Visual_Tablix_RowHeaders"),function(e){var t=i.rowHeaders;a.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyleRowHeaders",function(){return new I.FlagSelectionBuilder({descriptor:x,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("outlineRowHeaders",function(){return new I.DropdownBuilder({descriptor:w,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("outlineColorRowHeaders",function(){return new I.ColorPickerBuilder({descriptor:P,value:{value:t.outlineColor}}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("outlineWeightRowHeaders",new I.NumUpDownBuilder({descriptor:S,value:t.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}),e.addContainerItem("values",l("Visual_Tablix_ValuesSection"),function(e){var t=i.values;a.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyleValues",function(){return new I.FlagSelectionBuilder({descriptor:h,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("outlineValues",function(){return new I.DropdownBuilder({descriptor:u,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("outlineColorValues",function(){return new I.ColorPickerBuilder({descriptor:c,value:{value:t.outlineColor}}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("outlineWeightValues",new I.NumUpDownBuilder({descriptor:d,value:t.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}),o===L.TableEx&&e.addContainerItem("outline-totals",l("Visual_Tablix_TotalsSection"),function(e){var t=i.total;a.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyleTotals",function(){return new I.FlagSelectionBuilder({descriptor:b,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}):e.addSimpleSlice("outlineTotals",function(){return new I.DropdownBuilder({descriptor:y,value:t.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Border_Position")}),e.addSimpleSlice("outlineColorTotals",function(){return new I.ColorPickerBuilder({descriptor:C,value:{value:t.outlineColor}}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("outlineWeightTotals",new I.NumUpDownBuilder({descriptor:v,value:t.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})})})}):e.addGroup("border",function(e){e.withDisplayName("Visual_Border").addSimpleSlice("outlineColor",function(){var e={value:M.outlineColor};return new I.ColorPickerBuilder({descriptor:T.outlineColor,value:e}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("outlineWeight",new I.NumUpDownBuilder({descriptor:T.outlineWeight,value:M.outlineWeight,options:{minValue:{type:0,value:1},maxValue:{type:1,value:10}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}),e.addGroup("options",function(e){e.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice("rowPadding",new I.NumUpDownBuilder({descriptor:T.rowPadding,value:M.rowPadding,options:{minValue:{type:0,value:0},maxValue:{type:1,value:20}}}).build()).addSimpleSlice("textSize",function(){var e=n.labelFontProperties.size&&n.labelFontProperties.size.pt;return new I.NumUpDownBuilder({descriptor:T.textSize,value:R.TablixProperties.PropGridPivotTableTextSize.setInstanceProperty(void 0,r,n.fontSizeOverrideFn,e),options:{minValue:{type:0,value:8},maxValue:{type:1,value:60}}}).build()},function(e){return e.withCustomDisplayName("Global_Font_Size")})}),e.build()},B.prototype.getValueCard=function(t,e,i,o,r){var n=(i===L.TableEx?R.tableExProps:R.pivotTableProps).values,a=(n.webURL,n.urlIcon,n.icon,n.bandedRowHeaders,n.outline),l=n.outlineStyle,s=(n.outlineWeight,n.outlineColor,__rest(n,["webURL","urlIcon","icon","bandedRowHeaders","outline","outlineStyle","outlineWeight","outlineColor"])),u=(r.upgradeOutlineProperties||(s=__assign(__assign({},s),{outline:a,outlineStyle:l})),e.values),n=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("values"),"Visual_Tablix_Values",s,function(e){return t.getLocalizedString(e)}),a=(new I.FontControlBuilder).withFontFamily({descriptor:s.fontFamily,value:u.fontFamily}).withFontSizeProperties({descriptor:s.fontSize,value:u.fontSize.pt}),h=(r.enableBIU&&a.withBold({descriptor:s.bold,value:u.bold}).withItalic({descriptor:s.italic,value:u.italic}).withUnderline({descriptor:s.underline,value:u.underline}),a.build());return n.addGroup("values",function(e){e.withDisplayName("Visual_Tablix_Values"),i!==L.PivotTable&&i!==L.TableEx||e.addCompositeSlice("font","Font",h),e.addSimpleSlice("fontColorPrimary",function(){var e={value:u.fontColorPrimary};return new I.ColorPickerBuilder({descriptor:s.fontColorPrimary,value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColorPrimary",function(){var e={value:u.backColorPrimary};return new I.ColorPickerBuilder({descriptor:s.backColorPrimary,value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}).addSimpleSlice("fontColorSecondary",function(){var e={value:u.fontColorSecondary};return new I.ColorPickerBuilder({descriptor:s.fontColorSecondary,value:e}).build()},function(e){return e.withCustomDisplayName("Visual_AlternateText_Color")}).addSimpleSlice("backColorSecondary",function(){var e={value:u.backColorSecondary};return new I.ColorPickerBuilder({descriptor:s.backColorSecondary,value:e}).build()},function(e){return e.withCustomDisplayName("Visual_Tablix_BackColorSecondary")}).addSimpleSlice("textWrap",new I.ToggleSwitchBuilder({descriptor:s.wordWrap,value:u.wordWrap}).build(),function(e){return e.withCustomDisplayName("TextWrap")})}),r.upgradeOutlineProperties||n.addGroup("border",function(e){e.withDisplayName("Visual_Border"),r.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyle",function(){return new I.FlagSelectionBuilder({descriptor:s.outlineStyle,value:u.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")}):e.addSimpleSlice("outline",function(){return new I.DropdownBuilder({descriptor:s.outline,value:u.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")})}),i===L.PivotTable&&n.addGroup("options",function(e){e.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice("valuesOnRow",new I.ToggleSwitchBuilder({descriptor:s.valuesOnRow,value:R.TablixProperties.PropValuesOnRow.setInstanceProperty(void 0,o)}).build(),function(e){return e.withCustomDisplayName("Visual_PivotTable_ValuesSwitchToRows")})}),n.build()},B.prototype.getColumnHeadersCard=function(t,i,o,r){var e=(o===L.TableEx?R.tableExProps:R.pivotTableProps).columnHeaders,n=(e.urlIcon,e.outline),a=e.outlineStyle,l=(e.outlineWeight,e.outlineColor,__rest(e,["urlIcon","outline","outlineStyle","outlineWeight","outlineColor"])),s=(r.upgradeOutlineProperties||(l=__assign(__assign({},l),{outline:n,outlineStyle:a})),i.columnHeaders),e=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("columnHeaders"),"Visual_Tablix_ColumnHeaders",l,function(e){return t.getLocalizedString(e)}),n=(new I.FontControlBuilder).withFontFamily({descriptor:l.fontFamily,value:s.fontFamily}).withFontSizeProperties({descriptor:l.fontSize,value:s.fontSize.pt}),u=(r.enableBIU&&n.withBold({descriptor:l.bold,value:s.bold}).withItalic({descriptor:l.italic,value:s.italic}).withUnderline({descriptor:l.underline,value:s.underline}),n.build());return e.addGroup("text",function(e){e.withDisplayName("Text"),o!==L.PivotTable&&o!==L.TableEx||e.addCompositeSlice("font","Font",u),e.addSimpleSlice("fontColor",function(){var e={value:s.fontColor};return new I.ColorPickerBuilder({descriptor:l.fontColor,value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:s.backColor};return new I.ColorPickerBuilder({descriptor:l.backColor,value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}),o!==L.Table&&o!==L.TableEx&&o!==L.PivotTable||e.addSimpleSlice("alignment",new I.AlignmentGroupBuilder({descriptor:l.alignment,value:s.alignment,mode:"horizontalAlignment",supportsNoSelection:!0}).build(),function(e){return e.withCustomDisplayName("Visual_TextAlignment_Header")}),o===L.PivotTable&&e.addSimpleSlice("titleAlignment",new I.AlignmentGroupBuilder({descriptor:l.titleAlignment,value:i.columnHeaders.titleAlignment,mode:"horizontalAlignment",supportsNoSelection:!0}).build()),o!==L.Table&&o!==L.TableEx&&o!==L.PivotTable||e.addSimpleSlice("wordWrap",new I.ToggleSwitchBuilder({descriptor:l.wordWrap,value:s.wordWrap}).build(),function(e){return e.withCustomDisplayName("TextWrap")})}),r.upgradeOutlineProperties||e.addGroup("border",function(e){e.withDisplayName("Visual_Border"),r.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyle",function(){return new I.FlagSelectionBuilder({descriptor:l.outlineStyle,value:s.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")}):e.addSimpleSlice("outline",function(){return new I.DropdownBuilder({descriptor:l.outline,value:s.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")})}),o!==L.PivotTable&&o!==L.TableEx||e.addGroup("options",function(e){e.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice("autoSizeColumnWidth",new I.ToggleSwitchBuilder({descriptor:l.autoSizeColumnWidth,value:i.general.autoSizeColumnWidth}).build(),function(e){return e.withCustomDisplayName("Visual_AutoSize_Width")})}),e.build()},B.prototype.getRowHeadersCard=function(t,e,i,o,r,n){var a,l,s,u,h,d,c;if(void 0===r&&(r=!1),i===L.PivotTable)return a=function(e){return t.getLocalizedString(e)},(s=R.pivotTableProps.rowHeaders).urlIcon,h=s.outline,d=s.outlineStyle,s.outlineWeight,s.outlineColor,l=__rest(s,["urlIcon","outline","outlineStyle","outlineWeight","outlineColor"]),n.upgradeOutlineProperties||(l=__assign(__assign({},l),{outline:h,outlineStyle:d})),s=R.pivotTableProps.values.bandedRowHeaders,i===L.PivotTable&&(l=__assign(__assign({},l),{bandedRowHeaders:s})),u=e.rowHeaders,h=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("rowHeaders"),"Visual_Tablix_RowHeaders",l,a),d=(new I.FontControlBuilder).withFontFamily({descriptor:l.fontFamily,value:u.fontFamily}).withFontSizeProperties({descriptor:l.fontSize,value:u.fontSize.pt}),n.enableBIU&&d.withBold({descriptor:l.bold,value:u.bold}).withItalic({descriptor:l.italic,value:u.italic}).withUnderline({descriptor:l.underline,value:u.underline}),c=d.build(),h.addGroup("text",function(e){e.withDisplayName("Text"),i!==L.PivotTable&&i!==L.TableEx||e.addCompositeSlice("font","Font",c),e.addSimpleSlice("fontColor",function(){var e={value:u.fontColor};return new I.ColorPickerBuilder({descriptor:l.fontColor,value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:u.backColor};return new I.ColorPickerBuilder({descriptor:l.backColor,value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}),i===L.PivotTable&&e.addSimpleSlice("bandedRowHeaders",new I.ToggleSwitchBuilder({descriptor:l.bandedRowHeaders,value:R.TablixProperties.PropValuesBandedRowHeaders.setInstanceProperty(void 0,o)}).build()),e.addSimpleSlice("alignment",new I.AlignmentGroupBuilder({descriptor:l.alignment,value:u.alignment,mode:"horizontalAlignment",supportsNoSelection:!0}).build()).addSimpleSlice("wordWrap",new I.ToggleSwitchBuilder({descriptor:l.wordWrap,value:u.wordWrap}).build(),function(e){return e.withCustomDisplayName("TextWrap")})}),i===L.PivotTable&&r&&h.addGroup("expandCollapseButtons",function(e){e.withDisplayName("Visual_PivotTable_ExpandCollapseButtons_Toggle"),e.addTopLevelToggle("showExpandCollapseButtons",function(){return new I.ToggleSwitchBuilder({descriptor:l.showExpandCollapseButtons,value:u.showExpandCollapseButtons}).build()}).addSimpleSlice("expandCollapseButtonsColor",function(){var e={value:u.expandCollapseButtonsColor};return new I.ColorPickerBuilder({descriptor:l.expandCollapseButtonsColor,value:e}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("expandCollapseButtonsSize",new I.NumUpDownBuilder({descriptor:l.expandCollapseButtonsSize,value:u.expandCollapseButtonsSize.pt,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60},unitSymbol:"Numeric_Pixel"}}).build(),function(e){return e.withCustomDisplayName("Visual_BubbleSize")})}),n.upgradeOutlineProperties||h.addGroup("border",function(e){e.withDisplayName("Visual_Border"),n.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyle",function(){return new I.FlagSelectionBuilder({descriptor:l.outlineStyle,value:u.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")}):e.addSimpleSlice("outline",function(){return new I.DropdownBuilder({descriptor:l.outline,value:u.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")})}),h.addGroup("options",function(e){e.withDisplayName("Desktop_FileMenu_Options"),e.addSimpleSlice("stepped",new I.ToggleSwitchBuilder({descriptor:l.stepped,value:u.steppedLayout}).build()).addSimpleSlice("steppedLayoutIndentation",new I.SliderBuilder({descriptor:l.steppedLayoutIndentation,value:u.steppedLayoutIndentation,localize:a}).build())}),h.build()},B.prototype.getTotalsCard=function(t,i,o,r){var e,n,a,l,s,u;if(o===L.TableEx)return s=(l=(o===L.TableEx?R.tableExProps:R.pivotTableProps).total).outline,e=l.outlineStyle,l.outlineWeight,l.outlineColor,n=__rest(l,["outline","outlineStyle","outlineWeight","outlineColor"]),r.upgradeOutlineProperties||(n=__assign(__assign({},n),{outline:s,outlineStyle:e})),a=i.total,l=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("totals"),"Visual_Totals",n,function(e){return t.getLocalizedString(e)}),s=(new I.FontControlBuilder).withFontFamily({descriptor:n.fontFamily,value:a.fontFamily}).withFontSizeProperties({descriptor:n.fontSize,value:a.fontSize.pt}),r.enableBIU&&s.withBold({descriptor:n.bold,value:a.bold}).withItalic({descriptor:n.italic,value:a.italic}).withUnderline({descriptor:n.underline,value:a.underline}),u=s.build(),l.addGroup("values",function(e){e.withDisplayName("Visual_Tablix_Values"),o===L.TableEx&&(e.addTopLevelToggle("gridVertical",function(){return new I.ToggleSwitchBuilder({descriptor:n.totals,value:i.general.totals}).build()}),!i.general.totals)||e.addSimpleSlice("totalLabel",new I.TextInputBuilder({descriptor:n.label,value:a.totalLabel,placeholder:""}).build()).addCompositeSlice("font","Font",u),e.addSimpleSlice("fontColor",function(){var e={value:a.fontColor};return new I.ColorPickerBuilder({descriptor:n.fontColor,value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:a.backColor};return new I.ColorPickerBuilder({descriptor:n.backColor,value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")})}),r.upgradeOutlineProperties||l.addGroup("border",function(e){r.outlineDropdownToCheckboxes?e.addSimpleSlice("outlineStyle",function(){return new I.FlagSelectionBuilder({descriptor:n.outlineStyle,value:a.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")}):e.addSimpleSlice("outline",function(){return new I.DropdownBuilder({descriptor:n.outline,value:a.outline}).build()},function(e){return e.withCustomDisplayName("Visual_Outline")})}),l.build()},B.prototype.getColumnGrandTotalsCard=function(t,e,i,o){var r,n,a;if(i!==L.TableEx)return(i=o.splitGrandTotals?R.pivotTableProps.columnTotal:R.pivotTableProps.total).outlineStyle,i.outline,r=__rest(i,["outlineStyle","outline"]),n=e.columnGrandTotal,i=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("columnTotal"),"Visual_Tablix_Matrix_Column_TotalGrand",r,function(e){return t.getLocalizedString(e)}),e=(new I.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:n.fontFamily}).withFontSizeProperties({descriptor:r.fontSize,value:n.fontSize.pt}),o.enableBIU&&e.withBold({descriptor:r.bold,value:n.bold}).withItalic({descriptor:r.italic,value:n.italic}).withUnderline({descriptor:r.underline,value:n.underline}),a=e.build(),i.addGroup("values",function(e){e.withDisplayName("Visual_Tablix_Values").addCompositeSlice("font","Font",a).addSimpleSlice("fontColor",function(){var e={value:n.fontColor};return new I.ColorPickerBuilder({descriptor:r.fontColor,value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:n.backColor};return new I.ColorPickerBuilder({descriptor:r.backColor,value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}).addSimpleSlice("applyToHeaders",new I.ToggleSwitchBuilder({descriptor:r.applyToHeaders,value:n.applyToHeaders}).build())}),i.build()},B.prototype.getRowGrandTotalsCard=function(t,e,i,o){var r,n,a;if(i!==L.TableEx)return(i=o.splitGrandTotals?R.pivotTableProps.rowTotal:R.pivotTableProps.total).outlineStyle,i.outline,r=__rest(i,["outlineStyle","outline"]),n=e.rowGrandTotal,i=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("rowTotal"),"Visual_Tablix_Matrix_Row_TotalGrand",r,function(e){return t.getLocalizedString(e)}),e=(new I.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:n.fontFamily}).withFontSizeProperties({descriptor:r.fontSize,value:n.fontSize.pt}),o.enableBIU&&e.withBold({descriptor:r.bold,value:n.bold}).withItalic({descriptor:r.italic,value:n.italic}).withUnderline({descriptor:r.underline,value:n.underline}),a=e.build(),i.addGroup("values",function(e){e.withDisplayName("Visual_Tablix_Values").addCompositeSlice("font","Font",a).addSimpleSlice("fontColor",function(){var e={value:n.fontColor};return new I.ColorPickerBuilder({descriptor:r.fontColor,value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:n.backColor};return new I.ColorPickerBuilder({descriptor:r.backColor,value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}).addSimpleSlice("applyToHeaders",new I.ToggleSwitchBuilder({descriptor:r.applyToHeaders,value:n.applyToHeaders}).build())}),i.build()},B.prototype.getAccessibilityCard=function(e,t,i,o){if(o===L.TableEx){var r=R.tableExProps.accessibility,n=_.filter(e,R.converterHelper.isImageUrlColumn),a=_.filter(e,function(e){return e.type.text}).map(function(e){return{displayName:e.displayName,value:e.queryName}});if(!_.isEmpty(n)||!_.isEmpty(a))return o=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("accessibility"),"Accessibility",[r.altTextColumns,r.rowWithReferenceText],function(e){return t.getLocalizedString(e)}),_.isEmpty(n)||o.addGroup("AltText",function(e){e.withDisplayName("Visual_Tablix_Accessibility_Group_AltText_Label").withCollapsible(!1),e.addContainer("measure",function(e){e.withDisplayName("Visual_Tablix_ImageColumns_Desc");for(var t=0,i=n;t<i.length;t++)!function(t){e.addContainerItem(t.queryName,t.displayName,function(e){return e.addSimpleSlice("altTextColumns",function(){return new I.FieldPickerBuilder({descriptor:__assign(__assign({},r.altTextColumns),{selector:{data:[h.data.DataViewWildcard.create(0)],metadata:t.queryName},instanceKind:2}),validators:{field:{kind:1,type:{text:!0}}},value:void 0,unwrapExprOnGet:!0}).build()})})}(i[t])})}),_.isEmpty(a)||(e={displayName:t.getLocalizedString("Visual_Tablix_ReferenceRowDefaultText"),value:void 0},a.unshift(e),o.addGroup("rowWithReferenceText",function(e){e.withDisplayName("Visual_Tablix_RowName_Label").withCollapsible(!1),e.addSimpleSlice("rowWithReferenceText",new I.DropdownBuilder({descriptor:__assign({},r.rowWithReferenceText),items:a,value:null!=(e=_.find(a,function(e){return e.value===i.rowWithReferenceText.rowWithReferenceText}))?e:a[0]}).build())})),o.build()}},B.prototype.getRowSubTotalsCard=function(t,n,a,e,i,l){var s,o,u,h,d,c=this;if(i||e===L.PivotTable)return s=B.getMetadataObjects(a),o=R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsPerLevel.setInstanceProperty(void 0,s),u=function(e){return t.getLocalizedString(e)},h=R.pivotTableProps.subTotals,d=__assign(__assign({},n.subtotals),n.rowSubtotals),(i=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("rowSubTotal"),"Visual_SubtotalRow",[h.rowSubtotalsLabel,h.rowSubtotals,h.rowSubtotalsPosition,h.perRowLevel,h.levelSubtotalEnabled,h.levelSubtotalLabel,h.fontColor,h.backColor,h.fontSize,h.fontFamily,h.bold,h.italic,h.underline,h.applyToHeaders],u)).addTopLevelToggle("rowSubtotals",function(){return new I.ToggleSwitchBuilder({descriptor:h.rowSubtotals,value:n.general.rowSubtotals}).build()}),i.addGroup("applySettingsTo",function(e){e.withContainerDisabled(!o).withDisplayName("Apply_Settings_To").withCollapsible(!1).addSimpleSlice("perRowLevel",function(){return new I.ToggleSwitchBuilder({descriptor:h.perRowLevel,value:o}).build()},function(e){return e.withDisabled(!c.shouldShowRowSubtotalsOption(a)).withCustomDescriptionIf(function(){return!c.shouldShowRowSubtotalsOption(a)},"Visual_SubtotalRow_PerLevel_DisabledReason")}).addContainer("series",function(e){e.withDisplayName("Visual_Tablix_Row_Level"),e.addContainerItem("all",u("All"),function(e){return c.getRowSubtotalContainers(n,e,u,l,h,d,void 0,s)});for(var t=0,i=a.matrix.rows.levels;t<i.length;t++)for(var o=0,r=i[t].sources;o<r.length;o++)!function(t){var i;t.isMeasure||(i={metadata:t.queryName},e.addContainerItem(t.displayName,t.displayName,function(e){return c.getRowSubtotalContainers(n,e,u,l,h,d,i,t.objects)}))}(r[o])})}),i.build()},B.prototype.getRowSubtotalContainers=function(t,e,i,o,r,n,a,l){var s=(a?R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalLabel:R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsLabel).getValue(l,!0),u=a?"":i(F.TotalLabel),h=a?r.levelSubtotalLabel:r.rowSubtotalsLabel;e.addGroup("rows",function(e){e.withDisplayName("Role_DisplayName_Rows"),e.addSimpleSlice("levelSubtotalEnabled",new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},r.levelSubtotalEnabled),{selector:a}),value:R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalEnabled.setInstanceProperty(void 0,l)}).build(),function(e){return e.withCustomDisplayName("Visual_ShowSubtotal").withDisabled(!a)}).addSimpleSlice("rowSubtotalsLabel",new I.TextInputBuilder({descriptor:__assign(__assign({},h),{selector:a}),value:s||u,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Subtotal_Label")}).addSimpleSlice("rowSubtotalsPosition",new I.DropdownBuilder({descriptor:r.rowSubtotalsPosition,value:t.subtotals.rowSubtotalsPosition}).build(),function(e){return e.withCustomDisplayName("Visual_Position").withDisabled(!!a)})}),e.addGroup("values",function(e){var t,i;e.withDisplayName("Visual_Tablix_Values"),a?e.withDisabled(!0,""):(t={id:"Row"},i=(new I.FontControlBuilder).withFontFamily({descriptor:__assign(__assign({},r.fontFamily),{selector:t}),value:n.fontFamily}).withFontSizeProperties({descriptor:__assign(__assign({},r.fontSize),{selector:t}),value:n.fontSize.pt}),o.enableBIU&&i.withBold({descriptor:__assign(__assign({},r.bold),{selector:t}),value:n.bold}).withItalic({descriptor:__assign(__assign({},r.italic),{selector:t}),value:n.italic}).withUnderline({descriptor:__assign(__assign({},r.underline),{selector:t}),value:n.underline}),i=i.build(),e.addCompositeSlice("font","Font",i).addSimpleSlice("fontColor",function(){var e={value:n.fontColor};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},r.fontColor),{selector:t}),value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:n.backColor};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},r.backColor),{selector:t}),value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}).addSimpleSlice("applyToHeaders",new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},r.applyToHeaders),{selector:t}),value:n.applyToHeaders}).build()))})},B.prototype.getColumnSubtotalCard=function(t,e,n,i,o,a){var l,r,s,u,h,d=this;if(o||i===L.PivotTable||this.shouldShowColumnSubtotalsOption(n))return l=B.getMetadataObjects(n),r=R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsPerLevel.getValue(l),s=function(e){return t.getLocalizedString(e)},u=R.pivotTableProps.subTotals,h=__assign(__assign({},e.subtotals),e.columnSubtotals),(o=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("columnSubTotal"),"Visual_SubtotalColumn",[u.columnSubtotals,u.columnSubtotalsLabel,u.perColumnLevel,u.levelSubtotalEnabled,u.levelSubtotalLabel,u.fontColor,u.backColor,u.fontSize,u.fontFamily,u.bold,u.italic,u.underline,u.applyToHeaders],s)).addTopLevelToggle("columnSubtotals",function(){return new I.ToggleSwitchBuilder({descriptor:u.columnSubtotals,value:e.general.columnSubtotals}).build()}),o.addGroup("applySettingsTo",function(e){e.withContainerDisabled(!r).withDisplayName("Apply_Settings_To").withCollapsible(!1).addSimpleSlice("perColumnLevel",function(){return new I.ToggleSwitchBuilder({descriptor:u.perColumnLevel,value:r}).build()},function(e){return e.withDisabled(!d.shouldShowColumnSubtotalsOption(n)).withCustomDescriptionIf(function(){return!d.shouldShowColumnSubtotalsOption(n)},"Visual_SubtotalColumn_PerLevel_DisabledReason")}).addContainer("series",function(e){e.withDisplayName("Visual_Tablix_Column_Level"),e.addContainerItem("all",s("All"),function(e){return d.getColumnSubtotalContainers(e,s,a,u,h,void 0,l)});for(var t=0,i=n.matrix.columns.levels;t<i.length;t++)for(var o=0,r=i[t].sources;o<r.length;o++)!function(t){var i;t.isMeasure||(i={metadata:t.queryName},e.addContainerItem(t.displayName,t.displayName,function(e){return d.getColumnSubtotalContainers(e,s,a,u,h,i,t.objects)}))}(r[o])})}),o.build()},B.prototype.getColumnSubtotalContainers=function(e,t,o,r,n,a,i){var l=t(F.TotalLabel),s=(a?R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalLabel:R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsLabel).getValue(i,!0),u=a?r.levelSubtotalLabel:r.columnSubtotalsLabel;e.addGroup("columns",function(e){e.withDisplayName("Role_DisplayName_Columns"),e.addSimpleSlice("levelSubtotalEnabled",new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},r.levelSubtotalEnabled),{selector:a}),value:R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalEnabled.setInstanceProperty(void 0,i)}).build(),function(e){return e.withCustomDisplayName("Visual_ShowSubtotal").withDisabled(!a)}).addSimpleSlice("columnSubtotalsLabel",new I.TextInputBuilder({descriptor:__assign(__assign({},u),{selector:a}),value:s||l,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Subtotal_Label")})}),e.addGroup("values",function(e){var t,i;e.withDisplayName("Visual_Tablix_Values"),a?e.withDisabled(!0,""):(t={id:"Column"},i=(new I.FontControlBuilder).withFontFamily({descriptor:__assign(__assign({},r.fontFamily),{selector:t}),value:n.fontFamily}).withFontSizeProperties({descriptor:__assign(__assign({},r.fontSize),{selector:t}),value:n.fontSize.pt}),o.enableBIU&&i.withBold({descriptor:__assign(__assign({},r.bold),{selector:t}),value:n.bold}).withItalic({descriptor:__assign(__assign({},r.italic),{selector:t}),value:n.italic}).withUnderline({descriptor:__assign(__assign({},r.underline),{selector:t}),value:n.underline}),i=i.build(),e.addCompositeSlice("font","Font",i).addSimpleSlice("fontColor",function(){var e={value:n.fontColor};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},r.fontColor),{selector:t}),value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:n.backColor};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},r.backColor),{selector:t}),value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}),e.addSimpleSlice("applyToHeaders",new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},r.applyToHeaders),{selector:t}),value:n.applyToHeaders}).build()))})},B.prototype.getColumnFormattingCard=function(t,e,o,r){var n,a,i;if(!_.isEmpty(o))return(i=(r===L.TableEx?R.tableExProps:R.pivotTableProps).columnFormatting).dataBars,n=__rest(i,["dataBars"]),a=e.columnFormatting,(i=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("columnFormatting"),"Visual_Tablix_Specific_Column",n,function(e){return t.getLocalizedString(e)})).withDescription("Visual_Matrix_SpecificColumn_Description"),i.addGroup("columns",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){e.withDisplayName("Series");for(var t=0,i=o;t<i.length;t++)!function(i){var t=i&&i.objects;e.addContainerItem(i.queryName,i.displayName,function(e){e.addSimpleSlice(n.styleHeader,new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},n.styleHeader),{selector:{metadata:i.queryName}}),value:a[i.queryName].styleHeader}).build()),r===L.PivotTable&&e.addSimpleSlice(n.styleSubtotals,new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},n.styleSubtotals),{selector:{metadata:i.queryName}}),value:R.TablixProperties.PropColumnFormattingStyleSubtotals.setInstanceProperty(void 0,t)}).build()),e.addSimpleSlice(n.styleTotal,new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},n.styleTotal),{selector:{metadata:i.queryName}}),value:a[i.queryName].styleTotal}).build()).addSimpleSlice(n.styleValues,new I.ToggleSwitchBuilder({descriptor:__assign(__assign({},n.styleValues),{selector:{metadata:i.queryName}}),value:a[i.queryName].styleValues}).build()),e.addGroup("values",function(e){var t;e.withDisplayName("Visual_Tablix_Values").addSimpleSlice("fontColor",function(){var e={value:a[i.queryName].fontColor};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},n.fontColor),{selector:{metadata:i.queryName}}),value:e}).build()},function(e){return e.withCustomDisplayName("Text_Color")}).addSimpleSlice("backColor",function(){var e={value:a[i.queryName].backColor};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},n.backColor),{selector:{metadata:i.queryName}}),value:e}).build()},function(e){return e.withCustomDisplayName("Background_Color")}).addSimpleSlice("alignment",new I.AlignmentGroupBuilder({descriptor:__assign(__assign({},n.alignment),{selector:{metadata:i.queryName}}),mode:"horizontalAlignment",supportsNoSelection:!0,value:a[i.queryName].alignment}).build()),!i.type.numeric||r!==L.PivotTable&&r!==L.TableEx||(t=i&&i.objects,e.addSimpleSlice("labelDisplayUnits",new I.DropdownBuilder({descriptor:__assign(__assign({},n.labelDisplayUnits),{selector:{metadata:i.queryName}}),value:R.TablixProperties.PropColumnFormattingDisplayUnits.setInstanceProperty(void 0,t)}).build()).addSimpleSlice("labelPrecision",new I.NumUpDownBuilder({descriptor:__assign(__assign({},n.labelPrecision),{selector:{metadata:i.queryName}}),value:R.TablixProperties.PropColumnFormattingPrecision.setInstanceProperty(void 0,t),options:{minValue:{type:0,value:0},maxValue:{type:1,value:R.DataLabelViewModel.MaxLabelPrecision}}}).build()))})})}(i[t])})}),i.build()},B.prototype.getCellColumnCard=function(t,e,i,o){var r=h.visuals.getTableExCapabilities().objects,n=[];return this.enumerateObjectRepetition(n,i,e,o.conditionalTablixWebURL),R.ConditionalFormatting.getFormattingCard(n,function(e){return t.getLocalizedString(e)},r,"Cell_Elements","Visual_Matrix_CellElements_Description")},B.prototype.getUrlIconCard=function(t,i,o){var r=(o===L.TableEx?R.tableExProps:R.pivotTableProps).values.urlIcon,n=i,a=R.pivotTableProps.columnHeaders.urlIcon,l=R.pivotTableProps.rowHeaders.urlIcon,e=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("urlIcon"),"Visual_Tablix_UrlIcon",[r,a,l],function(e){return t.getLocalizedString(e)});return e.addGroup("urlIcon",function(e){o!==L.Table&&o!==L.TableEx&&o!==L.PivotTable||e.addSimpleSlice("values",new I.ToggleSwitchBuilder({descriptor:r,value:i.values.urlIcon}).build(),function(e){return e.withCustomDisplayName("Visual_Tablix_Values")}),o===L.PivotTable&&e.addSimpleSlice("columnheaders",new I.ToggleSwitchBuilder({descriptor:a,value:n.columnHeaders.urlIcon}).build(),function(e){return e.withCustomDisplayName("Visual_Tablix_ColumnHeaders")}).addSimpleSlice("rowheaders",new I.ToggleSwitchBuilder({descriptor:l,value:n.rowHeaders.urlIcon}).build(),function(e){return e.withCustomDisplayName("Visual_Tablix_RowHeaders")})}),e.build()},B.prototype.getImageSizeCard=function(t,i,e,o){var r=(e===L.TableEx?R.tableExProps:R.pivotTableProps).grid.imageHeight,n=(e===L.TableEx?R.tableExProps:R.pivotTableProps).grid.imageWidth,e=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("imageHeight"),"Visual_Tablix_ImageSize",[r,n],function(e){return t.getLocalizedString(e)});return e.addGroup("imageHeight",function(e){e.addSimpleSlice("imageHeight",new I.NumUpDownBuilder({descriptor:r,value:i.grid.imageHeight,options:{minValue:{type:0,value:B.ImageSizeMin},maxValue:{type:1,value:B.ImageSizeMax},unitSymbol:R.visualLocKeys.PixelUnitSymbol}}).build()),o.tablixImageWidth&&e.addSimpleSlice("imageWidth",new I.NumUpDownBuilder({descriptor:n,value:i.grid.imageWidth,options:{minValue:{type:0,value:B.ImageSizeMin},maxValue:{type:1,value:B.ImageSizeMax},unitSymbol:R.visualLocKeys.PixelUnitSymbol}}).build())}),e.build()},B.prototype.getSparklinesCard=function(r,t,e){var n,a,l=this;if(!_.isEmpty(r)&&this.hasSparklines(r))return n=function(e){return t.getLocalizedString(e)},a=(e===L.TableEx?R.tableExProps:R.pivotTableProps).sparklines,(e=new I.FormattingCardBuilder(new I.FormattingCardUidBuilder("sparklines"),"Sparkline_Label",a,n)).addGroup("columns",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){e.withDisplayName("Sparkline_Singular_Label");for(var t,i=0,o=r;i<o.length;i++)!function(i){if(!(null==(t=i.type.misc)?void 0:t.sparkline))return;var o=i&&i.objects;e.addContainerItem(i.queryName,i.displayName,function(e){var t=R.TablixProperties.PropSparklinesChartType.setInstanceProperty(void 0,o);e.addGroup("sparklines",function(e){e.withDisplayName("Sparkline_Singular_Label").addSimpleSlice("chartType",new I.DropdownBuilder({descriptor:__assign(__assign({},a.chartType),{selector:{metadata:i.queryName}}),value:t}).build()).addSimpleSlice("dataColor",function(){var e={value:l.tablixProperties.PropSparklinesDataColor.setInstanceProperty(void 0,o).solid.color};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},a.dataColor),{selector:{metadata:i.queryName}}),value:e}).build()}),t===R.sparklineChartType.line&&e.addSimpleSlice("strokeWidth",new I.SliderBuilder({descriptor:__assign(__assign({},a.strokeWidth),{selector:{metadata:i.queryName}}),value:R.TablixProperties.PropSparklinesStrokeWidth.setInstanceProperty(void 0,o),localize:n,options:{minValue:{type:0,value:1},maxValue:{type:1,value:4}}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}),t===R.sparklineChartType.line&&e.addGroup("markers",function(e){var t=R.TablixProperties.PropSparklinesMarkerType.getValue(o);e.withDisplayName(n("Marker")).addSimpleSlice("markers",new I.FlagSelectionBuilder({descriptor:__assign(__assign({},a.markers),{selector:{metadata:i.queryName}}),value:t}).build(),function(e){return e.withCustomDisplayName("Sparkline_Formatting_Slice_Show_These_Markers")}),null!=t&&0!==t&&e.addSimpleSlice("markerColor",function(){var e={value:l.tablixProperties.PropSparklinesMarkerColor.setInstanceProperty(void 0,o).solid.color};return new I.ColorPickerBuilder({descriptor:__assign(__assign({},a.markerColor),{selector:{metadata:i.queryName}}),value:e}).build()},function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("markerShape",new I.DropdownBuilder({descriptor:__assign(__assign({},a.markerShape),{selector:{metadata:i.queryName}}),value:R.TablixProperties.PropSparklinesMarkerShape.setInstanceProperty(void 0,o)}).build(),function(e){return e.withCustomDisplayName("Type")}).addSimpleSlice("markerSize",new I.SliderBuilder({descriptor:__assign(__assign({},a.markerSize),{selector:{metadata:i.queryName}}),value:R.TablixProperties.PropSparklinesMarkerSize.setInstanceProperty(void 0,o),localize:n,options:{minValue:{type:0,value:3},maxValue:{type:1,value:5}}}).build(),function(e){return e.withCustomDisplayName("Visual_BubbleSize")})})})}(o[i])})}),e.build()},B.prototype.hasSparklines=function(e){for(var t,i=0,o=e;i<o.length;i++)if(null==(t=o[i].type.misc)?void 0:t.sparkline)return!0;return!1},B.prototype.enumerateObjectInstances=function(e,t,i,o,r,n,a,l){void 0===n&&(n={}),void 0===a&&(a=!1);var s=B.getMetadataObjects(i),u=this.getTablixTextClassProperties(l),h=!0,h=o===L.Table?this.shouldShowTableTotalsOption(i)&&R.TablixProperties.PropGeneralTableTotals.getValue(s):this.shouldShowColumnSubtotalsOption(i)&&R.TablixProperties.PropGeneralMatrixColumnSubtotals.getValue(s)||this.shouldShowRowSubtotalsOption(i)&&R.TablixProperties.PropGeneralMatrixRowSubtotals.getValue(s);switch(e.objectName){case R.TablixProperties.ObjectGeneral:this.enumerateGeneralOptions(t,s,o,i);break;case R.TablixProperties.ObjectGrid:this.enumerateGridOptions(t,s,o,u,n);break;case R.TablixProperties.ObjectColumnHeaders:this.enumerateColumnHeadersOptions(t,s,o,u,n);break;case R.TablixProperties.ObjectRowHeaders:this.enumerateRowHeadersOptions(t,s,o,a,u,n);break;case R.TablixProperties.ObjectValues:this.enumerateValuesOptions(t,s,o,u,n);break;case R.TablixProperties.ObjectTotal:o===L.TableEx?this.enumerateTotalOptions(t,s,L.TableEx,r,n,u):h&&(o===L.Table?this.enumerateTotalOptions(t,s,L.TableEx,r,n,u):this.enumerateGrandTotalOptions(t,s,o,u,n));break;case R.TablixProperties.ObjectColumnTotal:o===L.PivotTable&&n.splitGrandTotals&&this.enumerateColumnGrandTotalOptions(t,s,u,n);break;case R.TablixProperties.ObjectRowTotal:o===L.PivotTable&&n.splitGrandTotals&&this.enumerateRowGrandTotalOptions(t,s,u,n);break;case R.TablixProperties.ObjectSubTotals:!h&&o!==L.PivotTable||this.enumerateSubTotalsOptions(t,s,o,i,r,n,u);break;case R.TablixProperties.ObjectColumnFormatting:this.enumerateColumnFormattingOptions(t,this.getColumnsMetadata(i,o),o);break;case R.TablixProperties.ObjectSparklines:this.enumerateSparklines(t,this.getColumnsMetadata(i,o))}},B.prototype.getColumnsMetadata=function(e,t){switch(t){case L.Table:case L.TableEx:return this.getTableColumnMetadata(e);case L.Matrix:case L.PivotTable:return this.getMatrixValuesColumnMetadata(e);default:return}},B.prototype.getTableColumnMetadata=function(e){if(e&&e.table&&!_.isEmpty(e.table.columns))return e.table.columns},B.prototype.getMatrixValuesColumnMetadata=function(e){if(e&&e.matrix&&!_.isEmpty(e.matrix.valueSources))return e.matrix.valueSources},B.prototype.createVisualObjectInstance=function(e,t,i){t={selector:t=void 0===t?null:t,objectName:e,properties:{}};return null!=i&&(t.displayName=i),t},B.prototype.enumerateGeneralOptions=function(e,t,i,o){var r=this.createVisualObjectInstance(R.TablixProperties.ObjectGeneral);switch(i){case L.Table:R.TablixProperties.PropGeneralAutoSizeColumns.setInstanceProperty(r,t),R.TablixProperties.PropGeneralTextSize.setInstanceProperty(r,t),this.shouldShowTableTotalsOption(o)&&R.TablixProperties.PropGeneralTableTotals.setInstanceProperty(r,t);break;case L.Matrix:R.TablixProperties.PropGeneralAutoSizeColumns.setInstanceProperty(r,t),R.TablixProperties.PropGeneralTextSize.setInstanceProperty(r,t),this.shouldShowRowSubtotalsOption(o)&&R.TablixProperties.PropGeneralMatrixRowSubtotals.setInstanceProperty(r,t),this.shouldShowColumnSubtotalsOption(o)&&R.TablixProperties.PropGeneralMatrixColumnSubtotals.setInstanceProperty(r,t)}e.pushInstance(r)},B.prototype.enumerateGridOptions=function(e,t,i,o,r){var n=this.createVisualObjectInstance(R.TablixProperties.ObjectGrid),a=o.labelFontProperties.size&&o.labelFontProperties.size.pt,l=R.TablixProperties.PropGridVertical.getValue(t),l=(R.TablixProperties.PropGridVertical.setInstanceProperty(n,t),l&&(this.tablixProperties.PropGridVerticalColor.setInstanceProperty(n,t),R.TablixProperties.PropGridVerticalWeight.setInstanceProperty(n,t)),i===L.Table||i===L.TableEx),s=(l?R.TablixProperties.PropGridHorizontalTable:R.TablixProperties.PropGridHorizontalMatrix).getValue(t);(l?R.TablixProperties.PropGridHorizontalTable:R.TablixProperties.PropGridHorizontalMatrix).setInstanceProperty(n,t),s&&(this.tablixProperties.PropGridHorizontalColor.setInstanceProperty(n,t),R.TablixProperties.PropGridHorizontalWeight.setInstanceProperty(n,t)),R.TablixProperties.PropGridRowPadding.setInstanceProperty(n,t),i!==L.PivotTable&&i!==L.TableEx||!r.upgradeOutlineProperties||(r.outlineDropdownToCheckboxes?R.TablixProperties.PropGridOutlineStyle.setInstanceProperty(n,t,this.outlineOverrideFn,R.DefaultGridOutlineStyle):R.TablixProperties.PropGridOutline.setInstanceProperty(n,t,this.outlineOverrideFn,R.DefaultGridOutline)),this.tablixProperties.PropGridOutlineColor.setInstanceProperty(n,t),R.TablixProperties.PropGridOutlineWeight.setInstanceProperty(n,t),i!==L.PivotTable&&i!==L.TableEx||R.TablixProperties.PropGridPivotTableTextSize.setInstanceProperty(n,t,o.fontSizeOverrideFn,a),R.TablixProperties.PropGridImageHeight.setInstanceProperty(n,t),e.pushInstance(n)},B.prototype.enumerateColumnHeadersOptions=function(e,t,i,o,r){var n,a=this.createVisualObjectInstance(R.TablixProperties.ObjectColumnHeaders),l=o.labelFontProperties.size&&o.labelFontProperties.size.pt;this.tablixProperties.PropColumnsFontColor.setInstanceProperty(a,t,o.fontColorOverrideFn,o.labelFontProperties.color),this.tablixProperties.PropColumnsBackColor.setInstanceProperty(a,t),(i===L.PivotTable||i===L.TableEx?((r.outlineDropdownToCheckboxes?(n=this.ensureOutline(R.TablixProperties.PropColumnsOutlineStyle.getValue(t),t,R.DefaultColumnsOutlineStyle,r.outlineDropdownToCheckboxes),R.TablixProperties.PropColumnsOutlineStyle):(n=this.ensureOutline(R.TablixProperties.PropColumnsNewVisualOutline.getValue(t),t,R.DefaultColumnsOutline,r.outlineDropdownToCheckboxes),R.TablixProperties.PropColumnsNewVisualOutline)).setInstanceProperty(a,t,this.outlineOverrideFn,n),r.upgradeOutlineProperties&&(n=this.ensureOutlineWeight(R.TablixProperties.PropColumnsOutlineWeight.getValue(t),t),R.TablixProperties.PropColumnsOutlineWeight.setInstanceProperty(a,t,this.outlineOverrideFn,n),n=this.ensureOutlineColor(this.tablixProperties.PropColumnsOutlineColor.getValue(t),t),this.tablixProperties.PropColumnsOutlineColor.setInstanceProperty(a,t,this.outlineOverrideFn,n)),R.TablixProperties.PropColumnPivotTableAutoSizeColumns.setInstanceProperty(a,t),R.TablixProperties.PropColumnsFontFamily.setInstanceProperty(a,t,o.fontFamilyOverrideFn,o.labelFontProperties.family),R.TablixProperties.PropColumnsFontSize.setInstanceProperty(a,t,o.fontSizeOverrideFn,l),r.enableBIU&&(R.TablixProperties.PropColumnsBold.setInstanceProperty(a,t),R.TablixProperties.PropColumnsItalic.setInstanceProperty(a,t),R.TablixProperties.PropColumnsUnderline.setInstanceProperty(a,t)),R.TablixProperties.PropColumnsAlignment):R.TablixProperties.PropColumnsOutline).setInstanceProperty(a,t),i===L.PivotTable&&(R.TablixProperties.PropColumnsAlignmentTitle.setInstanceProperty(a,t),R.TablixProperties.PropColumnsUrlIcon.setInstanceProperty(a,t)),i!==L.Table&&i!==L.TableEx&&i!==L.PivotTable||R.TablixProperties.PropColumnsWordWrap.setInstanceProperty(a,t),e.pushInstance(a)},B.prototype.enumerateRowHeadersOptions=function(e,t,i,o,r,n){void 0===o&&(o=!1);var a,l=this.createVisualObjectInstance(R.TablixProperties.ObjectRowHeaders),s=r.labelFontProperties.size&&r.labelFontProperties.size.pt;this.tablixProperties.PropRowsFontColor.setInstanceProperty(l,t,r.fontColorOverrideFn,r.labelFontProperties.color),this.tablixProperties.PropRowsBackColor.setInstanceProperty(l,t),i===L.PivotTable||i===L.TableEx?(n.outlineDropdownToCheckboxes?(a=this.ensureOutline(R.TablixProperties.PropRowsOutlineStyle.getValue(t),t,R.DefaultRowsOutlineStyle,n.outlineDropdownToCheckboxes),R.TablixProperties.PropRowsOutlineStyle):(a=this.ensureOutline(R.TablixProperties.PropRowsPivotTableOutline.getValue(t),t,R.DefaultRowsOutline,n.outlineDropdownToCheckboxes),R.TablixProperties.PropRowsPivotTableOutline)).setInstanceProperty(l,t,this.outlineOverrideFn,a):R.TablixProperties.PropRowsOutline.setInstanceProperty(l,t),i===L.PivotTable&&(n.upgradeOutlineProperties&&(a=this.ensureOutlineWeight(R.TablixProperties.PropRowsOutlineWeight.getValue(t),t),R.TablixProperties.PropRowsOutlineWeight.setInstanceProperty(l,t,this.outlineOverrideFn,a),a=this.ensureOutlineColor(this.tablixProperties.PropRowsOutlineColor.getValue(t),t),this.tablixProperties.PropRowsOutlineColor.setInstanceProperty(l,t,this.outlineOverrideFn,a)),R.TablixProperties.PropRowsSteppedLayout.setInstanceProperty(l,t)&&R.TablixProperties.PropRowsSteppedLayoutIndentation.setInstanceProperty(l,t),R.TablixProperties.PropRowsUrlIcon.setInstanceProperty(l,t)),i!==L.Matrix&&i!==L.PivotTable||R.TablixProperties.PropRowsWordWrap.setInstanceProperty(l,t),i!==L.PivotTable&&i!==L.TableEx||(R.TablixProperties.PropRowsFontFamily.setInstanceProperty(l,t,r.fontFamilyOverrideFn,r.labelFontProperties.family),R.TablixProperties.PropRowsFontSize.setInstanceProperty(l,t,r.fontSizeOverrideFn,s),n.enableBIU&&(R.TablixProperties.PropRowsBold.setInstanceProperty(l,t),R.TablixProperties.PropRowsItalic.setInstanceProperty(l,t),R.TablixProperties.PropRowsUnderline.setInstanceProperty(l,t)),R.TablixProperties.PropRowsAlignment.setInstanceProperty(l,t)),i===L.PivotTable&&o&&(R.TablixProperties.PropRowsShowExpandCollapseButtons.setInstanceProperty(l,t),R.TablixProperties.PropRowsShowExpandCollapseButtons.getValue(t))&&(this.tablixProperties.PropRowsExpandCollapseButtonsColor.setInstanceProperty(l,t),R.TablixProperties.PropRowsExpandCollapseButtonsSize.setInstanceProperty(l,t)),e.pushInstance(l)},B.prototype.enumerateValuesOptions=function(e,t,i,o,r){var n,a=this.createVisualObjectInstance(R.TablixProperties.ObjectValues),l=o.labelFontProperties.size&&o.labelFontProperties.size.pt;this.tablixProperties.PropValuesFontColorPrimary.setInstanceProperty(a,t,o.fontColorOverrideFn,o.labelFontProperties.color),this.tablixProperties.PropValuesBackColorPrimary.setInstanceProperty(a,t),this.tablixProperties.PropValuesFontColorSecondary.setInstanceProperty(a,t),this.tablixProperties.PropValuesBackColorSecondary.setInstanceProperty(a,t),i===L.PivotTable&&(R.TablixProperties.PropValuesBandedRowHeaders.setInstanceProperty(a,t),R.TablixProperties.PropValuesOnRow.setInstanceProperty(a,t)),i===L.PivotTable||i===L.TableEx?((r.outlineDropdownToCheckboxes?(n=this.ensureOutline(R.TablixProperties.PropValuesOutlineStyle.getValue(t),t,R.DefaultValuesOutlineStyle,r.outlineDropdownToCheckboxes),R.TablixProperties.PropValuesOutlineStyle):(n=this.ensureOutline(R.TablixProperties.PropValuesNewVisualOutline.getValue(t),t,R.DefaultValuesOutline,r.outlineDropdownToCheckboxes),R.TablixProperties.PropValuesNewVisualOutline)).setInstanceProperty(a,t,this.outlineOverrideFn,n),r.upgradeOutlineProperties&&(n=this.ensureOutlineWeight(R.TablixProperties.PropValuesOutlineWeight.getValue(t),t),R.TablixProperties.PropValuesOutlineWeight.setInstanceProperty(a,t,this.outlineOverrideFn,n),n=this.ensureOutlineColor(this.tablixProperties.PropValuesOutlineColor.getValue(t),t),this.tablixProperties.PropValuesOutlineColor.setInstanceProperty(a,t,this.outlineOverrideFn,n))):R.TablixProperties.PropValuesOutline.setInstanceProperty(a,t),i!==L.Table&&i!==L.TableEx&&i!==L.PivotTable||R.TablixProperties.PropValuesUrlIcon.setInstanceProperty(a,t),i!==L.PivotTable&&i!==L.TableEx||(R.TablixProperties.PropValuesWordWrap.setInstanceProperty(a,t),R.TablixProperties.PropValuesFontFamily.setInstanceProperty(a,t,o.fontFamilyOverrideFn,o.labelFontProperties.family),R.TablixProperties.PropValuesFontSize.setInstanceProperty(a,t,o.fontSizeOverrideFn,l),r.enableBIU&&(R.TablixProperties.PropValuesBold.setInstanceProperty(a,t),R.TablixProperties.PropValuesItalic.setInstanceProperty(a,t),R.TablixProperties.PropValuesUnderline.setInstanceProperty(a,t))),e.pushInstance(a)},B.prototype.enumerateTotalOptions=function(e,t,i,o,r,n){var a,l=this.createVisualObjectInstance(R.TablixProperties.ObjectTotal),s=n.boldLabelFontProperties.size&&n.boldLabelFontProperties.size.pt,u=i!==L.TableEx||R.TablixProperties.PropTotalTableExTotals.setInstanceProperty(l,t);u&&(i===L.TableEx&&(u=R.TablixProperties.PropTotalTableExTotalLabel.getValue(t,!0)||o(F.TotalLabel),l.properties[R.TablixProperties.PropTotalTableExTotalLabel.propertyName]=u),this.tablixProperties.PropTotalFontColor.setInstanceProperty(l,t,n.fontColorOverrideFn,n.boldLabelFontProperties.color),this.tablixProperties.PropTotalBackColor.setInstanceProperty(l,t),i===L.PivotTable||i===L.TableEx?(r.outlineDropdownToCheckboxes?(a=this.ensureOutline(R.TablixProperties.PropTotalOutlineStyle.getValue(t),t,R.DefaultTotalOutlineStyle,r.outlineDropdownToCheckboxes),R.TablixProperties.PropTotalOutlineStyle):(a=this.ensureOutline(R.TablixProperties.PropTotalTableExOutline.getValue(t),t,R.DefaultTotalOutline,r.outlineDropdownToCheckboxes),R.TablixProperties.PropTotalTableExOutline)).setInstanceProperty(l,t,this.outlineOverrideFn,a):R.TablixProperties.PropTotalOutline.setInstanceProperty(l,t),i===L.TableEx&&r.upgradeOutlineProperties&&(o=this.ensureOutlineWeight(R.TablixProperties.PropTotalOutlineWeight.getValue(t),t),R.TablixProperties.PropTotalOutlineWeight.setInstanceProperty(l,t,this.outlineOverrideFn,o),u=this.ensureOutlineColor(this.tablixProperties.PropTotalOutlineColor.getValue(t),t),this.tablixProperties.PropTotalOutlineColor.setInstanceProperty(l,t,this.outlineOverrideFn,u)),i!==L.PivotTable&&i!==L.TableEx||(R.TablixProperties.PropTotalFontFamily.setInstanceProperty(l,t,n.fontFamilyOverrideFn,n.boldLabelFontProperties.family),R.TablixProperties.PropTotalFontSize.setInstanceProperty(l,t,n.fontSizeOverrideFn,s),r.enableBIU&&(R.TablixProperties.PropTotalBold.setInstanceProperty(l,t),R.TablixProperties.PropTotalItalic.setInstanceProperty(l,t),R.TablixProperties.PropTotalUnderline.setInstanceProperty(l,t)))),e.pushInstance(l)},B.prototype.enumerateGrandTotalOptions=function(e,t,i,o,r){var n,a;r.splitGrandTotals&&i===L.PivotTable||(n=this.createVisualObjectInstance(R.TablixProperties.ObjectTotal),a=o.boldLabelFontProperties.size&&o.boldLabelFontProperties.size.pt,this.tablixProperties.PropGrandTotalFontColor.setInstanceProperty(n,t,o.fontColorOverrideFn,o.boldLabelFontProperties.color),R.TablixProperties.PropGrandTotalFontFamily.setInstanceProperty(n,t),this.tablixProperties.PropGrandTotalBackColor.setInstanceProperty(n,t),R.TablixProperties.PropGrandTotalApplyToHeaders.setInstanceProperty(n,t),i!==L.PivotTable&&i!==L.TableEx||(R.TablixProperties.PropGrandTotalFontFamily.setInstanceProperty(n,t,o.fontFamilyOverrideFn,o.boldLabelFontProperties.family),R.TablixProperties.PropGrandTotalFontSize.setInstanceProperty(n,t,o.fontSizeOverrideFn,a),r.enableBIU&&(R.TablixProperties.PropGrandTotalBold.setInstanceProperty(n,t),R.TablixProperties.PropGrandTotalItalic.setInstanceProperty(n,t),R.TablixProperties.PropGrandTotalUnderline.setInstanceProperty(n,t))),e.pushInstance(n))},B.prototype.enumerateColumnGrandTotalOptions=function(e,t,i,o){var r=this.createVisualObjectInstance(R.TablixProperties.ObjectColumnTotal),n=i.boldLabelFontProperties.size&&i.boldLabelFontProperties.size.pt;this.tablixProperties.PropColumnGrandTotalFontColor.setInstanceProperty(r,t,i.fontColorOverrideFn,i.boldLabelFontProperties.color),R.TablixProperties.PropColumnGrandTotalFontFamily.setInstanceProperty(r,t),this.tablixProperties.PropColumnGrandTotalBackColor.setInstanceProperty(r,t),R.TablixProperties.PropColumnGrandTotalApplyToHeaders.setInstanceProperty(r,t),R.TablixProperties.PropColumnGrandTotalFontFamily.setInstanceProperty(r,t,i.fontFamilyOverrideFn,i.boldLabelFontProperties.family),R.TablixProperties.PropColumnGrandTotalFontSize.setInstanceProperty(r,t,i.fontSizeOverrideFn,n),o.enableBIU&&(R.TablixProperties.PropColumnGrandTotalBold.setInstanceProperty(r,t),R.TablixProperties.PropColumnGrandTotalItalic.setInstanceProperty(r,t),R.TablixProperties.PropColumnGrandTotalUnderline.setInstanceProperty(r,t)),e.pushInstance(r)},B.prototype.enumerateRowGrandTotalOptions=function(e,t,i,o){var r=this.createVisualObjectInstance(R.TablixProperties.ObjectRowTotal),n=i.boldLabelFontProperties.size&&i.boldLabelFontProperties.size.pt;this.tablixProperties.PropRowGrandTotalFontColor.setInstanceProperty(r,t,i.fontColorOverrideFn,i.boldLabelFontProperties.color),R.TablixProperties.PropRowGrandTotalFontFamily.setInstanceProperty(r,t),this.tablixProperties.PropRowGrandTotalBackColor.setInstanceProperty(r,t),R.TablixProperties.PropRowGrandTotalApplyToHeaders.setInstanceProperty(r,t),R.TablixProperties.PropRowGrandTotalFontFamily.setInstanceProperty(r,t,i.fontFamilyOverrideFn,i.boldLabelFontProperties.family),R.TablixProperties.PropRowGrandTotalFontSize.setInstanceProperty(r,t,i.fontSizeOverrideFn,n),o.enableBIU&&(R.TablixProperties.PropRowGrandTotalBold.setInstanceProperty(r,t),R.TablixProperties.PropRowGrandTotalItalic.setInstanceProperty(r,t),R.TablixProperties.PropRowGrandTotalUnderline.setInstanceProperty(r,t)),e.pushInstance(r)},B.prototype.enumerateSubTotalsOptions=function(e,t,i,o,r,n,a){var l,s,u,h,d,c=!1,p=!1;i===L.PivotTable&&(u=r(F.TotalLabel),h=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals),(c=this.shouldShowRowSubtotalsOption(o)?R.TablixProperties.PropSubTotalsPivotTableRowSubtotals.setInstanceProperty(h,t):c)&&(l=R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsLabel.getValue(t,!0)||u,h.properties[R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsLabel.propertyName]=l),n.splitSubTotals||(p=this.shouldShowColumnSubtotalsOption(o)?R.TablixProperties.PropSubTotalsPivotTableColumnSubtotals.setInstanceProperty(h,t):p)&&(s=R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsLabel.getValue(t,!0)||u,h.properties[R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsLabel.propertyName]=s),e.pushInstance(h)),n.splitSubTotals?this.enumerateSubtotalsFontProperties(e,t,a,n,i,"Row"):this.enumerateSubtotalsFontProperties(e,t,a,n,i),c&&(h=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals),R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsPosition.setInstanceProperty(h,t),e.pushInstance(h),h=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals),d=R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsPerLevel.setInstanceProperty(h,t),e.pushInstance(h,!1),d)&&this.enumeratePerLevelSubtotals(e,o.matrix.rows.levels,l,r),n.splitSubTotals&&i===L.PivotTable&&(h=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals),(p=this.shouldShowColumnSubtotalsOption(o)?R.TablixProperties.PropSubTotalsPivotTableColumnSubtotals.setInstanceProperty(h,t):p)&&(s=R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsLabel.getValue(t,!0)||u,h.properties[R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsLabel.propertyName]=s),e.pushInstance(h,!1)),n.splitSubTotals&&this.enumerateSubtotalsFontProperties(e,t,a,n,i,"Column"),p&&(h=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals),d=R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsPerLevel.setInstanceProperty(h,t),e.pushInstance(h,!1),_.isEmpty(o.matrix.columns.levels),d)&&this.enumeratePerLevelSubtotals(e,o.matrix.columns.levels,s,r)},B.prototype.enumerateSubtotalsFontProperties=function(e,t,i,o,r,n){var a=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals,n?{id:n}:void 0),l=i.boldLabelFontProperties.size&&i.boldLabelFontProperties.size.pt;this.tablixProperties.PropSubTotalsFontColor.setInstanceProperty(a,t,i.fontColorOverrideFn,i.boldLabelFontProperties.color,n),R.TablixProperties.PropSubTotalsFontFamily.setInstanceProperty(a,t,void 0,void 0,n),this.tablixProperties.PropSubTotalsBackColor.setInstanceProperty(a,t,void 0,void 0,n),r===L.PivotTable&&(R.TablixProperties.PropSubTotalsFontFamily.setInstanceProperty(a,t,i.fontFamilyOverrideFn,i.boldLabelFontProperties.family,n),R.TablixProperties.PropSubTotalsFontSize.setInstanceProperty(a,t,i.fontSizeOverrideFn,l,n),o.enableBIU&&(R.TablixProperties.PropSubTotalsBold.setInstanceProperty(a,t,void 0,void 0,n),R.TablixProperties.PropSubTotalsItalic.setInstanceProperty(a,t,void 0,void 0,n),R.TablixProperties.PropSubTotalsUnderline.setInstanceProperty(a,t,void 0,void 0,n)),R.TablixProperties.PropSubTotalsApplyToHeaders.setInstanceProperty(a,t,void 0,void 0,n)),e.pushInstance(a)},B.prototype.enumeratePerLevelSubtotals=function(e,t,i,o){_.isEmpty(t);for(var r=0,n=t;r<n.length;r++)for(var a=0,l=n[r].sources;a<l.length;a++){var s,u=l[a];u.isMeasure||(s=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals,{metadata:u.queryName},u.displayName),R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalEnabled.setInstanceProperty(s,u.objects),e.pushInstance(s,!1),s=this.createVisualObjectInstance(R.TablixProperties.ObjectSubTotals,{metadata:u.queryName},o("Visual_PivotTable_TotalLabel",u.displayName)),u=R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalLabel.getValue(u.objects,!0)||i,s.properties[R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalLabel.propertyName]=u,e.pushInstance(s,!1))}},B.prototype.enumerateColumnFormattingOptions=function(e,t,i){if(!_.isEmpty(t))for(var o=0,r=t;o<r.length;o++){var n=r[o],a=(e.pushContainer({displayName:n.displayName}),n&&n.objects),l=this.createVisualObjectInstance(R.TablixProperties.ObjectColumnFormatting,{metadata:n.queryName});!n.type.numeric||i!==L.PivotTable&&i!==L.TableEx||(R.TablixProperties.PropColumnFormattingDisplayUnits.setInstanceProperty(l,a),R.TablixProperties.PropColumnFormattingPrecision.setInstanceProperty(l,a),R.TablixProperties.PropColumnFormattingPrecision.setInstanceValidValues(l,{numberRange:{min:0,max:R.DataLabelViewModel.MaxLabelPrecision}})),this.tablixProperties.PropColumnFormattingFontColor.setInstanceProperty(l,a),this.tablixProperties.PropColumnFormattingBackColor.setInstanceProperty(l,a),i!==L.PivotTable&&i!==L.TableEx||R.TablixProperties.PropColumnFormattingAlignment.setInstanceProperty(l,a),R.TablixProperties.PropColumnFormattingStyleHeader.setInstanceProperty(l,a),R.TablixProperties.PropColumnFormattingStyleValues.setInstanceProperty(l,a),i!==L.Matrix&&i!==L.PivotTable||R.TablixProperties.PropColumnFormattingStyleSubtotals.setInstanceProperty(l,a),R.TablixProperties.PropColumnFormattingStyleTotal.setInstanceProperty(l,a),e.pushInstance(l),e.popContainer()}},B.prototype.enumerateSparklines=function(e,t){if(!_.isEmpty(t))for(var i=0,o=t;i<o.length;i++){var r,n,a=o[i];(null==(r=a.type.misc)?void 0:r.sparkline)&&(e.pushContainer({displayName:a.displayName}),r=a&&a.objects,a=this.createVisualObjectInstance(R.TablixProperties.ObjectSparklines,{metadata:a.queryName}),R.TablixProperties.PropSparklinesChartType.setInstanceProperty(a,r),this.tablixProperties.PropSparklinesDataColor.setInstanceProperty(a,r),R.TablixProperties.PropSparklinesChartType.getValue(r)===R.sparklineChartType.line&&(R.TablixProperties.PropSparklinesStrokeWidth.setInstanceProperty(a,r),R.TablixProperties.PropSparklinesStrokeWidth.setInstanceValidValues(a,{numberRange:{min:1,max:4}}),R.TablixProperties.PropSparklinesMarkerType.setInstanceProperty(a,r),null!=(n=R.TablixProperties.PropSparklinesMarkerType.getValue(r)))&&0!==n&&(this.tablixProperties.PropSparklinesMarkerColor.setInstanceProperty(a,r),R.TablixProperties.PropSparklinesMarkerSize.setInstanceProperty(a,r),R.TablixProperties.PropSparklinesMarkerSize.setInstanceValidValues(a,{numberRange:{min:3,max:5}}),R.TablixProperties.PropSparklinesMarkerShape.setInstanceProperty(a,r)),e.pushInstance(a),e.popContainer())}},B.prototype.getTableObjects=function(e){var t=B.getMetadataObjects(e),i=R.TablixProperties.PropGeneralTextSize.getValue(t),i=null!=i?M.createFromPt(+i):void 0,o={general:{autoSizeColumnWidth:R.TablixProperties.PropGeneralAutoSizeColumns.getValue(t),textSize:i,totals:R.TablixProperties.PropGeneralTableTotals.getValue(t)}},i=(o.grid={gridVertical:R.TablixProperties.PropGridVertical.getValue(t),gridVerticalColor:this.tablixProperties.PropGridVerticalColor.getValue(t),gridVerticalWeight:R.TablixProperties.PropGridVerticalWeight.getValue(t),gridHorizontal:R.TablixProperties.PropGridHorizontalTable.getValue(t),gridHorizontalColor:this.tablixProperties.PropGridHorizontalColor.getValue(t),gridHorizontalWeight:R.TablixProperties.PropGridHorizontalWeight.getValue(t),outlineColor:this.tablixProperties.PropGridOutlineColor.getValue(t),outlineWeight:R.TablixProperties.PropGridOutlineWeight.getValue(t),rowPadding:R.TablixProperties.PropGridRowPadding.getValue(t),imageHeight:R.TablixProperties.PropGridImageHeight.getValue(t)},o.columnHeaders={fontColor:this.tablixProperties.PropColumnsFontColor.getValue(t),backColor:this.tablixProperties.PropColumnsBackColor.getValue(t),outline:R.TablixProperties.PropColumnsOutline.getValue(t),wordWrap:R.TablixProperties.PropColumnsWordWrap.getValue(t)},o.values={fontColorPrimary:this.tablixProperties.PropValuesFontColorPrimary.getValue(t),backColorPrimary:this.tablixProperties.PropValuesBackColorPrimary.getValue(t),fontColorSecondary:this.tablixProperties.PropValuesFontColorSecondary.getValue(t),backColorSecondary:this.tablixProperties.PropValuesBackColorSecondary.getValue(t),outline:R.TablixProperties.PropValuesOutline.getValue(t),urlIcon:R.TablixProperties.PropValuesUrlIcon.getValue(t)},o.total={fontColor:this.tablixProperties.PropTotalFontColor.getValue(t),backColor:this.tablixProperties.PropTotalBackColor.getValue(t),outline:R.TablixProperties.PropTotalOutline.getValue(t)},o.columnFormatting={},o.formatters={},this.getTableColumnMetadata(e));if(i)for(var r=0,n=i;r<n.length;r++){var a=n[r],l=a&&a.objects;o.columnFormatting[a.queryName]={fontColor:this.tablixProperties.PropColumnFormattingFontColor.getValue(l),backColor:this.tablixProperties.PropColumnFormattingBackColor.getValue(l),styleHeader:R.TablixProperties.PropColumnFormattingStyleHeader.getValue(l),styleValues:R.TablixProperties.PropColumnFormattingStyleValues.getValue(l),styleTotal:R.TablixProperties.PropColumnFormattingStyleTotal.getValue(l)},o.formatters[a.queryName]=new N({column:a,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!1})}return o},B.prototype.getMatrixObjects=function(e){var t=B.getMetadataObjects(e),i=R.TablixProperties.PropGeneralTextSize.getValue(t),i=null!=i?M.createFromPt(+i):void 0,o={general:{autoSizeColumnWidth:R.TablixProperties.PropGeneralAutoSizeColumns.getValue(t),textSize:i,rowSubtotals:R.TablixProperties.PropGeneralMatrixRowSubtotals.getValue(t),columnSubtotals:R.TablixProperties.PropGeneralMatrixColumnSubtotals.getValue(t)}},i=(o.grid={gridVertical:R.TablixProperties.PropGridVertical.getValue(t),gridVerticalColor:this.tablixProperties.PropGridVerticalColor.getValue(t),gridVerticalWeight:R.TablixProperties.PropGridVerticalWeight.getValue(t),gridHorizontal:R.TablixProperties.PropGridHorizontalMatrix.getValue(t),gridHorizontalColor:this.tablixProperties.PropGridHorizontalColor.getValue(t),gridHorizontalWeight:R.TablixProperties.PropGridHorizontalWeight.getValue(t),outlineColor:this.tablixProperties.PropGridOutlineColor.getValue(t),outlineWeight:R.TablixProperties.PropGridOutlineWeight.getValue(t),rowPadding:R.TablixProperties.PropGridRowPadding.getValue(t),imageHeight:R.TablixProperties.PropGridImageHeight.getValue(t)},o.columnHeaders={fontColor:this.tablixProperties.PropColumnsFontColor.getValue(t),backColor:this.tablixProperties.PropColumnsBackColor.getValue(t),outline:R.TablixProperties.PropColumnsOutline.getValue(t)},o.rowHeaders={fontColor:this.tablixProperties.PropRowsFontColor.getValue(t),backColor:this.tablixProperties.PropRowsBackColor.getValue(t),outline:R.TablixProperties.PropRowsOutline.getValue(t),wordWrap:R.TablixProperties.PropRowsWordWrap.getValue(t)},o.values={fontColorPrimary:this.tablixProperties.PropValuesFontColorPrimary.getValue(t),backColorPrimary:this.tablixProperties.PropValuesBackColorPrimary.getValue(t),fontColorSecondary:this.tablixProperties.PropValuesFontColorSecondary.getValue(t),backColorSecondary:this.tablixProperties.PropValuesBackColorSecondary.getValue(t),outline:R.TablixProperties.PropValuesOutline.getValue(t)},o.grandTotal={fontColor:this.tablixProperties.PropGrandTotalFontColor.getValue(t),backColor:this.tablixProperties.PropGrandTotalBackColor.getValue(t),applyToHeaders:R.TablixProperties.PropGrandTotalApplyToHeaders.getValue(t)},o.subtotals={fontColor:this.tablixProperties.PropSubTotalsFontColor.getValue(t),backColor:this.tablixProperties.PropSubTotalsBackColor.getValue(t)},o.columnFormatting={},o.formatters={},this.getMatrixValuesColumnMetadata(e));if(i)for(var r=0,n=i;r<n.length;r++){var a=n[r],l=a&&a.objects;o.columnFormatting[a.queryName]={fontColor:this.tablixProperties.PropColumnFormattingFontColor.getValue(l),backColor:this.tablixProperties.PropColumnFormattingBackColor.getValue(l),styleHeader:R.TablixProperties.PropColumnFormattingStyleHeader.getValue(l),styleValues:R.TablixProperties.PropColumnFormattingStyleValues.getValue(l),styleTotal:R.TablixProperties.PropColumnFormattingStyleTotal.getValue(l),styleSubTotals:R.TablixProperties.PropColumnFormattingStyleSubtotals.getValue(l)},o.formatters[a.queryName]=new N({column:a,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!1})}return this.addMatrixHierarchyColumnsFormatters(e.matrix.rows,o.formatters),this.addMatrixHierarchyColumnsFormatters(e.matrix.columns,o.formatters),o},B.prototype.addMatrixHierarchyColumnsFormatters=function(e,t,i){if(e){e.levels;for(var o=0,r=e.levels;o<r.length;o++){var n=r[o];n.sources;for(var a=0,l=n.sources;a<l.length;a++){var s,u=l[a];u.isMeasure||(t[s=u.queryName]=new N({column:u,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!1}),i&&(i[s]=new N({column:u,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!0})))}}}},B.prototype.addMatrixHierarchySubtotalLabels=function(e,t,i,o){if(e){e.levels;for(var r=0,n=e.levels;r<n.length;r++)for(var a=n[r],l=(a.sources,void 0),s=0,u=a.sources;s<u.length;s++){var h=u[s];h.isMeasure||(o&&(l=R.TablixProperties.PropSubTotalsPivotTableLevelSubtotalLabel.getValue(h.objects)),t[h.queryName]={subtotalLabel:l=l||i})}}},B.prototype.getPivotTableObjects=function(e,t,i,o,r){var n=B.getMetadataObjects(e),o=this.getTablixTextClassProperties(o),a=o.labelFontProperties.size&&o.labelFontProperties.size.pt,l=o.boldLabelFontProperties.size&&o.boldLabelFontProperties.size.pt,s=R.TablixProperties.PropGridPivotTableTextSize.getValue(n,void 0,o.fontSizeOverrideFn,a),s=null!=s?M.createFromPt(+s):void 0,u=R.TablixProperties.PropColumnsFontSize.getValue(n,void 0,o.fontSizeOverrideFn,a),u=null!=u?M.createFromPt(+u):void 0,h=R.TablixProperties.PropRowsFontSize.getValue(n,void 0,o.fontSizeOverrideFn,a),h=null!=h?M.createFromPt(+h):void 0,d=R.TablixProperties.PropRowsExpandCollapseButtonsSize.getValue(n),d=null!=d?M.createFromPt(+d):void 0,c=R.TablixProperties.PropRowsExpandCompositeHierarchy.getValue(n),a=R.TablixProperties.PropValuesFontSize.getValue(n,void 0,o.fontSizeOverrideFn,a),a=null!=a?M.createFromPt(+a):void 0,p=R.TablixProperties.PropGrandTotalFontSize.getValue(n,void 0,o.fontSizeOverrideFn,l),p=null!=p?M.createFromPt(+p):void 0,g=R.TablixProperties.PropColumnGrandTotalFontSize.getValue(n,void 0,o.fontSizeOverrideFn,l,void 0,["Column"]),g=null!=g?M.createFromPt(+g):void 0,m=R.TablixProperties.PropRowGrandTotalFontSize.getValue(n,void 0,o.fontSizeOverrideFn,l,void 0,["Row"]),m=null!=m?M.createFromPt(+m):void 0,f=R.TablixProperties.PropSubTotalsFontSize.getValue(n,void 0,o.fontSizeOverrideFn,l),f=null!=f?M.createFromPt(+f):void 0,y=R.TablixProperties.PropSubTotalsFontSize.getValue(n,void 0,o.fontSizeOverrideFn,l,"Row"),y=null!=y?M.createFromPt(+y):void 0,l=R.TablixProperties.PropSubTotalsFontSize.getValue(n,void 0,o.fontSizeOverrideFn,l,"Column"),l=null!=l?M.createFromPt(+l):void 0,b=t(F.TotalLabel),v=R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsLabel.getValue(n)||b,b=R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsLabel.getValue(n)||b,f={fontColor:this.tablixProperties.PropSubTotalsFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.boldLabelFontProperties.color),fontFamily:R.TablixProperties.PropSubTotalsFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.boldLabelFontProperties.family),fontSize:f,bold:R.TablixProperties.PropSubTotalsBold.getValue(n),italic:R.TablixProperties.PropSubTotalsItalic.getValue(n),underline:R.TablixProperties.PropSubTotalsUnderline.getValue(n),backColor:this.tablixProperties.PropSubTotalsBackColor.getValue(n),applyToHeaders:R.TablixProperties.PropSubTotalsApplyToHeaders.getValue(n)},y=r.splitSubTotals?{fontColor:this.tablixProperties.PropSubTotalsFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.boldLabelFontProperties.color,"Row"),fontFamily:R.TablixProperties.PropSubTotalsFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.boldLabelFontProperties.family,"Row"),fontSize:y,bold:R.TablixProperties.PropSubTotalsBold.getValue(n,void 0,void 0,void 0,"Row"),italic:R.TablixProperties.PropSubTotalsItalic.getValue(n,void 0,void 0,void 0,"Row"),underline:R.TablixProperties.PropSubTotalsUnderline.getValue(n,void 0,void 0,void 0,"Row"),backColor:this.tablixProperties.PropSubTotalsBackColor.getValue(n,void 0,void 0,void 0,"Row"),applyToHeaders:R.TablixProperties.PropSubTotalsApplyToHeaders.getValue(n,void 0,void 0,void 0,"Row")}:f,l=r.splitSubTotals?{fontColor:this.tablixProperties.PropSubTotalsFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.boldLabelFontProperties.color,"Column"),fontFamily:R.TablixProperties.PropSubTotalsFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.boldLabelFontProperties.family,"Column"),fontSize:l,bold:R.TablixProperties.PropSubTotalsBold.getValue(n,void 0,void 0,void 0,"Column"),italic:R.TablixProperties.PropSubTotalsItalic.getValue(n,void 0,void 0,void 0,"Column"),underline:R.TablixProperties.PropSubTotalsUnderline.getValue(n,void 0,void 0,void 0,"Column"),backColor:this.tablixProperties.PropSubTotalsBackColor.getValue(n,void 0,void 0,void 0,"Column"),applyToHeaders:R.TablixProperties.PropSubTotalsApplyToHeaders.getValue(n,void 0,void 0,void 0,"Column")}:f,f={fontColor:this.tablixProperties.PropGrandTotalFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.boldLabelFontProperties.color),fontFamily:R.TablixProperties.PropGrandTotalFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.boldLabelFontProperties.family),fontSize:p,bold:R.TablixProperties.PropGrandTotalBold.getValue(n),italic:R.TablixProperties.PropGrandTotalItalic.getValue(n),underline:R.TablixProperties.PropGrandTotalUnderline.getValue(n),backColor:this.tablixProperties.PropGrandTotalBackColor.getValue(n),applyToHeaders:R.TablixProperties.PropGrandTotalApplyToHeaders.getValue(n)},p=r.splitGrandTotals?{fontColor:this.tablixProperties.PropColumnGrandTotalFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.boldLabelFontProperties.color,void 0,["Column"]),fontFamily:R.TablixProperties.PropColumnGrandTotalFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.boldLabelFontProperties.family,void 0,["Column"]),fontSize:g,bold:R.TablixProperties.PropColumnGrandTotalBold.getValue(n),italic:R.TablixProperties.PropColumnGrandTotalItalic.getValue(n),underline:R.TablixProperties.PropColumnGrandTotalUnderline.getValue(n),backColor:this.tablixProperties.PropColumnGrandTotalBackColor.getValue(n),applyToHeaders:R.TablixProperties.PropColumnGrandTotalApplyToHeaders.getValue(n)}:f,g=r.splitGrandTotals?{fontColor:this.tablixProperties.PropRowGrandTotalFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.boldLabelFontProperties.color,void 0,["Row"]),fontFamily:R.TablixProperties.PropRowGrandTotalFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.boldLabelFontProperties.family,void 0,["Row"]),fontSize:m,bold:R.TablixProperties.PropRowGrandTotalBold.getValue(n),italic:R.TablixProperties.PropRowGrandTotalItalic.getValue(n),underline:R.TablixProperties.PropRowGrandTotalUnderline.getValue(n),backColor:this.tablixProperties.PropRowGrandTotalBackColor.getValue(n),applyToHeaders:R.TablixProperties.PropRowGrandTotalApplyToHeaders.getValue(n)}:f,C={general:{autoSizeColumnWidth:R.TablixProperties.PropColumnPivotTableAutoSizeColumns.getValue(n),textSize:s,rowSubtotals:R.TablixProperties.PropSubTotalsPivotTableRowSubtotals.getValue(n),columnSubtotals:R.TablixProperties.PropSubTotalsPivotTableColumnSubtotals.getValue(n)},grid:{gridVertical:R.TablixProperties.PropGridVertical.getValue(n),gridVerticalColor:this.tablixProperties.PropGridVerticalColor.getValue(n),gridVerticalWeight:R.TablixProperties.PropGridVerticalWeight.getValue(n),gridHorizontal:R.TablixProperties.PropGridHorizontalMatrix.getValue(n),gridHorizontalColor:this.tablixProperties.PropGridHorizontalColor.getValue(n),gridHorizontalWeight:R.TablixProperties.PropGridHorizontalWeight.getValue(n),outline:r.outlineDropdownToCheckboxes?R.TablixProperties.PropGridOutlineStyle.getValue(n)||R.DefaultGridOutlineStyle:R.TablixProperties.PropGridOutline.getValue(n)||R.DefaultGridOutline,outlineColor:this.tablixProperties.PropGridOutlineColor.getValue(n),outlineWeight:R.TablixProperties.PropGridOutlineWeight.getValue(n),rowPadding:R.TablixProperties.PropGridRowPadding.getValue(n),imageHeight:R.TablixProperties.PropGridImageHeight.getValue(n),imageWidth:R.TablixProperties.PropGridImageWidth.getValue(n)},columnHeaders:{fontColor:this.tablixProperties.PropColumnsFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.labelFontProperties.color),fontFamily:R.TablixProperties.PropColumnsFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.labelFontProperties.family),fontSize:u,bold:R.TablixProperties.PropColumnsBold.getValue(n),italic:R.TablixProperties.PropColumnsItalic.getValue(n),underline:R.TablixProperties.PropColumnsUnderline.getValue(n),backColor:this.tablixProperties.PropColumnsBackColor.getValue(n),outline:r.outlineDropdownToCheckboxes?this.ensureOutline(R.TablixProperties.PropColumnsOutlineStyle.getValue(n),n,R.DefaultColumnsOutlineStyle,r.outlineDropdownToCheckboxes):this.ensureOutline(R.TablixProperties.PropColumnsNewVisualOutline.getValue(n),n,R.DefaultColumnsOutline,r.outlineDropdownToCheckboxes),outlineColor:this.ensureOutlineColor(this.tablixProperties.PropColumnsOutlineColor.getValue(n),n),outlineWeight:this.ensureOutlineWeight(R.TablixProperties.PropColumnsOutlineWeight.getValue(n),n),urlIcon:R.TablixProperties.PropColumnsUrlIcon.getValue(n),wordWrap:R.TablixProperties.PropColumnsWordWrap.getValue(n),alignment:R.TablixProperties.PropColumnsAlignment.getValue(n),titleAlignment:R.TablixProperties.PropColumnsAlignmentTitle.getValue(n)},rowHeaders:{fontColor:this.tablixProperties.PropRowsFontColor.getValue(n,void 0,o.fontColorOverrideFn,o.labelFontProperties.color),fontFamily:R.TablixProperties.PropRowsFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.labelFontProperties.family),fontSize:h,bold:R.TablixProperties.PropRowsBold.getValue(n),italic:R.TablixProperties.PropRowsItalic.getValue(n),underline:R.TablixProperties.PropRowsUnderline.getValue(n),backColor:this.tablixProperties.PropRowsBackColor.getValue(n),outline:r.outlineDropdownToCheckboxes?this.ensureOutline(R.TablixProperties.PropRowsOutlineStyle.getValue(n),n,R.DefaultRowsOutlineStyle,r.outlineDropdownToCheckboxes):this.ensureOutline(R.TablixProperties.PropRowsPivotTableOutline.getValue(n),n,R.DefaultRowsOutline,r.outlineDropdownToCheckboxes),outlineColor:this.ensureOutlineColor(this.tablixProperties.PropRowsOutlineColor.getValue(n),n),outlineWeight:this.ensureOutlineWeight(R.TablixProperties.PropRowsOutlineWeight.getValue(n),n),steppedLayout:R.TablixProperties.PropRowsSteppedLayout.getValue(n),steppedLayoutIndentation:R.TablixProperties.PropRowsSteppedLayoutIndentation.getValue(n),urlIcon:R.TablixProperties.PropRowsUrlIcon.getValue(n),wordWrap:R.TablixProperties.PropRowsWordWrap.getValue(n),alignment:R.TablixProperties.PropRowsAlignment.getValue(n),showExpandCollapseButtons:!!i&&R.TablixProperties.PropRowsShowExpandCollapseButtons.getValue(n),expandCollapseButtonsColor:this.tablixProperties.PropRowsExpandCollapseButtonsColor.getValue(n),expandCollapseButtonsSize:d,expandCompositeHierarchy:c},values:{fontFamily:R.TablixProperties.PropValuesFontFamily.getValue(n,void 0,o.fontFamilyOverrideFn,o.labelFontProperties.family),fontSize:a,bold:R.TablixProperties.PropValuesBold.getValue(n),italic:R.TablixProperties.PropValuesItalic.getValue(n),underline:R.TablixProperties.PropValuesUnderline.getValue(n),fontColorPrimary:this.tablixProperties.PropValuesFontColorPrimary.getValue(n,void 0,o.fontColorOverrideFn,o.labelFontProperties.color),backColorPrimary:this.tablixProperties.PropValuesBackColorPrimary.getValue(n),fontColorSecondary:this.tablixProperties.PropValuesFontColorSecondary.getValue(n),backColorSecondary:this.tablixProperties.PropValuesBackColorSecondary.getValue(n),bandedRowHeaders:R.TablixProperties.PropValuesBandedRowHeaders.getValue(n),outline:r.outlineDropdownToCheckboxes?this.ensureOutline(R.TablixProperties.PropValuesOutlineStyle.getValue(n),n,R.DefaultValuesOutlineStyle,r.outlineDropdownToCheckboxes):this.ensureOutline(R.TablixProperties.PropValuesNewVisualOutline.getValue(n),n,R.DefaultValuesOutline,r.outlineDropdownToCheckboxes),outlineColor:this.ensureOutlineColor(this.tablixProperties.PropValuesOutlineColor.getValue(n),n),outlineWeight:this.ensureOutlineWeight(R.TablixProperties.PropValuesOutlineWeight.getValue(n),n),urlIcon:R.TablixProperties.PropValuesUrlIcon.getValue(n),wordWrap:R.TablixProperties.PropValuesWordWrap.getValue(n),valuesOnRow:R.TablixProperties.PropValuesOnRow.getValue(n)},columnGrandTotal:p,rowGrandTotal:g,subtotals:{rowSubtotalsPosition:R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsPosition.getValue(n),rowSubtotalsLabel:v,columnSubtotalsLabel:b},rowSubtotals:y,columnSubtotals:l,columnFormatting:{},formatters:{},tooltipFormatters:{},sparklines:{}},m=this.getMatrixValuesColumnMetadata(e);if(m)for(var w=0,x=m;w<x.length;w++){var S=x[w],P=S&&S.objects,H=(C.columnFormatting[S.queryName]={fontColor:this.tablixProperties.PropColumnFormattingFontColor.getValue(P),backColor:this.tablixProperties.PropColumnFormattingBackColor.getValue(P),alignment:R.TablixProperties.PropColumnFormattingAlignment.getValue(P),styleHeader:R.TablixProperties.PropColumnFormattingStyleHeader.getValue(P),styleValues:R.TablixProperties.PropColumnFormattingStyleValues.getValue(P),styleTotal:R.TablixProperties.PropColumnFormattingStyleTotal.getValue(P),styleSubTotals:R.TablixProperties.PropColumnFormattingStyleSubtotals.getValue(P),dataBarsSettings:R.TablixProperties.PropColumnFormattingDataBars.getValue(P),icon:R.TablixProperties.PropValuesIcon.getValue(P)},void 0),T=void 0;S.type.numeric&&(H=R.TablixProperties.PropColumnFormattingDisplayUnits.getValue(P),T=R.TablixProperties.PropColumnFormattingPrecision.getValue(P)),C.formatters[S.queryName]=new N({column:S,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!1,displayUnit:H,precision:T,trailingZeroes:!0}),C.tooltipFormatters[S.queryName]=new N({column:S,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!0,displayUnit:H,precision:T,trailingZeroes:!0}),null!=(H=S.type.misc)&&H.sparkline&&(T=R.TablixProperties.PropSparklinesChartType.getValue(P),H=new V(S.displayName,S.type,t),C.formatters[S.queryName]=H,C.tooltipFormatters[S.queryName]=H,C.sparklines[S.queryName]={chartType:T,dataColor:this.tablixProperties.PropSparklinesDataColor.getValue(P),strokeWidth:R.TablixProperties.PropSparklinesStrokeWidth.getValue(P),markers:R.TablixProperties.PropSparklinesMarkerType.getValue(P),markerColor:this.tablixProperties.PropSparklinesMarkerColor.getValue(P),markerSize:R.TablixProperties.PropSparklinesMarkerSize.getValue(P),markerShape:R.TablixProperties.PropSparklinesMarkerShape.getValue(P)})}f=R.TablixProperties.PropSubTotalsPivotTableRowSubtotalsPerLevel.getValue(n),s=R.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsPerLevel.getValue(n);return this.addMatrixHierarchySubtotalLabels(e&&e.matrix&&e.matrix.rows,C.columnFormatting,v,f),this.addMatrixHierarchySubtotalLabels(e&&e.matrix&&e.matrix.columns,C.columnFormatting,b,s),this.addMatrixHierarchyColumnsFormatters(e.matrix.rows,C.formatters,C.tooltipFormatters),this.addMatrixHierarchyColumnsFormatters(e.matrix.columns,C.formatters,C.tooltipFormatters),C},B.prototype.getTableExObjects=function(e,t,i,o){var r=B.getMetadataObjects(e),i=this.getTablixTextClassProperties(i),n=i.labelFontProperties.size&&i.labelFontProperties.size.pt,a=i.boldLabelFontProperties.size&&i.boldLabelFontProperties.size.pt,l=R.TablixProperties.PropGridPivotTableTextSize.getValue(r),l=null!=l?M.createFromPt(+l):void 0,s=R.TablixProperties.PropColumnsFontSize.getValue(r,void 0,i.fontSizeOverrideFn,n),s=null!=s?M.createFromPt(+s):void 0,n=R.TablixProperties.PropValuesFontSize.getValue(r,void 0,i.fontSizeOverrideFn,n),n=null!=n?M.createFromPt(+n):void 0,a=R.TablixProperties.PropTotalFontSize.getValue(r,void 0,i.fontSizeOverrideFn,a),a=null!=a?M.createFromPt(+a):void 0,u=R.TablixProperties.ProprowWithReferenceText.getValue(r),h={general:{autoSizeColumnWidth:R.TablixProperties.PropColumnPivotTableAutoSizeColumns.getValue(r),textSize:l,totals:R.TablixProperties.PropTotalTableExTotals.getValue(r)}},l=(h.grid={gridVertical:R.TablixProperties.PropGridVertical.getValue(r),gridVerticalColor:this.tablixProperties.PropGridVerticalColor.getValue(r),gridVerticalWeight:R.TablixProperties.PropGridVerticalWeight.getValue(r),gridHorizontal:R.TablixProperties.PropGridHorizontalTable.getValue(r),gridHorizontalColor:this.tablixProperties.PropGridHorizontalColor.getValue(r),gridHorizontalWeight:R.TablixProperties.PropGridHorizontalWeight.getValue(r),outline:o.outlineDropdownToCheckboxes?R.TablixProperties.PropGridOutlineStyle.getValue(r)||R.DefaultGridOutlineStyle:R.TablixProperties.PropGridOutline.getValue(r)||R.DefaultGridOutline,outlineColor:this.tablixProperties.PropGridOutlineColor.getValue(r),outlineWeight:R.TablixProperties.PropGridOutlineWeight.getValue(r),rowPadding:R.TablixProperties.PropGridRowPadding.getValue(r),imageHeight:R.TablixProperties.PropGridImageHeight.getValue(r),imageWidth:R.TablixProperties.PropGridImageWidth.getValue(r)},h.columnHeaders={fontColor:this.tablixProperties.PropColumnsFontColor.getValue(r,void 0,i.fontColorOverrideFn,i.labelFontProperties.color),fontFamily:R.TablixProperties.PropColumnsFontFamily.getValue(r,void 0,i.fontFamilyOverrideFn,i.labelFontProperties.family),fontSize:s,bold:R.TablixProperties.PropColumnsBold.getValue(r),italic:R.TablixProperties.PropColumnsItalic.getValue(r),underline:R.TablixProperties.PropColumnsUnderline.getValue(r),backColor:this.tablixProperties.PropColumnsBackColor.getValue(r),outline:o.outlineDropdownToCheckboxes?this.ensureOutline(R.TablixProperties.PropColumnsOutlineStyle.getValue(r),r,R.DefaultColumnsOutlineStyle,o.outlineDropdownToCheckboxes):this.ensureOutline(R.TablixProperties.PropColumnsNewVisualOutline.getValue(r),r,R.DefaultColumnsOutline,o.outlineDropdownToCheckboxes),outlineColor:this.ensureOutlineColor(this.tablixProperties.PropColumnsOutlineColor.getValue(r),r),outlineWeight:this.ensureOutlineWeight(R.TablixProperties.PropColumnsOutlineWeight.getValue(r),r),wordWrap:R.TablixProperties.PropColumnsWordWrap.getValue(r),alignment:R.TablixProperties.PropColumnsAlignment.getValue(r)},h.values={fontFamily:R.TablixProperties.PropValuesFontFamily.getValue(r,void 0,i.fontFamilyOverrideFn,i.labelFontProperties.family),fontSize:n,bold:R.TablixProperties.PropValuesBold.getValue(r),italic:R.TablixProperties.PropValuesItalic.getValue(r),underline:R.TablixProperties.PropValuesUnderline.getValue(r),fontColorPrimary:this.tablixProperties.PropValuesFontColorPrimary.getValue(r,void 0,i.fontColorOverrideFn,i.labelFontProperties.color),backColorPrimary:this.tablixProperties.PropValuesBackColorPrimary.getValue(r),fontColorSecondary:this.tablixProperties.PropValuesFontColorSecondary.getValue(r),backColorSecondary:this.tablixProperties.PropValuesBackColorSecondary.getValue(r),outline:o.outlineDropdownToCheckboxes?this.ensureOutline(R.TablixProperties.PropValuesOutlineStyle.getValue(r),r,R.DefaultValuesOutlineStyle,o.outlineDropdownToCheckboxes):this.ensureOutline(R.TablixProperties.PropValuesNewVisualOutline.getValue(r),r,R.DefaultValuesOutline,o.outlineDropdownToCheckboxes),outlineColor:this.ensureOutlineColor(this.tablixProperties.PropValuesOutlineColor.getValue(r),r),outlineWeight:this.ensureOutlineWeight(R.TablixProperties.PropValuesOutlineWeight.getValue(r),r),urlIcon:R.TablixProperties.PropValuesUrlIcon.getValue(r),wordWrap:R.TablixProperties.PropValuesWordWrap.getValue(r)},h.total={totalLabel:R.TablixProperties.PropTotalTableExTotalLabel.getValue(r)||t(F.TotalLabel),fontFamily:R.TablixProperties.PropTotalFontFamily.getValue(r,void 0,i.fontFamilyOverrideFn,i.boldLabelFontProperties.family),fontSize:a,bold:R.TablixProperties.PropTotalBold.getValue(r),italic:R.TablixProperties.PropTotalItalic.getValue(r),underline:R.TablixProperties.PropTotalUnderline.getValue(r),fontColor:this.tablixProperties.PropTotalFontColor.getValue(r,void 0,i.fontColorOverrideFn,i.boldLabelFontProperties.color),backColor:this.tablixProperties.PropTotalBackColor.getValue(r),outline:o.outlineDropdownToCheckboxes?this.ensureOutline(R.TablixProperties.PropTotalOutlineStyle.getValue(r),r,R.DefaultTotalOutlineStyle,o.outlineDropdownToCheckboxes):this.ensureOutline(R.TablixProperties.PropTotalTableExOutline.getValue(r),r,R.DefaultTotalOutline,o.outlineDropdownToCheckboxes),outlineColor:this.ensureOutlineColor(this.tablixProperties.PropTotalOutlineColor.getValue(r),r),outlineWeight:this.ensureOutlineWeight(R.TablixProperties.PropTotalOutlineWeight.getValue(r),r)},h.columnFormatting={},h.formatters={},h.tooltipFormatters={},h.sparklines={},this.getTableColumnMetadata(e));if(l)for(var d=0,c=l;d<c.length;d++){var p=c[d],g=p&&p.objects,m=(h.columnFormatting[p.queryName]={fontColor:this.tablixProperties.PropColumnFormattingFontColor.getValue(g),backColor:this.tablixProperties.PropColumnFormattingBackColor.getValue(g),alignment:R.TablixProperties.PropColumnFormattingAlignment.getValue(g),styleHeader:R.TablixProperties.PropColumnFormattingStyleHeader.getValue(g),styleValues:R.TablixProperties.PropColumnFormattingStyleValues.getValue(g),styleTotal:R.TablixProperties.PropColumnFormattingStyleTotal.getValue(g),dataBarsSettings:R.TablixProperties.PropColumnFormattingDataBars.getValue(g),icon:R.TablixProperties.PropValuesIcon.getValue(g)},void 0),f=void 0;p.type.numeric&&(m=R.TablixProperties.PropColumnFormattingDisplayUnits.getValue(g),f=R.TablixProperties.PropColumnFormattingPrecision.getValue(g)),h.formatters[p.queryName]=new N({column:p,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!1,displayUnit:m,precision:f,trailingZeroes:!0}),h.tooltipFormatters[p.queryName]=new N({column:p,formatStringPropId:R.TablixProperties.PropColumnFormatString,nullsAreBlank:!0,displayUnit:m,precision:f,trailingZeroes:!0}),null!=(m=p.type.misc)&&m.sparkline&&(f=R.TablixProperties.PropSparklinesChartType.getValue(g),m=new V(p.displayName,p.type,t),h.formatters[p.queryName]=m,h.tooltipFormatters[p.queryName]=m,h.sparklines[p.queryName]={chartType:f,dataColor:this.tablixProperties.PropSparklinesDataColor.getValue(g),strokeWidth:R.TablixProperties.PropSparklinesStrokeWidth.getValue(g),markers:R.TablixProperties.PropSparklinesMarkerType.getValue(g),markerColor:this.tablixProperties.PropSparklinesMarkerColor.getValue(g),markerSize:R.TablixProperties.PropSparklinesMarkerSize.getValue(g),markerShape:R.TablixProperties.PropSparklinesMarkerShape.getValue(g)})}return h.rowWithReferenceText={rowWithReferenceText:u},h},B.prototype.ensureOutline=function(e,t,i,o){return o?null!=(o=null!=e?e:R.TablixProperties.PropGridOutlineStyle.getValue(t))?o:i:null!=(o=null!=e?e:R.TablixProperties.PropGridOutline.getValue(t))?o:i},B.prototype.ensureOutlineWeight=function(e,t){return null!=e?e:R.TablixProperties.PropGridOutlineWeight.getValue(t)},B.prototype.outlineOverrideFn=function(e,t){return!!h.DataViewObjects.getValue(e,t)},B.prototype.ensureOutlineColor=function(e,t){return null!=e?e:this.tablixProperties.PropGridOutlineColor.getValue(t)},B.getTextSizeInPx=function(e){return jsCommon.PixelConverter.toString(e.px)},B.prototype.shouldShowTableTotalsOption=function(e){if(e&&e.table&&!_.isEmpty(e.table.columns)){e=e.table.columns;if(_.some(e,function(e){return e.discourageAggregationAcrossGroups}))return!1}return!0},B.prototype.shouldShowRowSubtotalsOption=function(e){return!(!e||i.getRowGroupingLevelsCount(e.matrix)<1||this.isDiscourageAggregationAcrossGroups(e.matrix.rows.levels))},B.prototype.shouldShowColumnSubtotalsOption=function(e){var t;return!(!e||!e.matrix||i.getColumnGroupingLevelsCount(e.matrix.columns)<1||(t=e.matrix.columns.levels,1<e.matrix.valueSources.length&&(t=_.initial(t)),this.isDiscourageAggregationAcrossGroups(t)))},B.prototype.isDiscourageAggregationAcrossGroups=function(e){e=_.last(e);return e&&_.some(e.sources,function(e){return e.discourageAggregationAcrossGroups})},B.prototype.getTablixTextClassProperties=function(e){return{fontSizeOverrideFn:this.fontSizeOverridePredicate(),fontFamilyOverrideFn:this.fontFamilyOverridePredicate(),fontColorOverrideFn:this.fontColorOverridePredicate(),labelFontProperties:r.getFontPropertiesForTextClass(e,"label"),boldLabelFontProperties:r.getFontPropertiesForTextClass(e,"boldLabel")}},B.prototype.fontSizeOverridePredicate=function(){var u=this;return function(e,t,i){var o=h.DataViewObjects.getObject(e,t.objectName),r=h.DataViewObjects.getObject(e,R.TablixProperties.ObjectGrid),n=h.DataViewObjects.getObject(e,R.TablixProperties.ObjectValues),e=h.DataViewObjects.getObject(e,R.TablixProperties.ObjectSubTotals),a=u.gridDependentObject(t.objectName),r=h.DataViewObject.getValue(r,"textSize",void 0)&&!h.DataViewObject.getValue(o,t.propertyName,void 0,i),l=u.valuesDependentObject(t.objectName),n=h.DataViewObject.getValue(n,"fontSize",void 0)&&!h.DataViewObject.getValue(o,t.propertyName,void 0,i),s=u.subTotalsDependentObject(t.objectName),e=u.getSubTotalsValue(t.objectName,e,"fontSize",void 0)&&!h.DataViewObject.getValue(o,t.propertyName,void 0,i),t=t.objectName===R.TablixProperties.ObjectGrid?"textSize":"fontSize",o=!!h.DataViewObject.getValue(o,t,void 0,i);return a&&r||l&&n||s&&e||o}},B.prototype.fontFamilyOverridePredicate=function(){var l=this;return function(e,t,i){var o=h.DataViewObjects.getObject(e,t.objectName),r=h.DataViewObjects.getObject(e,R.TablixProperties.ObjectValues),e=h.DataViewObjects.getObject(e,R.TablixProperties.ObjectSubTotals),n=l.valuesDependentObject(t.objectName),r=h.DataViewObject.getValue(r,"fontFamily",void 0)&&!h.DataViewObject.getValue(o,t.propertyName,void 0),a=l.subTotalsDependentObject(t.objectName),e=l.getSubTotalsValue(t.objectName,e,"fontFamily",void 0)&&!h.DataViewObject.getValue(o,t.propertyName,void 0,i),t=!!h.DataViewObject.getValue(o,"fontFamily",void 0,i);return n&&r||a&&e||t}},B.prototype.fontColorOverridePredicate=function(){return function(e,t,i){var e=h.DataViewObjects.getObject(e,t.objectName),t=t.objectName===R.TablixProperties.ObjectValues?"fontColorPrimary":"fontColor",o=h.DataViewObject.getValue(e,t);return!!h.DataViewObject.getValue(e,t,o,i)}},B.prototype.gridDependentObject=function(e){return this.valuesDependentObject(e)||e===R.TablixProperties.ObjectRowHeaders||e===R.TablixProperties.ObjectColumnHeaders||e===R.TablixProperties.ObjectValues},B.prototype.valuesDependentObject=function(e){return this.subTotalsDependentObject(e)||e===R.TablixProperties.ObjectSubTotals},B.prototype.subTotalsDependentObject=function(e){return e===R.TablixProperties.ObjectTotal||e===R.TablixProperties.ObjectRowTotal||e===R.TablixProperties.ObjectColumnTotal},B.prototype.getSubTotalsValue=function(e,t,i,o){e=e===R.TablixProperties.ObjectRowTotal?"Row":e===R.TablixProperties.ObjectColumnTotal?"Column":void 0;return o=null!=o?o:h.DataViewObject.getValue(t,i),h.DataViewObject.getValue(t,i,o,e)},B.ImageSizeMin=8,B.ImageSizeMax=512,R.TablixPropertyManager=B,e.prototype.format=function(e,t){e=R.formatSparklines(this.displayName,this.sparklineType,e);if(e)return this.localizer.apply(this,__spreadArray([e.key],e.parameters,!1))};var V=e;function e(e,t,i){this.displayName=e,this.sparklineType=t,this.localizer=i}}(powerbi=powerbi||{}),function(a){var i,e;function l(e,t,i,o){this.columnWidthObjects={},this.isMatrix=t,this.updateDataView(e,o),this.hostPersistCallBack=i,this.visualObjectInstancesToPersist={merge:[],remove:[]}}i=a.visuals||(a.visuals={}),e=i.controls||(i.controls={}),l.prototype.updateDataView=function(e,t){this.previousDataView=this.currentDataView,this.previousDataView?this.previousAutoColumnSizePropertyValue=i.TablixProperties.PropGeneralAutoSizeColumns.getValue(i.TablixPropertyManager.getMetadataObjects(this.previousDataView)):this.previousAutoColumnSizePropertyValue=void 0,this.currentDataView=e,this.currentDataView?this.currentAutoColumnSizePropertyValue=i.TablixProperties.PropGeneralAutoSizeColumns.getValue(i.TablixPropertyManager.getMetadataObjects(this.currentDataView)):this.currentAutoColumnSizePropertyValue=void 0,this.matrixLeafNodes=t,this.updateColumnsMetadata(),this.updateTablixColumnWidths()},l.prototype.updateColumnsMetadata=function(){this.columnWidthObjects={},this.isMatrix?this.updateMatrixColumnsMetadata():this.updateTableColumnsMetadata()},l.prototype.updateTableColumnsMetadata=function(){if(this.currentDataView&&this.currentDataView.table)for(var e=this.currentDataView.table.columns,t=0,i=e.length;t<i;t++){var o=e[t].queryName;o&&(this.columnWidthObjects[o]={queryName:o,width:void 0,isFixed:!1})}},l.prototype.updateMatrixColumnsMetadata=function(){if(this.currentDataView&&this.currentDataView.matrix&&this.currentDataView.matrix.rows)for(var e=0,t=this.currentDataView.matrix.rows.levels.length;e<t;e++){var i=this.currentDataView.matrix.rows.levels[e];1===i.sources.length&&(o=i.sources[0].queryName)&&(this.columnWidthObjects[o]={queryName:o,width:void 0,isFixed:!1})}if(this.matrixLeafNodes)for(var o,e=0,t=this.matrixLeafNodes.length;e<t;e++)(o=this.matrixLeafNodes[e].queryName)&&(this.columnWidthObjects[o]={queryName:o,width:void 0,isFixed:!1})},l.prototype.updateTablixColumnWidths=function(){var e=this.currentDataView&&this.currentDataView.metadata&&this.currentDataView.metadata.columns;e&&(this.shouldClearAllColumnWidths()?this.autoSizeAllColumns():this.deserializeColumnsWidth(e))},l.prototype.autoSizeAllColumns=function(){for(var e in this.columnWidthObjects)this.visualObjectInstancesToPersist.remove.push(this.generateColumnWidthObjectToPersist(e,void 0));this.callHostToPersist()},l.prototype.deserializeColumnsWidth=function(e){for(var t in this.columnWidthObjects)this.columnWidthObjects[t].isFixed=!this.currentAutoColumnSizePropertyValue,this.columnWidthObjects[t].width=void 0;for(var i=0,o=e.length;i<o;i++){var r=e[i],n=r.queryName,r=a.DataViewObjects.getValue(r.objects,l.columnWidthProp);this.columnWidthObjects.hasOwnProperty(n)&&null!=r&&(this.columnWidthObjects[n].width=r,this.columnWidthObjects[n].isFixed=!0)}},l.prototype.shouldClearAllColumnWidths=function(){return null!=this.previousDataView&&!1===this.previousAutoColumnSizePropertyValue&&null!=this.currentDataView&&!0===this.currentAutoColumnSizePropertyValue},l.getColumnQueryName=function(e){var t=e.getTablixCell();switch(t.type){case 0:return null==t.item||null==t.item.metadata?void 0:t.item.metadata.queryName;case 2:return t.item,t.item.queryName;default:return void t.type}},l.prototype.getColumnWidthObjects=function(){return this.columnWidthObjects},l.prototype.getFixedColumnWidthObjects=function(){var e,t={};for(e in this.columnWidthObjects){var i=this.columnWidthObjects[e];i.isFixed&&(t[e]=i)}return t},l.prototype.getPersistedColumnWidth=function(e){e=this.columnWidthObjects[e];return e&&e.width},l.prototype.callHostToPersist=function(){this.hostPersistCallBack&&this.hostPersistCallBack(this.visualObjectInstancesToPersist),this.visualObjectInstancesToPersist={merge:[],remove:[]}},l.prototype.onColumnWidthChanged=function(e,t){var i;null!=e&&null!=this.columnWidthObjects[e]&&(i=this.columnWidthObjects[e],-1===t?(i.width=void 0,i.isFixed=!this.currentAutoColumnSizePropertyValue,this.visualObjectInstancesToPersist.remove.push(this.generateColumnWidthObjectToPersist(i.queryName,void 0))):(i.width=t,i.isFixed=!0,this.visualObjectInstancesToPersist.merge.push(this.generateColumnWidthObjectToPersist(e,t))),this.callHostToPersist())},l.prototype.onColumnsRendered=function(e){for(var t={},i=0,o=e.length;i<o;i++){var r=e[i].queryName,n=e[i].width;null==t[r]?t[r]={queryName:r,width:n,isFixed:!1}:n>t[r].width&&(t[r].width=n)}var a,l=!1;for(r in this.columnWidthObjects)t[r]&&(a=this.columnWidthObjects[r]).isFixed&&null==a.width&&(a.width=t[r].width,this.visualObjectInstancesToPersist.merge.push(this.generateColumnWidthObjectToPersist(r,a.width)),l=!0);return l&&this.callHostToPersist(),l},l.prototype.generateColumnWidthObjectToPersist=function(e,t){return{selector:{metadata:e},objectName:"general",properties:{columnWidth:t}}},l.columnWidthProp={objectName:"general",propertyName:"columnWidth"},e.TablixColumnWidthManager=l}(powerbi=powerbi||{}),function(r){var l,s;function n(e){this.isTouchDisabled=e&&e.isTouchDisabled}l=r.visuals||(r.visuals={}),s=r.visuals.controls.internal.TablixUtils,n.prototype.init=function(e){this.element=e.element,this.style=e.style,this.updateViewport(e.viewport),this.isInteractive=e.interactivity&&null!=e.interactivity.selection,this.hostServices=e.host,this.persistingObjects=!1,this.waitingForData=!1,this.lastAllowHeaderResize=!0,this.waitingForSort=!1,this.tablixPropertyManager=new l.TablixPropertyManager(this.style)},n.getFormattingProperties=function(e,t){return t.getMatrixObjects(e)},n.prototype.onResizing=function(e){this.updateViewport(e)},n.prototype.getColumnWidthManager=function(){return this.columnWidthManager},n.prototype.onDataChanged=function(e){var t,i,o=e.dataViews;o&&0<o.length&&(t=this.dataView,this.dataView=o[0],o=n.getFormattingProperties(this.dataView,this.tablixPropertyManager),this.formatters=o.formatters,i=o.general.textSize,e.operationKind===r.VisualDataChangeOperationKind.Append?(e=t.matrix.rows.root!==this.dataView.matrix.rows.root,this.createOrUpdateHierarchyNavigator(e),this.tablixControl.updateModels(!1,this.hierarchyNavigator.getRowHierarchy().root.children,this.hierarchyNavigator.getColumnHierarchy().root.children),this.refreshControl(!1)):(this.createOrUpdateHierarchyNavigator(!0),this.createColumnWidthManager(),this.createTablixControl(o),this.tablixControl.getBinder().onDataViewChanged(o),this.updateInternal(i,t))),this.waitingForData=!1,this.waitingForSort=!1},n.prototype.createColumnWidthManager=function(){var t=this,e=this.hierarchyNavigator.getColumnHierarchy();this.columnWidthManager?this.persistingObjects||this.columnWidthManager.updateDataView(this.dataView,e.leafNodes):this.columnWidthManager=new l.controls.TablixColumnWidthManager(this.dataView,!0,function(e){return t.persistColumnWidths(e)},e.leafNodes)},n.prototype.persistColumnWidths=function(e){this.persistingObjects=!0,this.hostServices.persistProperties(e)},n.prototype.updateViewport=function(e){this.currentViewport=e,this.tablixControl&&(this.tablixControl.viewport=this.currentViewport,this.verifyHeaderResize(),this.refreshControl(!1))},n.prototype.refreshControl=function(e){!this.element.is(":visible")&&1!==this.getLayoutKind()||this.tablixControl.refresh(e)},n.prototype.getLayoutKind=function(){return this.isInteractive?0:1},n.prototype.createOrUpdateHierarchyNavigator=function(e){var t=!this.dataView.metadata.segment;this.tablixControl?this.hierarchyNavigator.update(this.dataView.matrix,!1,!1,!1,t,e,this.formatters):(e=l.createMatrixHierarchyNavigator(this.dataView.matrix,t,this.formatters,this.hostServices.getLocalizedString("ListJoin_Separator"),this.tablixPropertyManager.tablixProperties,this.hostServices),this.hierarchyNavigator=e)},n.prototype.createTablixControl=function(e){var t=e.general.textSize;this.tablixControl||(this.tablixControl=this.createControl(this.hierarchyNavigator,t)),this.tablixControl.wordWrapRowHeaders=e.rowHeaders.wordWrap},n.prototype.createControl=function(e,t){var i=this,o=this.getLayoutKind(),r={onBindRowHeader:function(e){i.onBindRowHeader(e)},totalLabel:this.hostServices.getLocalizedString(s.TotalLabel),onColumnHeaderClick:function(e,t){return i.onColumnHeaderClick(e,t)},showSortIcons:0===o,tablixProperties:this.tablixPropertyManager.tablixProperties},r=new l.MatrixBinder(this.hierarchyNavigator,r),n=1===o?l.controls.internal.DashboardTablixLayoutManager.createLayoutManager(r):l.controls.internal.CanvasTablixLayoutManager.createLayoutManager(r,this.columnWidthManager),a=document.createElement("div"),o=(this.element.append(a),{interactive:this.isInteractive,enableTouchSupport:!this.isTouchDisabled,layoutKind:o,fontSize:l.TablixPropertyManager.getTextSizeInPx(t)});return new l.controls.TablixControl(e,n,r,a,o)},n.prototype.updateInternal=function(e,t){var i=this,o=(1===this.getLayoutKind()&&this.tablixControl.layoutManager.adjustContentSize(l.converterHelper.hasImageUrlColumn(this.dataView)),this.tablixControl.fontSize=l.TablixPropertyManager.getTextSizeInPx(e),this.verifyHeaderResize(),this.tablixControl.updateModels(!this.persistingObjects,this.hierarchyNavigator.getRowHierarchy().root.children,this.hierarchyNavigator.getColumnHierarchy().root.children),this.tablixControl.viewport=this.currentViewport,this.shouldClearControl(t,this.dataView));setTimeout(function(){i.refreshControl(o);var e=i.columnWidthManager.onColumnsRendered(i.tablixControl.layoutManager.columnWidthsToPersist);i.persistingObjects&&!e&&(i.persistingObjects=!1)},0)},n.prototype.shouldClearControl=function(e,t){return!(this.waitingForSort&&e&&t&&r.DataViewUtils.isMetadataEquivalent(e.metadata,t.metadata))},n.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},n.prototype.onColumnHeaderClick=function(e,t){this.waitingForSort=!0,this.hostServices.onCustomSort(s.getCustomSortEventArgs(e,t))},n.prototype.needsMoreData=function(e){var t;return!(this.waitingForData||!this.hierarchyNavigator.isLeaf(e)||!this.dataView.metadata||!this.dataView.metadata.segment)&&(t=this.tablixControl.rowDimension.getItemsCount()*s.PreferredLoadMoreThreshold,this.hierarchyNavigator.getLeafIndex(e)>=t)},n.prototype.enumerateObjectInstances=function(e){var t=new l.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,t,this.dataView,l.controls.TablixType.Matrix),t.complete()},n.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,l.controls.TablixType.Matrix),e},n.prototype.shouldAllowHeaderResize=function(){return 1===this.hostServices.getViewMode()},n.prototype.onViewModeChanged=function(e){this.tablixControl&&this.tablixControl.toggleTouchBindings(1!==e),this.updateViewport(this.currentViewport)},n.prototype.verifyHeaderResize=function(){var e=this.shouldAllowHeaderResize();e!==this.lastAllowHeaderResize&&(this.lastAllowHeaderResize=e,this.tablixControl.layoutManager.setAllowHeaderResize(e))},l.Matrix=n}(powerbi=powerbi||{}),function(s){var y,u,e,h,b,v,d,l,c;function C(e,t,i){t=t.rowSubtotals&&i?e.row.indexInSiblings:e.row.index;return t<0||t%2==0}function w(e,t){return e?t.fontColorPrimary:t.fontColorSecondary}function x(e,t){return e?t.backColorPrimary:t.backColorSecondary}function t(e,t){this.hierarchyNavigator=e,this.options=t}y=s.visuals||(s.visuals={}),h=s.visuals.controls.internal.TablixUtils.CellStyle,b=s.visuals.controls.internal.TablixUtils.EdgeSettings,v=s.visuals.controls.internal.TablixUtils.EdgeType,d=s.visuals.controls.internal.TablixUtils,l=jsCommon.UrlUtils.UrlScheme,c=jsCommon.UrlUtils,(e=u=y.MatrixStyler||(y.MatrixStyler={})).setRowHeaderStyle=function(e,t,i,o,r,n){void 0===n&&(n=!1);var a=r.grid,l=r.rowHeaders,s=r.values,u=r.columnHeaders,h=null!=(h=r.grandTotal)?h:r.rowGrandTotal,d=r.subtotals||{},c=r.rowSubtotals||{},p=null!=(p=l.outlineWeight)?p:a.outlineWeight,g=null!=(g=l.outlineColor)?g:a.outlineColor,m=(i.paddings.top=i.paddings.bottom=a.rowPadding,y.MatrixHierarchyNavigator.isNodeGrandTotal(t));i.borders.top=new b,(e.row.isFirst&&!o||o&&0===t.leafIndex)&&(i.borders.top.applyParams(y.outline.showTop(l.outline),p,g,v.Outline),!y.outline.showTop(l.outline))&&y.outline.showTop(s.outline)&&(i.paddings.top+=p),i.borders.bottom=new b,e.row.isLast&&(!o||e.column.isLast&&!r.general.rowSubtotals)||o&&e.row.isFirst&&t.isSubtotal?(i.borders.bottom.applyParams(y.outline.showBottom(l.outline),p,g,v.Outline),!y.outline.showBottom(l.outline)&&y.outline.showBottom(s.outline)&&(i.paddings.bottom+=p)):i.borders.bottom.applyParams(a.gridHorizontal,a.gridHorizontalWeight,a.gridHorizontalColor,v.Gridline),i.borders.left=new b,(o||e.column.isFirst)&&(i.borders.left.applyParams(y.outline.showLeft(l.outline),p,g,v.Outline),!y.outline.showLeft(l.outline))&&y.outline.showLeft(u.outline)&&(i.paddings.left+=p),i.borders.right=new b,(u=o||e.column.isLast)?i.borders.right.applyParams(y.outline.showRight(l.outline),p,g,v.Outline):i.borders.right.applyParams(a.gridVertical,a.gridVerticalWeight,a.gridVerticalColor,v.Gridline),h.applyToHeaders&&m?(i.fontColor=h.fontColor||l.fontColor,i.backColor=h.backColor||l.backColor):(o=s.fontColorPrimary!==s.fontColorSecondary||s.backColorPrimary!==s.backColorSecondary,p=null!=(e=c.fontColor)?e:d.fontColor,g=t.hasSubtotalStyle&&p,a=m&&h.fontColor,p=null!=(e=c.backColor)?e:d.backColor,c=t.hasSubtotalStyle&&p,e=m&&h.backColor,m=(d=n&&o&&u)&&!c&&!e,h=void 0,((n=d&&!g&&!a)||m)&&(h=C(t.position,r.general,p)),i.fontColor=n?w(h,s):l.fontColor,i.backColor=m?x(h,s):l.backColor)},e.setColumnHeaderStyle=function(e,t,i,o){var r=o.grid,n=o.columnHeaders,a=o.values,l=null!=(l=o.grandTotal)?l:o.columnGrandTotal,s=null!=(s=n.outlineWeight)?s:r.outlineWeight,u=null!=(u=n.outlineColor)?u:r.outlineColor,o=o.columnFormatting[t.queryName],t=y.MatrixHierarchyNavigator.isNodeGrandTotal(t);o&&o.styleHeader&&o.fontColor?i.fontColor=o.fontColor:l.applyToHeaders&&t?i.fontColor=l.fontColor||n.fontColor:i.fontColor=n.fontColor,o&&o.styleHeader&&o.backColor?i.backColor=o.backColor:l.applyToHeaders&&t?i.backColor=l.backColor||n.backColor:i.backColor=n.backColor,i.paddings.top=i.paddings.bottom=r.rowPadding,i.borders.top=new b,e.row.isFirst&&i.borders.top.applyParams(y.outline.showTop(n.outline),s,u,v.Outline),i.borders.bottom=new b,e.row.isLast?i.borders.bottom.applyParams(y.outline.showBottom(n.outline),s,u,v.Outline):i.borders.bottom.applyParams(r.gridHorizontal,r.gridHorizontalWeight,r.gridHorizontalColor,v.Gridline),i.borders.left=new b,e.column.isFirst&&!y.outline.showLeft(n.outline)&&y.outline.showLeft(a.outline)&&(i.paddings.left+=s),i.borders.right=new b,e.column.isLast?(i.borders.right.applyParams(y.outline.showRight(n.outline),s,u,v.Outline),!y.outline.showRight(n.outline)&&y.outline.showRight(a.outline)&&(i.paddings.right+=s)):i.borders.right.applyParams(r.gridVertical,r.gridVerticalWeight,r.gridVerticalColor,v.Gridline)},e.setBodyCellStyle=function(e,t,i,o,r){var n,a,l,s=r.grid,u=r.values,h=r.rowHeaders,d=r.columnHeaders,c=r.rowSubtotals||{},p=r.columnSubtotals||{},g=r.subtotals||{},m=null!=(m=u.outlineWeight)?m:s.outlineWeight,f=null!=(f=u.outlineColor)?f:s.outlineColor;i.paddings.top=i.paddings.bottom=s.rowPadding,i.borders.top=new b,e.row.isFirst&&(i.borders.top.applyParams(y.outline.showTop(u.outline),m,f,v.Outline),!y.outline.showTop(u.outline))&&y.outline.showTop(h.outline)&&(i.paddings.top+=m),i.borders.bottom=new b,e.row.isLast&&(!o||!r.general.rowSubtotals)||o&&t.isRowGrandTotal?(i.borders.bottom.applyParams(y.outline.showBottom(u.outline),m,f,v.Outline),!y.outline.showBottom(u.outline)&&y.outline.showBottom(h.outline)&&(i.paddings.bottom+=m)):i.borders.bottom.applyParams(s.gridHorizontal,s.gridHorizontalWeight,s.gridHorizontalColor),i.borders.left=new b,e.column.isFirst&&i.borders.left.applyParams(y.outline.showLeft(u.outline),m,f,v.Outline),i.borders.right=new b,e.column.isLast?(i.borders.right.applyParams(y.outline.showRight(u.outline),m,f,v.Outline),!y.outline.showRight(u.outline)&&y.outline.showRight(d.outline)&&(i.paddings.right+=m)):i.borders.right.applyParams(s.gridVertical,s.gridVerticalWeight,s.gridVerticalColor,v.Gridline),(o=t.columnMetadata&&r.columnFormatting[t.columnMetadata.queryName])&&(n=t.isGrandTotal?(a=o.styleTotal&&o.fontColor,o.styleTotal&&o.backColor):t.hasSubtotalStyle?(a=o.styleSubTotals&&o.fontColor,o.styleSubTotals&&o.backColor):(a=o.styleValues&&o.fontColor,o.styleValues&&o.backColor)),m=t.hasColumnSubtotalStyle?(l=null!=(h=p.fontColor)?h:g.fontColor,null!=(e=p.backColor)?e:g.backColor):t.hasRowSubtotalStyle?(l=null!=(f=c.fontColor)?f:g.fontColor,null!=(d=c.backColor)?d:g.backColor):(l=g.fontColor,g.backColor);o=w(s=C(t.position,r.general,null!=m?m:c.backColor),u),h=x(s,u);t.isGrandTotal?(e=null!=(p=r.grandTotal)?p:t.isColumnGrandTotal?r.columnGrandTotal:r.rowGrandTotal,i.fontColor=t.fontColor||a||e.fontColor||l||o,i.backColor=t.backColor||n||e.backColor||m||h):t.hasSubtotalStyle?(i.fontColor=t.fontColor||a||l||o,i.backColor=t.backColor||n||m||h):(i.fontColor=t.fontColor||a||o,i.backColor=t.backColor||n||h)},e.setCornerCellStyle=function(e,t,i,o){var r=o.grid,n=o.columnHeaders,o=o.rowHeaders,a=null!=(a=n.outlineWeight)?a:r.outlineWeight,l=null!=(l=n.outlineColor)?l:r.outlineColor;t.fontColor=n.fontColor||o.fontColor,t.backColor=n.backColor||o.backColor,t.paddings.top=t.paddings.bottom=r.rowPadding,t.borders.top=new b,e.row.isFirst&&t.borders.top.applyParams(y.outline.showTop(n.outline),a,l,v.Outline),t.borders.bottom=new b,e.row.isLast?t.borders.bottom.applyParams(y.outline.showBottom(n.outline),a,l,v.Outline):t.borders.bottom.applyParams(r.gridHorizontal,r.gridHorizontalWeight,r.gridHorizontalColor,v.Gridline),t.borders.left=new b,(e.column.isFirst||i)&&(t.borders.left.applyParams(y.outline.showLeft(n.outline),a,l,v.Outline),!y.outline.showLeft(n.outline))&&y.outline.showLeft(o.outline)&&(t.paddings.left+=a),t.borders.right=new b,t.borders.right.applyParams(r.gridVertical,r.gridVerticalWeight,r.gridVerticalColor,v.Gridline)},t.prototype.onDataViewChanged=function(e){this.formattingProperties=e,this.updateTextHeights()},t.prototype.updateTextHeights=function(){this.fontSizeHeader=this.formattingProperties.general.textSize.px,this.textPropsHeader={fontFamily:d.FontFamilyHeader,fontSize:jsCommon.PixelConverter.toString(this.fontSizeHeader)},this.textHeightHeader=Math.ceil(s.TextMeasurementService.measureSvgTextHeight(this.textPropsHeader,"a")),this.fontSizeValue=this.formattingProperties.general.textSize.px,this.textPropsValue={fontFamily:d.FontFamilyCell,fontSize:jsCommon.PixelConverter.toString(this.fontSizeValue)},this.textHeightValue=Math.ceil(s.TextMeasurementService.measureSvgTextHeight(this.textPropsValue,"a")),this.fontSizeTotal=this.formattingProperties.general.textSize.px,this.textPropsTotal={fontFamily:d.FontFamilyTotal,fontSize:jsCommon.PixelConverter.toString(this.fontSizeTotal)},this.textHeightTotal=Math.ceil(s.TextMeasurementService.measureSvgTextHeight(this.textPropsTotal,"a"))},t.prototype.onStartRenderingSession=function(){},t.prototype.onEndRenderingSession=function(){},t.prototype.bindRowHeader=function(e,t){d.resetCellCssClass(t);var i=this.options.tablixProperties,o=new h;this.hierarchyNavigator&&this.hierarchyNavigator.isLeaf(e)&&(d.addCellCssClass(t,d.CssClassMatrixRowHeaderLeaf),o.borders.right=new b(y.TablixProperties.PropGridOutlineWeight.defaultValue,i.PropGridOutlineColor.getValue(null))),e.isSubtotal&&(o.paddings.left=d.CellPaddingLeftMatrixTotal),t.contentWidth=0,this.bindHeader(e,t,t.extension.contentHost,this.hierarchyNavigator.getRowHeaderMetadataColumn(e),o),t.contentWidth=Math.ceil(t.contentWidth),this.options.onBindRowHeader&&this.options.onBindRowHeader(e),u.setRowHeaderStyle(t.position,e,o,!1,this.formattingProperties),t.applyStyle(o)},t.prototype.unbindRowHeader=function(e,t){d.clearCellStyle(t),d.clearCellTextAndTooltip(t)},t.prototype.bindColumnHeader=function(e,t){d.resetCellCssClass(t);var i=new h,o=this.options.tablixProperties,r=!1,n=t.extension.contentHost;(n=d.appendDiv(n)).classList.add(d.CssClassWrappingContainer),t.contentWidth=0,this.hierarchyNavigator&&this.hierarchyNavigator.isLeaf(e)&&(i.borders.bottom=new b(y.TablixProperties.PropGridOutlineWeight.defaultValue,o.PropGridOutlineColor.getValue(null)),d.addCellCssClass(t,d.CssClassTablixColumnHeaderLeaf),d.addCellCssClass(t,d.CssClassTablixValueNumeric),this.options.showSortIcons&&(o=this.getSortableHeaderColumnMetadata(e))&&(this.registerColumnHeaderClickHandler(o,t),n=d.addSortIconToColumnHeader(o.sort,n),o.sort)&&(t.contentWidth=this.fontSizeHeader+d.SortIconPadding),e.isSubtotal)&&e.parent&&1<e.parent.children.length&&e.parent.children[0].isSubtotal&&(r=!0),t.extension.disableDragResize(),this.bindHeader(e,t,n,this.hierarchyNavigator.getColumnHeaderMetadataColumn(e),i,r),t.contentWidth=Math.ceil(t.contentWidth),u.setColumnHeaderStyle(t.position,e,i,this.formattingProperties),t.applyStyle(i)},t.prototype.unbindColumnHeader=function(e,t){d.clearCellStyle(t),d.clearCellTextAndTooltip(t),this.getSortableHeaderColumnMetadata(e)&&this.unregisterColumnHeaderClickHandler(t),this.options.showSortIcons&&d.removeSortIcons(t)},t.prototype.bindHeader=function(e,t,i,o,r,n){d.addCellCssClass(t,d.CssClassTablixHeader),r.fontFamily=d.FontFamilyHeader,r.fontColor=d.FontColorHeaders;var a=this.formattingProperties.grid.imageHeight;y.converterHelper.isImageUrlColumn(o)?t.contentHeight=a:e.hasSubtotalStyle?t.contentHeight=this.textHeightTotal:t.contentHeight=this.textHeightValue,e.hasSubtotalStyle&&(d.addCellCssClass(t,d.CssClassTablixValueTotal),r.fontFamily=d.FontFamilyTotal),e.isSubtotal&&!n?(d.setCellTextAndTooltip(this.options.totalLabel,i,t.extension.contentHost),t.contentWidth=s.TextMeasurementService.measureSvgTextWidth(this.textPropsTotal,this.options.totalLabel)):(r=this.getHeaderLabel(e))?d.getUrlScheme(o,r)!==l.NONE?(d.appendATagToBodyCell(r,i),t.contentWidth+=s.TextMeasurementService.measureSvgTextWidth(this.textPropsHeader,r)):y.converterHelper.isImageUrlColumn(o)&&c.isValidImageUrl(r)?(d.appendImgTagToBodyCell(e.valueFormatted,i,a),t.contentWidth+=a*d.ImageDefaultAspectRatio):(d.setCellTextAndTooltip(r,i,t.extension.contentHost),t.contentWidth+=s.TextMeasurementService.measureSvgTextWidth(e.hasSubtotalStyle?this.textPropsTotal:this.textPropsHeader,r)):i.innerHTML=d.StringNonBreakingSpace},t.prototype.applyWordWrapping=function(e,t){if(null!=t.containerWidth&&t.containerWidth,null!=t.containerHeight&&t.containerHeight,1===t.type){var i=this.hierarchyNavigator.getRowHeaderMetadataColumn(e);if(!y.converterHelper.isWebUrlColumn(i)&&!y.converterHelper.isImageUrlColumn(i))for(var o=t.extension.contentHost,i=(y.controls.HTMLElementUtils.clearChildren(o),e.valueFormatted),r=new h,e=(u.setRowHeaderStyle(e.position,e,r,!1,this.formattingProperties),t.containerWidth-(r.getExtraRight()+r.getExtraLeft())),t=t.containerHeight-(r.getExtraTop()+r.getExtraBottom()),r=Math.floor(t/this.textHeightHeader),n=0,a=jsCommon.WordBreaker.splitByWidth(i,this.textPropsHeader,s.TextMeasurementService.measureSvgTextWidth,e,r,null,!0);n<a.length;n++){var l=a[n];d.appendDiv(o,l)}}},t.prototype.registerColumnHeaderClickHandler=function(t,e){var i=this;this.options.onColumnHeaderClick&&e.extension.registerClickHandler(function(e){d.isValidSortClick(e)&&(e=d.reverseSort(t.sort),i.options.onColumnHeaderClick(t.queryName||t.displayName,e))})},t.prototype.unregisterColumnHeaderClickHandler=function(e){this.options.onColumnHeaderClick&&e.extension.unregisterClickHandler()},t.prototype.bindBodyCell=function(e,t){d.resetCellCssClass(t);var i,o=new d.CellStyle,r=(t.contentHeight=this.textHeightValue,e.kpiContent);r?($(t.extension.contentHost).append(r),t.contentWidth=this.fontSizeValue):(r=this.textPropsValue,d.addCellCssClass(t,d.CssClassTablixValueNumeric),e.isTotal&&(d.addCellCssClass(t,d.CssClassTablixValueTotal),o.fontFamily=d.FontFamilyTotal,t.contentHeight=this.textHeightTotal,r=this.textPropsTotal),(i=e.textContent)&&(d.setCellTextAndTooltip(i,t.extension.contentHost),t.contentWidth=s.TextMeasurementService.measureSvgTextWidth(r,i))),t.contentWidth=Math.ceil(t.contentWidth),u.setBodyCellStyle(t.position,e,o,!1,this.formattingProperties),t.applyStyle(o)},t.prototype.unbindBodyCell=function(e,t){d.clearCellStyle(t),d.clearCellTextAndTooltip(t)},t.prototype.bindCornerCell=function(e,t){d.resetCellCssClass(t);var i=this.options.tablixProperties,o=new h,r=(o.fontFamily=d.FontFamilyHeader,o.fontColor=d.FontColorHeaders,t.contentHeight=this.textHeightHeader,t.contentWidth=0,t.extension.contentHost);(r=d.appendDiv(r)).classList.add(d.CssClassWrappingContainer),e.isColumnHeaderLeaf&&(d.addCellCssClass(t,d.CssClassTablixColumnHeaderLeaf),o.borders.bottom=new b(y.TablixProperties.PropGridOutlineWeight.defaultValue,i.PropGridOutlineColor.getValue(null)),this.options.showSortIcons)&&(i=this.getSortableCornerColumnMetadata(e))&&(this.registerColumnHeaderClickHandler(i,t),r=d.addSortIconToColumnHeader(i?i.sort:void 0,r),i.sort)&&(t.contentWidth=this.fontSizeHeader+d.SortIconPadding),d.setCellTextAndTooltip(e.displayName,r,t.extension.contentHost),t.contentWidth+=s.TextMeasurementService.measureSvgTextWidth(this.textPropsHeader,e.displayName),t.contentWidth=Math.ceil(t.contentWidth),e.isRowHeaderLeaf&&d.addCellCssClass(t,d.CssClassMatrixRowHeaderLeaf),d.addCellCssClass(t,d.CssClassTablixHeader),u.setCornerCellStyle(t.position,o,!1,this.formattingProperties),t.applyStyle(o),t.extension.disableDragResize()},t.prototype.unbindCornerCell=function(e,t){d.clearCellStyle(t),d.clearCellTextAndTooltip(t),this.options.showSortIcons&&d.removeSortIcons(t),e.isColumnHeaderLeaf&&this.unregisterColumnHeaderClickHandler(t)},t.prototype.bindEmptySpaceHeaderCell=function(e){},t.prototype.unbindEmptySpaceHeaderCell=function(e){},t.prototype.bindEmptySpaceFooterCell=function(e){},t.prototype.unbindEmptySpaceFooterCell=function(e){},t.prototype.getHeaderLabel=function(e){return e.valueFormatted},t.prototype.getCellContent=function(e){return e.textContent||""},t.prototype.hasRowGroups=function(){var e=this.hierarchyNavigator.getRowHierarchy();return!(!e||!e.levels||0===e.levels.length)},t.prototype.getSortableCornerColumnMetadata=function(e){if(e.isColumnHeaderLeaf)return e.metadata},t.prototype.getSortableHeaderColumnMetadata=function(e){var t,i,o,r=this.hierarchyNavigator.getRowHierarchy();return r&&r.levels&&0!==r.levels.length&&(t=(r=this.hierarchyNavigator.getValueSources())&&1<r.length,i=(o=this.hierarchyNavigator.getColumnHierarchy())?o.levels.length:0,t?i--:1===i&&o.levels[0]&&o.levels[0].sources&&o.levels[0].sources[0]&&o.levels[0].sources[0].roles&&o.levels[0].sources[0].roles.Values&&(i=0),o=-1,0===i?o=e.levelSourceIndex:e.isSubtotal&&(t?e.parent&&0===e.parent.level&&(o=e.levelSourceIndex):0===e.level&&(o=e.levelSourceIndex)),-1!==o)?r[o=o||0]:null},y.MatrixBinder=t}(powerbi=powerbi||{}),function(p){var f,y=p.visuals||(p.visuals={}),r=p.visuals.controls.internal.TablixUtils.CellPosition,e=p.visuals.controls.internal.TablixUtils.TablixVisualCell,l=(__extends(t,f=e),Object.defineProperty(t.prototype,"isMeasure",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isValidUrl",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isValidImage",{get:function(){return!1},enumerable:!1,configurable:!0}),t);function t(e,t,i,o,r,n,a,l){var s,u,h,d=this;if(i)for(u=i;u.parent;)u=u.parent;if(o)for(h=o;h.parent;)h=h.parent;var c=h&&!!h.isSubtotal,p=!c&&o&&!!o.isSubtotal,g=u&&!!u.isSubtotal,m=!g&&i&&!!i.isSubtotal;return _.isString(e)&&null!=(s=null==(s=null==r?void 0:r.type)?void 0:s.misc)&&s.sparkline&&(e=y.PivotTableBinderUtils.parseSparklineData(e,n)),(d=f.call(this,e,t,m,p,g,c,r,a,l,0)||this).rowItem=i,d.columnItem=o,d.hasRowSubtotalStyle=i&&i.hasSubtotalStyle,d.hasColumnSubtotalStyle=o&&o.hasSubtotalStyle,d.hasSubtotalStyle=d.hasRowSubtotalStyle||d.hasColumnSubtotalStyle,d}y.MatrixVisualBodyItem=l,y.createMatrixHierarchyNavigator=function(e,t,i,o,r,n,a,l,s,u){return void 0===a&&(a=!0),o=new h(o,r,n,u),a&&o.update(e,!1,!1,!1,t,!0,i,l,s),o},i.prototype.getColumnHierarchyDepth=function(){return Math.max(this.columnHierarchy.levels.length,1)},i.prototype.getRowHierarchyDepth=function(){return Math.max(this.rowHierarchy.levels.length,1)},i.prototype.getLeafCount=function(e){e=this.getMatrixHierarchy(e);return e?e.leafNodes.length:0},i.prototype.getLeafAt=function(e,t){e=this.getMatrixHierarchy(e);return e?e.leafNodes[t]:null},i.prototype.getLeafIndex=function(e){return e.leafIndex},i.prototype.getParent=function(e){return 0===e.level?null:e.parent},i.prototype.getIndex=function(e){return e?e.index:-1},i.prototype.isLeaf=function(e){return!e.children||0===e.children.length},i.prototype.isRowHierarchyLeaf=function(e){return!0},i.prototype.isColumnHierarchyLeaf=function(e){return!1},i.prototype.isFirstItem=function(e,t){return e===_.head(t)},i.prototype.areAllParentsFirst=function(e,t){var i;return!!e&&((i=this.getParent(e))?this.isFirstItem(e,e.siblings)&&this.areAllParentsFirst(i,i.siblings):this.isFirstItem(e,e.siblings))},i.prototype.isLastItem=function(e,t){if(e===_.last(t)){if(!this.isItemRow(e)||this.isDataComplete)return!0;for(var i=e.parent;i;){if(i!==_.last(i.siblings))return!0;i=i.parent}}return!1},i.prototype.isItemRow=function(e){if(!e)return!1;for(var t=e;t.parent;)t=t.parent;return t.siblings===this.rowHierarchy.root.children},i.prototype.areAllParentsLast=function(e,t){var i;return!!e&&((i=this.getParent(e))?this.isLastItem(e,e.siblings)&&this.areAllParentsLast(i,i.siblings):this.isLastItem(e,e.siblings))},i.prototype.getChildren=function(e){return e.children},i.prototype.getChildrenLevelDifference=function(e){var t=1/0,i=this.getChildren(e);if(!_.isEmpty(i))for(var o=0,r=i.length;o<r;o++)t=Math.min(t,i[o].level-e.level);return t},i.prototype.getCount=function(e){return e.length},i.prototype.getAt=function(e,t){return e[t]},i.prototype.getLevel=function(e){return e.level},i.prototype.getRowLeafIndex=function(e){return this.isSteppedLayout&&e.isSubtotal?e.parent?(!this.valuesOnRow&&this.areRowSubtotalsBefore?e.parent:e).leafIndex:this.valuesOnRow?e.levelSourceIndex:-1:e.leafIndex},i.prototype.getIntersection=function(e,t){var i,o,r=t.leafIndex,n=e.values?e.values[t.leafIndex]:void 0,a=(o=n?(i=(o=this.valueSources[n.valueSourceIndex||0]).queryName,a=this.formatters[i],i=this.tooltipFormatters[i],new l(n.value,n.objects,e,t,o,this.hostServices,a,i)):new l(void 0,void 0,e,t,void 0,this.hostServices,void 0,void 0),this.getRowLeafIndex(e));return o.position.row.index=a,o.position.row.indexInSiblings=e.siblings.indexOf(e),o.position.row.isFirst=0===a,o.position.row.isLast=this.isDataComplete&&a===this.rowHierarchy.leafNodes.length-1,o.position.column.index=r,o.position.column.indexInSiblings=t.siblings.indexOf(t),o.position.column.isFirst=0===r,o.position.column.isLast=r===this.columnHierarchy.leafNodes.length-1,n&&n.objects&&(o.backColor=this.tablixProperties.PropValuesBackColor.getValue(n.objects),o.fontColor=this.tablixProperties.PropValuesFontColor.getValue(n.objects)),o},i.prototype.getCorner=function(e,t){var i,o,r,n=this.columnHierarchy.levels,a=this.rowHierarchy.levels;if((t===n.length-1||0===n.length)&&(o=a[e]))return i=e===a.length-1,r=this.valuesOnRow&&i,{metadata:1===o.sources.length||1<o.sources.length&&r?o.sources[0]:null,displayName:r?"":_.map(o.sources,function(e){return e.displayName}).join(this.compositeGroupSeparator),isColumnHeaderLeaf:!0,isRowHeaderLeaf:i,position:this.calculateCornerCellPosition(e,t),rowLevel:e,columnLevel:t};if(e===a.length-1&&(o=n[t]))return r=o.sources.filter(function(e){return!e.isMeasure}),{metadata:1===o.sources.length?o.sources[0]:null,displayName:_.map(r,function(e){return e.displayName}).join(this.compositeGroupSeparator),isColumnHeaderLeaf:!1,isRowHeaderLeaf:!0,position:this.calculateCornerCellPosition(e,t),rowLevel:e,columnLevel:t};return{metadata:null,displayName:"",isColumnHeaderLeaf:!1,isRowHeaderLeaf:!1,position:this.calculateCornerCellPosition(e,t),rowLevel:e,columnLevel:t}},i.prototype.calculateCornerCellPosition=function(e,t){var i=new r,o=t,o=(i.row.index=i.row.indexInSiblings=o,i.row.isFirst=0===o,this.getColumnHierarchyDepth()),t=(i.row.isLast=t===o-1,e),o=(i.column.index=i.column.indexInSiblings=t,i.column.isFirst=0===t,this.getRowHierarchyDepth());return i.column.isLast=t===o-1,i},i.prototype.headerItemEquals=function(e,t){return!(!e||!t)&&e===t},i.prototype.bodyCellItemEquals=function(e,t){return e.position.isMatch(t.position)},i.prototype.cornerCellItemEquals=function(e,t){return!(!e||!t)&&e.displayName===t.displayName&&e.isColumnHeaderLeaf===t.isColumnHeaderLeaf&&e.isRowHeaderLeaf===t.isRowHeaderLeaf&&e.metadata===t.metadata},i.prototype.getColumnHierarchy=function(){return this.columnHierarchy},i.prototype.getRowHierarchy=function(){return this.rowHierarchy},i.prototype.getValueSources=function(){return this.valueSources},i.prototype.valuesOnRowApplied=function(){return this.valuesOnRow},i.prototype.hasMultipleValueSources=function(){return this.multipleValueSources},i.prototype.update=function(e,t,i,o,r,n,a,l,s){var u=this;this.isSteppedLayout=t,this.valuesOnRow=i,this.areRowSubtotalsBefore=o,this.isDataComplete=r,this.valueSources=e.valueSources,this.formatters=a,this.tooltipFormatters=l||{},this.subtotalByColumn=s||{},this.multipleValueSources=1<e.valueSources.length,this.rowHierarchy=this.wrapHierarchy(e.rows,this.expandCompositeHierarchy),(n=n||this.valuesOnRow)&&(this.columnHierarchy=this.wrapHierarchy(e.columns)),this.valuesOnRow&&this.pivotValues(),this.updateHierarchy(this.rowHierarchy,this.isSteppedLayout,this.areRowSubtotalsBefore,function(e,t){return u.calculateRowHeaderPosition(e,t)}),n&&(this.updateHierarchy(this.columnHierarchy,!1,!1,function(e,t){return u.calculateColumnHeaderPosition(e,t)}),this.updateStaticColumnHeaders(this.columnHierarchy))},i.prototype.pivotValues=function(){_.isEmpty(this.columnHierarchy.root.children)||this.removeValueNodesFromColumnHierarchy(this.columnHierarchy.root.children),_.isEmpty(this.rowHierarchy.root.children)||this.addValueNodesToRowHierarchy(this.rowHierarchy.root.children,0<this.rowHierarchy.levels.length),this.moveValueLevelFromColumnToRowHierarchy()},i.prototype.removeValueNodesFromColumnHierarchy=function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];if(!o.parent&&this.isLeaf(o))return e.length=0,void e.push({level:0});this.isLeaf(o.children[0])?o.children=void 0:this.removeValueNodesFromColumnHierarchy(o.children)}},i.prototype.addValueNodesToRowHierarchy=function(e,t){for(var i=this.getRowHierarchyDepth(),o=this.valueSources.length,r=e.length,n=0;n<r;n++){var a=e[n];if(this.isLeaf(a)){var l=void 0,s=void 0,u=void 0;this.isSteppedLayout&&a.isSubtotal||!t?(e.splice(n,1),l=e,s=n,u=a.level,r=r-1+o,n=n-1+o):(a.children=[],l=a.children,s=0,u=i);for(var h=0;h<o;h++){var d=this.createRowValueNode(h,o,a,u);l.splice(s++,0,d)}a.values=null}else this.addValueNodesToRowHierarchy(a.children,t)}},i.prototype.moveValueLevelFromColumnToRowHierarchy=function(){this.rowHierarchy.levels.push(this.columnHierarchy.levels.pop())},i.prototype.createRowValueNode=function(e,t,i,o){var r,n={level:o,levelSourceIndex:e,isSubtotal:i.isSubtotal,hasSubtotalStyle:!!i.hasSubtotalStyle,values:{}},a=0,l=0;for(r in i.values)a%t===e&&(n.values[l++]=i.values[a]),a++;return n},i.prototype.wrapHierarchy=function(e,t){e={levels:this.wrapLevels(e.levels,t),root:{children:this.wrapNodes(e.root.children,e,t)},leafNodes:[]};return e},i.prototype.wrapLevels=function(e,t){if(e){for(var i=[],o=0,r=e;o<r.length;o++){var n=r[o],a=p.Prototype.inherit(n);if(i.push(a),1<n.sources.length&&t){for(var l=1;l<n.sources.length;l++){var s=n.sources[l];i.push({sources:[s]})}a.sources.splice(1,a.sources.length-1)}}return i}},i.prototype.wrapNodes=function(e,t,i){if(e){for(var o=[],r=0,n=e;r<n.length;r++){var a=n[r],l=p.Prototype.inherit(a);if(a.isCollapsed&&!_.isEmpty(a.children)){var s=_.find(a.children,function(e){return e.isSubtotal});s&&(l.values=s.values),l.children=null,l.hasSubtotalStyle=!0}else{if(l.isSubtotal){s=t.levels[l.level||0];if(1===s.sources.length&&!1===this.subtotalByColumn[s.sources[0].queryName])continue}l.hasSubtotalStyle=!!a.isSubtotal,l.children=this.wrapNodes(a.children,t,i)}if(!_.isEmpty(l.levelValues)&&1<l.levelValues.length&&i){for(var a=l.children,u=l,h=1;h<l.levelValues.length;h++){var d=p.Prototype.inherit(l),c=l.levelValues[h];c.levelSourceIndex=0,d.levelValues=[c],d.level+=h,d.isCollapsed=!0,d.children=void 0,u.isCollapsed=!1,u.children=[d],u=d}_.isEmpty(a)||(u.children=a,u.isCollapsed=!1),u.values=l.values,l.values=void 0,l.levelValues.splice(1,l.levelValues.length-1)}o.push(l)}return o}},i.prototype.updateHierarchy=function(e,t,i,o){0<e.leafNodes.length&&(e.leafNodes.length=0),e.root.children&&this.updateRecursive(e,e.root.children,null,e.leafNodes,t,i,o)},i.prototype.updateRecursive=function(u,h,d,c,p,g,m){for(var f,y=this,e=0,t=h.length;e<t;e++)!function(e){var t=h[e];if(t.siblings=h,d&&(t.parent=d),f=u===y.rowHierarchy&&y.isSteppedLayout&&t.isSubtotal&&void 0!==t.levelSourceIndex?_.last(u.levels):u.levels[t.level],t.hierarchyLevel=f)if(t.levelValues){for(var i=[],o=[],r=0,n=t.levelValues;r<n.length;r++){var a=n[r],l=f.sources[a.levelSourceIndex||0],s=y.formatters[l.queryName],a=a.value,s=(i.push(s.format(a,null)),y.tooltipFormatters[l.queryName]);s&&o.push(s.format(a,null))}i.length!==o.length&&_.isEmpty(o),t.valueFormatted=i.join(y.compositeGroupSeparator),t.tooltipValueFormatted=_.isEmpty(o)?void 0:o.join(y.compositeGroupSeparator),t.queryName=1!==f.sources.length?void 0:f.sources[0].queryName}else{l=f.sources[t.levelSourceIndex||0];t.valueFormatted=l.displayName,t.tooltipValueFormatted=l.displayName,t.queryName=l.queryName}t.index=e,_.isEmpty(t.children)?(!p||!t.isSubtotal||!g&&t.parent&&!t.parent.isSubtotal||y.valuesOnRow&&t.parent)&&(t.leafIndex=c.length,c.push(t)):(p&&(t.leafIndex=c.length,c.push(t)),y.updateRecursive(u,t.children,t,c,p,g,m),p&&(_.every(t.children,function(e){return _.isEqual(e.hierarchyLevel,t.children[0].hierarchyLevel)}),y.hasMultipleValueSources()&&!_.some(t.children,function(e){return _.some(e.hierarchyLevel.sources,function(e){return!e.isMeasure})})||(t.hasSubtotalStyle=!0))),t.position=m(t,h)}(e)},i.prototype.updateStaticColumnHeaders=function(e){var t=e.leafNodes;if(t&&0<t.length&&(t[0].identity||!this.valuesOnRow||1!==t.length))for(var i=0,o=t.length;i<o;i++){var r,n=t[i];!n.identity&&_.isEmpty(n.levelValues)&&(r=e.levels[n.level].sources[n.levelSourceIndex||0])&&(n.valueFormatted=r.displayName)}},i.prototype.getMatrixHierarchy=function(e){var t=this.rowHierarchy.root.children;return t&&e===t?this.rowHierarchy:(t=this.columnHierarchy.root.children)&&e===t?this.columnHierarchy:null},i.prototype.calculateRowHeaderPosition=function(e,t){var i=new r,t=(i.row.index=this.getRowLeafIndex(e),i.row.indexInSiblings=this.getIndex(e),i.row.isFirst=this.areAllParentsFirst(e,t),i.row.isLast=this.areAllParentsLast(e,t),this.getLevel(e));return i.column.index=i.column.indexInSiblings=t,i.column.isFirst=0===t,i.column.isLast=this.isLeaf(e),i},i.prototype.calculateColumnHeaderPosition=function(e,t){var i=new r,o=this.getLevel(e),o=(i.row.index=i.row.indexInSiblings=o,i.row.isFirst=0===o,i.row.isLast=this.isLeaf(e),this.getIndex(e));return i.column.index=i.column.indexInSiblings=o,i.column.isFirst=this.areAllParentsFirst(e,t),i.column.isLast=this.areAllParentsLast(e,t),i},i.prototype.getRowHeaderMetadataColumn=function(e){e=this.getRowHeaderMetadataColumns(e);return e&&e[0]},i.prototype.getRowHeaderMetadataColumns=function(e){if(e&&this.rowHierarchy)return this.getHierarchyMetadataColumns(this.rowHierarchy,e.level)},i.prototype.getColumnHeaderMetadataColumn=function(e){e=this.getColumnHeaderMetadataColumns(e);return e&&e[0]},i.prototype.getColumnHeaderMetadataColumns=function(e){if(e&&this.columnHierarchy)return this.getHierarchyMetadataColumns(this.columnHierarchy,e.level)},i.prototype.getHierarchyMetadataColumns=function(e,t){if(e&&e.levels&&!(e.levels.length<t)){e=e.levels[t];if(e&&e.sources&&0!==e.sources.length)return e.sources}},i.isNodeGrandTotal=function(e){if(e){for(var t=e;t.parent;)t=t.parent;return t.isSubtotal}return!1};var h=i;function i(e,t,i,o){this.tablixProperties=t,this.hostServices=i,this.expandCompositeHierarchy=o,this.compositeGroupSeparator=e}y.MatrixHierarchyNavigator=h}(powerbi=powerbi||{}),function(o){var d,e,c,r,a,l,i,n,s;function u(e,t){t.classNames||(t.classNames=[]);var i=t.classNames;switch(i.push("tablixIcon"),e.layout){case"IconOnly":break;case"Before":i.push("before");break;default:i.push("after")}switch(e.verticalAlignment){case"Bottom":i.push("bottom");break;case"Middle":i.push("middle");break;default:i.push("top")}}function h(e){switch(e){case 1:return"caret-up";case 2:return"caret-down"}}function p(e,t,i){e.size&&8.52===e.size.px&&(e=d.FontProperties.inherit(e,{size:r.createFromPx(8)}));e={measuredFontHeight:null,textProperties:d.FontProperties.toTextProperties(e),fontProperties:e,nonInheritedFontProperties:d.FontProperties.excludeInheritedProperties(e,i)};return t.addItem(e),e}function t(){this.items=[]}d=o.visuals||(o.visuals={}),e=d.PivotTableBinderUtils||(d.PivotTableBinderUtils={}),c=o.visuals.controls.pivotTable.ElementBuilder,r=d.Units.FontSize,a=o.visuals.controls.pivotTable.PivotTableControl,l=o.visuals.controls.internal.TablixUtils,i=jsCommon.UrlUtils.UrlScheme,n=jsCommon.WordBreaker,s=jsCommon.StringExtensions.encodeHtml,e.cssClassCellInteractive="cell-interactive",e.cssPivotTableCellClassNoWrap="pivotTableCellNoWrap",e.cssPivotTableCellClassWrap="pivotTableCellWrap",e.CellHorizontalPadding=5,e.ExpandCollapseRightMargin=5,e.TablixIconMargin=5,e.addMeasureElement=function(e){return e.insertAdjacentHTML("beforeend",c.build({content:"",classNames:null,styleProperties:{position:"absolute",left:"0",top:"0",visibility:"hidden"},attributes:null},null)),e.lastChild},e.measureText=function(e,t){return _.isEmpty(e)?0:o.TextMeasurementService.measureSvgTextWidth(t,e)},e.getWordWrappingLines=function(e,t,i){return _.isEmpty(e)?[e]:(e=e.trim(),n.splitByWidth(e,i,o.TextMeasurementService.measureSvgTextWidth,t,l.WordWrappingMaxLines,void 0,!0,!0))},e.getNetWidth=function(e,t){return Math.max(0,e-(t.getExtraLeft()+t.getExtraRight()))},e.setUnselectedStyle=function(e){e.opacity="0.3"},e.createKpiDomString=function(e,t){return c.build({content:"",classNames:[d.KpiUtil.getClassForKpi(e,t)||""],styleProperties:{display:"inline-block","vertical-align":"bottom",margin:"0"},attributes:null},null)},e.buildImage=function(e,t,i,o){return e={tagName:"img",content:"",classNames:null,styleProperties:{"max-height":"100%","max-width":"100%"},attributes:{src:e,referrerpolicy:"no-referrer"},contextMenuHandler:function(e){e.stopPropagation()}},null!=o&&(e.attributes.alt=o),{children:[e],classNames:[l.CssClassImageContainer],styleProperties:{height:a.pixelUnits(t),width:a.pixelUnits(i)},attributes:null}},e.addIconToCell=function(e,t,i,o){var r={attributes:{},styleProperties:{},classNames:["flex-container"]},n=function(e,t,i){t=a.pixelUnits(t);if(null===e.value)return{tagName:"div",styleProperties:{height:t,width:t},attributes:{},classNames:null};if(e.value,e.value.svgId)return{tagName:"svg",attributes:{height:t,width:t,role:"img","aria-label":i.getLocalizedString(e.value.descriptionKey)},classNames:null,styleProperties:{},children:[{tagName:"use",attributes:{href:"#"+e.value.svgId},classNames:null,styleProperties:{}}]};if(null!=e.value.url)return{tagName:"img",classNames:null,styleProperties:{height:t,width:t},attributes:{src:s(e.value.url),referrerpolicy:"no-referrer"}}}(e,t,o);switch(i.classNames.push("stretching-content"),e.layout){case"IconOnly":i.children=[n],u(e,i),r.children=[i];break;case"After":u(e,n),r.children=[i,n];break;default:u(e,n),r.children=[n,i]}return r},e.getUrlIconName=function(e,t){return e?l.getUrlIconName(t):null},e.addHyperlink=function(e,t,i,o,r,n){var a={tagName:"a",classNames:[],styleProperties:{},attributes:{href:t,target:"_blank",rel:"noopener noreferrer",role:"link"},clickHandler:function(e){e.stopPropagation(),o(t,e)},contextMenuHandler:function(e){e.stopPropagation()}};return"string"==typeof e?a.content=e:a.children=[e],i&&(a.content=void 0,a.children=void 0,a.classNames.push(l.CssClassValueURLIcon,i),a.attributes["aria-label"]=t),r&&(a.styleProperties.color="inherit"),n&&(a.attributes.title=t),a},e.getSortIconHeight=function(e){return e-1},e.buildSortIcon=function(e,t,i,o,r,n){var a;return t&&(a=e?["powervisuals-glyph","sort-icon",h(e)]:i?["powervisuals-glyph","sort-icon",h(o),"future"]:["sort-icon"]),{content:l.StringNonBreakingSpace,attributes:{"aria-hidden":"true"},styleProperties:{"font-size":n,bottom:r+"px"},classNames:a}},e.getSortIconClass=h,e.isValidUrl=function(e,t){return l.getUrlScheme(e,t)!==i.NONE},e.replaceEncodedNewLines=function(e){return e&&e.replace(/&#10;/g,"<BR />")},e.createFontInfo=p,e.overrideFontInfo=function(e,t,i,o){return p(d.FontProperties.inherit(e.fontProperties,t),i,o)},e.applyFontInfo=function(e,t,i,o){(i=i?e.nonInheritedFontProperties:e.fontProperties).family&&(t.fontFamily=i.family),i.size&&(t.fontSize=i.size),i.weight&&(t.fontWeight=i.weight),i.style&&(t.fontStyle=i.style),i.textDecoration&&o&&(t.textDecoration=i.textDecoration)},e.addAlignmentCssClass=function(e,t,i){if(null==e||e===d.textAlignment.auto){if(!i)return;e=i}switch(e){case d.textAlignment.left:return void t.push(l.CSSClassPivotTableAlignLeft);case d.textAlignment.center:return void t.push(l.CSSClassPivotTableAlignCenter);case d.textAlignment.right:return void t.push(l.CSSClassPivotTableAlignRight);default:return}},t.prototype.addItem=function(e){this.items.push(e)},t.prototype.measureAll=function(e){if(!_.isEmpty(this.items)){for(var t=[],i=0,o=this.items;i<o.length;i++){var r=o[i],n={content:"a",classNames:null,styleProperties:d.FontProperties.toHTMLStyle(r.fontProperties),attributes:null};t.push(c.build(n,null))}for(var a=t.join(""),l=(e.insertAdjacentHTML("beforeend",a),!0),s=0,u=this.items;s<u.length;s++){var r=u[s],h=l?(l=!1,e.firstChild):h.nextSibling;r.measuredFontHeight=Math.ceil(h.offsetHeight)}e.innerHTML=""}},e.FontInfoMeasurer=t}(powerbi=powerbi||{}),function(e){var l,s;l=e.visuals||(e.visuals={}),e=l.PivotTableBinderUtils||(l.PivotTableBinderUtils={}),s=jsCommon.StringExtensions.encodeHtml,e.getColumnDataBarsSettings=function(e,t,i){if(t){var o,r,n,a,e=e.aggregates;if(null!=t.minValue?o=t.minValue:e&&null!=e.min&&_.isNumber(e.min)&&(o=e.min),null!=t.maxValue?r=t.maxValue:e&&null!=e.max&&_.isNumber(e.max)&&(r=e.max),!(null==o||null==r||r<o))return e=null!=t.minValue,n=null!=t.maxValue,(o=0<=o&&0<r&&!e?0:o)<0&&r<0&&!n&&(r=0),e=0===o&&0===r?.5:0<=o&&0<r&&e?0:o<0&&r<=0&&n?1:(0-o)/(r-o),i.isHighContrast&&(a={visible:!0,color:l.ColorHelper.getThemeColor(i,l.ForegroundColorName),width:1}),{min:o,max:r,range:r-o,zeroPosition:e,positiveColor:s(l.ColorHelper.getFillColor(i,t.positiveColor,l.BackgroundColorName)),negativeColor:s(l.ColorHelper.getFillColor(i,t.negativeColor,l.BackgroundColorName)),axisColor:s(l.ColorHelper.getFillColor(i,t.axisColor,l.ForegroundColorName)),hideText:!!t.hideText,reverseDirection:!!t.reverseDirection,strokeSettings:a}}},e.addDataBarsToCell=function(e,t,i,o,r){var n,a=i.getExtraLeft()+"px",l=i.getExtraRight()+"px",s=i.getExtraTop()+"px",i=i.getExtraBottom()+"px",u={children:[],attributes:{},classNames:[],styleProperties:{position:"absolute",left:a,right:l,top:s,bottom:i}},h=[],o=((o=function(e,t,i){if(null!=t&&_.isNumber(t)&&0!==t){var o,r,n=e.min,a=e.max,l=e.range,s=e.zeroPosition;if(a<=t){if(1===s)return;t=a}else if(t<=n){if(0===s)return;t=n}a=0===l?(o=r=s,e.positiveColor):0<t?(o=s,r=(t-n)/l,e.positiveColor):(o=(t-n)/l,r=s,e.negativeColor),e.reverseDirection&&(n=o,o=1-r,r=1-n);l=100*(r-o),s=(null!=i&&i.push((0<=t?"":"-")+Math.round(l)+"%"),{left:100*o+"%",width:l+"%",background:a}),n=e.strokeSettings;return n&&n.visible&&(s.outline="".concat(n.width,"px solid ").concat(n.color),s["outline-offset"]="-".concat(n.width,"px")),{content:"",attributes:{},classNames:["dataBar"],styleProperties:s}}}(t,o,h))&&u.children.push(o),t.zeroPosition),o={content:"",attributes:{},classNames:["dataBarAxis"],styleProperties:{top:"-"+s,bottom:"-"+i,left:100*(o=t.reverseDirection?1-o:o)+"%","border-left-color":t.axisColor}};return u.children.push(o),r&&(n={attributes:{},classNames:["visually-hidden"],styleProperties:{},content:r.getLocalizedString("Data_Bar_Percentage",null!=(t=h[0])?t:"0%")}),(o=e.styleProperties).position="absolute",o.left=a,o.right=l,o.top=s,o.bottom=i,n?{children:[u,e,n],classNames:[],attributes:{},styleProperties:{}}:{children:[u,e],classNames:[],attributes:{},styleProperties:{}}}}(powerbi=powerbi||{}),function(e){var f,t,y,b,d;f=e.visuals||(e.visuals={}),t=f.PivotTableBinderUtils||(f.PivotTableBinderUtils={}),y=jsCommon.EnumExtensions,b=e.visuals.Markers,d=e.visuals.SparklineDataReductionWarning,t.parseSparklineData=function(e,t){var i={points:[],lowX:void 0,highX:void 0,lowY:void 0,highY:void 0,minXDifference:void 0};if(!_.isEmpty(e)){var e=JSON.parse(e),o=+e.yl,r=+e.yh,n=+e.xl,a=+e.xh,l=null!=e.md?+e.md:void 0;52<_.size(e.p)&&t.setWarnings([new d]);for(var s=0,u=e.p;s<u.length;s++){var h=u[s];i.points.push({x:null!=h[0]?+h[0]:void 0,y:null!=h[1]?+h[1]*(r-o)/100+o:void 0})}return{points:_.filter(i.points,function(e){return _.isFinite(e.x)&&(null!=e.y||_.isFinite(e.y))}),lowX:n,highX:a,lowY:o,highY:r,minXDifference:l}}},t.getSparklineSettings=function(e,t,i){null!=(o=null==t?void 0:t.misc)&&o.sparkline;var o=i.isHighContrast?f.ColorHelper.getThemeColor(i,f.ForegroundColorName):e.dataColor.solid.color,i=i.isHighContrast?f.ColorHelper.getThemeColor(i,f.ForegroundColorName):e.markerColor.solid.color,t=(t=t.misc.sparkline.groupingType)&&!!(t.numeric||t.dateTime||t.temporal);return{chartType:e.chartType===f.sparklineChartType.line?"Line":"Column",dataColor:o,strokeWidth:e.strokeWidth,markerType:e.markers,markerColor:i,markerSize:e.markerSize,markerShape:e.markerShape,isScalar:t}},t.addSparklineToCell=function(e,t,i,o,r,n,a,l){null!=o&&(n=n-i.getExtraLeft()-i.getExtraRight()-(l?l+5:0),l=r-i.getExtraTop()-i.getExtraBottom(),1<n-t.strokeWidth)&&1<l-t.strokeWidth&&(h="Line"===t.chartType?function(e,t,i,o){var r,n=e.dataColor,a=e.strokeWidth,l=e.markerColor,s=e.markerSize,u=e.markerShape,h=e.markerType,d=e.isScalar,c=y.getBitCount(h),c=0===c||1===c&&y.hasFlag(h,f.sparklineMarkerType.isolated),h=Math.max(a,2)+(c?0:Math.ceil(s/2)),c=o.points;r=(d?d3.scaleLinear().domain([o.lowX,o.highX]):d3.scalePoint().domain(_.map(_.range(o.lowX,o.highX+1),function(e){return e.toString()}))).range([h,t-h]);var p,g,m=d3.scaleLinear().domain(d3.extent(c,function(e){return e.y})).range([i-h,h]),d=d3.line().x(function(e){return r(e.x)}).y(function(e){return m(e.y)}),o=_.filter(c,function(e){return null!=e.y}),h={tagName:"path",attributes:{d:d(o)},classNames:[],styleProperties:{stroke:n,"stroke-width":a.toString(),"stroke-linecap":"round","stroke-linejoin":"round",fill:"transparent"}},c=function(o,e){var r=e.markerType,e=d3.extent(o,function(e){return e.y}),n=e[0],a=e[1];return _.filter(o,function(e,t){var i;return null!=e.y&&(!!y.hasFlag(r,f.sparklineMarkerType.all)||(i=!1,y.hasFlag(r,f.sparklineMarkerType.first)&&(i=i||0===t),y.hasFlag(r,f.sparklineMarkerType.last)&&(i=i||t===o.length-1),y.hasFlag(r,f.sparklineMarkerType.negative)&&(i=i||e.y<0),y.hasFlag(r,f.sparklineMarkerType.highest)&&(i=i||e.y===a),y.hasFlag(r,f.sparklineMarkerType.lowest)&&(i=i||e.y===n),y.hasFlag(r,f.sparklineMarkerType.isolated)?i||null==(null==(e=o[t-1])?void 0:e.y)&&null==(null==(e=o[t+1])?void 0:e.y):i))})}(o,e);_.isEmpty(c)||(a="markerKey".concat(s).concat(l).concat(u),p={tagName:"defs",classNames:[],styleProperties:{},attributes:{},children:[{tagName:"marker",classNames:[],styleProperties:{},attributes:{id:a,markerUnits:"strokeWidth",orient:"0",refX:"0",refY:"0",viewBox:"-6 -6 12 12",markerHeight:s.toString(),markerWidth:s.toString()},children:[{tagName:"path",classNames:[],styleProperties:{"stroke-width":b.getStrokeWidth(u).toString(),"stroke-opacity":"1",stroke:l,fill:l},attributes:{d:b.getPath(u)}}]}]},o=d(c),g={tagName:"path",attributes:{d:o},classNames:[],styleProperties:{stroke:n,"stroke-width":2..toString(),"stroke-opacity":"0",fill:"transparent","marker-start":"url(#".concat(a,")"),"marker-mid":"url(#".concat(a,")"),"marker-end":"url(#".concat(a,")")}});return{tagName:"svg",children:g?[p,h,g]:[h],classNames:[],styleProperties:{},attributes:{height:i+"px",width:t+"px"}}}(t,n,l,o):(r=n,i=l,n=o,u=(l=t).dataColor,l=l.isScalar,o=n.points,t=[n.lowX,n.highX],h=function(e,t,i,o,r){if(_.isEmpty(e))return 0;var n,e=o[o.length-1]-o[0];n=r&&o&&1<o.length?(n=0!=e?i*(t/(e+t)):i,Math.max(n,2)):i/(1+e);return.8*n}(o,n.minXDifference,r,t,l),d=h/2,s=(l?d3.scaleLinear().domain(t):d3.scalePoint().domain(_.map(_.range(n.lowX,n.highX+1),function(e){return e.toString()}))).range([d,r-d]),(l=d3.extent(o,function(e){return e.y}))[0]=Math.min(0,l[0]),l[1]=Math.max(0,l[1]),c=d3.scaleLinear().domain(l).range([i,0]),p=c(0),g=h.toString(),{tagName:"svg",children:_.chain(o).filter(function(e){return null!=e.y}).map(function(e){var t=(s(e.x)-d).toString(),i=(p+f.AxisHelper.diffScaled(c,Math.max(0,e.y),0)).toString(),e=Math.abs(f.AxisHelper.diffScaled(c,0,e.y)).toString();return{tagName:"rect",classNames:[],styleProperties:{fill:u},attributes:{x:t,y:i,width:g,height:e}}}).value(),classNames:[],styleProperties:{},attributes:{height:i+"px",width:r+"px"}}));var s,u,h,d,c,p,g,t=a&&"Before"!==a.layout?[h,e]:[e,h];return{attributes:{},styleProperties:{},classNames:["flex-container"],children:_.filter(t,function(e){return!!e})}}}(powerbi=powerbi||{}),function(e){var s;((s=e.visuals||(e.visuals={})).PivotTableSizeManagerUtils||(s.PivotTableSizeManagerUtils={})).persistWidths=function(e,t,i){for(var o={remove:[],merge:[]},r=0,n=e;r<n.length;r++){var a=n[r],l={selector:a.selector,objectName:s.TablixProperties.PropColumnWidthValue.objectName,properties:{}};l.properties[s.TablixProperties.PropColumnWidthValue.propertyName]=a.value,(null==a.value?o.remove:o.merge).push(l)}t.persistProperties(o,i)}}(powerbi=powerbi||{}),function(h){var m,o,s,l,i,d,t;function r(e,t){void 0===e&&(e=i.createDefaultConstructorOptions()),this.options=e,this.featureSwitches=t||{},this.options.tooltipsEnabled=this.options.tooltipsEnabled,this.tooltipType=0,this.asyncSerializer=new h.AsyncSerializer}m=h.visuals||(h.visuals={}),o=jsCommon.BrowserUtils,s=m.controls.pivotTable.PivotTableControl,l=m.controls.pivotTable.TablixControl,i=h.visuals.PivotTableOptions,d=m.controls.pivotTable.PivotTableRenderingMode,t=m.controls.internal.TablixUtils,r.prototype.init=function(e){this.element=e.element,this.hostServices=e.host,this.waitingForData=!1,this.style=e.style,this.tablixPropertyManager=new m.TablixPropertyManager(this.style),this.selectionManager=new m.PivotTableSelectionManager(this.hostServices,this.featureSwitches),this.sortingManager=new m.PivotTableSortingManager(this.hostServices),this.sizeManager=new m.PivotTableSizeManager(this.hostServices),this.tooltipService=m.createTooltipService(e.host),this.valueLabel=this.hostServices.getLocalizedString(t.ValueLabel),this.totalLabel=this.hostServices.getLocalizedString(t.TotalLabel)},r.prototype.update=function(o){return __awaiter(this,void 0,h.Promise,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.asyncSerializer.enqueue(function(){return __awaiter(t,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return document.fonts&&"loaded"!==document.fonts.status?[4,document.fonts.ready]:[3,2];case 1:e.sent(),e.label=2;case 2:return o.type&h.VisualUpdateType.Data?[4,this.onDataViewChanged(o.dataViews,o.operationKind,o.viewport)]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.pivotTableControl&&o.type&h.VisualUpdateType.Resize?(t=this.getVisibleRowStart(this.getPreviousVisibleRowStart(),!1),i=this.getVisibleColumnStart(this.getPreviousVisibleColumnStart()),this.pivotTableControl.setWidth(o.viewport.width),this.pivotTableControl.setHeight(o.viewport.height),[4,this.renderControl(d.Incremental,t,i)]):[3,6];case 5:e.sent(),e.label=6;case 6:return[2]}})})})];case 1:return e.sent(),[2]}})})},r.prototype.updatePersistedWidths=function(e){var t=m.TablixProperties.PropColumnPivotTableAutoSizeColumns.getValue(this.dataView.metadata.objects);if(!t&&this.pivotTableControl){for(var i=[],o=this.columnHierarchyNavigator.getHierarchyLeafNodes(),r=0,n=0,a=this.pivotTableControl.getColumnWidthMeasureManager().getPageColumns();n<a.length;n++)for(var l=0,s=a[n].getColumnWidths();l<s.length;l++){var u=s[l];i.push({node:o[r],width:u}),r++}for(var h=[],d=this.rowHierarchyNavigator.getHierarchyDepth(),c=this.columnHierarchyNavigator.getHierarchyDepth(),p=0;p<d;p++)h.push({corner:this.rowHierarchyNavigator.getCorner(p,c-1),width:this.pivotTableControl.getRowLevelWidthMeasureManager().getLevelWidth(p)});this.sizeManager.setMissingWidths(i,h)}else if(t&&e&&e.metadata&&e.metadata.objects&&!m.TablixProperties.PropColumnPivotTableAutoSizeColumns.getValue(e.metadata.objects)){for(var o=this.columnHierarchyNavigator.getHierarchyLeafNodes(),g=[],d=this.rowHierarchyNavigator.getHierarchyDepth(),c=this.columnHierarchyNavigator.getHierarchyDepth(),p=0;p<d;p++)g.push(this.rowHierarchyNavigator.getCorner(p,c-1));this.sizeManager.clearWidths(o,g)}},r.prototype.onDataViewChanged=function(n,a,l){return __awaiter(this,void 0,h.Promise,function(){var t,i,o,r=this;return __generator(this,function(e){switch(e.label){case 0:return(this.setExpandCollapseEnabled(),_.isEmpty(n))?[3,5]:(t=this.dataView,this.dataView=n[0],i=!this.dataView.metadata.segment,this.formattingProperties=this.tablixPropertyManager.getPivotTableObjects(this.dataView,function(e){for(var t,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return(t=r.hostServices).getLocalizedString.apply(t,__spreadArray([e],i||[],!1))},this.expandCollapseEnabled,this.style,this.featureSwitches),this.formatters=this.formattingProperties.formatters,this.tooltipFormatters=this.formattingProperties.tooltipFormatters,o=this.shouldApplyValuesOnRow(),a!==h.VisualDataChangeOperationKind.Append?[3,2]:[4,this.onAppendDataView(t,o,i)]);case 1:return e.sent(),[3,4];case 2:return[4,this.onNewDataView(t,l,o,i)];case 3:e.sent(),e.label=4;case 4:return this.pivotTableControl instanceof s&&this.pivotTableControl.restoreFocus(),[3,6];case 5:this.dataView=void 0,this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(void 0,void 0),this.pivotTableControl&&this.pivotTableControl.clear(),e.label=6;case 6:return this.waitingForData=!1,[2]}})})},r.prototype.onAppendDataView=function(l,s,u){return __awaiter(this,void 0,h.Promise,function(){var t,i,o,r,n,a;return __generator(this,function(e){switch(e.label){case 0:return(t=this.rowHierarchyNavigator.getHierarchyLeafCount(),i=this.getPreviousVisibleRowStart(),o=this.getPreviousVisibleColumnStart(),this.updateHierarchyNavigators(this.formattingProperties.rowHeaders.steppedLayout,s,this.formattingProperties.subtotals.rowSubtotalsPosition===m.rowSubtotalPosition.top,u,l.matrix.rows.root!==this.dataView.matrix.rows.root),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),r=this.formattingProperties.rowHeaders.steppedLayout,n=this.matrixNavigator.getColumnHierarchy(),a=this.matrixNavigator.getValueSources(),this.sortingManager.onDataViewChanged(this.matrixNavigator.getRowHierarchy(),n,a,r,s),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),t>this.rowHierarchyNavigator.getHierarchyLeafCount()||!_.isEqual(l.metadata.columns,this.dataView.metadata.columns))?[4,this.renderControl(d.ClearMeasurement,this.getVisibleRowStart(i,!1),this.getVisibleColumnStart(o))]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,this.renderControl(d.ClearRendering,null,null)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},r.prototype.onNewDataView=function(a,l,s,u){return __awaiter(this,void 0,h.Promise,function(){var t,i,o,r,n;return __generator(this,function(e){switch(e.label){case 0:return t=this.formattingProperties.rowHeaders.steppedLayout,i=this.getPreviousVisibleRowStart(),o=this.getPreviousVisibleColumnStart(),this.createOrUpdateControlAndNavigators(t,s,this.formattingProperties.subtotals.rowSubtotalsPosition===m.rowSubtotalPosition.top,u,this.formattingProperties.rowHeaders.expandCompositeHierarchy),r=this.matrixNavigator.getColumnHierarchy(),n=this.matrixNavigator.getValueSources(),this.sizeManager.onDataViewChanged(r,n,this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,s),this.sortingManager.onDataViewChanged(this.matrixNavigator.getRowHierarchy(),r,n,t,s),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.featureSwitches.a11yMatrix||this.pivotTableControl.clear(),this.pivotTableControl.setWidth(l.width),this.pivotTableControl.setHeight(l.height),r=this.hostServices.tooltips(),this.options.tooltipsEnabled&&r&&r.enabled()?this.tooltipType=1:this.tooltipType=0,this.interactionManager&&this.interactionManager.setTooltipsEnabled(1===this.tooltipType),n=this.expandCollapseEnabled&&"interactive"===this.options.expandCollapse.buttonsOption,this.binder.onDataViewChanged(this.dataView,this.formattingProperties,this.style,0===this.tooltipType,n),this.applyContainerStyles(),[4,this.renderControl(d.ClearMeasurement,this.getVisibleRowStart(i,m.PivotTableSortingManager.hasSortingChanged(a,this.dataView)),this.getVisibleColumnStart(o))];case 1:return e.sent(),this.updatePersistedWidths(a),[2]}})})},r.prototype.onVerticalScrollButtonClick=function(e,t){e=this.hostServices.getLocalizedString("Table_Location_Vertical",this.getScrollRowIndex(e),this.getScrollRowIndex(t));this.hostServices.alertScreenReader(e)},r.prototype.onHorizontalScrollButtonClick=function(e,t){e=this.hostServices.getLocalizedString("Table_Location_Horizontal",this.getScrollColumnIndex(e),this.getScrollColumnIndex(t));this.hostServices.alertScreenReader(e)},r.prototype.getScrollRowIndex=function(e){return 0===e?1:this.pivotTableControl.getMidRenderer().getAriaRowIndex(e)},r.prototype.getScrollColumnIndex=function(e){return 0===e?1:this.pivotTableControl.getMidRenderer().getAriaColIndex(e,!1)},r.prototype.applyContainerStyles=function(){var e,t,i;this.featureSwitches.a11yMatrix||(e=this.pivotTableControl,t=this.binder.getCornerContainerFontInfo().fontProperties,i=e.getCornerContainer(),this.removeContainerStyles(i),m.FontProperties.applyStyleToElement(t,i),t=this.binder.getColumnHeaderContainerFontInfo().fontProperties,i=e.getColumnHeaderContainer(),this.removeContainerStyles(i),m.FontProperties.applyStyleToElement(t,i),t=this.binder.getRowHeaderContainerFontInfo().fontProperties,i=e.getRowHeaderContainer(),this.removeContainerStyles(i),m.FontProperties.applyStyleToElement(t,i),i=e.getFloatingRowHeaderContainer(),this.removeContainerStyles(i),m.FontProperties.applyStyleToElement(t,i),t=this.binder.getValueContainerFontInfo().fontProperties,i=e.getBodyCellContainer(),this.removeContainerStyles(i),m.FontProperties.applyStyleToElement(t,i),i=e.getFloatingBodyCellContainer(),this.removeContainerStyles(i),m.FontProperties.applyStyleToElement(t,i))},r.prototype.removeContainerStyles=function(e){return e.style.removeProperty("font-weight"),e.style.removeProperty("font-style"),e},r.prototype.onClearSelection=function(){this.selectionManager.clearLocal(),this.renderSelection()},r.prototype.onRestoreSelection=function(e){e=this.selectionManager.restoreSelectionState(e.selection,this.matrixNavigator);return this.renderSelection(),e},r.prototype.shouldApplyValuesOnRow=function(){var e=this.dataView.matrix,t=e.valueSources,e=e.columns.levels;return!_.isEmpty(e)&&(e=e[0].sources,this.formattingProperties.values.valuesOnRow)&&1<t.length&&!(_.find(e,function(e){return e.isMeasure})&&_.find(e,function(e){return!e.isMeasure}))},r.prototype.updateHierarchyNavigators=function(e,t,i,o,r){this.matrixNavigator.update(this.dataView.matrix,e,t,i,o,r,this.formatters,this.tooltipFormatters,this.getSubtotalByColumn()),this.rowHierarchyNavigator.setHierarchy(this.matrixNavigator.getRowHierarchy()),this.columnHierarchyNavigator.setHierarchy(this.matrixNavigator.getColumnHierarchy())},r.prototype.getSubtotalByColumn=function(){for(var e={},t=this.dataView.metadata.objects,i=m.TablixProperties.PropSubTotalsPivotTableRowSubtotals.getValue(t),o=m.TablixProperties.PropSubTotalsPivotTableRowSubtotalsPerLevel.getValue(t),r=m.TablixProperties.PropSubTotalsPivotTableColumnSubtotals.getValue(t),n=m.TablixProperties.PropSubTotalsPivotTableColumnSubtotalsPerLevel.getValue(t),a=0,l=this.dataView.metadata.columns;a<l.length;a++){var s=l[a],u=void 0,h=void 0;if(s.roles){if(s.roles[m.matrixRoleNames.rows])u=i,h=o;else{if(!s.roles[m.matrixRoleNames.columns])continue;u=r,h=n}e[s.queryName]=u&&(!h||m.TablixProperties.PropSubTotalsPivotTableLevelSubtotalEnabled.getValue(s.objects))}}return e},r.prototype.renderControl=function(e,t,i){var o,r;return this.featureSwitches.a11yMatrix?this.pivotTableControl.renderAsync(e,t,i):(o=this.pivotTableControl,r=this.hostServices.promiseFactory().defer(),t||i?o.makeVisible(e,t,i,function(e){e?r.reject(e):r.resolve(null)},this.featureSwitches.a11yMatrix):o.render(e,function(e){e?r.reject(e):r.resolve(null)}),r.promise)},r.prototype.getPreviousVisibleRowStart=function(){var e,t;if(this.pivotTableControl)return(e=this.pivotTableControl.getVisibleRowStart())&&(t=this.rowHierarchyNavigator.getHierarchyLeafAt(e.rowIndex))?{item:t,offset:e.visibleHeight}:null},r.prototype.getPreviousVisibleColumnStart=function(){var e,t;if(this.pivotTableControl)return(e=this.pivotTableControl.getVisibleColumnStart())&&(t=this.columnHierarchyNavigator.getHierarchyLeafAt(e.columnIndex))?{item:t,offset:e.visibleWidth}:null},r.prototype.getVisibleRowStart=function(e,t){return!e||0===this.pivotTableControl.getViewport().top?null:t?{rowIndex:0,visibleHeight:Number.MAX_VALUE}:!(t=m.PivotTableSelectionManager.getMatchingHeader(e.item,this.rowHierarchyNavigator.getHierarchyItems()))||void 0===(t=this.rowHierarchyNavigator.getLeafIndex(t))?null:{rowIndex:t,visibleHeight:e.offset}},r.prototype.getVisibleColumnStart=function(e){var t;return e&&0!==this.pivotTableControl.getViewport().left&&(t=m.PivotTableSelectionManager.getMatchingHeader(e.item,this.columnHierarchyNavigator.getHierarchyItems()))&&this.columnHierarchyNavigator.isLeaf(t)?{columnIndex:this.columnHierarchyNavigator.getLeafIndex(t),visibleWidth:e.offset}:null},r.prototype.renderSelection=function(){this.featureSwitches.a11yMatrix?this.pivotTableControl.renderAsync(d.ClearRendering):this.pivotTableControl.render(d.ClearRendering)},r.prototype.createOrUpdateControlAndNavigators=function(e,t,i,o,r){var n=this,a=this.hostServices.getLocalizedString("ListJoin_Separator");this.matrixNavigator||(this.matrixNavigator=new m.MatrixHierarchyNavigator(a,this.tablixPropertyManager.tablixProperties,this.hostServices,r)),this.rowHierarchyNavigator?e?this.rowHierarchyNavigator instanceof m.PivotTableSteppedHierarchyNavigator||(this.rowHierarchyNavigator=new m.PivotTableSteppedHierarchyNavigator(this.matrixNavigator)):this.rowHierarchyNavigator instanceof m.PivotTableSteppedHierarchyNavigator&&(this.rowHierarchyNavigator=new m.PivotTableHierarchyNavigator(this.matrixNavigator)):(this.rowHierarchyNavigator=new(e?m.PivotTableSteppedHierarchyNavigator:m.PivotTableHierarchyNavigator)(this.matrixNavigator),this.columnHierarchyNavigator=new m.PivotTableHierarchyNavigator(this.matrixNavigator)),this.updateHierarchyNavigators(e,t,i,o,!0),this.pivotTableControl?this.pivotTableControl.getSteppedLayout()!==e&&this.switchRowHeadersLayout(e):(a={onBindRowHeader:function(e){n.onBindRowHeader(e)},onHyperlinkClicked:function(e,t){return n.onHyperlinkClicked(e,t)},onRowHeaderExpansionChange:function(e,t){return n.onHeaderExpansionChange(e,[m.matrixRoleNames.rows],t)},defaultTotalLabel:this.totalLabel,selectionEnabled:this.options.selection&&this.options.selection.enabled,sortingEnabled:this.options.sorting&&this.options.sorting.enabled,sortIconEnabled:this.options.sorting&&this.options.sorting.showActiveSortIcon,interactivityIndicatorEnabled:this.options.interactivityIndicatorEnabled,hyperlinksEnabled:this.featureSwitches.conditionalTablixWebURL,tablixProperties:this.tablixPropertyManager.tablixProperties},(r=document.createElement("div")).className="pivotTableContainer",this.element.append(r),this.binder=new m.PivotTableBinder(a,this.selectionManager,this.sortingManager,this.hostServices,r,this.featureSwitches.a11yMatrix),t=this.featureSwitches.a11yMatrix,i=this.featureSwitches.onObject,this.pivotTableControl=t?new l(r,this.sizeManager,this.createControlOptions(),!1,t,i,this.hostServices,this.style,this.onVerticalScrollButtonClick.bind(this),this.onHorizontalScrollButtonClick.bind(this),this.options.interactivityIndicatorEnabled):new s(r,this.sizeManager,this.createControlOptions(),!1,t,i,void 0,void 0,this.hostServices),this.pivotTableControl.setClassName("pivotTable"),this.switchRowHeadersLayout(e),this.pivotTableControl.setColumnNavigator(this.columnHierarchyNavigator),this.binder.setColumnNavigator(this.columnHierarchyNavigator),this.pivotTableControl.setBinder(this.binder))},r.prototype.createControlOptions=function(){var i=this,e=this.options.scrolling.enabled,t=this.options.columnResizing.enabled,o=(this.options.tooltipsEnabled&&(this.interactionManager=new m.PivotTableInteractionManager(this.tooltipService,this.selectionManager,this.valueLabel,this.totalLabel)),this.interactionManager),r="interactive"===this.options.expandCollapse.buttonsOption,n=null,a=(!this.featureSwitches.a11yMatrix&&o&&(n=o.getRowHeaderHandler()),null),l=(this.featureSwitches.a11yMatrix&&o?a=o.getHandlerTop():!this.featureSwitches.a11yMatrix&&o&&(a=o.getColumnHeaderHandler()),null),s=(this.featureSwitches.a11yMatrix&&o?l=o.getHandlerMidOrBot():!this.featureSwitches.a11yMatrix&&o&&(l=o.getBodyHandler()),null);return!this.featureSwitches.a11yMatrix&&o&&(s=o.getCornerHandler()),this.options.selection.enabled?{rowHeaderClickHandler:function(e,t){return i.onItemClick(e,t,m.PivotTableSelectionMode.RowHeader)},rowHeaderContextMenuHandler:function(e,t){return i.onItemContextMenu(e,m.PivotTableSelectionMode.RowHeader,t,m.matrixRoleNames.rows)},rowHeaderInteractionHandler:n,rowHeaderFocusHandler:function(e){return i.onRowHeaderFocus(e)},rowHeaderExpandCollapseHandler:r?function(e,t){return i.onHeaderExpansionChange(e,[m.matrixRoleNames.rows],t)}:null,columnHeaderClickHandler:function(e,t){return i.onItemClick(e,t,m.PivotTableSelectionMode.ColumnHeader)},columnHeaderContextMenuHandler:function(e,t){return i.onItemContextMenu(e,m.PivotTableSelectionMode.ColumnHeader,t,m.matrixRoleNames.columns)},columnHeaderInteractionHandler:a,columnHeaderFocusHandler:function(e){return i.onColumnHeaderFocus(e)},bodyCellClickHandler:function(e,t){return i.onItemClick(e,t,m.PivotTableSelectionMode.BodyCell)},bodyCellContextMenuHandler:function(e,t){return i.onItemContextMenu(e,m.PivotTableSelectionMode.BodyCell,t,m.matrixRoleNames.values)},bodyCellInteractionHandler:l,bodyCellFocusHandler:function(e){return i.onBodyCellFocus(e)},cornerCellClickHandler:function(e,t){return i.onCornerCellClick(e,t)},cornerCellContextMenuHandler:function(e,t){return i.onCornerCellContextMenu(e,t)},cornerCellInteractionHandler:s,cornerCellFocusHandler:function(e){return i.onCornerCellFocus(e)},cellContentActivationHandler:function(e,t){return i.onContentActivation(e,t)},whitespaceClickHandler:function(e,t){return i.onWhitespaceClick(t)},scrollingEnabled:e,columnResizingEnabled:t,rowLevelResizingEnabled:t,onScroll:function(){return i.onScroll()}}:{rowHeaderClickHandler:null,rowHeaderContextMenuHandler:null,rowHeaderInteractionHandler:n,rowHeaderFocusHandler:null,rowHeaderExpandCollapseHandler:r?function(e,t){return i.onHeaderExpansionChange(e,[m.matrixRoleNames.rows],t)}:null,columnHeaderClickHandler:null,columnHeaderContextMenuHandler:null,columnHeaderInteractionHandler:a,columnHeaderFocusHandler:null,bodyCellClickHandler:null,bodyCellContextMenuHandler:null,bodyCellInteractionHandler:l,bodyCellFocusHandler:null,cornerCellClickHandler:null,cornerCellContextMenuHandler:null,cornerCellInteractionHandler:s,cornerCellFocusHandler:null,cellContentActivationHandler:null,whitespaceClickHandler:null,scrollingEnabled:e,columnResizingEnabled:t,rowLevelResizingEnabled:t,onScroll:function(){return i.onScroll()}}},r.prototype.onScroll=function(){this.interactionManager&&!this.interactionManager.tooltipVisible()&&this.interactionManager.hideTooltip()},r.prototype.onWhitespaceClick=function(e){this.selectionManager.onWhitespaceClick(),this.renderSelection(),e&&(e=this.hostServices.getLocalizedString("Tablix_Selections_Cleared"),this.hostServices.alertScreenReader(e))},r.prototype.onHyperlinkClicked=function(e,t){this.hostServices.onHyperlinkClick(e,t)},r.prototype.onItemClick=function(e,t,i){this.selectionManager.isDrillingEnabled(e,t,i)||(i===m.PivotTableSelectionMode.ColumnHeader&&this.sortingManager.isColumnHeaderSortable(e)?this.options.sorting.enabled&&this.sortingManager.sortColumnHeader(e):(e=m.PivotTableSelectionManager.getMatchingItem(e,i,this.rowHierarchyNavigator.getHierarchyItems(),this.columnHierarchyNavigator.getHierarchyItems(),this.rowHierarchyNavigator),t=o.isCtrlOrMeta(t)||1===this.hostServices.dataMultiSelectMode()?3:0,e&&(this.selectionManager.select(e,i,t),this.renderSelection(),this.featureSwitches.a11yMatrix||this.hostServices.alertScreenReader(this.hostServices.getLocalizedString("Visual_DataPoint_Selected")))))},r.prototype.onRowHeaderFocus=function(e){var t,i,o=m.PivotTableInteractivityUtils.getGroupingDataItems(e,this.valueLabel,!1,this.totalLabel),r=[],n=this.rowHierarchyNavigator.getExpansionState(e);if(!this.featureSwitches.a11yMatrix)switch(n){case 1:r.push(this.hostServices.getLocalizedString("FieldListProperty_Collapsed"));break;case 0:r.push(this.hostServices.getLocalizedString("FieldListProperty_Expanded"))}this.featureSwitches.a11yMatrix&&!this.pivotTableControl.getSteppedLayout()&&1!==n&&1<(n=this.rowHierarchyNavigator.getNodeLeafCount(e))&&r.push(this.hostServices.getLocalizedString("SpansXRows",n)),this.featureSwitches.a11yMatrix&&this.rowHierarchyNavigator.isMultiLevelHierarchy()&&(i=this.getHierarchyLevelInfo(e),r.push(i)),this.pivotTableControl.getSteppedLayout()||this.featureSwitches.a11yMatrix||(t=(n=this.rowHierarchyNavigator.getItemsByLevel(e.position.column.index)).indexOf(e)+1,n=n.length,r.push(this.hostServices.getLocalizedString("Generic_ListPosition",t,n))),this.featureSwitches.a11yMatrix&&0<this.rowHierarchyNavigator.getLevel(e)&&(t=this.rowHierarchyNavigator.getParent(e).children.length,n=this.rowHierarchyNavigator.getIndex(e)+1,this.pivotTableControl.getSteppedLayout()&&(--t,--n),r.push(this.hostServices.getLocalizedString("Generic_ListPosition",n,t))),this.featureSwitches.a11yMatrix||(this.selectionManager.isItemSelected(e,!1)?r.push(this.hostServices.getLocalizedString("Visual_DataPoint_Selected")):r.push(this.hostServices.getLocalizedString("Visual_DataPoint_Unselected"))),this.featureSwitches.a11yMatrix||(i=this.getHierarchyLevelInfo(e),r.push(i)),this.featureSwitches.a11yMatrix&&(o={displayNameParts:[],valueParts:[]}),this.hostServices.alertScreenReader(m.PivotTableInteractivityUtils.getScreenReaderMessage(o,r))},r.prototype.onColumnHeaderFocus=function(e){var t,i=m.PivotTableInteractivityUtils.getGroupingDataItems(e,this.valueLabel,!1,this.totalLabel),o=[],r=this.columnHierarchyNavigator.getNodeLeafCount(e);if(this.featureSwitches.a11yMatrix&&1<r&&o.push(this.hostServices.getLocalizedString("SpansXColumns",r)),this.featureSwitches.a11yMatrix&&this.columnHierarchyNavigator.isMultiLevelHierarchy()&&(r=this.getHierarchyLevelInfo(e),o.push(r)),this.featureSwitches.a11yMatrix||(t=(r=this.columnHierarchyNavigator.getItemsByLevel(e.position.row.index)).indexOf(e)+1,r=r.length,o.push(this.hostServices.getLocalizedString("Generic_ListPosition",t,r))),this.featureSwitches.a11yMatrix&&0<this.columnHierarchyNavigator.getLevel(e)&&(t=this.columnHierarchyNavigator.getParent(e).children.length,r=this.columnHierarchyNavigator.getIndex(e)+1,o.push(this.hostServices.getLocalizedString("Generic_ListPosition",r,t))),this.sortingManager.isColumnHeaderSortable(e))switch(this.sortingManager.getColumnHeaderSortDirection(e)){case 1:o.push(this.hostServices.getLocalizedString("Field_Sorted_Ascending"));break;case 2:o.push(this.hostServices.getLocalizedString("Field_Sorted_Descending"));break;default:o.push(this.hostServices.getLocalizedString("Field_Sorting_Possible"))}this.featureSwitches.a11yMatrix&&(i={displayNameParts:[],valueParts:[]}),this.hostServices.alertScreenReader(m.PivotTableInteractivityUtils.getScreenReaderMessage(i,o))},r.prototype.onBodyCellFocus=function(e){this.featureSwitches.a11yMatrix||(e=m.PivotTableInteractivityUtils.getBodyCellInfo(e,this.valueLabel,!1,this.totalLabel),this.hostServices.alertScreenReader(m.PivotTableInteractivityUtils.getScreenReaderMessage(e)))},r.prototype.onHeaderExpansionChange=function(e,t,i){var o=this.selectionManager.createSelectorsByColumn(e),e=this.selectionManager.getHierarchyNodeIndex(e);this.hostServices.setNodeExpansionState({dataRoles:t,data:o,isCollapse:i,nodeIndex:e})},r.prototype.onItemContextMenu=function(e,t,i,o){i.stopPropagation(),i.preventDefault(),this.selectionManager.onItemContextMenu(e,t,i,[o])},r.prototype.onCornerCellClick=function(e,t){this.options.sorting.enabled&&this.sortingManager.isCornerSortable(e)&&this.sortingManager.sortCorner(e)},r.prototype.onCornerCellContextMenu=function(e,t){},r.prototype.onCornerCellFocus=function(e){var t=m.PivotTableInteractivityUtils.getCornerCellParts(e),i=[];if(this.sortingManager.isCornerSortable(e))switch(this.sortingManager.getCornerSortDirection(e)){case 1:i.push(this.hostServices.getLocalizedString("Field_Sorted_Ascending"));break;case 2:i.push(this.hostServices.getLocalizedString("Field_Sorted_Descending"));break;default:i.push(this.hostServices.getLocalizedString("Field_Sorting_Possible"))}this.featureSwitches.a11yMatrix||1<this.rowHierarchyNavigator.getHierarchyDepth()&&i.push(this.hostServices.getLocalizedString("Generic_ListPosition",e.rowLevel+1,this.rowHierarchyNavigator.getHierarchyDepth())),this.featureSwitches.a11yMatrix&&(t={displayNameParts:[],valueParts:[]}),this.hostServices.alertScreenReader(m.PivotTableInteractivityUtils.getScreenReaderMessage(t,i))},r.prototype.onContentActivation=function(e,t){e=e.querySelector("a");e&&e.dispatchEvent(t)},r.prototype.switchRowHeadersLayout=function(e){this.pivotTableControl.setSteppedLayout(e),this.pivotTableControl.setRowNavigator(this.rowHierarchyNavigator),this.binder.setRowNavigator(this.rowHierarchyNavigator)},r.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.featureSwitches.a11yMatrix?setTimeout(this.hostServices.loadMoreData):this.hostServices.loadMoreData(),this.waitingForData=!0,this.hostServices.alertScreenReader(this.hostServices.getLocalizedString("Table_Loading_More_Data")))},r.prototype.needsMoreData=function(e){var t;return!(this.waitingForData||!this.dataView||!this.dataView.metadata||!this.dataView.metadata.segment)&&(t=this.rowHierarchyNavigator.getHierarchyLeafCount()*r.preferredLoadMoreThreshold,this.rowHierarchyNavigator.getLeafIndex(e)>=t)},r.prototype.getFormattingModel=function(){if(this.dataView)return this.tablixPropertyManager.getFormattingModel(this.hostServices,this.formattingProperties,this.dataView,m.controls.TablixType.PivotTable,this.expandCollapseEnabled,this.featureSwitches,this.style)},r.prototype.enumerateObjectInstances=function(e){var r=this,t=new m.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,t,this.dataView,m.controls.TablixType.PivotTable,function(e){for(var t,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return(t=r.hostServices).getLocalizedString.apply(t,__spreadArray([e],i||[],!1))},this.featureSwitches,this.expandCollapseEnabled,this.style),t.complete()},r.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,m.controls.TablixType.PivotTable,this.featureSwitches.conditionalTablixWebURL),e},r.prototype.getHierarchyLevelInfo=function(e){return"".concat(this.hostServices.getLocalizedString("Level")," ").concat(this.rowHierarchyNavigator.getLevel(e)+1)},r.prototype.setExpandCollapseEnabled=function(){this.expandCollapseEnabled=this.hostServices.canExpandCollapse([m.matrixRoleNames.rows])&&"hidden"!==this.options.expandCollapse.buttonsOption},r.preferredLoadMoreThreshold=.8,m.PivotTable=r}(powerbi=powerbi||{}),function(v){var P,a,C,l,s,w,x,y,S,H,T,M;function b(e,t,i,o,r,n){this.selectionManager=t,this.sortingManager=i,this.hostServices=o,this.isA11yMatrix=n,this.binderOptions=e,this.measureElement=P.PivotTableBinderUtils.addMeasureElement(r),this.legacyTooltipsEnabled=!0}P=v.visuals||(v.visuals={}),a=v.visuals.controls.internal.TablixUtils.CellStyle,C=jsCommon.CssConstants,l=v.visuals.controls.internal.TablixUtils.EdgeSettings,s=v.visuals.controls.pivotTable.ElementBuilder,w=jsCommon.StringExtensions.encodeHtml,x=jsCommon.Utility,y=P.Units.FontSize,S=P.controls.pivotTable.TablixSection,H=v.visuals.controls.internal.TablixUtils,T=jsCommon.UrlUtils.UrlScheme,M=jsCommon.UrlUtils,b.prototype.setRowNavigator=function(e){this.rowNavigator=e},b.prototype.setColumnNavigator=function(e){this.columnNavigator=e},b.prototype.getRowHeaderBinding=function(e,t,i,o,r,n,a,l){var s,u,h,d,c,p,g=this,m=(this.binderOptions.onBindRowHeader&&!t&&this.binderOptions.onBindRowHeader(e),e.hierarchyLevel&&e.hierarchyLevel.sources),m=m&&1<m.length,f=w(this.getRowHeaderLabel(e)),y=f,m=(this.formattingProperties.rowHeaders.wordWrap&&(f=P.PivotTableBinderUtils.replaceEncodedNewLines(f)),_.isEmpty(f)&&(f=H.StringNonBreakingSpace),m||(m=this.rowNavigator.getRowHeaderMetadataColumn(e),(b=H.getUrlScheme(m,f))!==T.NONE?(u=w(e.valueFormatted),s=P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.rowHeaders.urlIcon,b),u=P.PivotTableBinderUtils.addHyperlink(f,u,s,function(e,t){return g.binderOptions.onHyperlinkClicked(e,t)})):H.isImage(e,m)&&(b=this.formattingProperties.grid,u=P.PivotTableBinderUtils.buildImage(f,b.imageHeight,b.imageWidth))),u=u?{children:[u],classNames:[],styleProperties:{},attributes:{}}:{content:f,classNames:[],styleProperties:{},attributes:{}},this.getExpandCollapseButtonBinding(e)),b=this.formattingProperties.rowHeaders.steppedLayout,v=(this.isA11yMatrix&&!t&&this.selectionManager.isRowHeaderIndicatorOn(e,b)&&(d=e.position.row.isFirst,c=e.position.row.isLast,p=e.position.column.isFirst,v=e.position.column.isLast,d=this.getBorderInfo(d,c,p,v,!0,S.MatrixRowHeader),c=l&&this.selectionManager.isRowHeaderIndicatorOn(l,b)?"0":d.weightBottom+"px",p={attributes:{},classNames:[],styleProperties:{width:"100%",top:d.weightTop+"px",bottom:c,left:d.weightLeft+"px",position:"absolute","box-sizing":"border-box",overflow:"hidden","pointer-events":"none"},children:[{tagName:"svg",attributes:{"aria-label":this.hostServices.getLocalizedString("Visual_DataPoint_Selected"),height:"100%",width:"100%"},classNames:[],styleProperties:{left:"0",top:"0",position:"absolute"},children:[{tagName:"line",attributes:{x1:"1",y1:"0",x2:"1",y2:"100%",stroke:"white","stroke-width":"2"},classNames:[],styleProperties:{}},{tagName:"line",attributes:{x1:"3",y1:"0",x2:"3",y2:"100%",stroke:"black","stroke-width":"2"},classNames:[],styleProperties:{}}]}]},this.selectionManager.getSelectionMode()===P.PivotTableSelectionMode.RowHeader?p.children[0].attributes["aria-label"]=this.hostServices.getLocalizedString("Visual_DataPoint_Selected"):p.children[0].attributes["aria-hidden"]="true"),m||p?(h={attributes:{},classNames:[],styleProperties:{},children:[u]},m&&(u.classNames.push("expandableContent"),h.classNames.push("expandableCell"),h.children.unshift(m)),p&&h.children.push(p)):h=u,!_.isEmpty(null==f?void 0:f.trim()));return _.assign(h.styleProperties,this.getRowHeaderStyleAttributes(e,t,v)),!this.isA11yMatrix&&this.legacyTooltipsEnabled&&(h.attributes.title=y),this.addRowHeaderClasses(e,!!s,u.classNames,h.classNames),this.isA11yMatrix&&(h.attributes||(h.attributes={}),h.attributes.role="rowheader"),h},b.prototype.getExpandCollapseButtonBinding=function(t){var e,i,o,r,n,a=this,l=this.getRowsExpandCollapseButtonSize(t);if(0!==l)return i=["expandCollapseButton"],void 0===t.isCollapsed?n="":(o=t.isCollapsed?"pbi-glyph-explore-content-single":"pbi-glyph-collapse-content-single",r=t.isCollapsed?this.hostServices.getLocalizedString("FieldListProperty_Collapsed"):this.hostServices.getLocalizedString("FieldListProperty_Expanded"),n='<i role="button" aria-label="'.concat(r,'" class="glyphicon ').concat(o,'"></i>'),this.isExpandCollapseEnabled?(i.push("clickable"),e=function(e){a.binderOptions.onRowHeaderExpansionChange(t,!t.isCollapsed),e.stopPropagation()}):i.push("disabled")),{content:n,classNames:i,styleProperties:{width:l+H.UnitOfMeasurement,height:l+H.UnitOfMeasurement,color:this.formattingProperties.rowHeaders.expandCollapseButtonsColor,"font-size":this.expandCollapseButtonFontInfo.fontProperties.size.px+H.UnitOfMeasurement},attributes:{},clickHandler:e}},b.prototype.getRowsExpandCollapseButtonSize=function(e){return this.formattingProperties.rowHeaders.showExpandCollapseButtons&&e.hierarchyLevel&&(e.hierarchyLevel.canBeExpanded||e.level&&this.formattingProperties.rowHeaders.steppedLayout)?this.expandCollapseButtonFontInfo.measuredFontHeight:0},b.prototype.getColumnHeaderBinding=function(e,t,i,o,r){var n,a=w(this.getColumnHeaderLabel(e)),l={},s=(l.hierarchyIndices=this.columnNavigator.getPathIndices(e).toString(),!this.isA11yMatrix&&this.legacyTooltipsEnabled&&(l.title=a),this.formattingProperties.columnHeaders.wordWrap&&(a=P.PivotTableBinderUtils.replaceEncodedNewLines(a)),_.isEmpty(a)&&(a=H.StringNonBreakingSpace),!_.isEmpty(null==a?void 0:a.trim())),s=this.getColumnHeaderStyle(e,this.getColumnHeaderFontInfo(e),t,s),u=s.getExtraBottom(),h=(e.position.row.isLast&&(s.paddings.bottom+=P.PivotTableBinderUtils.getSortIconHeight(this.glyphFontInfo.measuredFontHeight)),this.columnNavigator.getColumnHeaderMetadataColumn(e)),d=H.getUrlScheme(h,a),c={tagName:null,content:a,attributes:{},classNames:[],styleProperties:{}},p=(d!==T.NONE?(p=w(e.valueFormatted),n=P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.columnHeaders.urlIcon,d),c=P.PivotTableBinderUtils.addHyperlink(c,p,n,this.binderOptions.onHyperlinkClicked)):H.isImage(e,h)&&(d=this.formattingProperties.grid,c=P.PivotTableBinderUtils.buildImage(a,d.imageHeight,d.imageWidth)),{tagName:"div",children:[c],classNames:this.getColumnHeaderClasses(e,!!n),styleProperties:this.getColumnHeaderStyleAttributes(e,s),attributes:l});return e.position.row.isLast&&(a=this.binderOptions.sortingEnabled&&this.sortingManager.isColumnHeaderSortable(e),d=this.sortingManager.getColumnHeaderSortDirection(e),c=P.PivotTableBinderUtils.buildSortIcon(d,this.binderOptions.sortIconEnabled,a,P.PivotTableSortingManager.getNextSortDirection(d,h),u,this.glyphFontInfo.textProperties.fontSize),p.children.push(c)),this.isA11yMatrix&&!t&&this.selectionManager.isColumnHeaderIndicatorOn(e)&&(n=e.position.row.isFirst,s=e.position.row.isLast,l=e.position.column.isLast,a=this.getBorderInfo(n,s,!1,l,!0,S.Header),d=r&&this.selectionManager.isColumnHeaderIndicatorOn(r)?"0":a.weightRight+"px",h={attributes:{},classNames:[],styleProperties:{height:"5px",left:a.weightLeft+"px",right:d,bottom:a.weightBottom+"px",position:"absolute","box-sizing":"border-box",overflow:"hidden","pointer-events":"none"},children:[{tagName:"svg",attributes:{"aria-label":this.hostServices.getLocalizedString("Visual_DataPoint_Selected"),height:"100%",width:"100%"},classNames:[],styleProperties:{left:"0",top:"0",position:"absolute"},children:[{tagName:"line",attributes:{x1:"0",y1:"2",x2:"100%",y2:"2",stroke:"black","stroke-width":"2"},classNames:[],styleProperties:{}},{tagName:"line",attributes:{x1:"0",y1:"4",x2:"100%",y2:"4",stroke:"white","stroke-width":"2"},classNames:[],styleProperties:{}}]}]},this.selectionManager.getSelectionMode()===P.PivotTableSelectionMode.ColumnHeader?h.children[0].attributes["aria-label"]=this.hostServices.getLocalizedString("Visual_DataPoint_Selected"):h.children[0].attributes["aria-hidden"]="true",p.children.push(h)),p},b.prototype.getHorizontalBorderBindings=function(e,t,i,o,r,n,a,l){var s,u=r!==S.Body||this.selectionManager.isBodyCellHighlighted(e),l=this.setHorizontalBorderXPositions(l,r),h=l[0],l=l[1],u=this.getBorderInfo(e.position.row.isFirst,e.position.row.isLast,e.position.column.isFirst,e.position.column.isLast,u,r);0<u.weightTop&&(s=i+u.weightTop/2,r={tagName:"line",attributes:{"border-row-index":e.position.row.index.toString(),x1:h,y1:s.toString(),x2:l,y2:s.toString()},classNames:["border-top"],styleProperties:{stroke:u.colorTop,"stroke-width":u.weightTop.toString()}},(u.typeTop===H.EdgeType.Gridline?n:a).push(r)),0<u.weightBottom&&(s=i+o-u.weightBottom/2,r={tagName:"line",attributes:{"border-row-index":e.position.row.index.toString(),x1:h,y1:s.toString(),x2:l,y2:s.toString()},classNames:["border-bottom"],styleProperties:{stroke:u.colorBottom,"stroke-width":u.weightBottom.toString()}},(u.typeBottom===H.EdgeType.Gridline?n:a).push(r))},b.prototype.getTablixBorderBindings=function(e,t){var i,t=this.getSectionProperties(t);return this.shouldRenderOutline(e,t)?(i=null!=(i=t.outlineWeight)?i:this.formattingProperties.grid.outlineWeight,t=null!=(t=t.outlineColor)?t:this.formattingProperties.grid.outlineColor,this.createTablixBorderBinding(e,t,i,"border-outline")):this.shouldRenderGridline(e)?(t="vertical"===e.orientation?this.formattingProperties.grid.gridVerticalWeight:this.formattingProperties.grid.gridHorizontalWeight,i="vertical"===e.orientation?null==(i=this.formattingProperties.grid)?void 0:i.gridVerticalColor:null==(i=this.formattingProperties.grid)?void 0:i.gridHorizontalColor,this.createTablixBorderBinding(e,i,t,"border-gridline")):void 0},b.prototype.createTablixBorderBinding=function(e,t,i,o){this.calculateBorderPositionsWithOffset(e,i);o={tagName:"line",attributes:{x1:e.x1.toString(),y1:e.y1.toString(),x2:e.x2.toString(),y2:e.y2.toString()},classNames:[o],styleProperties:{stroke:t,"stroke-width":i.toString()}};return this.setBorderRowOrColumnIndex(o,e),o},b.prototype.calculateBorderPositionsWithOffset=function(e,t){if(e.outline)switch(e.outline){case 1:e.y1=e.y2=e.y1+t/2;break;case 4:e.y1=e.y2=e.y1-t/2;break;case 8:e.x1=e.x2=e.x1+t/2;break;case 2:e.x1=e.x2=e.x1-t/2}else switch(e.orientation){case"horizontal":e.y1=e.y2=e.y1-t/2;break;case"vertical":e.x1=e.x2=e.x1-t/2}},b.prototype.setBorderRowOrColumnIndex=function(e,t){void 0!==t.borderRowIndex&&(e.attributes["border-row-index"]=t.borderRowIndex.toString()),void 0!==t.borderColumnIndex&&(e.attributes["border-column-index"]=t.borderColumnIndex.toString())},b.prototype.shouldRenderGridline=function(e){return!e.outline&&this.formattingProperties.grid&&(this.formattingProperties.grid.gridHorizontal&&"horizontal"===e.orientation||this.formattingProperties.grid.gridVertical&&"vertical"===e.orientation)},b.prototype.shouldRenderOutline=function(e,t){return e.outline&&(4===e.outline&&P.outline.showBottom(t.outline)||1===e.outline&&P.outline.showTop(t.outline)||8===e.outline&&P.outline.showLeft(t.outline)||2===e.outline&&P.outline.showRight(t.outline))},b.prototype.getVerticalBorderBindings=function(e,t,i,o,r,n,a,l,s){var u,h=r!==S.Body||this.selectionManager.isBodyCellHighlighted(e),l=this.setVerticalBorderYPositions(l,r),d=l[0],l=l[1],h=this.getBorderInfo(e.position.row.isFirst,e.position.row.isLast,e.position.column.isFirst,e.position.column.isLast,h,r);0<h.weightLeft&&(u=i+h.weightLeft/2+0,r={tagName:"line",attributes:{"border-column-index":e.position.column.index.toString(),x1:u.toString(),y1:d,x2:u.toString(),y2:l},classNames:["border-left"],styleProperties:{stroke:h.colorLeft,"stroke-width":h.weightLeft.toString()}},(h.typeLeft===H.EdgeType.Gridline?n:a).push(r)),0<h.weightRight&&(u=i+o-h.weightRight/2,r={tagName:"line",attributes:{"border-column-index":e.position.column.index.toString(),x1:u.toString(),y1:d,x2:u.toString(),y2:l},classNames:["border-right"],styleProperties:{stroke:h.colorRight,"stroke-width":h.weightRight.toString()}},(h.typeRight===H.EdgeType.Gridline?n:a).push(r))},b.prototype.getBodyCellBinding=function(e,t,i,o,r,n,a){var l,s,u,h,d,c=w(this.getBodyCellContent(e)),p=(!this.isA11yMatrix&&this.legacyTooltipsEnabled&&(l={title:c}),!_.isEmpty(null==c?void 0:c.trim())),g=this.getBodyCellStyle(e,this.getBodyCellFontInfo(e),t,p),p=(this.formattingProperties.values.underline&&p&&(g.textDecoration=C.underlineValue),e.columnMetadata),m=p&&this.columnsDataBarsSettings[p.queryName],f=m&&!e.isTotal&&!e.hasSubtotalStyle&&_.isNumber(e.dataPoint),p=p&&this.formattingProperties.columnFormatting[p.queryName],p=v.StructuralObjectValue.merge(p&&p.icon,e.icon),y=e.hyperlink,b=(p&&"IconOnly"===p.layout?c="":(_.isEmpty(c)&&(c=H.StringNonBreakingSpace),e.isKpi?(c=P.PivotTableBinderUtils.createKpiDomString(e.columnMetadata.kpi,e.textContent),l=null):f&&m.hideText?c=t?H.StringNonBreakingSpace:"":(this.formattingProperties.values.wordWrap&&(c=P.PivotTableBinderUtils.replaceEncodedNewLines(c)),(b=H.getUrlScheme(e.columnMetadata,c))!==T.NONE?(s=P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,b),u=P.PivotTableBinderUtils.addHyperlink(c,w(e.textContent),s,this.binderOptions.onHyperlinkClicked),y=void 0):this.isImage(e)?(b=x.encodeUriForImageDataSvg(e.textContent),h=this.formattingProperties.grid,u=P.PivotTableBinderUtils.buildImage(b,h.imageHeight,h.imageWidth)):this.isSparkline(e)&&(c=t?H.StringNonBreakingSpace:""))),{tagName:"div",classNames:[],styleProperties:{},attributes:{}});return(u=this.binderOptions.hyperlinksEnabled&&(u||""!==c&&c!==H.StringNonBreakingSpace)&&y&&M.getUrlScheme(y)!==T.NONE?P.PivotTableBinderUtils.addHyperlink(u||c,w(y),null,this.binderOptions.onHyperlinkClicked,!0,!0):u)?b.children=[u]:b.content=c,u=b,p&&(d=this.getBodyCellFontInfo(e).measuredFontHeight,b=P.PivotTableBinderUtils.addIconToCell(p,d,u,this.hostServices)),f&&!t&&(b=P.PivotTableBinderUtils.addDataBarsToCell(b,m,g,e.dataPoint,this.hostServices)),!t&&this.isSparkline(e)&&(h=e.dataPoint,b=P.PivotTableBinderUtils.addSparklineToCell(b,this.sparklineSettings[e.columnMetadata.queryName],g,h,i,o,p,d)),this.isA11yMatrix&&(e.fontColor||e.backColor)&&(y=this.hostServices.getLocalizedString(H.AdditionalConditionalFormatting),_.isEmpty(b.children)?b={attributes:{},classNames:[],styleProperties:{},children:[b,{attributes:{},classNames:["visually-hidden"],styleProperties:{},content:y}]}:b.children.push({attributes:{},classNames:["visually-hidden"],styleProperties:{},content:y})),this.isA11yMatrix&&!t&&this.selectionManager.isBodyCellIndicatorOn(e)&&(c=this.formattingProperties.rowHeaders.steppedLayout,f=e.position.row.isFirst,m=e.position.row.isLast&&(!c||!this.formattingProperties.general.rowSubtotals)||c&&e.isRowGrandTotal,h=e.position.column.isFirst,i=e.position.column.isLast,o=this.getBorderInfo(f,m,h,i,!0,S.Body),p=a&&this.selectionManager.isBodyCellIndicatorOn(a)?"0":o.weightBottom+"px",d={attributes:{},classNames:[],styleProperties:{width:"100%",top:o.weightTop+"px",bottom:p,left:o.weightLeft+"px",position:"absolute","box-sizing":"border-box",overflow:"hidden","pointer-events":"none"},children:[{tagName:"svg",attributes:{"aria-label":this.hostServices.getLocalizedString("Visual_DataPoint_Selected"),height:"100%",width:"100%"},classNames:[],styleProperties:{left:"0",top:"0",position:"absolute"},children:[{tagName:"line",attributes:{x1:"1",y1:"0",x2:"1",y2:"100%",stroke:"white","stroke-width":"2"},classNames:[],styleProperties:{}},{tagName:"line",attributes:{x1:"3",y1:"0",x2:"3",y2:"100%",stroke:"black","stroke-width":"2"},classNames:[],styleProperties:{}}]}]},b.content?b={attributes:{},classNames:[],styleProperties:{},children:[b,d]}:(b.children||(b.children=[]),b.children.push(d))),this.addBodyCellClasses(e,!!s,u.classNames,b.classNames),this.addBodyCellStyleAttributes(e,g,u.styleProperties,b.styleProperties),b.attributes=l,b},b.prototype.getCornerCellBinding=function(e,t){var i,o=w(this.getCornerCellLabel(e)),r={},n=(r.columnLevel=this.rowNavigator.getColumnLevel(e).toString(),r.rowLevel=this.rowNavigator.getRowLevel(e).toString(),!this.isA11yMatrix&&this.legacyTooltipsEnabled&&(r.title=o),this.formattingProperties.columnHeaders.wordWrap&&(o=P.PivotTableBinderUtils.replaceEncodedNewLines(o)),_.isEmpty(o)&&(o=H.StringNonBreakingSpace),!_.isEmpty(null==o?void 0:o.trim())),t=this.getCornerCellStyle(e,this.getCornerCellFontInfo(),t,n);return e.position.row.isLast&&(n=this.binderOptions.sortingEnabled&&this.sortingManager.isCornerSortable(e),i=this.sortingManager.getCornerSortDirection(e),n=P.PivotTableBinderUtils.buildSortIcon(i,this.binderOptions.sortIconEnabled,n,null==i?1:i,t.getExtraBottom(),this.glyphFontInfo.textProperties.fontSize),o+=s.build(n),t.paddings.bottom+=P.PivotTableBinderUtils.getSortIconHeight(this.glyphFontInfo.measuredFontHeight)),{content:o,classNames:this.getCornerCellClasses(e),styleProperties:t.getAttributes(!1,this.isA11yMatrix,this.isA11yMatrix),attributes:r}},b.prototype.getApproximateRowHeaderWidth=function(e){var t=this.rowNavigator.getRowHeaderMetadataColumn(e),i=this.getRowHeaderLabel(e),o=H.getUrlScheme(t,i),r=this.rowHeaderFontInfo.fontProperties.size.px,r=(i=o!==T.NONE&&P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.rowHeaders.urlIcon,o)?r:H.isImage(e,t)?this.formattingProperties.grid.imageWidth:(o=this.getRowHeaderFontInfo(e),r=this.getRowHeaderStyle(e,o,!0,!0),P.PivotTableBinderUtils.measureText(i,o.textProperties)+(null!=(i=null==(t=r.borders.left)?void 0:t.weight)?i:0)+(null!=(t=null==(o=r.borders.right)?void 0:o.weight)?t:0)),this.getRowsExpandCollapseButtonSize(e));return 0<r&&(i+=r+P.PivotTableBinderUtils.ExpandCollapseRightMargin),i},b.prototype.getApproximateColumnHeaderWidth=function(e){var t=this.columnNavigator.getColumnHeaderMetadataColumn(e),i=this.getColumnHeaderLabel(e),o=H.getUrlScheme(t,i);return o!==T.NONE&&P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.columnHeaders.urlIcon,o)?this.columnHeaderFontInfo.fontProperties.size.px:H.isImage(e,t)?this.formattingProperties.grid.imageWidth:(o=this.getColumnHeaderFontInfo(e),t=this.getColumnHeaderStyle(e,o,!0,!0),P.PivotTableBinderUtils.measureText(i,o.textProperties)+(null!=(i=null==(e=t.borders.left)?void 0:e.weight)?i:0)+(null!=(e=null==(o=t.borders.right)?void 0:o.weight)?e:0))},b.prototype.getApproximateBodyCellWidth=function(e){var t,i,o=0;if(e.icon){if(o=this.getBodyCellFontInfo(e).measuredFontHeight,"IconOnly"===e.icon.layout)return o;o+=P.PivotTableBinderUtils.TablixIconMargin}return e.isKpi?o+this.valueFontInfo.fontProperties.size.px:(t=e.columnMetadata&&this.columnsDataBarsSettings[e.columnMetadata.queryName])&&t.hideText&&!e.isTotal&&_.isNumber(e.dataPoint)?o:(t=this.getBodyCellContent(e),this.isUrlIcon(e,t)?o+this.valueFontInfo.fontProperties.size.px:this.isImage(e)?o+this.formattingProperties.grid.imageWidth:this.isSparkline(e)?o:(i=this.getBodyCellFontInfo(e),e=this.getBodyCellStyle(e,i,!0,!0),o+P.PivotTableBinderUtils.measureText(t,i.textProperties)+(null!=(t=null==(o=e.borders.left)?void 0:o.weight)?t:0)+(null!=(o=null==(i=e.borders.right)?void 0:i.weight)?o:0)))},b.prototype.getApproximateCornerCellWidth=function(e){var t=this.getCornerCellFontInfo(),i=this.getCornerCellStyle(e,t,!0,!0);return P.PivotTableBinderUtils.measureText(this.getCornerCellLabel(e),t.textProperties)+(null!=(t=null==(e=i.borders.left)?void 0:e.weight)?t:0)+(null!=(t=null==(e=i.borders.right)?void 0:e.weight)?t:0)},b.prototype.getApproximateRowHeaderHeight=function(e,t){var i,o=this.rowNavigator.getRowHeaderMetadataColumn(e),r=this.getRowHeaderLabel(e),n=H.getUrlScheme(o,r),a=this.getRowsExpandCollapseButtonSize(e);return i=n!==T.NONE&&P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.rowHeaders.urlIcon,n)?this.rowHeaderFontInfo.fontProperties.size.px:H.isImage(e,o)?this.formattingProperties.grid.imageHeight:(n=void 0,o=this.getRowHeaderFontInfo(e),t-=this.getRowsExpandCollapseButtonSize(e),i=this.getRowHeaderStyle(e,o,!0,!0),n=this.formattingProperties.rowHeaders.wordWrap?P.PivotTableBinderUtils.getWordWrappingLines(r,P.PivotTableBinderUtils.getNetWidth(t,i),o.textProperties).length:1,r=null!=(t=null==(r=i.borders.top)?void 0:r.weight)?t:0,t=null!=(i=null==(t=i.borders.bottom)?void 0:t.weight)?i:0,o.measuredFontHeight*n+r+t),void 0===e.isCollapsed?i:Math.max(a,i)},b.prototype.getApproximateColumnHeaderHeight=function(e,t){var i=this.columnNavigator.getColumnHeaderMetadataColumn(e),o=this.getColumnHeaderLabel(e),r=H.getUrlScheme(i,o);return r!==T.NONE&&P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.columnHeaders.urlIcon,r)?this.columnHeaderFontInfo.fontProperties.size.px:H.isImage(e,i)?this.formattingProperties.grid.imageHeight:(r=this.getColumnHeaderFontInfo(e),i=this.getColumnHeaderStyle(e,r,!0,!0),e=this.formattingProperties.columnHeaders.wordWrap?P.PivotTableBinderUtils.getWordWrappingLines(o,P.PivotTableBinderUtils.getNetWidth(t,i),r.textProperties).length:1,o=null!=(t=null==(o=i.borders.top)?void 0:o.weight)?t:0,t=null!=(i=null==(t=i.borders.bottom)?void 0:t.weight)?i:0,r.measuredFontHeight*e+o+t)},b.prototype.getApproximateBodyCellHeight=function(e,t){var i,o,r=this.getBodyCellFontInfo(e);return e.icon&&"IconOnly"===e.icon.layout?r.measuredFontHeight:e.isKpi||(o=this.getBodyCellContent(e),this.isUrlIcon(e,o))?this.valueFontInfo.fontProperties.size.px:this.isImage(e)?this.formattingProperties.grid.imageHeight:this.isSparkline(e)?r.measuredFontHeight:(i=this.getBodyCellStyle(e,r,!0,!0),e=this.formattingProperties.values.wordWrap&&null!=t?(e.icon&&(t-=r.measuredFontHeight+P.PivotTableBinderUtils.TablixIconMargin),P.PivotTableBinderUtils.getWordWrappingLines(o,P.PivotTableBinderUtils.getNetWidth(t,i),r.textProperties).length):1,o=null!=(t=null==(o=i.borders.top)?void 0:o.weight)?t:0,t=null!=(i=null==(t=i.borders.bottom)?void 0:t.weight)?i:0,r.measuredFontHeight*e+o+t)},b.prototype.getApproximateCornerCellHeight=function(e,t){var i=this.getCornerCellFontInfo(),o=this.getCornerCellStyle(e,i,!0,!0),e=this.formattingProperties.columnHeaders.wordWrap?P.PivotTableBinderUtils.getWordWrappingLines(this.getCornerCellLabel(e),P.PivotTableBinderUtils.getNetWidth(t,o),i.textProperties).length:1,t=null!=(t=null==(t=o.borders.top)?void 0:t.weight)?t:0,o=null!=(o=null==(o=o.borders.bottom)?void 0:o.weight)?o:0;return i.measuredFontHeight*e+t+o},b.prototype.getSectionProperties=function(e){var t;switch(e){case S.Header:t=this.formattingProperties.columnHeaders;break;case S.Body:t=this.formattingProperties.values;break;case S.MatrixRowHeader:t=this.formattingProperties.rowHeaders}return t},b.prototype.getBorderInfo=function(e,t,i,o,r,n){var a,l,s,u,h,d,c,p,g=0,m=0,f=0,y=0,n=this.getSectionProperties(n),b=null!=(b=n.outlineWeight)?b:this.formattingProperties.grid.outlineWeight,v=null!=(v=n.outlineColor)?v:this.formattingProperties.grid.outlineColor,C=null==(C=this.formattingProperties.grid)?void 0:C.gridHorizontalColor,w=null==(w=this.formattingProperties.grid)?void 0:w.gridVerticalColor,x=jsCommon.Color.hexBlend("#FFFFFF",.7,C),S=jsCommon.Color.hexBlend("#FFFFFF",.7,w);return e&&P.outline.showTop(n.outline)&&(g=b,a=H.EdgeType.Outline,h=v),o&&P.outline.showRight(n.outline)?(m=b,l=H.EdgeType.Outline,d=v):!o&&this.formattingProperties.grid.gridVertical&&(m=this.formattingProperties.grid.gridVerticalWeight,l=H.EdgeType.Gridline,d=this.selectionManager.isSelectionEmpty()?w:S),t&&P.outline.showBottom(n.outline)?(f=b,s=H.EdgeType.Outline,c=v):!t&&this.formattingProperties.grid.gridHorizontal&&(f=this.formattingProperties.grid.gridHorizontalWeight,s=H.EdgeType.Gridline,c=r?C:x),i&&P.outline.showLeft(n.outline)&&(y=b,u=H.EdgeType.Outline,p=v),{weightTop:g,weightRight:m,weightBottom:f,weightLeft:y,typeTop:a,typeRight:l,typeBottom:s,typeLeft:u,colorTop:h,colorRight:d,colorBottom:c,colorLeft:p}},b.prototype.isUrlIcon=function(e,t){e=H.getUrlScheme(e.columnMetadata,t);return e!==T.NONE&&!!P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,e)},b.prototype.getColumnHeaderFontInfo=function(e){return P.MatrixHierarchyNavigator.isNodeGrandTotal(e)?this.grandTotalColumnHeaderFontInfo:e.hasSubtotalStyle?this.subtotalColumnHeaderFontInfo:this.columnHeaderFontInfo},b.prototype.getRowHeaderFontInfo=function(e){return P.MatrixHierarchyNavigator.isNodeGrandTotal(e)?this.grandTotalRowHeaderFontInfo:e.hasSubtotalStyle?this.subtotalRowHeaderFontInfo:this.rowHeaderFontInfo},b.prototype.getBodyCellFontInfo=function(e){return e.isColumnGrandTotal?this.columnGrandTotalFontInfo:e.isRowGrandTotal?this.rowGrandTotalFontInfo:e.isColumnSubTotal?this.columnSubtotalFontInfo:e.isRowSubTotal||e.hasSubtotalStyle?this.rowSubtotalFontInfo:this.valueFontInfo},b.prototype.getCornerCellFontInfo=function(){return this.columnHeaderFontInfo},b.prototype.addRowHeaderClasses=function(e,t,i,o){var r,n=this.formattingProperties.rowHeaders;n.wordWrap?i.push(P.PivotTableBinderUtils.cssPivotTableCellClassWrap):i.push(P.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),t&&i.push(H.CssClassValueURLIconContainer),this.binderOptions.interactivityIndicatorEnabled&&this.binderOptions.selectionEnabled&&P.PivotTableSelectionManager.hasIdentity(e)&&o.push(P.PivotTableBinderUtils.cssClassCellInteractive),t&&(r=P.textAlignment.center),P.PivotTableBinderUtils.addAlignmentCssClass(n.alignment,i,r),this.isA11yMatrix&&(t=this.formattingProperties.rowHeaders.steppedLayout,this.selectionManager.isRowHeaderHighlighted(e)?(this.selectionManager.isRowHeaderIndicatorOn(e,t)||this.selectionManager.isRowHeaderDarkened(e))&&o.push("cell-selected"):o.push("cell-unselected"))},b.prototype.getColumnHeaderClasses=function(e,t){var i,o=[],r=this.formattingProperties.columnHeaders,n=this.formattingProperties.columnFormatting[e.queryName],a=(this.formattingProperties.columnHeaders.wordWrap?o.push(P.PivotTableBinderUtils.cssPivotTableCellClassWrap):o.push(P.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),t&&o.push(H.CssClassValueURLIconContainer),P.PivotTableSelectionManager.hasIdentity(e)),l=this.sortingManager.isColumnHeaderSortable(e),l=(this.binderOptions.interactivityIndicatorEnabled&&(this.binderOptions.selectionEnabled&&a&&!l||this.binderOptions.sortingEnabled&&l&&!a)&&o.push(P.PivotTableBinderUtils.cssClassCellInteractive),n&&n.styleHeader&&n.alignment||r.alignment);return t&&(i=P.textAlignment.center),P.PivotTableBinderUtils.addAlignmentCssClass(l,o,i),this.isA11yMatrix&&(this.selectionManager.isColumnHeaderHighlighted(e)?(this.selectionManager.isColumnHeaderIndicatorOn(e)||this.selectionManager.isColumnHeaderDarkened(e))&&o.push("cell-selected"):o.push("cell-unselected")),o},b.prototype.addBodyCellClasses=function(e,t,i,o){this.formattingProperties.values.wordWrap?i.push(P.PivotTableBinderUtils.cssPivotTableCellClassWrap):i.push(P.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),t&&i.push(H.CssClassValueURLIconContainer),!this.binderOptions.interactivityIndicatorEnabled||!this.binderOptions.selectionEnabled||e.isColumnGrandTotal&&e.isRowGrandTotal||o.push(P.PivotTableBinderUtils.cssClassCellInteractive);var r,n,a=e.columnMetadata&&e.columnMetadata.queryName,a=this.formattingProperties.columnFormatting[a];a&&(e.isGrandTotal?a.styleTotal:e.hasSubtotalStyle?a.styleSubTotals:a.styleValues)&&(r=a.alignment),t?n=P.textAlignment.center:!e.isKpi&&e.isNumeric&&(n=P.textAlignment.right),P.PivotTableBinderUtils.addAlignmentCssClass(r,i,n),this.isA11yMatrix&&(this.selectionManager.isBodyCellHighlighted(e)?!this.selectionManager.isSelectionEmpty()&&this.selectionManager.isBodyCellHighlighted(e)&&o.push("cell-selected"):o.push("cell-unselected"))},b.prototype.getCornerCellClasses=function(e){var t=[],e=(this.formattingProperties.columnHeaders.wordWrap?t.push(P.PivotTableBinderUtils.cssPivotTableCellClassWrap):t.push(P.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),this.binderOptions.interactivityIndicatorEnabled&&this.binderOptions.sortingEnabled&&this.sortingManager.isCornerSortable(e)&&t.push(P.PivotTableBinderUtils.cssClassCellInteractive),this.formattingProperties.columnHeaders.titleAlignment);return e===P.textAlignment.auto&&(e=this.formattingProperties.columnHeaders.alignment),P.PivotTableBinderUtils.addAlignmentCssClass(e,t),t},b.prototype.getSteppedLayoutIndentation=function(e){return this.rowNavigator.getLevel(e)*this.formattingProperties.rowHeaders.steppedLayoutIndentation},b.prototype.getRowHeaderStyle=function(e,t,i,o){var r=new a(P.PivotTableBinderUtils.CellHorizontalPadding,P.PivotTableBinderUtils.CellHorizontalPadding),n=(this.formattingProperties.rowHeaders.underline&&o&&(r.textDecoration=C.underlineValue),e.position.column.isLast&&(n=this.binderOptions.tablixProperties,r.borders.right=new l(P.TablixProperties.PropGridOutlineWeight.defaultValue,n.PropGridOutlineColor.getValue(null))),r.fontColor=H.FontColorHeaders,P.MatrixStyler.setRowHeaderStyle(e.position,e,r,this.formattingProperties.rowHeaders.steppedLayout,this.formattingProperties,this.formattingProperties.values.bandedRowHeaders),this.isA11yMatrix&&P.PivotTableBinderUtils.applyFontInfo(this.rowHeaderContainerFontInfo,r,!i,o),P.PivotTableBinderUtils.applyFontInfo(t,r,!i,o),this.formattingProperties.columnFormatting[e.queryName]),t=n&&n.styleHeader,i=P.MatrixHierarchyNavigator.isNodeGrandTotal(e)&&this.formattingProperties.rowGrandTotal.applyToHeaders,o=e.hasSubtotalStyle&&this.formattingProperties.rowSubtotals.applyToHeaders;return t&&n.fontColor?r.fontColor=n.fontColor:i&&this.formattingProperties.rowGrandTotal.fontColor?r.fontColor=this.formattingProperties.rowGrandTotal.fontColor:o&&this.formattingProperties.rowSubtotals.fontColor&&(r.fontColor=this.formattingProperties.rowSubtotals.fontColor),t&&n.backColor?r.backColor=n.backColor:i&&this.formattingProperties.rowGrandTotal.backColor?r.backColor=this.formattingProperties.rowGrandTotal.backColor:o&&this.formattingProperties.rowSubtotals.backColor&&(r.backColor=this.formattingProperties.rowSubtotals.backColor),this.formattingProperties.rowHeaders.steppedLayout&&(r.paddings.left+=this.getSteppedLayoutIndentation(e)),r},b.prototype.getRowHeaderStyleAttributes=function(e,t,i){t=this.getRowHeaderStyle(e,this.getRowHeaderFontInfo(e),t,i).getAttributes(!1,this.isA11yMatrix,this.isA11yMatrix);return this.isA11yMatrix||this.selectionManager.isRowHeaderHighlighted(e)||P.PivotTableBinderUtils.setUnselectedStyle(t),t},b.prototype.getColumnHeaderStyle=function(e,t,i,o){var r=new a(P.PivotTableBinderUtils.CellHorizontalPadding,P.PivotTableBinderUtils.CellHorizontalPadding),n=(e.position.row.isLast&&(n=this.binderOptions.tablixProperties,r.borders.bottom=new l(P.TablixProperties.PropGridOutlineWeight.defaultValue,n.PropGridOutlineColor.getValue(null))),r.fontColor=H.FontColorHeaders,P.MatrixStyler.setColumnHeaderStyle(e.position,e,r,this.formattingProperties),this.isA11yMatrix&&P.PivotTableBinderUtils.applyFontInfo(this.columnHeaderContainerFontInfo,r,!i,o),P.PivotTableBinderUtils.applyFontInfo(t,r,!i,o),this.formattingProperties.columnFormatting[e.queryName]),t=n&&n.styleHeader,i=P.MatrixHierarchyNavigator.isNodeGrandTotal(e)&&this.formattingProperties.columnGrandTotal.applyToHeaders,e=e.hasSubtotalStyle&&this.formattingProperties.columnSubtotals.applyToHeaders;return t&&n.fontColor?r.fontColor=n.fontColor:i&&this.formattingProperties.columnGrandTotal.fontColor?r.fontColor=this.formattingProperties.columnGrandTotal.fontColor:e&&this.formattingProperties.columnSubtotals.fontColor&&(r.fontColor=this.formattingProperties.columnSubtotals.fontColor),t&&n.backColor?r.backColor=n.backColor:i&&this.formattingProperties.columnGrandTotal.backColor?r.backColor=this.formattingProperties.columnGrandTotal.backColor:e&&this.formattingProperties.columnSubtotals.backColor&&(r.backColor=this.formattingProperties.columnSubtotals.backColor),this.formattingProperties.columnHeaders.underline&&o&&(r.textDecoration=C.underlineValue),r},b.prototype.getColumnHeaderStyleAttributes=function(e,t){t=t.getAttributes(!1,this.isA11yMatrix,this.isA11yMatrix);return this.isA11yMatrix||this.selectionManager.isColumnHeaderHighlighted(e)||P.PivotTableBinderUtils.setUnselectedStyle(t),t},b.prototype.getBodyCellStyle=function(e,t,i,o){var r=new a(P.PivotTableBinderUtils.CellHorizontalPadding,P.PivotTableBinderUtils.CellHorizontalPadding);return P.MatrixStyler.setBodyCellStyle(e.position,e,r,this.formattingProperties.rowHeaders.steppedLayout,this.formattingProperties),this.isA11yMatrix&&P.PivotTableBinderUtils.applyFontInfo(this.valueContainerFontInfo,r,!i,o),P.PivotTableBinderUtils.applyFontInfo(t,r,!i,o),r},b.prototype.addBodyCellStyleAttributes=function(e,t,i,o){t.setAttributes(o,!1,this.isA11yMatrix,this.isA11yMatrix),o.position="relative",this.isA11yMatrix||this.selectionManager.isBodyCellHighlighted(e)||P.PivotTableBinderUtils.setUnselectedStyle(o)},b.prototype.getCornerCellStyle=function(e,t,i,o){var r,n=new a(P.PivotTableBinderUtils.CellHorizontalPadding,P.PivotTableBinderUtils.CellHorizontalPadding);return n.fontColor=H.FontColorHeaders,this.formattingProperties.columnHeaders.underline&&o&&(n.textDecoration=C.underlineValue),e.position.row.isLast&&(r=this.binderOptions.tablixProperties,n.borders.bottom=new l(P.TablixProperties.PropGridOutlineWeight.defaultValue,r.PropGridOutlineColor.getValue(null))),P.MatrixStyler.setCornerCellStyle(e.position,n,this.formattingProperties.rowHeaders.steppedLayout,this.formattingProperties),this.isA11yMatrix&&P.PivotTableBinderUtils.applyFontInfo(this.columnHeaderContainerFontInfo,n,!i,o),P.PivotTableBinderUtils.applyFontInfo(t,n,!i,o),n},b.prototype.getColumnHeaderLabel=function(e){return this.getHeaderContent(e,this.columnNavigator.getColumnHeaderMetadataColumn(e),this.columnNavigator.isColumnHeaderMultiValueSubtotal(e),this.formattingProperties.columnHeaders.wordWrap)},b.prototype.getRowHeaderLabel=function(e){return this.getHeaderContent(e,this.rowNavigator.getRowHeaderMetadataColumn(e),this.rowNavigator.isRowHeaderMultiValueSubtotal(e),this.formattingProperties.rowHeaders.wordWrap)},b.prototype.getBodyCellContent=function(e){return this.formattingProperties.values.wordWrap?e.textContent:P.TextUtil.replaceSpaceWithNBSP(e.textContent)},b.prototype.getCornerCellLabel=function(e){return this.formattingProperties.columnHeaders.wordWrap?e.displayName:P.TextUtil.replaceSpaceWithNBSP(e.displayName)},b.prototype.getHeaderContent=function(e,t,i,o){return e.isSubtotal&&!i?(i=(i=this.formattingProperties.columnFormatting[t.queryName])?i.subtotalLabel:this.binderOptions.defaultTotalLabel,o?i:P.TextUtil.replaceSpaceWithNBSP(i)):(i=e.valueFormatted,P.PivotTableBinderUtils.isValidUrl(t,i)?i:i&&H.isValidImage(e,t,i)?x.encodeUriForImageDataSvg(i):o?i:P.TextUtil.replaceSpaceWithNBSP(i))},b.prototype.onDataViewChanged=function(e,t,i,o,r){this.formattingProperties=t,this.legacyTooltipsEnabled=o,this.isExpandCollapseEnabled=!!r;var o=t.general.textSize,r=new P.PivotTableBinderUtils.FontInfoMeasurer,n={},a={},l={},n=(n.family=t.columnHeaders.fontFamily||H.FontFamilyHeader,n.size=t.columnHeaders.fontSize||o,t.columnHeaders.bold&&(n.weight=C.boldValue),t.columnHeaders.italic&&(n.style=C.italicValue),t.columnHeaders.underline&&(n.textDecoration=C.underlineValue),this.columnHeaderContainerFontInfo=P.PivotTableBinderUtils.createFontInfo(n,r),this.columnHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderContainerFontInfo,{},r),l.family=t.rowHeaders.fontFamily||H.FontFamilyHeader,l.size=t.rowHeaders.fontSize||o,t.rowHeaders.bold&&(l.weight=C.boldValue),t.rowHeaders.italic&&(l.style=C.italicValue),t.rowHeaders.underline&&(l.textDecoration=C.underlineValue),this.rowHeaderContainerFontInfo=P.PivotTableBinderUtils.createFontInfo(l,r),this.rowHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.rowHeaderContainerFontInfo,{},r),this.expandCollapseButtonFontInfo=P.PivotTableBinderUtils.createFontInfo({family:"PowrMDL2",size:t.rowHeaders.expandCollapseButtonsSize||this.rowHeaderFontInfo.fontProperties.size},r),t.values.fontFamily||H.FontFamilyCell),l=(a.family=n,a.size=t.values.fontSize||o,t.values.bold&&(a.weight=C.boldValue),t.values.italic&&(a.style=C.italicValue),t.values.underline&&(a.textDecoration=C.underlineValue),this.valueContainerFontInfo=P.PivotTableBinderUtils.createFontInfo(a,r),this.valueFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.valueContainerFontInfo,{},r),this.columnSubtotalFontInfo=this.getSubtotalFontInfo(t.columnSubtotals,r),this.rowSubtotalFontInfo=this.getSubtotalFontInfo(t.rowSubtotals,r),this.columnGrandTotalFontInfo=this.getGrandTotalFontInfo(t.columnGrandTotal,r,this.columnSubtotalFontInfo),this.rowGrandTotalFontInfo=this.getGrandTotalFontInfo(t.rowGrandTotal,r,this.rowSubtotalFontInfo),this.columnHeaderFontInfo.fontProperties.family===H.FontFamilyHeader),n=this.rowHeaderFontInfo.fontProperties.family===H.FontFamilyHeader,s=(t.columnSubtotals.applyToHeaders?this.subtotalColumnHeaderFontInfo=this.subtotalRowHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.columnSubtotalFontInfo,{},r,4):this.subtotalColumnHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderFontInfo,b.applyBold(l),r),t.rowSubtotals.applyToHeaders?this.subtotalRowHeaderFontInfo=this.subtotalRowHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.rowSubtotalFontInfo,{},r,4):this.subtotalRowHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.rowHeaderFontInfo,b.applyBold(n),r),t.columnGrandTotal.applyToHeaders?this.grandTotalColumnHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.columnGrandTotalFontInfo,{},r,4):this.grandTotalColumnHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderFontInfo,b.applyBold(l),r,1),t.rowGrandTotal.applyToHeaders?this.grandTotalRowHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.rowGrandTotalFontInfo,{},r,4):this.grandTotalRowHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.rowHeaderFontInfo,b.applyBold(n),r,1),this.glyphFontInfo=P.PivotTableBinderUtils.createFontInfo({family:H.FontFamilyGlyphs,size:y.createFromPt((t.columnHeaders.fontSize||o).pt*H.SortIconFontSizeRatio),lineHeight:"100%"},r),r.measureAll(this.measureElement),this.columnsDataBarsSettings={},t.columnFormatting);if(s&&e&&e.matrix&&!_.isEmpty(e.matrix.valueSources))for(var u=0,h=e.matrix.valueSources;u<h.length;u++)(m=(g=h[u]).queryName)&&s[m]&&(this.columnsDataBarsSettings[m]=P.PivotTableBinderUtils.getColumnDataBarsSettings(g,s[m].dataBarsSettings,i));this.sparklineSettings={};var d=t.sparklines;if(d&&e&&e.matrix&&!_.isEmpty(e.matrix.valueSources))for(var c=0,p=e.matrix.valueSources;c<p.length;c++){var g,m=(g=p[c]).queryName,f=g.type;m&&d[m]&&(this.sparklineSettings[m]=P.PivotTableBinderUtils.getSparklineSettings(d[m],f,i))}},b.prototype.getGrandTotalFontInfo=function(e,t,i){var o={},r=e.fontFamily;return o.family=r,o.size=e.fontSize,e.bold&&r&&(o.weight=C.boldValue),e.italic&&(o.style=C.italicValue),e.underline&&(o.textDecoration=C.underlineValue),P.PivotTableBinderUtils.overrideFontInfo(i,o,t,1)},b.prototype.isImage=function(e){return P.converterHelper.isImageUrlColumn(e.columnMetadata)},b.prototype.isSparkline=function(e){var e=e.columnMetadata,e=null==(e=null==e?void 0:e.type)?void 0:e.misc;return null!=e&&null!=e.sparkline},b.applyBold=function(e){return{family:e?H.FontFamilyTotal:void 0,weight:e?void 0:C.boldValue}},b.prototype.getSubtotalFontInfo=function(e,t){var i,o=e.fontFamily,r=(o||this.valueFontInfo.fontProperties.family!==H.FontFamilyCell?i=!0:this.valueFontInfo.fontProperties.family===H.FontFamilyCell&&(o=H.FontFamilyTotal),{});return r.family=o,r.size=e.fontSize,e.bold&&i&&(r.weight=C.boldValue),e.italic&&(r.style=C.italicValue),e.underline&&(r.textDecoration=C.underlineValue),P.PivotTableBinderUtils.overrideFontInfo(this.valueFontInfo,r,t)},b.prototype.setHorizontalBorderXPositions=function(e,t){var i="0",o="100%";if(!this.formattingProperties.rowHeaders.steppedLayout)switch(t){case S.Header:i="0",o="100%";break;case S.Body:i=e.toString();break;case S.MatrixRowHeader:i="0",o=e.toString()}return[i,o]},b.prototype.setVerticalBorderYPositions=function(e,t){var i="0",o="100%";if(!this.formattingProperties.rowHeaders.steppedLayout)switch(t){case S.Header:i="0",o="100%";break;case S.Body:break;case S.MatrixRowHeader:i="0",o=e.toString()}return[i,o]},b.prototype.getCornerContainerFontInfo=function(){return this.columnHeaderContainerFontInfo},b.prototype.getColumnHeaderContainerFontInfo=function(){return this.columnHeaderContainerFontInfo},b.prototype.getRowHeaderContainerFontInfo=function(){return this.rowHeaderContainerFontInfo},b.prototype.getValueContainerFontInfo=function(){return this.valueContainerFontInfo},P.PivotTableBinder=b}(powerbi=powerbi||{}),function(e){var i=e.visuals||(e.visuals={}),e=(t.prototype.setHierarchy=function(e){this.hierarchy=e,this.floatingLeaves=[],this.getLeaves(this.getFloatingHierarchyItems(),this.floatingLeaves)},t.prototype.hasHierarchy=function(){return!_.isEmpty(this.hierarchy.levels)},t.prototype.isMultiLevelHierarchy=function(){return 1<this.hierarchy.levels.length},t.prototype.getHierarchyDepth=function(){return Math.max(this.hierarchy.levels.length,1)},t.prototype.getHierarchyLeafNodes=function(){return this.hierarchy.leafNodes},t.prototype.getHierarchyLeafCount=function(){return this.hierarchy.leafNodes.length},t.prototype.getHierarchyLeafAt=function(e){return this.hierarchy.leafNodes[e]},t.prototype.getFloatingHierarchyLeafCount=function(){return this.floatingLeaves.length},t.prototype.getFloatingHierarchyLeafAt=function(e){return this.floatingLeaves[e]},t.prototype.getHierarchyItems=function(){return this.hierarchy.root.children||[]},t.prototype.getFloatingHierarchyItems=function(){return null},t.prototype.getLeafIndex=function(e){return this.matrixNavigator.getLeafIndex(e)},t.prototype.isLeaf=function(e){return this.matrixNavigator.isLeaf(e)},t.prototype.isLastItem=function(e,t){return this.matrixNavigator.isLastItem(e,t)},t.prototype.getParent=function(e){return this.matrixNavigator.getParent(e)},t.prototype.getIndex=function(e){return this.matrixNavigator.getIndex(e)},t.prototype.getNodeLeafCount=function(e){var t=this;return this.isLeaf(e)?1:_.sum(_.map(e.children,function(e){return t.getNodeLeafCount(e)}))},t.prototype.getIndexOfFirstLeaf=function(e){for(;!_.isEmpty(e.children);)e=e.children[0];return this.getLeafIndex(e)},t.prototype.getPathIndices=function(e){for(var t=[this.getIndex(e)],i=this.getParent(e);i;)t=__spreadArray([this.getIndex(i)],t||[],!0),i=this.getParent(i);return t},t.prototype.getNodeFromPath=function(e){if(!(_.isEmpty(e)||e.length>this.hierarchy.levels.length)){for(var t=this.hierarchy.root,i=0,o=e;i<o.length;i++){var r=o[i];if(!(t=t.children[r]))return}return t}},t.prototype.getLeafAncestorAtLevel=function(e,t,i){if(!(t>this.getLevel(e))){for(var o=e;this.getLevel(o)>t;)if(o=this.getParent(o),i&&this.getLevel(o)<t)return;return o}},t.prototype.getItemsByLevel=function(e){var t=[];return this.findLevelItems(e,this.hierarchy.root,-1,t),t},t.prototype.findLevelItems=function(e,t,i,o){if(!_.isEmpty(t.children))for(var r=i+1,n=0,a=t.children;n<a.length;n++){var l=a[n];r===e||r+this.matrixNavigator.getChildrenLevelDifference(l)>e?o.push(l):r<e&&this.findLevelItems(e,l,r,o)}},t.prototype.getExpansionState=function(e){return e.isCollapsed?1:!1===e.isCollapsed?0:2},t.prototype.getChildren=function(e){return this.matrixNavigator.getChildren(e)},t.prototype.getLevel=function(e){return this.matrixNavigator.getLevel(e)},t.prototype.getIntersection=function(e,t){e=this.matrixNavigator.getIntersection(e,t);return e&&e.objects&&(e.icon=i.TablixProperties.PropValuesIcon.getValue(e.objects),e.hyperlink=i.TablixProperties.PropValuesWebURL.getValue(e.objects)),e},t.prototype.getCorner=function(e,t){return this.matrixNavigator.getCorner(e,t)},t.prototype.getRowLevel=function(e){return e.rowLevel},t.prototype.getColumnLevel=function(e){return e.columnLevel},t.prototype.getRowHeaderMetadataColumn=function(e){return this.matrixNavigator.getRowHeaderMetadataColumn(e)},t.prototype.getRowHeaderMetadataColumns=function(e){return this.matrixNavigator.getRowHeaderMetadataColumns(e)},t.prototype.getColumnHeaderMetadataColumn=function(e){return this.matrixNavigator.getColumnHeaderMetadataColumn(e)},t.prototype.getColumnHeaderMetadataColumns=function(e){return this.matrixNavigator.getColumnHeaderMetadataColumns(e)},t.prototype.valuesOnRowApplied=function(){return this.matrixNavigator.valuesOnRowApplied()},t.prototype.hasMultipleValueSources=function(){return this.matrixNavigator.hasMultipleValueSources()},t.prototype.isColumnHeaderMultiValueSubtotal=function(e){return e.isSubtotal&&e.parent&&e.parent.isSubtotal},t.prototype.isRowHeaderMultiValueSubtotal=function(e){return this.valuesOnRowApplied()&&e.parent&&e.parent.isSubtotal},t.prototype.getLeaves=function(e,t){if(!_.isEmpty(e))for(var i=0,o=e;i<o.length;i++){var r=o[i];this.isLeaf(r)?t.push(r):this.getLeaves(this.getChildren(r),t)}},t.prototype.getColumnIndexFromQueryName=function(e){return null},t);function t(e){this.matrixNavigator=e}i.PivotTableHierarchyNavigator=e,__extends(r,o=e),r.prototype.getIntersection=function(e,t){return this.isLeaf(e)||_.isEmpty(e.children)||!e.children[0].isSubtotal||this.valuesOnRowApplied()?o.prototype.getIntersection.call(this,e,t):o.prototype.getIntersection.call(this,e.children[0],t)},r.prototype.getChildren=function(e){return!_.isEmpty(e.children)&&e.children[0].isSubtotal?e.children.slice(1):e.children},r.prototype.getHierarchyDepth=function(){return 0<o.prototype.getHierarchyDepth.call(this)?1:0},r.prototype.getCorner=function(e,t){var i=t===this.matrixNavigator.getColumnHierarchyDepth()-1?0:this.matrixNavigator.getRowHierarchyDepth()-1;return o.prototype.getCorner.call(this,i,t)},r.prototype.getFloatingHierarchyItems=function(){var e=this.getHierarchyItems();if(_.isEmpty(e))return null;for(var t=0,i=[];;){var o=e[t];if(!o||!o.isSubtotal)break;i.push(o),t++}return _.isEmpty(i)?null:i},r.prototype.isRowHeaderMultiValueSubtotal=function(e){return this.valuesOnRowApplied()&&e.isSubtotal},r.prototype.getLeaves=function(e,t){if(!_.isEmpty(e))for(var i=0,o=e;i<o.length;i++){var r=o[i];t.push(r),this.getLeaves(this.getChildren(r),t)}},r.prototype.getPathIndices=function(e){return[this.getLeafIndex(e)]},r.prototype.getNodeFromPath=function(e){if(1===e.length)return this.getHierarchyLeafAt(e[0])},r.prototype.getItemsByLevel=function(e){return __spreadArray([],this.getHierarchyLeafNodes()||[],!0)},r.prototype.getLeafAncestorAtLevel=function(e,t){return e};var o,e=r;function r(){return null!==o&&o.apply(this,arguments)||this}i.PivotTableSteppedHierarchyNavigator=r}(powerbi=powerbi||{}),function(e){var c,p;function t(e,t,i,o){this.tooltipService=e,this.selectionManager=t,this.valueLabel=i,this.totalLabel=o,this.tooltipsEnabled=!0}c=e.visuals||(e.visuals={}),p=c.controls.pivotTable.TablixRegion,t.prototype.getHandlerTop=function(){function n(e){return e.isSubtotal&&!l.rowHierarchyNavigator.valuesOnRowApplied()&&l.columnHierarchyNavigator.isColumnHeaderMultiValueSubtotal(e)}function a(e){return l.columnHierarchyNavigator.isColumnHeaderMultiValueSubtotal(e)}var l=this,s=c.matrixRoleNames.columns;return{addTooltip:null,removeTooltip:function(e,t){return l.removeTooltip(t)},isTooltipEnabled:null,setTooltipDelegate:function(e,t,i,o,r){return l.setTooltipDelegateTop(e,t,i,n,a,s,o,r)},isTooltipEnabledGeneric:function(){return l.tooltipsEnabled}}},t.prototype.getHandlerMidOrBot=function(){function n(e){return e.isSubtotal&&l.rowHierarchyNavigator.valuesOnRowApplied()&&l.rowHierarchyNavigator.isRowHeaderMultiValueSubtotal(e)}function a(e){return l.rowHierarchyNavigator.isRowHeaderMultiValueSubtotal(e)}var l=this,s=c.matrixRoleNames.rows;return{addTooltip:null,removeTooltip:function(e,t){return l.removeTooltip(t)},isTooltipEnabled:null,setTooltipDelegate:function(e,t,i,o,r){return l.setTooltipDelegateMidOrBot(e,t,i,n,a,s,o,r)},isTooltipEnabledGeneric:function(){return l.tooltipsEnabled}}},t.prototype.getRowHeaderHandler=function(){var t=this;return this.getHeaderHandler(function(e){return e.isSubtotal&&t.rowHierarchyNavigator.valuesOnRowApplied()&&t.rowHierarchyNavigator.isRowHeaderMultiValueSubtotal(e)},function(e){return t.rowHierarchyNavigator.isRowHeaderMultiValueSubtotal(e)},c.matrixRoleNames.rows)},t.prototype.getColumnHeaderHandler=function(){var t=this;return this.getHeaderHandler(function(e){return e.isSubtotal&&!t.rowHierarchyNavigator.valuesOnRowApplied()&&t.columnHierarchyNavigator.isColumnHeaderMultiValueSubtotal(e)},function(e){return t.columnHierarchyNavigator.isColumnHeaderMultiValueSubtotal(e)},c.matrixRoleNames.columns)},t.prototype.getBodyHandler=function(){var i=this;return{addTooltip:function(e,t){return i.addBodyTooltip(e,t)},removeTooltip:function(e,t){return i.removeTooltip(t)},isTooltipEnabled:function(e){return i.tooltipsEnabled},setTooltipDelegate:null,isTooltipEnabledGeneric:function(){return i.tooltipsEnabled}}},t.prototype.onDataViewChanged=function(e,t){this.rowHierarchyNavigator=e,this.columnHierarchyNavigator=t},t.prototype.addBodyTooltip=function(t,e){var i=this,e=d3.select(e);this.tooltipService.addTooltip(e,function(){return c.PivotTableInteractivityUtils.getBodyCellTooltipInfo(t,i.valueLabel,!i.tooltipsEnabled)},function(){var e=i.getItemSelectionId(t,c.matrixRoleNames.values,void 0);return e&&[e]})},t.prototype.getCornerHandler=function(){var i=this;return{addTooltip:function(e,t){return i.addCornerTooltip(e,t)},removeTooltip:function(e,t){return i.removeTooltip(t)},isTooltipEnabled:function(e){return i.tooltipsEnabled&&!_.isEmpty(e.displayName)},setTooltipDelegate:null,isTooltipEnabledGeneric:function(){return i.tooltipsEnabled}}},t.prototype.tooltipVisible=function(){return this.tooltipService&&this.tooltipService.visible()},t.prototype.hideTooltip=function(){this.tooltipService&&this.tooltipService.hide()},t.prototype.setTooltipsEnabled=function(e){this.tooltipsEnabled=e},t.prototype.addHeaderTooltip=function(t,e,i,o,r){var n,a=this,e=d3.select(e),l=null==(l=(n=this.tooltipService).isTouchScreenOptimizedEnabled)?void 0:l.call(n),s=((n={})[0]=!l,n);this.tooltipService.addTooltip(e,function(){return c.PivotTableInteractivityUtils.getHeaderTooltipInfo(t,i,o,a.totalLabel,a.valueLabel)},function(){var e=a.getItemSelectionId(t,r,s);return e&&[e]})},t.prototype.addCornerTooltip=function(t,e){var i=this,e=d3.select(e);this.tooltipService.addTooltip(e,function(){return c.PivotTableInteractivityUtils.getCornerCellTooltipInfo(t)},function(){var e=i.getItemSelectionId(t,void 0,void 0);return e&&[e]})},t.prototype.getHeaderHandler=function(i,o,r){var n=this;return{addTooltip:function(e,t){return n.addHeaderTooltip(e,t,i,o,r)},removeTooltip:function(e,t){return n.removeTooltip(t)},isTooltipEnabled:function(e){return n.tooltipsEnabled&&void 0!==e.valueFormatted},setTooltipDelegate:null,isTooltipEnabledGeneric:function(){return n.tooltipsEnabled}}},t.prototype.removeTooltip=function(e){e=d3.select(e);this.tooltipService.removeTooltips(e)},t.prototype.getItemSelectionId=function(e,t,i){if(e)return(e=(e=this.selectionManager.createSelectorsByColumn(e))&&c.SelectionId.fromSelectorsByColumnAndRoles(e,t))&&i&&(e.exclude=__assign(__assign({},e.exclude),null!=i?i:{})),e},t.prototype.setTooltipDelegateTop=function(i,e,o,t,r,n,a,l){var s,u=this,e=d3.select(e),h=null==(h=(s=this.tooltipService).isTouchScreenOptimizedEnabled)?void 0:h.call(s),d=((s={})[0]=!h,s);this.tooltipService.addTooltip(e,function(e){return!u.tooltipsEnabled&&l(e)?null:o(e.context)===p.Prefix?c.PivotTableInteractivityUtils.getCornerCellTooltipInfo(i(e)):c.PivotTableInteractivityUtils.getHeaderTooltipInfo(i(e),t,r,u.totalLabel,u.valueLabel,!u.tooltipsEnabled)},function(e){var t;return o(e.context)===p.Prefix?(t=u.getItemSelectionId(i(e),void 0,void 0))&&[t]:(t=u.getItemSelectionId(i(e),n,d))&&[t]},!0,!0,a)},t.prototype.setTooltipDelegateMidOrBot=function(i,e,o,t,r,n,a,l){var s,u=this,e=d3.select(e),h=null==(h=(s=this.tooltipService).isTouchScreenOptimizedEnabled)?void 0:h.call(s),d=((s={})[0]=!h,s);this.tooltipService.addTooltip(e,function(e){return!u.tooltipsEnabled&&l(e)?null:o(e.context)===p.Prefix?c.PivotTableInteractivityUtils.getHeaderTooltipInfo(i(e),t,r,u.totalLabel,u.valueLabel,!u.tooltipsEnabled):c.PivotTableInteractivityUtils.getBodyCellTooltipInfo(i(e),u.valueLabel,!u.tooltipsEnabled)},function(e){var t;return o(e.context)===p.Prefix?(t=u.getItemSelectionId(i(e),n,d))&&[t]:(t=u.getItemSelectionId(i(e),c.matrixRoleNames.values,void 0))&&[t]},!0,!0,a)},c.PivotTableInteractionManager=t}(powerbi=powerbi||{}),function(e){var i;function l(e){this.hostServices=e}i=e.visuals||(e.visuals={}),l.prototype.onDataViewChanged=function(e,t,i,o,r){this.isSteppedLayout=o,this.valuesOnRowApplied=r,this.nonMeasureRowLevels=this.getNonMeasureRowLevels(e),this.valueSources=i,this.hasRows=e&&!_.isEmpty(this.nonMeasureRowLevels),this.hasColumns=t&&!_.isEmpty(t.levels),this.measureCount=i?i.length:0},l.hasSortingChanged=function(e,t){if(e&&t){var i=e.metadata.columns;if(!_.isEmpty(i)){e=t.metadata.columns;if(!_.isEmpty(e))for(var o=0,r=e;o<r.length;o++){var n=function(t){var e=_.find(i,function(e){return t.queryName===e.queryName});if(e&&t.sort!==e.sort)return{value:!0}}(r[o]);if("object"==typeof n)return n.value}}}return!1},l.prototype.isCornerSortable=function(e){return this.hasRows&&null!=e.metadata&&e.position.row.isLast&&(!this.valuesOnRowApplied||!e.position.column.isLast)},l.prototype.getNonMeasureRowLevels=function(e){var t;return this.valuesOnRowApplied?((t=[]).push.apply(t,e.levels||[]),t.pop(),t):e.levels},l.prototype.isColumnHeaderSortable=function(e){var t=i.PivotTableSelectionManager.hasIdentity(e);return this.hasRows&&0<this.measureCount&&!t&&e.position.row.isLast&&!this.valuesOnRowApplied},l.prototype.getCornerSortDirection=function(e){if(!this.isCornerSortable(e))return null;if(this.isSteppedLayout){for(var t=null,i=0,o=this.nonMeasureRowLevels;i<o.length;i++){var r=o[i];if(1!==r.sources.length)return null;r=r.sources[0].sort;if(null==r)return null;if(null===t)t=r;else if(r!==t)return null}return t}return this.nonMeasureRowLevels[e.position.column.index].sources[0].sort},l.prototype.getColumnHeaderSortDirection=function(e){return this.isColumnHeaderSortable(e)?this.getMeasureSortDirection(this.getMeasureQueryName(e)):null},l.prototype.getMeasureQueryName=function(e){return(this.hasColumns&&1===this.measureCount?this.valueSources[0]:e).queryName},l.prototype.sortCorner=function(e){var t=this.getCornerSortDirection(e),i=l.getNextSortDirection(t);if(this.isSteppedLayout)for(var o=[],r=0,n=this.nonMeasureRowLevels;r<n.length;r++){var a=n[r];o.push({queryName:a.sources[0].queryName,sortDirection:i})}else o=[{queryName:e.metadata.queryName,sortDirection:i}];this.hostServices.onCustomSort({sortDescriptors:o})},l.prototype.sortColumnHeader=function(e){var t=this.getColumnHeaderSortDirection(e),i=this.getMeasureColumn(this.getMeasureQueryName(e));this.hostServices.onCustomSort({sortDescriptors:[{queryName:this.getMeasureQueryName(e),sortDirection:l.getNextSortDirection(t,i)}]})},l.getNextSortDirection=function(e,t){return void 0===e?l.getDefaultSortDirection(t):1===e?2:1},l.getDefaultSortDirection=function(e){return e&&e.isMeasure&&e.type&&e.type.numeric&&!e.type.temporal?2:1},l.prototype.getMeasureSortDirection=function(e){e=this.getMeasureColumn(e);if(null!=e)return e.sort},l.prototype.getMeasureColumn=function(t){return _.find(this.valueSources,function(e){return e.queryName===t})},i.PivotTableSortingManager=l}(powerbi=powerbi||{}),function(o){var h,d,e,c;function p(e){return 0===e.type}function g(e,t){this.hostServices=e,this.featureSwitches=t,this.clearLocal()}h=o.visuals||(o.visuals={}),c=o.visuals.controls.internal.TablixUtils,(e=d=h.PivotTableSelectionMode||(h.PivotTableSelectionMode={}))[e.RowHeader=0]="RowHeader",e[e.ColumnHeader=1]="ColumnHeader",e[e.BodyCell=2]="BodyCell",g.prototype.onItemContextMenu=function(e,t,i,o){h.EventBubblingUtil.markAsHandled(i),!this.isEmpty()&&this.isItemSelected(e,!0)?(r=this.selectedItems,t=this.selectionMode):r=[e];var r,e=this.createContextMenuArgs(e,t,r,i,o);e&&this.hostServices.onContextMenu(e)},g.prototype.onWhitespaceClick=function(){this.clearLocal(),this.hostServices.onSelect(this.createSelectArgs(this.selectedItems))},g.prototype.isDrillingEnabled=function(e,t,i){e=this.createSelectingArgs(e,i,t);return this.hostServices.onSelecting(e),1===e.action},g.prototype.select=function(e,t,i){this.updateSelection(e,t,i,!1),this.hostServices.alertScreenReader(this.getSelectionScreenReaderMessage(e)),this.hostServices.onSelect(this.createSelectArgs(this.selectedItems,i))},g.prototype.getSelectionScreenReaderMessage=function(e){var t;switch(this.selectionMode){case d.RowHeader:var i=this.rowHierarchyNavigator.isLeaf(this.getEffectiveSelectedHeader(e)),o=1===this.rowHierarchyNavigator.getExpansionState(e),r=_.isEmpty(this.selectedItems)?!i||e.isSubtotal||o?"Row_Group_Unselected":"Row_Unselected":!i||e.isSubtotal||o?"Row_Group_Selected":"Row_Selected";break;case d.ColumnHeader:t=this.columnHierarchyNavigator.isLeaf(this.getEffectiveSelectedHeader(e)),r=_.isEmpty(this.selectedItems)?t&&!e.isSubtotal?"Column_Unselected":"Column_Group_Unselected":t&&!e.isSubtotal?"Column_Selected":"Column_Group_Selected";break;case d.BodyCell:i=this.rowHierarchyNavigator.isLeaf(this.getEffectiveSelectedHeader(e.rowItem)),t=this.columnHierarchyNavigator.isLeaf(this.getEffectiveSelectedHeader(e.columnItem)),r=_.isEmpty(this.selectedItems)?i&&t&&!e.isSubtotal?"Intersection_Unselected":"Intersection_Group_Unselected":i&&t&&!e.isSubtotal?"Intersection_Selected":"Intersection_Group_Selected";break;default:r="Tablix_Selections_Cleared"}return this.hostServices.getLocalizedString(r)},g.prototype.getSelectionMode=function(){return this.selectionMode},g.prototype.updateSelection=function(e,t,i,o){if(this.featureSwitches.a11yMatrix){if(e.isRowGrandTotal&&e.isColumnGrandTotal)return this.clearLocal(),!0;e.isRowGrandTotal?(e=this.getEffectiveSelectedHeader(e.columnItem),t=d.ColumnHeader):e.isColumnGrandTotal&&(e=this.getEffectiveSelectedHeader(e.rowItem),t=d.RowHeader)}if(o||t===this.selectionMode||this.clearLocal(),this.createSelectorsByColumn(e))if(this.isItemSelected(e,o)){if(o)return!1;1===this.selectedItems.length&&1!==i?this.clearLocal():3===i?this.unselectItem(e):0===i&&(this.selectedItems=[e])}else 0!==i&&t===this.selectionMode||this.clearLocal(),this.selectionMode=t,this.selectedItems.push(e),this.hostServices.canSelect(this.createSelectArgs(this.selectedItems))||(this.selectedItems=[e]);else this.clearLocal();return!0},g.prototype.isRowHeaderHighlighted=function(e){if(this.isEmpty())return!0;for(var t=0,i=this.selectedItems;t<i.length;t++){var o=i[t];if(this.isRowHeaderOnSelectedPath(o,e))return!0}return!1},g.prototype.isColumnHeaderHighlighted=function(e){if(this.isEmpty())return!0;for(var t=0,i=this.selectedItems;t<i.length;t++){var o=i[t];if(this.isColumnHeaderOnSelectedPath(o,e))return!0}return!1},g.prototype.isRowHeaderIndicatorOn=function(t,i){var e,o,r=this;return!!this.featureSwitches.a11yMatrix&&(e=_.some(this.selectedItems,function(e){return r.isRowHeaderOnSelectedPath(e,t,!0,!i)}),o=this.selectionMode===d.ColumnHeader,e)&&!o},g.prototype.isRowHeaderDarkened=function(t){var e,i,o=this;return!!this.featureSwitches.a11yMatrix&&(e=_.some(this.selectedItems,function(e){return o.isRowHeaderOnSelectedPath(e,t,!0,!1)}),i=this.selectionMode===d.RowHeader,e)&&i},g.prototype.isColumnHeaderIndicatorOn=function(t){var e,i,o,r=this;return!!this.featureSwitches.a11yMatrix&&(e=this.columnHierarchyNavigator.isLeaf(t),i=_.some(this.selectedItems,function(e){return r.isColumnHeaderOnSelectedPath(e,t)}),o=this.selectionMode===d.RowHeader,e)&&i&&!o},g.prototype.isColumnHeaderDarkened=function(t){var i=this,e=_.some(this.selectedItems,function(e){return i.isColumnHeaderOnSelectedPath(e,t)}),o=this.selectionMode===d.RowHeader;return e&&!o},g.prototype.isBodyCellHighlighted=function(e){if(this.isEmpty())return!0;for(var t=0,i=this.selectedItems;t<i.length;t++){var o=i[t];if(this.isBodyCellOnSelectedPath(o,e))return!0}return!1},g.prototype.isBodyCellIndicatorOn=function(e){if(!this.isEmpty())for(var t=0,i=this.selectedItems;t<i.length;t++){var o=i[t];if(this.isBodyCellOnSelectedPath(o,e)&&this.selectionMode===d.BodyCell)return!0}return!1},g.prototype.isRowHeaderOnSelectedPath=function(e,t,i,o){return this.selectionMode===d.ColumnHeader||(e=p(e)?e.rowItem:e,this.isOnSelectedPath(this.getEffectiveSelectedHeader(e),t,i,o))},g.prototype.isColumnHeaderOnSelectedPath=function(e,t){return this.selectionMode===d.RowHeader||(e=p(e)?e.columnItem:e,this.isOnSelectedPath(this.getEffectiveSelectedHeader(e),t))},g.prototype.isBodyCellOnSelectedPath=function(e,t){return this.isRowHeaderOnSelectedPath(e,t.rowItem)&&this.isColumnHeaderOnSelectedPath(e,t.columnItem)},g.prototype.isOnSelectedPath=function(e,t,i,o){if(!e)return!0;if(e===t)return!0;var r=e;if(!i)for(;r;){if(r===t)return!0;r=r.parent}if(r=t,!o)for(;r;){if(r===e)return!0;r=r.parent}return!1},g.prototype.onDataViewChanged=function(e,t){this.rowHierarchyNavigator=e,this.columnHierarchyNavigator=t;var i=e&&e.getHierarchyItems(),o=t&&t.getHierarchyItems();if(!this.isEmpty()){for(var r=[],n=0,a=this.selectedItems;n<a.length;n++){var l=a[n],s=g.getMatchingItem(l,this.selectionMode,i,o,e);r.push(s||l)}this.selectedItems=r}},g.getMatchingItem=function(e,t,i,o,r){switch(t){case d.RowHeader:return this.getMatchingHeader(e,i);case d.ColumnHeader:return this.getMatchingHeader(e,o);case d.BodyCell:var n=e,a=this.getMatchingHeader(n.rowItem,i),n=this.getMatchingHeader(n.columnItem,o);return a&&n?r.getIntersection(a,n):null}},g.getMatchingHeader=function(e,t){if(t)for(var i=0,o=t;i<o.length;i++){var r=o[i];if(this.areHeadersEqual(e,r))return r;r=this.getMatchingHeader(e,r.children);if(r)return r}return null},g.areHeadersEqual=function(e,t){if(o.DataViewScopeIdentity.equals(e.identity,t.identity)&&e.queryName===t.queryName){if(!e.parent&&!t.parent)return!0;if(e.parent&&t.parent)return this.areHeadersEqual(e.parent,t.parent)}return!1},g.getMatchingItemById=function(e,t,i,o,r){var n=_.keys(e.dataMap),a=_.chain(r.getColumnHierarchy().levels).filter(function(e){return!e.sources[0].isMeasure}).map(function(e){return e.sources[0].queryName}).filter(function(e){return _.includes(n,e)}).value(),l=_.chain(r.getRowHierarchy().levels).map(function(e){return e.sources[0].queryName}).filter(function(e){return _.includes(n,e)}).value();switch(t){case d.RowHeader:return this.getMatchingHeaderById(e,l,i);case d.ColumnHeader:return this.getMatchingHeaderById(e,a,o);case d.BodyCell:var s=this.getMatchingHeaderById(e,l,i),u=this.getMatchingHeaderById(e,a,o);return s&&u?r.getIntersection(s,u):null}},g.getMatchingHeaderById=function(o,r,e){if(e)for(var t=0,i=e;t<i.length;t++)for(var n=i[t],a=this,l=0,s=r.length;l<s;l++){var u=function(e,t){var i=r[e];if(a.headerMatchesId(o,i,n)){if(1===t)return{value:n};n.children;e=a.getMatchingHeaderById(o,_.filter(r,function(e){return e!==i}),n.children);return e?{value:e}:void 0}}(l,s);if("object"==typeof u)return u.value}return null},g.headerMatchesId=function(e,t,i){return!!(t===i.queryName&&e.dataMap&&e.dataMap[t]&&o.DataViewScopeIdentity.equals(_.head(e.dataMap[t]),i.identity))},g.areCornerItemsEqual=function(e,t){return!(!e.metadata||!t.metadata)&&e.metadata.queryName===t.metadata.queryName},g.prototype.clearLocal=function(){this.selectedItems=[]},g.prototype.isSelectionEmpty=function(){return _.isEmpty(this.selectedItems)},g.prototype.restoreSelectionState=function(e,t){if(this.clearLocal(),_.isEmpty(e))return!0;for(var i=!1,o=this.selectedItems,r=0,n=e;r<n.length;r++){var a=n[r],l=this.determineSelectionModeFromIds(a,t);null!=l&&(this.selectionMode=l,a=g.getMatchingItemById(a,l,t.getRowHierarchy().root.children,t.getColumnHierarchy().root.children,t))&&(o.push(a),i=!0)}return i},g.prototype.determineSelectionModeFromIds=function(e,t){if(!e)return this.selectionMode;var i,o=_.map(t.getColumnHierarchy().levels,function(e){return e.sources[0].queryName}),r=!1,n=_.map(t.getRowHierarchy().levels,function(e){return e.sources[0].queryName}),a=!1;for(i in e.dataMap)if(_.includes(o,i))r=!0;else{if(!_.includes(n,i))return;a=!0}return r&&a?d.BodyCell:r?d.ColumnHeader:a?d.RowHeader:void 0},g.prototype.isEmpty=function(){return _.isEmpty(this.selectedItems)},g.prototype.isItemSelected=function(e,t){void 0===t&&(t=!1);for(var i=p(e)?e:void 0,o=0,r=this.selectedItems;o<r.length;o++){var n=r[o];if(p(n)&&i){if(this.areBodyCellsEqual(n,i))return!0}else if(n===e)return!0}return!(!t||this.isEmpty()||!i)&&this.isBodyCellHighlighted(i)},g.prototype.unselectItem=function(t){var i=this;p(t)?_.remove(this.selectedItems,function(e){return i.areBodyCellsEqual(e,t)}):_.pull(this.selectedItems,t)},g.prototype.areBodyCellsEqual=function(e,t){return e.rowItem===t.rowItem&&e.columnItem===t.columnItem},g.prototype.getEffectiveSelectedHeader=function(e){return e&&!e.identity&&e.parent?this.getEffectiveSelectedHeader(e.parent):e},g.prototype.getEffectiveSelectedNodes=function(e){return e.parent?[this.getEffectiveSelectedHeader(e)]:e.identity?[e]:e.siblings},g.getRoleNames=function(e){switch(e){case d.ColumnHeader:return[h.matrixRoleNames.columns];case d.RowHeader:return[h.matrixRoleNames.rows];case d.BodyCell:return[h.matrixRoleNames.values]}},g.prototype.createSelectingArgs=function(e,t,i){return{type:0,visualObjects:this.getVisualObjects([e]),position:g.getMouseEventPosition(i),dataRoles:g.getRoleNames(t)}},g.prototype.createSelectArgs=function(e,t){for(var i=[],o=0,r=e;o<r.length;o++){var n=r[o],n=this.createSelectorsByColumn(n);n&&i.push({objectName:"",selectorsByColumn:n})}return{type:0,visualObjects:this.getVisualObjects(e),selectionMode:t}},g.prototype.getVisualObjects=function(e){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i],r=this.createSelectorsByColumn(r);r&&t.push({objectName:"",selectorsByColumn:r})}return t},g.prototype.createContextMenuArgs=function(e,t,i,o,r){for(var n=this,a=[],l=0,s=i;l<s.length;l++){var u=s[l],u=this.createSelectorsByColumn(u);u&&a.push(u)}var h,d,r={dataRoles:r,data:a,position:g.getMouseEventPosition(o)};if((p(e)||(r.nodeIndex=this.getHierarchyNodeIndex(e)),_.isEmpty(a)||a.every(function(e){return _.isEmpty(e.dataMap)}))&&(p(e)&&e.isColumnGrandTotal&&e.isRowGrandTotal))return h=null==(o=null==(o=null==(o=e.columnMetadata)?void 0:o.type)?void 0:o.misc)?void 0:o.sparkline,r.copyArgs={singleValue:function(){return h?e.textContent:String(e.dataPoint)}},r;return p(e)?(null==(o=null==(o=null==(o=e.columnMetadata)?void 0:o.type)?void 0:o.misc)?void 0:o.sparkline)?d=e.textContent:null!=(o=e.dataPoint)&&(d=c.convertValueToString(o,this.featureSwitches.utcDates)):d=e.tooltipValueFormatted,r.copyArgs={grid:function(){return n.generateGridCopyCallback(i,t)}},void 0!==d&&(r.copyArgs.singleValue=function(){return String(d)}),r},g.prototype.generateGridCopyCallback=function(e,t){var i,o=e.slice(),r=[];switch(t){case d.BodyCell:o=this.collectSelectedBodyNodes(o),i=h.PivotTableInteractivityUtils.getGivenBodyCellsInfo(o,this.rowHierarchyNavigator,this.columnHierarchyNavigator,this.hostServices.getLocalizedString(c.ValueLabel)),r.push.apply(r,__spreadArray([i.headers],i.values||[],!1));break;case d.ColumnHeader:for(var n=[],a=0,l=o;a<l.length;a++){var s=l[a];this.columnHierarchyNavigator.isLeaf(s)&&this.columnHierarchyNavigator.getColumnHeaderMetadataColumn(s).isMeasure?n.push.apply(n,s.siblings||[]):n.push(s)}i=h.PivotTableInteractivityUtils.getGivenGroupingDataItems([],o=n,this.rowHierarchyNavigator,this.columnHierarchyNavigator,this.hostServices.getLocalizedString(c.ValueLabel)),r.push.apply(r,__spreadArray([i.headers],i.values||[],!1));break;case d.RowHeader:i=h.PivotTableInteractivityUtils.getGivenGroupingDataItems(o,[],this.rowHierarchyNavigator,this.columnHierarchyNavigator,this.hostServices.getLocalizedString(c.ValueLabel)),r.push.apply(r,__spreadArray([i.headers],i.values||[],!1))}return{grid:r,coveragePercentage:i?i.coveragePercentage:void 0}},g.prototype.getHierarchyNodeIndex=function(e){for(var t=[];e&&null!=e.index;)t.splice(0,0,e.index),e=e.parent;return t},g.prototype.collectSelectedBodyNodes=function(e){for(var t=[],i=0,o=e;i<o.length;i++){var r,n,a=o[i];!a.isSubtotal&&a.columnItem.identity&&a.rowItem.identity?t.push(a):(r=[],n=[],a.isRowGrandTotal||(r=this.getEffectiveSelectedNodes(a.rowItem)),a.isColumnGrandTotal||(n=this.getEffectiveSelectedNodes(a.columnItem)),a=h.PivotTableInteractivityUtils.explodeHeadersToBodyItems(this.rowHierarchyNavigator,this.columnHierarchyNavigator,r,n),t.push.apply(t,a||[]))}for(var l=0;l<t.length;l++)for(var s=t[l],u=l+1;u<t.length;u++)_.isEqual(s,t[u])&&(t.splice(u,1),u--);return t},g.prototype.createSelectorsByColumn=function(e){return p(e)?this.createSelectorsByColumnForBodyCell(e):this.createSelectorsByColumnForHeader(e)},g.prototype.createSelectorsByColumnForHeader=function(e){var t=e.queryName,i={};return g.addHeaderIdentities(e,i)?{dataMap:i,metadata:[t]}:void 0},g.prototype.createSelectorsByColumnForBodyCell=function(e){var t={},e=(g.addHeaderIdentities(e.rowItem,t),g.addHeaderIdentities(e.columnItem,t),null==(e=e.columnMetadata)?void 0:e.queryName);return{dataMap:t,metadata:e?[e]:void 0}},g.addHeaderIdentities=function(e,t){for(var i=[];e;)e.identity&&i.splice(0,0,e),e=e.parent;for(var o=0,r=i;o<r.length;o++){var n=r[o];t[n.queryName]=[n.identity]}return 0<i.length},g.hasIdentity=function(e){return g.addHeaderIdentities(e,{})},g.getMouseEventPosition=function(e){return{x:e.clientX,y:e.clientY}},h.PivotTableSelectionManager=g}(powerbi=powerbi||{}),function(e){var c,r,a;function t(e){this.hostServices=e}c=e.visuals||(e.visuals={}),r=e.data.DataViewMatrixUtils,a=e.data.DataViewScopeTotal,t.prototype.onDataViewChanged=function(e,t,i,o){this.columnHierarchy=e,this.valueSources=t,this.metatdataObjects=i,this.valuesOnRowApplied=o,this.hasColumnGrouping=0<r.getColumnGroupingLevelsCount(this.columnHierarchy),this.hasMultiMeasureOnColumns=!_.isEmpty(this.valueSources)&&1<this.valueSources.length&&!this.valuesOnRowApplied,this.headerPendingChanges=[],this.cornerPendingChanges=[]},t.prototype.getNodeSelector=function(e){if(!this.hasColumnGrouping){if(e.queryName)return{metadata:e.queryName};if(this.valuesOnRowApplied)return null}for(var t={};e;){if(this.hasMultiMeasureOnColumns&&e.level===this.columnHierarchy.levels.length-1)t.metadata=e.queryName;else if(e.isSubtotal){for(var i=[],o=0,r=this.columnHierarchy.levels[e.level].sources;o<r.length;o++){var n=r[o];_.isEmpty(n.identityExprs)||i.push.apply(i,n.identityExprs||[])}_.isEmpty(i)||(t.data=[a.fromExprs(i)])}else e.identity&&(t.data?t.data.splice(0,0,e.identity):t.data=[e.identity]);e=e.parent}return t},t.prototype.getCornerSelector=function(e){if(e.metadata&&e.metadata.queryName)return{metadata:e.metadata.queryName}},t.prototype.getHeaderPendingChange=function(t){return _.find(this.headerPendingChanges,function(e){return c.PivotTableSelectionManager.areHeadersEqual(e.cell,t)})},t.prototype.getCornerPendingChange=function(t){return _.find(this.cornerPendingChanges,function(e){return c.PivotTableSelectionManager.areCornerItemsEqual(e.cell,t)})},t.prototype.queueHeaderPendingChange=function(e,t){var i=this.getHeaderPendingChange(e);i?i.width=t:this.headerPendingChanges.push({cell:e,width:t})},t.prototype.queueCornerPendingChange=function(e,t){var i=this.getCornerPendingChange(e);i?i.width=t:this.cornerPendingChanges.push({cell:e,width:t})},t.prototype.getColumnWidth=function(e){var t,i=this.getHeaderPendingChange(e);return i?i.width:(this.hasColumnGrouping?t=e.objects:e.queryName?t=this.valueSources[e.levelSourceIndex||0].objects:this.valuesOnRowApplied&&(t=this.metatdataObjects),c.TablixProperties.PropColumnWidthValue.getValue(t))},t.prototype.setColumnWidth=function(e,t){var i=this.getNodeSelector(e);this.queueHeaderPendingChange(e,t),c.PivotTableSizeManagerUtils.persistWidths([{selector:i,value:t}],this.hostServices,!1)},t.prototype.getRowHeight=function(e){},t.prototype.setRowHeight=function(e,t){},t.prototype.getRowLevelWidth=function(e){var t=this.getCornerPendingChange(e);return t?t.width:e.metadata&&e.metadata.objects?c.TablixProperties.PropColumnWidthValue.getValue(e.metadata.objects):void 0},t.prototype.setRowLevelWidth=function(e,t){var i=this.getCornerSelector(e);i&&(this.queueCornerPendingChange(e,t),c.PivotTableSizeManagerUtils.persistWidths([{selector:i,value:t}],this.hostServices,!1))},t.prototype.getColumnLevelHeight=function(e){},t.prototype.setColumnLevelHeight=function(e,t){},t.prototype.setMissingWidths=function(e,t){for(var i=[],o=0,r=e;o<r.length;o++){var n=r[o],a=n.node,l=n.width;null==this.getColumnWidth(a)&&(this.queueHeaderPendingChange(a,l),i.push({selector:this.getNodeSelector(a),value:l}))}for(var s=0,u=t;s<u.length;s++){var h=u[s],d=h.corner,l=h.width,h=this.getCornerSelector(d);h&&null==this.getRowLevelWidth(d)&&(this.queueCornerPendingChange(d,l),i.push({selector:h,value:l}))}_.isEmpty(i)||c.PivotTableSizeManagerUtils.persistWidths(i,this.hostServices,!0)},t.prototype.clearWidths=function(e,t){for(var i=[],o=0,r=e;o<r.length;o++){var n=r[o];null!=this.getColumnWidth(n)&&i.push({selector:this.getNodeSelector(n),value:void 0}),this.queueHeaderPendingChange(n,void 0)}for(var a=0,l=t;a<l.length;a++){var s=l[a];null!=this.getRowLevelWidth(s)&&i.push({selector:this.getCornerSelector(s),value:void 0}),this.queueCornerPendingChange(s,void 0)}_.isEmpty(i)||c.PivotTableSizeManagerUtils.persistWidths(i,this.hostServices,!0)},c.PivotTableSizeManager=t}(powerbi=powerbi||{}),function(a){var l,e,s,i,o;function r(e){this.isTouchDisabled=e&&e.isTouchDisabled}l=a.visuals||(a.visuals={}),e=a.visuals.controls.TablixColumnWidthManager,s=a.visuals.controls.TablixControl,i=a.visuals.controls.TablixType,o=a.visuals.controls.internal.TablixUtils,r.prototype.init=function(e){this.element=e.element,this.updateViewport(e.viewport),this.isInteractive=e.interactivity&&null!=e.interactivity.selection,this.getLocalizedString=e.host.getLocalizedString.bind(e.host),this.hostServices=e.host,this.persistingObjects=!1,this.waitingForData=!1,this.lastAllowHeaderResize=!0,this.waitingForSort=!1,this.style=e.style,this.tablixPropertyManager=new l.TablixPropertyManager(this.style)},r.converter=function(e,t){var i=e.table,o=(i.rows,a.Prototype.inherit(i));o.visualRows=[];for(var r=0;r<i.rows.length;r++){var n={index:r,values:i.rows[r]};o.visualRows.push(n)}return o.formattingProperties=t.getTableObjects(e),o},r.prototype.onResizing=function(e){this.updateViewport(e)},r.prototype.getColumnWidthManager=function(){return this.columnWidthManager},r.prototype.onDataChanged=function(e){var t=e.dataViews;if(t&&0<t.length){var i=this.dataView;if(this.dataView=t[0],this.persistingObjects)return void(this.persistingObjects=!1);t=r.converter(this.dataView,this.tablixPropertyManager);e.operationKind===a.VisualDataChangeOperationKind.Append?(this.createOrUpdateHierarchyNavigator(t),this.tablixControl.updateModels(!1,t.visualRows,t.columns),this.refreshControl(!1)):(this.createOrUpdateHierarchyNavigator(t),this.createColumnWidthManager(),this.createOrUpdateTablixControl(t),this.updateInternal(i,t))}this.waitingForData=!1,this.waitingForSort=!1},r.prototype.createColumnWidthManager=function(){var t=this;this.columnWidthManager?this.columnWidthManager.updateDataView(this.dataView):this.columnWidthManager=new e(this.dataView,!1,function(e){return t.persistColumnWidths(e)})},r.prototype.persistColumnWidths=function(e){this.persistingObjects=!0,this.hostServices.persistProperties(e)},r.prototype.updateViewport=function(e){this.currentViewport=e,this.tablixControl&&(this.tablixControl.viewport=this.currentViewport,this.verifyHeaderResize(),this.refreshControl(!1))},r.prototype.refreshControl=function(e){!this.element.is(":visible")&&1!==this.getLayoutKind()||this.tablixControl.refresh(e)},r.prototype.getLayoutKind=function(){return this.isInteractive?0:1},r.prototype.createOrUpdateHierarchyNavigator=function(e){var t=!this.dataView.metadata.segment;this.tablixControl?this.hierarchyNavigator.update(e,t,e.formattingProperties.formatters):(t=new l.TableHierarchyNavigator(e,t,e.formattingProperties.formatters,this.tablixPropertyManager.tablixProperties),this.hierarchyNavigator=t)},r.prototype.createOrUpdateTablixControl=function(e){this.tablixControl?this.tablixControl.getBinder().updateDataView(e):this.tablixControl=this.createControl(this.hierarchyNavigator,e)},r.prototype.createControl=function(e,t){var i=this,o=this.getLayoutKind(),r=t.formattingProperties.general.textSize,n={onBindRowHeader:function(e){return i.onBindRowHeader(e)},onColumnHeaderClick:function(e,t){return i.onColumnHeaderClick(e,t)},layoutKind:o,columnWidthManager:this.columnWidthManager,tablixProperties:this.tablixPropertyManager.tablixProperties},n=new l.TableBinder(n,t),t=1===o?l.controls.internal.DashboardTablixLayoutManager.createLayoutManager(n):l.controls.internal.CanvasTablixLayoutManager.createLayoutManager(n,this.columnWidthManager),a=document.createElement("div"),o=(this.element.append(a),{interactive:this.isInteractive,enableTouchSupport:!this.isTouchDisabled,layoutKind:o,fontSize:l.TablixPropertyManager.getTextSizeInPx(r)});return new s(e,t,n,a,o)},r.prototype.updateInternal=function(e,t){var i=this,o=t.formattingProperties.general.textSize,o=(1===this.getLayoutKind()&&this.tablixControl.layoutManager.adjustContentSize(l.converterHelper.hasImageUrlColumn(this.dataView)),this.tablixControl.fontSize=l.TablixPropertyManager.getTextSizeInPx(o),this.tablixControl.wordWrapColumnHeaders=t.formattingProperties.columnHeaders.wordWrap,this.verifyHeaderResize(),this.tablixControl.updateModels(!0,t.visualRows,t.columns),this.createTotalsRow(this.dataView)),r=(this.tablixControl.rowDimension.setFooter(o),this.tablixControl.viewport=this.currentViewport,this.shouldClearControl(e,this.dataView));setTimeout(function(){i.refreshControl(r);var e=i.columnWidthManager.onColumnsRendered(i.tablixControl.layoutManager.columnWidthsToPersist);i.persistingObjects&&!e&&(i.persistingObjects=!1)},0)},r.prototype.shouldClearControl=function(e,t){return!(this.waitingForSort&&e&&t&&a.DataViewUtils.isMetadataEquivalent(e.metadata,t.metadata))},r.prototype.createTotalsRow=function(e){if(!l.TablixProperties.PropGeneralTableTotals.getValue(e.metadata.objects))return null;var t=e.table.totals;if(!t||0===t.length)return null;for(var i=[],o=0,r=e.table.columns.length;o<r;++o){var n=t[o];i.push(null!=n?n:0===o?this.getLocalizedString("TableTotalLabel"):"")}return{totalCells:i,objects:e.table.totals.objects}},r.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},r.prototype.onColumnHeaderClick=function(e,t){this.waitingForSort=!0,this.hostServices.onCustomSort(o.getCustomSortEventArgs(e,t))},r.prototype.needsMoreData=function(e){var t;return!(this.waitingForData||!this.dataView.metadata||!this.dataView.metadata.segment)&&(t=this.tablixControl.rowDimension.getItemsCount()*o.PreferredLoadMoreThreshold,this.hierarchyNavigator.getIndex(e)>=t)},r.prototype.enumerateObjectInstances=function(e){var t=new l.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,t,this.dataView,i.Table),t.complete()},r.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,i.Table),e},r.prototype.shouldAllowHeaderResize=function(){return 1===this.hostServices.getViewMode()},r.prototype.onViewModeChanged=function(e){this.tablixControl&&this.tablixControl.toggleTouchBindings(1!==e),this.updateViewport(this.currentViewport)},r.prototype.verifyHeaderResize=function(){var e=this.shouldAllowHeaderResize();e!==this.lastAllowHeaderResize&&(this.lastAllowHeaderResize=e,this.tablixControl.layoutManager.setAllowHeaderResize(e))},l.Table=r}(powerbi=powerbi||{}),function(d){var p,c,g,m,f,y,s,u,i,e;function t(e,t){this.options=e,t&&this.updateDataView(t)}p=d.visuals||(d.visuals={}),g=d.visuals.controls.internal.TablixUtils.CellStyle,m=d.visuals.controls.internal.TablixUtils.EdgeSettings,f=d.visuals.controls.internal.TablixUtils.EdgeType,y=d.visuals.controls.internal.TablixUtils,s=jsCommon.UrlUtils.UrlScheme,u=jsCommon.UrlUtils,i=jsCommon.WordBreaker,(e=c=p.TableStyler||(p.TableStyler={})).setColumnHeaderStyle=function(e,t,i,o,r){t.fontFamily=y.FontFamilyHeader,t.fontColor=y.FontColorHeaders,t.borders.bottom=new m(p.TablixProperties.PropGridOutlineWeight.defaultValue,r.PropGridOutlineColor.getValue(null));var r=i.grid,n=i.columnHeaders,a=i.total,i=i.values,a=a.outline,l=n.outline,i=i.outline,s=null!=(s=n.outlineWeight)?s:r.outlineWeight,u=null!=(u=n.outlineColor)?u:r.outlineColor;t.borders.top=new m,t.borders.top.applyParams(p.outline.showTop(l),s,u,f.Outline),t.borders.bottom=new m,t.borders.bottom.applyParams(p.outline.showBottom(l),s,u,f.Outline),t.borders.left=new m,e.column.isFirst&&(t.borders.left.applyParams(p.outline.showLeft(l),s,u,f.Outline),p.outline.showLeft(l)||!p.outline.showLeft(a)&&!p.outline.showLeft(i)||(t.paddings.left+=s)),t.borders.right=new m,e.column.isLast?(t.borders.right.applyParams(p.outline.showRight(l),s,u,f.Outline),p.outline.showRight(l)||!p.outline.showRight(a)&&!p.outline.showRight(i)||(t.paddings.right+=s)):t.borders.right.applyParams(r.gridVertical,r.gridVerticalWeight,r.gridVerticalColor,f.Gridline),o&&o.styleHeader&&o.fontColor?t.fontColor=o.fontColor:t.fontColor=n.fontColor,o&&o.styleHeader&&o.backColor?t.backColor=o.backColor:t.backColor=n.backColor,t.paddings.top=t.paddings.bottom=r.rowPadding},e.setBodyCellStyle=function(e,t,i,o,r,n){e.row.isLast||(i.borders.bottom=new m(p.TablixProperties.PropGridHorizontalWeight.defaultValue,n.PropGridHorizontalColor.getValue(null)));var n=o.grid,a=o.values,l=o.total,o=o.columnHeaders,l=l.outline,s=a.outline,o=o.outline,u=null!=(u=a.outlineWeight)?u:n.outlineWeight,h=null!=(h=a.outlineColor)?h:n.outlineColor;i.borders.top=new m,e.row.isFirst&&i.borders.top.applyParams(p.outline.showTop(s),u,h,f.Outline),i.borders.bottom=new m,e.row.isLast?i.borders.bottom.applyParams(p.outline.showBottom(s),u,h,f.Outline):i.borders.bottom.applyParams(n.gridHorizontal,n.gridHorizontalWeight,n.gridHorizontalColor,f.Gridline),i.borders.left=new m,e.column.isFirst&&(i.borders.left.applyParams(p.outline.showLeft(s),u,h,f.Outline),p.outline.showLeft(s)||!p.outline.showLeft(l)&&!p.outline.showLeft(o)||(i.paddings.left+=u)),i.borders.right=new m,e.column.isLast?(i.borders.right.applyParams(p.outline.showRight(s),u,h,f.Outline),p.outline.showRight(s)||!p.outline.showRight(l)&&!p.outline.showRight(o)||(i.paddings.right+=u)):i.borders.right.applyParams(n.gridVertical,n.gridVerticalWeight,n.gridVerticalColor,f.Gridline),t.fontColor?i.fontColor=t.fontColor:r&&r.styleValues&&r.fontColor?i.fontColor=r.fontColor:i.fontColor=e.row.index%2==0?a.fontColorPrimary:a.fontColorSecondary,t.backColor?i.backColor=t.backColor:r&&r.styleValues&&r.backColor?i.backColor=r.backColor:i.backColor=e.row.index%2==0?a.backColorPrimary:a.backColorSecondary,i.paddings.top=i.paddings.bottom=n.rowPadding},e.setFooterBodyCellStyle=function(e,t,i,o,r,n){i.fontFamily=y.FontFamilyTotal,i.borders.top=new m(p.TablixProperties.PropGridOutlineWeight.defaultValue,n.PropGridOutlineColor.getValue(null));var a,l,n=o.total,s=o.grid,u=o.values,o=o.columnHeaders,h=n.outline,u=u.outline,o=o.outline,d=null!=(d=n.outlineWeight)?d:s.outlineWeight,c=null!=(c=n.outlineColor)?c:s.outlineColor;i.borders.top=new m,i.borders.top.applyParams(p.outline.showTop(h),d,c,f.Outline),i.borders.bottom=new m,i.borders.bottom.applyParams(p.outline.showBottom(h),d,c,f.Outline),i.borders.left=new m,e.column.isFirst&&(i.borders.left.applyParams(p.outline.showLeft(h),d,c,f.Outline),p.outline.showLeft(h)||!p.outline.showLeft(u)&&!p.outline.showLeft(o)||(i.paddings.left+=d)),i.borders.right=new m,e.column.isLast?(i.borders.right.applyParams(p.outline.showRight(h),d,c,f.Outline),p.outline.showRight(h)||!p.outline.showRight(u)&&!p.outline.showRight(o)||(i.paddings.right+=d)):i.borders.right.applyParams(s.gridVertical,s.gridVerticalWeight,s.gridVerticalColor,f.Gridline),r&&r.styleTotal&&(a=r.fontColor,l=r.backColor),i.fontColor=t.fontColor||a||n.fontColor,i.backColor=t.backColor||l||n.backColor,i.paddings.top=i.paddings.bottom=s.rowPadding},t.prototype.updateDataView=function(e){this.tableDataView=e,this.formattingProperties=e.formattingProperties,this.updateTextHeights(),this.hasImage()?this.rowHeight=Math.max(this.textHeightValue,this.formattingProperties.grid.imageHeight):this.rowHeight=this.textHeightValue},t.prototype.updateTextHeights=function(){this.fontSizeHeader=this.formattingProperties.general.textSize.px,this.textPropsHeader={fontFamily:y.FontFamilyHeader,fontSize:jsCommon.PixelConverter.toString(this.fontSizeHeader)},this.textHeightHeader=Math.ceil(d.TextMeasurementService.measureSvgTextHeight(this.textPropsHeader,"a")),this.fontSizeValue=this.formattingProperties.general.textSize.px,this.textPropsValue={fontFamily:y.FontFamilyCell,fontSize:jsCommon.PixelConverter.toString(this.fontSizeValue)},this.textHeightValue=Math.ceil(d.TextMeasurementService.measureSvgTextHeight(this.textPropsValue,"a")),this.fontSizeTotal=this.formattingProperties.general.textSize.px,this.textPropsTotal={fontFamily:y.FontFamilyTotal,fontSize:jsCommon.PixelConverter.toString(this.fontSizeTotal)},this.textHeightTotal=Math.ceil(d.TextMeasurementService.measureSvgTextHeight(this.textPropsTotal,"a"))},t.prototype.hasImage=function(){return _.some(this.tableDataView.columns,function(e){return p.converterHelper.isImageUrlColumn(e)})},t.prototype.getColumnFormatting=function(e){return this.formattingProperties.columnFormatting[e.queryName]},t.prototype.onStartRenderingSession=function(){},t.prototype.onEndRenderingSession=function(){},t.prototype.bindRowHeader=function(e,t){e.totalCells?t.contentHeight=this.textHeightTotal:t.contentHeight=this.rowHeight,y.clearCellStyle(t),this.options.onBindRowHeader&&this.options.onBindRowHeader(e)},t.prototype.unbindRowHeader=function(e,t){},t.prototype.bindColumnHeader=function(t,e){var i,o=this,r=(e.extension.disableDragResize(),y.resetCellCssClass(e),y.addCellCssClass(e,y.CssClassTablixHeader),y.addCellCssClass(e,y.CssClassTablixColumnHeaderLeaf),new g),n=(c.setColumnHeaderStyle(e.position,r,this.formattingProperties,this.getColumnFormatting(t),this.options.tablixProperties),e.extension.contentHost),a=((n=y.appendDiv(n)).classList.add(y.CssClassWrappingContainer),this.getWordWrappingWidth(t.queryName,e,r)),l=(i=null!=a?this.getWordWrappingLines(t.displayName,a):i)&&1<i.length;if(l){e.contentHeight=i.length*this.textHeightHeader;for(var s=0,u=i.length;s<u-1;s++)y.appendDiv(n,i[s]);n=y.appendDiv(n)}else e.contentHeight=this.textHeightHeader;this.sortIconsEnabled()&&(n=y.addSortIconToColumnHeader(t.sort,n),t.sort)&&!l&&(e.contentWidth=this.fontSizeHeader+y.SortIconPadding);var h=t.displayName;l?(l=_.last(i),y.setCellText(l,n),y.setCellTooltip(h,e.extension.contentHost),e.contentWidth=a):(y.setCellTextAndTooltip(h,n,e.extension.contentHost),e.contentWidth+=d.TextMeasurementService.measureSvgTextWidth(this.textPropsHeader,h)),e.contentWidth=Math.ceil(e.contentWidth),this.options.onColumnHeaderClick&&e.extension.registerClickHandler(function(e){y.isValidSortClick(e)&&(e=y.reverseSort(t.sort),o.options.onColumnHeaderClick(t.queryName||t.displayName,e))}),e.applyStyle(r)},t.prototype.getWordWrappingLines=function(e,t){return i.splitByWidth(e,this.textPropsHeader,d.TextMeasurementService.measureSvgTextWidth,t,y.WordWrappingMaxLines,void 0,!0)},t.prototype.getWordWrappingWidth=function(e,t,i){var o;if(this.formattingProperties.columnHeaders.wordWrap&&0===this.options.layoutKind&&(t.isColumnResizing()&&0<=t.containerWidth?o=t.containerWidth:this.options.columnWidthManager&&(o=this.options.columnWidthManager.getPersistedColumnWidth(e)),null!=o))return Math.max(0,o-(i.getExtraLeft()+i.getExtraRight()))},t.prototype.unbindColumnHeader=function(e,t){y.clearCellStyle(t),y.clearCellTextAndTooltip(t),this.sortIconsEnabled()&&y.removeSortIcons(t),this.options.onColumnHeaderClick&&t.extension.unregisterClickHandler()},t.prototype.bindBodyCell=function(e,t){y.resetCellCssClass(t),this.setBodyContent(e,t),t.contentWidth=Math.ceil(t.contentWidth),e.isTotal?(y.addCellCssClass(t,y.CssClassTablixValueTotal),y.addCellCssClass(t,y.CssClassTableFooter)):e.position.row.isLast?y.addCellCssClass(t,y.CssClassTableBodyCellBottom):y.addCellCssClass(t,y.CssClassTableBodyCell),e.isNumeric&&y.addCellCssClass(t,y.CssClassTablixValueNumeric);var i=new g;e.isTotal?c.setFooterBodyCellStyle(t.position,e,i,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixProperties):c.setBodyCellStyle(t.position,e,i,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixProperties),t.applyStyle(i)},t.prototype.setBodyContent=function(e,t){var i,o,r=t.extension.contentHost,n=this.formattingProperties.grid.imageHeight,a=e.textContent,l=(e.isTotal?t.contentHeight=this.textHeightTotal:e.isImage?t.contentHeight=n:t.contentHeight=this.textHeightValue,y.getUrlScheme(e.columnMetadata,e.textContent));l!==s.NONE?(o=void 0,(i=this.formattingProperties.values.urlIcon)&&(o=y.getUrlIconName(l)),i&&null!=o?y.appendATagToBodyCell(a,r,o):y.appendATagToBodyCell(a,r),t.contentWidth=i?this.fontSizeValue:d.TextMeasurementService.measureSvgTextWidth(this.textPropsValue,a)):e.isImage&&u.isValidImageUrl(a)?(y.appendImgTagToBodyCell(a,r,n),t.contentWidth=n*y.ImageDefaultAspectRatio):(l=e.kpiContent)?($(r).append(l),t.contentWidth=this.fontSizeValue):a?(y.setCellTextAndTooltip(a,r),e.isTotal?t.contentWidth=d.TextMeasurementService.measureSvgTextWidth(this.textPropsTotal,a):t.contentWidth=d.TextMeasurementService.measureSvgTextWidth(this.textPropsValue,a)):(y.setCellTextAndTooltip(" ",r),t.contentWidth=0)},t.prototype.unbindBodyCell=function(e,t){y.clearCellStyle(t),y.clearCellTextAndTooltip(t)},t.prototype.bindCornerCell=function(e,t){t.contentWidth=0},t.prototype.unbindCornerCell=function(e,t){},t.prototype.bindEmptySpaceHeaderCell=function(e){},t.prototype.unbindEmptySpaceHeaderCell=function(e){},t.prototype.bindEmptySpaceFooterCell=function(e){},t.prototype.unbindEmptySpaceFooterCell=function(e){},t.prototype.getHeaderLabel=function(e){return e?e.displayName:""},t.prototype.getCellContent=function(e){return e},t.prototype.hasRowGroups=function(){return!1},t.prototype.sortIconsEnabled=function(){return 0===this.options.layoutKind},e=t,p.TableBinder=e}(powerbi=powerbi||{}),function(i){var e,s,u;function h(e,t,i,o){this.tableDataView=e,this.isDataComplete=t,this.formatters=i,this.tablixProperties=o}e=i.visuals||(i.visuals={}),s=i.visuals.controls.internal.TablixUtils.CellPosition,u=i.visuals.controls.internal.TablixUtils.TablixVisualCell,h.prototype.getColumnHierarchyDepth=function(){return 1},h.prototype.getRowHierarchyDepth=function(){return 1},h.prototype.getLeafCount=function(e){return e.length},h.prototype.getLeafAt=function(e,t){return e[t]},h.prototype.getParent=function(e){return null},h.prototype.getIndex=function(e){return e?this.isRow(e)?e.index:this.getColumnIndex(e):-1},h.prototype.isRow=function(e){return!!e&&void 0!==e.index&&void 0!==e.values},h.prototype.getColumnIndex=function(e){return h.getIndex(this.tableDataView.columns,e)},h.prototype.isLeaf=function(e){return!0},h.prototype.isRowHierarchyLeaf=function(e){return!1},h.prototype.isColumnHierarchyLeaf=function(e){return!0},h.prototype.isFirstItem=function(e,t){return e===t[0]},h.prototype.areAllParentsFirst=function(e,t){return this.isFirstItem(e,t)},h.prototype.isLastItem=function(e,t){return(t===this.tableDataView.columns||this.isDataComplete)&&e===_.last(t)},h.prototype.areAllParentsLast=function(e,t){return this.isLastItem(e,t)},h.prototype.getChildren=function(e){return null},h.prototype.getChildrenLevelDifference=function(e){return 1/0},h.prototype.getCount=function(e){return e.length},h.prototype.getAt=function(e,t){return e[t]},h.prototype.getLevel=function(e){return 0},h.prototype.getIntersection=function(e,t){var i=!1,o=new s,r=h.getIndex(this.tableDataView.columns,t);o.column.index=r,o.column.isFirst=0===r,o.column.isLast=r===this.tableDataView.columns.length-1;var n,a=null!=e.totalCells?(i=!0,n=e.totalCells[r],e.objects&&e.objects[r]):(a=(l=e).index,o.row.index=a,o.row.isFirst=0===a,o.row.isLast=this.isDataComplete&&a===this.tableDataView.rows.length-1,n=l.values[r],l.values.objects&&l.values.objects[r]),l=new u(n,a,!1,!1,i,!1,t,this.formatters[t.queryName]);return l.position=o,e&&e.values&&(n=e.values.objects)&&(a=n[r])&&(l.backColor=this.tablixProperties.PropValuesBackColor.getValue(a)),l},h.prototype.getCorner=function(e,t){return null},h.prototype.headerItemEquals=function(e,t){return e===t||(e.displayName&&t.displayName?i.DataViewUtils.areMetadataColumnsEquivalent(e,t):!(!this.isRow(e)||!this.isRow(t))&&e.index===t.index)},h.prototype.bodyCellItemEquals=function(e,t){return e.isMatch(t)},h.prototype.cornerCellItemEquals=function(e,t){return!0},h.prototype.update=function(e,t,i){this.tableDataView=e,this.isDataComplete=t,this.formatters=i},h.getIndex=function(e,t){for(var i=0,o=e.length;i<o;i++){var r=e[i];if(null!=r.index&&null!=t.index&&r.index===t.index)return i;if(t===e[i])return i}return-1},e.TableHierarchyNavigator=h}(powerbi=powerbi||{}),function(C){var P,b,r,d,w,x,v,c,H,S,T;function e(e,t,i,o,r){this.a11yMatrixFS=r,this.options=e,this.selectionManager=t,this.measureElement=P.PivotTableBinderUtils.addMeasureElement(i),this.legacyTooltipsEnabled=!0,this.hostServices=o}P=C.visuals||(C.visuals={}),b=jsCommon.CssConstants,r=C.visuals.controls.internal.TablixUtils.CellStyle,d=P.controls.pivotTable.ElementBuilder,w=jsCommon.StringExtensions.encodeHtml,x=jsCommon.Utility,v=P.Units.FontSize,c=C.visuals.controls.internal.TableExUtils,H=C.visuals.controls.internal.TablixUtils,S=jsCommon.UrlUtils.UrlScheme,T=jsCommon.UrlUtils,e.prototype.setFormatMode=function(e){this.formatMode=e},e.prototype.getRowHeaderBinding=function(e,t,i,o,r,n,a){var l,s;return this.a11yMatrixFS?(this.options.onBindRowHeader&&this.options.onBindRowHeader(e),l=this.hostServices.getLocalizedString(H.SelectRow),s="gridcell",null!=(null==a?void 0:a.dataPoint)&&(l=this.hostServices.getLocalizedString("Visual_Tablix_ReferenceRowWithText",a.dataPoint.toString()),s="rowheader"),a={attributes:{role:s},classNames:[],styleProperties:{},children:[]},n||(a.children=[{tagName:"label",attributes:{},classNames:["visually-hidden"],styleProperties:{},children:[{tagName:"input",attributes:{type:"checkbox","checkbox-rowindex":e.index.toString()},classNames:[],styleProperties:{}},{tagName:null,content:l,attributes:{},classNames:[],styleProperties:{}}]}],this.selectionManager.isItemSelected(e)&&(a.children[0].children[0].attributes.checked="")),a):(this.options.onBindRowHeader&&!t&&this.options.onBindRowHeader(e),i&&!t&&this.selectionManager.isItemSelected(e)?{attributes:{},classNames:[],styleProperties:{background:"black",border:"1px solid white",width:"4px",top:(s=this.getBorderInfo(o,r,void 0,void 0,void 0,P.controls.pivotTable.TablixSection.Body)).weightTop+"px",bottom:s.weightBottom+"px",position:"absolute"}}:{content:"",classNames:null,styleProperties:null,attributes:void 0})},e.prototype.getColumnHeaderBinding=function(e,t,i,o){var r=this.formattingProperties.columnHeaders,n=this.formattingProperties.columnFormatting[e.metadata.queryName],a=w(this.getColumnHeaderLabel(e)),l={},s=P.TableExSortingManager.getSortDirection(e),u=(i&&(l.role="columnheader",l["aria-colindex"]=c.getAriaColIndex(e.position.column.index).toString(),1===s?l["aria-sort"]="ascending":2===s&&(l["aria-sort"]="descending")),!this.a11yMatrixFS&&this.legacyTooltipsEnabled&&(l.title=a),_.isEmpty(a)&&(a=H.StringNonBreakingSpace),r.wordWrap&&(a=P.PivotTableBinderUtils.replaceEncodedNewLines(a)),!_.isEmpty(a.trim())),u=this.getColumnHeaderStyle(e,t,u),h=u.getExtraBottom(),s=(u.paddings.bottom+=P.PivotTableBinderUtils.getSortIconHeight(this.glyphFontInfo.measuredFontHeight),P.PivotTableBinderUtils.buildSortIcon(s,this.options.sortIconEnabled,this.options.sortingEnabled,P.PivotTableSortingManager.getDefaultSortDirection(e.metadata),h,this.glyphFontInfo.textProperties.fontSize)),h=(a+=d.build(s,{}),C.Prototype.inherit(this.columnHeaderClasses)),s=(o&&this.formatMode&&(h.push(P.HtmlSubSelectableClass),l[P.SubSelectableObjectNameAttribute]="".concat("columnHeaders"),l[P.SubSelectableTypeAttribute]="".concat(1),l[P.SubSelectableDisplayNameAttribute]="Visual_Tablix_ColumnHeaders"),n&&n.styleHeader&&n.alignment||r.alignment);return P.PivotTableBinderUtils.addAlignmentCssClass(s,h),null!=(o=this.isHeaderAutoWidth)&&o.call(this,e)&&(u.maxWidth=this.getMeasureElementMaxWidth(t)),{content:a,classNames:h,styleProperties:u.getAttributes(i,void 0,this.a11yMatrixFS),attributes:l}},e.prototype.getRowReferenceQueryName=function(){return this.formattingProperties.rowWithReferenceText.rowWithReferenceText},e.prototype.getRowBinding=function(e,t,i,o){this.options.onBindRowHeader&&this.options.onBindRowHeader(e);var r=this.hostServices.getLocalizedString(H.SelectRow),n="gridcell",i=(null!=(null==i?void 0:i.dataPoint)&&(r=this.hostServices.getLocalizedString("Visual_Tablix_ReferenceRowWithText",i.dataPoint.toString()),n="rowheader"),{classNames:[],attributes:{},styleProperties:{},children:[this.getCheckboxCellBinding(e,t,r,o,n)]});return this.selectionManager.isRowHighlighted(e)?this.selectionManager.isItemSelected(e)&&i.classNames.push("row-selected"):i.classNames.push("row-unselected"),this.formatMode&&i.classNames.push("format-mode"),i},e.prototype.getCheckboxCellBinding=function(e,t,i,o,r){r={attributes:{role:r,"aria-colindex":"1",tabindex:"0","selection-cell":""},classNames:["cell-interactive"],styleProperties:{position:"absolute","box-sizing":"border-box",width:"100%",height:"100%","--outline-top":o.weightTop+1+"px","--outline-right":o.weightRight+1+"px","--outline-bottom":o.weightBottom+1+"px","--outline-left":o.weightLeft+1+"px"}};return t||(r.children=[{tagName:"label",attributes:{},classNames:["visually-hidden"],styleProperties:{},children:[{tagName:"input",attributes:{type:"checkbox","checkbox-rowindex":e.index.toString()},classNames:[],styleProperties:{}},{tagName:null,content:i,attributes:{},classNames:[],styleProperties:{}}]}],this.selectionManager.isItemSelected(e)&&(r.children[0].children[0].attributes.checked="")),r},e.prototype.getHorizontalBorderBindings=function(e,t,i,o,r,n,a){var l,t=r!==P.controls.pivotTable.TablixSection.Body||this.selectionManager.isBodyCellHighlighted(e)||this.selectionManager.isRowHighlighted(t),t=r===P.controls.pivotTable.TablixSection.Body?this.getBorderInfo(e.position.row.isFirst,e.position.row.isLast,e.position.column.isFirst,e.position.column.isLast,t,r):this.getBorderInfo(!0,!0,e.position.column.isFirst,e.position.column.isLast,t,r);0<t.weightTop&&(l=i+t.weightTop/2,r={tagName:"line",attributes:{"border-row-index":e.position.row.index.toString(),x1:"0",y1:l.toString(),x2:"100%",y2:l.toString()},classNames:["border-top"],styleProperties:{stroke:t.colorTop,"stroke-width":t.weightTop.toString()}},(t.typeTop===H.EdgeType.Gridline?n:a).push(r)),0<t.weightBottom&&(l=i+o-t.weightBottom/2,r={tagName:"line",attributes:{"border-row-index":e.position.row.index.toString(),x1:"0",y1:l.toString(),x2:"100%",y2:l.toString()},classNames:["border-bottom"],styleProperties:{stroke:t.colorBottom,"stroke-width":t.weightBottom.toString()}},(t.typeBottom===H.EdgeType.Gridline?n:a).push(r))},e.prototype.getVerticalBorderBindings=function(e,t,i,o,r,n,a){var l,t=r!==P.controls.pivotTable.TablixSection.Body||this.selectionManager.isBodyCellHighlighted(e)||this.selectionManager.isRowHighlighted(t),t=r===P.controls.pivotTable.TablixSection.Body?this.getBorderInfo(e.position.row.isFirst,e.position.row.isLast,e.position.column.isFirst,e.position.column.isLast,t,r):this.getBorderInfo(!0,!0,e.position.column.isFirst,e.position.column.isLast,t,r);0<t.weightLeft&&(l=i+t.weightLeft/2,r={tagName:"line",attributes:{"border-column-index":e.position.column.index.toString(),x1:l.toString(),y1:"0",x2:l.toString(),y2:"100%"},classNames:["border-left"],styleProperties:{stroke:t.colorLeft,"stroke-width":t.weightLeft.toString()}},(t.typeLeft===H.EdgeType.Gridline?n:a).push(r)),0<t.weightRight&&(l=i+o-t.weightRight/2,r={tagName:"line",attributes:{"border-column-index":e.position.column.index.toString(),x1:l.toString(),y1:"0",x2:l.toString(),y2:"100%"},classNames:["border-right"],styleProperties:{stroke:t.colorRight,"stroke-width":t.weightRight.toString()}},(t.typeRight===H.EdgeType.Gridline?n:a).push(r))},e.prototype.getBodyCellBinding=function(e,t,i,o,r,n,a){var l,s,u,h,d,c,p=w(this.getBodyCellContent(e)),g=(!this.a11yMatrixFS&&this.legacyTooltipsEnabled&&(l={title:p}),!_.isEmpty(p.trim())),g=this.getBodyCellStyle(e,t,g),m=e.columnMetadata,f=this.columnsDataBarsSettings[e.columnMetadata.queryName],m=this.formattingProperties.columnFormatting[m.queryName],m=C.StructuralObjectValue.merge(m&&m.icon,e.icon),y=e.hyperlink,b=(m&&"IconOnly"===m.layout?p="":(_.isEmpty(p)&&(p=H.StringNonBreakingSpace),e.isKpi?(p=this.getKpiContentString(e),l=null):f&&!e.isTotal&&_.isNumber(e.dataPoint)&&f.hideText?p=t?H.StringNonBreakingSpace:"":(this.formattingProperties.values.wordWrap&&(p=P.PivotTableBinderUtils.replaceEncodedNewLines(p)),(b=H.getUrlScheme(e.columnMetadata,p))!==S.NONE?(s=P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,b),u=P.PivotTableBinderUtils.addHyperlink(p,w(e.textContent),s,this.options.onHyperlinkClicked),y=void 0):this.isImage(e)?(b=x.encodeUriForImageDataSvg(e.textContent),v=this.formattingProperties.grid,u=P.PivotTableBinderUtils.buildImage(w(b),v.imageHeight,v.imageWidth,e.altText)):this.isSparkline(e)&&(p=t?H.StringNonBreakingSpace:""))),this.options.hyperlinksEnabled&&(u||""!==p&&p!==H.StringNonBreakingSpace)&&y&&T.getUrlScheme(y)!==S.NONE&&(u=P.PivotTableBinderUtils.addHyperlink(u||p,w(y),null,this.options.onHyperlinkClicked,!0,!0)),{}),y=(null!=(v=this.isBodyCellAutoWidth)&&v.call(this,e)&&void 0!==(y=this.getMeasureElementMaxWidth(t))&&(b["max-width"]=y),this.a11yMatrixFS&&!t&&e.position.column.isFirst&&(c=this.selectionManager.getRowFromCell(e),this.selectionManager.isItemSelected(c))&&(v=e.position.row.isFirst,y=e.position.row.isLast,v=this.getBorderInfo(v,y,!0,!1,!0,P.controls.pivotTable.TablixSection.Body),a=(y=a&&this.selectionManager.getRowFromCell(a))&&this.selectionManager.isItemSelected(y)?"0":v.weightBottom+"px",h={attributes:{"aria-hidden":"true"},classNames:[],styleProperties:{width:"100%",top:v.weightTop+"px",bottom:a,left:v.weightLeft+"px",position:"absolute","box-sizing":"border-box",overflow:"hidden","pointer-events":"none"},children:[{tagName:"svg",attributes:{height:"100%",width:"100%"},classNames:[],styleProperties:{left:"0",top:"0",position:"absolute"},children:[{tagName:"line",attributes:{x1:"1",y1:"0",x2:"1",y2:"100%",stroke:"white","stroke-width":"2"},classNames:[],styleProperties:{}},{tagName:"line",attributes:{x1:"3",y1:"0",x2:"3",y2:"100%",stroke:"black","stroke-width":"2"},classNames:[],styleProperties:{}}]}]}),u=u?{tagName:"div",children:[u],classNames:[],styleProperties:b,attributes:{}}:{tagName:"div",content:p,classNames:[],styleProperties:b,attributes:{}}),v=(m&&(d=this.getBodyCellFontInfo(e).measuredFontHeight,y=P.PivotTableBinderUtils.addIconToCell(m,d,u,this.hostServices)),f&&!t&&!e.isTotal&&_.isNumber(e.dataPoint)&&(y=P.PivotTableBinderUtils.addDataBarsToCell(y,f,g,e.dataPoint,this.hostServices)),!t&&this.isSparkline(e)&&(a=e.dataPoint,y=P.PivotTableBinderUtils.addSparklineToCell(y,this.sparklineSettings[e.columnMetadata.queryName],g,a,i,o,m,d)),this.hostServices.getLocalizedString(H.AdditionalConditionalFormatting));return r&&(e.fontColor||e.backColor)&&(_.isEmpty(y.children)?y={attributes:{},classNames:[],styleProperties:{},children:[y,{attributes:{},classNames:["visually-hidden"],styleProperties:{},content:v}]}:y.children.push({attributes:{},classNames:["visually-hidden"],styleProperties:{},content:v})),this.a11yMatrixFS&&h&&(_.isEmpty(y.children)?y={attributes:{},classNames:[],styleProperties:{},children:[y,h]}:y.children.push(h)),n&&this.formatMode&&((l=null!=l?l:{})[P.SubSelectableTypeAttribute]="".concat(1),p=e.columnMetadata.isMeasure,e.isRowGrandTotal||e.isTotal?p||""===e.textContent?(y.classNames.push(P.HtmlSubSelectableClass),l[P.SubSelectableObjectNameAttribute]="".concat("totals"),l[P.SubSelectableDisplayNameAttribute]="Visual_Tablix_TotalsSection"):""!==e.textContent&&(y.classNames.push(P.HtmlSubSelectableClass),l[P.SubSelectableObjectNameAttribute]="".concat("total-labels"),l[P.SubSelectableDisplayNameAttribute]="Visual_Tablix_TotalsSection_Label",b={reference:{cardUid:void 0,sliceUid:"".concat("totals","-").concat("values","-totalLabel")},style:0},l[P.SubSelectableDirectEdit]=JSON.stringify(b).replace(/\"/g,"&quot;")):(y.classNames.push(P.HtmlSubSelectableClass),l[P.SubSelectableObjectNameAttribute]="".concat(p?"measure-values":"values"),l[P.SubSelectableDisplayNameAttribute]="Visual_Tablix_Values")),this.a11yMatrixFS&&(c=this.selectionManager.getRowFromCell(e),this.selectionManager.isBodyCellHighlighted(e)?this.selectionManager.isItemSelected(c)&&y.classNames.push("cell-selected"):y.classNames.push("cell-unselected")),this.addBodyCellClasses(e,!!s,u.classNames,y.classNames),this.addBodyCellStyleAttributes(e,g,y.styleProperties,r),y.attributes=l,y},e.prototype.getMeasureElementMaxWidth=function(e){return this.formattingProperties.values.wordWrap&&e&&this.getViewport?"".concat(this.getViewport().width-C.visuals.controls.pivotTable.ScrollbarWidth-3,"px"):void 0},e.prototype.getCornerCellBinding=function(e,t,i){return i?{content:this.hostServices.getLocalizedString(P.controls.internal.TablixUtils.RowSelection),classNames:["visually-hidden"],attributes:{role:"columnheader","aria-colindex":"1",tabindex:"0"},styleProperties:{}}:{content:"",classNames:null,styleProperties:null,attributes:void 0}},e.prototype.getApproximateRowHeaderWidth=function(e){return 0},e.prototype.getApproximateColumnHeaderWidth=function(e){var t=this.getColumnHeaderStyle(e,!0,!0);return P.PivotTableBinderUtils.measureText(this.getColumnHeaderLabel(e),this.getColumnHeaderFontInfo(e).textProperties)+(null!=(e=null==(e=t.borders.left)?void 0:e.weight)?e:0)+(null!=(t=null==(e=t.borders.right)?void 0:e.weight)?t:0)},e.prototype.getApproximateBodyCellWidth=function(e){var t,i,o=0;if(e.icon){if(o=this.getBodyCellFontInfo(e).measuredFontHeight,"IconOnly"===e.icon.layout)return o;o+=P.PivotTableBinderUtils.TablixIconMargin}return e.isKpi?o+this.valueFontInfo.fontProperties.size.px:(t=e.columnMetadata&&this.columnsDataBarsSettings[e.columnMetadata.queryName])&&t.hideText&&!e.isTotal&&_.isNumber(e.dataPoint)?o:(t=this.getBodyCellContent(e),(i=H.getUrlScheme(e.columnMetadata,t))!==S.NONE&&P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,i)?o+this.valueFontInfo.fontProperties.size.px:this.isImage(e)?o+this.formattingProperties.grid.imageWidth:this.isSparkline(e)?o:(i=this.getBodyCellFontInfo(e),e=this.getBodyCellStyle(e,!0,!0),o+P.PivotTableBinderUtils.measureText(t,i.textProperties)+(null!=(t=null==(o=e.borders.left)?void 0:o.weight)?t:0)+(null!=(o=null==(i=e.borders.right)?void 0:i.weight)?o:0)))},e.prototype.getApproximateCornerCellWidth=function(e){return 0},e.prototype.getApproximateRowHeaderHeight=function(e,t){return 0},e.prototype.getApproximateColumnHeaderHeight=function(e,t){var i=this.getColumnHeaderFontInfo(e),o=this.getColumnHeaderStyle(e,!0,!0),e=this.formattingProperties.columnHeaders.wordWrap&&null!=t?P.PivotTableBinderUtils.getWordWrappingLines(this.getColumnHeaderLabel(e),P.PivotTableBinderUtils.getNetWidth(t,o),i.textProperties).length:1,t=null!=(t=null==(t=o.borders.top)?void 0:t.weight)?t:0,o=null!=(o=null==(o=o.borders.bottom)?void 0:o.weight)?o:0;return i.measuredFontHeight*e+t+o},e.prototype.getApproximateBodyCellHeight=function(e,t){var i,o,r=this.getBodyCellFontInfo(e);return e.icon&&"IconOnly"===e.icon.layout?r.measuredFontHeight:e.isKpi||(o=this.getBodyCellContent(e),(i=H.getUrlScheme(e.columnMetadata,o))!==S.NONE&&P.PivotTableBinderUtils.getUrlIconName(this.formattingProperties.values.urlIcon,i))?this.valueFontInfo.fontProperties.size.px:this.isImage(e)?this.formattingProperties.grid.imageHeight:this.isSparkline(e)?r.measuredFontHeight:(i=this.getBodyCellStyle(e,!0,!0),e=this.formattingProperties.values.wordWrap&&null!=t?(e.icon&&(t-=r.measuredFontHeight+P.PivotTableBinderUtils.TablixIconMargin),P.PivotTableBinderUtils.getWordWrappingLines(o,P.PivotTableBinderUtils.getNetWidth(t,i),r.textProperties).length):1,o=null!=(t=null==(o=i.borders.top)?void 0:o.weight)?t:0,t=null!=(i=null==(t=i.borders.bottom)?void 0:t.weight)?i:0,r.measuredFontHeight*e+o+t)},e.prototype.getApproximateCornerCellHeight=function(e,t){return 0},e.prototype.updateFormattingProperties=function(e,t,i,o){this.formattingProperties=t,this.legacyTooltipsEnabled=o;var r,o=t.general.textSize,n=new P.PivotTableBinderUtils.FontInfoMeasurer,a={},l={},s={},a=(a.family=t.columnHeaders.fontFamily||H.FontFamilyHeader,a.size=t.columnHeaders.fontSize||o,t.columnHeaders.bold&&(a.weight=b.boldValue),t.columnHeaders.italic&&(a.style=b.italicValue),t.columnHeaders.underline&&(a.textDecoration=b.underlineValue),this.columnHeaderContainerFontInfo=P.PivotTableBinderUtils.createFontInfo(a,n),this.columnHeaderFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.columnHeaderContainerFontInfo,{},n),l.family=t.values.fontFamily||H.FontFamilyCell,l.size=t.values.fontSize||o,t.values.bold&&(l.weight=b.boldValue),t.values.italic&&(l.style=b.italicValue),t.values.underline&&(l.textDecoration=b.underlineValue),this.valueContainerFontInfo=P.PivotTableBinderUtils.createFontInfo(l,n),this.valueFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.valueContainerFontInfo,{},n),t.total.fontFamily),u=(a||this.valueFontInfo.fontProperties.family!==H.FontFamilyCell?r=!0:this.valueFontInfo.fontProperties.family===H.FontFamilyCell&&(a=H.FontFamilyTotal),s.family=a,s.size=t.total.fontSize,t.total.bold&&r&&(s.weight=b.boldValue),t.total.italic&&(s.style=b.italicValue),t.total.underline&&(s.textDecoration=b.underlineValue),this.totalFontInfo=P.PivotTableBinderUtils.overrideFontInfo(this.valueFontInfo,s,n),this.glyphFontInfo=P.PivotTableBinderUtils.createFontInfo({family:H.FontFamilyGlyphs,size:v.createFromPt((t.columnHeaders.fontSize||o).pt*H.SortIconFontSizeRatio),lineHeight:"100%"},n),n.measureAll(this.measureElement),this.columnHeaderClasses=[],this.formattingProperties.columnHeaders.wordWrap?this.columnHeaderClasses.push(P.PivotTableBinderUtils.cssPivotTableCellClassWrap):this.columnHeaderClasses.push(P.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),this.options.interactivityIndicatorEnabled&&this.options.sortingEnabled&&this.columnHeaderClasses.push(P.PivotTableBinderUtils.cssClassCellInteractive),this.columnsDataBarsSettings={},t.columnFormatting);if(u&&e&&e.table&&!_.isEmpty(e.table.columns))for(var h=0,d=e.table.columns;h<d.length;h++)(f=(m=d[h]).queryName)&&u[f]&&(this.columnsDataBarsSettings[f]=P.PivotTableBinderUtils.getColumnDataBarsSettings(m,u[f].dataBarsSettings,i));this.sparklineSettings={};var c=t.sparklines;if(c&&e&&e.table&&!_.isEmpty(e.table.columns))for(var p=0,g=e.table.columns;p<g.length;p++){var m,f=(m=g[p]).queryName,y=m.type;f&&c[f]&&(this.sparklineSettings[f]=P.PivotTableBinderUtils.getSparklineSettings(c[f],y,i))}},e.prototype.getColumnHeaderContainerFontInfo=function(){return this.columnHeaderContainerFontInfo},e.prototype.getValueContainerFontInfo=function(){return this.valueContainerFontInfo},e.prototype.getColumnHeaderLabel=function(e){var e=e.metadata.displayName,t=this.formattingProperties.columnHeaders.wordWrap;return this.ensureMeasuringSafeText(e,t)},e.prototype.getBodyCellContent=function(e){var e=e.textContent,t=this.formattingProperties.values.wordWrap;return this.ensureMeasuringSafeText(e,t)},e.prototype.ensureMeasuringSafeText=function(e,t){return e?t?_.isEmpty(e.trim())?"":e:P.TextUtil.replaceNewlineAndSpaceWithNBSP(e):""},e.prototype.addBodyCellStyleAttributes=function(e,t,i,o){t.setAttributes(i,o,void 0,this.a11yMatrixFS),i.position="relative",this.a11yMatrixFS||this.selectionManager.isBodyCellHighlighted(e)||o||P.PivotTableBinderUtils.setUnselectedStyle(i)},e.prototype.getColumnHeaderStyle=function(e,t,i){var o=new r(P.PivotTableBinderUtils.CellHorizontalPadding,P.PivotTableBinderUtils.CellHorizontalPadding);return P.TableStyler.setColumnHeaderStyle(e.position,o,this.formattingProperties,this.getColumnFormatting(e.metadata),this.options.tablixProperties),o.fontFamily=void 0,this.formattingProperties.columnHeaders.underline&&i&&(o.textDecoration=b.underlineValue),this.a11yMatrixFS&&P.PivotTableBinderUtils.applyFontInfo(this.columnHeaderContainerFontInfo,o,!t,i),P.PivotTableBinderUtils.applyFontInfo(this.columnHeaderFontInfo,o,!t,i),o},e.prototype.getBodyCellStyle=function(e,t,i){var o=new r(P.PivotTableBinderUtils.CellHorizontalPadding,P.PivotTableBinderUtils.CellHorizontalPadding);return e.isRowGrandTotal?(P.TableStyler.setFooterBodyCellStyle(e.position,e,o,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixProperties),this.formattingProperties.total.underline&&i&&(o.textDecoration=b.underlineValue),this.a11yMatrixFS&&P.PivotTableBinderUtils.applyFontInfo(this.valueContainerFontInfo,o,!t,i),P.PivotTableBinderUtils.applyFontInfo(this.totalFontInfo,o,!t,i)):(P.TableStyler.setBodyCellStyle(e.position,e,o,this.formattingProperties,this.getColumnFormatting(e.columnMetadata),this.options.tablixProperties),this.formattingProperties.values.underline&&i&&(o.textDecoration=b.underlineValue),this.a11yMatrixFS&&P.PivotTableBinderUtils.applyFontInfo(this.valueContainerFontInfo,o,!t,i),P.PivotTableBinderUtils.applyFontInfo(this.valueFontInfo,o,!t,i)),o},e.prototype.getBorderInfo=function(e,t,i,o,r,n){var a,l,s,u,h,d,c,p,g,m=0,f=0,y=0,b=0;switch(n){case P.controls.pivotTable.TablixSection.Header:g=this.formattingProperties.columnHeaders;break;case P.controls.pivotTable.TablixSection.Body:g=this.formattingProperties.values;break;case P.controls.pivotTable.TablixSection.Footer:g=this.formattingProperties.total}var n=null!=(n=g.outlineWeight)?n:this.formattingProperties.grid.outlineWeight,v=null!=(v=g.outlineColor)?v:this.formattingProperties.grid.outlineColor,C=null==(C=this.formattingProperties.grid)?void 0:C.gridHorizontalColor,w=null==(w=this.formattingProperties.grid)?void 0:w.gridVerticalColor,x=jsCommon.Color.hexBlend("#FFFFFF",.67,C),S=jsCommon.Color.hexBlend("#FFFFFF",.67,w);return e&&P.outline.showTop(g.outline)&&(m=n,a=H.EdgeType.Outline,h=v),o&&P.outline.showRight(g.outline)?(f=n,l=H.EdgeType.Outline,d=v):!o&&this.formattingProperties.grid.gridVertical&&(f=this.formattingProperties.grid.gridVerticalWeight,l=H.EdgeType.Gridline,d=this.selectionManager.isSelectionEmpty()?w:S),t&&P.outline.showBottom(g.outline)?(y=n,s=H.EdgeType.Outline,c=v):!t&&this.formattingProperties.grid.gridHorizontal&&(y=this.formattingProperties.grid.gridHorizontalWeight,s=H.EdgeType.Gridline,c=r?C:x),i&&P.outline.showLeft(g.outline)&&(b=n,u=H.EdgeType.Outline,p=v),{weightTop:m,weightRight:f,weightBottom:y,weightLeft:b,typeTop:a,typeRight:l,typeBottom:s,typeLeft:u,colorTop:h,colorRight:d,colorBottom:c,colorLeft:p}},e.prototype.addBodyCellClasses=function(e,t,i,o){var r,n,a=this.formattingProperties.columnFormatting[e.columnMetadata.queryName];this.formattingProperties.values.wordWrap?i.push(P.PivotTableBinderUtils.cssPivotTableCellClassWrap):i.push(P.PivotTableBinderUtils.cssPivotTableCellClassNoWrap),t&&i.push(H.CssClassValueURLIconContainer),this.options.interactivityIndicatorEnabled&&this.options.selectionEnabled&&!e.isRowGrandTotal&&!this.formatMode&&o.push(P.PivotTableBinderUtils.cssClassCellInteractive),a&&(e.isTotal?a.styleTotal:a.styleValues)&&(r=a.alignment),t?n=P.textAlignment.center:e.isNumeric&&(n=P.textAlignment.right),P.PivotTableBinderUtils.addAlignmentCssClass(r,i,n)},e.prototype.getKpiContentString=function(e){return P.PivotTableBinderUtils.createKpiDomString(e.columnMetadata.kpi,e.textContent)},e.prototype.getColumnHeaderFontInfo=function(e){return this.columnHeaderFontInfo},e.prototype.getBodyCellFontInfo=function(e){return e.isRowGrandTotal?this.totalFontInfo:this.valueFontInfo},e.prototype.getColumnFormatting=function(e){return this.formattingProperties.columnFormatting[e.queryName]},e.prototype.isImage=function(e){return!(e.isRowGrandTotal&&!_.isEmpty(e.columnMetadata.identityExprs))&&P.converterHelper.isImageUrlColumn(e.columnMetadata)},e.prototype.isSparkline=function(e){var e=e.columnMetadata,e=null==(e=null==e?void 0:e.type)?void 0:e.misc;return null!=e&&null!=e.sparkline},P.TableExBinder=e}(powerbi=powerbi||{}),function(e){var d,c,p;function t(){}function i(e,t){this.tablixProperties=e,this.hostServices=t}d=e.visuals||(e.visuals={}),c=e.visuals.controls.internal.TablixUtils.CellPosition,p=e.visuals.controls.internal.TablixUtils,t.prototype.getNodeLeafCount=function(){return 1},t.prototype.getIndexOfFirstLeaf=function(e){return e.position.column.index},t.prototype.hasHierarchy=function(){return!0},t.prototype.update=function(e){this.updateColumns(e)},t.prototype.getColumns=function(){return this.columns},t.prototype.getHierarchyDepth=function(){return 1},t.prototype.getHierarchyLeafCount=function(){return _.size(this.columns)},t.prototype.getHierarchyLeafAt=function(e){return this.columns[e]},t.prototype.getFloatingHierarchyLeafCount=function(){return 0},t.prototype.getFloatingHierarchyLeafAt=function(e){return null},t.prototype.getHierarchyItems=function(){return this.columns},t.prototype.getFloatingHierarchyItems=function(){return null},t.prototype.getLeafIndex=function(e){return e.position.column.index},t.prototype.isLeaf=function(e){return!0},t.prototype.isLastItem=function(e,t){return e.position.column.index===t.length-1},t.prototype.getParent=function(e){return null},t.prototype.getChildren=function(e){return null},t.prototype.getLevel=function(e){return 0},t.prototype.getIndex=function(e){return e.position.column.index},t.prototype.getPathIndices=function(e){return[this.getIndex(e)]},t.prototype.getNodeFromPath=function(e){if(1===e.length)return this.columns[e[0]]},t.prototype.getItemsByLevel=function(e){return __spreadArray([],this.columns||[],!0)},t.prototype.getLeafAncestorAtLevel=function(e,t){return e},t.prototype.getExpansionState=function(e){return 2},t.prototype.getFirstDescendentLeafIndex=function(e){return this.getLeafIndex(e)},t.prototype.getIntersection=function(e,t){return null},t.prototype.getCorner=function(e,t){return null},t.prototype.getRowLevel=function(e){return 0},t.prototype.getColumnLevel=function(e){return 0},t.prototype.isColumnHeaderMultiValueSubtotal=function(e){return!1},t.prototype.isRowHeaderMultiValueSubtotal=function(e){return!1},t.prototype.getColumnIndexFromQueryName=function(t){return _.find(this.columns,function(e){return e.metadata.queryName===t})},t.prototype.updateColumns=function(e){this.columns=[];for(var t=e.length,i=0;i<t;i++)this.columns.push({metadata:e[i],position:this.calculateItemPosition(i,t)})},t.prototype.calculateItemPosition=function(e,t){var i=new c;return i.row.index=i.row.indexInSiblings=0,i.row.isFirst=!0,i.row.isLast=!0,i.column.index=i.column.indexInSiblings=e,i.column.isFirst=0===e,i.column.isLast=e===t-1,i},d.TableExColumnHierarchyNavigator=t,i.prototype.update=function(e,t,i,o,r,n){this.isDataComplete=o,this.formattingProperties=n,this.formatters=n.formatters,this.tooltipFormatters=n.tooltipFormatters||{},this.updateRows(e,t),this.updateFloatingRow(i,r)},i.prototype.getNodeLeafCount=function(){return 1},i.prototype.getIndexOfFirstLeaf=function(e){return e.index},i.prototype.hasHierarchy=function(){return!1},i.prototype.getRows=function(){return this.rows},i.prototype.getHierarchyDepth=function(){return 1},i.prototype.getHierarchyLeafCount=function(){return _.size(this.rows)},i.prototype.getHierarchyLeafAt=function(e){return this.rows[e]},i.prototype.getFloatingHierarchyLeafCount=function(){return this.floatingRow?1:0},i.prototype.getFloatingHierarchyLeafAt=function(e){return this.floatingRow},i.prototype.getHierarchyItems=function(){return this.rows},i.prototype.getFloatingHierarchyItems=function(){return this.floatingRow?[this.floatingRow]:null},i.prototype.getLeafIndex=function(e){return e.index},i.prototype.isLeaf=function(e){return!0},i.prototype.isLastItem=function(e,t){return this.isDataComplete&&e.index===t.length-1},i.prototype.getParent=function(e){return null},i.prototype.getIndex=function(e){return e.index},i.prototype.getPathIndices=function(e){return[this.getIndex(e)]},i.prototype.getNodeFromPath=function(e){if(1===e.length)return this.rows[e[0]]},i.prototype.getItemsByLevel=function(e){return[this.rows[0]]},i.prototype.getChildren=function(e){return null},i.prototype.getLevel=function(e){return 0},i.prototype.getLeafAncestorAtLevel=function(e,t){return e},i.prototype.getExpansionState=function(e){return 2},i.prototype.getIntersection=function(e,t){var i,o,r=t.position.column.index,n=e.values[r],r=e.values.objects&&e.values.objects[r],a=t.metadata.queryName,l=t.metadata,s=e===this.floatingRow,u=(_.isString(n)&&null!=(u=null==(u=null==l?void 0:l.type)?void 0:u.misc)&&u.sparkline&&(n=d.PivotTableBinderUtils.parseSparklineData(n,this.hostServices)),new c),t=t.position,h=(u.column.index=t.column.index,u.column.isFirst=t.column.isFirst,u.column.isLast=t.column.isLast,e.index),t=(u.row.index=h,u.row.isFirst=0===h,u.row.isLast=this.isDataComplete&&e===_.last(this.rows),s&&!l.isMeasure&&0===t.column.index?i=o=this.formattingProperties.total.totalLabel:(h=this.formatters[a],e=this.tooltipFormatters[a],i=h?h.format(n,r):null!=n?"".concat(n):"",o=e?e.format(n,r):i),{position:u,dataPoint:n,isRowGrandTotal:s,columnMetadata:l,isTotal:s,textContent:i,tooltipContent:o,isKpi:l&&p.isValidStatusGraphic(l.kpi,i),isNumeric:l&&l.type.numeric&&!l.kpi});return r&&(t.backColor=this.tablixProperties.PropValuesBackColor.getValue(r),t.fontColor=this.tablixProperties.PropValuesFontColor.getValue(r),t.icon=d.TablixProperties.PropValuesIcon.getValue(r),t.hyperlink=d.TablixProperties.PropValuesWebURL.getValue(r),t.altText=d.TablixProperties.PropAltTextValue.getValue(r)),t},i.prototype.getCorner=function(e,t){return{}},i.prototype.getRowLevel=function(e){return 0},i.prototype.getColumnLevel=function(e){return 0},i.prototype.isColumnHeaderMultiValueSubtotal=function(e){return!1},i.prototype.isRowHeaderMultiValueSubtotal=function(e){return!1},i.prototype.getColumnIndexFromQueryName=function(e){},i.prototype.updateRows=function(e,t){this.rows=[];for(var i=0;i<e.length;i++)this.rows.push({index:i,values:e[i],identity:t?t[i]:void 0})},i.prototype.updateFloatingRow=function(e,t){_.isEmpty(e)?this.floatingRow=null:this.floatingRow={index:0,values:e,identity:void 0}},d.TableExRowHierarchyNavigator=i}(powerbi=powerbi||{}),function(e){var i;function t(e,t,i){this.tooltipService=e,this.selectionManager=t,this.tooltipsEnabled=!0}i=e.visuals||(e.visuals={}),t.prototype.getBodyHandler=function(){var n=this;return{addTooltip:function(e,t){return n.addBodyTooltip(e,t)},removeTooltip:function(e,t){return n.removeTooltip(t)},isTooltipEnabled:function(e){return n.tooltipsEnabled&&n.isBodyTooltipEnabled(e)},setTooltipDelegate:function(e,t,i,o,r){return n.setTooltipDelegate(e,t,o,r)},isTooltipEnabledGeneric:function(){return n.tooltipsEnabled}}},t.prototype.getHeaderHandler=function(){var n=this;return{addTooltip:function(e,t,i){return n.addHeaderTooltip(e,t,i)},removeTooltip:function(e,t){return n.removeTooltip(t)},isTooltipEnabled:function(e){return n.tooltipsEnabled},setTooltipDelegate:function(e,t,i,o,r){return n.setTooltipDelegateHeader(e,t,o,r)},isTooltipEnabledGeneric:function(){return n.tooltipsEnabled}}},t.prototype.onDataViewChanged=function(e,t){this.rowHierarchyNavigator=e,this.columnHierarchyNavigator=t},t.prototype.tooltipVisible=function(){return this.tooltipService&&this.tooltipService.visible()},t.prototype.hideTooltip=function(){this.tooltipService&&this.tooltipService.hide()},t.prototype.setTooltipsEnabled=function(e){this.tooltipsEnabled=e},t.prototype.addBodyTooltip=function(t,e){var i=this,e=d3.select(e);this.tooltipService.addTooltip(e,function(e){return i.getBodyTooltipInfo(t,e)},function(e){e=i.getItemSelectionId(t,e);return e&&[e]})},t.prototype.setTooltipDelegate=function(t,e,i,o){var r=this,e=d3.select(e);this.tooltipService.addTooltip(e,function(e){return!r.tooltipsEnabled&&o(e)?null:r.getBodyTooltipInfo(t(e),e,!r.tooltipsEnabled)},function(e){e=r.getItemSelectionId(t(e),e);return e&&[e]},!0,!0,i)},t.prototype.addHeaderTooltip=function(t,e,i){var o,r=this,e=d3.select(e),n=null==(n=(o=this.tooltipService).isTouchScreenOptimizedEnabled)?void 0:n.call(o);this.tooltipService.addTooltip(e,function(e){return r.getHeaderTooltipInfo(t,e)},n?function(e){return r.getItemSelectionId(t,e)}:function(e){},void 0,i)},t.prototype.setTooltipDelegateHeader=function(t,e,i,o){var r,n=this,e=d3.select(e),a=null==(a=(r=this.tooltipService).isTouchScreenOptimizedEnabled)?void 0:a.call(r);this.tooltipService.addTooltip(e,function(e){return!n.tooltipsEnabled&&o(e)?null:n.getHeaderTooltipInfo(t(e),e)},a?function(e){return n.getItemSelectionId(t(e),e)}:function(e){},!0,!0,i)},t.prototype.removeTooltip=function(e){e=d3.select(e);this.tooltipService.removeTooltips(e)},t.prototype.isBodyTooltipEnabled=function(e){return!e.isRowGrandTotal||!_.isEmpty(e.textContent)},t.prototype.getHeaderTooltipInfo=function(e,t){if(e)return[{displayName:e.metadata.displayName}]},t.prototype.getBodyTooltipInfo=function(e,t,i){var o,r;if(this.rowHierarchyNavigator&&e)return i?[{displayName:e.tooltipContent}]:(i=[],o=this.rowHierarchyNavigator.getHierarchyLeafAt(e.position.row.index),e.isRowGrandTotal||(o=this.getGroupingTooltipInfo(o))&&i.push.apply(i,o||[]),e.columnMetadata.isMeasure?(o=e.columnMetadata.displayName,e.isKpi?(r={metadata:e.columnMetadata.kpi,value:e.tooltipContent},i.push({displayName:o,kpiValue:r})):_.isEmpty(e.tooltipContent)||i.push({displayName:o,value:e.tooltipContent})):e.isRowGrandTotal&&!_.isEmpty(e.tooltipContent)&&i.push({displayName:e.tooltipContent}),_.isEmpty(i)?void 0:i)},t.prototype.getGroupingTooltipInfo=function(e){if(this.columnHierarchyNavigator&&this.rowHierarchyNavigator){for(var t=[],i=0,o=this.columnHierarchyNavigator.getColumns();i<o.length;i++){var r,n=o[i];n.metadata.isMeasure||(r=this.rowHierarchyNavigator.getIntersection(e,n),t.push({displayName:n.metadata.displayName,value:r.tooltipContent}))}return t}},t.prototype.getItemSelectionId=function(e,t){if(this.rowHierarchyNavigator&&e&&!e.isRowGrandTotal)return e=this.rowHierarchyNavigator.getHierarchyLeafAt(e.position.row.index),i.SelectionId.fromSelectorsByColumn(this.selectionManager.createSelectorsByColumn(e))},i.TableExInteractionManager=t}(powerbi=powerbi||{}),function(g){var o,s;function u(e,t){this.hostServices=e,this.featureSwitches=t,this.totalLabel=this.hostServices.getLocalizedString(s.TotalLabel),this.clearLocal()}o=g.visuals||(g.visuals={}),s=g.visuals.controls.internal.TablixUtils,u.prototype.onBodyCellContextMenu=function(e,t){var i;o.EventBubblingUtil.markAsHandled(t),!this.isTableEmpty()&&(i=this.getRowFromCell(e),i=!this.isSelectionEmpty()&&this.isItemSelected(i)?this.selectedItems:[i],e=this.createContextMenuArgs(e,i,t))&&this.hostServices.onContextMenu(e)},u.prototype.onBodyCellClick=function(e,t,i){this.isTableEmpty()||(e?e.isRowGrandTotal?this.clearHost():this.select(this.getRowFromCell(e),t):this.select(this.rows[i],t))},u.prototype.onWhitespaceClick=function(){this.clearHost()},u.prototype.isDrillingEnabled=function(e,t){if(!this.isTableEmpty())return e={type:0,visualObjects:this.getVisualObjects([this.getRowFromCell(e)]),position:u.getMouseEventPosition(t)},this.hostServices.onSelecting(e),1===e.action},u.prototype.select=function(e,t,i,o){if(void 0===i&&(i=!1),this.isItemSelected(e)){if(i)return;1===this.selectedItems.length&&1!==t?this.clearLocal():3===t?this.unselectItem(e):0===t&&(this.selectedItems=[e])}else 0===t&&this.clearLocal(),this.selectedItems.push(e),o||this.hostServices.canSelect(this.createSelectArgs(this.selectedItems))||(this.selectedItems=[e]);o||this.hostServices.onSelect(this.createSelectArgs(this.selectedItems,t))},u.prototype.isRowHighlighted=function(e){return!(!this.isSelectionEmpty()&&!this.isTableEmpty())||this.isItemSelected(e)},u.prototype.isBodyCellHighlighted=function(e){return!(!this.isSelectionEmpty()&&!this.isTableEmpty())||this.isItemSelected(this.getRowFromCell(e))},u.prototype.onDataViewChanged=function(e,t){if(this.rowNavigator=e,this.rows=e&&e.getRows(),this.totalRow=e&&e.getFloatingHierarchyLeafAt(0),this.columns=t&&t.getColumns(),!this.isSelectionEmpty()){for(var i=[],o=0,r=this.selectedItems;o<r.length;o++){var n=r[o],a=u.getMatchingRow(n,this.rows);i.push(a||n)}this.selectedItems=i}},u.prototype.clearLocal=function(){this.selectedItems=[]},u.prototype.isSelectionEmpty=function(){return _.isEmpty(this.selectedItems)},u.prototype.isTableEmpty=function(){return!this.rows},u.prototype.isItemSelected=function(e){return-1!==this.selectedItems.indexOf(e)},u.prototype.unselectItem=function(e){_.pull(this.selectedItems,e)},u.prototype.clearHost=function(){this.clearLocal(),this.hostServices.onSelect(this.createSelectArgs([]))},u.prototype.restoreSelection=function(e){if(this.clearLocal(),_.isEmpty(e))return!0;var t=_.keys(e[0].dataMap);if(1!==t.length)return!1;var i=_.chain(this.columns).filter(function(e){return!e.metadata.isMeasure}).map(function(e){return e.metadata.queryName}).value(),o=t[0];if(!_.includes(i,o))return!1;for(var r=!1,n=_.clone(e),a=0,l=this.rows;a<l.length;a++){for(var s=l[a],u=void 0,h=0,d=n;h<d.length;h++){var c=d[h],p=c.dataMap[o][0];if(c.dataMap[o].length,g.data.Selector.isScopeIdentity(p),g.DataViewScopeIdentity.equals(p,s.identity)){u=c;break}}u&&(this.select(s,3,!1,!0),_.remove(n,u),r=!0)}return r},u.prototype.getRowFromCell=function(e){return e.isRowGrandTotal&&e.isRowGrandTotal&&this.totalRow,e.isRowGrandTotal?this.totalRow:this.rows[e.position.row.index]},u.prototype.getRowAtIndex=function(e){return this.rows[e]},u.prototype.createContextMenuArgs=function(i,o,e){for(var n=this,t=[],r=0,a=o;r<a.length;r++){var l=a[r],l=this.createSelectorsByColumn(l);l&&t.push(l)}_.isEmpty(t)&&this.rows.length;e={data:t,position:u.getMouseEventPosition(e)};return e.copyArgs={singleValue:function(){var e;return(null==(e=null==(e=i.columnMetadata.type)?void 0:e.misc)?void 0:e.sparkline)?i.textContent:s.convertValueToString(i.dataPoint,n.featureSwitches.utcDates)},grid:function(){var e=o.length,t=n.columns.length,r=new Array(e+1),e=(r[0]=new Array(t),n.columns.forEach(function(e,t){r[0][t]=e.metadata.displayName}),o.forEach(function(i,e){var o=r[e+1]=new Array(t);n.columns.forEach(function(e,t){o[t]=n.rowNavigator.getIntersection(i,e).textContent})}),i.isRowGrandTotal&&n.totalRow&&n.totalRow.values&&_.isEmpty(n.totalRow.values[0])&&(r[1][0]=n.totalLabel),0);return 0!==n.rows.length&&(e=Math.round(o.length/n.rows.length*100)),{grid:r,coveragePercentage:e}}},e},u.prototype.createSelectArgs=function(e,t){return void 0===t&&(t=0),{type:0,visualObjects:this.getVisualObjects(e),selectionMode:t}},u.prototype.getVisualObjects=function(e){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i],r=this.createSelectorsByColumn(r);r&&t.push({objectName:"",selectorsByColumn:r})}return t},u.prototype.createSelectorsByColumn=function(e){var t,i=_.find(this.columns,function(e){return!e.metadata.isMeasure}),i=(i&&((t={})[i.metadata.queryName]=[e.identity],t=t),_(this.columns).filter(function(e){return e.metadata.isMeasure}).map(function(e){return e.metadata.queryName}).value());if(t||!_.isEmpty(i))return{dataMap:t,metadata:i}},u.getMouseEventPosition=function(e){return{x:e.clientX,y:e.clientY}},u.getMatchingRow=function(e,t){if(!_.isEmpty(t))for(var i=0,o=t;i<o.length;i++){var r=o[i];if(g.DataViewScopeIdentity.equals(r.identity,e.identity))return r}return null},u.getMatchingColumnHeader=function(e,t){for(var i=0,o=t;i<o.length;i++){var r=o[i];if(this.areHeadersEqual(r,e))return r}return null},u.areHeadersEqual=function(e,t){return e.metadata.queryName===t.metadata.queryName},o.TableExSelectionManager=u}(powerbi=powerbi||{}),function(e){var a;function l(e){this.hostServices=e,this.pendingChanges=[]}a=e.visuals||(e.visuals={}),l.prototype.onDataViewChanged=function(){this.pendingChanges=[]},l.getSelector=function(e){return{metadata:e.metadata.queryName}},l.prototype.getPendingChange=function(t){return _.find(this.pendingChanges,function(e){return a.TableExSelectionManager.areHeadersEqual(e.header,t)})},l.prototype.queuePendingChange=function(e,t){var i=this.getPendingChange(e);i?i.width=t:this.pendingChanges.push({header:e,width:t})},l.prototype.getColumnWidth=function(e){var t=this.getPendingChange(e);return t?t.width:(t=e.metadata.objects)?a.TablixProperties.PropColumnWidthValue.getValue(t):void 0},l.prototype.setColumnWidth=function(e,t){this.queuePendingChange(e,t),a.PivotTableSizeManagerUtils.persistWidths([{selector:l.getSelector(e),value:t}],this.hostServices,!1)},l.prototype.getRowHeight=function(e){},l.prototype.setRowHeight=function(e,t){},l.prototype.getRowLevelWidth=function(e){},l.prototype.setRowLevelWidth=function(e,t){},l.prototype.getColumnLevelHeight=function(e){},l.prototype.setColumnLevelHeight=function(e,t){},l.prototype.setMissingWidths=function(e){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i],n=r.header,r=r.width;null==this.getColumnWidth(n)&&(this.queuePendingChange(n,r),t.push({selector:l.getSelector(n),value:r}))}_.isEmpty(t)||a.PivotTableSizeManagerUtils.persistWidths(t,this.hostServices,!0)},l.prototype.clearWidths=function(e){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i];null!=this.getColumnWidth(r)&&t.push({selector:l.getSelector(r),value:void 0}),this.queuePendingChange(r,void 0)}_.isEmpty(t)||a.PivotTableSizeManagerUtils.persistWidths(t,this.hostServices,!0)},a.TableExSizeManager=l}(powerbi=powerbi||{}),function(e){var a;function l(e,t){this.isA11yTable=t,this.hostServices=e}a=e.visuals||(e.visuals={}),l.prototype.sort=function(e,t,i){void 0===i&&(i=!1);var o,r=l.getSortDirection(e),r=a.PivotTableSortingManager.getNextSortDirection(r,e.metadata),n=e.metadata.queryName,e={queryName:n,sortDirection:r};i?(o=_.chain(t).filter(function(e){return void 0!==e.sortOrder&&e.queryName!==n}).sortBy(function(e){return e.sortOrder}).map(function(e){return{queryName:e.queryName,sortDirection:e.sort}}).value()).push(e):o=[e],this.hostServices.onCustomSort({sortDescriptors:o,suppressAnnouncements:this.isA11yTable})},l.hasSortingChanged=function(e,t){if(e&&t){var i=e.metadata.columns;if(!_.isEmpty(i)){e=t.metadata.columns;if(!_.isEmpty(e))for(var o=0,r=e;o<r.length;o++){var n=function(t){var e=_.find(i,function(e){return t.queryName===e.queryName});if(e&&t.sort!==e.sort)return{value:!0}}(r[o]);if("object"==typeof n)return n.value}}}return!1},l.getSortDirection=function(e){return e.metadata.sort},a.TableExSortingManager=l}(powerbi=powerbi||{}),function(l){var w,n,x,r,c,a,s,u,S,P,h,H,t,d,o;function e(e,t){void 0===e&&(e=w.TableExOptions.createDefaultConstructorOptions()),this.options=e,this.featureSwitches=t||{},this.options.tooltipsEnabled=this.options.tooltipsEnabled,this.tooltipType=0,this.asyncSerializer=new l.AsyncSerializer,this.supportsOnObject=this.featureSwitches.onObject&&this.featureSwitches.a11yMatrix}w=l.visuals||(l.visuals={}),n=jsCommon.BrowserUtils,x=l.visuals.controls.pivotTable.ColumnMeasurementUtil,r=l.visuals.FormatModeAttribute,c=l.visuals.OnObjectUtil,a=l.visuals.controls.pivotTable.PivotTableControl,s=l.visuals.controls.pivotTable.TablixControl,u=l.visuals.controls.pivotTable.PivotTableRenderingMode,S=l.visuals.controls.pivotTable.RowMeasurementUtil,P=l.data.Selector,h=l.visuals.controls.pivotTable.TablixSection,H=l.visuals.controls.pivotTable.TablixRegion,t=l.visuals.controls.internal.TableExUtils,d=l.visuals.controls.TablixType,o=l.visuals.controls.internal.TablixUtils,e.prototype.init=function(e){var t=this;this.element=e.element,this.hostServices=e.host,this.waitingForData=!1,this.style=e.style,this.tablixPropertyManager=new w.TablixPropertyManager(this.style),this.selectionManager=new w.TableExSelectionManager(this.hostServices,this.featureSwitches),this.sortingManager=new w.TableExSortingManager(this.hostServices,this.featureSwitches.a11yTable),this.sizeManager=new w.TableExSizeManager(this.hostServices),this.tooltipService=w.createTooltipService(e.host),this.supportsOnObject&&(e=null!=(e=null==(e=this.hostServices)?void 0:e.getSubSelectionService())?e:w.SubSelectionRegionOutlineRenderer.createWithDefaultHost(),this.subSelectionHelper=w.HtmlSubSelectionHelper.createHtmlSubselectionHelper({hostElement:this.element.get(0),hostServices:this.hostServices,renderer:e,customOutlineCallback:function(e){return t.getSubSelectionCustomOutlines(e)},selectorCallback:function(e){return t.getSelectorsByColumnFromSubselectedElement(e)}}))},e.prototype.update=function(o){return __awaiter(this,void 0,l.Promise,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.asyncSerializer.enqueue(function(){return __awaiter(t,void 0,void 0,function(){var t,i;return __generator(this,function(e){switch(e.label){case 0:return document.fonts&&"loaded"!==document.fonts.status?[4,document.fonts.ready]:[3,2];case 1:e.sent(),e.label=2;case 2:return o.type&l.VisualUpdateType.Data||2===o.resizeMode?[4,this.onDataViewChanged(o.dataViews,o.operationKind,o.viewport)]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.pivotTableControl&&o.type&l.VisualUpdateType.Resize?(this.pivotTableControl.setWidth(o.viewport.width),this.pivotTableControl.setHeight(o.viewport.height),[4,this.renderControl(u.Incremental,null,null)]):[3,6];case 5:e.sent(),e.label=6;case 6:return this.supportsOnObject?(this.viewMode=o.viewMode,o.formatMode!==this.formatMode&&(this.formatMode=o.formatMode,this.subSelectionHelper.setFormatMode(o.formatMode),o.formatMode?this.element.get(0).setAttribute(r,"true"):this.element.get(0).removeAttribute(r),this.pivotTableControl)&&this.pivotTableControl instanceof s?(this.pivotTableControl.getBinder().setFormatMode(o.formatMode),[4,this.pivotTableControl.renderAsync(u.ClearRendering)]):[3,8]):[3,8];case 7:e.sent(),e.label=8;case 8:return t=o.type&l.VisualUpdateType.Data||o.type&l.VisualUpdateType.ResizeEnd||o.type&l.VisualUpdateType.FormattingSubSelectionChange,i=o.type&l.VisualUpdateType.FormattingSubSelectionChange,this.subSelectionHelper&&t&&(this.subSelectionHelper.updateOutlinesFromSubSelections(o.subSelections,!0),this.hostServices.alertScreenReader)&&i&&(t=this.subSelectionHelper.getLabelsFromSubSelections(o.subSelections,["aria-label"]),i=(null==t?void 0:t.length)&&t.join(" "))&&this.hostServices.alertScreenReader(i),[2]}})})})];case 1:return e.sent(),[2]}})})},e.prototype.updatePersistedWidths=function(e){var t=w.TablixProperties.PropColumnPivotTableAutoSizeColumns.getValue(this.dataView.metadata.objects);if(!t&&this.pivotTableControl){for(var i=[],o=this.columnHierarchyNavigator.getColumns(),r=0,n=0,a=this.pivotTableControl.getColumnWidthMeasureManager().getPageColumns();n<a.length;n++)for(var l=0,s=a[n].getColumnWidths();l<s.length;l++){var u=s[l];i.push({header:o[r],width:u}),r++}this.sizeManager.setMissingWidths(i)}else t&&e&&e.metadata&&e.metadata.objects&&!w.TablixProperties.PropColumnPivotTableAutoSizeColumns.getValue(e.metadata.objects)&&this.sizeManager.clearWidths(this.columnHierarchyNavigator.getColumns())},e.prototype.onDataViewChanged=function(o,n,a){return __awaiter(this,void 0,l.Promise,function(){var t,i,r=this;return __generator(this,function(e){switch(e.label){case 0:return _.isEmpty(o)?[3,5]:(t=this.dataView,this.dataView=o[0],this.formattingProperties=this.tablixPropertyManager.getTableExObjects(this.dataView,function(e){for(var t,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return(t=r.hostServices).getLocalizedString.apply(t,__spreadArray([e],i||[],!1))},this.style,this.featureSwitches),i=!this.dataView.metadata.segment,n!==l.VisualDataChangeOperationKind.Append?[3,2]:[4,this.onAppendDataView(t,i)]);case 1:return e.sent(),[3,4];case 2:return[4,this.onNewDataView(t,a,i)];case 3:e.sent(),e.label=4;case 4:return[3,6];case 5:this.dataView=void 0,this.selectionManager.onDataViewChanged(void 0,void 0),this.interactionManager&&this.interactionManager.onDataViewChanged(void 0,void 0),this.pivotTableControl&&this.pivotTableControl.clear(),e.label=6;case 6:return this.waitingForData=!1,[2]}})})},e.prototype.onAppendDataView=function(e,t){return __awaiter(this,void 0,l.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return this.updateHierarchyNavigators(t),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),[4,this.renderControl(u.Incremental,null,null)];case 1:return e.sent(),[2]}})})},e.prototype.onNewDataView=function(r,n,a){return __awaiter(this,void 0,l.Promise,function(){var t,i,o;return __generator(this,function(e){switch(e.label){case 0:return t=this.getPreviousVisibleRowStart(),i=this.getPreviousVisibleColumnStart(),this.createOrUpdateControlAndNavigators(a),this.sizeManager.onDataViewChanged(),this.selectionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.interactionManager&&this.interactionManager.onDataViewChanged(this.rowHierarchyNavigator,this.columnHierarchyNavigator),this.pivotTableControl.setWidth(n.width),this.pivotTableControl.setHeight(n.height),o=this.hostServices.tooltips(),this.options.tooltipsEnabled&&o&&o.enabled()?this.tooltipType=1:this.tooltipType=0,this.interactionManager&&this.interactionManager.setTooltipsEnabled(1===this.tooltipType),this.binder.updateFormattingProperties(this.dataView,this.formattingProperties,this.style,0===this.tooltipType),this.applyContainerStyle(),[4,this.renderControl(u.ClearMeasurement,this.getVisibleRowStart(t,w.TableExSortingManager.hasSortingChanged(r,this.dataView)),this.getVisibleColumnStart(i))];case 1:return e.sent(),this.updatePersistedWidths(r),[2]}})})},e.prototype.applyContainerStyle=function(){var e,t,i;this.featureSwitches.a11yMatrix||(e=this.pivotTableControl,t=this.binder.getColumnHeaderContainerFontInfo().fontProperties,i=e.getColumnHeaderContainer(),this.removeContainerStyles(i),w.FontProperties.applyStyleToElement(t,i),i=e.getFloatingRowHeaderContainer(),this.removeContainerStyles(i),w.FontProperties.applyStyleToElement(t,i),t=this.binder.getValueContainerFontInfo().fontProperties,i=e.getBodyCellContainer(),this.removeContainerStyles(i),w.FontProperties.applyStyleToElement(t,i),i=e.getFloatingBodyCellContainer(),this.removeContainerStyles(i),w.FontProperties.applyStyleToElement(t,i))},e.prototype.removeContainerStyles=function(e){return e.style.removeProperty("font-weight"),e.style.removeProperty("font-style"),e},e.prototype.onClearSelection=function(){this.selectionManager.clearLocal(),this.renderSelection()},e.prototype.onRestoreSelection=function(e){return!!this.selectionManager&&(e=this.selectionManager.restoreSelection(e.selection),this.renderSelection(),e)},e.prototype.updateHierarchyNavigators=function(e){this.rowHierarchyNavigator.update(this.dataView.table.rows,this.dataView.table.identity,this.dataView.table.totals,e,this.dataView.table.columns,this.formattingProperties),this.columnHierarchyNavigator.update(this.dataView.table.columns)},e.prototype.renderControl=function(e,t,i){var o,r;return this.featureSwitches.a11yMatrix?this.pivotTableControl.renderAsync(e,t,i):(o=this.pivotTableControl,r=this.hostServices.promiseFactory().defer(),t||i?o.makeVisible(e,t,i,function(e){e?r.reject(e):r.resolve(null)},!0):o.render(e,function(e){e?r.reject(e):r.resolve(null)}),r.promise)},e.prototype.getPreviousVisibleRowStart=function(){var e,t;if(this.pivotTableControl)return(e=this.pivotTableControl.getVisibleRowStart())&&(t=this.rowHierarchyNavigator.getHierarchyLeafAt(e.rowIndex))?{item:t,offset:e.visibleHeight}:null},e.prototype.getPreviousVisibleColumnStart=function(){var e,t;if(this.pivotTableControl)return(e=this.pivotTableControl.getVisibleColumnStart())&&(t=this.columnHierarchyNavigator.getHierarchyLeafAt(e.columnIndex))?{item:t,offset:e.visibleWidth}:null},e.prototype.getSelectorsByColumnFromSubselectedElement=function(e){if(this.supportsOnObject,this.pivotTableControl instanceof s)switch(d3.select(e).attr(w.SubSelectableObjectNameAttribute)){case"values":case"measure-values":var t=this.pivotTableControl.getMidRenderer().getItemByElement(e);return t.columnMetadata.queryName?{metadata:[t.columnMetadata.queryName]}:{};default:return{}}},e.prototype.getVisibleRowStart=function(e,t){return!e||0===this.pivotTableControl.getViewport().top?null:t?{rowIndex:0,visibleHeight:Number.MAX_VALUE}:(t=w.TableExSelectionManager.getMatchingRow(e.item,this.rowHierarchyNavigator.getRows()))&&this.rowHierarchyNavigator.isLeaf(t)?{rowIndex:this.rowHierarchyNavigator.getLeafIndex(t),visibleHeight:e.offset}:null},e.prototype.getVisibleColumnStart=function(e){var t;return e&&0!==this.pivotTableControl.getViewport().left&&(t=w.TableExSelectionManager.getMatchingColumnHeader(e.item,this.columnHierarchyNavigator.getColumns()))&&this.columnHierarchyNavigator.isLeaf(t)?{columnIndex:this.columnHierarchyNavigator.getLeafIndex(t),visibleWidth:e.offset}:null},e.prototype.renderSelection=function(){this.pivotTableControl instanceof s?this.pivotTableControl.renderAsync(u.ClearRendering):(this.pivotTableControl.restoreFocusOnNextBlur(),this.pivotTableControl.render(u.ClearRendering))},e.prototype.createOrUpdateControlAndNavigators=function(e){var t,i,o,r=this;this.rowHierarchyNavigator||(this.rowHierarchyNavigator=new w.TableExRowHierarchyNavigator(this.tablixPropertyManager.tablixProperties,this.hostServices),this.columnHierarchyNavigator=new w.TableExColumnHierarchyNavigator),this.updateHierarchyNavigators(e),this.pivotTableControl||(e={interactivityIndicatorEnabled:this.options.interactivityIndicatorEnabled,selectionEnabled:this.options.selection&&this.options.selection.enabled,sortIconEnabled:this.options.sorting&&this.options.sorting.showActiveSortIcon,sortingEnabled:this.options.sorting&&this.options.sorting.enabled,hyperlinksEnabled:this.featureSwitches.conditionalTablixWebURL,tablixProperties:this.tablixPropertyManager.tablixProperties,onBindRowHeader:function(e){return r.onBindRowHeader(e)},onHyperlinkClicked:function(e,t){return r.onHyperlinkClicked(e,t)}},(t=document.createElement("div")).className="tableExContainer",this.element.append(t),this.binder=new w.TableExBinder(e,this.selectionManager,t,this.hostServices,this.featureSwitches.a11yMatrix),e=this.featureSwitches.a11yTable,i=this.featureSwitches.a11yMatrix,o=this.supportsOnObject,this.pivotTableControl=i?new s(t,this.sizeManager,this.createControlOptions(),e,!1,o,this.hostServices,this.style,this.onVerticalScrollButtonClick.bind(this),this.onHorizontalScrollButtonClick.bind(this),this.options.interactivityIndicatorEnabled):new a(t,this.sizeManager,this.createControlOptions(),e,!1,o,this.onVerticalScrollButtonClick.bind(this),this.onHorizontalScrollButtonClick.bind(this),this.hostServices),this.binder.getViewport=function(){return r.pivotTableControl.getViewport()}.bind(this),this.binder.isHeaderAutoWidth=function(e){return void 0===r.sizeManager.getColumnWidth(e)}.bind(this),this.binder.isBodyCellAutoWidth=function(e){e=r.columnHierarchyNavigator.getColumns()[e.position.column.index];return void 0===r.sizeManager.getColumnWidth(e)}.bind(this),this.pivotTableControl.setClassName("tableEx"),this.pivotTableControl.setRowNavigator(this.rowHierarchyNavigator),this.pivotTableControl.setColumnNavigator(this.columnHierarchyNavigator),this.pivotTableControl.setBinder(this.binder))},e.prototype.createControlOptions=function(){var r=this,e=this.options.scrolling.enabled,t=this.options.columnResizing.enabled,i=(this.options.tooltipsEnabled&&(this.interactionManager=this.interactionManager=new w.TableExInteractionManager(this.tooltipService,this.selectionManager,this.hostServices.getLocalizedString(o.TotalLabel))),this.interactionManager);return this.options.selection.enabled?{rowHeaderClickHandler:null,rowHeaderContextMenuHandler:null,rowHeaderInteractionHandler:null,rowHeaderFocusHandler:null,rowHeaderExpandCollapseHandler:null,columnHeaderClickHandler:function(e,t){return r.onColumnHeaderClickHandler(e,t)},columnHeaderContextMenuHandler:null,columnHeaderInteractionHandler:!this.formatMode&&i?i.getHeaderHandler():null,columnHeaderFocusHandler:function(e){return null},bodyCellClickHandler:function(e,t,i,o){return!r.formatMode&&r.onBodyCellClick(e,t,i,o)},bodyCellContextMenuHandler:function(e,t){return!r.formatMode&&r.onBodyCellContextMenu(e,t)},bodyCellInteractionHandler:!this.formatMode&&i?i.getBodyHandler():null,bodyCellFocusHandler:function(e,t){return null},cornerCellClickHandler:null,cornerCellContextMenuHandler:null,cornerCellInteractionHandler:null,cornerCellFocusHandler:null,cellContentActivationHandler:function(e,t){return!r.formatMode&&r.onContentActivation(e,t)},whitespaceClickHandler:function(e,t){return!r.formatMode&&r.onWhitespaceClick(t)},scrollingEnabled:e,columnResizingEnabled:t,rowLevelResizingEnabled:!1,onScroll:function(){return r.onScroll()}}:{rowHeaderClickHandler:null,rowHeaderContextMenuHandler:null,rowHeaderInteractionHandler:null,rowHeaderFocusHandler:null,rowHeaderExpandCollapseHandler:null,columnHeaderClickHandler:null,columnHeaderContextMenuHandler:null,columnHeaderInteractionHandler:i?i.getHeaderHandler():null,columnHeaderFocusHandler:null,bodyCellClickHandler:null,bodyCellContextMenuHandler:null,bodyCellInteractionHandler:i?i.getBodyHandler():null,bodyCellFocusHandler:null,cornerCellClickHandler:null,cornerCellContextMenuHandler:null,cornerCellInteractionHandler:null,cornerCellFocusHandler:null,cellContentActivationHandler:null,whitespaceClickHandler:null,scrollingEnabled:e,columnResizingEnabled:t,rowLevelResizingEnabled:!1,onScroll:function(){return r.onScroll()}}},e.prototype.onScroll=function(){this.interactionManager&&!this.interactionManager.tooltipVisible()&&this.interactionManager.hideTooltip()},e.prototype.onHyperlinkClicked=function(e,t){this.hostServices.onHyperlinkClick(e,t)},e.prototype.onColumnHeaderClickHandler=function(e,t){(!this.supportsOnObject||0===this.viewMode||this.formatMode&&this.subSelectionHelper.isVisualObjectSubSelected({objectName:"columnHeaders",selectorsByColumn:{}}))&&this.onColumnHeaderClick(e,t)},e.prototype.onBodyCellClick=function(e,t,i,o){var r;null!=t&&t.preventDefault(),o===h.Footer&&!e||(e?(this.pivotTableControl.setAsFocusTableEx(e.position.row.index,e.position.column.index,o),this.selectionManager.isDrillingEnabled(e,t)||(r=void 0,1===(r=n.isCtrlOrMeta(t)||1===this.hostServices.dataMultiSelectMode()?3:t.shiftKey?1:0)&&this.selectionManager.isItemSelected(this.selectionManager.getRowFromCell(e)))||1===r&&e.isRowGrandTotal||(this.selectionManager.onBodyCellClick(e,r),this.renderSelection(),this.announceSelectionState(e,void 0))):(this.pivotTableControl.setAsFocusTableEx(i,-1,o),1===(r=null!=t&&t.shiftKey?1:3)&&this.selectionManager.isItemSelected(this.selectionManager.getRowAtIndex(i))||(this.selectionManager.onBodyCellClick(void 0,r,i),this.renderSelection(),this.announceSelectionState(e,i))))},e.prototype.onBodyCellContextMenu=function(e,t){t.stopPropagation(),t.preventDefault(),this.selectionManager.onBodyCellContextMenu(e,t)},e.prototype.onVerticalScrollButtonClick=function(e,t){e=this.hostServices.getLocalizedString("Table_Location_Vertical",this.getScrollRowIndex(e),this.getScrollRowIndex(t));this.hostServices.alertScreenReader(e)},e.prototype.onHorizontalScrollButtonClick=function(e,t){e=this.hostServices.getLocalizedString("Table_Location_Horizontal",this.getScrollColumnIndex(e),this.getScrollColumnIndex(t));this.hostServices.alertScreenReader(e)},e.prototype.getScrollRowIndex=function(e){return 0===e?1:t.getAriaRowIndex(e)},e.prototype.getScrollColumnIndex=function(e){return 0===e?1:t.getAriaColIndex(e)},e.prototype.announceSelectionState=function(e,t){e=this.rowHierarchyNavigator.getHierarchyLeafAt(null!=(e=null==e?void 0:e.position.row.index)?e:t),t=this.selectionManager.isItemSelected(e)?this.hostServices.getLocalizedString(o.SelectedLabel):this.hostServices.getLocalizedString(o.UnselectedLabel);this.hostServices.alertScreenReader(t)},e.prototype.onColumnHeaderClick=function(e,t){e&&(this.pivotTableControl instanceof a&&this.pivotTableControl.restoreFocusOnNextBlur(),this.pivotTableControl.setAsFocusTableEx(void 0,e.position.column.index,h.Header),this.dataView)&&this.options.sorting.enabled&&(t=this.featureSwitches.tableMultiSort&&t.shiftKey,this.sortingManager.sort(e,this.dataView.table.columns,t))},e.prototype.onContentActivation=function(e,t){e=e.querySelector("a");e&&e.dispatchEvent(t)},e.prototype.onWhitespaceClick=function(e){this.pivotTableControl instanceof a&&this.pivotTableControl.restoreFocusOnNextBlur(),this.selectionManager.onWhitespaceClick(),this.renderSelection(),e&&(e=this.hostServices.getLocalizedString("Tablix_Selections_Cleared"),this.hostServices.alertScreenReader(e))},e.prototype.onBindRowHeader=function(e){this.needsMoreData(e)&&(this.featureSwitches.a11yMatrix?setTimeout(this.hostServices.loadMoreData):this.hostServices.loadMoreData(),this.waitingForData=!0,this.hostServices.alertScreenReader(this.hostServices.getLocalizedString("Table_Loading_More_Data")))},e.prototype.needsMoreData=function(e){var t;return!(this.waitingForData||!this.dataView||!this.dataView.metadata||!this.dataView.metadata.segment)&&(t=this.rowHierarchyNavigator.getHierarchyLeafCount()*o.PreferredLoadMoreThreshold,this.rowHierarchyNavigator.getLeafIndex(e)>=t)},e.prototype.getFormattingModel=function(){if(this.dataView)return this.tablixPropertyManager.getFormattingModel(this.hostServices,this.formattingProperties,this.dataView,d.TableEx,void 0,this.featureSwitches,this.style)},e.prototype.enumerateObjectInstances=function(e){var r=this,t=new w.ObjectEnumerationBuilder;return this.dataView&&this.tablixPropertyManager.enumerateObjectInstances(e,t,this.dataView,d.TableEx,function(e){for(var t,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return(t=r.hostServices).getLocalizedString.apply(t,__spreadArray([e],i||[],!1))},this.featureSwitches,void 0,this.style),t.complete()},e.prototype.enumerateObjectRepetition=function(){var e=[];return this.dataView&&this.tablixPropertyManager.enumerateObjectRepetition(e,this.dataView,d.TableEx,this.featureSwitches.conditionalTablixWebURL),e},e.prototype.getSubSelectionCustomOutlines=function(e){for(var t=[],i=this.pivotTableControl,o=0,r=e.visualObjects;o<r.length;o++){var n=r[o],a=n.objectName,l=P.convertSelectorsByColumnToSelector(n.selectorsByColumn);switch(a){case"columnHeaders":var s=i.getTopRenderer().getFirstScrollableCellsContainer(),u=i.getTopViewportBoundingClientRect(),s=s.getBoundingClientRect(),s={type:1,x:Math.max(s.x,u.left),y:s.y,height:s.height,width:Math.min(s.width,u.width)};t.push({id:a,outline:s});break;case"totals":var u=i.getBotRenderer().getFirstScrollableCellsContainer(),s=u.getBoundingClientRect(),h=i.getBotViewportBoundingClientRect(),d=d3.select(u).selectAll("[".concat(w.SubSelectableObjectNameAttribute,"=").concat(a,"]")).nodes(),c=_.first(d).getBoundingClientRect(),d=_.last(d).getBoundingClientRect(),c=Math.max(s.x,c.x),d=Math.min(s.right-c,d.right-c),d={type:1,x:Math.max(c,h.left),y:s.y,height:s.height,width:Math.min(d,h.left+h.width-Math.max(c,h.left))};t.push({id:a,outline:d});break;case"values":case"measure-values":for(var p,g,m=i.getMidRenderer(),c=i.getMidViewportBoundingClientRect(),h=i.getViewport(),f=x.getVisibleRange(h.left,h.width,i.getColumnWidthMeasureManager()),y=S.getVisibleRange(h.top,h.height,i.getRowHeightMeasureManager()),b=void 0,v=f.firstLeafIndex;v<=f.lastLeafIndex;++v){var C=m.getElementByIndex(y.firstLeafIndex,v,H.Main);if(C)if(m.getItemByElement(C).columnMetadata.queryName===l.metadata){b=C;break}}b&&(d=b.getBoundingClientRect(),g=Math.max(c.left,d.x),p=Math.min(c.left+c.width-g,d.right-g),g={type:1,x:g,y:c.top,height:c.height,width:p},t.push({id:null!=(p="".concat(a,"-").concat(l.metadata))?p:a,outline:g}));break;default:return}}return t},e.prototype.getSubSelectionStyles=function(e){if(this.supportsOnObject){e=_.first(e).visualObjects;if(0<e.length){var t,e=e[0];switch(_.isEmpty(e.selectorsByColumn)||(t=P.convertSelectorsByColumnToSelector(e.selectorsByColumn)),e.objectName){case"columnHeaders":var i="".concat("Visual","-").concat("columnHeaders"),o="".concat("columnHeaders","-").concat("text"),r={cardUid:i,groupUid:o,sliceUid:"".concat(o,"-font")},n={cardUid:i,groupUid:o,sliceUid:"".concat(o,"-fontColor")},a={cardUid:i,groupUid:o,sliceUid:"".concat(o,"-backColor")},l={cardUid:i,groupUid:o,sliceUid:"".concat(o,"-wordWrap")},i={cardUid:i,groupUid:o,sliceUid:"".concat(o,"-alignment")},o=c.getFontOnlyTextSubSelectionStyles(this.hostServices,{fontReference:r,fontColorReference:n,backgroundReference:a,wordWrapReference:l,horizontalAlignmentReference:i});return o.grid={type:"contextmenu"},o.border={type:"contextmenu"},o;case"totals":r="".concat("Visual","-").concat("totals"),n="".concat("totals","-").concat("values"),a={cardUid:r,groupUid:n,sliceUid:"".concat(n,"-font")},l={cardUid:r,groupUid:n,sliceUid:"".concat(n,"-fontColor")},i={cardUid:r,groupUid:n,sliceUid:"".concat(n,"-backColor")},o=c.getFontOnlyTextSubSelectionStyles(this.hostServices,{fontReference:a,fontColorReference:l,backgroundReference:i});return o.grid={type:"contextmenu"},o.border={type:"contextmenu"},o;case"values":case"measure-values":var r="".concat("Visual","-").concat("values"),n="".concat("values","-").concat("values"),a="".concat("Visual","-").concat("columnFormatting"),l="".concat("columnFormatting","-").concat("columns","-series--").concat("values"),i=this.columnHierarchyNavigator.getColumnIndexFromQueryName(t.metadata),o="".concat(l,"-container-").concat(i),i={cardUid:r,groupUid:n,sliceUid:"".concat(n,"-font")},s={cardUid:a,groupUid:o,sliceUid:"".concat(l,"-fontColor"),selector:t},u={cardUid:a,groupUid:o,sliceUid:"".concat(l,"-labelPrecision"),selector:t},h={cardUid:a,groupUid:o,sliceUid:"".concat(l,"-labelDisplayUnits"),selector:t},d={cardUid:a,groupUid:o,sliceUid:"".concat(l,"-backColor"),selector:t},r={cardUid:r,groupUid:n,sliceUid:"".concat(n,"-textWrap")},n={cardUid:a,groupUid:o,sliceUid:"".concat(l,"-alignment"),selector:t},a=c.getNumericTextSubSelectionStyles(this.hostServices,{fontReference:i,fontColorReference:s,precisionReference:u,displayUnitsReference:h,backgroundReference:d,wordWrapReference:r,horizontalAlignmentReference:n});return a.grid={type:"contextmenu"},a.border={type:"contextmenu"},a}}}},e.prototype.getBorderShortcuts=function(e){var t;switch(e){case"columnHeaders":t="".concat("grid","-").concat("border","-outline--outlineStyleColumnHeaders");break;case"totals":t="".concat("grid","-").concat("border","-outline--outlineStyleTotals");break;case"values":case"measure-values":t="".concat("grid","-").concat("border","-outline--outlineStyleValues");break;default:return}return[{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("border"),sliceUid:t,value:0}],label:this.hostServices.getLocalizedString("Format_Border_NoBorder"),icon:"NoBorder_16"},{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("border"),sliceUid:t,value:15}],label:this.hostServices.getLocalizedString("Format_Border_AllBorders"),icon:"BoxBorder_16"},{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("border"),sliceUid:t,value:1}],label:this.hostServices.getLocalizedString("Format_Border_TopBorder"),icon:"TopBorder_16"},{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("border"),sliceUid:t,value:4}],label:this.hostServices.getLocalizedString("Format_Border_BottomBorder"),icon:"BottomBorder_16"},{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("border"),sliceUid:t,value:5}],label:this.hostServices.getLocalizedString("Format_Border_TopAndBottomBorder"),icon:"TopAndThickBottomBorder_16"},{type:7},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("border")}],label:this.hostServices.getLocalizedString("Format_Border")}]},e.prototype.getGridShortcuts=function(){return[{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridVertical"),sliceUid:"".concat("grid","-").concat("gridVertical","-gridVertical"),value:!0,isTopLevelToggle:!0},{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridHorizontal"),sliceUid:"".concat("grid","-").concat("gridHorizontal","-gridHorizontal"),value:!0,isTopLevelToggle:!0}],label:this.hostServices.getLocalizedString("Small_Multiples_Layout_Grid_Line_Type_Inner"),icon:"AccessGridlinesBoth_16"},{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridVertical"),sliceUid:"".concat("grid","-").concat("gridVertical","-gridVertical"),value:!1,isTopLevelToggle:!0},{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridHorizontal"),sliceUid:"".concat("grid","-").concat("gridHorizontal","-gridHorizontal"),value:!0,isTopLevelToggle:!0}],label:this.hostServices.getLocalizedString("Visual_Gridline_Horizontal"),icon:"AccessGridlinesHorizontal_16"},{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridVertical"),sliceUid:"".concat("grid","-").concat("gridVertical","-gridVertical"),value:!0,isTopLevelToggle:!0},{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridHorizontal"),sliceUid:"".concat("grid","-").concat("gridHorizontal","-gridHorizontal"),value:!1,isTopLevelToggle:!0}],label:this.hostServices.getLocalizedString("Visual_Gridline_Vertical"),icon:"AccessGridlinesVertical_16"},{type:9,referencesAndValues:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridVertical"),sliceUid:"".concat("grid","-").concat("gridVertical","-gridVertical"),value:!1,isTopLevelToggle:!0},{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridHorizontal"),sliceUid:"".concat("grid","-").concat("gridHorizontal","-gridHorizontal"),value:!1,isTopLevelToggle:!0}],label:this.hostServices.getLocalizedString("Visual_Gridline_None"),icon:"AccessGridlinesNone_16"},{type:7},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("grid"),groupUid:"".concat("grid","-").concat("gridHorizontal")}],label:this.hostServices.getLocalizedString("Format_Grid")}]},e.prototype.getSubSelectionShortcuts=function(e,t){if(this.supportsOnObject){var i,o,e=_.first(e).visualObjects;if(0<e.length){if(i=e[0],t)switch(t){case"grid":return this.getGridShortcuts();case"border":return this.getBorderShortcuts(i.objectName)}switch(_.isEmpty(i.selectorsByColumn)||(o=P.convertSelectorsByColumnToSelector(i.selectorsByColumn)),i.objectName){case"columnHeaders":return[{type:0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("columnHeaders"),groupUid:"".concat("columnHeaders","-").concat("text")}],label:this.hostServices.getLocalizedString("Format_Column_Headers")}];case"totals":case"total-labels":var r="".concat("totals","-").concat("values");return[{type:0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("totals"),groupUid:r}],label:"total-labels"===i.objectName?this.hostServices.getLocalizedString("Format_Total_Label"):this.hostServices.getLocalizedString("Format_Totals")}];case"values":case"measure-values":var n,r="".concat("conditionalFormatting","-").concat("options","-series--").concat("cellElements"),a="".concat("values","-").concat("values"),l="".concat(r,"-backColor"),s="".concat(r,"-fontColor"),u="".concat(r,"-dataBars"),r="".concat(r,"-icon"),a=[{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("values"),groupUid:a}],label:this.hostServices.getLocalizedString("Format_Values")}];return"measure-values"===i.objectName&&(l={sourceUid:l},s={sourceUid:s},u={sourceUid:u},r={sourceUid:r},o&&(n=this.tablixPropertyManager.getConditionalFormattingSelector(d.TableEx,o.metadata),r.selector=s.selector=l.selector=n,u.selector=this.tablixPropertyManager.getConditionalFormattingSelector(d.TableEx,o.metadata,!1)),a.unshift({type:8,shortcuts:[{type:6,sourceUid:l.sourceUid,label:this.hostServices.getLocalizedString("Background_Color"),selector:l.selector},{type:6,sourceUid:s.sourceUid,label:this.hostServices.getLocalizedString("Visual_FontColor"),selector:s.selector},{type:6,sourceUid:u.sourceUid,label:this.hostServices.getLocalizedString("Visual_ConditionalFormatting_DataBars"),selector:u.selector},{type:6,sourceUid:r.sourceUid,label:this.hostServices.getLocalizedString("Visual_Tablix_Icons"),selector:r.selector},{type:7},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("conditionalFormatting"),selector:o}],label:this.hostServices.getLocalizedString("Format_Cell_Elements")}],label:this.hostServices.getLocalizedString("Format_AddCellElements")})),a.unshift({type:0}),a}}}},e.prototype.onDataViewObjectChanged=function(e){if(!this.supportsOnObject||!this.formatMode)return e;for(var t=[],i=0,o=e;i<o.length;i++){var r,n=o[i].selector;n&&n.metadata&&(r=(r=this.formattingProperties.columnFormatting[n.metadata]).styleValues||r.styleHeader||r.styleTotal,t.push(w.DataViewObjectChangeHelper.createSeriesLevelToggleTurnOnAction({objectName:"columnFormatting",propertyName:"backColor"},r,[n={type:0,visualChangeObject:{objectName:"columnFormatting",propertyName:"styleValues",propertyValue:!0,propertyType:{bool:!0},selector:n}}]),w.DataViewObjectChangeHelper.createSeriesLevelToggleTurnOnAction({objectName:"columnFormatting",propertyName:"fontColor"},r,[n]),w.DataViewObjectChangeHelper.createSeriesLevelToggleTurnOnAction({objectName:"columnFormatting",propertyName:"alignment"},r,[n])))}return w.DataViewObjectChangeHelper.applyDataViewObjectsBehaviorChanges(e,w.DataViewObjectChangeHelper.getDataViewObjectsBehaviorChanges(e,t))},w.TableEx=e}(powerbi=powerbi||{}),function(e){var t,a;function u(e,t,i,o){void 0===i&&(i=!0);var r=e.columnItem,n=e.rowItem,a=0,l={displayNameParts:[],valueParts:[],concatenatedParts:[],headerParts:[],otherType:{}},s=n&&!_.isEmpty(n.values),n=n&&d(n,t,i,o),u=(n&&((u=l.displayNameParts).push.apply(u,n.displayNameParts||[]),(u=l.valueParts).push.apply(u,n.valueParts||[]),(u=l.headerParts).push.apply(u,_.map(n.valueParts,function(){return!0})),l.concatenatedParts.push(_.map(n.displayNameParts,function(){return a++}))),r&&d(r,t,i,o));return u&&((n=l.displayNameParts).push.apply(n,u.displayNameParts||[]),(r=l.valueParts).push.apply(r,u.valueParts||[]),(t=l.headerParts).push.apply(t,_.map(u.valueParts,function(){return!0})),l.concatenatedParts.push(_.map(u.displayNameParts,function(){return a++}))),s&&(l.displayNameParts.push(e.columnMetadata.displayName),l.concatenatedParts.push([a++]),l.headerParts.push(!1),e.isKpi?(i={metadata:e.columnMetadata.kpi,value:e.tooltipContent},(l.otherType[l.displayNameParts.length-1]={}).kpiValue=i,l.valueParts.push(e.tooltipContent)):_.isEmpty(e.tooltipContent)||l.valueParts.push(e.tooltipContent)),l}function h(e){for(var t={headers:_.uniq(_.flatten(_.map(e,function(e){return e.displayNameParts}))),isHeader:{},values:[]},p=t.values,i=t.headers,g=t.isHeader,o={},r=0;r<i.length;r++)o[i[r]]=r;for(var n=0,a=e;n<a.length;n++){for(var l=a[n],s=_.fill(new Array(i.length),""),r=0;r<l.displayNameParts.length;r++){var u=l.valueParts[r],h=o[l.displayNameParts[r]];s[h]=u,l.headerParts&&(t.isHeader[h]=l.headerParts[r])}p.push(s)}if(!_.isEmpty(e)&&e[0].headerParts)for(var d=0;d<p.length;d++)!function(e){for(var i=p[e],t=[],o=e+1;o<p.length;o++){var r=p[o];_.every(r,function(e,t){return g[t]&&e===i[t]||!g[t]&&(""===e||""===i[t])})&&t.push(o)}if(0<t.length)for(var n=_.reduce(i,function(e,t,i){return""===t&&e.push(i),e},[]),a=0,l=t;a<l.length;a++)for(var s=p[l[a]],o=0;o<n.length;o++){var u=n[o],h=s[u];""!==h&&(i[u]=h,n.splice(o,1),o--)}t.sort(function(e,t){return t-e});for(var d=0,c=t;d<c.length;d++)p.splice(c[d],1)}(d);return t}function o(o){for(var r=[],e=0,t=o.concatenatedParts;e<t.length;e++)!function(i){var e=_.filter(o.displayNameParts,function(e,t){return-1!==i.indexOf(t)}),t=_.filter(o.valueParts,function(e,t){return-1!==i.indexOf(t)});(0<e.length||0<t.length)&&(r.push({displayName:e.join(" "),value:t.join(" ")}),o.otherType)&&(e=_.first(i),_.has(o.otherType,String(e)))&&(delete r[t=r.length-1].value,r[t]=__assign(__assign({},r[t]),o.otherType[e]))}(t[e]);return r}function l(e,t){e=s(e,t),t=e.displayNameParts,e=e.valueParts;if(0<t.length||0<e.length)return{displayName:t.join(" "),value:e.join(" ")}}function d(e,t,i,o){void 0===i&&(i=!0);var r=p(e),n=e.queryName,r=_.find(r,function(e){return e.queryName===n});return s(e=r&&r.isMeasure?e.parent:e,t,i,o)}function s(e,t,i,o){void 0===i&&(i=!0);for(var r=[],n=[];e;){if(i&&e.isSubtotal);else{var a=p(e);if(!_.isEmpty(a)){for(var l=[],s=0,u=a;s<u.length;s++){var h=u[s];l.push(h.isMeasure?t:h.displayName)}r.push(l.join(" ")),_.every(a,function(e){return e.isMeasure})?n.push(a[0].displayName):e.isSubtotal?n.push(o):n.push(e.tooltipValueFormatted)}}e=e.parent}return{displayNameParts:r=r.reverse(),valueParts:n=n.reverse()}}function c(e,t,i,o){_.isEmpty(i)&&(i=e.getHierarchyItems()),_.isEmpty(o)&&(o=t.getHierarchyItems());for(var r=[],n=(e.getLeaves(i,r),r=_.filter(r,function(e){return!e.isSubtotal}),[]),a=(t.getLeaves(o,n),n=_.filter(n,function(e){return!e.isSubtotal}),[]),l=0,s=r;l<s.length;l++)for(var u=s[l],h=0,d=n;h<d.length;h++){var c=d[h];a.push(e.getIntersection(u,c))}return a.filter(function(e){return!e.isSubtotal&&!e.isGrandTotal})}function p(e){var t=e.hierarchyLevel&&e.hierarchyLevel.sources;return _.isEmpty(t)?[]:_.every(t,function(e){return e.isMeasure})?[t[e.levelSourceIndex||0]]:t}t=e.visuals||(e.visuals={}),a=e.visuals.MatrixHierarchyNavigator,(t=t.PivotTableInteractivityUtils||(t.PivotTableInteractivityUtils={})).getBodyCellInfo=u,t.getBodyCellTooltipInfo=function(e,t,i){if(e)return i?[{displayName:e.tooltipContent}]:o(u(e,t))},t.getGivenBodyCellsInfo=function(e,t,i,o){for(var r=[],n=0,a=e;n<a.length;n++){var l=a[n];r.push(u(l,o))}var s=0;return 0!=(t=t.getHierarchyLeafCount()*i.getHierarchyLeafCount())&&(s=Math.round(e.length/t*100)),__assign({coveragePercentage:s},h(r))},t.reconcileDataHierarchyParts=h,t.concatenatePartsToTooltipInfo=o,t.getCornerCellTooltipInfo=function(e){if(e)return[{displayName:e.displayName}]},t.getHeaderTooltipInfo=function(e,t,i,o,r,n){if(e)return n?[{displayName:e.isSubtotal||a.isNodeGrandTotal(e)?o:e.tooltipValueFormatted}]:a.isNodeGrandTotal(e)?i(e)?[{displayName:e.tooltipValueFormatted}]:[{displayName:o}]:(n=[],(i=l(e,r))&&n.push(i),t(e)&&n.push({displayName:r,value:e.valueFormatted}),n)},t.getGroupingTooltipDataIems=l,t.getGroupingDataItems=s,t.getGivenGroupingDataItems=function(e,t,i,o,r){for(var e=c(i,o,e,t),t=0,n=(0!=(i=i.getHierarchyLeafCount()*o.getHierarchyLeafCount())&&(t=Math.round(e.length/i*100)),[]),a=0,l=e;a<l.length;a++){var s=l[a];n.push(u(s,r))}return __assign({coveragePercentage:t},h(n))},t.explodeHeadersToBodyItems=c,t.getCornerCellParts=function(e){return{displayNameParts:[e.displayName],valueParts:[null]}},t.getScreenReaderMessage=function(e,t){for(var i=[],o=0;o<e.displayNameParts.length;o++){var r=e.displayNameParts[o],n=e.valueParts[o];null!=n&&(r+=": "+n),i.push(r)}if(!_.isEmpty(t))for(var a=0,l=t;a<l.length;a++){var s=l[a];i.push(s)}return i.join(". ")}}(powerbi=powerbi||{}),function(e){(e=(e=e.powerbi||(e.powerbi={})).visuals||(e.visuals={})).importPivotTableModule=function(){},e.importTableExModule=function(){},e.importMatrixModule=function(){},e.importTableModule=function(){}}(es6=es6||{}),function(e){var t;(t=e.visuals||(e.visuals={})).initializePivotTablesFactoryES6=function(){t.setCreatePivotTable(function(t,i){return es6.powerbi.visuals.importPivotTableModule().then(function(e){return new e.PivotTable(t,i)})}),t.setCreateTableEx(function(t,i){return es6.powerbi.visuals.importTableExModule().then(function(e){return new e.TableEx(t,i)})}),t.setCreateMatrix(function(){return es6.powerbi.visuals.importMatrixModule().then(function(e){return new e.Matrix})}),t.setCreateTable(function(){return es6.powerbi.visuals.importTableModule().then(function(e){return new e.Table})})}}(powerbi=powerbi||{}),function(e){var g;function t(){}e=(e=e.visuals||(e.visuals={})).controls||(e.controls={}),g=e.pivotTable||(e.pivotTable={}),t.prototype.setGroupLocations=function(e,t,i,o,r,n,a,l,s,u){var h=n.getHeadersWidth(),d=o.getHeadersHeight();switch(t){case g.TablixSection.Header:this.setHeaderSectionGroupLocation(e,h,d,i,o,r,n,l,s,u);break;case g.TablixSection.Body:this.setBodySectionGroupLocation(e,h,i,r,n,a,l,s,u);break;case g.TablixSection.Footer:this.setFooterSectionGroupLocation(e,h,i,r,a,l,s)}},t.prototype.setHeaderSectionGroupLocation=function(e,t,i,o,r,n,a,l,s,u){this.setCornerGroupLocation(e,t,i,o,r,a,s,l,u),this.setColumnHeaderGroupLocation(e,t,i,o,r,n,l,s)},t.prototype.setColumnHeaderGroupLocation=function(e,t,i,o,r,n,a,l){for(var s=l.visibleColumnRange,u=1;u<l.columnNavigator.getHierarchyDepth();u++)a.rightRows[u]||(d=r.getLevelTop(u),e.push({x1:0,y1:d,x2:o.clientWidth,y2:d,isLeftSection:!1,orientation:"horizontal"}),a.rightRows[u]=!0);for(var h,d,c=s[0];c<s[1];c++)a.columns[c]||(h=this.getColumnXValue(c,t,n),d=this.getColumnHeaderY1Value(c,r,l),e.push({x1:h,y1:d,x2:h,y2:i,isLeftSection:!1,orientation:"vertical",borderColumnIndex:c}),a.columns[c]=!0);a.rightBorders[1]||(e.push({x1:t,y1:0,x2:o.clientWidth,y2:0,isLeftSection:!1,orientation:"horizontal",outline:1}),a.rightBorders[1]=!0),a.rightBorders[2]||s[1]!==l.columnNavigator.getHierarchyLeafCount()-1||(e.push({x1:o.clientWidth+t,y1:0,x2:o.clientWidth+t,y2:i,isLeftSection:!1,orientation:"vertical",borderColumnIndex:l.columnNavigator.getHierarchyLeafCount()-1,outline:2}),a.rightBorders[2]=!0),a.rightBorders[4]||(e.push({x1:t,y1:i,x2:o.clientWidth,y2:i,isLeftSection:!1,orientation:"horizontal",outline:4}),a.rightBorders[4]=!0)},t.prototype.setCornerGroupLocation=function(e,t,i,o,r,n,a,l,s){for(var u,h=1;h<a.columnNavigator.getHierarchyDepth();h++)l.cornerColumnLevels[h]||(u=r.getLevelTop(h),e.push({x1:0,y1:u,x2:t,y2:u,isLeftSection:!0,orientation:"horizontal"}),l.cornerColumnLevels[h]=!0);for(var d,c=1;c<=a.rowNavigator.getHierarchyDepth();c++)l.cornerRowLevels[c]||(d=s===g.RowHeaderType.Stepped?t:n.getLevelLeft(c),e.push({x1:d,y1:0,x2:d,y2:i,isLeftSection:!0,orientation:"vertical"}),l.cornerRowLevels[c]=!0);l.leftBorders[1]||(e.push({x1:0,y1:0,x2:o.clientWidth,y2:0,isLeftSection:!0,orientation:"horizontal",outline:1}),l.leftBorders[1]=!0),l.leftBorders[4]||(e.push({x1:0,y1:i,x2:o.clientWidth,y2:i,isLeftSection:!0,orientation:"horizontal",outline:4}),l.leftBorders[4]=!0),l.leftBorders[8]||(e.push({x1:0,y1:0,x2:0,y2:o.clientHeight,isLeftSection:!0,orientation:"vertical",outline:8}),l.leftBorders[8]=!0)},t.prototype.setBodySectionGroupLocation=function(e,t,i,o,r,n,a,l,s){this.setRowHeaderGroupLocation(e,t,i,r,n,a,l,s),this.setBodyGroupLocation(e,t,i,o,n,a,l,s)},t.prototype.getRowYValue=function(e,t){var i=t.getPageRows(),o=g.MeasureUtil.getPageIndex(e,g.PageRowCount);return t.getPageRowTop(i[o])+_.sum(i[o].getRowHeights().slice(0,e%g.PageRowCount))+i[o].getRowHeights()[e%g.PageRowCount]},t.prototype.getRowHeaderX1Value=function(e,t,i){e=i.rowNavigator.getHierarchyLeafAt(e),e=this.getHighestAlignedLevel(e,i.rowNavigator);return t.getLevelLeft(e)},t.prototype.getColumnXValue=function(e,t,i){var o=i.getPageColumns(),r=g.MeasureUtil.getPageIndex(e,g.PageColumnCount),i=i.getPageColumnLeft(o[r])+_.sum(o[r].getColumnWidths().slice(0,e%g.PageColumnCount));return t+o[r].getColumnWidths()[e%g.PageColumnCount]+i},t.prototype.getColumnHeaderY1Value=function(e,t,i){e=i.columnNavigator.getHierarchyLeafAt(e),e=this.getHighestAlignedLevel(e,i.columnNavigator);return t.getLevelTop(e)},t.prototype.getHighestAlignedLevel=function(e,t){var i=t.getParent(e);return i&&t.isLastItem(e,t.getChildren(i))?this.getHighestAlignedLevel(i,t):t.getLevel(e)},t.prototype.setRowHeaderGroupLocation=function(e,t,i,o,r,n,a,l){for(var s,u=a.visibleRowRange,h=u[0];h<=u[1];h++)n.leftRows[h]||(s=this.getRowYValue(h,r),c=this.getRowHeaderX1Value(h,o,a),e.push({x1:c,y1:s,x2:t,y2:s,isLeftSection:!0,orientation:"horizontal",borderRowIndex:h}),n.leftRows[h]=!0);for(var d=1;d<a.rowNavigator.getHierarchyDepth();d++){var c=o.getLevelLeft(d);n.cornerRowLevels[d]||(e.push({x1:c,y1:0,x2:c,y2:i.clientHeight,isLeftSection:!0,orientation:"vertical"}),n.cornerRowLevels[d]=!0)}n.leftBorders[1]||0!==u[0]||(e.push({x1:0,y1:0,x2:t,y2:0,isLeftSection:!0,orientation:"horizontal",borderRowIndex:0,outline:1}),n.leftBorders[1]=!0),n.leftBorders[8]||(e.push({x1:0,y1:0,x2:0,y2:i.clientHeight,isLeftSection:!0,orientation:"vertical",outline:8}),n.leftBorders[8]=!0),n.leftBorders[2]||(e.push({x1:t,y1:0,x2:t,y2:i.clientHeight,isLeftSection:!0,orientation:"vertical",outline:2}),n.leftBorders[2]=!0),n.leftBorders[4]||u[1]!==a.rowNavigator.getHierarchyLeafCount()-1||l!==g.RowHeaderType.Blocked||(e.push({x1:0,y1:i.clientHeight,x2:t,y2:i.clientHeight,isLeftSection:!0,orientation:"horizontal",borderRowIndex:a.rowNavigator.getHierarchyLeafCount()-1,outline:4}),n.leftBorders[4]=!0)},t.prototype.setBodyGroupLocation=function(e,t,i,o,r,n,a,l){for(var s,u=a.visibleRowRange,h=u[0];h<=u[1];h++)n.rightRows[h]||(s=this.getRowYValue(h,r),e.push({x1:t,y1:s,x2:i.clientWidth,y2:s,isLeftSection:!1,orientation:"horizontal",borderRowIndex:h}),n.rightRows[h]=!0);for(var d,c=a.visibleColumnRange,p=c[0];p<c[1];p++)n.columns[p]||(d=this.getColumnXValue(p,t,o),e.push({x1:d,y1:0,x2:d,y2:i.clientHeight,isLeftSection:!1,orientation:"vertical",borderColumnIndex:p}),n.columns[p]=!0);n.rightBorders[1]||0!==u[0]||(e.push({x1:t,y1:0,x2:i.clientWidth,y2:0,isLeftSection:!1,orientation:"horizontal",borderRowIndex:0,outline:1}),n.rightBorders[1]=!0),n.rightBorders[8]||0!==c[0]||(e.push({x1:t,y1:0,x2:t,y2:i.clientHeight,isLeftSection:!1,orientation:"vertical",borderColumnIndex:0,outline:8}),n.rightBorders[8]=!0),n.rightBorders[2]||c[1]!==a.columnNavigator.getHierarchyLeafCount()-1||(e.push({x1:i.clientWidth+t,y1:0,x2:i.clientWidth+t,y2:i.clientHeight,isLeftSection:!1,orientation:"vertical",borderColumnIndex:a.columnNavigator.getHierarchyLeafCount()-1,outline:2}),n.rightBorders[2]=!0),n.rightBorders[4]||u[1]!==a.rowNavigator.getHierarchyLeafCount()-1||l!==g.RowHeaderType.Blocked||(e.push({x1:t,y1:i.clientHeight,x2:i.clientWidth,y2:i.clientHeight,isLeftSection:!1,orientation:"horizontal",borderRowIndex:a.rowNavigator.getHierarchyLeafCount()-1,outline:4}),n.rightBorders[4]=!0)},t.prototype.setFooterSectionGroupLocation=function(e,t,i,o,r,n,a){this.setFloatingRowHeaderGroupLocation(e,t,r,n,a),this.setFloatingBodyGroupLocation(e,t,i,o,r,n,a)},t.prototype.setFloatingRowHeaderGroupLocation=function(e,t,i,o,r){for(var n=i.getFloatingRowHeights(),a=r.visibleRowRange,l=i.getFloatingPageRow().getRowHeights(),s=0,u=a[0];u<a[1];u++)o.leftRows[u]||(s+=l[u],e.push({x1:0,y1:s,x2:t,y2:s,isLeftSection:!0,orientation:"horizontal",borderRowIndex:u}),o.leftRows[u]=!0);o.leftBorders[8]||(e.push({x1:0,y1:0,x2:0,y2:n,isLeftSection:!0,orientation:"vertical",outline:8}),o.leftBorders[8]=!0),o.leftBorders[2]||(e.push({x1:t,y1:0,x2:t,y2:n,isLeftSection:!0,orientation:"vertical",outline:2}),o.leftBorders[2]=!0),o.leftBorders[4]||(e.push({x1:0,y1:n,x2:t,y2:n,isLeftSection:!0,orientation:"horizontal",outline:4}),o.leftBorders[4]=!0)},t.prototype.setFloatingBodyGroupLocation=function(e,t,i,o,r,n,a){for(var l=r.getFloatingRowHeights(),s=a.visibleRowRange,u=r.getFloatingPageRow().getRowHeights(),h=0,d=s[0];d<s[1];d++)n.rightRows[d]||(h+=u[d],e.push({x1:t,y1:h,x2:i.clientWidth,y2:h,isLeftSection:!1,orientation:"horizontal",borderRowIndex:d}),n.rightRows[d]=!0);for(var c,p=a.visibleColumnRange,g=p[0];g<p[1];g++)n.columns[g]||(c=this.getColumnXValue(g,t,o),e.push({x1:c,y1:0,x2:c,y2:l,isLeftSection:!1,orientation:"vertical",borderColumnIndex:g}),n.columns[g]=!0);n.rightBorders[8]||(e.push({x1:t,y1:0,x2:t,y2:l,isLeftSection:!1,orientation:"vertical",outline:8}),n.rightBorders[8]=!0),n.rightBorders[2]||(e.push({x1:i.clientWidth+t,y1:0,x2:i.clientWidth+t,y2:l,isLeftSection:!1,orientation:"vertical",outline:2}),n.rightBorders[2]=!0),n.rightBorders[4]||(e.push({x1:t,y1:l,x2:i.clientWidth,y2:l,isLeftSection:!1,orientation:"horizontal",outline:4}),n.rightBorders[4]=!0)},g.TablixBorderManager=t}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['pivotTableVisuals.min.js'] || (this.parseTimeMarkers['pivotTableVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
