"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['textboxVisual.min.js'] || (this.parseTimeMarkers['textboxVisual.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('textboxVisual.min.js');var es6,powerbi,__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,s,a,l){return new(a=a||Promise)(function(i,e){function o(t){try{r(l.next(t))}catch(t){e(t)}}function n(t){try{r(l.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?i(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(o,n)}r((l=l.apply(t,s||[])).next())})},__generator=this&&this.__generator||function(o,n){var r,s,a,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return l.label++,{value:e[1],done:!1};case 5:l.label++,s=e[1],e=[0];continue;case 7:e=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){l=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3]))l.label=e[1];else if(6===e[0]&&l.label<a[1])l.label=a[1],a=e;else{if(!(a&&l.label<a[2])){a[2]&&l.ops.pop(),l.trys.pop();continue}l.label=a[2],l.ops.push(e)}}e=n.call(o,l)}catch(t){e=[6,t],s=0}finally{r=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},__spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var o,n=0,r=e.length;n<r;n++)!o&&n in e||((o=o||Array.prototype.slice.call(e,0,n))[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))};!function(l){var u,t,c;function s(t,e){return l.isValueRef(t)?i(t.selector.id,e):t}function i(t,e){e=null==e?void 0:e[t];return null==e?void 0:e.formattedValue}function p(t){return _.isDate(t)?7:_.isInteger(t)?4:_.isNumber(t)?3:_.isBoolean(t)?5:_.isString(t)?1:0}u=l.visuals||(l.visuals={}),t=u.TextEvaluation||(u.TextEvaluation={}),c=l.visuals.valueFormatter.VariantValueFormatter,t.combineEvaluatedTextRuns=function(t,e){for(var i=[],o=0,n=t;o<n.length;o++){var r=s(n[o].value,e);r&&i.push(r)}return i.join("")},t.evaluateTextRunConditional=function(t,e){var i;return i=l.isValueRef(t.expression)?(i=t.expression.selector.id,null==(e=null==e?void 0:e[i])?void 0:e.value):t.expression,u.ConditionalEvaluator.processCases(t,i).textRuns},t.getTextRunValue=s,t.getTextRunValueFormatted=i,t.isTextRun=function(t){return _.isString(t.value)||l.isValueRef(t.value)},t.isAtMentionTextRun=function(t){return!_.isNil(t.mentionEmail)},t.isTextRunConditional=function(t){return _.isArray(t.cases)&&!!t.defaultCase&&_.isArray(t.defaultCase.textRuns)&&(l.isValueRef(t.expression)||_.isString(t.expression)||_.isNumber(t.expression)||_.isBoolean(t.expression)||_.isDate(t.expression))},t.populateEvaluatedValues=function(t,e,i){var o=u.textboxProps.values.expr.objectName,n=(u.textboxProps.values.formatString.objectName,l.DataViewObjects.getUserDefinedObjects(t,o));if(!_.isEmpty(n)){for(var r in n){var s=l.DataViewObject.getValue(n[r],u.textboxProps.values.expr.propertyName),a=new c({column:{displayName:"",objects:n,type:l.ValueType.fromPrimitiveTypeAndCategory(p(s))},formatStringPropId:{objectName:r,propertyName:u.textboxProps.values.formatString.propertyName},nullsAreBlank:!1});e[r]={value:s,formattedValue:a.format(s)}}i&&i.trace(2,"TextboxWithSmartNarrativeValuesDataChanged")}},t.primitiveTypeFromPrimitiveValue=p}(powerbi=powerbi||{}),function(a){var T,F,V,l,g,w,e,t,v,i,I,u,y,E,S,N,o,O,n,W,s,r,c,L,p,h,b,d,A;function f(t){this.asyncSerializer=new a.AsyncSerializer,t&&(this.supportsNarrativeExpressions=!1!==t.supportsNarrativeExpressions,this.supportsAtMention=!!t.supportsAtMention,this.textChangeThrottle=t.textChangeThrottle,this.placeholderText=t.placeholderText,this.supportsFormattingChangeIndicationOptions=!!t.supportsFormattingChangeIndication,this.hierarchicalTabbing=!!t.hierarchicalTabbing,t.textChangeThrottle&&this.supportsNarrativeExpressions,this.fontFamilies=__spreadArray([],t.allowedFonts||F.Fonts||[],!0),this.fontSizes=__spreadArray([],t.allowedFontSizes||F.FontSizes||[],!0),this.restrictFontSizes=_.some(t.allowedFontSizes),t.viewModelAdapter&&(this.viewModelAdapter=t.viewModelAdapter),this.disableScrollingInViewMode=t.disableScrollingInViewMode,this.featureSwitches=t.featureSwitches)}function m(t){this.smallViewportProperties=t}function C(){return L.call(this,{minHeightToScaleFontSize:1/0,minWidthToScaleFontSize:1/0})||this}function U(){}function j(t){t=Number(t);return 0<=t&&t<=9?40*t:0}function D(t,e){var i,o;return t&&(i=x(t)),e[w.QuillWrapper.atMentionBlotClass.class]&&!0!==e[w.QuillWrapper.atMentionBlotClass.class]&&(o={mentionEmail:(t=e[w.QuillWrapper.atMentionBlotClass.class]).email,value:null!=(e=t.displayName)?e:t.email},i)&&(o.textStyle=i),o}function H(t,e){var i,o;if(t&&((n=x(t))&&(i=n),void 0!==t.link)&&P(t.link)&&(o=t.link),e[w.QuillWrapper.smartNarrativesBlotClass.class]&&!0!==e[w.QuillWrapper.smartNarrativesBlotClass.class]){var n=(r=e[w.QuillWrapper.smartNarrativesBlotClass.class]).objRef;if(!n)return;if(n===w.QuillPlaceholder)return;s={textStyle:i,url:o,value:{propertyIdentifier:T.textboxProps.values.expr,selector:{id:n}}}}else if(e[w.QuillWrapper.smartNarrativesConditionalBlotClass.class]&&!0!==e[w.QuillWrapper.smartNarrativesConditionalBlotClass.class]){var r=e[w.QuillWrapper.smartNarrativesConditionalBlotClass.class];if(!T.TextEvaluation.isTextRunConditional(r.definition))return;for(var s,a=0,l=(s=r.definition).cases;a<l.length;a++)for(var u=0,c=l[a].textRuns;u<c.length;u++)(p=c[u]).textStyle=i,p.url=o;for(var p,h=0,d=s.defaultCase.textRuns;h<d.length;h++)(p=d[h]).textStyle=i,p.url=o}return s}function P(t){if(_.isEmpty(t))return!1;switch(O.getUrlScheme(t)){case o.http:case o.https:case o.mailto:return!0;default:return!1}}function x(t){var e,i={};return t.bold&&(i.fontWeight="bold"),t.font&&(e=T.Font.normalizeFamily(_.unescape(t.font),!1),e=F.getFontFromCSS(e),i.fontFamily=e),t.italic&&(i.fontStyle="italic"),t.size&&(i.fontSize=t.size),t.underline&&(i.textDecoration="underline"),t.color&&(i.color=t.color),t.script&&(i.lineHeight="0",i.position="relative",i.verticalAlign="baseline",i.scriptType=t.script,t.script===F.TextScriptTypes.Sub.toLowerCase()?i.bottom="-0.25em":i.top="-0.25em",t.indent)&&(i.indent=t.indent),i}function z(t,e,i,o,n,r,s,a,l,u){var c=this;this.readOnly=t,this.host=e,this.style=i,this.options=o,this.supportsAtMention=n,this.$mentionsHoverContainer=r,this.personCardComponent=s,this.placeholderText=a,this.supportsFormattingChangeIndication=l,this.hierarchicalTabbing=u,this.textChanged=_.noop,this.isDirty=!1,this.$container=$("<div>"),this.localizationProvider={get:function(t){return c.host.getLocalizedString(t)},getOptional:function(t){return c.host.getLocalizedString(t)},format:function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return c.host.getLocalizedString(t,e)}}}function R(t,e,i,o,n){this.host=t,this.quillWrapper=e,this.localizationProvider=i,this.linkInput=o}function k(){return $("<div>")}function G(){return $("<span>")}function Q(){return $("<button>")}function K(t,e,i,o,n){e=$("<select>").attr("aria-label",t).addClass("themeableElementCustom").append(J(e,o,n));return d.applyTooltip(e,t,i),e}function Y(t,e,i,o){return t.empty().append(J(e,i,o))}function J(t,i,o){return _.map(t,function(t){var e=$("<option>").text(t.label);return t.value===i?e.attr("selected","selected"):e.attr("value",t.value),e=void 0!==o?o(e,t):e})}function X(t,e,i,o,n,r){var s=Q();return s.attr("aria-label",e),d.applyTooltip(s,e,t),null!=i&&s.addClass("ql-"+i),null!=o&&s.attr("value",o),null==n&&(null!=i&&(n=i),null!=o)&&(n=(n||"")+o),s.addClass("themeableElementCustom"),null!=n&&r?(s.addClass("pbi-glyph-"+n),s.addClass(i),s.css("font-family","PowrMDL2")):s.addClass("powervisuals-glyph "+n),s}function Z(t,e){return e.get("RichTextbox_"+t+"_ToolTip")}function B(t,i,e,o,n){var r=this;this.$container=t,this.quill=i,this.quillStatic=e,this.$preview=this.$container.find("a.ql-preview"),this.$textbox=this.$container.find("input[type=text]"),this.textbox=this.$textbox[0],this.$action=this.$container.find(".ql-action"),this.toolbar=o,this.hide(),this.featureSwitches=n,this.$textbox.on("keydown",function(t){13===t.keyCode?r.onSave(t):27===t.keyCode&&r.onHide(t)}),["click","touchstart"].forEach(function(t){r.$action.on(t,function(t){r.$container.hasClass(B.editingClass)?r.onSave(t):r.onEdit(t)}),r.$container.find(".ql-remove").on(t,function(t){return r.onRemove(t)})}),i.on("selection-change",function(t){if(null!=t||!r.isEditing){if(null!=t&&0===t.length){var e=i.scroll.descendant(r.quillStatic.import(h.getFormatPath("link")),t.index);if(r.link=e[0],e=e[1],null!=r.link)return e={index:t.index-e,length:r.link.length()},void(_.isEqual(r.range,e)||(r.range=e,r.show(),r.updateToolbarWidth()));0<t.index&&i.scroll.descendant(r.quillStatic.import(h.getFormatPath("link")),t.index-1)[0]&&setTimeout(function(){return r.quill.format("link",!1)})}r.hide(),r.updateToolbarWidth()}})}function q(t){var e=this;this.quill=t.quill,this.uiComponentFactory=t.uiComponentFactory,this.$colorSwatch=t.$colorSwatch,this.$colorPickerButtonWrapper=t.$colorPickerButtonWrapper,this.defaultColor=t.defaultColor,this.format=t.format,this.currentColor=t.defaultColor,this.setSwatch(this.currentColor),t.$colorPickerButton.on("click",function(t){t.stopPropagation(),e.toggle()})}function M(t){this.container=t.container,this.destroyEditorActions=t.destroyEditorActions,this.evaluatedValues=t.evaluatedValues,this.hostServices=t.hostServices,this.localizationProvider=t.localizationProvider,this.onEditSmartNarrativePersist=t.onEditSmartNarrativePersist,this.quill=t.quill,this.style=t.style,this.toolbar=t.toolbar,this.container,this.destroyEditorActions,this.evaluatedValues,this.hostServices,this.localizationProvider,this.onEditSmartNarrativePersist,this.quill,this.style,this.toolbar;t=T.ColorHelper.getDataColorByIndex(t.style,0);this.focusColor=p.QuillWrapper.computeTransparentSmartNarrativesColor(t)}function tt(t){this.container=t.container,this.hostServices=t.hostServices,this.container,this.hostServices}function et(t){this.uiComponentFactory=t.uiComponentFactory,this.inputArgs=t.inputArgs,this.outputArgs=t.outputArgs,this.inputArgs,this.outputArgs,this.uiComponentFactory}T=a.visuals||(a.visuals={}),e=jsCommon.Color,t=jsCommon.CssConstants.createClassAndSelector,v=jsCommon.DOMConstants,i=jsCommon.FocusManager,I=jsCommon.FocusManagerFocusEventName,u=jsCommon.FocusNavModeAttribute,y=T.Units.FontSize,E=a.isValueRef,S=jsCommon.KeyUtils,N=jsCommon.StringExtensions,o=jsCommon.UrlUtils.UrlScheme,O=jsCommon.UrlUtils,T.mentionDefaultMaxSearchLength=48,n=t("textboxFocusElement"),W={linkTooltip:t("ql-link-tooltip"),toolbarUrlInput:t("toolbar-url-input")},(c=F=T.TextboxFormatting||(T.TextboxFormatting={})).Fonts=["Arial","Arial Black","Arial Unicode MS","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","DIN","DIN Light","Georgia","Lucida Sans Unicode","Segoe (Bold)","Segoe UI","Segoe UI Light","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Wingdings"],c.FontSizePrecision=1,c.FontSizes=[8,9,10,10.5,11,12,14,16,18,20,24,28,32,36,40,42,44,54,60,66,72,80,88,96],c.LegacyDefaultFont=T.Font.Family.light.family,c.LegacyFontSize=y.createFromPx(14),c.LegacyDefaultFontProperties={family:c.LegacyDefaultFont,size:c.LegacyFontSize},c.TextAlignments=["Left","Center","Right"],c.TextIndent=["-1","+1"],c.DefaultAlignment="Left",(r=c.TextScriptTypes||(c.TextScriptTypes={})).Super="Super",r.Sub="Sub",(r=c.TextListTypes||(c.TextListTypes={})).Bullet="bullet",r.Numbered="ordered",c.getCSSFromFont=function(t){var e=T.Font.FamilyMap[t];return e?e.family:t},c.getFontFromCSS=function(e){return _.findKey(T.Font.FamilyMap,function(t){return t.family===e||0<t.family.indexOf(e)})||e},f.prototype.init=function(t){this.element=t.element,this.host=t.host,this.viewport=t.viewport,this.style=t.style,this.readOnly=0===this.host.getViewMode(),this.paragraphs=[],this.defaultFont=__assign({},F.LegacyDefaultFontProperties),this.fontFamilies=__spreadArray([],this.fontFamilies||F.Fonts||[],!0),this.fontSizes=__spreadArray([],this.fontSizes||F.FontSizes||[],!0),this.evaluatedValues={},this.quillEditorIsReady=this.host.promiseFactory().defer(),this.featureSwitches=t.featureSwitches,this.configureMentions(),this.refreshView()},f.prototype.onResizing=function(t){var e=this.viewport;this.viewport=t,this.updateSize(),this.viewModelAdapter&&this.viewModelAdapter.onResizing(this.element,this.viewport,e,this.defaultFont)},f.prototype.onDataChanged=function(t){var t=t.dataViews,e=(this.evaluatedValues={},this.paragraphs=[],this.editor&&this.editor.isDirty);e&&(this.paragraphs=this.getContents()),t&&0<t.length&&((t=t[0].metadata.objects)&&t.general&&!e&&(this.paragraphs=t.general.paragraphs),T.TextEvaluation.populateEvaluatedValues(t,this.evaluatedValues,this.host.telemetry()),e=T.ColorHelper.create(this.style),this.defaultFont=T.FontProperties.createFromObjectOrStyle(t&&t.text,{family:"fontFamily",size:"fontSize",color:"color"},e,this.style,"foreground","label",F.LegacyDefaultFontProperties)),this.mergeParagraphFontsWithStandardFonts(),this.refreshView()},f.prototype.getTelemetryInformation=function(){for(var t,e=!1,i=[],o=0,n=this.paragraphs;o<n.length;o++)for(var r=0,s=n[o].textRuns;r<s.length;r++){var a,l=s[r];T.TextEvaluation.isTextRunConditional(l)?(e=!0,_.isEmpty(l.cases)||(a=_.first(l.cases),i.push(_.round(a.pattern,-2)))):T.TextEvaluation.isTextRun(l)&&E(l.value)&&(e=!0)}return e&&((t={SmartNarratives:!0}).SummarizationTemplateIds=i.join(","),t=t),t},f.prototype.mergeParagraphFontsWithStandardFonts=function(){var t=__spreadArray(__spreadArray([],_.map(this.fontSizes,function(t){return y.createFromPt(t)}),!0),[this.defaultFont.size],!1),e=_.chain(t).map(function(t){return t.pt}).uniqBy(function(t){return t}).sortBy(function(t){return t}).value(),i=F.getFontFromCSS(this.defaultFont.family),o=__spreadArray(__spreadArray([],this.fontFamilies,!0),[i],!1),i=this.paragraphs;if(i)for(var n=0,r=i;n<r.length;n++){var s=r[n];if(s.textRuns)for(var a=0,l=s.textRuns;a<l.length;a++){var u,c,p=l[a],p=p&&T.TextEvaluation.isTextRun(p)&&p.textStyle;p&&(p.fontSize&&(u=y.createFromCSS(p.fontSize,F.FontSizePrecision))&&(this.restrictFontSizes?(c=_.sortedIndex(e,u.pt),p.fontSize=e[Math.min(c,e.length-1)]+"pt"):t.push(u)),p.fontFamily)&&o.push(p.fontFamily)}}this.fontSizes=_.chain(t).map(function(t){return t.pt}).sortBy(function(t){return t}).uniqBy(function(t){return t}).value(),this.fontFamilies=_.chain(o).sortBy(function(t){return t}).uniqBy(function(t){return t}).value()},f.prototype.destroy=function(){this.editor&&(this.editor.destroy(),this.editor=void 0)},f.prototype.focus=function(){if(this.editor)return this.editor.focus(),!0},f.prototype.onViewModeChanged=function(t){this.readOnly=0===t,this.refreshView()},f.prototype.setSelection=function(t,e){this.editor,this.editor&&this.editor.setSelection(t,e)},f.prototype.getSelection=function(){return this.editor.getSelection()},f.prototype.ensureFocusableElement=function(){var t,e=this,i=this.element;i.find(n.selector).length||(t=$("<div>").width(0).height(0).attr("tabindex",0).addClass(n.class),i.append(t),t.on(I,function(){e.focus()}))},f.prototype.removeFocusableElement=function(){this.element.find(n.selector).remove()},f.prototype.refreshView=function(){return __awaiter(this,void 0,a.Promise,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,this.asyncSerializer.enqueue(function(){return __awaiter(e,void 0,void 0,function(){var e,i,o,n,r,s=this;return __generator(this,function(t){switch(t.label){case 0:return this.readOnly?(this.editor&&(this.editor.isDirty&&this.saveContents(),this.editor.destroy(),this.editor=null),this.element.empty(),i=l.convertParagraphsToHtml(this.paragraphs,this.defaultFont,this.evaluatedValues,this.$mentionsHoverContainer,this.personCardComponent),i=$("<div>").addClass(f.ClassAndSelector.class).css(T.FontProperties.toHTMLStyle(this.defaultFont)).append(i),this.supportsAtMention&&i.append(this.$mentionsHoverContainer),this.viewModelAdapter&&this.viewModelAdapter.onDataChanged(i,this.viewport,this.defaultFont),o=void 0,this.disableScrollingInViewMode?(o=i,this.element.append(i)):(o=this.$scrollableDiv=$("<div></div>").addClass(f.ScrollWrapperClassAndSelector.class).css({height:"".concat(this.viewport.height,"px"),"overflow-y":"auto","overflow-x":"hidden"}).append(i),this.element.append(this.$scrollableDiv)),this.removeFocusableElement(),o.attr("tabindex",0).attr("role","document").attr(u,"Browser").on("keydown",function(t){27===t.keyCode&&null!=(t=s.$scrollableDiv)&&t.removeAttr(u).removeAttr("tabindex")}).focusout(function(){var t;null!=(t=s.$scrollableDiv)&&t.attr("tabindex",0).attr(u,"Browser")}),[3,5]):[3,1];case 1:return(e={defaultFont:this.defaultFont,evaluatedValues:this.evaluatedValues,fontFamilies:this.fontFamilies,fontSizes:this.fontSizes,supportsNarrativeExpressions:this.supportsNarrativeExpressions,textChangeThrottle:this.textChangeThrottle,onEscape:function(){return s.focus()},featureSwitches:this.featureSwitches,supportsFormattingChangeIndication:this.supportsFormattingChangeIndicationOptions,onRenderTooltip:function(t,e){return s.getTooltipsComponent(t,e)},hierarchicalTabbing:this.hierarchicalTabbing},i=this.supportsFormattingChangeIndicationOptions&&!this.readOnly,this.editor)?[3,3]:(this.editor=new w.QuillWrapper(this.readOnly,this.host,this.style,e,this.supportsAtMention,this.$mentionsHoverContainer,this.personCardComponent,this.placeholderText,i,this.hierarchicalTabbing),this.editor.textChanged=function(){return s.saveContents()},this.element.empty(),this.ensureFocusableElement(),(o=this.editor.getElement()).addClass(f.ClassAndSelector.class),this.element.append(o),[4,this.editor.init()]);case 2:return t.sent(),[3,4];case 3:this.editor.updateOptions(e),t.label=4;case 4:if(!this.editor)return[2];this.editor.getElement().css(T.FontProperties.toHTMLStyle(this.defaultFont)),this.quillEditorIsReady.resolve(),this.restrictFontSizes&&(this.editor.onPaste=function(){s.mergeParagraphFontsWithStandardFonts(),s.refreshView()}),n=this.editor.getSelection(),r=l.convertParagraphsToOps(this.paragraphs,this.evaluatedValues,this.editor,this.style,this.$mentionsHoverContainer,this.personCardComponent),this.editor.setContents(r),n&&this.editor.setSelection(n.index,n.length),t.label=5;case 5:return this.updateSize(),[2]}})})})];case 1:return t.sent(),[2]}})})},f.prototype.getContents=function(){if(this.editor){var t=this.editor.getContents();if(t){t=l.convertDeltaToParagraphs(t,this.supportsNarrativeExpressions,this.evaluatedValues);if(!(t.length<1))return t}}},f.prototype.saveContents=function(){var t=this.getContents();t&&(this.paragraphs=t,t=[{objectName:"general",properties:{paragraphs:this.paragraphs},selector:null}],this.host.persistProperties(t))},f.prototype.updateSize=function(){this.editor?this.editor.resize(this.viewport):this.$scrollableDiv&&this.$scrollableDiv.css("height","".concat(this.viewport.height,"px"))},f.prototype.configureMentions=function(){var t;this.supportsAtMention&&(this.$mentionsHoverContainer=$("<span>").addClass(f.MentionsHoverClassAndSelector.class).hide(),t=this.host.getUIComponentFactory(),this.personCardComponent=t.createPersonCard(this.$mentionsHoverContainer.get(0)))},f.prototype.onTextEditorReady=function(){return this.quillEditorIsReady.promise},f.prototype.getTooltipsComponent=function(t,e){return this.tooltip&&this.tooltip.close(),this.tooltip=this.host.getUIComponentFactory().createTooltip(t,e),this.tooltip},f.ClassAndSelector=jsCommon.CssConstants.createClassAndSelector("textbox"),f.MentionsHoverClassAndSelector=t("mentions-hover"),f.ScrollWrapperClassAndSelector=jsCommon.CssConstants.createClassAndSelector("scrollWrapper"),s=f,T.Textbox=s,r=V=T.TextboxHelpers||(T.TextboxHelpers={}),m.prototype.onResizing=function(t,e,i,o){i=this.isSmallViewport(i),e=this.isSmallViewport(e);i!==e&&this.applyScaleOnElement(t,e,o)},m.prototype.onDataChanged=function(t,e,i){this.isSmallViewport(e)&&this.applyScaleOnElement(t,!0,i)},m.prototype.isSmallViewport=function(t){return!!t&&!!this.smallViewportProperties&&(t.height<=this.smallViewportProperties.minHeightToScaleFontSize||t.width<=this.smallViewportProperties.minWidthToScaleFontSize)},m.prototype.applyScaleOnElement=function(t,n,r){n&&(r=__assign(__assign({},r),{size:m.scale(r.size)})),t.find(s.ClassAndSelector.selector).css(T.FontProperties.toHTMLStyle(r)),t.find(l.TextRunElement.selector).each(function(t,e){n?(o=void 0,o=(i=$(e).css("font-size"))?y.createFromCSS(i):r.size,i=m.scale(o)):(o=(o=$(e).data(l.ModelKeyName)).textStyle&&o.textStyle.fontSize)&&(i=y.createFromCSS(o));var i,o=r;i&&(o=__assign(__assign({},r),{size:i})),T.FontProperties.applyStyleToElement(o,e)})},m.scale=function(t){t=t.px,t=66<t?32:42<t?28:26<t?24:16<t?20:11<t?14:12;return y.createFromPx(t)},c=m,r.ViewModelAdapter=c,__extends(C,L=c),c=C,r.AlwaysUseSmallViewport=C,U.format=function(t){return/^\S+@\S+\.\S+$/.test(t)?"mailto:"+t:/^https?:\/\//i.test(t)?t:"https://"+t},r.LinkPreview=U,(g=l=T.RichTextConversion||(T.RichTextConversion={})).ModelKeyName="ModelObject",g.TextRunElement=jsCommon.CssConstants.createClassAndSelector("textRun"),g.convertDeltaToParagraphs=function(t,e,i){for(var o,n=[],r={textRuns:[]},s=!1,a=0,l=t.ops.length;a<l;a++){var u=t.ops[a],c=u.attributes,u=u.insert;if(void 0!==u)if(_.isString(u)){var p,h=u,s=!1,d=(c&&c.align&&(void 0!==r.horizontalTextAlignment&&(r.horizontalTextAlignment,c.align),r.horizontalTextAlignment=c.align),c&&c.indent&&(r.indent=c.indent),c&&c.list&&(r.listType=c.list),0),f=0,m=void 0;do{}while((f=h.indexOf(T.TextRunNewline,d))<0?(m=!1,f=h.length):m=!0,0<f-d&&(g={value:h.substring(d,f)},c&&(void 0!==c.link&&P(c.link)&&(g.url=c.link),p=x(c))&&(g.textStyle=p),r.textRuns.push(g)),m&&(0===r.textRuns.length&&r.textRuns.push({value:""}),n.push(r),r={textRuns:[]}),(d=f+1)<h.length)}else if(!_.isNumber(u)){var g,v=D(c,u);if(v)r.textRuns.push(v);else if(e)if(g=H(c,u)){if(T.TextEvaluation.isTextRunConditional(g)){v=T.TextEvaluation.evaluateTextRunConditional(g,i),u=T.TextEvaluation.combineEvaluatedTextRuns(v,i);if((u===T.TextRunNewline||u===T.TextRunNewlineHidden)&&!s){0===r.textRuns.length&&r.textRuns.push({value:""}),n.push(r),s=!(r={textRuns:[]});continue}s=!0}r.textRuns.push(g)}}}return 0<r.textRuns.length&&(o=_.first(r.textRuns),T.TextEvaluation.isTextRun(o))&&_.isString(o.value)&&0<o.value.length&&n.push(r),n},g.convertParagraphsToHtml=function(t,a,l,u,c){for(var e=$(),i=0,o=$(),n=0,r=t.length;n<r;++n){for(var s,p=t[n],h=!0,d=(p.listType===F.TextListTypes.Numbered?i++:o=void(i=0),$("<p>").data(g.ModelKeyName,p)),f=(p.horizontalTextAlignment&&d.css("text-align",p.horizontalTextAlignment),p.indent&&d.css("padding","0px 0px 0px "+j(p.indent)+"px"),0),m=p.textRuns.length;f<m;++f)!function(t){var i,t=p.textRuns[t],e=void 0,o=void 0,n=void 0;if(T.TextEvaluation.isTextRun(t))e=t.value,o=t.textStyle,n=t.url,T.TextEvaluation.isAtMentionTextRun(t)&&(e="@".concat(e),(o=o||{}).color="#1453b3",i=t.mentionEmail);else{if(!T.TextEvaluation.isTextRunConditional(t))return;var r=T.TextEvaluation.evaluateTextRunConditional(t,l);if((e=T.TextEvaluation.combineEvaluatedTextRuns(r,l))===T.TextRunNewlineHidden)return;_.isEmpty(r)||(o=r[0].textStyle,n=r[0].url)}_.isEmpty(e)||(h=!1);var s=void 0!==n&&P(n)?$("<a>").attr("href",n).attr("rel","noopener noreferrer").attr("target","_blank"):$("<span>"),r=T.TextEvaluation.getTextRunValue(e,l),n=(s.text(r).addClass(g.TextRunElement.class).data(g.ModelKeyName,t),o);n&&(e={},n.fontFamily&&(e["font-family"]=w.getCssFontFamily(n.fontFamily,a)),n.fontSize&&(r=y.createFromCSS(n.fontSize),e["font-size"]=w.getCssFontSize(r,a)),n.fontStyle&&(e["font-style"]=n.fontStyle),n.fontWeight&&(e["font-weight"]=n.fontWeight),n.color&&(e.color=n.color),n.textDecoration&&(e["text-decoration"]=n.textDecoration),n.scriptType&&("0"===n.lineHeight?e.lineHeight="Normal":e.lineHeight=n.lineHeight,e.position=n.position,e.verticalAlign=n.verticalAlign,n.scriptType===F.TextScriptTypes.Sub.toLowerCase()?e.bottom=n.bottom:e.top=n.top),s.css(e)),i&&s.on(v.pointerOverEventName,function(){c.showUser(i);var t=s.get(0),e=t.getBoundingClientRect();u.stop(!0,!0).css({left:t.offsetLeft,top:t.offsetTop-e.height-32}).delay(200).queue(function(t){s.is(":hover")&&u.fadeIn("fast"),t()})}).on(v.pointerOutEventName,function(){u.delay(500).queue(function(t){var e=function(t){u.is(":hover")?setTimeout(function(){return e(t)},500):t()};e(t)}).fadeOut("fast")}),d.append(s)}(f);p.listType===F.TextListTypes.Bullet&&(d.css("display","inline"),(d=d.wrap("<ul><li></li></ul>").parent().parent()).css("text-align",p.horizontalTextAlignment)),p.listType===F.TextListTypes.Numbered?(s="list-style-type: decimal !important; list-style-position: inside !important;",d.css("display","inline"),1===i?((o=d=d.wrap("<ol><li></li></ol>").parent().parent()).children().attr("style",s),e=e.add(o)):1<i&&((d=d.wrap("<li></li>").parent()).attr("style",s),o.append(d)),d.css("text-align",p.horizontalTextAlignment)):(h&&d.append($("<br>")),e=e.add(d))}return e},g.convertIndentToPadding=j,g.convertParagraphsToOps=function(t,e,i,o,n,r){for(var s=[],a=0,l=0,u=t.length;l<u;++l){for(var c=t[l],p=0,h=c.textRuns.length;p<h;++p){var d=c.textRuns[p],f=void 0,m=void 0,g=void 0;if(T.TextEvaluation.isTextRun(d))f=d.textStyle,m=d.url,g=d.value;else{if(!T.TextEvaluation.isTextRunConditional(d))continue;_.isEmpty(d.cases)||(C=_.first(d.cases),_.isEmpty(C.textRuns))||(f=_.first(C.textRuns).textStyle,m=_.first(C.textRuns).url)}var v,y,C={},x=(f&&(f.fontFamily&&(C.font=T.Font.normalizeFamily(F.getCSSFromFont((x=f.fontFamily,!_.startsWith(x,"'")||N.containsIgnoreCase(x,",")?x:(_.endsWith(x,"'"),x.slice(1,x.length-1)))))),f.fontSize&&(C.size=f.fontSize),f.color&&(C.color=f.color),C.italic="italic"===f.fontStyle||void 0,C.bold="bold"===f.fontWeight||void 0,C.underline="underline"===f.textDecoration||void 0,f.scriptType)&&(C.script=f.scriptType),g),f=(m&&P(m)&&(C.link=m),void 0);f=E(x)?(v=x.selector.id,y={definition:d,destroyEditorActions:i.destroyEditorActions,evaluatedValues:e,localizationProvider:i.localizationProvider,objRef:v,onSelectSmartNarrativesBlot:function(t){var e;null!=(e=null==i?void 0:i.smartNarrativesEditorContainer)&&e.getSmartNarrativesEditor().onSelectEditableObject(t)},style:o},{attributes:C,insert:((g={})[w.QuillWrapper.smartNarrativesBlotClass.class]=y,g)}):T.TextEvaluation.isTextRunConditional(d)?(v=E(d.expression)?d.expression.selector.id:void 0,y={conditionalIndex:a,definition:d,destroyEditorActions:i.destroyEditorActions,evaluatedValues:e,localizationProvider:i.localizationProvider,objRef:v,onSelectSmartNarrativesBlot:function(t){var e;null!=(e=null==i?void 0:i.smartNarrativesEditorContainer)&&e.getSmartNarrativesEditor().onSelectEditableObject(t)},onSelectSmartNarrativesConditionalBlot:function(t){setTimeout(function(){null!=i&&i.setSelectionOfConditional(t)})},style:o},a++,{attributes:C,insert:((m={})[w.QuillWrapper.smartNarrativesConditionalBlotClass.class]=y,m)}):T.TextEvaluation.isAtMentionTextRun(d)?(y={email:d.mentionEmail,displayName:x,hoverContainer:n,personCardComponent:r},{attributes:C,insert:((g={})[w.QuillWrapper.atMentionBlotClass.class]=y,g)}):{attributes:C,insert:x},s.push(f)}var S={insert:"\n"},b=(_.endsWith(_.last(s).insert,"\n"),function(t){var e={};t.horizontalTextAlignment&&(e.align=t.horizontalTextAlignment);t.listType&&(e.list=t.listType);t.indent&&(e.indent=t.indent);return!_.isEmpty(e)&&e}(c));b&&(S.attributes=b),s.push(S)}return s},g.getAtMentionTextRun=D,g.getTextRunFromSmartNarrativesInsert=H,g.isValidLinkUrl=P,(p=w=T.RichText||(T.RichText={})).getCssFontFamily=function(t,e){return(t=F.getCSSFromFont(t))!==e.family?t:void 0},p.getCssFontSize=function(t,e){return null==t||t.equals(e.size)?"":"".concat(t.pt,"pt")},p.QuillPlaceholder="__Placeholder__",p.getCustomQuillFormatValue=function(t,e){var i;return i=void 0===t||_.isString(t.insert)||_.isNumber(t.insert)||void 0===t.insert?i:t.insert[e]},z.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return T.TextboxUtil.getLoadQuillResources()?(this.initialized=!1,[4,this.host.loader().require({javascript:"quill",css:["quill.core"]})]):[3,3];case 1:return(e=t.sent(),this.$container)?[4,this.initializeQuill(e)]:[2];case 2:return t.sent(),[3,5];case 3:return[4,this.initializeQuill(window.Quill)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},z.getFormatPath=function(t){return"".concat(z.quillFormatsPath,"/").concat(t)},z.prototype.updateOptions=function(t){var e;this.initialized&&(this.options=t,(e=this.toolbar)&&e.updateOptions(t),this.smartNarrativesEditorContainer)&&this.smartNarrativesEditorContainer.updateOptions(t)},z.prototype.initializeQuill=function(e){return __awaiter(this,void 0,a.Promise,function(){return __generator(this,function(t){switch(t.label){case 0:return this.quillStatic=e,[4,this.rebuildQuillEditor()];case 1:return t.sent(),this.initialized=!0,this.quillStatic.debug("error"),[2]}})})},z.prototype.getElement=function(){return this.$container},z.prototype.getContents=function(){if(this.initialized)return this.editor.getContents()},z.prototype.setContents=function(t){this.initialized,this.editor&&this.editor.setContents(t)},z.prototype.resize=function(t){this.$container.width(t.width),this.$container.height(t.height),this.updateToolbar()},z.prototype.setSelection=function(t,e){this.editor&&this.editor.setSelection(t,e)},z.prototype.getSelection=function(t){if(this.editor)return this.editor.getSelection(t)},z.prototype.focus=function(){this.editor&&0===$(document.activeElement).closest(this.$container).length&&this.editor.focus()},z.prototype.destroy=function(){this.host.setToolbar(null),this.toolbar=null,this.$container.remove(),this.$container=null,this.destroyEditor()},z.prototype.destroyEditor=function(){this.editor&&(_.isEmpty(this.destroyEditorActions)||(_.forEach(this.destroyEditorActions,function(t){return t()}),this.destroyEditorActions=void 0),this.editor=null)},z.prototype.getSelectionAtCursor=function(){var t=this.getTextWithoutTrailingBreak(),e=this.getSelection(!0);return e&&0===e.length?{index:(t=jsCommon.WordBreaker.find(e.index,t)).start,length:t.end-t.start}:e},z.prototype.getWord=function(){var t=this.getSelectionAtCursor();return this.getTextWithoutTrailingBreak().slice(t.index,t.index+t.length)},z.prototype.getEditorContainer=function(){if(this.editor)return $(this.editor.container)},z.prototype.setSelectionOfConditional=function(t){var e=this.getContents();if(e)for(var i=0,o=0,n=e.ops;o<n.length;o++){var r=n[o];if(!r)return;if(_.isString(r.insert))i+=r.insert.length;else if(_.isNumber(r.insert))i+=1;else{i+=1;r=p.getCustomQuillFormatValue(r,p.QuillWrapper.smartNarrativesConditionalBlotClass.class);if((null==r?void 0:r.conditionalIndex)===t){this.setSelection(i,0);break}}}},z.computeTransparentSmartNarrativesColor=function(t){t=e.parseColorString(t);return t.A=z.smartNarrativesPlaceholderOpacity,e.rgbString(t)},z.prototype.getTextWithoutTrailingBreak=function(){return this.editor.getText().slice(0,-1)},z.prototype.rebuildQuillEditor=function(){var x;return __awaiter(this,void 0,a.Promise,function(){var e,i,o,n,r,s,a,l,u,c,p,h,d,f,m,g,v,y,C=this;return __generator(this,function(t){switch(t.label){case 0:return(e=null,i=this.options.supportsNarrativeExpressions,this.editor&&(e=this.editor.getContents()),this.$container.empty(),this.$container.keydown(function(t){var e=t.which;t.ctrlKey&&S.isCtrlShortcutKey(e)&&t.stopPropagation(),(S.isArrowKey(e)||S.isNudgeModifierKey(e))&&t.stopPropagation(),S.isDeleteKey(e)&&t.stopPropagation(),jsCommon.BrowserUtils.isCtrlOrMeta(t)&&117===t.keyCode&&(C.focusToolbar(),t.stopPropagation())}),o=$("<div>"),r={readOnly:this.readOnly,formats:["bold","italic","underline","font","size","link","align","color","indent","script","list"],modules:{history:{userOnly:!0},keyboard:{bindings:{}}},placeholder:this.placeholderText},s=this.host.getUIComponentFactory(),a=[],this.supportsAtMention?(this.setupAtMentionFormat(),n=$("<div>"),a.push({mentionCharacter:"@",blotName:z.atMentionBlotClass.class,initialize:function(t,e){n.addClass(z.atMentionContainerClass.class).hide();C.userSuggestionsComponent=t.createUserSuggestions(n.get(0),function(t){e({displayName:t.displayName,email:t.email,hoverContainer:C.$mentionsHoverContainer,personCardComponent:C.personCardComponent})})},hideSuggestions:function(){return n.hide(),C.userSuggestionsComponent.hideSuggestions()},renderSuggestions:function(t,e,i){n.css({left:e,top:i}).show(),C.userSuggestionsComponent.showSuggestions(t)},pickSuggestion:function(){return C.userSuggestionsComponent.pickSuggestion()},navigateSuggestions:function(t){return C.userSuggestionsComponent.navigateSuggestions(t)}}),r.formats.push(z.atMentionBlotClass.class),l=function(){for(var t=!0,e=0,i=a;e<i.length;e++)t=i[e].pickSuggestion();return t},r.modules.keyboard.bindings.enter={handler:l,key:13},r.modules.keyboard.bindings.tab={handler:l,key:9}):this.hierarchicalTabbing&&(l=function(){return!0},r.modules.keyboard.bindings.tab={handler:l,key:9}),_.isEmpty(a)||(r.modules.mention={save:function(){return C.saveState()},mentions:a,maxSearchLength:T.mentionDefaultMaxSearchLength,componentFactory:s},this.registerMentionModule()),i&&(r.formats.push(z.smartNarrativesBlotClass.class),r.formats.push(z.smartNarrativesConditionalBlotClass.class),r.formats.push(z.smartNarrativesFocusFormatAttributeName)),u=b.buildToolbarLinkInputTemplate(this.localizationProvider),u=A.LinkInput.buildNode(u),this.readOnly)?[3,4]:(c=this.toolbar,this.toolbar?[3,2]:(p=this,[4,A.createToolbar(this.host,this,this.localizationProvider,u,this.options)]));case 1:return c=p.toolbar=t.sent(),(f=c.getElement()).addClass("unselectable"),f.toggleClass("high-contrast",this.style.isHighContrast),r.modules.toolbar={container:f.get(0)},[3,3];case 2:c.updateOptions(this.options),t.label=3;case 3:o.attr("drag-resize-disabled","true"),t.label=4;case 4:return this.destroyEditor(),this.destroyEditorActions=[],i&&(this.setUpSmartNarrativesFormat(),this.setUpSmartNarrativesConditionalFormat(),this.setUpSmartNarrativesFocusFormat()),this.editor=new this.quillStatic(o.get(0),r),this.readOnly||(h=new A.LinkInput(u,this.editor,this.quillStatic,this.toolbar,this.options.featureSwitches),g=function(t){t?(C.editor.setSelection(C.getSelectionAtCursor()),h.open()):h.remove()},z.setUpFontFormat(this.quillStatic),(d=this.editor.getModule("toolbar")).addHandler("link",g),s&&(f=this.toolbar.getElement(),m=new A.ColorPicker({quill:this.editor,uiComponentFactory:s,$colorSwatch:f.find(A.ColorPicker.colorSwatchGlyphClassAndSelector.selector),$colorPickerButton:f.find(A.ColorPicker.pickerButtonClassAndSelector.selector),$colorPickerButtonWrapper:f.find(A.ColorPicker.pickerButtonWrapperClassAndSelector.selector),defaultColor:T.ColorHelper.getThemeColor(this.style,T.ForegroundColorName),format:"color"}),g=function(){return m.applyFormat(m.getColor())},d.addHandler("color",g)),this.destroyEditorActions.push(function(){d.addHandler("link",void 0),d.addHandler("color",void 0)}),i&&s&&(this.smartNarrativesEditorContainer=new A.SmartNarrativesEditor({container:this.toolbar.getElement(),destroyEditorActions:this.destroyEditorActions,evaluatedValues:this.options.evaluatedValues,hostServices:this.host,localizationProvider:this.localizationProvider,onEditSmartNarrativePersist:this.textChanged,quill:this.editor,style:this.style,toolbar:this.toolbar}),this.smartNarrativesEditorContainer.getSmartNarrativesEditor()),this.supportsFormattingChangeIndication&&(this.formattingSettingsContainer=new A.FormattingSettings({container:this.toolbar.getElement(),hostServices:this.host}),this.formattingSettingsContainer.getTextboxFormattingSettings()),this.updateToolbar()),this.$container.append(o),this.$mentionsHoverContainer&&this.$container.append(this.$mentionsHoverContainer),n&&this.$container.append(n),e&&this.setContents(e),i||this.supportsFormattingChangeIndication?(this.editor.keyboard.addBinding({key:83,shiftKey:!0,shortKey:!0},void 0,function(){C.saveState()}),v=function(t,e,i){"api"!==i&&(C.isDirty=!0)},this.editor.on("text-change",v),this.destroyEditorActions.push(function(){C.editor.off("text-change",v),v=void 0})):this.throttleTextChanged(),this.supportsFormattingChangeIndication&&null!=(x=this.formattingSettingsContainer.getTextboxFormattingSettings())&&x.shouldListenToTextChanged()&&this.throttleTextChanged(),y=function(t){t=t.relatedTarget||document.activeElement;if(t){if(C.targetIsInToolbar(t,i))return;if((i||C.supportsFormattingChangeIndication)&&C.saveState(),z.willBrowserHandleFocus(t))return}C.setSelection(null,null)},this.editor.root.addEventListener("blur",y,!1),this.destroyEditorActions.push(function(){C.editor.root.removeEventListener("blur",y,!1)}),[2]}})})},z.prototype.throttleTextChanged=function(){function t(t,e,i){if("api"!==i){s.isDirty=!0;for(var o=0,n=t.ops;o<n.length;o++){var r=n[o];if(z.isInsertOp(r)){r=r.insert;if(r&&N.containsWhitespace(r))return s.onTextChanged(),void a.cancel()}}a()}}var e,s=this,a=_.debounce(function(){return s.onTextChanged()},null!=(e=this.options.textChangeThrottle)?e:z.textChangeThrottle);this.editor.on("text-change",t),this.destroyEditorActions.push(function(){s.editor.off("text-change",t),a.cancel(),a=void 0}),this.onPaste&&this.$container.on("paste",function(){return setTimeout(function(){return s.onPaste()},0)})},z.setUpFontFormat=function(t){var i=t.import("parchment"),o=t.import(z.getFormatPath("font"));o.value=function(t){var e=z.camelize(o.keyName);return _.escape(T.Font.normalizeFamily(t.style[e]))},o.canAdd=function(t,e){return null!=i.query(t,i.Scope.BLOT&(o.scope|i.Scope.TYPE))&&(null==o.whitelist||-1<o.whitelist.indexOf(T.Font.normalizeFamily(_.unescape(e))))},o.add=function(t,e){var i;return!!o.canAdd(t,e)&&(i=z.camelize(o.keyName),e=T.Font.normalizeFamily(_.unescape(e)),t.style[i]=e,!0)}},z.prototype.isFormatRegisteredWithQuill=function(t){this.quillStatic;var e=this.quillStatic.imports;return!_.isEmpty(e)&&!!e[z.getFormatPath(t)]},z.prototype.setUpSmartNarrativesFormat=function(){var t,s;function e(){return null!==s&&s.apply(this,arguments)||this}this.isFormatRegisteredWithQuill(z.smartNarrativesBlotClass.class)||(t=this.quillStatic.import("blots/embed"),__extends(e,s=t),e.create=function(t){var e,i,o,n=s.create.call(this,t.objRef),r=T.ColorHelper.getDataColorByIndex(t.style,0);return t.objRef===p.QuillPlaceholder?(e=this.placeholderText,i=z.computeTransparentSmartNarrativesColor(r),$(n).addClass(z.smartNarrativesPlaceholderClass.class).css("background-color",i)):(e=T.TextEvaluation.getTextRunValueFormatted(t.objRef,t.evaluatedValues)||"",o="".concat(v.pointerDownEventName).concat(z.smartNarrativesBlotClass.selector),t.destroyEditorActions&&($(n).on(o,function(){t.onSelectSmartNarrativesBlot(t.objRef)}),t.destroyEditorActions.push(function(){$(n).off(o)}))),$(n).attr(z.smartNarrativesBlotClass.class,t.objRef).attr(v.contentEditableAttribute,"false").css("border-bottom","1px solid ".concat(r)).data(z.smartNarrativesBlotClass.class,t),e?$(n).text(e):z.appendHiddenSmartNarrativesDisplay(n,t.localizationProvider.get("Visual_SmartNarratives_TextBox_Hidden")),n},e.value=function(t){return $(t).data(z.smartNarrativesBlotClass.class)},e.blotName=z.smartNarrativesBlotClass.class,e.className=z.smartNarrativesBlotClass.class,e.placeholderText="                ",e.tagName="span",this.quillStatic.register(e))},z.prototype.setUpSmartNarrativesConditionalFormat=function(){var t,o;function e(){return null!==o&&o.apply(this,arguments)||this}this.isFormatRegisteredWithQuill(z.smartNarrativesConditionalBlotClass.class)||(t=this.quillStatic.import("blots/embed"),__extends(e,o=t),e.create=function(n){if(T.TextEvaluation.isTextRunConditional(n.definition)){for(var r=o.create.call(this,n.objRef),s="".concat(v.pointerDownEventName).concat(z.smartNarrativesConditionalBlotClass.selector),a=($(r).attr(z.smartNarrativesConditionalBlotClass.class,n.objRef).attr(v.contentEditableAttribute,"false").data(z.smartNarrativesConditionalBlotClass.class,n),!1),t=T.TextEvaluation.evaluateTextRunConditional(n.definition,n.evaluatedValues),l=T.ColorHelper.getDataColorByIndex(n.style,0),e=0,i=t;e<i.length;e++)!function(t){var e=$("<span>");if(E(t.value)){var i=t.value.selector.id,o=T.TextEvaluation.getTextRunValueFormatted(i,n.evaluatedValues);if(!o)return;e.addClass(z.smartNarrativesBlotClass.class).css("border-bottom","1px solid ".concat(l)).text(o),n.destroyEditorActions&&(e.on(s,function(){n.onSelectSmartNarrativesBlot(i)}),n.destroyEditorActions.push(function(){e.off(s)}))}else t.value===T.TextRunNewlineHidden?(e.text(T.TextRunNewline),a=!0):e.text(t.value);$(r).append(e)}(i[e]);return 0===r.childElementCount?z.appendHiddenSmartNarrativesDisplay(r,n.localizationProvider.get("Visual_SmartNarratives_TextBox_Hidden")):r.innerText===T.TextRunNewline&&($(r).addClass(z.smartNarrativesNewlineClass.class).attr(v.contentEditableAttribute,"true").empty().text(T.TextRunNewline),a)&&$(r).addClass(z.smartNarrativesHiddenClass.class),n.destroyEditorActions&&($(r).on(s,function(){n.onSelectSmartNarrativesConditionalBlot(n.conditionalIndex)}),n.destroyEditorActions.push(function(){$(r).off(s)})),r}},e.value=function(t){return $(t).data(z.smartNarrativesConditionalBlotClass.class)},e.blotName=z.smartNarrativesConditionalBlotClass.class,e.className=z.smartNarrativesConditionalBlotClass.class,e.tagName="span",this.quillStatic.register(e))},z.prototype.setUpSmartNarrativesFocusFormat=function(){var t,e,i=z.getFormatPath(z.smartNarrativesFocusFormatAttributeName);this.isFormatRegisteredWithQuill(i)||((e=this.quillStatic.import(z.getFormatPath("background"))).attrName=z.smartNarrativesFocusFormatAttributeName,this.quillStatic.register(((t={})[i]=e,t)))},z.prototype.setupAtMentionFormat=function(){var t,o;function n(){return null!==o&&o.apply(this,arguments)||this}this.isFormatRegisteredWithQuill(z.atMentionBlotClass.class)||(t=this.quillStatic.import("blots/embed"),__extends(n,o=t),n.create=function(i){var t,e=o.create.call(this,i.email);return $(e).attr(z.atMentionBlotClass.class,i.email).attr(v.contentEditableAttribute,"false").data(z.atMentionBlotClass.class,i).on(v.pointerOverEventName,function(){i.personCardComponent.showUser(i.email);var t=e.getBoundingClientRect();i.hoverContainer.stop(!0,!0).css({left:e.offsetLeft,top:e.offsetTop-t.height-n.topPaddingOffset}).delay(200).queue(function(t){$(e).is(":hover")&&i.hoverContainer.fadeIn("fast"),t()})}).on(v.pointerOutEventName,function(){i.hoverContainer.delay(500).queue(function(t){function e(t){i.hoverContainer.is(":hover")?setTimeout(function(){return e(t)},500):t()}e(t)}).fadeOut("fast")}).css("color","#1453b3").text(null!==(t="@"+i.displayName)?t:i.email),e},n.value=function(t){return $(t).data(z.atMentionBlotClass.class)},n.blotName=z.atMentionBlotClass.class,n.className=z.atMentionBlotClass.class,n.tagName="span",n.topPaddingOffset=24,this.quillStatic.register(n))},z.prototype.registerMentionModule=function(){function u(t,i){for(var o=this,e=(this.options=i,this.quill=t,_.isEmpty(i.mentions),t.on("text-change",function(t,e,i){return o.onTextChange(t,e,i)}),0),n=i.mentions;e<n.length;e++)!function(e){e.mentionCharacter.length,e.initialize(i.componentFactory,function(t){return o.insertBlot(e.blotName,t)})}(n[e]);this.addKeyBindings()}this.quillStatic.imports["modules/mention"]||(u.prototype.addKeyBindings=function(){function t(t){for(var e=!0,i=0,o=n.options.mentions;i<o.length;i++)e=o[i].navigateSuggestions(t);return e}var n=this;this.quill.keyboard.addBinding({key:40},void 0,function(){return t(0)}),this.quill.keyboard.addBinding({key:38},void 0,function(){return t(1)});this.quill.keyboard.addBinding({key:27},void 0,function(){for(var t=!0,e=0,i=n.options.mentions;e<i.length;e++)t=i[e].hideSuggestions();return t})},u.prototype.onTextChange=function(t,e,i){if("user"===i){this.insertPosition=void 0,this.currentPosition=void 0;i=this.quill.getSelection();if(i){this.currentPosition=i.index;var i=Math.max(0,this.currentPosition-this.options.maxSearchLength),i=this.quill.getText(i,this.currentPosition-i),o=this.getMentionConfig(i),n=o.mentionConfig,o=o.mentionCharacterPosition;if(n){for(var i=i.substring(o+1),r=0,s=this.options.mentions;r<s.length;r++){var a=s[r];a!==n&&a.hideSuggestions()}this.insertPosition=this.currentPosition-i.length-1;var o=this.quill.getBounds(this.insertPosition),l=this.quill.root.getBoundingClientRect(),l=Math.min(o.left,l.width-u.SuggestionWidth),o=o.height+o.bottom;n.renderSuggestions(i,l,o)}else this.hideAllSuggestions()}}},u.prototype.getMentionConfig=function(t){for(var e=0,i=this.options.mentions;e<i.length;e++){var o=i[e],n=t.lastIndexOf(o.mentionCharacter);if(-1!==n)return{mentionConfig:o,mentionCharacterPosition:n}}return{mentionConfig:void 0,mentionCharacterPosition:-1}},u.prototype.insertBlot=function(t,e){this.hideAllSuggestions(),_.isNil(this.insertPosition)||_.isNil(this.currentPosition)||(this.quill.deleteText(this.insertPosition,this.currentPosition-this.insertPosition,"api"),this.quill.insertEmbed(this.insertPosition,t,e,"api"),this.quill.setSelection(this.insertPosition+1,0,"api"),this.options.save())},u.prototype.hideAllSuggestions=function(){for(var t=0,e=this.options.mentions;t<e.length;t++)e[t].hideSuggestions()},u.SuggestionWidth=200,this.quillStatic.register("modules/mention",u))},z.willBrowserHandleFocus=function(t){return"SELECT"===t.tagName||"INPUT"===t.tagName||!!t.getAttribute("contentEditable")},z.prototype.targetIsInToolbar=function(t,e){return!!this.toolbar&&!("A"!==t.tagName&&"BUTTON"!==t.tagName&&!e)&&(e=$(t),(t=this.toolbar.getElement()).is(":visible"))&&(e.is(t)||0<e.closest(t).length)},z.prototype.onTextChanged=function(){var t;this.textChanged(),this.supportsFormattingChangeIndication&&null!=(t=this.formattingSettingsContainer.getTextboxFormattingSettings())&&t.onTextChanged()},z.prototype.saveState=function(){var t;null!=(t=null==(t=this.editor)?void 0:t.history)&&t.clear(),this.onTextChanged()},z.isInsertOp=function(t){return null!=t.insert},z.camelize=function(t){var t=t.split("-"),e=_.map(t.slice(1),function(t){return t[0].toUpperCase()+t.slice(1)}).join("");return t[0]+e},z.prototype.focusToolbar=function(){if(!this.editor||!this.toolbar)return!1;i.focusChildInGroup(this.toolbar.getElement().get(0))},z.appendHiddenSmartNarrativesDisplay=function(t,e){var i=$("<span>"),o=$("<span>"),n=$("<span>");i.text("["),o.addClass("glyphicon glyph-mini pbi-glyph-hide3"),n.text("]"),$(t).addClass(z.smartNarrativesHiddenClass.class).append(i,o,n).attr("title",e)},z.prototype.updateToolbar=function(){var t;this.toolbar&&(t=null==(t=this.options)?void 0:t.supportsNarrativeExpressions,this.host.setToolbar(this.toolbar.getElement(),{preferHorizontalLayout:t,theme:t?"neutralGrayTheme":"darkTheme"}))},z.quillFormatsPath="formats",z.atMentionBlotClass=t("at-mention"),z.atMentionContainerClass=t("mentions-container"),z.smartNarrativesBlotClass=t("smart-narratives-blot"),z.smartNarrativesConditionalBlotClass=t("smart-narratives-conditional-blot"),z.smartNarrativesFocusFormatAttributeName="smartNarrativesFocus",z.smartNarrativesHiddenClass=t("smart-narratives-hidden"),z.smartNarrativesNewlineClass=t("smart-narratives-newline"),z.smartNarrativesPlaceholderClass=t("placeholder"),z.smartNarrativesPlaceholderOpacity=.2,z.textChangeThrottle=600,h=z,p.QuillWrapper=h,R.createToolbar=function(i,o,n,r,s){return __awaiter(this,void 0,a.Promise,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,(e=new R(i,o,n,r)).init(n,s)];case 1:return t.sent(),[2,a.Promise.resolve(e)]}})})},R.prototype.init=function(m,g){return __awaiter(this,void 0,a.Promise,function(){var e,i,o,n,r,s,a,l,u,c,p,h,d,f;return __generator(this,function(t){switch(t.label){case 0:return(this.featureSwitches=g.featureSwitches,this.updateOptions(g),i=g.hierarchicalTabbing?"Hierarchy":"Group",e=R.ColorPicker.buildFontColorButtons(m.get("Visual_FontColor"),m.get("Visual_FontColor_Picker"),g.onRenderTooltip),i=this.container=b.div().addClass("toolbar").addClass("themeableElement").attr("aria-label",b.getTooltip("FontControl",m)).attr("focus-nav-mode",i),o=b.formatGroup(),1<_.size(this.fontFamilies)&&o.append(this.fontFamilyPicker),1<_.size(this.fontSizes)&&o.append(this.fontSizePicker),n=b.formatButton(g.onRenderTooltip,b.getTooltip("Bold",m),"bold",void 0,void 0,void 0),r=b.formatButton(g.onRenderTooltip,b.getTooltip("Italic",m),"italic",null,"italic",!0),s=b.formatButton(g.onRenderTooltip,b.getTooltip("Underline",m),"underline",void 0,void 0,void 0),a=b.formatButton(g.onRenderTooltip,b.getTooltip("BulletedList",m),"list","bullet","bulletedlist",!0),l=b.formatButton(g.onRenderTooltip,b.getTooltip("NumberedList",m),"list","ordered","numberedlist",!0),h=b.getTooltip("Link",m),u=b.formatButton(g.onRenderTooltip,h,"link",void 0,void 0,void 0),c=b.div().addClass("toolbar-content"),this.featureSwitches&&this.featureSwitches.onObject)?(i.addClass("on-object"),c.addClass("on-object"),d=b.div().append(o),p=b.div().append(b.formatGroup().append(n).append(r).append(s)).append(b.formatGroup().append(this.textAlignmentGroup)).append(e),this.featureSwitches.textboxSuperSubScriptBulletedList&&(d.append(b.formatGroup().append(a)).append(b.formatGroup().append(l)),p.append(b.formatGroup().append(this.textScriptGroup))),d.append(b.formatGroup().append(this.textIndentGroup)),d=b.div().append(d).append(p),c.append(d).append(b.getVerticalDivider()),p=this.host.getUIComponentFactory(),(d=p)?[4,this.getAddLinkContainer(h,p)]:[3,2]):[3,3];case 1:d=t.sent(),t.label=2;case 2:return(h=d)&&c.append(h).append(b.getVerticalDivider()),[3,4];case 3:o.append(e),c.append(o).append(b.formatGroup().append(n).append(r).append(s)).append(b.formatGroup().append(this.textAlignmentGroup)).append(b.formatGroup().append(this.textIndentGroup)).append(b.formatGroup().append(u).append(this.linkInput)),this.featureSwitches&&this.featureSwitches.textboxSuperSubScriptBulletedList&&(c.append(b.formatGroup().append(this.textScriptGroup)).append(b.formatGroup().append(a)).append(b.formatGroup().append(l)),c.css("width",this.getWidth()+"px")),t.label=4;case 4:return i.append(c),g.supportsNarrativeExpressions&&(c.addClass("fixed-size"),i.append(b.smartNarrativesEditor())),g.supportsFormattingChangeIndication&&!this.quillWrapper.readOnly&&i.append(b.formattingSettingsGroup()),(f=this.onEscape)&&i.on("keydown",function(t){27===t.keyCode&&(t.stopPropagation(),t.preventDefault(),f())}),[2]}})})},R.prototype.getAddLinkContainer=function(i,o){return __awaiter(this,void 0,a.Promise,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=b.formatGroup(),[4,new R.MiniToolbarLargeButton({inputArgs:{disabled:!1,iconName:"WebGetLink_16",iconColor:"",label:i,title:i},outputArgs:{clicked:function(){},ready:function(){}},uiComponentFactory:o}).attach(e)];case 1:return t.sent(),e.find("button").addClass("ql-link"),e.append(this.linkInput),[2,a.Promise.resolve(e)]}})})},R.prototype.getElement=function(){return this.container},R.prototype.updateOptions=function(t){var e=t.defaultFont;this.onEscape=t.onEscape,this.updateFontFamilyUI(e,t.fontFamilies,t.onRenderTooltip),this.updateFontSizeUI(e,t.fontSizes,t.onRenderTooltip),this.updateTextAlignmentUI(t.onRenderTooltip),this.updateTextIndent(t.onRenderTooltip),this.featureSwitches&&this.featureSwitches.textboxSuperSubScriptBulletedList&&this.updateTextScriptUI(t.onRenderTooltip)},R.prototype.updateFontSizeUI=function(t,e,i){var o=h.getFormatPath("size");this.updateStyleAllowList(this.quillWrapper.quillStatic,"size",null,o,!0),this.fontSizes=_.map(e,function(t){return{label:"".concat(t),value:"".concat(t,"pt")}}),this.defaultFontSize="".concat(t.size.pt,"pt"),this.fontSizePicker?b.updatePicker(this.fontSizePicker,this.fontSizes,this.defaultFontSize):this.fontSizePicker=b.picker(b.getTooltip("Size",this.localizationProvider),this.fontSizes,"size",this.defaultFontSize,i)},R.prototype.updateFontFamilyUI=function(t,e,i){var o=e.map(function(t){return T.Font.normalizeFamily(F.getCSSFromFont(t))}),n=h.getFormatPath("font");this.updateStyleAllowList(this.quillWrapper.quillStatic,"font",o,n,!0),this.fontFamilies=_.map(e,function(t){return{label:t,value:_.escape(T.Font.normalizeFamily(F.getCSSFromFont(t)))}}),this.defaultFontFamily=_.escape(T.Font.normalizeFamily(F.getCSSFromFont(t.family))),this.fontFamilyPicker?b.updatePicker(this.fontFamilyPicker,this.fontFamilies,this.defaultFontFamily):this.fontFamilyPicker=b.picker(b.getTooltip("Font",this.localizationProvider),this.fontFamilies,"font",this.defaultFontFamily,i,function(t,e){return t.css("font-family",e.value),t})},R.prototype.updateTextAlignmentUI=function(t){var i=this.defaultTextAlignment=F.DefaultAlignment,e=(this.textAlignments=_.map(F.TextAlignments,function(t){var e=t.toLowerCase();return{label:t,value:t===i?"":e,glyph:"align".concat(e)}}),_.map(this.textAlignments,function(t){return t.value})),o=h.getFormatPath("align");this.updateAllowList(this.quillWrapper.quillStatic,o,e),this.textAlignmentGroup||(this.textAlignmentGroup=b.toggleGroup("Text Alignment",this.textAlignments,"align",this.defaultTextAlignment,this.localizationProvider,!1,t))},R.prototype.updateTextIndent=function(t){this.textIndent=_.map(F.TextIndent,function(t){return{label:"".concat("+1"===t?"Increase":"Decrease","Indent"),value:t,glyph:"+1"===t?"increaseindent":"decreaseindent"}}),this.textIndentGroup||(this.textIndentGroup=b.toggleGroup("Indent",this.textIndent,"indent","",this.localizationProvider,!0,t))},R.prototype.updateTextScriptUI=function(t){this.textScripts=_.map(F.TextScriptTypes,function(t){var e=t.toLowerCase();return{label:t,value:e,glyph:e+"script"}});var e=_.map(this.textScripts,function(t){return t.value}),i=h.getFormatPath("script");this.updateAllowList(this.quillWrapper.quillStatic,i,e),this.textScriptGroup||(this.textScriptGroup=b.toggleGroup("Script",this.textScripts,"script","",this.localizationProvider,!0,t))},R.prototype.updateStyleAllowList=function(t,e,i,o,n){this.updateAllowList(t,"attributors/style/"+e,i,o,n=void 0===n?!1:n)},R.prototype.updateAllowList=function(t,e,i,o,n){void 0===n&&(n=!1);var r=t.import(e);r.whitelist=i,t.register(o||e,r,n)},R.prototype.getWidth=function(){return 750},A=R,p.Toolbar=A,(d=b=p.ToolbarBuilder||(p.ToolbarBuilder={})).buildToolbarLinkInputTemplate=function(t){var e=k(),i=t.get("RichTextbox_Link_Done"),o=t.get("RichTextbox_Link_Remove"),n=t.get("RichTextbox_Link_Edit"),t=Z("Link",t);return e.append((o=o,i=i,n=n,$('\n                        <a href="#" class="ql-preview" target="_blank"></a>\n                        <input class="input" type="text" aria-label="'.concat(t,'">\n                        <span class="bar">&nbsp;|&nbsp;</span>\n                        <button class="ql-action ql-save">').concat(i,'</button>\n                        <button class="ql-action ql-edit">').concat(n,'</button>\n                        <button class="ql-remove">').concat(o,"</button>\n                    ")))),e.html()},d.formatGroup=function(){return G().addClass("ql-formats")},d.smartNarrativesEditor=function(){return k().addClass(d.smartNarrativesEditorClass.class)},d.formattingSettingsGroup=function(){return k().addClass(d.formattingSettingsClass.class)},d.div=k,d.span=G,d.button=Q,d.toggleGroup=function(t,e,i,o,n,r,s){return e.map(function(t){var e=null!=t.glyph?t.glyph:i+t.value;return X(s,Z(t.label,n),i,t.value,e,r)})},d.picker=function(t,e,i,o,n,r){return K(t,e,n,o,r).addClass("ql-"+i+" ql-picker")},d.updatePicker=Y,d.selector=K,d.updateSelector=Y,d.options=J,d.applyTooltip=function(e,i,o){var n;e.on("focus mouseenter",function(t){n=o(e.get(0),i)}),e.on("blur mouseleave",function(t){n&&n.close(),n=null}),e.on("keydown",function(t){n&&27===t.keyCode&&(event.stopPropagation(),event.preventDefault(),n.close(),n=null)})},d.formatButton=X,d.getTooltip=Z,d.getVerticalDivider=function(){return k().addClass("vertical-divider")},d.smartNarrativesEditorClass=t("smart-narratives-editor"),d.formattingSettingsClass=t("formatting-settings"),c=A=p.Toolbar||(p.Toolbar={}),B.buildNode=function(t){return b.div().addClass(W.toolbarUrlInput.class).append($(t))},B.prototype.onHide=function(t){this.hide(),this.stopEvent(t),this.updateToolbarWidth()},B.prototype.onSave=function(t){this.save(),this.stopEvent(t),this.updateToolbarWidth()},B.prototype.onEdit=function(t){this.edit(),this.stopEvent(t),this.updateToolbarWidth()},B.prototype.onRemove=function(t){this.remove(),this.stopEvent(t),this.updateToolbarWidth()},B.prototype.stopEvent=function(t){t.stopPropagation(),t.preventDefault()},B.prototype.edit=function(){this.isEditing=!0,this.$container.addClass(B.editingClass),this.$textbox.focus(),this.textbox.setSelectionRange(0,this.textbox.value.length)},B.prototype.open=function(){this.range=this.quill.getSelection(),this.show(),this.edit(),this.updateToolbarWidth()},B.prototype.hide=function(){this.range=this.link=null,this.$container.hide(),this.isEditing=!1},B.prototype.remove=function(){this.range=this.range||this.quill.getSelection(),this.quill.formatText(this.range,"link",!1,"user"),this.quill.setSelection(this.range,"silent"),this.hide(),this.updateToolbarWidth()},B.prototype.save=function(){var t=this.range,e=this.textbox.value;0===t.length&&(this.quill.insertText(this.range.index,e),this.quill.setSelection(this.range.index,e.length),t=this.range=this.quill.getSelection()),this.quill.formatText(t.index,t.length,"link",e,"user"),this.quill.setSelection(t,"silent"),this.link=this.quill.scroll.descendant(this.quillStatic.import(h.getFormatPath("link")),t.index)[0],this.show()},B.prototype.show=function(){this.isEditing=!1,this.$container.removeClass(B.editingClass),this.$container.show();var t=this.range=this.range||this.quill.getSelection(),e=null!=this.link?this.link.formats().link:(e=this.quill.getText(t.index,t.length),V.LinkPreview.format(e));this.$textbox.val(e),this.$preview.text(e),this.$preview.attr("href",e)},B.prototype.updateToolbarWidth=function(){this.featureSwitches&&!this.featureSwitches.onObject&&this.toolbar.getElement().find(".toolbar-content").css("width",this.toolbar.getWidth()+this.getWidth()+"px")},B.prototype.getWidth=function(){return this.$container.get(0).offsetWidth},B.editingClass="ql-editing",c.LinkInput=B,q.buildFontColorButtons=function(t,e,i){var o=$("<span></span>").addClass("powervisuals-glyph themeableElementCustom").addClass(q.colorGlyphClassAndSelector.class),n=$("<span></span>").addClass("powervisuals-glyph themeableElementCustom").addClass(q.colorSwatchGlyphClassAndSelector.class),o=$("<button>").addClass("ql-color themeableElementCustom").addClass(q.colorButtonClassAndSelector.class).attr("aria-label",t).val("false").append(o).append(n),n=$("<button>").addClass("colorpicker powervisuals-glyph chevrondown themeableElementCustom").addClass(q.pickerButtonClassAndSelector.class).attr("aria-label",e).val("false");return b.applyTooltip(o,t,i),b.applyTooltip(n,e,i),[o,$("<div>").addClass(q.pickerButtonWrapperClassAndSelector.class).append(n)]},q.prototype.onColorChange=function(t){this.currentColor.toUpperCase()!==t.toUpperCase()&&(this.setSwatch(t||this.defaultColor),this.applyFormat(t||null,this.range),this.currentColor=t)},q.prototype.onClose=function(){var t=this.ensureRange();this.quill.setSelection(t.index,t.length),this.color?this.quill.format(this.format,this.color,"user"):this.quill.format(this.format,!1,"user")},q.prototype.getColor=function(){return this.currentColor},q.prototype.applyFormat=function(t,e){e=this.ensureRange(e);(this.color=t)&&t!==this.defaultColor?(this.quill.formatText(e.index,e.length,this.format,t,"user"),this.quill.format(this.format,this.color,"user")):(this.quill.formatText(e.index,e.length,this.format,!1,"user"),this.quill.format(this.format,!1,"user"))},q.prototype.toggle=function(){this.range=this.ensureRange(),this.getColorPicker().toggle()},q.prototype.getColorPicker=function(){var e=this,t=this.$colorPickerButtonWrapper.get(0);return this.colorPicker=this.uiComponentFactory.createColorPicker(t.firstChild,{value:this.getRangeColor()},function(t){return e.onColorChange(t&&t.value)},function(){return e.onClose()}),this.colorPicker},q.prototype.getRangeColor=function(){var t=this.quill.getSelection();return t&&"string"==typeof(null==(t=this.quill.getFormat(t.index,t.length))?void 0:t.color)?t.color:this.defaultColor},q.prototype.setSwatch=function(t){this.$colorSwatch.get(0).style.setProperty("color",t,"important")},q.prototype.ensureRange=function(t){return this.quill.focus(),t||this.quill.getSelection()||{index:0,length:0}},q.colorGlyphClassAndSelector=t("fontcolor"),q.colorSwatchGlyphClassAndSelector=t("fontcolorswatch"),q.colorButtonClassAndSelector=t("fontcolorbutton"),q.pickerButtonClassAndSelector=t("fontcolorpicker"),q.pickerButtonWrapperClassAndSelector=t("fontcolorbutton-wrapper"),c.ColorPicker=q,M.prototype.getSmartNarrativesEditor=function(){var i=this;return this.component=this.component||this.hostServices.getUIComponentFactory().createSmartNarrativesEditor(this.container.find(b.smartNarrativesEditorClass.selector).get(0),T.textboxProps.values.expr,{onEditSmartNarrativeCancel:function(){return i.onEditSmartNarrativeCancel()},onEditSmartNarrativeFinish:function(t,e){return i.onEditSmartNarrativeFinish(t,e)},onEditSmartNarrativeStart:function(){return i.onEditSmartNarrativeStart()},onSmartNarrativeFocusChange:function(t,e){return i.onSmartNarrativeFocusChange(t,e)},onUpdateToolbar:function(t){return i.onUpdateToolbar(t)},onEscape:function(){return i.focusOnToolbar()}}),this.component},M.prototype.onGetSmartNarrativesBlot=function(e){var i={index:-1,op:void 0},t=this.quill.getContents();return t&&(i.op=_.find(t.ops,function(t){return!!t&&(_.isString(t.insert)?(i.index+=t.insert.length,!1):_.isNumber(t.insert)?(i.index+=1,!1):(t=p.getCustomQuillFormatValue(t,p.QuillWrapper.smartNarrativesBlotClass.class),i.index+=1,(null==t?void 0:t.objRef)===e))})),i},M.prototype.onEditSmartNarrativeCancel=function(){var t=-1,e=this.onGetSmartNarrativesBlot(p.QuillPlaceholder);return e&&0<=e.index&&e.op&&(this.quill.removeFormat(e.index,1),t=e.index,this.quill.setSelection(t,0,"api")),t},M.prototype.onEditSmartNarrativeFinish=function(i,t){var o=this,e=this.onEditSmartNarrativeCancel();t?this.applyObjRefUpdate(t,function(t){var e=o.quill.getFormat(t);o.quill.removeFormat(t,1),o.insertSmartNarrativesBlot(i,t),o.quill.formatText(t,1,e,"api")}):(e<0&&(e=this.getInsertionIndex()),this.insertSmartNarrativesBlot(i,e)),this.onEditSmartNarrativePersist()},M.prototype.onEditSmartNarrativeStart=function(){this.onEditSmartNarrativeCancel();var t=this.getInsertionIndex();this.insertSmartNarrativesBlot(p.QuillPlaceholder,t)},M.prototype.onSmartNarrativeFocusChange=function(t,i){var o=this;this.applyObjRefUpdate(t,function(t){var e=o.quill.getFormat(t,1);e.smartNarrativesFocus=i?o.focusColor:void 0,o.quill.formatText(t,1,e,"api")})},M.prototype.updateOptions=function(t){this.evaluatedValues=t.evaluatedValues},M.prototype.applyObjRefUpdate=function(t,e){var i=this.quill.getContents();if(i)for(var o=-1,n=0,r=i.ops;n<r.length;n++){var s=r[n];if(!s)return;_.isString(s.insert)?o+=s.insert.length:_.isNumber(s.insert)?o+=1:(o+=1,(null==(s=p.getCustomQuillFormatValue(s,p.QuillWrapper.smartNarrativesBlotClass.class))?void 0:s.objRef)===t&&e(o))}},M.prototype.getInsertionIndex=function(){var t=this.quill.getSelection(!0);return t?t.index:0},M.prototype.insertSmartNarrativesBlot=function(t,e){var i=this,t={destroyEditorActions:this.destroyEditorActions,evaluatedValues:this.evaluatedValues,localizationProvider:this.localizationProvider,objRef:t,onSelectSmartNarrativesBlot:function(t){i.getSmartNarrativesEditor().onSelectEditableObject(t)},style:this.style};this.quill.insertEmbed(e,h.smartNarrativesBlotClass.class,t,"api"),this.quill.setSelection(e+1,0,"api")},M.prototype.onUpdateToolbar=function(t){this.hostServices.setToolbar(this.toolbar.getElement(),{preferHorizontalLayout:!0,theme:"neutralGrayTheme",dropdownOptions:t})},M.prototype.focusOnToolbar=function(){this.toolbar&&i.focusChildInGroup(this.toolbar.getElement().get(0))},c.SmartNarrativesEditor=M,tt.prototype.getTextboxFormattingSettings=function(){var t;return this.component=this.component||(null==(t=this.hostServices.getUIComponentFactory())?void 0:t.createTextboxFormattingSettings(this.container.find(b.formattingSettingsClass.selector).get(0))),this.component},c.FormattingSettings=tt,et.prototype.attach=function(e){return __awaiter(this,void 0,a.Promise,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.uiComponentFactory.createMiniToolbarLargeButton(e.get(0),this.inputArgs,this.outputArgs)];case 1:return t.sent(),[2]}})})},c.MiniToolbarLargeButton=et}(powerbi=powerbi||{}),define("TextboxVisual/textboxModule",["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createAlwaysUseSmallViewportTextboxViewModelAdapter=e.createTextboxViewModelAdapter=e.createTextbox=void 0,e.createTextbox=function(t){return new powerbi.visuals.Textbox(t)},e.createTextboxViewModelAdapter=function(t){return new powerbi.visuals.TextboxHelpers.ViewModelAdapter(t)},e.createAlwaysUseSmallViewportTextboxViewModelAdapter=function(){return new powerbi.visuals.TextboxHelpers.AlwaysUseSmallViewport}}),function(t){((t=t.powerbi||(t.powerbi={})).visuals||(t.visuals={})).importTextboxModule=function(){}}(es6=es6||{}),function(t){var e;(e=t.visuals||(t.visuals={})).initializeTextboxVisualFactoryES6=function(){e.setCreateTextbox(function(e){return es6.powerbi.visuals.importTextboxModule().then(function(t){return t.createTextbox(e)})}),e.setCreateTextboxViewModelAdapter(function(e){return es6.powerbi.visuals.importTextboxModule().then(function(t){return t.createTextboxViewModelAdapter(e)})}),e.setCreateAlwaysUseSmallViewportTextboxViewModelAdapter(function(){return es6.powerbi.visuals.importTextboxModule().then(function(t){return t.createAlwaysUseSmallViewportTextboxViewModelAdapter()})})}}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['textboxVisual.min.js'] || (this.parseTimeMarkers['textboxVisual.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
