"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['cartesianVisuals.min.js'] || (this.parseTimeMarkers['cartesianVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('cartesianVisuals.min.js');var es6,powerbi,__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,s,n,l){return new(n=n||Promise)(function(i,t){function a(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(a,r)}o((l=l.apply(e,s||[])).next())})},__generator=this&&this.__generator||function(a,r){var o,s,n,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(i){return function(e){var t=[i,e];if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,s&&(n=2&t[0]?s.return:t[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,t[1])).done)return n;switch(s=0,(t=n?[2&t[0],n.value]:t)[0]){case 0:case 1:n=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,s=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(n=0<(n=l.trys).length&&n[n.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!n||t[1]>n[0]&&t[1]<n[3]))l.label=t[1];else if(6===t[0]&&l.label<n[1])l.label=n[1],n=t;else{if(!(n&&l.label<n[2])){n[2]&&l.ops.pop(),l.trys.pop();continue}l.label=n[2],l.ops.push(t)}}t=r.call(a,l)}catch(e){t=[6,e],s=0}finally{o=n=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__spreadArray=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||((a=a||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},__extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();!function(e){var d;((d=e.visuals||(e.visuals={})).CartesianViewModelAdapterUtils||(d.CartesianViewModelAdapterUtils={})).updatePlotResponsiveWarnings=function(e,t){var i,a,r,o,s,n=e.warningObjectCollection,l={},c=e.legendData,u=t.legendData;for(s in e.showIcon?(l.legend=new d.LegendNotRenderedWarning,l.categoryAxis=new d.AxisAndAxisLabelsNotRenderedWarning,l.valueAxis=new d.AxisAndAxisLabelsNotRenderedWarning):(c.show!==u.show?l.legend=new d.LegendNotRenderedWarning:c.position!==u.position?l.legend=new d.LegendLocationWarning:_.isEqual(c.fontProperties.size,u.fontProperties.size)||(l.legend=new d.LegendFontSizeWarning(d.CartesianWarningPropertyNames.legendFontSize)),c=e.axesData,u=t.axesData,i=c.categoryAxis,a=u.categoryAxis,o=!_.isEqual(i.labelFontProperties.size,a.labelFontProperties.size),r=!_.isEqual(i.titleFontProperties.size,a.titleFontProperties.size),i.show!==a.show?l.categoryAxis=new d.AxisAndAxisLabelsNotRenderedWarning:i.showAxisTitle!==a.showAxisTitle?l.categoryAxis=new d.AxisLabelsNotRenderedWarning:(o||r)&&(l.categoryAxis=new d.AxisFontSizeWarning(o?d.CartesianWarningPropertyNames.axisFontSize:d.CartesianWarningPropertyNames.axisTitleFontSize)),i=c.valueAxis,a=u.valueAxis,r=!_.isEqual(i.labelFontProperties.size,a.labelFontProperties.size),o=!_.isEqual(i.titleFontProperties.size,a.titleFontProperties.size),i.show!==a.show?l.valueAxis=new d.AxisAndAxisLabelsNotRenderedWarning:i.showAxisTitle!==a.showAxisTitle?l.valueAxis=new d.AxisLabelsNotRenderedWarning:(r||o)&&(l.valueAxis=new d.AxisFontSizeWarning(r?d.CartesianWarningPropertyNames.axisFontSize:d.CartesianWarningPropertyNames.axisTitleFontSize)),c=e.zoomData,u=t.zoomData,c.showOnCategoryAxis===u.showOnCategoryAxis&&c.showOnValueAxis===u.showOnValueAxis&&c.showOnValueSecAxis===u.showOnValueSecAxis||(l.zoom=new d.ZoomSlidersNotRenderedWarning)),l)n.addForVisualObject(s,{selector:null,warnings:[l[s]]})}}(powerbi=powerbi||{}),function(e){var o,s;o=e.visuals||(e.visuals={}),s=o.Units.FontSize,o.cartesianLegacyResponsiveViewportsBreakpoints={legendWidth:76,legendHeight:58,axesTitleWidth:128,axesTitleHeight:58,axesHeight:58,axesMedWidth:128,axesWidth:76,maxWidthForMediumFont:180,maxWidthForSmallFont:128},(o.CartesianLegacyResponsiveApplier||(o.CartesianLegacyResponsiveApplier={})).applyLegacyResponsiveChanges=function(e,t){var i=e,a=(r=t).axesData,i=(i.height<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleHeight&&(a.x.showAxisTitle=!1,a.y.showAxisTitle=!1,a.y2.showAxisTitle=!1),i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesTitleWidth&&(a.y.showAxisTitle=!1,a.y2.showAxisTitle=!1),i.height<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesHeight&&(a.x.show=!1),i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesWidth&&(a.y.show=!1,a.y2.show=!1),i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.axesMedWidth&&o.Legend.isLeftOrRight(r.legendData.position)&&(a.y.show=!1,a.y2.show=!1),i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont&&(r={x:{tickLabels:o.CartesianChart.xAxisSmallFontSizeInPx,title:o.CartesianChart.xAxisSmallFontSizeInPx},y:{tickLabels:o.CartesianChart.yAxisMediumFontSizeInPx,title:o.CartesianChart.yAxisMediumFontSizeInPx},y2:{tickLabels:o.CartesianChart.yAxisMediumFontSizeInPx,title:o.CartesianChart.yAxisMediumFontSizeInPx}},i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont&&(r.y.tickLabels=o.CartesianChart.yAxisSmallFontSizeInPx,r.y.title=o.CartesianChart.yAxisSmallFontSizeInPx,r.y2.tickLabels=o.CartesianChart.yAxisSmallFontSizeInPx,r.y2.title=o.CartesianChart.yAxisSmallFontSizeInPx),a.x.titleFontProperties=o.FontProperties.inherit(a.x.titleFontProperties,{size:s.createFromPx(r.x.title)}),a.y.titleFontProperties=o.FontProperties.inherit(a.y.titleFontProperties,{size:s.createFromPx(r.y.title)}),a.y2.titleFontProperties=o.FontProperties.inherit(a.y2.titleFontProperties,{size:s.createFromPx(r.y2.title)}),a.x.labelFontProperties=o.FontProperties.inherit(a.x.labelFontProperties,{size:s.createFromPx(r.x.tickLabels)}),a.y.labelFontProperties=o.FontProperties.inherit(a.y.labelFontProperties,{size:s.createFromPx(r.y.tickLabels)}),a.y2.labelFontProperties=o.FontProperties.inherit(a.y2.labelFontProperties,{size:s.createFromPx(r.y2.tickLabels)})),e),r=(a=t).legendData.position,e=i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.legendWidth&&o.Legend.isLeftOrRight(r),r=i.height<=o.cartesianLegacyResponsiveViewportsBreakpoints.legendHeight&&o.Legend.isTopOrBottom(r);(e||r)&&(a.legendData.show=!1),i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForMediumFont&&(e=a.legendData.fontProperties.size.pt,r=void 0,r=i.width<=o.cartesianLegacyResponsiveViewportsBreakpoints.maxWidthForSmallFont?Math.min(e,o.Legend.LegendSmallFontSmallViewportInPt):Math.min(e,o.Legend.LegendMediumFontSmallViewportInPt),a.legendData.fontProperties=o.FontProperties.inherit(a.legendData.fontProperties,{size:s.createFromPt(r)}))}}(powerbi=powerbi||{}),function(e){var s;function n(e){this.viewport=e.viewport,this.cartesianData=e.cartesianData,this.dataView=e.dataView,this.responsiveFontHelper=new s.ResponsiveCartesianFontHelper}(s=e.visuals||(e.visuals={})).cartesianResponsiveBreakpoints={legendPositionWidth:210,legendPositionHeight:100,legendHeight:70,legendWidth:80,xAxesHeight:100,yAxesTitleWidth:210,yAxesWidth:100,xAxesTitleHeight:145,yAxesZoomWidth:280,xAxesZoomHeight:150,iconWidth:50,iconHeight:50},n.prototype.getData=function(){var e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,s.cartesianChartProps),t=e.responsive,e=e.responsiveLegacy,i=this.cartesianData;return i=t||e?this.applyResponsiveChanges(this.viewport,this.cartesianData,t,e):i},n.prototype.enumerateObjectInstances=function(e,t,i){"general"===e.objectName&&this.enumerateGeneral(t,this.dataView,i)},n.prototype.getResponsiveSlice=function(e,t,i){if(t)return t=s.cartesianChartProps.general,e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(e,s.cartesianChartProps),{item:new s.builder.SimpleFormattingSliceBuilder({uidBuilder:new s.builder.FormattingSliceUidBuilder(new s.builder.FormattingGroupUidBuilder(new s.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new s.builder.ToggleSwitchBuilder({descriptor:t.responsive,value:e.responsive}).build(),localize:i}).build(),revertToDefaultDescriptors:[t.responsive]}},n.prototype.enumerateGeneral=function(e,t,i){var a={selector:null,properties:{},objectName:"general"};i&&(i=s.ViewModelAdapterUtils.getResponsiveVisualProperties(t,s.cartesianChartProps),a.properties.responsive=i.responsive),e.pushInstance(a)},n.prototype.applyResponsiveChanges=function(e,t,i,a){var r=s.ViewModelAdapterUtils.cloneData(t),o=r.legendData.position;return i?(this.applyIconResponsiveChanges(e,r),this.applyLegendResponsiveChanges(e,o,r),this.applyAxesResponsiveChanges(e,r),this.applyZoomSliderResponsiveChanges(e,r),this.applyFontSizesChanges(e,r),n.applyScrollbarChanges(e,r)):a&&s.CartesianLegacyResponsiveApplier.applyLegacyResponsiveChanges(e,r),s.CartesianViewModelAdapterUtils.updatePlotResponsiveWarnings(r,t),r},n.prototype.applyIconResponsiveChanges=function(e,t){t.showIcon=e.height<=s.cartesianResponsiveBreakpoints.iconHeight||e.width<=s.cartesianResponsiveBreakpoints.iconWidth},n.prototype.applyLegendResponsiveChanges=function(e,t,i){(e.width<s.cartesianResponsiveBreakpoints.legendPositionWidth||e.height<s.cartesianResponsiveBreakpoints.legendPositionHeight)&&s.Legend.isLeftOrRight(t)&&(i.legendData.position=s.LegendPosition.Top),(e.height<s.cartesianResponsiveBreakpoints.legendHeight||e.width<s.cartesianResponsiveBreakpoints.legendWidth)&&(i.legendData.show=!1),i.legendData.useLargeArrowHitArea=!0},n.applyScrollbarChanges=function(e,t){t.scrollbarOptions=n.ScrollbarOptions},n.prototype.applyAxesResponsiveChanges=function(e,t){e.height<s.cartesianResponsiveBreakpoints.xAxesHeight&&(t.axesData.x.show=!1),e.width<s.cartesianResponsiveBreakpoints.yAxesTitleWidth&&(t.axesData.y.showAxisTitle=!1,t.axesData.y2.showAxisTitle=!1),e.width<s.cartesianResponsiveBreakpoints.yAxesWidth&&(t.axesData.y.show=!1,t.axesData.y2.show=!1),e.height<s.cartesianResponsiveBreakpoints.xAxesTitleHeight&&(t.axesData.x.showAxisTitle=!1)},n.prototype.applyZoomSliderResponsiveChanges=function(e,t){(e.height<s.cartesianResponsiveBreakpoints.xAxesZoomHeight||e.width<s.cartesianResponsiveBreakpoints.yAxesZoomWidth)&&(t.zoomData.showOnCategoryAxis=!1,t.zoomData.showOnValueAxis=!1,t.zoomData.showOnValueSecAxis=!1)},n.prototype.applyFontSizesChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));t=t.axesData;t.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.labelFontProperties),t.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.titleFontProperties),t.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.labelFontProperties),t.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.titleFontProperties),t.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.labelFontProperties),t.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.titleFontProperties)},n.ScrollbarOptions={scrollbarWidth:8,scrollbarRadius:4,scrollbarClass:"responsive"},s.CartesianViewModelAdapter=n}(powerbi=powerbi||{}),function(e){var g=e.visuals||(e.visuals={}),y=e.data.DataViewConcatenateCategoricalColumns;function t(e){this.staticUpdateOptions=e}t.prototype.create=function(e){return new i(this.staticUpdateOptions,e)},g.CartesianSmallMultipleUpdateFactory=t,a.prototype.apply=function(e,t){var i,a=this.staticUpdateOptions,r=a.layerInitDataOptions,a=a.updateGlobalAxesDomains,o=this.updateOptions,s=o.isSmallMultiples,n=o.reader,l=o.dataViews,c=o.updateOptions,o=o.requestedPerMultipleAxisDomains;if(s)for(var u=g.ComboChart.isComboChart(t)?n.convertComboFrame(e.index):[n.convertFrame(e.index)],d=void 0,h=0;h<u.length;h++){var p=u[h],p=y.concatenateCategoryColumnsForVisual(p.metadata,g.StandardObjectPropertyIdentifiers.formatString,g.cartesianRoleNames.category,p.categorical,!!d);d?p.categorical.categories=d:d=null==(i=p.categorical)?void 0:i.categories,u[h]=p}else u=l;e.hasInitializedData()||e.initData(r);t=__assign(__assign({},c),{dataViews:u,multipleInfo:s?this.buildMultipleInfo(e.index):void 0});e.update(t),o&&(o.categoryAxis||o.valueAxis||o.secondaryValueAxis)&&a(e.getAxesDomains(!0,o))},a.prototype.applySynchronizedAxes=function(e,t){this.updateOptions.isSmallMultiples;e.applySynchronizedDomains(t)},a.prototype.applyResize=function(e){e.resize(this.updateOptions.updateOptions.viewport)},a.prototype.buildMultipleInfo=function(e){this.updateOptions.isSmallMultiples,this.updateOptions.reader;var i,t=this.updateOptions.reader;if(t)return i=t.getFrameNode(e),t=t.getFrameSourceColumns().map(function(e,t){return{metadata:e,value:i.levelValues[t].value}}),{identity:i.identity,sources:t,isCoreMultiple:0===e}};var i=a;function a(e,t){this.staticUpdateOptions=e,this.updateOptions=t}function n(e,t,i,a,r,o,s){this.smallMultiples=e,this.index=t,this.featureSwitches=i,this.layers=a,this.type=r,this.interactivityService=o,this.getLayerInitOptions=s,this.state=0}g.CartesianSmallMultipleUpdate=i,n.create=function(e,t,i,a,r,o,s){return new n(e,t,i,r,o,a,s)},n.prototype.getDataPoint=function(){var t,e,i;return this.dataPoint||(t=this.multipleInfo,i=_.first(t.sources).metadata.queryName,e=t.sources.map(function(e){return g.buildValueDetailsForColumnValue(e.metadata,e.value,t.identity)}),i=(new g.SelectionIdBuilder).withColumnIdentity(t.identity,i,e).createSelectionId(),this.dataPoint={selected:!1,identity:i},this.interactivityService&&this.interactivityService.applySelectionStateToData([this.dataPoint])),this.dataPoint},n.prototype.getIndex=function(){return this.index},n.prototype.isSelected=function(){return this.getDataPoint().selected},n.prototype.getState=function(){return this.state},n.prototype.initRenderer=function(e){this.getState(),this.renderer=e;var t=this.getLayerInitOptions(e);this.layers.forEach(function(e){return e.initRenderer(t)}),this.state|=2},n.prototype.getRenderer=function(){return this.getState(),this.renderer},n.prototype.initData=function(i){this.getState(),this.layers.forEach(function(e){var t;return null==(t=e.initData)?void 0:t.call(e,i)}),this.style=i.style,this.state|=1},n.prototype.update=function(e){this.getState(),this.dataViews=e.dataViews,this.multipleInfo=e.multipleInfo,this.dataPoint=void 0,this.adapterFactory=e.adapterFactory;var t=this.layers;return this.responsiveData=void 0,this.data=g.CartesianChart.converter({layerStyle:this.style,chartType:this.type,dataViews:e.dataViews,categoryAxisTitleOnByDefault:e.categoryAxisTitleOnByDefault,valueAxisTitleOnByDefault:e.valueAxisTitleOnByDefault,layers:t,featureSwitches:this.featureSwitches,hasDataChanged:null!=e.operationKind,multipleInfo:e.multipleInfo}),this.data},n.prototype.isVisible=function(){return!!(2&this.state)},n.prototype.hasInitializedData=function(){return!!(1&this.state)},n.prototype.getMultipleInfo=function(){return this.multipleInfo},n.prototype.applySynchronizedDomains=function(e){var t,i,a,r,o,s=this.data&&this.data.axesData;e&&s&&(i=s.categoryAxis,a=s.valueAxis,s=s.secondaryValueAxis,r=e.categoryAxis,o=e.valueAxis,e=e.secondaryValueAxis,(t=function(e,t){e&&(t.includeDomains=t.includeDomains||[]).push(g.AxisHelper.createScalarDomainOptions(e,1))})(r,i),this.featureSwitches.smallMultiplesUnsharedAxes&&(!this.data.axesData.y.sharedAxis&&this.data.axesData.y.scaleToFit||!this.data.axesData.x.sharedAxis&&this.data.axesData.x.scaleToFit)||(t(o,a),t(e,s)))},n.prototype.resize=function(e){this.adapterFactory&&this.data&&(!1==!!this.smallMultiples||this.featureSwitches.smallMultiplesResponsive||!this.smallMultiples.isSmallMultiples()?(e=this.adapterFactory.createCartesianAdapter({cartesianData:this.data,dataView:this.dataViews[0],viewport:e,isCoreMultiple:!this.multipleInfo||this.multipleInfo.isCoreMultiple}),this.responsiveData=e.getData()):this.responsiveData=this.data)},n.prototype.getCapabilities=function(){var r={domainAggregateRoles:[],supportedDomainAggregates:void 0},o={domainAggregateRoles:[],supportedDomainAggregates:void 0},s={domainAggregateRoles:[],supportedDomainAggregates:void 0};return this.layers.forEach(function(e){function t(e,t){e&&e.domainAggregateRole&&(t.domainAggregateRoles.push(e.domainAggregateRole),void 0===t.supportedDomainAggregates?t.supportedDomainAggregates=e.supportedDomainAggregates:t.supportedDomainAggregates&=e.supportedDomainAggregates)}var e=e.getCartesianVisualCapabilities(),e=(e.axesCapabilities,e.axesCapabilities),i=e.categoryAxis,a=e.valueAxis,e=e.secondaryValueAxis;t(i,r),t(a,o),t(e,s)}),{axesCapabilities:{categoryAxis:_.isEmpty(r.domainAggregateRoles)?void 0:__assign(__assign({},r),{domainAggregateRoles:_.uniq(r.domainAggregateRoles)}),valueAxis:_.isEmpty(o.domainAggregateRoles)?void 0:__assign(__assign({},o),{domainAggregateRoles:_.uniq(o.domainAggregateRoles)}),secondaryValueAxis:_.isEmpty(s.domainAggregateRoles)?void 0:__assign(__assign({},s),{domainAggregateRoles:_.uniq(s.domainAggregateRoles)})}}},n.prototype.getAxesDomains=function(e,t){for(var i={},a=0;a<this.layers.length;a++){var r=this.layers[a];r.getAxesDomains&&((r=r.getAxesDomains(e,t)).categoryAxis&&(i.categoryAxis=g.AxisHelper.mergeDomains(i.categoryAxis||g.DefaultDomain,r.categoryAxis)),r.valueAxis&&(0<a&&g.ComboChart.isComboChart(this.type)?i.secondaryValueAxis=g.AxisHelper.mergeDomains(i.secondaryValueAxis||g.DefaultDomain,r.valueAxis):i.valueAxis=g.AxisHelper.mergeDomains(i.valueAxis||g.DefaultDomain,r.valueAxis)),r.secondaryValueAxis)&&(i.secondaryValueAxis=g.AxisHelper.mergeDomains(i.secondaryValueAxis||g.DefaultDomain,r.secondaryValueAxis))}return i},n.prototype.getData=function(){return this.responsiveData||this.data},n.prototype.clearSelection=function(){for(var e=0,t=this.layers.length;e<t;e++)this.layers[e].onClearSelection()},n.prototype.updateLayers=function(){this.layers.forEach(function(e){return e.render(!0)})},n.prototype.destroy=function(){this.renderer&&(this.getState(),this.renderer.destroy())},g.CartesianSmallMultiple=n}(powerbi=powerbi||{}),function(c){var d;function e(e,t,i,a){this.type=e,this.featureSwitches=t,this.layerFactory=i,this.getLayerInitRendererOptions=a,this.multiples=[]}d=c.visuals||(c.visuals={}),e.prototype.init=function(e,t){var i=this;this.rowLoadMoreDataHandler=new d.SimpleLoadMoreDataHandler(e.host),this.updateFactory=new d.CartesianSmallMultipleUpdateFactory({layerInitDataOptions:e,updateGlobalAxesDomains:function(e){return i.updateGlobalAxesDomains(e)}}),this.interactivityService=t,this.multiples=[]},e.prototype.getObjects=function(){return this.reader?this.reader.getObjects():void 0},e.prototype.getCoreMultiple=function(){return this.coreMultiple||(this.coreMultiple=d.CartesianSmallMultiple.create(this,0,this.featureSwitches,this.interactivityService,this.layerFactory(),this.type,this.getLayerInitRendererOptions)),this.coreMultiple},e.prototype.getShouldResetRowMultipleScrollPosition=function(){return this.shouldResetRowMultipleScrollPosition},e.prototype.get=function(e){if(this.isSmallMultiples(),!this.isSmallMultiples())return this.getCoreMultiple();if(this.multipleUpdate,!(i=this.multiples[e]))for(var t=this.multiples.length;t<=e;t++){this.multiples.length;var i=this.multiples[t]=d.CartesianSmallMultiple.create(this,t,this.featureSwitches,this.interactivityService,this.layerFactory(),this.type,this.getLayerInitRendererOptions),a=this.multipleUpdate;a.apply(i,this.type),this.isSmallMultiples()&&a.applySynchronizedAxes(i,this.axesDomains),a.applyResize(i)}return i},e.prototype.clear=function(){this.getMultiples(!0).forEach(function(e){return e.destroy()}),this.multiples=[],this.coreMultiple=void 0,this.axesDomains=void 0,this.shouldResetRowMultipleScrollPosition=void 0,this.multipleUpdate=void 0},e.prototype.resize=function(t){this.getMultiples(!0).forEach(function(e){return e.resize(t)})},e.prototype.update=function(e){var t,i=e.dataViews,a=(this.updateOptions=e,this.isSmallMultiples(i)),r=(this.shouldResetRowMultipleScrollPosition=!e.preserveScrollPosition,this.getCoreMultiple());a?(this.reader=d.DataViewMultipleReader.create(i[0],d.StandardObjectPropertyIdentifiers.formatString),this.updateFactory.create({dataViews:e.dataViews,isSmallMultiples:a,reader:this.reader,requestedPerMultipleAxisDomains:void 0,updateOptions:e}).apply(r,this.type),e.preserveScrollPosition||(this.lastUpdatedFrameIndex=0,this.axesDomains=void 0,this.requestPerMultipleAxisDomains=this.updateSynchronizedDomainsFromAggregates()),t=this.reader.getFrameCount(),this.rowLoadMoreDataHandler.updateDataView(e.dataViews[0])):(this.reader=void 0,this.lastUpdatedFrameIndex=0,this.axesDomains=void 0,t=1,this.rowLoadMoreDataHandler.updateDataView(void 0)),this.rowLoadMoreDataHandler.onLoadMoreDataCompleted(),this.multipleUpdate=this.updateFactory.create({dataViews:e.dataViews,isSmallMultiples:a,reader:this.reader,requestedPerMultipleAxisDomains:this.requestPerMultipleAxisDomains,updateOptions:e}),this.updateMultiples(t)},e.prototype.updateMultiples=function(e){for(var t=this,i=this.multiples,a=this.multipleUpdate,r=this.updateOptions.dataViews,o=this.isSmallMultiples(r),s=this.getCoreMultiple(),n=this.requestPerMultipleAxisDomains,l={startIndex:this.lastUpdatedFrameIndex,endIndex:e},c=l.startIndex;c<l.endIndex;c++){var u=o?i[c]:s;!u&&n&&(i.length,u=i[c]=d.CartesianSmallMultiple.create(this,c,this.featureSwitches,this.interactivityService,this.layerFactory(),this.type,this.getLayerInitRendererOptions)),u&&a.apply(u,this.type)}this.getMultiples(!0).forEach(function(e){e&&(o&&a.applySynchronizedAxes(e,t.axesDomains),a.applyResize(e))}),this.lastUpdatedFrameIndex=l.endIndex},e.prototype.updateSynchronizedDomainsFromAggregates=function(){var e,t=this.getCoreMultiple(),i=t.getCapabilities().axesCapabilities,a=i.categoryAxis,r=i.valueAxis,o=i.secondaryValueAxis,s={categoryAxis:!!(2&a.supportedDomainAggregates),valueAxis:!!(2&r.supportedDomainAggregates),secondaryValueAxis:!!(o&&2&o.supportedDomainAggregates)},a={categoryAxis:!!(1&a.supportedDomainAggregates),valueAxis:!!(1&r.supportedDomainAggregates),secondaryValueAxis:!!(o&&1&o.supportedDomainAggregates)},i=((s.categoryAxis||s.valueAxis||s.secondaryValueAxis)&&(r=this.getTopLevelDomains(i))&&(e={categoryAxis:s.categoryAxis?r.categoryAxis:void 0,valueAxis:s.valueAxis?r.valueAxis:void 0,secondaryValueAxis:s.secondaryValueAxis?r.secondaryValueAxis:void 0}),this.axesDomains=e,null==(o=t.getData())?void 0:o.axesData),s=i&&this.featureSwitches.smallMultiplesUnsharedAxes&&!i.valueAxis.sharedAxis,r={categoryAxis:a.categoryAxis&&(!e||_.isEmpty(e.categoryAxis)),valueAxis:a.valueAxis&&(!e||_.isEmpty(e.valueAxis)||s),secondaryValueAxis:a.secondaryValueAxis&&(!e||_.isEmpty(e.secondaryValueAxis))};return _.every(r,function(e){return!e})?void 0:r},e.prototype.isSmallMultiples=function(e){return!(!e&&!this.updateOptions)&&(e=e||this.updateOptions.dataViews,d.CartesianChart.isSmallMultiples(e,this.featureSwitches.cartesianMultiples))},e.prototype.clearSelection=function(e){this.getMultiples(!0).forEach(function(e){return e.clearSelection()}),this.executeActionForMultiplesInRange(function(e){return e.updateLayers()},e,!1)},e.prototype.checkIfNoLabelsCanBeRendered=function(){return _.every(this.getMultiples(),function(e){return e.isVisible()&&e.getRenderer().noLabelsCanBeRendered})},e.prototype.scrollTo=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollTo(t)},e,!1)},e.prototype.shouldScrollTo=function(t,e){return!!this.getValueForFirstMultipleInRange(function(e){return e.getRenderer().axesRenderer.shouldScrollTo(t)},e,!1)},e.prototype.scrollBy=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollBy(t)},e,!1)},e.prototype.scrollDelta=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.scrollDelta(t)},e,!1)},e.prototype.clearRenderingTimeout=function(){this.getMultiples().forEach(function(e){return e.isVisible()&&e.getRenderer().axesRenderer.clearRenderingTimeout()})},e.prototype.updateScrollbarExtent=function(t,e){this.executeActionForMultiplesInRange(function(e){return e.getRenderer().axesRenderer.setExtent(t)},e,!1)},e.prototype.executeActionForMultiplesInRange=function(t,e,i){i=this.getMultiples(i,e);_.isEmpty(i)||i.forEach(function(e){return t(e)})},e.prototype.getValueForFirstMultipleInRange=function(e,t,i){i=this.getMultiples(i,t);if(!_.isEmpty(i))return e(i[0])},e.prototype.getFrameCount=function(){return this.isSmallMultiples()?this.reader.getFrameCount():1},e.prototype.updateGlobalAxesDomains=function(e){var t=this.axesDomains=this.axesDomains||{};e.categoryAxis&&(t.categoryAxis=d.AxisHelper.mergeDomains(t.categoryAxis||d.DefaultDomain,e.categoryAxis)),e.valueAxis&&(t.valueAxis=d.AxisHelper.mergeDomains(t.valueAxis||d.DefaultDomain,e.valueAxis)),e.secondaryValueAxis&&(t.secondaryValueAxis=d.AxisHelper.mergeDomains(t.secondaryValueAxis||d.DefaultDomain,e.secondaryValueAxis))},e.prototype.getTopLevelDomains=function(e){function t(e){var t,i=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t in e)for(var a=0,r=e[t];a<r.length;a++){var o=r[a],s=o.min,o=o.max;(_.isDate(s)||_.isNumber(s)&&isFinite(s))&&(_.isDate(o)||_.isNumber(o)&&isFinite(o))&&(n.featureSwitches.utcDates&&c.isDateWithEpochValue(s)&&c.isDateWithEpochValue(o)&&(s=s.epochTimeStamp,o=o.epochTimeStamp),i=d.AxisHelper.mergeDomains(i,[+s,+o]))}return i}var i,a,r,n=this,o=this.reader,s=e.categoryAxis,l=e.valueAxis,e=e.secondaryValueAxis;return 2&s.supportedDomainAggregates&&(i=(s=o.getTopLevelAggregates(s.domainAggregateRoles))?t(s):void 0),2&l.supportedDomainAggregates&&(a=(s=o.getTopLevelAggregates(l.domainAggregateRoles))?t(s):void 0),e&&2&e.supportedDomainAggregates&&(r=(l=e&&o.getTopLevelAggregates(e.domainAggregateRoles))?t(l):void 0),i||a||r?{categoryAxis:i,valueAxis:a,secondaryValueAxis:r}:void 0},e.prototype.getMultiples=function(e,t){void 0===e&&(e=!1);var i=[],a=this.isSmallMultiples();return a&&!e||(e=this.getCoreMultiple())&&i.push(e),a&&(e=this.multiples,t&&(e=e.slice(t.startIndex,Math.min(t.endIndex,e.length))),i.push.apply(i,e)),i},d.CartesianSmallMultiples=e}(powerbi=powerbi||{}),function(A){var P=A.visuals||(A.visuals={}),s=P.AxisDataModel.AxesData,g=jsCommon.CssConstants,y=A.visuals.DataViewConcatenateUtil,c=A.data.DataViewRoleWildcard,e=A.visuals.LoadMoreDataStatus,d=A.visuals.OnObjectUtil,S=A.data.Selector,t=(P.INTERACTIVITY_RIGHT_MARGIN=6,P.DefaultDomain=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],P.MultiplesLayoutMinColumns=1,P.MultiplesLayoutMaxColumns=6,P.MultiplesLayoutMinRows=1,P.MultiplesLayoutMaxRows=6,P.MultiplesLayoutMinGridlinesWidth=1,P.MultiplesLayoutMaxGridlinesWidth=12,P.MultiplesSubheaderDefaults=function(){return{FontFamily:P.Font.Family.regular.css,FontPointSize:8,ColorName:"foregroundNeutralSecondary",TextClassName:"title",Vertical:0,Horizontal:0,Show:!0,TitleWrap:!1,bold:!1,italic:!1,underline:!1}},P.CartesianWarningPropertyNames={axisFontSize:"fontSize",axisTitleFontSize:"titleFontSize",legendFontSize:"fontSize"},f.shouldYAxisBeCategorical=function(e){switch(e){case 6:case 5:case 7:return!0}return!1},f.isSmallMultiples=function(e,t){var i;return!!t&&!(_.size(e)<1||(i=null==(t=null==(t=null==(t=null==(t=null==(t=e[0])?void 0:t.matrix)?void 0:t.rows)?void 0:t.levels)?void 0:t[0])?void 0:t.sources,_.size(i)<1)||_.isEmpty(e[0].matrix.rows.root.children))&&_.every(i,function(e){return A.data.DataRoleHelper.hasRole(e,P.cartesianRoleNames.rows)})},f.prototype.init=function(e){var t=this,i=((this.visualInitOptions=e).featureSwitches&&!this.featureSwitches&&(this.featureSwitches=e.featureSwitches),e.element),a=(this.currentViewport=e.viewport,this.hostServices=e.host,this.eventManager=new jsCommon.BubblingEventManager(d3.select(i.get(0))),this.categoryLoadMoreDataHandler=new O(null,this.hostServices,f.LoadMoreThreshold),this.behaviorFactory&&(this.interactivityService=P.createInteractivityService(this.hostServices)),this.tooltipService=P.createTooltipService(e.host),this.visualInitOptions.style),r=A.Prototype.inherit(a),o=(r.colorPalette=A.Prototype.inherit(a.colorPalette),r.colorPalette.dataColors=new I(a.colorPalette.dataColors),this.layerStyle=r,s.createDefault(a)),a=(this.axisZoom=new P.AxisZoom(i,this.hostServices,this.axes.isScrollable&&!!e.interactivity,this.featureSwitches),this.axes.init({axesData:o,axisZoom:this.axisZoom,isYAxisCategorical:f.shouldYAxisBeCategorical(this.type),interactivityService:this.interactivityService}),this.legend=P.createLegend(i,e.interactivity&&e.interactivity.isInteractiveLegend,13!==this.type?this.interactivityService:void 0,this.axes.isScrollable,void 0,a,this.hostServices),A.Prototype.inherit(e));a.style=r,a.chartType=this.type,a.services={tooltips:this.tooltipService},this.multiples.init(a,this.interactivityService),this.layoutBuilder.init(e,this.tooltipService,this.legend,o,this.interactivityService,this.layerStyle,this.multiples.rowLoadMoreDataHandler,this.eventManager),this.layout=this.layoutBuilder.create(this.visualInitOptions.element),this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.featureSwitches.onObject&&(o=null!=(a=null==(r=this.hostServices)?void 0:r.getSubSelectionService())?a:P.SubSelectionRegionOutlineRenderer.createWithDefaultHost(),this.subSelectionHelper=P.HtmlSubSelectionHelper.createHtmlSubselectionHelper({hostElement:i.get(0),hostServices:this.hostServices,renderer:o,selectorCallback:function(e){return t.getSelectorsByColumnSubSelection(e)},customOutlineCallback:function(e){return t.getSubSelectionCustomOutlines(e)},customElementCallback:function(e){return t.getSubSelectionCustomElements(e)},subSelectionMetadataCallback:function(e){return t.getSubSelectionMetadata(e)}}),this.interactivityService.setSubSelectionHelper(this.subSelectionHelper))},f.prototype.isPlayAxis=function(){var e;return!(!this.dataViews||!this.dataViews[0])&&(e=this.dataViews[0],10===this.type)&&(this.hasAnimator||this.isMobileChart)&&A.data.DataRoleHelper.hasRoleInDataView(e,"Play")},f.prototype.hasBreakdownRole=function(){var e;return!(!this.dataViews||!this.dataViews[0])&&(e=this.dataViews[0],13===this.type)&&A.data.DataRoleHelper.hasRoleInDataView(e,"Breakdown")},f.getDataBoundReferenceLines=function(e,t,i,a){var r=[],o=[];if(e)if(e.matrix&&e.matrix.valueSources){var s=e.matrix;if(s.valueSources&&o.push.apply(o,e.matrix.valueSources||[]),s.rows&&s.rows.levels)for(var n=0,l=s.rows.levels;n<l.length;n++){var c=l[n];o.push.apply(o,c.sources||[])}}else if(e.categorical&&e.categorical.values){s=_.head(e.categorical.values.grouped());if(s)for(var u=0,d=s.values;u<d.length;u++){var h=d[u];o.push(h.source)}}for(var p=0;p<o.length;p++){var g=o[p],y=P.ColorHelper.getDataColorByIndex(i,p,P.ForegroundColorName),m=A.DataViewObjects.getUserDefinedObjects(g.objects,"referenceLine"),v=f.getCartesianRoleKind(g,t);r.push.apply(r,P.ReferenceLineHelper.readDataView(m,y,"referenceLine",v,i,a,void 0,g)||[])}return r},f.getCartesianRoleKind=function(e,t){var i=e.roles;if(t.getAxisLocationForRole&&i)for(var a in i)if(i[a])return t.getAxisLocationForRole(a);return 1},f.converter=function(e){return(new P.CartesianChartConverter).convert(e)},f.prototype.updateInternal=function(h,p){return __awaiter(this,void 0,A.Promise,function(){var t,i,a,r,o,s,n,l,c,u,d;return __generator(this,function(e){switch(e.label){case 0:return(t=this.dataViews=h.dataViews,i=h.operationKind===A.VisualDataChangeOperationKind.Append||null!=h.resizeMode||h.formatMode,this.currentViewport=h.viewport,t)?(u=this.layerFactory.layerMetadata,c=_.some(u,function(e){return!!e.categoryAxisTitleOnByDefault}),u=_.some(u,function(e){return!!e.valueAxisTitleOnByDefault}),d=this.multiples.isSmallMultiples(t),(l=d&&t[0])?(n=l.metadata.objects,r=this.layerStyle,s=f.getMultiplesLayout(n,r),n=f.getMultiplesSubheader(n,r),r=s.columnCount,o=s.rowCount,this.viewModelAdapterFactory.setSmallMultiplesOptions({viewport:this.currentViewport,isSmallMultiples:d,columns:r,rows:o}),this.smallMultiplesViewModelAdapter=this.viewModelAdapterFactory.createSmallMultiplesAdapter({dataView:l,multiplesLayout:s,multiplesSubheader:n,viewport:this.currentViewport})):(this.viewModelAdapterFactory.setSmallMultiplesOptions({viewport:this.currentViewport,isSmallMultiples:d,columns:void 0,rows:void 0}),this.smallMultiplesViewModelAdapter=void 0),d!==this.multiples.isSmallMultiples()&&this.multiples.clear(),null!=p?(r=this.multiples.getCoreMultiple(),o=r.layers,_.isEmpty(t)||(l=f.getLayerDataViews(t),this.cartesianVisualCapabilities=f.getCartesianVisualCapabilities(o),d&&this.cartesianVisualCapabilities&&(this.cartesianVisualCapabilities.supportsHierarchicalCategoryAxis=!1),2===(a=this.categoryAxisRenderMode=f.getRenderMode(l,this.cartesianVisualCapabilities,this.featureSwitches.easierHierarchicalAxis))&&(t=t.map(function(e){return y.concatenateCategories(e,P.columnChartProps.general.formatString,P.cartesianRoleNames.category)}))),this.multiples.update({dataViews:t,operationKind:p,categoryAxisTitleOnByDefault:c,valueAxisTitleOnByDefault:u,viewport:this.currentViewport,adapterFactory:this.viewModelAdapterFactory,preserveScrollPosition:i}),this.cartesianData=this.originalCartesianData=r.getData()):(this.multiples.resize(this.currentViewport),this.cartesianData=this.multiples.getCoreMultiple().getData()),null==p&&this.cartesianData&&this.cartesianData.axesData?this.axes.updateResize(this.cartesianData.axesData,this.cartesianData.scrollbarOptions.scrollbarWidth):null!=p&&(_.isEmpty(t)||((s=t[0]).metadata&&(this.background={image:A.DataViewObjects.getValue(s.metadata.objects,P.scatterChartProps.plotArea.image),transparency:A.DataViewObjects.getValue(s.metadata.objects,P.scatterChartProps.plotArea.transparency,P.visualBackgroundHelper.getDefaultTransparency())}),this.categoryLoadMoreDataHandler.update(a,d),this.axes.update(s.categorical?s.categorical.categories:null,this.cartesianData.axesData,a,this.cartesianData.scrollbarOptions.scrollbarWidth)),this.categoryLoadMoreDataHandler.onLoadMoreDataCompleted()),this.cartesianData&&this.cartesianData.zoomData&&this.axisZoom.update({dataViews:t,zoomData:this.cartesianData.zoomData,hasSmallMultiples:d,hasScalarCategoryAxis:this.categoryAxisIsScalar().isScalar,hasYAxisCategorical:this.axes.isYAxisCategorical}),n=!this.hasSetData||h.suppressAnimations||d,[4,this.render(n,i,h.resizeMode)]):[2];case 1:return e.sent(),this.hasSetData=this.hasSetData||!_.isEmpty(t),this.updateWarnings(this.cartesianData.warningObjectCollection),l=h.type&A.VisualUpdateType.Data||h.type&A.VisualUpdateType.ResizeEnd||h.type&A.VisualUpdateType.FormattingSubSelectionChange,c=h.type&A.VisualUpdateType.FormattingSubSelectionChange,this.subSelectionHelper&&l&&(this.subSelectionHelper.updateOutlinesFromSubSelections(h.subSelections,!0),this.hostServices.alertScreenReader)&&c&&(u=this.subSelectionHelper.getLabelsFromSubSelections(h.subSelections,["aria-label"]),d=(null==u?void 0:u.length)&&u.join(" "))&&this.hostServices.alertScreenReader(d),[2]}})})},f.getMultiplesLayout=function(e,t){var e=A.DataViewObjects.getObject(e,P.SmallMultiplesUtils.LayoutObjectName),i=e,a=f.getLayoutDefaults(t),t=P.ColorHelper.create(t),r=(i&&i.layoutType)===P.smallMultiplesLayout.auto?{layoutType:0,rowCount:a.rowCount,columnCount:a.columnCount}:{layoutType:1,rowCount:i&&i.rowCount||a.rowCount,columnCount:i&&i.columnCount||a.columnCount};return r.backgroundColor=t.getColorForPropertyNameWithDefaultColor(e,P.StandardObjectPropertyIdentifiers.smallMultiplesBackgroundColor.propertyName,a.backgroundColor,!0),r.backgroundTransparency=(i&&void 0!==i.backgroundTransparency?i:a).backgroundTransparency,r.gridLineType=i&&i.gridLineType||a.gridLineType,r.gridLineStyle=i&&i.gridLineStyle||a.gridLineStyle,r.gridLineColor=t.getColorForPropertyNameWithDefaultColor(e,P.StandardObjectPropertyIdentifiers.smallMultiplesGridLineColor.propertyName,a.gridLineColor),r.gridLineWidth=(i&&void 0!==i.gridLineWidth?i:a).gridLineWidth,f.applyPadding(r,i,a),r},f.getLayoutDefaults=function(e){var t={layoutType:0,rowCount:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultRowCount,columnCount:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultColumnCount,backgroundColor:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultBackgroundColor,backgroundTransparency:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultBackgroundTransparency,gridLineType:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineType,gridLineStyle:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineStyle,gridLineWidth:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineWidth,gridPadding:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,advancedPaddingOptions:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultAdvancedPaddingOptions,columnPaddingInner:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,columnPaddingOuter:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,rowPaddingInner:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding,rowPaddingOuter:P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultPadding};return t.gridLineColor=P.ColorHelper.getThemeColor(e,P.SmallMultiplesUtils.SmallMultiplesDefaults.DefaultGridLineColorName),t},f.getCartesianVisualCapabilities=function(e){for(var t,i=0,a=e.length;i<a;i++){var r=e[i].getCartesianVisualCapabilities();t?t.supportsHierarchicalCategoryAxis=t.supportsHierarchicalCategoryAxis&&r.supportsHierarchicalCategoryAxis:t=A.Prototype.inherit(r)}return t},f.getRenderMode=function(e,t,i){for(var a=0,r=e;a<r.length;a++){var o,s=r[a];null!=s&&(s=new h(s,null==t?void 0:t.supportsHierarchicalCategoryAxis,i).getRenderModes(),o=o?_.intersection(o,s):s,_.isEmpty(o))}return _.head(o)},f.getCategoryValueType=function(e){_.isEmpty(e);e=_.find(e,function(e){return e.getCategoryValueType});if(e)return e.getCategoryValueType()},f.applyPadding=function(e,t,i){e.gridPadding=(t&&void 0!==t.gridPadding?t:i).gridPadding,e.advancedPaddingOptions=(t&&void 0!==t.advancedPaddingOptions?t:i).advancedPaddingOptions;var a=t&&t.advancedPaddingOptions,r={gridPadding:e.gridPadding,gridLineSettings:e.gridLineType};a&&void 0!==t.columnPaddingInner?e.columnPaddingInner=t.columnPaddingInner:e.columnPaddingInner=f.getPaddingFromGridPaddingAndDefaults(r,1),a&&void 0!==t.columnPaddingOuter?e.columnPaddingOuter=t.columnPaddingOuter:(r.defaultPadding=i.columnPaddingOuter,e.columnPaddingOuter=f.getPaddingFromGridPaddingAndDefaults(r,0)),a&&void 0!==t.rowPaddingInner?e.rowPaddingInner=t.rowPaddingInner:e.rowPaddingInner=f.getPaddingFromGridPaddingAndDefaults(r,2),a&&void 0!==t.rowPaddingOuter?e.rowPaddingOuter=t.rowPaddingOuter:(r.defaultPadding=i.rowPaddingOuter,e.rowPaddingOuter=f.getPaddingFromGridPaddingAndDefaults(r,0))},f.getPaddingFromGridPaddingAndDefaults=function(e,t){var i=e.gridPadding,a=e.gridLineSettings,r=e.defaultPadding;switch(t){case 0:return P.GridLayout.typeHasOuterGridLines(a)?i:r;case 1:return P.GridLayout.typeHasVerticalGridLines(a)?i:f.floatSafeHalf(i);case 2:return P.GridLayout.typeHasHorizontalGridLines(a)?i:f.floatSafeHalf(i)}},f.floatSafeHalf=function(e){return e%2==0?e/2:Math.ceil(e/2)},f.prototype.isSmallMultiples=function(){return f.isSmallMultiples(this.dataViews,this.featureSwitches.cartesianMultiples)},f.prototype.showLayoutCard=function(){return this.isSmallMultiples()},f.prototype.supportsResponsive=function(){return this.featureSwitches.smallMultiplesResponsive||!this.isSmallMultiples()},f.prototype.enumerateLayout=function(e){var t,i;this.showLayoutCard()&&(t={selector:null,properties:{},validValues:{rowCount:{numberRange:{min:P.MultiplesLayoutMinRows,max:P.MultiplesLayoutMaxRows}},columnCount:{numberRange:{min:P.MultiplesLayoutMinColumns,max:P.MultiplesLayoutMaxColumns}}},objectName:P.SmallMultiplesUtils.LayoutObjectName},0===(i=f.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle)).layoutType?t.properties.layoutType=P.smallMultiplesLayout.auto:(t.properties.rowCount=i.rowCount,t.properties.columnCount=i.columnCount),e.pushInstance(t),t={selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},properties:{backgroundColor:i.backgroundColor},propertyInstanceKind:{backgroundColor:3},altConstantValueSelector:null,objectName:P.SmallMultiplesUtils.LayoutObjectName},e.pushInstance(t,!1),t={selector:null,properties:{backgroundTransparency:i.backgroundTransparency,gridLineType:i.gridLineType},validValues:{gridLineWidth:{numberRange:{min:P.MultiplesLayoutMinGridlinesWidth,max:P.MultiplesLayoutMaxGridlinesWidth}}},objectName:P.SmallMultiplesUtils.LayoutObjectName},i.gridLineType!==P.gridLineType.none&&(t.properties.gridLineColor=i.gridLineColor,t.properties.gridLineWidth=i.gridLineWidth,t.properties.gridLineStyle=i.gridLineStyle),i.advancedPaddingOptions||(t.properties.gridPadding=i.gridPadding),t.properties.advancedPaddingOptions=i.advancedPaddingOptions,i.advancedPaddingOptions&&(t.properties.columnPaddingInner=i.columnPaddingInner,t.properties.columnPaddingOuter=i.columnPaddingOuter,t.properties.rowPaddingInner=i.rowPaddingInner,t.properties.rowPaddingOuter=i.rowPaddingOuter),e.pushInstance(t,!1))},f.prototype.showSmallMultiplesCard=function(){return this.isSmallMultiples()},f.prototype.getSmallMultiplesCard=function(){var a,r,o,s,n,e,l=this;if(10!==this.type&&13!==this.type)return a=function(e){return l.hostServices.getLocalizedString(e)},r=f.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle),o=f.getMultiplesSubheader(this.dataViews[0].metadata.objects,this.layerStyle),s=P.StandardObjectIdentifiers.smallMultiplesLayout,n=P.StandardObjectIdentifiers.subheader,e=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("smallMultiples"),"Role_DisplayName_SmallMultiples",[s.rowCount,s.columnCount,s.gridPadding,s.advancedPaddingOptions,s.columnPaddingInner,s.columnPaddingOuter,s.rowPaddingInner,s.rowPaddingOuter,s.gridLineType,s.gridLineStyle,s.gridLineColor,s.gridLineWidth,s.backgroundColor,s.backgroundTransparency,n.show,n.fontFamily,n.fontSize,n.fontColor,n.underline,n.bold,n.italic,n.position,n.alignment,n.titleWrap],a),this.showSmallMultiplesCard()?(e.withDescription("Small_Multiples_Layout_Description").addGroup("layout",function(e){r.layoutType,e.withDisplayName("Small_Multiples_LayoutGroup").addSimpleSlice("rowCount",new P.builder.NumUpDownBuilder({descriptor:s.rowCount,value:r.rowCount,options:{minValue:{type:0,value:P.MultiplesLayoutMinRows},maxValue:{type:1,value:P.MultiplesLayoutMaxRows}}}).build()).addSimpleSlice("columnCount",new P.builder.NumUpDownBuilder({descriptor:s.columnCount,value:r.columnCount,options:{minValue:{type:0,value:P.MultiplesLayoutMinColumns},maxValue:{type:1,value:P.MultiplesLayoutMaxColumns}}}).build());var t=r.advancedPaddingOptions,i={minValue:{type:0,value:0},maxValue:{type:1,value:40}};e.addSimpleSlice("gridPadding",new P.builder.NumUpDownBuilder({descriptor:s.gridPadding,value:r.gridPadding,options:i}).build(),function(e){return e.withDisabled(t).withCustomDisplayName("Small_Multiples_All_Padding")}).addSimpleSlice("advancedPadding",new P.builder.ToggleSwitchBuilder({descriptor:s.advancedPaddingOptions,value:r.advancedPaddingOptions}).build(),function(e){return e.withCustomDisplayName("Small_Multiples_Customize_Padding")}),t&&e.addSimpleSlice("columnPaddingInner",new P.builder.SliderBuilder({descriptor:s.columnPaddingInner,value:r.columnPaddingInner,options:i,localize:a}).build()).addSimpleSlice("columnPaddingOuter",new P.builder.SliderBuilder({descriptor:s.columnPaddingOuter,value:r.columnPaddingOuter,options:i,localize:a}).build()).addSimpleSlice("rowPaddingInner",new P.builder.SliderBuilder({descriptor:s.rowPaddingInner,value:r.rowPaddingInner,options:i,localize:a}).build()).addSimpleSlice("rowPaddingOuter",new P.builder.SliderBuilder({descriptor:s.rowPaddingOuter,value:r.rowPaddingOuter,options:i,localize:a}).build())}),e.addGroup("border",function(e){var t=r.gridLineType!==P.gridLineType.none;e.withDisplayName("Visual_Border").addSimpleSlice("gridLineType",new P.builder.DropdownBuilder({descriptor:s.gridLineType,value:r.gridLineType}).build()).addSimpleSlice("gridLineStyle",new P.builder.DropdownBuilder({descriptor:s.gridLineStyle,value:r.gridLineStyle}).build(),function(e){return e.withDisabled(!t)}).addSimpleSlice("gridLineColor",new P.builder.ColorPickerBuilder({descriptor:s.gridLineColor,value:{value:r.gridLineColor}}).build(),function(e){return e.withDisabled(!t)}).addSimpleSlice("gridLineWidth",new P.builder.NumUpDownBuilder({descriptor:s.gridLineWidth,value:r.gridLineWidth,options:{minValue:{type:0,value:P.MultiplesLayoutMinGridlinesWidth},maxValue:{type:1,value:P.MultiplesLayoutMaxGridlinesWidth}}}).build(),function(e){return e.withDisabled(!t)})}),e.addGroup("title",function(e){e.withDisplayName("Title"),l.featureSwitches.smallMultiplesResponsive&&e.addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:n.show,value:!!l.showSubheaderCard()&&o.show}).build()});var t=o.fontProperties,i=(new P.builder.FontControlBuilder).withFontFamily({descriptor:n.fontFamily,value:t.family}).withFontSizeProperties({descriptor:n.fontSize,value:t.size.pt}),i=(l.featureSwitches.enableBIU&&i.withBold({descriptor:n.bold,value:o.labelBold}).withItalic({descriptor:n.italic,value:o.labelItalic}).withUnderline({descriptor:n.underline,value:o.labelUnderline}),i.build());e.addSimpleSlice("position",function(){var e;switch(o.vertical){default:case 0:e=P.verticalPosition.top;break;case 1:e=P.verticalPosition.bottom}return new P.builder.DropdownBuilder({descriptor:n.position,value:e}).build()}).addCompositeSlice("font","Font",i).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},n.fontColor),{instanceKind:3,selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},altConstantValueSelector:null}),value:{value:t.color}}).build()).addSimpleSlice("alignment",function(){var e;switch(o.horizontal){default:case 0:e=P.horizontalPosition.left;break;case 1:e=P.horizontalPosition.center;break;case 2:e=P.horizontalPosition.right}return new P.builder.AlignmentGroupBuilder({descriptor:n.alignment,value:e,mode:"horizontalAlignment"}).build()}),l.featureSwitches.smallMultiplesSubheaderFormatting&&e.addSimpleSlice("titleWrap",new P.builder.ToggleSwitchBuilder({descriptor:n.titleWrap,value:o.titleWrap}).build(),function(e){return e.withCustomDisplayName("TextWrap")})}),e.addGroup("background",function(e){e.withDisplayName("Visual_Background").addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},s.backgroundColor),{selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},altConstantValueSelector:null,instanceKind:3}),value:{value:r.backgroundColor},isNoFillItemSupported:!0}).build(),function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("transparency",P.builder.SliderBuilder.getTransparencySliderBuilder({descriptor:s.backgroundTransparency,value:r.backgroundTransparency,localize:a}).build(),function(e){return e.withCustomDisplayName("Transparency")})})):e.withDisabled(!0,"Visual_SmallMultipleCard_DisabledReason"),e.build()},f.getMultiplesSubheader=function(e,t){var e=A.DataViewObjects.getObject(e,"subheader"),i=P.MultiplesSubheaderDefaults(),a=P.ColorHelper.create(t),a=P.FontProperties.createFromObjectOrStyle(e,{family:"fontFamily",size:"fontSize",color:"fontColor",bold:"bold",italic:"italic",underline:"underline"},a,t,i.ColorName,i.TextClassName,{color:P.ColorHelper.getThemeColor(t,i.ColorName),size:P.Units.FontSize.createFromPt(i.FontPointSize),family:i.FontFamily,weight:g.normalValue,style:g.normalValue,textDecoration:g.noneValue}),t={top:0,bottom:2,left:5,right:0},r=a.size.px+t.top+t.bottom,o=i.Vertical,s=i.Horizontal,n=i.TitleWrap,i=i.Show,l=!1,c=!1,u=!1;if(e){switch(e.position){case P.verticalPosition.top:o=0;break;case P.verticalPosition.bottom:o=1}switch(e.alignment){case P.horizontalPosition.left:s=0;break;case P.horizontalPosition.center:s=1;break;case P.horizontalPosition.right:s=2}n=e.titleWrap,void 0!==e.show&&(i=e.show),void 0!==e.bold&&(l=e.bold),void 0!==e.italic&&(c=e.italic),void 0!==e.underline&&(u=e.underline)}return{fontProperties:a,show:i,height:r,margins:t,vertical:o,horizontal:s,titleWrap:n,labelBold:l,labelItalic:c,labelUnderline:u}},f.prototype.showSubheaderCard=function(){return this.isSmallMultiples()},f.prototype.enumerateSubheader=function(e){if(this.showSubheaderCard()){var t,i,a=f.getMultiplesSubheader(this.dataViews[0].metadata.objects,this.layerStyle);switch(a.horizontal){default:case 0:t=P.horizontalPosition.left;break;case 1:t=P.horizontalPosition.center;break;case 2:t=P.horizontalPosition.right}switch(a.vertical){default:case 0:i=P.verticalPosition.top;break;case 1:i=P.verticalPosition.bottom}var r={objectName:P.SmallMultiplesUtils.SubheaderObjectName,selector:null,properties:{}};this.featureSwitches.smallMultiplesResponsive&&(r.properties.show=a.show),r.properties.fontFamily=a.fontProperties.family,r.properties.fontSize=a.fontProperties.size.pt,e.pushInstance(r),r={objectName:P.SmallMultiplesUtils.SubheaderObjectName,selector:{data:[c.fromRoles([P.cartesianRoleNames.rows])]},properties:{fontColor:a.fontProperties.color},propertyInstanceKind:{fontColor:3},altConstantValueSelector:null},e.pushInstance(r,!1),r={objectName:P.SmallMultiplesUtils.SubheaderObjectName,selector:null,properties:{alignment:t,position:i}},this.featureSwitches.smallMultiplesSubheaderFormatting&&(r.properties.titleWrap=a.titleWrap),e.pushInstance(r,!1)}},f.getLayerDataViews=function(e){return _.isEmpty(e)?[]:_.filter(e,function(e){return!P.TrendLineHelper.isDataViewForRegression(e)&&!P.ForecastHelper.isDataViewForForecast(e)&&!P.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection(e)})},f.prototype.render=function(t,i,a){return __awaiter(this,void 0,A.Promise,function(){return __generator(this,function(e){return[2,this.layout.render(this.multiples,this.currentViewport,this.categoryLoadMoreDataHandler,this.background,this.axisZoom,this.trimOrdinalDataOnOverflow,t,3===this.categoryAxisRenderMode,i,this.formatMode,this.subSelectionHelper,a)]})})},f.prototype.updateWarnings=function(e){if(!_.isEmpty(this.dataViews)){var t=this.dataViews,i=P.getInvalidValueWarnings(t,!1,!1,!1,["Tooltips"],!0);if(_.isEmpty(i)||e.add.apply(e,i||[]),this.axes.addWarnings(e),this.multiples.checkIfNoLabelsCanBeRendered()){var i={selector:null,warnings:[new P.DataLabelsNotRenderedWarning]};e.addForVisualObject("labels",i)}else{e.removeForVisualObject("labels");for(var a=0,r=null==(i=this.multiples.getCoreMultiple())?void 0:i.layers;a<r.length;a++){var o=r[a];o.addWarnings&&o.addWarnings(e)}}for(var s=[],n=null==(i=this.cartesianVisualCapabilities)?void 0:i.supportsHierarchicalCategoryAxis,l=0,c=t;l<c.length;l++){var u=c[l];new h(u,n,this.featureSwitches.easierHierarchicalAxis).addObjectWarnings(s)}_.isEmpty(s)||(i=this.cartesianData.warningObjectCollection).addForVisualObject.apply(i,__spreadArray(["categoryAxis"],s,!1)),this.hostServices.setWarnings(this.cartesianData.warningObjectCollection.complete())}},f.prototype.update=function(i){return __awaiter(this,void 0,A.Promise,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.featureSwitches.onObject&&(t=this.multiples.isSmallMultiples(i.dataViews),this.formatMode&&t&&(this.subSelectionHelper.setFormatMode(!1),this.interactivityService.setFormatMode(!1),this.formatMode=!1),i.formatMode===this.formatMode||t||(this.subSelectionHelper.setFormatMode(i.formatMode),this.interactivityService.setFormatMode(i.formatMode),this.formatMode=i.formatMode)),null==i.resizeMode?[3,2]:[4,this.updateInternal(i)];case 1:return e.sent(),[3,4];case 2:return[4,this.updateInternal(i,null!=i.operationKind?i.operationKind:A.VisualDataChangeOperationKind.Create)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},f.prototype.destroy=function(){this.multiples&&this.multiples.clear(),this.layout&&this.layout.destroy(),this.axisZoom&&(this.axisZoom.destroy(),this.axisZoom=void 0)},f.prototype.onViewModeChanged=function(e){this.layout.viewMode=e},f.prototype.scrollTo=function(e){var t=this.layout.getVisibleMultiples();this.multiples.scrollTo(e,t)},f.prototype.scrollRowsTo=function(e){this.layout.scrollRowsTo(e)},f.prototype.enumerateObjectInstances=function(e){var t=new P.ObjectEnumerationBuilder,i=this.getLayers();if(e.objectName===P.SmallMultiplesUtils.LayoutObjectName)this.enumerateLayout(t);else if("subheader"===e.objectName)this.enumerateSubheader(t);else if("legend"===e.objectName){if(!this.shouldShowLegendCard())return;for(var a={enumeration:t,legendData:this.originalCartesianData.legendData},r=0,o=i;r<o.length;r++)(s=o[r]).enumerateCustomLegend?s.enumerateCustomLegend(a):P.Legend.enumerate(a,this.featureSwitches)}else"categoryAxis"===e.objectName&&this.axes.hasCategoryAxis()?this.enumerateCategoryAxis(t):"valueAxis"===e.objectName?this.enumerateValueAxis(t):"y2Axis"===e.objectName?this.enumerateValueAxis(t,"y2Axis"):e.objectName===P.ReferenceLineHelper.xAxisRefLineObjectName?(c=this.categoryAxisIsScalar().isScalar,P.CartesianChartConverter.supportsStaticReferenceLines(this.dataViews,i)&&c&&(0===this.type&&this.featureSwitches.lineChartVerticalReferenceLine||0!==this.type&&this.featureSwitches.xAxisRefLineImprovements)&&(c=f.getCategoryValueType(i),this.enumerateReferenceLines(t,e.objectName,c))):e.objectName===P.ReferenceLineHelper.y1AxisRefLineObjectName?this.enumerateReferenceLines(t,e.objectName):"referenceLine"===e.objectName?P.CartesianChartConverter.supportsDataBoundReferenceLines(this.dataViews,i)&&this.enumerateReferenceLines(t,e.objectName):"trend"===e.objectName?P.CartesianChartConverter.supportsTrendLines(this.dataViews,i)&&P.TrendLineHelper.enumerateObjectInstances(t,this.originalCartesianData.trendLines,this.layerStyle):"plotArea"===e.objectName?P.visualBackgroundHelper.enumeratePlot(t,this.background):"zoom"===e.objectName&&this.axisZoom.enumerateObjectInstances(t);if("dataPoint"===e.objectName&&P.ComboChart.isComboChart(this.type))P.ComboChart.enumerateDataPoints(t,e,i);else for(var s,n=0,l=i;n<l.length;n++)(s=l[n]).enumerateObjectInstances&&s.enumerateObjectInstances(t,e);var c=this.supportsResponsive();return this.dataViews&&this.dataViews[0]&&(i=this.dataViews[0],this.viewModelAdapterFactory)&&this.viewModelAdapterFactory.createCartesianAdapter({cartesianData:void 0,dataView:i,viewport:void 0,isCoreMultiple:void 0}).enumerateObjectInstances(e,t,c),this.smallMultiplesViewModelAdapter&&this.smallMultiplesViewModelAdapter.enumerateObjectInstances(e,t,c),t.complete()},f.prototype.getSelectorsByColumnSubSelection=function(e){for(var t=0,i=this.getLayers();t<i.length;t++){var a=i[t];if(a.getSelectorsByColumnFromSubselectedElement){a=a.getSelectorsByColumnFromSubselectedElement(e);if(a)return a}}return{}},f.prototype.getSubSelectionCustomOutlines=function(e){for(var t=0,i=this.getLayers();t<i.length;t++){var a=i[t];if(a.getSubSelectionCustomOutlines){a=a.getSubSelectionCustomOutlines(e);if(a)return a}}return[]},f.prototype.getSubSelectionCustomElements=function(e){for(var t=0,i=this.getLayers();t<i.length;t++){var a=i[t];if(a.getSubSelectionCustomElements){a=a.getSubSelectionCustomElements(e);if(a)return a}}return[]},f.prototype.getSubSelectionMetadata=function(e){for(var t=0,i=this.getLayers();t<i.length;t++){var a=i[t];if(a.getSubSelectionMetadata){a=a.getSubSelectionMetadata(e);if(a)return a}}return null},f.prototype.getSubSelectionStyles=function(e){if(this.featureSwitches.onObject){var t,i=_.first(e).visualObjects;if(0<i.length){null!=(i=i[0])&&i.selectorsByColumn&&(t=S.normalizeSelector(S.convertSelectorsByColumnToSelector(i.selectorsByColumn)));var a=1===this.getLayers().length&&this.cartesianData.legendData.dataPoints.length<=1;switch(i.objectName){case"legend-title":return P.Legend.getLegendTitleSubSelectionStyles();case"x-axis-zoom-slider":case"y1-axis-zoom-slider":case"y2-axis-zoom-slider":return;case"legend-items":return P.Legend.getLegendItemsSubSelectionStyles(this.hostServices);case"horizontal-gridlines":var r="".concat("Visual","-").concat("gridlines"),o="".concat("gridlines","-").concat("horizontal");return d.getShapeSubSelectionStyles(r,o,"".concat(o,"-color"),this.hostServices,!0);case"vertical-gridlines":r="".concat("Visual","-").concat("gridlines"),o="".concat("gridlines","-").concat("vertical");return d.getShapeSubSelectionStyles(r,o,"".concat(o,"-color"),this.hostServices,!0);case"series-labels":var r="".concat("Visual","-").concat("seriesLabels"),o="".concat("seriesLabels-applySettingsTo-series","--").concat("values"),s="".concat("seriesLabels-applySettingsTo-series","--").concat("background"),n={cardUid:r,groupUid:a?void 0:o,sliceUid:"".concat(o,"-font")},o={cardUid:r,groupUid:a?void 0:o,sliceUid:"".concat(o,"-seriesColor")},r={cardUid:r,groupUid:a?void 0:s,sliceUid:"".concat(s,"-backgroundColor")};return d.getFontOnlyTextSubSelectionStyles(this.hostServices,{fontReference:n,fontColorReference:o,backgroundReference:r},a?void 0:t);case"x-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(!1,!this.axes.isYAxisCategorical,this.hostServices);case"y1-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(!1,this.axes.isYAxisCategorical,this.hostServices);case"y2-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionStyles(!0,this.axes.isYAxisCategorical,this.hostServices);case"x-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(!1,!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y1-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(!1,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y2-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionStyles(!0,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);default:for(var l=0,c=this.getLayers();l<c.length;l++){var u=c[l];if(u.getSubSelectionStyles){u=u.getSubSelectionStyles(e);if(u)return u}}}}}},f.prototype.getSubSelectionShortcuts=function(e,t){if(this.featureSwitches.onObject&&!t){var i=_.first(e).visualObjects;if(0<i.length){var a,r=i[0],o=this.getLayers(),s=o.length<=1&&this.cartesianData.legendData.dataPoints.length<=1,n={key:"Delete",nextValue:!1};switch(s||_.isEmpty(r.selectorsByColumn)||(a=S.normalizeSelector(S.convertSelectorsByColumnToSelector(r.selectorsByColumn))),r.objectName){case"legend-title":return P.Legend.getLegendTitleShortcuts(this.hostServices);case"legend-items":return P.Legend.getLegendItemsShortcuts({hostServices:this.hostServices,showSort:!0});case"data-labels":var l=s?"".concat("Visual","-").concat("labels"):"".concat("labels-applySettingsTo-series","--showSeries");return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),selector:a,keyboardShortcuts:[n]},{type:0,excludedResetSourceUids:[{sourceUid:l,selector:a}]},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("labels")}],label:this.hostServices.getLocalizedString("Format_Data_Labels")}];case"horizontal-gridlines":l="".concat("gridlines","-").concat("horizontal");return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("gridlines"),groupUid:l}],label:this.hostServices.getLocalizedString("Format_Gridlines")}];case"vertical-gridlines":l="".concat("gridlines","-").concat("vertical");return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("gridlines"),groupUid:l}],label:this.hostServices.getLocalizedString("Format_Gridlines")}];case"series-labels":l=s?"".concat("Visual","-").concat("seriesLabels"):"".concat("seriesLabels","-").concat("applySettingsTo","-series--showSeries");return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),selector:a,keyboardShortcuts:[n]},{type:0,relatedResetSourceUids:[{sourceUid:"".concat("seriesLabels","-").concat("applySettingsTo","-series--").concat("background","-enableBackground"),selector:a}],excludedResetSourceUids:[{sourceUid:l,selector:a}]},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("seriesLabels")}],label:this.hostServices.getLocalizedString("Format_Series_Labels")}];case"total-labels":var l="".concat("Visual","-").concat("totals"),c="".concat("totals","-").concat("values");return[{type:2,sourceUid:l,disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0,excludedResetSourceUids:[{sourceUid:l}]},{type:1,destinationUids:[{cardUid:l,groupUid:c}],label:this.hostServices.getLocalizedString("Format_Total_Labels")}];case"x-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(!1,!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y1-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(!1,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"y2-axis-title":return P.CartesianChartOnObjectUtil.getAxisTitleSubSelectionShortcuts(!0,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.hostServices);case"x-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(!1,!this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"y1-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(!1,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"y2-axis-values":return P.CartesianChartOnObjectUtil.getAxisValuesSubSelectionShortcuts(!0,this.axes.isYAxisCategorical,this.categoryAxisIsScalar().isScalar,this.categoryAxisIsScalar().supportedType,this.hostServices);case"x-axis-zoom-slider":case"y1-axis-zoom-slider":case"y2-axis-zoom-slider":var l="".concat("Visual","-").concat("zoom"),c="".concat("zoom","-").concat("default"),u="".concat(c,"-labels"),d="".concat(c,"-tooltips"),h="y2-axis-zoom-slider"===r.objectName,p="x-axis-zoom-slider"===r.objectName,g="".concat(c,"-");return[{type:2,sourceUid:g+=h?"valueSecAxis":!!p==!!this.axes.isYAxisCategorical?"valueAxis":"categoryAxis",disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[n]},{type:0,excludedResetSourceUids:[{sourceUid:"".concat(c,"-valueSecAxis")}]},{type:2,sourceUid:u,enabledLabel:this.hostServices.getLocalizedString("Format_AddSliderLabels")},{type:2,sourceUid:d,enabledLabel:this.hostServices.getLocalizedString("Format_AddSliderTooltips")},{type:1,destinationUids:[{cardUid:l,groupUid:c}],label:this.hostServices.getLocalizedString("Format_ZoomSlider")}];default:for(var y=0,m=o;y<m.length;y++){var v=m[y];if(v.getSubSelectionShortcuts){v=v.getSubSelectionShortcuts(e,t);if(v)return v}}}}}},f.prototype.getSubSelectables=function(e){for(var t=this.subSelectionHelper.getAllSubSelectables(e),i=0,a=this.getLayers();i<a.length;i++){var r=a[i];r.getDisambiguationSubSelectables&&t.push.apply(t,r.getDisambiguationSubSelectables(this.subSelectionHelper,e))}return t},f.prototype.getNextSubSelectable=function(e,t){return this.subSelectionHelper.getNextSubSelectable(e,t)},f.prototype.getFormattingModel=function(){for(var r=this,e=function(e){for(var t,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];return(t=r.hostServices).getLocalizedString.apply(t,__spreadArray([e],i,!1))},t=!(13===this.type),i=new P.builder.FormattingModelBuilder(function(){return r.customizeFormattingCard(r.getCategoryAxisCard())},function(){return r.customizeFormattingCard(r.getValueAxisCard())},function(){return r.getSecondaryValueAxisCard()},function(){return r.getLegendCard()},function(){return r.getSmallMultiplesCard()},function(){return r.getGridlinesCard()},function(){return r.axisZoom.getZoomCard(t)}).build(),a=i&&i.cards?i.cards:[],o=this.getLayers(),s={categoryAxisData:this.originalCartesianData.axesData.categoryAxis},n=[],l=0,c=o;l<c.length;l++){var u=c[l];if(!u.getFormattingCards)return;n.push(u.getFormattingCards(s))}P.ComboChart.isComboChart(this.type),P.ComboChart.isComboChart(this.type)?(o=P.ComboChart.sortComboChartFormattingCards(P.ComboChart.mergeFormattingCards(n,this.type,e),this.type,this.featureSwitches.comboChartError),a.push.apply(a,o)):1===n.length&&a.push.apply(a,n[0].card);o=P.visualBackgroundHelper.getBackgroundCard(this.background,e);return o&&a.push(o),i},f.prototype.customizeFormattingCard=function(e){for(var t=e,i=0,a=this.getLayers();i<a.length;i++){var r=a[i];return t=r.customizeFormattingCard?r.customizeFormattingCard(e):t}},f.prototype.resolveFormattingPlaceholder=function(e){if(P.builder.isVisualFormattingSlicePlaceholder(e)){var t=e.name;if("responsive"===t)return this.getResponsiveSlice();for(var i=0,a=this.getLayers();i<a.length;i++){var r=a[i],r=r.resolveFormattingPlaceholder&&r.resolveFormattingPlaceholder(e);if(r)return r}}},f.prototype.getResponsiveSlice=function(){function e(e){return t.hostServices.getLocalizedString(e)}var t=this,i=this.supportsResponsive(),a=this.dataViews&&this.dataViews[0];if(a)return this.smallMultiplesViewModelAdapter?this.smallMultiplesViewModelAdapter.getResponsiveSlice(a,i,e):this.viewModelAdapterFactory?this.viewModelAdapterFactory.createCartesianAdapter({cartesianData:void 0,dataView:a,viewport:void 0,isCoreMultiple:void 0}).getResponsiveSlice(a,i,e):void 0},f.prototype.getCategoryAxisCard=function(){var a,o,s,r,e,n,l,t,i,c,u,d,h=this,p=this.axes;if(p.hasCategoryAxis())return a=function(e){return h.hostServices.getLocalizedString(e)},o=P.cartesianChartProps.categoryAxis,s=this.originalCartesianData.axesData.categoryAxis,e=(r=p.isYAxisCategorical)?"Visual_YAxis_Hyphen":"Visual_XAxis_Hyphen",(e=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("categoryAxis"),e,[o.show,o.axisType,o.start,o.end,o.fontFamily,o.fontSize,o.bold,o.italic,o.underline,o.labelColor,o.labelDisplayUnits,o.labelPrecision,o.maxMarginFactor,o.position,o.showAxisTitle,o.titleText,o.axisStyle,o.titleFontFamily,o.titleFontSize,o.titleBold,o.titleItalic,o.titleUnderline,o.titleColor,o.concatenateLabels,o.show,o.invertAxis,o.axisScale,o.logAxisScale,o.switchAxisPosition],a)).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:o.show,value:s.show}).build()}),i=this.categoryAxisIsScalar(),n=i.isScalar,i.supportedType===P.axisType.both&&e.addGroup("type",function(e){e.addSimpleSlice("type",new P.builder.DropdownBuilder({descriptor:o.axisType,value:n?P.axisType.scalar:P.axisType.categorical}).build())}),n&&e.addGroup("range",function(e){e.withDisplayName("Visual_Axis_Range");var t,i,a=_.filter(s.includeDomains,function(e){return _.includes(e.domainSources,10)}),a=P.AxisHelper.mergeScalarAxisDomains.apply(P.AxisHelper,a||[]),a=a&&a.domain||[void 0,void 0],r=a[0],a=a[1];p.isCategoryAxisDateTime()?(i=r&&A.FeatureSwitchedDate.fromTimeValue(h.featureSwitches.utcDates,r),t=a&&A.FeatureSwitchedDate.fromTimeValue(h.featureSwitches.utcDates,a),e.addSimpleSlice("min",new P.builder.DatePickerBuilder({descriptor:__assign(__assign({},o.start),{propertyTypes:{dateTime:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:i,placeholder:"",validators:{max:{type:1,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.DatePickerBuilder({descriptor:__assign(__assign({},o.end),{propertyTypes:{dateTime:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:t,placeholder:"",validators:{min:{type:0,value:i}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")})):e.addSimpleSlice("min",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},o.start),{propertyTypes:{numeric:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:r,options:{maxValue:{type:1,value:a}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},o.end),{propertyTypes:{numeric:!0},instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:a,options:{minValue:{type:0,value:r}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),h.featureSwitches.logAxisScale?e.addSimpleSlice("logAxisScale",new P.builder.ToggleSwitchBuilder({descriptor:o.logAxisScale,value:null!=(t=s.logAxisScale)?t:s.axisScale===P.axisScale.log}).build(),function(e){return e.withDisabled(!h.isLogAxisScaleAllowed(!1)).withCustomDescriptionIf(function(){return!h.isLogAxisScaleAllowed(!1)},"Visual_LogarithmicScaleDescription")}):(i=h.getAxisScaleOptions(!1),e.addSimpleSlice("axisType",new P.builder.DropdownBuilder({descriptor:o.axisScale,value:s.axisScale,filterValues:i}).build())),e.addSimpleSlice("invertAxis",new P.builder.ToggleSwitchBuilder({descriptor:o.invertAxis,value:s.invertAxis}).build(),function(e){return e.withCustomDisplayName("Visual_InvertRange")})}),l=s.labelFontProperties,t=s.titleFontProperties,i=(new P.builder.FontControlBuilder).withFontFamily({descriptor:o.fontFamily,value:l.family}).withFontSizeProperties({descriptor:o.fontSize,value:l.size.pt}),c=(new P.builder.FontControlBuilder).withFontFamily({descriptor:o.titleFontFamily,value:t.family}).withFontSizeProperties({descriptor:o.titleFontSize,value:t.size.pt}),this.featureSwitches.enableBIU&&(i.withBold({descriptor:o.bold,value:l.weight===g.boldValue}).withItalic({descriptor:o.italic,value:l.style===g.italicValue}).withUnderline({descriptor:o.underline,value:l.textDecoration===g.underlineValue}),c.withBold({descriptor:o.titleBold,value:t.weight===g.boldValue}).withItalic({descriptor:o.titleItalic,value:t.style===g.italicValue}).withUnderline({descriptor:o.titleUnderline,value:t.textDecoration===g.underlineValue})),u=i.build(),d=c.build(),e.addGroup(n?"valuesScalar":"values",function(e){var t,i;e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",u).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},o.labelColor),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:{value:l.color}}).build()),n?e.addSimpleSlice("displayUnits",new P.builder.DropdownBuilder({descriptor:o.labelDisplayUnits,value:s.labelDisplayUnits}).build(),function(e){return e.withAliasName("Decimal")}).addSimpleSlice("precision",new P.builder.NumUpDownBuilder({descriptor:o.labelPrecision,value:s.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:P.DataLabelViewModel.MaxLabelPrecision}}}).build()):(i=r?"Visual_Max_AreaWidth":"Visual_Max_AreaHeight",e.addSimpleSlice(r?"maxAreaWidth":"maxAreaHeight",new P.builder.SliderBuilder({descriptor:o.maxMarginFactor,value:Math.round(100*s.maxMarginFactor),options:{minValue:{type:0,value:15},maxValue:{type:1,value:50},unitSymbol:P.visualLocKeys.PercentLocKey},localize:a}).build(),function(e){return e.withCustomDisplayName(i)})),r&&(h.featureSwitches.switchAxisPosition?e.addSimpleSlice("switchAxisPosition",new P.builder.ToggleSwitchBuilder({descriptor:o.switchAxisPosition,value:s.switchAxisPosition}).build(),function(e){return e.withCustomDisplayName("Visual_SwitchAxisPosition")}):e.addSimpleSlice("position",new P.builder.DropdownBuilder({descriptor:o.position,value:s.position}).build())),null!=(t=h.cartesianVisualCapabilities)&&t.supportsHierarchicalCategoryAxis&&!n&&e.addSimpleSlice("concatenateLabels",new P.builder.ToggleSwitchBuilder({descriptor:o.concatenateLabels,value:s.concatenateLabels}).build())}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:o.showAxisTitle,value:s.showAxisTitle}).build()}).addSimpleSlice("text",new P.builder.TextInputBuilder({descriptor:o.titleText,value:s.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=p.categoryAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly];return new P.builder.DropdownBuilder({descriptor:o.axisStyle,value:s.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",d).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},o.titleColor),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:{value:t.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),e.build()},f.prototype.getValueAxisCard=function(){var a,r,o,t,i,s,e,n,l,c,u=this,d=null==(d=this.originalCartesianData)?void 0:d.axesData;if(d&&d.isValueAxisSet&&!d.isValueAxisDisabled&&9!==this.type)return a=this.axes,r=P.cartesianChartProps.valueAxis,o=this.originalCartesianData.axesData.valueAxis,d=(t=a.isYAxisCategorical)?"Visual_XAxis_Hyphen":"Visual_YAxis_Hyphen",d=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("valueAxis"),d,[r.show,r.start,r.end,r.axisScale,r.invertAxis,r.sharedAxis,r.scaleToFit,r.fontFamily,r.fontSize,r.bold,r.italic,r.underline,r.labelColor,r.labelDisplayUnits,r.labelPrecision,r.position,r.showAxisTitle,r.titleText,r.axisStyle,r.titleFontFamily,r.titleFontSize,r.titleBold,r.titleItalic,r.titleUnderline,r.titleColor,r.logAxisScale,r.switchAxisPosition],function(e){return u.hostServices.getLocalizedString(e)}),i=o.labelFontProperties,s=o.titleFontProperties,e=(new P.builder.FontControlBuilder).withFontFamily({descriptor:r.fontFamily,value:i.family}).withFontSizeProperties({descriptor:r.fontSize,value:i.size.pt}),n=(new P.builder.FontControlBuilder).withFontFamily({descriptor:r.titleFontFamily,value:s.family}).withFontSizeProperties({descriptor:r.titleFontSize,value:s.size.pt}),this.featureSwitches.enableBIU&&(e.withBold({descriptor:r.bold,value:o.labelBold}).withItalic({descriptor:r.italic,value:o.labelItalic}).withUnderline({descriptor:r.underline,value:o.labelUnderline}),n.withBold({descriptor:r.titleBold,value:o.titleBold}).withItalic({descriptor:r.titleItalic,value:o.titleItalic}).withUnderline({descriptor:r.titleUnderline,value:o.titleUnderline})),l=e.build(),c=n.build(),d.addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:r.show,value:o.show}).build()}).addGroup("range",function(e){var t=_.filter(o.includeDomains,function(e){return _.includes(e.domainSources,10)}),t=P.AxisHelper.mergeScalarAxisDomains.apply(P.AxisHelper,t||[]),t=t&&t.domain||[void 0,void 0],i=t[0],t=t[1];e.withDisplayName("Visual_Axis_Range").withInheritDisabled(!1).addSimpleSlice("min",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},r.start),{propertyTypes:{numeric:!0},instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:i,options:{maxValue:{type:1,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},r.end),{propertyTypes:{numeric:!0},instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:t,options:{minValue:{type:0,value:i}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),13!==u.type&&(u.featureSwitches.logAxisScale?e.addSimpleSlice("logAxisScale",new P.builder.ToggleSwitchBuilder({descriptor:r.logAxisScale,value:o.logAxisScale}).build(),function(e){return e.withDisabled(!u.isLogAxisScaleAllowed(!0)).withCustomDescriptionIf(function(){return!u.isLogAxisScaleAllowed(!0)},"Visual_LogarithmicScaleDescription")}):(t=u.getAxisScaleOptions(!0),e.addSimpleSlice("axisType",new P.builder.DropdownBuilder({descriptor:r.axisScale,value:o.axisScale,filterValues:t}).build()))),e.addSimpleSlice("invertAxis",new P.builder.ToggleSwitchBuilder({descriptor:r.invertAxis,value:o.invertAxis}).build(),function(e){return e.withCustomDisplayName("Visual_InvertRange")}),u.isSmallMultiples()&&u.featureSwitches.smallMultiplesUnsharedAxes&&e.addSimpleSlice("sharedAxis",new P.builder.ToggleSwitchBuilder({descriptor:r.sharedAxis,value:o.sharedAxis}).build(),function(e){a.isYAxisCategorical&&e.withCustomDisplayName("Visual_Shared_XAxis")}).addSimpleSlice("scaleToFit",new P.builder.ToggleSwitchBuilder({descriptor:r.scaleToFit,value:o.scaleToFit}).build(),function(e){return e.withDisabled(o.sharedAxis)})}).addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",l).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},r.labelColor),{instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:{value:i.color}}).build()),7!==u.type&&8!==u.type&&e.addSimpleSlice("displayUnits",new P.builder.DropdownBuilder({descriptor:r.labelDisplayUnits,value:o.labelDisplayUnits}).build(),function(e){return e.withAliasName("Decimal")}).addSimpleSlice("precision",new P.builder.NumUpDownBuilder({descriptor:r.labelPrecision,value:o.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:P.DataLabelViewModel.MaxLabelPrecision}}}).build()),t||(u.featureSwitches.switchAxisPosition?e.addSimpleSlice("switchAxisPosition",new P.builder.ToggleSwitchBuilder({descriptor:r.switchAxisPosition,value:o.switchAxisPosition}).build(),function(e){return e.withCustomDisplayName("Visual_SwitchAxisPosition")}):e.addSimpleSlice("position",new P.builder.DropdownBuilder({descriptor:r.position,value:o.position}).build()))}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:r.showAxisTitle,value:o.showAxisTitle}).build()}).addSimpleSlice("text",new P.builder.TextInputBuilder({descriptor:r.titleText,value:o.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=a.valueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly];return new P.builder.DropdownBuilder({descriptor:r.axisStyle,value:o.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",c).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},r.titleColor),{instanceKind:u.featureSwitches.expressionBasedFormatting?3:1}),value:{value:s.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),d.build()},f.prototype.getSecondaryValueAxisCard=function(){var e,t,a,i,r,o,s,n,l,c,u,d,h=this,p=null==(p=this.originalCartesianData)?void 0:p.axesData;if(p&&p.isValueAxisSet&&!p.isValueAxisDisabled){switch(this.type){case 0:case 1:e=!0,t=P.cartesianChartProps.y2Axis.show,a=P.cartesianChartProps.y2Axis;break;case 14:case 15:case 16:case 17:e=!0,t=P.cartesianChartProps.valueAxis.secShow,a=P.cartesianChartProps.valueAxis;break;default:e=!1}if(e)return i=this.axes,r=this.originalCartesianData.axesData,o=r.y2,p=new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("y2Axis"),"Visual_Y2Axis_Hyphen",__assign(__assign({},a),{alignZeros:P.cartesianChartProps.valueAxis.alignZeros}),function(e){return h.hostServices.getLocalizedString(e)}),s=o.labelFontProperties,n=o.titleFontProperties,l=(new P.builder.FontControlBuilder).withFontFamily({descriptor:a.secFontFamily,value:s.family}).withFontSizeProperties({descriptor:a.secFontSize,value:s.size.pt}),c=(new P.builder.FontControlBuilder).withFontFamily({descriptor:a.secTitleFontFamily,value:n.family}).withFontSizeProperties({descriptor:a.secTitleFontSize,value:n.size.pt}),this.featureSwitches.enableBIU&&(l.withBold({descriptor:a.secBold,value:o.labelBold}).withItalic({descriptor:a.secItalic,value:o.labelItalic}).withUnderline({descriptor:a.secUnderline,value:o.labelUnderline}),c.withBold({descriptor:a.secTitleBold,value:o.titleBold}).withItalic({descriptor:a.secTitleItalic,value:o.titleItalic}).withUnderline({descriptor:a.secTitleUnderline,value:o.titleUnderline})),u=l.build(),d=c.build(),p.addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:t,value:o.show}).build()}).addGroup("range",function(e){var t=_.filter(o.includeDomains,function(e){return _.includes(e.domainSources,10)}),t=P.AxisHelper.mergeScalarAxisDomains.apply(P.AxisHelper,t||[]),t=t&&t.domain||[void 0,void 0],i=t[0],t=t[1];e.withDisplayName("Visual_Axis_Range").addSimpleSlice("min",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},a.secStart),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:i,options:{maxValue:{type:1,value:t}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MinValue")}).addSimpleSlice("max",new P.builder.NumUpDownBuilder({descriptor:__assign(__assign({},a.secEnd),{instanceKind:h.featureSwitches.expressionBasedFormatting?3:1}),value:t,options:{minValue:{type:0,value:i}}}).build(),function(e){return e.withCustomDisplayName("Visual_Gradient_MaxValue")}),h.featureSwitches.logAxisScale?e.addSimpleSlice("logAxisScale",new P.builder.ToggleSwitchBuilder({descriptor:a.secLogAxisScale,value:o.logAxisScale}).build(),function(e){return e.withDisabled(!h.isLogAxisScaleAllowed(!0,!0)).withCustomDescriptionIf(function(){return!h.isLogAxisScaleAllowed(!0,!0)},"Visual_LogarithmicScaleDescription")}):(t=h.getAxisScaleOptions(!0,!0),e.addSimpleSlice("axisType",new P.builder.DropdownBuilder({descriptor:a.secAxisScale,value:o.axisScale,filterValues:t}).build())),P.ComboChart.isComboChart(h.type)&&e.addSimpleSlice("alignZeroes",new P.builder.ToggleSwitchBuilder({descriptor:P.cartesianChartProps.valueAxis.alignZeros,value:r.valueAxis.alignZeros}).build())}).addGroup("values",function(e){e.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",u).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:a.secLabelColor,value:{value:s.color}}).build()),7!==h.type&&8!==h.type&&e.addSimpleSlice("displayUnits",new P.builder.DropdownBuilder({descriptor:a.secLabelDisplayUnits,value:o.labelDisplayUnits}).build(),function(e){return e.withAliasName("Decimal")}).addSimpleSlice("precision",new P.builder.NumUpDownBuilder({descriptor:a.secLabelPrecision,value:o.labelPrecision,options:{minValue:{type:0,value:0},maxValue:{type:1,value:P.DataLabelViewModel.MaxLabelPrecision}}}).build())}).addGroup("title",function(e){e.withDisplayName("Visual_Title").withInheritDisabled(!1).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:a.secShowAxisTitle,value:o.showAxisTitle}).build()}).addSimpleSlice("text",new P.builder.TextInputBuilder({descriptor:a.secTitleText,value:o.titleText,placeholder:""}).build(),function(e){return e.withCustomDisplayName("Visual_Title_Text")}).addSimpleSlice("style",function(){var e=i.valueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly];return new P.builder.DropdownBuilder({descriptor:a.secAxisStyle,value:o.axisStyle,filterValues:e}).build()}).addCompositeSlice("font","Font",d).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:a.secTitleColor,value:{value:n.color}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")})}),p.build()}},f.prototype.getLegendCard=function(){for(var e={legendData:this.originalCartesianData.legendData},t=0,i=this.getLayers();t<i.length;t++){var a=i[t];a.customizeLegendFormattingModelOptions&&(e=a.customizeLegendFormattingModelOptions(e))}var r=this.featureSwitches.onObject?"Visual_LegendCard_DisabledReasonNew":14===this.type?"Visual_LegendCard_ComboLineClustered_DisabledReason":15===this.type?"Visual_LegendCard_ComboLineStacked_DisabledReason":"Visual_LegendCard_DisabledReason";return P.Legend.getLegendFormattingModel(e,this.hostServices,this.featureSwitches,!this.shouldShowLegendCard(),r)},f.prototype.getGridlinesCard=function(){var t,i,a,r,o=this,e=this.axes,s=e.hasCategoryAxis(),e=e.isYAxisCategorical,n=this.originalCartesianData.axesData,l=3===this.categoryAxisRenderMode,l=this.categoryAxisIsScalar().isScalar||l,s=(e?(t=P.cartesianChartProps.categoryAxis,i=n.categoryAxis,s&&(a=P.cartesianChartProps.valueAxis,9!==this.type)&&(r=n.valueAxis)):(t=P.cartesianChartProps.valueAxis,9!==this.type&&(i=n.valueAxis),s&&13!==this.type&&(a=P.cartesianChartProps.categoryAxis,r=n.categoryAxis)),new P.builder.FormattingCardBuilder(new P.builder.FormattingCardUidBuilder("gridlines"),"Visual_Gridline_Show",[P.cartesianChartProps.categoryAxis.gridlineShow,P.cartesianChartProps.categoryAxis.gridlineStyle,P.cartesianChartProps.categoryAxis.gridlineColor,P.cartesianChartProps.categoryAxis.gridlineThickness,P.cartesianChartProps.valueAxis.gridlineShow,P.cartesianChartProps.valueAxis.gridlineStyle,P.cartesianChartProps.valueAxis.gridlineColor,P.cartesianChartProps.valueAxis.gridlineThickness],function(e){return o.hostServices.getLocalizedString(e)}));return 9!==this.type||l?((i&&!e||e&&l)&&s.addGroup("horizontal",function(e){return c(e,t,i,"Visual_LabelOrientation_Horizontal",o.featureSwitches)}),(r&&e||!e&&l)&&s.addGroup("vertical",function(e){return c(e,a,r,"Visual_LabelOrientation_Vertical",o.featureSwitches)})):s.withDisabled(!0,"Visual_Ribbon_Chart_Gridlines_DisabledReason"),s.build();function c(e,t,i,a,r){e.withDisplayName(a).addTopLevelToggle("show",function(){return new P.builder.ToggleSwitchBuilder({descriptor:t.gridlineShow,value:!!i.show&&i.gridlineShow}).build()},function(e){return e.withDisabled(!i.show)}).addSimpleSlice("style",new P.builder.DropdownBuilder({descriptor:t.gridlineStyle,value:i.gridlineStyle}).build(),function(e){return e.withCustomDisplayName("Style")}).addSimpleSlice("color",new P.builder.ColorPickerBuilder({descriptor:__assign(__assign({},t.gridlineColor),{instanceKind:r.expressionBasedFormatting?3:1}),value:{value:i.gridlineColor}}).build(),function(e){return e.withCustomDisplayName("Generic_Color")}).addSimpleSlice("width",new P.builder.NumUpDownBuilder({descriptor:t.gridlineThickness,value:i.gridlineThickness,options:{minValue:{type:0,value:1},maxValue:{type:1,value:4},unitSymbol:P.visualLocKeys.PixelUnitSymbol}}).build(),function(e){return e.withCustomDisplayName("Visual_General_Properties_Width")})}},f.prototype.getTelemetryInformation=function(){for(var e,t={},i=(this.isSmallMultiples()&&(e=f.getMultiplesLayout(this.dataViews[0].metadata.objects,this.layerStyle),t.smallMultiples={layout:{type:e.layoutType,rows:e.rowCount,columns:e.columnCount}}),this.getLayers()),a=0;a<i.length;a++){var r=i[a];_.isFunction(r.getTelemetryInformation)&&(r=r.getTelemetryInformation())&&(t[a.toString()]=r)}if(!_.isEmpty(t))return t},f.prototype.getLayers=function(){var e=this.multiples.getCoreMultiple();return 1&e.getState()?e.layers:[]},f.prototype.enumerateReferenceLines=function(e,t,i){var a=P.ColorHelper.getDataColorByIndex(this.layerStyle,0,P.ForegroundColorName),r=_.filter(this.originalCartesianData.referenceLines,function(e){return e.type===t});P.ReferenceLineHelper.enumerateObjectInstances(e,r,a,t,this.originalCartesianData.axesData.isValueAxisDisabled,i,this.featureSwitches)},f.prototype.shouldShowLegendCard=function(){var e,t=null==(e=this.multiples.getCoreMultiple())?void 0:e.layers,i=this.dataViews;if(this.cartesianData.legendData.isGradientLegend)return!0;if(t&&i)for(var a=t.length,r=0,o=0;o<a;o++){if(t[o].hasLegend())return!0;var s=i[o];if(s&&s.categorical&&s.categorical.values&&0<s.categorical.values.length&&1<++r)return!0}return!1},f.prototype.getAxisScaleOptions=function(e,t){void 0===t&&(t=!1);var i=this.axes.isYAxisCategorical,e=(e=void 0===e?!1:e)?i?0:t?2:1:i?1:0,t=[P.DEFAULT_AXIS_SCALE_TYPE];return this.axes.isLogScaleAllowed(e)&&t.push(P.axisScale.log),t},f.prototype.isLogAxisScaleAllowed=function(e,t){void 0===t&&(t=!1);var i=this.axes.isYAxisCategorical,e=(e=void 0===e?!1:e)?i?0:t?2:1:i?1:0;return this.axes.isLogScaleAllowed(e)},f.prototype.categoryAxisIsScalar=function(){var e=this.originalCartesianData.axesData.categoryAxis,t=3===this.categoryAxisRenderMode?P.axisType.categorical:P.axisType.both,i=!1,a=null==(a=this.multiples.getCoreMultiple())?void 0:a.layers;return{isScalar:i=t===P.axisType.both&&a&&a[0].getSupportedCategoryAxisType?(t=a[0].getSupportedCategoryAxisType())===P.axisType.scalar||(i=P.CartesianHelper.isScalar(t===P.axisType.both,e))&&(a&&a[0].getVisualCategoryAxisIsScalar?a[0].getVisualCategoryAxisIsScalar():0===this.categoryAxisRenderMode):i,supportedType:t}},f.prototype.enumerateCategoryAxis=function(e){var t,i,a,r,o,s,n,l,c=this;this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isCategoryAxisSet&&(t=this.originalCartesianData.axesData.categoryAxis,i=P.cartesianChartProps.categoryAxis,a=3===this.categoryAxisRenderMode,r=(s=this.categoryAxisIsScalar()).isScalar,s=s.supportedType,(o={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:this.getAxisScaleOptions(!1),axisStyle:this.axes.categoryAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly]},propertyTypes:{},propertyInstanceKind:{start:this.featureSwitches.expressionBasedFormatting?3:1,end:this.featureSwitches.expressionBasedFormatting?3:1,titleColor:this.featureSwitches.expressionBasedFormatting?3:1,gridlineColor:this.featureSwitches.expressionBasedFormatting?3:1,labelColor:this.featureSwitches.expressionBasedFormatting?3:1}}).properties[i.show.propertyName]=t.show,this.axes.isYAxisCategorical&&(this.featureSwitches.switchAxisPosition?o.properties[i.switchAxisPosition.propertyName]=t.switchAxisPosition:o.properties[i.position.propertyName]=t.position),s===P.axisType.both&&(o.properties[i.axisType.propertyName]=r?P.axisType.scalar:P.axisType.categorical),r&&(this.featureSwitches.logAxisScale&&this.isLogAxisScaleAllowed(!1)?o.properties[i.logAxisScale.propertyName]=null!=(s=t.logAxisScale)?s:t.axisScale===P.axisScale.log:o.properties[i.axisScale.propertyName]=t.axisScale,s=_.filter(t.includeDomains,function(e){return _.includes(e.domainSources,10)}),l=(s=(s=P.AxisHelper.mergeScalarAxisDomains.apply(P.AxisHelper,s||[]))&&s.domain||[void 0,void 0])[0],s=s[1],o.properties[i.start.propertyName]=l,o.properties[i.end.propertyName]=s,o.properties[i.invertAxis.propertyName]=t.invertAxis),o.properties[i.labelColor.propertyName]=P.AxisDataModel.toColorFill(t.labelFontProperties.color),o.properties[i.fontSize.propertyName]=t.labelFontProperties.size.pt,o.properties[i.fontFamily.propertyName]=t.labelFontProperties.family,this.featureSwitches.enableBIU&&(o.properties[i.bold.propertyName]=t.labelBold,o.properties[i.italic.propertyName]=t.labelItalic,o.properties[i.underline.propertyName]=t.labelUnderline),r&&(o.properties[i.labelDisplayUnits.propertyName]=t.labelDisplayUnits,o.properties[i.labelPrecision.propertyName]=t.labelPrecision,l={numberRange:{min:0,max:P.DataLabelViewModel.MaxLabelPrecision}},o.validValues[i.labelPrecision.propertyName]=l),this.axes.isCategoryAxisDateTime()?(o.propertyTypes[i.start.propertyName]={dateTime:!0},o.propertyTypes[i.end.propertyName]={dateTime:!0}):(o.propertyTypes[i.start.propertyName]={numeric:!0},o.propertyTypes[i.end.propertyName]={numeric:!0}),r||(o.properties[i.preferredCategoryWidth.propertyName]=t.preferredCategoryWidth,o.properties[i.maxMarginFactor.propertyName]=Math.round(100*t.maxMarginFactor),o.validValues[i.maxMarginFactor.propertyName]={numberRange:{min:15,max:50},unitSymbol:P.visualLocKeys.PercentLocKey},9!==this.type&&(n=t.innerPadding,o.properties[i.innerPadding.propertyName]=void 0!==n?Math.round(100*n):void 0,o.validValues[i.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:P.visualLocKeys.PercentLocKey})),_.find([9,10],function(e){return e===c.type})||(n=t.innerPadding,o.properties[i.innerPadding.propertyName]=void 0!==n?Math.round(100*n):void 0,o.validValues[i.innerPadding.propertyName]={numberRange:{min:0,max:50},unitSymbol:P.visualLocKeys.PercentLocKey}),null!=(s=this.cartesianVisualCapabilities)&&s.supportsHierarchicalCategoryAxis&&!r&&(l=i.concatenateLabels.propertyName,o.properties[l]=t.concatenateLabels),o.properties[i.showAxisTitle.propertyName]=t.showAxisTitle,o.properties[i.showAxisTitle.propertyName]&&(o.properties[i.axisStyle.propertyName]=t.axisStyle,o.properties[i.titleColor.propertyName]=P.AxisDataModel.toColorFill(t.titleFontProperties.color),o.properties[i.titleText.propertyName]=t.titleText,o.properties[i.titleFontSize.propertyName]=t.titleFontProperties.size.pt,o.properties[i.titleFontFamily.propertyName]=t.titleFontProperties.family,this.featureSwitches.enableBIU)&&(o.properties[i.titleBold.propertyName]=t.titleBold,o.properties[i.titleItalic.propertyName]=t.titleItalic,o.properties[i.titleUnderline.propertyName]=t.titleUnderline),(r||a)&&(o.properties[i.gridlineShow.propertyName]=t.gridlineShow,t.gridlineShow)&&(o.properties[i.gridlineColor.propertyName]=P.AxisDataModel.toColorFill(t.gridlineColor),o.properties[i.gridlineThickness.propertyName]=t.gridlineThickness,o.validValues.gridlineThickness=["1","2","3","4"],o.properties[i.gridlineStyle.propertyName]=t.gridlineStyle),e.pushInstance(o))},f.prototype.enumerateValueAxis=function(e,t){var i,a,r,o,s,n;void 0===t&&(t="valueAxis"),this.originalCartesianData&&this.originalCartesianData.axesData&&this.originalCartesianData.axesData.isValueAxisSet&&!this.originalCartesianData.axesData.isValueAxisDisabled&&("y2Axis"===t&&2===this.type||(i={numberRange:{min:0,max:P.DataLabelViewModel.MaxLabelPrecision}},s=this.originalCartesianData.axesData.valueAxis,n="y2Axis"===t,a=P.cartesianChartProps.valueAxis,t={selector:null,properties:{},objectName:t,validValues:{axisScale:this.getAxisScaleOptions(!0),secAxisScale:this.getAxisScaleOptions(!0,!0),axisStyle:this.axes.valueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly],secAxisStyle:this.axes.secondaryValueAxisHasUnitType?[P.axisStyle.showTitleOnly,P.axisStyle.showUnitOnly,P.axisStyle.showBoth]:[P.axisStyle.showTitleOnly]},propertyTypes:{},propertyInstanceKind:{start:this.featureSwitches.expressionBasedFormatting?3:1,end:this.featureSwitches.expressionBasedFormatting?3:1,titleColor:this.featureSwitches.expressionBasedFormatting?3:1,gridlineColor:this.featureSwitches.expressionBasedFormatting?3:1,labelColor:this.featureSwitches.expressionBasedFormatting?3:1,secStart:this.featureSwitches.expressionBasedFormatting?3:1,secEnd:this.featureSwitches.expressionBasedFormatting?3:1}},n||(t.properties[a.show.propertyName]=s.show,t.properties[a.axisLabel.propertyName]=s.axisLabel,this.axes.isYAxisCategorical||(this.featureSwitches.switchAxisPosition?t.properties[a.switchAxisPosition.propertyName]=s.switchAxisPosition:t.properties[a.position.propertyName]=s.position),this.featureSwitches.logAxisScale&&this.isLogAxisScaleAllowed(!0)?t.properties[a.logAxisScale.propertyName]=s.logAxisScale:t.properties[a.axisScale.propertyName]=s.axisScale,o=_.filter(s.includeDomains,function(e){return _.includes(e.domainSources,10)}),r=(o=(o=P.AxisHelper.mergeScalarAxisDomains.apply(P.AxisHelper,o||[]))&&o.domain||[void 0,void 0])[0],o=o[1],t.properties[a.start.propertyName]=r,t.properties[a.end.propertyName]=o,t.propertyTypes[a.start.propertyName]={numeric:!0},t.propertyTypes[a.end.propertyName]={numeric:!0},t.properties[a.invertAxis.propertyName]=s.invertAxis,t.properties[a.labelColor.propertyName]=P.AxisDataModel.toColorFill(s.labelFontProperties.color),t.properties[a.fontSize.propertyName]=s.labelFontProperties.size.pt,t.properties[a.fontFamily.propertyName]=s.labelFontProperties.family,this.featureSwitches.enableBIU&&(t.properties[a.bold.propertyName]=s.labelBold,t.properties[a.italic.propertyName]=s.labelItalic,t.properties[a.underline.propertyName]=s.labelUnderline),7!==this.type&&8!==this.type&&(t.properties[a.labelDisplayUnits.propertyName]=s.labelDisplayUnits,t.properties[a.labelPrecision.propertyName]=s.labelPrecision,t.validValues[a.labelPrecision.propertyName]=i),this.featureSwitches.waterfallTotals&&13===this.type&&!this.hasBreakdownRole()&&(t.properties[a.totalsEnabled.propertyName]=s.totalsEnabled),t.properties[a.showAxisTitle.propertyName]=s.showAxisTitle,t.properties[a.showAxisTitle.propertyName]&&(t.properties[a.axisStyle.propertyName]=s.axisStyle,t.properties[a.titleColor.propertyName]=P.AxisDataModel.toColorFill(s.titleFontProperties.color),t.properties[a.titleText.propertyName]=s.titleText,t.properties[a.titleFontSize.propertyName]=s.titleFontProperties.size.pt,t.properties[a.titleFontFamily.propertyName]=s.titleFontProperties.family,this.featureSwitches.enableBIU)&&(t.properties[a.titleBold.propertyName]=s.titleBold,t.properties[a.titleItalic.propertyName]=s.titleItalic,t.properties[a.titleUnderline.propertyName]=s.titleUnderline),t.properties[a.gridlineShow.propertyName]=s.gridlineShow,s.gridlineShow&&(t.properties[a.gridlineColor.propertyName]=P.AxisDataModel.toColorFill(s.gridlineColor),t.properties[a.gridlineThickness.propertyName]=s.gridlineThickness,t.validValues.gridlineThickness=["1","2","3","4"],t.properties[a.gridlineStyle.propertyName]=s.gridlineStyle)),r=this.originalCartesianData.axesData.y2,n?t.properties[a.show.propertyName]=r.show:t.properties[a.secShow.propertyName]=r.show,(o=n||P.ComboChart.isComboChart(this.type)&&r.show)&&!n&&(t.properties[a.alignZeros.propertyName]=s.alignZeros,t.properties.secAxisLabel=""),n=_.filter(r.includeDomains,function(e){return _.includes(e.domainSources,10)}),s=(n=(s=P.AxisHelper.mergeScalarAxisDomains.apply(P.AxisHelper,n||[]))&&s.domain||[void 0,void 0])[0],n=n[1],t.properties[a.secStart.propertyName]=s,t.properties[a.secEnd.propertyName]=n,t.propertyTypes[a.secStart.propertyName]={numeric:!0},t.propertyTypes[a.secEnd.propertyName]={numeric:!0},o&&(t.properties[a.secInvertAxis.propertyName]=r.invertAxis,this.featureSwitches.logAxisScale&&this.isLogAxisScaleAllowed(!0,!0)?t.properties[a.secLogAxisScale.propertyName]=r.logAxisScale:t.properties[a.secAxisScale.propertyName]=r.axisScale,t.properties[a.secLabelColor.propertyName]=P.AxisDataModel.toColorFill(r.labelFontProperties.color),t.properties[a.secFontSize.propertyName]=r.labelFontProperties.size.pt,t.properties[a.secFontFamily.propertyName]=r.labelFontProperties.family,this.featureSwitches.enableBIU&&(t.properties[a.secBold.propertyName]=r.labelBold,t.properties[a.secItalic.propertyName]=r.labelItalic,t.properties[a.secUnderline.propertyName]=r.labelUnderline),t.properties[a.secLabelDisplayUnits.propertyName]=r.labelDisplayUnits,t.properties[a.secLabelPrecision.propertyName]=r.labelPrecision,t.validValues[a.secLabelPrecision.propertyName]=i),t.properties[a.secShowAxisTitle.propertyName]=r.showAxisTitle,o&&t.properties[a.secShowAxisTitle.propertyName]&&(t.properties[a.secAxisStyle.propertyName]=r.axisStyle,t.properties[a.secTitleColor.propertyName]=P.AxisDataModel.toColorFill(r.titleFontProperties.color),t.properties[a.secTitleText.propertyName]=r.titleText,t.properties[a.secTitleFontSize.propertyName]=r.titleFontProperties.size.pt,this.featureSwitches.enableBIU&&(t.properties[a.secTitleBold.propertyName]=r.titleBold,t.properties[a.secTitleItalic.propertyName]=r.titleItalic,t.properties[a.secTitleUnderline.propertyName]=r.titleUnderline),t.properties[a.secTitleFontFamily.propertyName]=r.titleFontProperties.family),e.pushInstance(t)))},f.prototype.onClearSelection=function(){this.hasSetData&&this.multiples.clearSelection(this.layout.getVisibleMultiples())},f.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},f.prototype.createLayers=function(){return this.layerFactory.createLayers({type:this.type,interactivityService:this.interactivityService,isScrollable:this.axes.isScrollable,tooltipsEnabled:this.tooltipsEnabled,featureSwitches:this.featureSwitches})},f.prototype.getLayerRendererInitOptions=function(e){var t=this;return{animator:e.animator,svg:e.axesRenderer.getLayerContainer(),labelsContext:e.axesRenderer.getDataLabelContainers().foreground,cartesianHost:{updateLegend:function(e){return t.legend.drawLegend(e,t.currentViewport,{isHierarchicalAxis:3===t.categoryAxisRenderMode,titleSliceUid:"".concat("legend","-").concat("title","-titleText")})},triggerRender:function(e){return t.render(e,!1)}},eventManager:this.eventManager,useManagedTabIndex:this.useManagedTabIndex()}},f.prototype.useManagedTabIndex=function(){return this.isSmallMultiples()},f.prototype.onDataViewObjectChanged=function(e){if(!this.featureSwitches.onObject)return e;for(var t,i=[],a=0,r=this.getLayers();a<r.length;a++){var o=r[a];o.getDataViewObjectLayerChanges&&i.push(o.getDataViewObjectLayerChanges(e))}if(_.isEmpty(i))return e;if(1<i.length){for(var s=[],n=[],l=0;l<i.length;l++){n[l]=[];for(var c=0,u=i[l];c<u.length;c++){var d=u[c];(d.required?s:n[l]).push(d)}}for(var h=n[0],p=1;p<n.length;p++)h=_.intersectionWith(h,n[p],P.DataViewObjectChangeHelper.visualObjectBehaviorChangeIsEqual);t=P.DataViewObjectChangeHelper.applyDataViewObjectsBehaviorChanges(e,__spreadArray(__spreadArray([],h,!0),s,!0))}else t=P.DataViewObjectChangeHelper.applyDataViewObjectsBehaviorChanges(e,_.first(i));return t},f.MinScalarRectThickness=2,f.LoadMoreThreshold=1,f.xAxisSmallFontSizeInPx=9,f.yAxisSmallFontSizeInPx=9,f.yAxisMediumFontSizeInPx=11,f);function f(e){var t=this,i=!1;this.trimOrdinalDataOnOverflow=!0,this.featureSwitches={},e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.type=e.chartType,this.featureSwitches=e.featureSwitches||{},void 0!==e.trimOrdinalDataOnOverflow&&(this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow),e.isScrollable&&(i=e.isScrollable),e.behaviorFactory)&&(this.behaviorFactory=e.behaviorFactory),this.hasAnimator=!(null==e||!e.animator),this.axes=new P.CartesianAxes(i,a.ScrollbarWidth,this.trimOrdinalDataOnOverflow),this.viewModelAdapterFactory=new P.ResponsiveCartesianAdapterFactory(this.featureSwitches.smallMultiplesResponsive),this.layerFactory=new B(this.type,this.viewModelAdapterFactory),this.layoutBuilder=new P.CartesianChartLayoutBuilder(e,this.behaviorFactory,this.featureSwitches,this.axes,this.type,function(){return t.isPlayAxis()},i,function(){return t.smallMultiplesViewModelAdapter}),this.multiples=new P.CartesianSmallMultiples(this.type,this.featureSwitches,function(){return t.createLayers()},function(e){return t.getLayerRendererInitOptions(e)})}function i(){this.navigationLayers=[],this.currentNavigationLayerIndex=0}P.CartesianChart=t,i.prototype.updateScrollCallbacks=function(e){this.scrollCallbacks=e},i.prototype.clearNavigationLayers=function(){this.navigationLayers=[]},i.prototype.addNavigationLayer=function(e){this.navigationLayers.push(e)},i.prototype.getFirstElement=function(){this.currentNavigationLayerIndex=0;var e,t=this.navigationLayers[this.currentNavigationLayerIndex].getFirstElement();return{element:e=t?t.element||this.getNextDataPoint(t.targetCategoryIndex,t.targetSeriesIndex,P.DataDirection.NextSeries).element:e}},i.prototype.getNextDataPoint=function(e,t,i){e=this.composeLayerPointInfo(e,t);return this.getNextDataPointWithStartData(e,i,e)},i.prototype.getNextDataPointWithStartData=function(i,a,r){var o=this,s=i.categoryIndex,n=i.seriesIndex,l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getNextDataPoint(s,n,a),e=c.targetCategoryIndex,u=a===P.DataDirection.NextSeries||a===P.DataDirection.NextCategory,d=this.navigationLayers.length;if(1<d&&c.targetCategoryIndex!==s){var t=s,h=0,p=u?1:-1;do{switch(a){case P.DataDirection.NextSeries:case P.DataDirection.PreviousSeries:this.currentNavigationLayerIndex+=p,this.layerRollOverCheck(this.currentNavigationLayerIndex,d)?(this.currentNavigationLayerIndex=this.currentNavigationLayerIndex<0?d-1:0,l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getFirstElement(e,!u),t=e=_.isFinite(c.targetCategoryIndex)?c.targetCategoryIndex:e,h++):(l=this.navigationLayers[this.currentNavigationLayerIndex],c=l.getFirstElement(t,!u));break;case P.DataDirection.NextCategory:case P.DataDirection.PreviousCategory:h=d}}while(!c.element&&h<d&&(!this.layerRollOverCheck(this.currentNavigationLayerIndex+p,d)||h<d-1))}if(!c.element&&null!=e&&this.shouldScroll(e)){this.getPendingFocusElement=function(){if(o.getPendingFocusElement=void 0,a===P.DataDirection.NextSeries?o.currentNavigationLayerIndex=0:a===P.DataDirection.PreviousSeries&&(o.currentNavigationLayerIndex=d-1),l=o.navigationLayers[o.currentNavigationLayerIndex],!(c=l.getNextDataPoint(s,n,a)).element)for(var e=o.currentNavigationLayerIndex;o.currentNavigationLayerIndex++,o.currentNavigationLayerIndex>=o.navigationLayers.length&&(o.currentNavigationLayerIndex=0),!(c=o.navigationLayers[o.currentNavigationLayerIndex].getNextDataPoint(s,n,a)).element&&o.currentNavigationLayerIndex!==e;);var t;return(o.shouldFindNextPoint(c,i,r,u)?(t=o.composeLayerPointInfo(c.targetCategoryIndex,c.targetSeriesIndex),o.getNextDataPointWithStartData(t,a,r)):c).element};var g=e-s;g<0?this.scrollCallbacks.scrollTo(e):this.scrollCallbacks.scrollBy(g)}else if(this.shouldFindNextPoint(c,i,r,u))return g=this.composeLayerPointInfo(c.targetCategoryIndex,c.targetSeriesIndex),this.getNextDataPointWithStartData(g,a,r);return c},i.prototype.shouldScroll=function(e){return!!this.scrollCallbacks&&this.scrollCallbacks.shouldScrollTo(e)},i.prototype.layerRollOverCheck=function(e,t){return t<=e||e<0},i.prototype.composeLayerPointInfo=function(e,t){return{categoryIndex:e,seriesIndex:t,layerIndex:this.currentNavigationLayerIndex}},i.prototype.shouldFindNextPoint=function(e,t,i,a){if(e.element&&!e.noShape||null===e.targetCategoryIndex||null===e.targetSeriesIndex)return!1;var r=this.composeLayerPointInfo(e.targetCategoryIndex,e.targetSeriesIndex);switch(this.compareLayerPointInfo(i,r,a)){case 1:if(0<=this.compareLayerPointInfo(t,r,a)&&0<this.compareLayerPointInfo(i,t,a))return!1;break;case 0:return!1;case-1:if(0<this.compareLayerPointInfo(i,t,a))return!1;if(0<=this.compareLayerPointInfo(t,r,a))return!1}return!0},i.prototype.compareLayerPointInfo=function(e,t,i){return e.categoryIndex>t.categoryIndex?i?1:-1:e.categoryIndex<t.categoryIndex?i?-1:1:e.seriesIndex>t.seriesIndex?i?1:-1:e.seriesIndex<t.seriesIndex?i?-1:1:e.layerIndex>t.layerIndex?i?1:-1:e.layerIndex<t.layerIndex?i?-1:1:0},P.CartesianChartNavigationHelper=i,n.prototype.processDataView=function(e,t){var i,a,r,o,s;this.renderModes=[],e&&e.metadata&&e.categorical&&!_.isEmpty(e.categorical.categories)?(s=e.metadata,o=e.categorical.categories,i=_.head(o),a=P.ScalarUtils.getScalarKeys(i),r=P.CartesianHelper.hasCategoryHierarchy(e),i=P.ScalarUtils.shouldDrawScalar(s.objects,P.columnChartProps.categoryAxis.axisType,i.source.type,a,r),r&&(a=n.areNonLeafLevelsFilteredToUniqueValue(o),r=A.DataViewObjects.getValue(s.objects,P.cartesianChartProps.categoryAxis.concatenateLabels,P.CartesianHelper.DefaultConcatenateLabelsValue),!a||!r&&t)?(o=n.isSortedByCategoryFirst(e),s=_.some(e.categorical.categories,function(e){return e.source&&e.source.identityExprs}),e=t&&!r&&s&&(o||a||this.easierHierarchicalAxis),this.renderModes.unshift(2),e&&this.renderModes.unshift(3),r||s||(this.warnings=[{selector:null,warnings:[new P.NoIdentityExprWarning]}])):this.renderModes.unshift(1),i&&this.renderModes.unshift(0)):this.renderModes.push(2)},n.prototype.getRenderMode=function(){return _.head(this.renderModes)},n.prototype.getRenderModes=function(){return this.renderModes},n.prototype.addObjectWarnings=function(e){this.warnings&&e.push.apply(e,this.warnings||[])},n.isSortedByCategoryFirst=function(e){return!(!e||!e.categorical||_.isEmpty(e.categorical.categories)||!e.metadata||_.isEmpty(e.metadata.columns))&&_.every(e.categorical.categories,function(e,t){e=e.source;return e&&null!=e.sort&&e.sortOrder===t})},n.areNonLeafLevelsFilteredToUniqueValue=function(e){if(_.isEmpty(e))return!1;for(var t=e.length-1,i=0;i<t;i++){var a=e[i].source;if(!a||!A.DataViewObjects.getValue(a.objects,P.cartesianChartProps.filters.filteredToUniqueValue,!1))return!1}return!0};var h=n;function n(e,t,i){this.easierHierarchicalAxis=i,this.processDataView(e,t)}P.CartesianAxisRenderModeSelector=h,L.filterDataToViewport=function(e){if(e&&e.scrollScale){var t=e.scrollScale,i=e.mainAxisScale,a=P.AxisHelper.invertOrdinalScale(t,e.extent.start),r=a+e.visibleCategoryCount,o=e.axesLayout.axes.y1.orientation,p=t.domain().slice(a,r);if(!_.isEqual(p,i.domain())){if(p&&0<p.length){for(var s=0,n=e.layers;s<n.length;s++)n[s].setFilteredData(p[0],p[p.length-1]+1);i.domain(p);var g=e.axesLayout.axes,t=void 0,l=((t=e.axesLayout.isXScrollBarVisible?g.x:g.y1).axis.scale(i),t.scale(i),t.axis.ticks(p.length),t.axis.tickValues(p),P.SvgCartesianAxes.getTickFormatter(t.axis));if(t.values=_.map(p,function(e){return l(e)}),!_.isEmpty(g.hierStack))for(var y=g.x.isCategoryAxis,m=o===P.AxisOrientation.left,v=e.axesLayout.tickLabelMargins,S=P.CartesianAxes.getLeafHeight(y?v.xMax:m?v.yLeft:v.yRight,v.stackHeight,g.hierStack.length),c=0;c<g.hierStack.length;c++)!function(e){var t=g.hierStack[e],i=P.AxisHelper.getCategoryThickness(t.scale),a=t.values,r=L.setLabelsAtEdges(p,a);if(t.axis.ticks(p.length),t.axis.tickValues(p),t.axis.tickFormat(function(e){e=a[r[p.indexOf(e)]];return e===P.CartesianAxes.hierarchyPlaceholder?"":_.isString(e)?e:e+""}),0===e)return;for(var o=[],s=[],n=[],l=void 0,c=0;c<r.length;c++){var u,d=p[c],h=r[c];t.values[h]!==P.CartesianAxes.hierarchyPlaceholder?(null!=l&&(o[l]=P.CartesianAxes.getMaxCategoryWidth(u=d-l,i),s[l]=P.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:v.stackHeight,leafHeight:S,categorySpanCount:u,categoryWidth:i},y,!m)),n[d]=a[h],l=d):n[d]=P.CartesianAxes.hierarchyPlaceholder}null!=l&&(u=p[r.length-1]-l+1,o[l]=P.CartesianAxes.getMaxCategoryWidth(u,i),s[l]=P.CartesianAxes.getHierarchyLineStyleInfo({levelIndex:e,stackHeight:v.stackHeight,leafHeight:S,categorySpanCount:u,categoryWidth:i},y,!m)),t.categoryLabelMaxWidths=o,t.lineStyleInfo=s,t.adjustedValues=n}(c)}return{startIndex:a,endIndex:r-1}}}},L.prototype.destroy=function(){this.scrollbar.remove()},L.prototype.render=function(e,t,i,a,r,o,s,n,l,c,u,d){var h=this,p=e.plotArea,g=(this.axisScale=null,e.isXScrollBarVisible||e.isYScrollBarVisible),y=P.CartesianChartConverter.isLineComboChart(l)?P.CartesianChartConverter.getMaximumSeriesSettings(t):P.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings(),m=e.margin,v=!0;P.ComboChart.isComboChart(l)&&!c&&(v=!1);var S,f,b,x,C,w,D,l=e.viewport.width-(m.left+m.right),c=y.seriesPosition===P.labelSeriesPosition.right?m.left:m.left+this.getSeriesWidth(l,y,v);(s||g)&&(D=(w=(C=this.cartesianAxes.isYAxisCategorical?(this.axisScale=e.axes.y1.scale,S=e.viewport.width,f=e.margin.top,D=e.axes.y1.categoryThickness,b=e.axes.y1.outerPaddingRatio,x=e.axes.y1.innerPaddingRatio,w=D*b,p.height):(this.axisScale=e.axes.x.scale,S=c,f=e.viewport.height,D=e.axes.x.categoryThickness,b=e.axes.x.outerPaddingRatio,x=e.axes.x.innerPaddingRatio,w=D*b,p.width),Math.max(1,A.Double.floorWithPrecision((C-2*w)/D))),C)),g?(this.scrollScale=this.axisScale.copy(),this.scrollScale.range([0,D]).paddingInner(.1).paddingOuter(0),this.extentLength=this.scrollScale(w-1)+this.scrollScale.bandwidth(),this.scrollHandler=new M({visibleScale:this.axisScale,fullScale:this.scrollScale,onScroll:function(e){e=h.scrollScale(e);h.scrollbar.setExtent({start:e,end:null}),h.scrollbar.refreshExtentAndVisual()}}),this.axisScale.range([0,C]).paddingInner(x).paddingOuter(b),this.scrollbar.setOrientation(e.isXScrollBarVisible),this.scrollbar.setScale(this.scrollScale,n),this.scrollbar.scrollBarLength=D,this.scrollbar.setExtentLength(this.extentLength),o||this.scrollbar.setExtent({start:0,end:null}),this.renderVisualOptions={axesLayout:e,layers:t,categoryLoadMoreDataHandler:s,mainAxisScale:this.axisScale,renderDelegate:a,scrollScale:this.scrollScale,visibleCategoryCount:w,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis},this.scrollbar.render(S,f,function(){return h.onRefreshVisual(function(e,t){return L.renderVisual(h.renderVisualOptions,e,t,r)},d)},u,d),o&&s?(m=s.viewportDataRange?s.viewportDataRange.startIndex:0,this.scrollTo(m)):L.renderVisual(this.renderVisualOptions,this.scrollbar.getExtent(),i,r)):(s&&(s.resetViewport(w),s.shouldLoadMoreData())&&s.loadMoreData(),this.scrollbar.remove(),a(t,e,i,this.animateCategoryAxis,this.animateValueAxis,r))},L.prototype.getSeriesWidth=function(e,t,i){return t&&t.show&&i?t.seriesMaximumWidth/100*e:0},L.prototype.scrollDelta=function(e){this.scrollHandler.scrollDelta(e)},L.prototype.scrollTo=function(e){this.scrollHandler.scrollTo(e)},L.prototype.shouldScrollTo=function(e){var t;return!!this.scrollHandler&&(t=this.axisScale.domain(),!_.isEmpty(t))&&(e<t[0]||e>t[t.length-1])},L.prototype.setExtent=function(e){this.scrollbar.setExtent(e),this.scrollbar.refreshExtentAndVisual()},L.prototype.scrollBy=function(e){var t=this.axisScale.domain();_.isEmpty(t)||this.scrollHandler.scrollTo(t[0]+e)},L.prototype.clearRenderingTimeout=function(){this.scrollbar&&this.scrollbar.clearRenderingTimeout()},L.prototype.onRefreshVisual=function(e,t){e(this.scrollbar.getExtent(),!0),t&&t.refreshOutlines()},L.setLabelsAtEdges=function(e,t){if(e.length<=1||t[e[0]]!==P.CartesianAxes.hierarchyPlaceholder)return e;var i=e[0],e=e.slice();if(i<t.length&&0<=i){for(;t[i]===P.CartesianAxes.hierarchyPlaceholder&&0<=i;i--);e[0]=i}return e},L.renderVisual=function(e,t,i,a){var r,t=L.filterDataToViewport({mainAxisScale:e.mainAxisScale,layers:e.layers,scrollScale:e.scrollScale,extent:t,visibleCategoryCount:e.visibleCategoryCount,axesLayout:e.axesLayout,animateCategoryAxis:e.animateCategoryAxis,animateValueAxis:e.animateValueAxis});t&&(e.categoryLoadMoreDataHandler&&((r=e.categoryLoadMoreDataHandler).viewportDataRange=t,r.shouldLoadMoreData())&&r.loadMoreData(),e.renderDelegate(e.layers,e.axesLayout,i,e.animateCategoryAxis,e.animateValueAxis,a))},L.ScrollbarWidth=10;var a=L;function L(e,t,i,a){this.cartesianAxes=e,this.scrollbar=t,this.animateCategoryAxis=i,this.animateValueAxis=a}P.ScrollableAxes=a,r.prototype.scrollDelta=function(e){_.isEmpty(this.visibleScale.domain())||(this.totalScrollDistance<0&&0<e||0<this.totalScrollDistance&&e<0?this.totalScrollDistance=e:this.totalScrollDistance+=e,e=r.getStepSize(this.visibleScale),Math.abs(this.totalScrollDistance)>=e?(this.extendScrollTimeout&&this.extendScrollTimeout.cancel(),e=this.getNewStartIndex(this.totalScrollDistance),this.scrollTo(e),this.totalScrollDistance=0):this.extendScrollTimeout())},r.prototype.scrollTo=function(e){e=this.clampIndex(e);this.onScroll(e)},r.getStepSize=function(e){var t=_.map(e.domain(),e);return 1<t.length?t[1]-t[0]:(t=e.range())[1]-t[0]},r.prototype.getNewStartIndex=function(e){var t=0<=e,i=(e=t?e:-e,this.visibleScale),a=_.map(i.domain(),i),r=i.domain(),o=r[0],a=a[0]+e;return(t?1:-1)*(i.range()[1]<a?r.length:P.AxisHelper.invertOrdinalScale(i,a)-o)+o},r.prototype.clampIndex=function(e){var t=this.fullScale.domain(),i=_.head(t),t=_.last(t);return Math.max(i,Math.min(t,e))},r.prototype.onTimeout=function(){this.totalScrollDistance=0},r.defaultTimeoutMs=1e3;var M=r;function r(e){e.visibleScale,e.fullScale,e.onScroll,this.visibleScale=e.visibleScale,this.fullScale=e.fullScale,this.onScroll=e.onScroll;e=jsCommon.Utility.valueOrDefault(e.timeout,r.defaultTimeoutMs);this.extendScrollTimeout=_.debounce(this.onTimeout,e),this.totalScrollDistance=0}P.AxisScrollHandler=M,l.prototype.create=function(e,t){e=__assign(__assign({},e),{viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(2,e)}}});return new P.ScatterChart(e)};var o=l;function l(){this.categoryAxisTitleOnByDefault=!0,this.valueAxisTitleOnByDefault=!0}p.prototype.create=function(e,t){e=__assign(__assign({},e),{viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(3,e)}}});return new P.WaterfallChart(e)};var u=p;function p(){}v.prototype.create=function(e,t){return new P.DataDotChart(e)};var m=v;function v(){}x.prototype.create=function(e,t){e={interactivityService:e.interactivityService,isScrollable:e.isScrollable,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches,chartType:this.type,viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(5,e)}}};return new P.ColumnChart(e)};var b=x;function x(e){this.type=e}w.prototype.create=function(e,t){return new P.Histogram(e)};var C=w;function w(){}V.prototype.create=function(e,t){e={interactivityService:e.interactivityService,isScrollable:e.isScrollable,tooltipsEnabled:e.tooltipsEnabled,chartType:this.type,featureSwitches:e.featureSwitches,viewModelAdapterFactory:t&&{create:function(e){return t.createLayerAdapter(0,e)}}};return this.inComboChart&&(e.chartType=8|e.chartType),new P.LineChart(e)};var D=V;function V(e,t){this.type=e,this.inComboChart=t}T.prototype.create=function(e,t){return e.isScrollable=!1,new P.RealTimeLineChart(e)};var R=T;function T(){}F.prototype.createLayers=function(e){var t=this,i={isScrollable:null!=e.isScrollable&&e.isScrollable,interactivityService:e.interactivityService,tooltipsEnabled:e.tooltipsEnabled,featureSwitches:e.featureSwitches};return _.map(this.layerMetadata,function(e){return e.create(i,t.viewModelAdapterFactory)})},F.initLayerMetadata=function(e){var t=[];switch(e){case 1:t.push(new D(2,!1));break;case 0:t.push(new D(1,!1));break;case 2:t.push(new D(16,!1));break;case 18:t.push(new R);break;case 10:t.push(new o);break;case 13:t.push(new u);break;case 12:t.push(new m);break;case 4:t.push(new b(20));break;case 3:t.push(new b(12));break;case 8:t.push(new b(52));break;case 6:t.push(new b(18));break;case 5:t.push(new b(10));break;case 7:t.push(new b(50));break;case 9:t.push(new b(68));break;case 11:var i=F.getComboColumnType();t.push(new b(i)),t.push(new D(1,!0));break;case 14:t.push(new b(12)),t.push(new D(1,!0));break;case 15:t.push(new b(20)),t.push(new D(1,!0));break;case 16:t.push(new b(12)),t.push(new m);break;case 17:t.push(new b(20)),t.push(new m);break;case 19:t.push(new C)}return t},F.getComboColumnType=function(e){var t=12;if(e){var i=e.general;if(i){switch(i.visualType1){case"Column":t=12;break;case"ColumnStacked":t=20;break;default:i.visualType1}i.visualType2&&i.visualType2}}return t};var B=F;function F(e,t){this.viewModelAdapterFactory=t,this.layerMetadata=F.initLayerMetadata(e)}k.prototype.getAllColors=function(){return this.palette.getAllColors()},k.prototype.getColorScaleByKey=function(e){return this.setPreferredScale(e),this.preferredScale},k.prototype.getNewColorScale=function(){return this.preferredScale},k.prototype.getColorByIndex=function(e){return this.palette.getColorByIndex(e)},k.prototype.getSentimentColors=function(){return this.palette.getSentimentColors()},k.prototype.getGradientColors=function(){return this.palette.getGradientColors()},k.prototype.getBasePickerColors=function(){return this.palette.getBasePickerColors()},k.prototype.clearPreferredScale=function(){this.preferredScale=this.palette.getNewColorScale(),this.rotated=!1},k.prototype.rotateScale=function(){this.preferredScale=this.preferredScale.clone(),this.preferredScale.clearAndRotateScale(),this.rotated=!0},k.prototype.setPreferredScale=function(e){this.rotated||(this.preferredScale=this.palette.getColorScaleByKey(e))};var I=k;function k(e){this.palette=e,this.clearPreferredScale()}P.SharedColorPalette=I,N.prototype.update=function(e,t){this.enabled=!t&&0!==e},N.prototype.resetViewport=function(e){this.viewportDataRange={startIndex:0,endIndex:e}},N.prototype.setScale=function(e){e=e&&e.domain&&e.domain().length;e&&(this.loadMoreThresholdIndex=e-1-this.loadMoreThreshold)},N.prototype.isLoadingMoreData=function(){return this.loadingMoreData},N.prototype.onLoadMoreDataCompleted=function(){this.loadingMoreData=!1},N.prototype.shouldLoadMoreData=function(){var e=this.viewportDataRange;return!(!this.enabled||!e||this.isLoadingMoreData())&&e.endIndex>=this.loadMoreThresholdIndex},N.prototype.loadMoreData=function(){return this.shouldLoadMoreData(),this.isLoadingMoreData()?e.WaitingForData:(this.loadingMoreData=!0,this.hostServices.loadMoreData(),e.TriggeredLoadMore)};var O=N;function N(e,t,i){void 0===i&&(i=0),this.enabled=!1,this.loadMoreThreshold=i,this.hostServices=t,this.setScale(e)}P.CartesianCategoryLoadMoreDataHandler=O}(powerbi=powerbi||{}),function(e){var u=e.visuals||(e.visuals={}),a=jsCommon.BrowserUtils,s={rectangle:{name:"rectangle",directionMode:0},centerBasedRectangle:{name:"centerBasedRectangle",directionMode:1},edgeBasedRectangle:{name:"edgeBasedRectangle",directionMode:2}};function t(e,t){this.behaviorFactories=e,this.featureSwitches=t}t.prototype.create=function(){var e=this.behaviorFactories.map(function(e){return e.create()});return new i(e,this.featureSwitches)},u.CartesianChartBehaviorFactory=t,c.prototype.bindEvents=function(e,t,i,a){for(var r,o,s=this.behaviors,n=0,l=s.length;n<l;n++)s[n].bindEvents(e.layerOptions[n],t,i,a);this.axesLayout=e.axesLayout,this.categorySubRangeCount=e.categorySubRangeCount,this.verticalCategoryAxis=e.verticalCategoryAxis,this.selectionHandler=t,a?e.clearCatcher.on("click",null):e.clearCatcher.on("click",function(){u.InteractivityUtils.handleClearSelection(t)}),i&&(r=i.dataPointNavigationManager,o=i.pointSourceKey,r.isEmpty(o)||this.registerFocusKeyHandler(e.root,e.layerOptions))},c.prototype.renderSelection=function(e){for(var t=0,i=this.behaviors;t<i.length;t++)i[t].renderSelection(e)},c.prototype.renderFocus=function(e){for(var t=0,i=this.behaviors;t<i.length;t++)i[t].renderFocus(e)},c.prototype.lassoSelectRect=function(e,t){var i=[],a=this.getLassoSelectDirectionMode(),r=this.getScaledRegion(t,a);if(void 0!==a){for(var o=0,s=this.behaviors;o<s.length;o++){var n,l=s[o];l.lassoSelectRectLayer&&l.getLassoSelectDirectionMode&&(n=l.getLassoSelectDirectionMode(),(n=c.getRectResultKeys(n)).length,n=r[n[0]],i.push.apply(i,l.lassoSelectRectLayer(n)))}u.InteractivityUtils.lassoSelectPoints(e,i,this.selectionHandler)}},c.prototype.getLassoSelectDirectionMode=function(){for(var i=[],e=0,t=this.behaviors;e<t.length;e++)!function(e){var t;e.getLassoSelectDirectionMode&&(t=e.getLassoSelectDirectionMode(),_.some(i,function(e){return e===t})||i.push(t))}(t[e]);if(0!==i.length)return 1===i.length?i[0]:3},c.getRectResultKeys=function(e){return 0===e?[s.rectangle.name]:1===e?[s.centerBasedRectangle.name]:2===e?[s.edgeBasedRectangle.name]:[s.centerBasedRectangle.name,s.edgeBasedRectangle.name]},c.prototype.getScaledRegion=function(e,t){for(var i={},a=0,r=c.getRectResultKeys(t);a<r.length;a++){var o=r[a];i[o]={dataSpace:this.getScaledRegionInternal(e,s[o].directionMode),pixelValue:e}}return i},c.prototype.getScaledRegionInternal=function(e,t){var i=e.left-this.axesLayout.margin.left,a=e.top-this.axesLayout.margin.top,r=e.right-this.axesLayout.margin.left,e=e.bottom-this.axesLayout.margin.top,o=2===t?this.categorySubRangeCount:void 0,s=0===t||this.verticalCategoryAxis?0:-1,n=0===t||this.verticalCategoryAxis?0:1,l=0!==t&&this.verticalCategoryAxis?-1:0,c=0!==t&&this.verticalCategoryAxis?1:0,i={left:this.axesLayout.axes.x.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,r,n,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,i,s,t,o),top:this.axesLayout.axes.y1.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,e,c,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,a,l,t,o),right:this.axesLayout.axes.x.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,i,s,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.x.scale,r,n,t,o),bottom:this.axesLayout.axes.y1.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,a,l,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y1.scale,e,c,t,o)};return this.axesLayout.axes.y2&&_.assign(i,{top2:this.axesLayout.axes.y2.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,e,c,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,a,l,t,o),bottom2:this.axesLayout.axes.y2.invertAxis?u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,a,l,t,o):u.AxisHelper.invertScale(this.axesLayout.axes.y2.scale,e,c,t,o)}),i},c.prototype.registerFocusKeyHandler=function(e,i){e.on("keydown.cartesian",function(){var e,t=d3.event;27===t.keyCode&&_.some(i,function(e){return $.contains(e.root.node(),t.target)})&&(t.preventDefault(),t.stopPropagation(),e=_.find(i,function(e){return $(e.root.node()).is(":tabbable")}),a.focus(e.root.node()))})};var i=c;function c(e,t){this.behaviors=e}u.CartesianChartBehavior=i}(powerbi=powerbi||{}),function(de){var he=de.visuals||(de.visuals={});function pe(){this.existingTooltips=[]}Object.defineProperty(pe.prototype,"displayNames",{get:function(){var e;return this._displayNames||(e=this.options.hostServices,this._displayNames={negative:e.getLocalizedString("Visual_TotalTooltipNegative"),positive:e.getLocalizedString("Visual_TotalTooltipPositive"),net:e.getLocalizedString("Visual_TotalTooltipNet"),simple:e.getLocalizedString("Visual_Total")}),this._displayNames},enumerable:!1,configurable:!0}),pe.prototype.convert=function(e){for(var t,i,a=(this.options=e).dataView,r=e.style,o=e.is100PercentStacked,o=void 0!==o&&o,s=e.isScalar,s=void 0!==s&&s,n=e.dataViewMetadata,n=void 0===n?null:n,l=e.multipleInfo,c=e.chartType,u=e.interactivityService,d=e.tooltipsEnabled,d=void 0===d||d,h=e.hostServices,p=e.ribbonChart,g=e.isCombo,y=e.buildCategories,e=e.supportsTotalLabels,m=he.CartesianHelper.getCategoryAxisProperties(n,!1),v=he.CartesianHelper.getPreferredCategoryWidth(m),S=he.CartesianHelper.getReverseStackOrder(m),s=he.CartesianHelper.isScalar(s,m),m=a.categorical,f=new O(a,r),y=he.converterHelper.getPivotedCategories(m,he.columnChartProps.general.formatString,y),b=y.categories,y=y.categoryFormatter,m=he.CartesianHelper.getScalarKeyinfo(m,s).category.source,x=he.ColumnChart.getDefaultColumnLabelSettings(r,g),C=(n&&n.objects&&(L=n.objects.labels,he.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(L,x,!he.ColumnChart.isBar(c),r,g)),__assign(__assign({},x),{show:!1})),w=(e&&n&&n.objects&&(w=n.objects.totals)&&he.DataLabelViewModel.updateLabelSettingsFromLabelsObject(w,C,!1,r,g),this.totalLabelsSettings=C,p&&(t=he.ColumnChart.getRibbonsUtils().getRibbonOptionsFromDataviewObjects(n,he.columnChartProps,S)),f.getLegend()),D=w.legend.dataPoints,A=w.seriesSources,P=he.ColumnChart.getDefaultLineChartSeriesLabelSettings(r),n=(n&&n.objects&&(L=n.objects.seriesLabels,he.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(L,P,r,g),P.defaultSeriesWidth=P.defaultSeriesWidth?-1:null,P.seriesMaximumWidth=P.defaultSeriesWidth?-1:P.seriesMaximumWidth),this.createDataPoints({dataView:a,categories:b,legend:D,converterStrategy:f,defaultDataLabelsSettings:x,defaultSeriesSettings:P,totalLabelsSettings:C,is100PercentStacked:o,isScalar:s,isCombo:!!g,style:r,chartType:c,categoryMetadata:m,multipleInfo:l,tooltipsEnabled:d,ribbonChart:p,hostServices:h,ribbonOptions:t,supportsTotalLabels:e,reverseStackOrder:S})),L=n.series,M=(he.canSupportOutsidePosition(c,L.length)?null!=x.position&&_.includes(he.clusteredValidLabelPositionOptions,x.position)||(x.position=he.labelPosition.auto):null!=x.position&&_.includes(he.stackedValidLabelPositionOptions,x.position)||(x.position=he.labelPosition.auto),[]),V=0,T=D.length;V<T;V++)M.push(A[V]);if(u){for(var F=0,I=L;F<I.length;F++){var k=I[F];u.applySelectionStateToData(k.data)}u.applySelectionStateToData(w.legend.dataPoints)}return r.isHighContrast&&(i={visible:!0,color:he.ColorHelper.getThemeColor(r,he.ForegroundColorName),width:he.CartesianHelper.defaultLineStrokeWidth}),{categories:b,categoryIdentities:n.categoryIdentities,categoryFormatter:y,preferredCategoryWidth:v,series:L,totals:n.totals,hasPositive:n.hasPositive,hasNegative:n.hasNegative,hasNetPositive:n.hasNetPositive,hasNetNegative:n.hasNetNegative,hasY2Role:de.data.DataRoleHelper.hasRoleInDataView(a,"Y2"),valuesMetadata:M,legendData:w.legend,hasHighlights:n.hasHighlights,valuesMetadataBySeries:n.valuesMetadataBySeries,categoryMetadata:m,scalarCategoryAxis:s,dataLabelsSettings:x,seriesLabelSetings:P,totalLabelsSettings:C,hasDynamicSeries:n.hasDynamicSeries,isMultiMeasure:n.isMultiMeasure,ribbonChartData:p?{ribbonChartDataPoints:n.ribbonChartDataPoints,ribbonOptions:t}:void 0,strokeSettings:i,multipleIdentity:n.multipleIdentity}},pe.prototype.createDataPoints=function(B){var n,ne=this,H=B.dataView,U=H.categorical,j=he.columnChartProps.general.formatString,z=he.cartesianRoleNames.y,E=de.data.createDataViewCategoricalReaderAdvanced(H,{staticSeriesRoleNames:[z],colorOptions:{valueRole:z,visualStyle:B.style},formatStringProp:j,errorRangeProp:he.ErrorObjectProps.errorRange}),W=U&&U.values?U.values.grouped():void 0,G=B.categories.length,Y=E.data.hasValues(z)?E.data.getSeriesCount():void 0,X=[],K=[],Z=B.chartType,p=he.ColumnChart.isStacked(Z,Y);if(Y<1||G<1)return{series:X,totals:K,hasPositive:!1,hasNegative:!1,hasNetPositive:!1,hasNetNegative:!1,valuesMetadataBySeries:[],categoryIdentities:[],ribbonChartDataPoints:null,hasHighlights:!1,hasDynamicSeries:!1,isMultiMeasure:!1};for(var g,q,$,e=U.categories,e=(B.categoryMetadata,_.isEmpty(e)?null:_.last(e).source),e=he.AxisHelper.getCategoryValueType(e),le=he.AxisHelper.isDateTime(e),J=[],y=[],Q=[],ee=[],te=[],l=[],ie=!(!U.values||!U.values.source),e=!ie&&1<Y,ae=B.multipleInfo,re=(ae&&(q=_.first(ae.sources).metadata.queryName,$=ae.sources.map(function(e){return he.buildValueDetailsForColumnValue(e.metadata,e.value,ae.identity)}),g=(new he.SelectionIdBuilder).withColumnIdentity(ae.identity,q,$).createSelectionId()),!1),oe=E.data.hasHighlights(),t=B.converterStrategy,i=0;i<Y;i++){for(var m=[],v=[],a=0;a<G;a++){var S,r=t.getValueBySeriesAndCategory(i,a),o=t.getFormatStringBySeriesAndCategory(i,a);m[a]={value:r,formatString:o},oe&&(o=t.getHighlightBySeriesAndCategory(i,a),S=t.getHighlightFormatStringBySeriesAndCategory(i,a),v[a]={value:o,formatString:S},0<=r&&0<=o&&de.Double.greaterOrEqualWithPrecision(r,o)||r<=0&&o<=0&&de.Double.lessOrEqualWithPrecision(r,o)||(re=!0))}J.push(m),oe&&y.push(v)}re&&!he.canSupportOutsidePosition(Z,Y)&&(oe=re=!1,J=y);for(var ce=B.defaultDataLabelsSettings.fontProperties.color,ue=this.totalLabelsSettings.fontProperties.color,f=function(e){for(var L=e,M=null!=(n=se.options.featureSwitches)&&n.flipStackOrder&&B.reverseStackOrder?Y-e-1:e,V=[],e=B.legend[L],T=void 0,t=void 0,i=((E.data.hasSeries()||B.isCombo)&&(a=void 0,i=(a=B.isCombo&&!E.data.hasSeries()?E.objects.getValueMetadataObjects(z,M):E.objects.getSeriesDataObjects(M))&&a.labels,a=a&&a.seriesLabels,(T=de.Prototype.inherit(B.defaultDataLabelsSettings)).show=B.defaultDataLabelsSettings.show&&(null==(n=B.defaultDataLabelsSettings.showByDefault)||n),i&&he.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(i,T,void 0,B.style,B.isCombo),(t=de.Prototype.inherit(B.defaultSeriesSettings)).show=B.defaultSeriesSettings.show&&(null==(n=B.defaultSeriesSettings.showByDefault)||n),a)&&he.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(a,t,B.style,B.isCombo),e.color),a=E.columns.getValueColumnBySeries(M),F=ee[M]=E.columns.getValueMetadataColumn(z,M),t=t||B.defaultSeriesSettings,r=_.findIndex(ee,F),I=(-1!==r&&(l[r]?l[r].usedInSeriesIndices.push(M):l[r]={metadataColumn:F,usedInSeriesIndices:[M],valueSelector:(new he.SelectionIdBuilder).withMeasure(F.queryName,a).createSelectionId()}),he.UncertaintyHelper.convertErrorMetadata(p?{}:F.objects,B.style,i,M,__assign(__assign({},B.defaultDataLabelsSettings),{show:!1}),{isCombo:B.isCombo,hideBand:!0,valueAxisHorizontal:he.ColumnChart.isBar(Z),staticObjects:E.objects.getStaticObjects()})),k=I.hasUncertainty,r={displayName:e.label,key:"series"+M,index:M,data:V,identity:e.identity,color:i,labelSettings:T,uncertainty:I,type:F.type,seriesSettings:t},O=(X.push(r),he.GradientUtils.getGradientMeasureIndex(U)),N=he.GradientUtils.getGradientValueColumn(U),R=he.valueFormatter.getLocalizedString("Percentage"),o=function(o){var s=he.AxisHelper.normalizeNonFiniteNumber(J[M][o].value),n=J[M][o].formatString;if(null==s&&0<L)return"continue";var l=s,e=B.categories[o];if(le&&null!=e&&!(e instanceof Date))return"continue";var c,t=void 0,t=e instanceof Date?de.FeatureSwitchedDate.getEpochTimeStamp(se.options.featureSwitches.utcDates,e):e;if(B.isScalar&&(null==t||isNaN(t)))return"continue";k&&(c=he.UncertaintyHelper.convertCategoricalDataPoint(E.data,o,M,s));var u,d,h,p,i,e=void 0,g=B.is100PercentStacked,a=(g&&(e=he.StackedUtil.getStackedMultiplier(_.map(J,function(e){return _.map(e,function(e){return e.value})}),o)),s),r=(te[M]||(te[M]=[]),te[M][o]=s<0),y=(e&&(s*=r?e.neg:e.pos),K[o]||(K[o]={positive:0,negative:0,net:0,categoryValue:t,categoryIndex:o,dynamicFormatString:n}),he.DataLabelUtil.determineTotalLabelFillColor({defaultColor:ue,categoricalDataReader:E,categoryIndex:o,seriesIndex:L})),m=he.DataLabelUtil.isAssignedColor(y)?y.color:ce,v=(se.totalLabelsSettings.fontProperties=he.DataLabelUtil.updateFontPropertiesColor(m,se.totalLabelsSettings.fontProperties),K[o].labelFill=y.color,Math.abs(s)),m=void 0,y=(r?(m=K[o].negative,isNaN(v)||(K[o].negative-=v,K[o].net-=v)):(isNaN(v)||(K[o].positive+=v,K[o].net+=v),m=K[o].positive),W&&W.length>M&&W[M].values?W[M]:null),S=_.isEmpty(U.categories)?null:U.categories[0],f=E.columns.getValueColumn(z,M),y=pe.createIdentities(U,S,o,y,f,F,ae,q,$),f=y.identity,y=y.identityKey,b=(Q[o]||(Q[o]=function(){return he.CartesianHelper.getCategoryIdentity(o,S)}),E.colors.createBySeries(M,o)),x=0===O?null:N,C=void 0,w=void 0,D=void 0,e=(oe&&(u=E.data.getHighlight(z,o,M),d=E.data.getHighlightFormatString(z,o,M),C=null!==(p=u)?(k&&(h=he.UncertaintyHelper.convertCategoricalDataPoint(E.data,o,M,u,!0)),g&&(u*=0<u?e.pos:e.neg),Math.abs(u)):0,w=function(e,t,i,a,r){0<i?e-=a-r:(null===i||0===i)&&0<t&&(e-=a);return e}(m,s,u,v,C),D=he.SelectionId.createWithHighlight(f)),B.tooltipsEnabled&&(i=new he.LazyTooltipBuilder).withLazyValues(function(){var e,t,i=[],a=(ae&&(a=he.TooltipBuilder.withMultipleColumnAndValues(ae.sources.map(function(e){return e.metadata}),ae.sources.map(function(e){return e.value}),!0,he.FormattingStrategies.defaultFormatter(j)))&&i.push(a()),S&&(a=he.CategoryLevelUtils.getCategoryLevels(H.categorical.categories,o,j),e=he.CategoryLevelUtils.concatenateCategoryLevels(a),132===Z&&(e=he.Histogram.buildTooltipCategories(a,o,G)),i.push({displayName:e.displayName,value:e.value})),!ie||S&&S.source===U.values.source||i.push({displayName:U.values.source.displayName,value:he.converterHelper.formatFromMetadataColumn(W[M].name,U.values.source,j)}),function(e){return he.converterHelper.formatFromMetadataColumn(e,F,j,!1,n)}),r=(null!=l&&(e=void 0,r=a(l),e=g?r+" ("+he.valueFormatter.format(v,R)+")":r,r=I.tooltips,!k||oe||!r.show||r.format!==he.errorFormat.range||(void 0!==(t=he.UncertaintyHelper.getTooltipItems(c,s,I,a,B.hostServices,{overrideDisplayName:F.displayName}))&&t.length,_.isEmpty(t))?i.push({displayName:F.displayName,value:e}):i.push(t[0])),oe&&(a=function(e){return he.converterHelper.formatFromMetadataColumn(e,F,j,!1,d)},e=function(e,t,i,a,r,o,s){var n,l;null!=e&&null!=t&&(t=he.valueFormatter.format(t,a),l=he.converterHelper.formatFromMetadataColumn(e,r,o,!1,i),n=l+" ("+t+")");if(s)return n;return l}(p,u,d,R,F,j,g))&&(r=I.tooltips,!k||!r.show||r.format!==he.errorFormat.range||(void 0!==(t=he.UncertaintyHelper.getTooltipItems(c,s,I,a,B.hostServices,{overrideDisplayName:he.ToolTipComponent.localizationOptions.highlightedValueDisplayName}))&&t.length,_.isEmpty(t))?i.push({displayName:he.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:e}):i.push(t[0])),k&&I.tooltips.format!==he.errorFormat.range&&(r=oe?h:c)&&i.push.apply(i,he.UncertaintyHelper.getTooltipItems(r,l,I,a,B.hostServices,{hideMarker:!0})),x&&null!=x.values[o]&&(t=de.DataViewObjects.getValue(null==(e=x.objects)?void 0:e[o],j),i.push({displayName:x.source.displayName,value:he.converterHelper.formatFromMetadataColumn(x.values[o],x.source,j,!1,t)})),he.TooltipBuilder.addTooltipMeasures(E,i,o,ie?M:void 0,j),ne.getTotalTooltip(M,o,te,K,ee,j));return r&&i.push(r),i}),X[L]),e=e.labelSettings||B.defaultDataLabelsSettings,A=void 0,r=(he.ColumnChart.isStacked(Z,Y)&&(A=function(e,t,i,a,r){for(var o=!(e&&t===i-1&&1!==i),s=t+1;s<i;s++){var n=he.AxisHelper.normalizeNonFiniteNumber(r[s][a].value);if(null!==n&&((!e||0===t)&&0<n||e&&0!==t)){o=!1;break}}return o}(r,M,Y,o,J)),he.DataLabelUtil.determineDataLabelFillColor({defaultColor:ce,seriesColor:null==T?void 0:T.fontProperties.color,categoricalDataReader:E,categoryIndex:o,seriesIndex:L})),P=se.options.featureSwitches.measureDrivenDataLabels?he.DataLabelUtil.extractDynamicLabel({categoricalDataReader:E,categoryIndex:o,seriesIndex:L,hasHighlights:oe}):void 0,a=(P&&(P.enabled=!!se.options.featureSwitches.measureDrivenDataLabels&&P.enabled),{categoryValue:t,value:s,position:m,valueAbsolute:v,valueOriginal:a,seriesIndex:L,labelSettings:e,uncertainty:c,categoryIndex:o,color:b,selected:!1,originalValue:s,originalPosition:m,originalValueAbsolute:v,identity:f,key:y,get tooltipInfo(){return i&&i.getTooltipItems()},get formattedTooltip(){return i&&i.getFormattedTooltipItems()},labelFill:r.color,labelFormatString:n||F.format,lastSeries:A,chartType:Z,dynamicLabelValue:oe?void 0:P});V.push(a),oe&&(f={categoryValue:t,value:u,position:w,valueAbsolute:C,valueOriginal:p,seriesIndex:L,labelSettings:e,uncertainty:h,categoryIndex:o,color:b,selected:!1,highlight:!0,originalValue:s,originalPosition:m,originalValueAbsolute:v,drawThinner:re,identity:D,key:D.getKey(),get tooltipInfo(){return i&&i.getTooltipItems()},get formattedTooltip(){return i&&i.getFormattedTooltipItems()},labelFormatString:d||F.format,labelFill:r.color,lastSeries:A,chartType:Z,dynamicLabelValue:P},V.push(f))},s=0;s<G;s++)o(s)},se=this,s=0;s<Y;s++)f(s);for(var c,b=!1,x=!1,u=!1,d=!1,C=0,w=K;C<w.length;C++){var h=w[C];h&&(b=b||0<h.positive,x=x||h.negative<0,u=u||0<h.net,d=d||h.net<0)}return this.hasNetPositive=u,this.hasNetNegative=d,1<Y&&1<G&&B.ribbonChart&&(c=he.ColumnChart.getRibbonsUtils().createRibbonChartDataPoints({dataView:H,columnSeries:X,hasHighlights:oe,hasDynamicSeries:ie,ribbonChartDataPoints:c,categoryCount:G,formatStringProp:j,reader:E,hostServices:B.hostServices,ribbonOptions:B.ribbonOptions})),{series:X,totals:K,hasPositive:b,hasNegative:x,hasNetPositive:u,hasNetNegative:d,valuesMetadataBySeries:l,categoryIdentities:Q,ribbonChartDataPoints:c,hasHighlights:oe,hasDynamicSeries:ie,isMultiMeasure:e,multipleIdentity:g}},pe.createIdentities=function(e,t,i,a,r,o,s,n,l){var c=e.originalCategories||[t],t=he.SelectionIdBuilder.builder().withCategory(c,i,null==(c=null==t?void 0:t.source)?void 0:c.queryName,!0).withSeries(e.values,a,!0).withMeasure(o.queryName,r,i),c=(t=s?t.withColumnIdentity(s.identity,n,l):t).createSelectionId();return{identity:c,identityKey:c.getKey()}},pe.prototype.getTotalTooltip=function(e,t,i,a,r,o){var s=this.options;if(s.tooltipsEnabled&&s.supportsTotalLabels&&this.totalLabelsSettings.show)return s=i[e][t],this.existingTooltips[t]||(this.existingTooltips[t]={}),this.totalLabelsSettings.showPositiveAndNegative?(this.existingTooltips[t][i=s?"negative":"positive"]||(this.existingTooltips[t][i]={displayName:this.displayNames[i],value:he.converterHelper.formatFromMetadataColumn(a[t][i],r[e],o,!1)}),this.existingTooltips[t][i]):(this.existingTooltips[t].net||(this.existingTooltips[t].net={displayName:this.hasNetPositive&&this.hasNetNegative?this.displayNames.net:this.displayNames.simple,value:he.converterHelper.formatFromMetadataColumn(a[t].net,r[e],o,!1)}),this.existingTooltips[t].net)},he.ColumnChartConverter=pe,e.prototype.getLegend=function(){var e=[],t=[],i=[],a=!1,r=this.reader;if(this.dataView&&this.dataView.values){for(var o=r.columns.getSeriesCount(he.cartesianRoleNames.y),s=he.columnChartProps.general.formatString,n=r.columns.hasDynamicSeries(),l=0;l<o;l++){var c=r.columns.getValueMetadataColumnBySeries(l),u=r.objects.getSeriesDataObjects(l);t.push(c),i.push(u);var u=(u=new he.SelectionIdBuilder).withMeasure(c.queryName),u=(u=n?u.withSeries(r.columns.getSeriesValueColumns(),r.columns.getSeriesValueColumnGroup(l),!0):u).createSelectionId(),d=he.converterHelper.getFormattedLegendLabel(c,this.dataView.values,s),h=r.colors.createBySeries(l);e.push({icon:he.LegendIcon.Box,color:h,label:d,identity:u,selected:!1,index:l}),void 0!==c.groupName&&(a=!0)}var p=this.dataView.values,p=p&&p.source?p.source.displayName:""}var g=he.Legend.getDefaultLegendData(this.visualStyle);return g.title=p,g.dataPoints=e,g.grouped=a,{legend:g,seriesSources:t,seriesObjects:i}},e.prototype.getValueBySeriesAndCategory=function(e,t){return this.reader.data.getValue("Y",t,e)},e.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.reader.data.getHighlight("Y",t,e)},e.prototype.getFormatStringBySeriesAndCategory=function(e,t){return this.reader.data.getFormatString("Y",t,e)},e.prototype.getHighlightFormatStringBySeriesAndCategory=function(e,t){return this.reader.data.getHighlightFormatString("Y",t,e)};var O=e;function e(e,t){this.visualStyle=t,this.dataView=e&&e.categorical,this.reader=de.data.createDataViewCategoricalReaderAdvanced(e,{staticSeriesRoleNames:[he.cartesianRoleNames.y],colorOptions:{valueRole:he.cartesianRoleNames.y,visualStyle:t},formatStringProp:he.columnChartProps.general.formatString})}he.ColumnChartConverterHelper=O}(powerbi=powerbi||{}),function(u){var m=u.visuals||(u.visuals={}),h=u.visuals.builder,e=jsCommon.CssConstants.createClassAndSelector,d=u.data.DataViewWildcard,i=jsCommon.DOMConstants,a=jsCommon.EnumExtensions,s=u.visuals.OnObjectUtil,n=m.shapes.Rect,p=u.data.Selector,g="Auto",r=(m.clusteredValidLabelPositionOptions=[g,m.labelPosition.outsideEnd,m.labelPosition.insideEnd,m.labelPosition.insideCenter,m.labelPosition.insideBase],m.stackedValidLabelPositionOptions=[g,m.labelPosition.insideCenter,m.labelPosition.insideEnd,m.labelPosition.insideBase],m.innerPaddingMin=0,m.innerPaddingMax=50,m.preferredCategoryWidthMin=20,m.preferredCategoryWidthMax=180,y.prototype.initData=function(e){this.currentViewport=e.viewport,this.element=e.element,this.hostService=e.host,this.interactivity=e.interactivity,this.isComboChart=m.ComboChart.isComboChart(e.chartType),this.style=e.style,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches,this.animationOptions=e.animation},y.prototype.initRenderer=function(e){var t;this.animator=e.animator,this.cartesianVisualHost=e.cartesianHost,this.svg=e.svg,this.svg.classed("columnChart",!0),this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.useManagedTabIndex=e.useManagedTabIndex,this.interactivityService&&(t=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({"aria-label":this.hostService.getLocalizedString("Visual_Plot"),"data-automation-type":"mainGraphicsContext","aria-multiselectable":"true",role:"listbox"}).classed(m.SetFocusRingClassName,!t),e.useManagedTabIndex?(this.mainGraphicsContext.classed(m.managedTabIndexElement.class,!0),this.mainGraphicsContext.attr(i.skipChildrenFocusAttribute,!0)):this.mainGraphicsContext.attrs({tabindex:0,focusable:!0}))},Object.defineProperty(y.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),y.prototype.getCategoryLayout=function(e,t,i,a,r){var o=this.getVisualCategoryAxisIsScalar();return m.CartesianChartLayout.getLayout(this.data,{availableWidth:Math.max(0,y.isBar(this.chartType)?this.availableHeight:this.availableWidth),categoryCount:e,preferredCategoryWidth:null!=(e=null==(e=this.data)?void 0:e.preferredCategoryWidth)?e:null,domain:null==(e=m.AxisHelper.createDomain(this.data.series,m.AxisHelper.getCategoryValueType(null==(e=this.data)?void 0:e.categoryMetadata),o,[t.includeDomain]))?void 0:e.domain,isScalar:o,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:i,outerPaddingRatio:a,innerPaddingRatio:r})},y.getDefaultColumnLabelSettings=function(e,t){void 0===t&&(t=!1);var i=m.DataLabelViewModel.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",noColor:!0});return i.position=null,i.labelDensity=m.DataLabelViewModel.defaultLabelDensity,i.labelOrientation=1,t?(i.enableBackground=!0,i.backgroundColor=m.ColorHelper.getThemeColor(e,m.BackgroundColorName),i.backgroundTransparency=m.DataLabelViewModel.defaultComboChartLabelBackgroundOpacity):i.enableBackground=!1,i},y.getDefaultLineChartSeriesLabelSettings=function(e){var t=m.ColorHelper.getThemeColor(e,m.DataLabelViewModel.DefaultLabelColorName),e=m.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,seriesColor:t,seriesPosition:m.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1}},y.converter=function(e){return(new m.ColumnChartConverter).convert(e)},y.sliceSeries=function(e,t,i){void 0===i&&(i=0);var a=[];if(e&&0<e.length)for(var r=0,o=e.length;r<o;r++)(a[r]=u.Prototype.inherit(e[r])).data=e[r].data.filter(function(e){return e.categoryIndex>=i&&e.categoryIndex<t});return a},y.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},y.prototype.setData=function(e,t){var i,a,r=y.isStacked100(this.chartType);this.data=this.originalData={categories:[],categoryFormatter:null,series:[],totals:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,dataLabelsSettings:y.getDefaultColumnLabelSettings(this.style),seriesLabelSetings:y.getDefaultLineChartSeriesLabelSettings(this.style),hasDynamicSeries:!1,isMultiMeasure:!1},0<e.length&&(e=this.dataView=e[0])&&e.categorical&&(a=(a=e.categorical.categories)&&0<a.length?a[0].source:null,a=m.AxisHelper.getCategoryValueType(a),i=m.CartesianHelper.hasCategoryHierarchy(e),a=m.ScalarUtils.shouldDrawScalar(e.metadata?e.metadata.objects:null,m.columnChartProps.categoryAxis.axisType,a,void 0,i),this.data=this.originalData=y.converter({dataView:e,style:this.style,is100PercentStacked:r,isScalar:a,dataViewMetadata:e.metadata,multipleInfo:t,chartType:this.chartType,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,hostServices:this.hostService,ribbonChart:this.ribbonChart,isCombo:this.isComboChart,buildCategories:void 0,supportsTotalLabels:!t&&this.supportsTotalLabels(),featureSwitches:this.featureSwitches}))},y.getChartStrategy=function(e,t){switch(e){case 10:return new m.ClusteredBarChartStrategy;case 12:return new m.ClusteredColumnChartStrategy;case 18:return new(y.isStacked(e,t)?m.StackedBarChartStrategy:m.ClusteredBarChartStrategy);case 50:return new m.StackedBarChartStrategy;case 20:return new(y.isStacked(e,t)?m.StackedColumnChartStrategy:m.ClusteredColumnChartStrategy);default:return new m.StackedColumnChartStrategy}},y.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&1<this.data.series.length)},y.prototype.getSeriesSettings=function(){return u.Prototype.inherit(this.data).seriesLabelSetings},y.prototype.enumerateObjectInstances=function(e,t){var i;switch(t.objectName){case"dataPoint":this.dataView&&!m.GradientUtils.hasGradientRole(this.dataView.categorical)&&this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"seriesLabels":null!=(i=this.featureSwitches)&&i.lineChartSeriesLabels&&this.enumerateSeriesDataLabels(e);break;case"totals":this.supportsTotalLabels()&&this.enumerateTotalLabels(e);break;case"ribbonChart":y.getRibbonsUtils().enumerateRibbonChart(e,this.data.ribbonChartData,this.ribbonChart)}},y.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.ribbonChart?y.getRibbonsUtils().getRibbonChartCard(t.getRibbonDataPointFormattingOptions(e.categoryAxisData)):t.getDataPointCard(e.categoryAxisData)},function(){return t.getLabelsCard()},function(){return t.getTotalsCard()},function(){return t.getErrorBarsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:5}},y.prototype.getDataPointCard=function(a){var r=this;if(this.dataView&&!m.GradientUtils.hasGradientRole(this.dataView.categorical)){var o=function(e){return r.hostService.getLocalizedString(e)},s=this.originalData;if(s){var e,n=s.series.length;if(0!==n)return(e=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("bars"),y.isColumn(this.chartType)?"Role_DisplayName_Columns":"Visual_Bars_Title",[m.columnChartProps.dataPoint.fill,m.columnChartProps.dataPoint.showAllDataPoints,m.cartesianChartProps.categoryAxis.innerPadding,m.cartesianChartProps.categoryAxis.preferredCategoryWidth,m.cartesianChartProps.categoryAxis.reverseStackOrder],o)).addGroup("colors",function(e){var t,i;e.withDisplayName("Visual_Colors"),s.hasDynamicSeries||1<n||!s.categoryMetadata?(t=y.isStacked(r.chartType,n)||y.isStacked100(r.chartType),i={groupBuilder:e,dataPoints:s.series,seriesColorProps:m.columnChartProps.dataPoint,localize:o,featureSwitches:r.featureSwitches},u.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(i),r.featureSwitches&&r.featureSwitches.flipStackOrder&&t&&e.addSimpleSlice("Visual_ReverseStackOrder",new h.ToggleSwitchBuilder({descriptor:(r.isComboChart?m.comboChartObjectProps:m.cartesianChartProps).categoryAxis.reverseStackOrder,value:a.reverseStackOrder}).build())):(i={groupBuilder:e,colorProps:m.columnChartProps.dataPoint,featureSwitches:r.featureSwitches,hostService:r.hostService,options:{dataView:r.dataView,style:r.style,categories:_.map(s.series[0].data,function(e){var t,i=(i=null==(i=null==(t=s.categoryIdentities)?void 0:t[e.categoryIndex])?void 0:i.call(t))||e.identity;return{color:e.color,displayName:s.categoryFormatter.format(s.categories[e.categoryIndex]),identity:i}}),fillInstanceKind:3,multipleRole:s.multipleIdentity?m.columnRoleNames.rows:void 0}},u.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup(i))}),this.getVisualCategoryAxisIsScalar()||e.addGroup("spacing",function(e){var t=a.innerPadding;e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new m.builder.SliderBuilder({descriptor:m.cartesianChartProps.categoryAxis.innerPadding,value:void 0!==t?Math.round(100*t):void 0,options:{minValue:{type:0,value:m.innerPaddingMin},maxValue:{type:1,value:m.innerPaddingMax},unitSymbol:"Numeric_Pixel"},localize:o}).build()).addSimpleSlice("categoryWidth",new m.builder.NumUpDownBuilder({descriptor:m.cartesianChartProps.categoryAxis.preferredCategoryWidth,value:a.preferredCategoryWidth,options:{minValue:{type:0,value:m.preferredCategoryWidthMin},maxValue:{type:1,value:m.preferredCategoryWidthMax},unitSymbol:"Numeric_Pixel"}}).build())}),e.build()}}},y.prototype.getLabelsCard=function(){function o(e){return s.hostService.getLocalizedString(e)}var s=this,n=this.originalData,e=n.dataLabelsSettings,l=n.series.length,c=1<l||!n.categoryMetadata||this.isComboChart,t=n.dataLabelsSettings.position!==m.labelPosition.outsideEnd,u=S(this.chartType,n.series.length)?m.clusteredValidLabelPositionOptions:m.stackedValidLabelPositionOptions,i=(e.position&&u.indexOf(e.position)<0&&(e.position=g),__assign(__assign({},m.columnChartProps.labels),{position:m.columnChartProps.labels.labelPosition,precision:m.columnChartProps.labels.labelPrecision,displayUnits:m.columnChartProps.labels.labelDisplayUnits,labelBackgroundColor:m.columnChartProps.labels.backgroundColor,labelBackgroundTransparency:m.columnChartProps.labels.backgroundTransparency,showDynamicLabels:m.columnChartProps.labels.showDynamicLabels,dynamicLabelValue:m.columnChartProps.labels.dynamicLabelValue})),a=(y.isColumn(this.chartType)||delete i.labelOrientation,new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",i,o)),r=this.getLabelSettingsOptions(void 0,e,null,c,u,t),d={cardBuilder:a,dataLabelsProps:i,featureSwitches:this.featureSwitches,includeAltConstantValueSelector:!0,hostServices:this.hostService,options:r,individualSelector:this.getLabelIndividualSelector(!1)};return i.show&&a.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:i.show,value:r.dataLabelsSettings.show}).build()}),a.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){return m.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)}),c)for(var t=0;t<l;t++){var i=n.series[t],a=i.labelSettings||n.dataLabelsSettings,r=(a.position&&u.indexOf(a.position)<0&&(a.position=g),i.identity.getSelector()),a=s.getLabelSettingsOptions(void 0,a,r,void 0,u);d.includeAltConstantValueSelector=!1,d.selector=n.hasDynamicSeries?p.normalizeSelector(r):r,d.individualSelector=s.getLabelIndividualSelector(!0),d.options=a,d.displayDisabledSlices=((r={}).labelOverflow=!0,r),e.addContainerItem(i.displayName,i.displayName,function(e){return m.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)})}})}),a.build()},y.prototype.getTotalsCard=function(){var e,t,i=this,a=this.originalData.totalLabelsSettings;if(a&&!y.isClustered(this.chartType)&&!this.ribbonChart&&!y.isStacked100(this.chartType))return e=__assign(__assign({},m.columnChartProps.totals),{precision:m.columnChartProps.totals.labelPrecision,displayUnits:m.columnChartProps.totals.labelDisplayUnits}),t=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("totals"),"Visual_DataTotalLabels",e,function(e){return i.hostService.getLocalizedString(e)}),this.supportsTotalLabels()?(a={cardBuilder:t,dataLabelsProps:e,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:this.getTotalLabelSettingsOptions(void 0,a),individualSelector:this.getLabelIndividualSelector(!1)},m.DataLabelViewModel.getDataLabelsFormattingModel(a)):(a=!(!this.data||!this.data.multipleIdentity),t.withDisabled(!0,a?"Visual_Totals_DisabledReason_SmallMultiples":"Visual_Totals_DisabledReason"),t.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:e.show,value:!1}).build()}),t.build())},y.prototype.getLabelIndividualSelector=function(e){return m.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:null!=_.first(this.originalData.categories),hasDynamicSeries:this.originalData.hasDynamicSeries,hasSeriesSelector:e})},y.prototype.getErrorBarsCard=function(){var n=this;if(!this.isStacked()&&!this.ribbonChart){var l,e,c=this.originalData;if(c&&c.series&&0!==c.series.length)return l=function(e){return n.hostService.getLocalizedString(e)},e=[(e=m.StandardObjectIdentifiers.error).enabled,e.errorRange,e.barShow,e.barMatchSeriesColor,e.barColor,e.barWidth,e.barBorderColor,e.barBorderSize,e.markerShape,e.markerSize,e.labelShow,e.labelFontFamily,e.labelFontSize,e.labelBold,e.labelItalic,e.labelUnderline,e.labelColor,e.labelMatchSeriesColor,e.labelFormat,e.labelBackground,e.labelBackgroundColor,e.labelBackgroundTransparency,e.showMarkerByDefault,e.tooltipShow,e.tooltipFormat],(e=new m.builder.FormattingCardBuilder(new m.builder.FormattingCardUidBuilder("errorBars"),"Visual_Error_Bars",e,l,!0,!0)).addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("measure",function(s){s.withDisplayName("Series");for(var e=0,t=c.valuesMetadataBySeries;e<t.length;e++)!function(e){var t,i,a,r,o=_.first(e.usedInSeriesIndices);null!=o&&(t=e.metadataColumn,o=c.series[o],i=__assign({},e.valueSelector.getSelector()),a=__assign(__assign({},i),{data:[d.create()],highlightMatching:1}),r={localize:l,uncertainty:o.uncertainty,targetMeasure:e.metadataColumn.expr,measureSelector:i,dataPointSelector:a,featureSwitches:n.featureSwitches,uncertaintyOptions:{isCombo:n.isComboChart,hideBand:!0}},s.addContainerItem(t.queryName,t.displayName,function(e){return m.UncertaintyHelper.getFormattingContainer(r,e)}))}(t[e])})}),e.build()}},y.prototype.getRibbonDataPointFormattingOptions=function(e){var t=this,a=this.originalData;if(a){var i=a.series.length;if(0!==i)return{localize:function(e){return t.hostService.getLocalizedString(e)},categoryAxisData:e,ribbonChartData:this.data.ribbonChartData,data:a,colorOptions:{groupBuilder:void 0,colorProps:m.columnChartProps.dataPoint,featureSwitches:this.featureSwitches,hostService:this.hostService,options:{dataView:this.dataView,style:this.style,categories:_.map(a.series[0].data,function(e){var t,i=(i=null==(i=null==(t=a.categoryIdentities)?void 0:t[e.categoryIndex])?void 0:i.call(t))||e.identity;return{color:e.color,displayName:a.categoryFormatter.format(a.categories[e.categoryIndex]),identity:i}}),fillInstanceKind:3,multipleRole:a.multipleIdentity?m.columnRoleNames.rows:void 0}}}}},y.prototype.getSubSelectionStyles=function(e){var t,e=_.first(e).visualObjects;if(0<e.length){(e=e[0])&&e.selectorsByColumn&&(t=p.normalizeSelector(p.convertSelectorsByColumnToSelector(e.selectorsByColumn)));var i=1===this.data.series.length;switch(e.objectName){case"columns":var a="".concat("Visual","-").concat("bars"),r="".concat("bars","-").concat("colors"),o="".concat(r,"-").concat("datapoint");return i&&this.data.categoryMetadata&&!this.data.hasDynamicSeries&&(o="".concat(r,"-defaultColor"),t={data:[u.data.DataViewWildcard.create(1)]}),s.getShapeSubSelectionStyles(a,r,o,this.hostService,!1,!0,t);case"data-labels":return s.getDataLabelsSubSelectionStyles({hostServices:this.hostService,omitSelectorForSingleSeries:i,individualSelector:this.getLabelIndividualSelector(!i),selector:t,repetitionSelector:void 0,inContainer:!0});case"total-labels":return s.getTotalLabelsSubSelectionStyles(this.hostService,this.getLabelIndividualSelector(!1),void 0);default:return}}},y.prototype.getSubSelectionShortcuts=function(e,t){if(!t){t=_.first(e).visualObjects;if(0<t.length){var i,e=t[0],t=!this.showLabelPerSeries(),t=(t||_.isEmpty(e.selectorsByColumn)||(i=p.normalizeSelector(p.convertSelectorsByColumnToSelector(e.selectorsByColumn))),t?"".concat("Visual","-").concat("labels"):"".concat("labels-applySettingsTo-series","--showSeries")),a="".concat("Visual","-").concat("totals"),r=y.isBar(this.chartType);if("columns"===e.objectName){e=[{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("bars"),groupUid:"".concat("bars","-").concat("colors")}],label:this.hostService.getLocalizedString(r?"Format_Bars":"Format_Columns")}];return this.supportsTotalLabels()&&e.unshift({type:2,sourceUid:a,enabledLabel:this.hostService.getLocalizedString("Format_AddTotalLabels")}),e.unshift({type:0,excludedResetSourceUids:[{sourceUid:a},{sourceUid:t,selector:i}]},{type:2,sourceUid:t,enabledLabel:this.hostService.getLocalizedString("Format_AddDataLabels"),selector:i}),e}}}},y.prototype.enumerateDataLabels=function(e){var t=this.originalData,i=t.dataLabelsSettings,a=t.series.length,r=1<a||!t.categoryMetadata||this.isComboChart,o=t.dataLabelsSettings.position!==m.labelPosition.outsideEnd,s=S(this.chartType,t.series.length)?m.clusteredValidLabelPositionOptions:m.stackedValidLabelPositionOptions;if(m.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,i,null,r,s,o),this.featureSwitches),r&&i.showLabelPerSeries)for(var n=0;n<a;n++){var l=t.series[n],c=l.labelSettings||t.dataLabelsSettings,u=l.identity.getSelector();t.hasDynamicSeries&&(u=p.normalizeSelector(u)),e.pushContainer({displayName:l.displayName}),m.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,c,u,void 0,s),this.featureSwitches),e.popContainer()}},y.prototype.showSeriesCard=function(){return!(this.isComboChart&&!this.data.hasY2Role)},y.prototype.enumerateSeriesDataLabels=function(e){var t,i;this.showSeriesCard()&&(t=this.originalData.seriesLabelSetings,i=this.showLabelPerSeries(),m.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,t,null,i),this.featureSwitches))},y.prototype.getLabelSettingsOptions=function(e,t,i,a,r,o){var s=!!i;return{enumeration:e,dataLabelsSettings:t,show:!0,position:!_.isEmpty(r),positionObject:r,labelOrientation:!y.isBar(this.chartType)&&!s,displayUnits:!y.isStacked100(this.chartType),precision:!0,selector:i,showAll:a,fontSize:!0,fontFamily:!0,labelDensity:this.data&&this.data.scalarCategoryAxis,labelOverflow:!s&&o,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},y.prototype.getSeriesLabelSettingsOptions=function(e,t,i,a){return{enumeration:e,show:!0,seriesLabelsSettings:t,seriesColor:t.seriesColor,seriesPosition:t.seriesPosition,selector:i,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,fontProperties:t.fontProperties,seriesWordWrap:t.seriesWordWrap,seriesMaximumWidth:t.seriesMaximumWidth,defaultSeriesWidth:t.defaultSeriesWidth,showAll:a,fontSize:!0,fontFamily:!0,bold:!0,italic:!0,underline:!0}},y.prototype.showLabelPerSeries=function(){var e=this.originalData;return 1<e.series.length||!e.categoryMetadata||this.isComboChart},y.prototype.enumerateTotalLabels=function(e){var t=this.originalData.totalLabelsSettings;t&&m.DataLabelViewModel.enumerateDataLabels(this.getTotalLabelSettingsOptions(e,t),this.featureSwitches)},y.prototype.getTotalLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,showPositiveAndNegative:!0,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},y.prototype.enumerateDataPoints=function(e){var t,a=this.originalData;a&&0!==(t=a.series.length)&&(a.hasDynamicSeries||1<t||!a.categoryMetadata?u.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:a.series},this.featureSwitches):u.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(a.series[0].data,function(e){var t,i=(i=null==(i=null==(t=a.categoryIdentities)?void 0:t[e.categoryIndex])?void 0:i.call(t))||e.identity;return{color:e.color,displayName:a.categoryFormatter.format(a.categories[e.categoryIndex]),identity:i}}),fillInstanceKind:3,multipleRole:a.multipleIdentity?m.columnRoleNames.rows:void 0},this.featureSwitches))},y.prototype.calculateAxesProperties=function(e){this.currentViewport=e.viewport,this.viewModelAdapterFactory&&this.originalData&&(r=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=r.getData());var t,i,a,r=this.data,o=this.margin=e.margin,s=this.ribbonChart?y.ribbonChartInnerPaddingRatio:e.innerPaddingRatio,n=null!=(n=null==(n=null==r?void 0:r.categories)?void 0:n.length)?n:0,l=r?this.getCategoryLayout(n,e.categoryAxisOptions,e.trimOrdinalDataOnOverflow,e.outerPaddingRatio,s):this.getEmptyChartLayout(),r=this.adjustLayoutForScroll(r,n,e.trimOrdinalDataOnOverflow,l),n=(this.updateColumnChart(r,l),y.isBar(this.chartType)),c=y.isStacked100(this.chartType),u=n?(t=e.valueAxisOptions,e.categoryAxisOptions):(t=e.categoryAxisOptions,e.valueAxisOptions),d=this.strategy.createXAxis({is100Pct:c,forcedTickCount:e.forcedTickCount,includeXDomain:t.includeDomain,axisZoom:e.axisZoom,axisScaleType:t.scaleType,logAxisScale:t.logAxisScale,axisDisplayUnits:t.displayUnits,axisPrecision:t.precision,outerPaddingRatio:n?0:l.outerPaddingRatio,margin:o,innerPaddingRatio:s,invertAxis:t.invertAxis,switchAxisPosition:t.switchAxisPosition},this.featureSwitches),l=this.strategy.createYAxis({is100Pct:c,forcedTickCount:e.forcedTickCount,includeYDomain:u.includeDomain,axisZoom:e.axisZoom,axisScaleType:u.scaleType,logAxisScale:u.logAxisScale,axisDisplayUnits:u.displayUnits,axisPrecision:u.precision,outerPaddingRatio:n?l.outerPaddingRatio:0,margin:o,innerPaddingRatio:s,invertAxis:u.invertAxis,switchAxisPosition:u.switchAxisPosition},this.featureSwitches),h=null==(h=r.dataLabelsSettings)?void 0:h.show,p=(null==(p=r.totalLabelsSettings)?void 0:p.show)&&this.supportsTotalLabels(),h=h&&y.isClustered(this.chartType);return(p||h)&&(p=y.adjustDomainForLabels(n,r,d,l),n?(i=m.AxisHelper.createScalarDomainOptions(d.scale.domain(),0),a=m.AxisHelper.mergeScalarAxisDomains(m.AxisHelper.createScalarDomainOptions(p,0,[!0,!0]),t.includeDomain,i),d=this.strategy.createXAxis({is100Pct:c,forcedTickCount:e.forcedTickCount,includeXDomain:a,axisZoom:e.axisZoom,axisScaleType:t.scaleType,logAxisScale:t.logAxisScale,axisDisplayUnits:t.displayUnits,axisPrecision:t.precision,outerPaddingRatio:0,margin:o,innerPaddingRatio:s,skipAxisZoomUpdate:!0,invertAxis:t.invertAxis,switchAxisPosition:t.switchAxisPosition},this.featureSwitches)):(i=m.AxisHelper.createScalarDomainOptions(l.scale.domain(),0),a=m.AxisHelper.mergeScalarAxisDomains(m.AxisHelper.createScalarDomainOptions(p,0,[!0,!0]),u.includeDomain,i),l=this.strategy.createYAxis({is100Pct:c,forcedTickCount:e.forcedTickCount,includeYDomain:a,axisZoom:e.axisZoom,axisScaleType:u.scaleType,logAxisScale:u.logAxisScale,axisDisplayUnits:u.displayUnits,axisPrecision:u.precision,outerPaddingRatio:0,margin:o,innerPaddingRatio:s,skipAxisZoomUpdate:!0,invertAxis:u.invertAxis,switchAxisPosition:u.switchAxisPosition},this.featureSwitches))),[d,l]},y.prototype.setAxesLayout=function(e){this.currentViewport=e.layout.viewport,this.viewModelAdapterFactory&&this.originalData&&(i=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=i.getData()),this.xAxisProperties=e.layout.axes.x,this.yAxisProperties=e.layout.axes.y1,this.margin=e.layout.margin;var t,i=y.isBar(this.chartType)?this.yAxisProperties:this.xAxisProperties,i=this.data?{categoryCount:_.isEmpty(i.categoryIdentities)?0:i.categoryIdentities.length,categoryThickness:i.categoryThickness,outerPaddingRatio:i.outerPaddingRatio,innerPaddingRatio:i.innerPaddingRatio,isScalar:this.getVisualCategoryAxisIsScalar()}:this.getEmptyChartLayout();this.data=this.adjustLayoutForScroll(this.data,null!=(t=null==(t=null==(t=this.data)?void 0:t.categories)?void 0:t.length)?t:0,e.trimOrdinalDataOnOverflow,i),this.updateColumnChart(this.data,i)},y.prototype.getAxesDomains=function(e,t){var i,a={};return this.data&&(t.categoryAxis&&this.data.scalarCategoryAxis&&(i=m.AxisHelper.createDomain(this.data.series,null!=(i=null==(i=this.data.categoryMetadata)?void 0:i.type)?i:u.ValueType.fromDescriptor({text:!0}),this.data.scalarCategoryAxis,void 0))&&(m.AxisHelper.assertScalarDomain(i.domain),a.categoryAxis=[i.domain[0],i.domain[1]]),t.valueAxis)&&(i=y.isStacked100(this.chartType),t=void 0,i=(t=this.isStacked()||this.ribbonChart?[(i=m.StackedUtil.calcValueDomain(this.data.series,i)).min,i.max]:m.AxisHelper.createUncertaintyAwareValueDomain(this.data.series,e)||m.emptyDomain)[0],e=t[1],void 0!==i)&&void 0!==e&&(a.valueAxis=[i,e]),a},y.prototype.getEmptyChartLayout=function(){return{categoryCount:0,categoryThickness:m.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:0,innerPaddingRatio:0,isScalar:!1}},y.prototype.updateColumnChart=function(e,t){var i=this.getPreferredPlotArea(t.isScalar,t.categoryCount,t.categoryThickness,t.outerPaddingRatio),i={height:i.height,width:i.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,margin:this.margin,layout:t,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.availableHeight,viewportWidth:this.availableWidth,is100Pct:y.isStacked100(this.chartType),isComboChart:this.isComboChart};this.strategy=y.getChartStrategy(this.chartType,this.data&&this.data.series.length),this.strategy.setData(e),this.applyInteractivity(i),this.strategy.setupVisualProps(i),this.strategy.setAxisProperties(this.xAxisProperties,this.yAxisProperties)},y.prototype.adjustLayoutForScroll=function(e,t,i,a){return this.scrolledData=void 0,e&&!a.isScalar&&!this.isScrollable&&i&&(i=Math.min(t,a.categoryCount))!==t&&((e=this.scrolledData=u.Prototype.inherit(e)).series=y.sliceSeries(e.series,i),e.categories=e.categories.slice(0,i),e.categoryIdentities)&&(e.categoryIdentities=e.categoryIdentities.slice(0,i)),e},y.adjustDomainForLabels=function(e,t,i,a){var r,o,s,n,l,a=e?i:a,c=a.dataDomain;if(c&&null!=c[0]&&null!=c[1])return n=c[0].toString(),o=c[1].toString(),r=a.scale,s="",0<t.series.length&&0<t.series[0].data.length&&(s=t.series[0].data[0].labelFormatString),l=m.DataLabelViewModel.createColumnFormatterCacheManager(),i=m.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(i,t.totalLabelsSettings),l=l.getOrCreate(s,t.totalLabelsSettings,i.units,t.totalLabelsSettings.precision),s=m.DataLabelRenderer.getLabelFormattedText(l.format(n)),i=m.DataLabelRenderer.getLabelFormattedText(l.format(o)),n=m.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,s),l=m.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,i),i=s=o=void 0,i=e?(o=u.TextMeasurementService.measureSvgTextWidth(n),s=u.TextMeasurementService.measureSvgTextWidth(l),a.invertAxis?-1:1):(o=u.TextMeasurementService.estimateSvgTextHeight(n),s=u.TextMeasurementService.estimateSvgTextHeight(l),a.invertAxis?1:-1),e=r(c[0])-i*(o+m.DataLabelViewModel.labelMargin),n=r(c[1])+i*(s+m.DataLabelViewModel.labelMargin),l=!1,[(t.totalLabelsSettings.showPositiveAndNegative?(l=t.hasPositive,t.hasNegative):(l=t.hasNetPositive,t.hasNetNegative))?r.invert(e):void 0,l?r.invert(n):void 0]},y.prototype.getPreferredPlotArea=function(e,t,i,a){var r={height:this.availableHeight,width:this.availableWidth};return this.isScrollable&&!e&&(e=m.CartesianChartLayout.getPreferredCategorySpan(t,i,a),y.isBar(this.chartType)?r.height=Math.max(e,r.height):r.width=Math.max(e,r.width)),r},y.prototype.applyInteractivity=function(e){var i=this,t=this.interactivity;t&&(t.dragDataPoint&&(e.onDragStart=function(e){e.identity&&i.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),t.isInteractiveLegend)&&(e=function(){var e=d3.mouse(i.mainGraphicsContext.node()),t=e[0],e=e[1],t=i.strategy.getClosestColumnIndex(t,e);i.selectColumn(t)},t=y.getInteractiveColumnChartDomElement(this.element),this.svg.on("click",e),d3.select(t).on("click",e).style("touch-action","none"),e=d3.drag().on("drag",e),this.svg.call(e),d3.select(t).call(e))},y.prototype.selectLastSelectedColumnOrDefault=function(e){void 0===e&&(e=!1);var t=void 0===this.lastInteractiveSelectedColumnIndex?m.CartesianHelper.findMaxCategoryIndex(this.data.series):this.lastInteractiveSelectedColumnIndex;this.selectColumn(t,e)},y.prototype.selectColumn=function(e,t){var i;!(t=void 0!==t&&t)&&this.lastInteractiveSelectedColumnIndex===e||(i=this.createInteractiveLegendDataPoints(e),this.strategy.selectColumn(e,this.lastInteractiveSelectedColumnIndex,t),this.cartesianVisualHost.updateLegend(i),this.lastInteractiveSelectedColumnIndex=e)},y.prototype.createInteractiveLegendDataPoints=function(e){var t=this.data,i=m.Legend.getDefaultLegendData(this.style);if(t&&!_.isEmpty(t.series)){for(var a=m.columnChartProps.general.formatString,r=[],o=t.categories&&t.categories[e],s=t.series,n=t.legendData&&t.legendData.dataPoints,l=new m.ColumnChartConverterHelper(this.dataView,this.style),c=0,u=s.length;c<u;c++){var d,h=l.getValueBySeriesAndCategory(c,e),p=t.valuesMetadata[c],g=m.converterHelper.getFormattedLegendLabel(p,this.dataView.categorical.values,a),y=void 0;y=1===s.length?(d=s[0]).data.length>e&&d.data[e].color:n.length>c&&n[c].color,r.push({color:y,icon:m.LegendIcon.Box,label:g,category:t.categoryFormatter?t.categoryFormatter.format(o):o,measure:m.valueFormatter.format(h,m.valueFormatter.getFormatString(p,a)),identity:m.SelectionId.createNull(),selected:!1,index:c})}i.dataPoints=r}return i},y.prototype.overrideXScale=function(e){this.xAxisProperties=e},y.prototype.render=function(e,t,i){var a,r,e=this.strategy.drawColumns(!e,this.style),o=this.data,s=this.margin,n=this.currentViewport,l=n.height-(s.top+s.bottom),n=n.width-(s.left+s.right),s=this.xAxisProperties.isCategoryAxis&&0===this.xAxisProperties.innerPaddingRatio||this.yAxisProperties.isCategoryAxis&&0===this.yAxisProperties.innerPaddingRatio,c=(this.mainGraphicsContext.attr("height",l).attr("width",n).classed("withCrispEdges",s),this.tooltipsEnabled&&!i?(this.tooltipService.addTooltip(e.eventGroup,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity&&[e.data.identity]}),e.ribbonChartEventGroup&&this.tooltipService.addTooltip(e.ribbonChartEventGroup,function(e){return e.data&&e.data.tooltipInfo},function(){return[m.SelectionId.createNull()]})):(this.tooltipService.removeTooltips(e.eventGroup),e.ribbonChartEventGroup&&this.tooltipService.removeTooltips(e.ribbonChartEventGroup)),[]),l=this.strategy.getColumnWidth(),n=this.strategy.getCategoryWidth?this.strategy.getCategoryWidth():l,s=y.isBar(this.chartType);if(this.interactivityService){for(var u=0,d=o.series.length;u<d;u++)c=c.concat(o.series[u].data);a={datapoints:c,columnChartDrawInfo:e,hasHighlights:o.hasHighlights,root:this.mainGraphicsContext,showLabel:o.dataLabelsSettings.show,bandsTransparency:this.data.ribbonChartData?this.data.ribbonChartData.ribbonOptions.bandsTransparency:30,visualInstanceId:this.hostService.instanceId,hitTester:new v({dataPoints:c,isScalar:o.scalarCategoryAxis,hasCategories:!!o.categoryIdentities&&0<o.categoryIdentities.length,isBar:s,isClustered:y.isClustered(this.chartType),categoryAxisScale:this.strategy.getCategoryAxisScale(),columnWidth:l,categoryWidth:n,seriesLength:o.series.length}),useManagedTabIndex:this.useManagedTabIndex},r={navigationStrategy:1<o.series.length?m.DataPointNavigationStrategy.CategoryFirst:m.DataPointNavigationStrategy.CategoryOnly,helper:this}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.selectLastSelectedColumnOrDefault(!0),m.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions),{dataPoints:c,behaviorOptions:a,navigationOptions:r,labelDataPoints:[],labelDataPointGroups:e.labelDataPointGroups,labelsAreNumeric:!0,labelOrientation:o.dataLabelsSettings.labelOrientation,animateLabels:e.animateLabels,categorySubRangeCount:Math.round(n/l),verticalCategoryAxis:s}},y.prototype.getFirstElement=function(e,t){void 0===t&&(t=!1);var i,a,r,o=(this.scrolledData||this.data).series;return _.isEmpty(o)?null:(e=null!=e?e:o[0].data[0].categoryIndex,0<=(i=t?this.findSeriesIndex(o.length-1,e,!1):this.findSeriesIndex(0,e,!0))?(a=this.data.series[i].data[e],r=this.getDataPointElement(i,e)):i=t?o.length-1:0,{element:r,targetCategoryIndex:e,targetSeriesIndex:i,noShape:a&&0===a.valueAbsolute})},y.prototype.getNextDataPoint=function(e,t,i){switch(i=!y.isBar(this.chartType)||this.getVisualCategoryAxisIsScalar()||i!==m.DataDirection.NextSeries&&i!==m.DataDirection.PreviousSeries?i:i===m.DataDirection.NextSeries?m.DataDirection.PreviousSeries:m.DataDirection.NextSeries){case m.DataDirection.NextCategory:e=this.findCategoryIndex(this.data.series[t].data,e,!0);break;case m.DataDirection.PreviousCategory:e=this.findCategoryIndex(this.data.series[t].data,e,!1);break;case m.DataDirection.NextSeries:(t=this.findSeriesIndex(t+1,e,!0))<0&&(e=this.loopIndex(e+1,this.data.categories.length),t=this.findSeriesIndex(0,e,!0));break;case m.DataDirection.PreviousSeries:(t=0<t?this.findSeriesIndex(t-1,e,!1):-1)<0&&(e=this.loopIndex(e-1,this.data.categories.length),t=this.findSeriesIndex(this.data.series.length-1,e,!1))}if(0<=t&&0<=e)var a=this.data.series[t].data,a=(a=this.data.hasHighlights?a.filter(function(e){return!e.highlight}):a)[e],r=this.getDataPointElement(t,e);else if(e<0)switch(i){case m.DataDirection.NextCategory:e=this.loopIndex(e+1,this.data.categories.length);break;case m.DataDirection.PreviousCategory:e=this.loopIndex(e-1,this.data.categories.length)}else switch(i){case m.DataDirection.NextSeries:t=0;break;case m.DataDirection.PreviousSeries:t=this.data.series.length-1}return this.isInViewport(r)?{element:r,targetCategoryIndex:e,targetSeriesIndex:t,noShape:a&&0===a.valueAbsolute}:this.getNextDataPoint(e,t,i)},y.prototype.getSelectorsByColumnFromSubselectedElement=function(e){switch(d3.select(e).attr(m.SubSelectableObjectNameAttribute)){case"columns":var t=d3.select(e).datum().seriesIndex,i=this.data.series;if(!_.isEmpty(i)&&0<=t){i=i[t],i=null==(t=null==i?void 0:i.identity)?void 0:t.getSelectorsByColumn();if(i)return i}case"data-labels":case"series-labels":t=m.DataLabelUtil.getLabelSeriesSelectorsByColumn(e,this.data.series);if(t)return t;default:return}},y.prototype.isInViewport=function(e){var t;return!e||(e=e.getBBox(),t=this.currentViewport,0<e.y+e.height&&e.y<t.height&&0<e.x+e.width&&e.x<t.width)},y.prototype.getDataPointElement=function(t,i){var e=y.isColumn(this.chartType)?".column":".bar";return this.mainGraphicsContext.selectAll(e).filter(function(e){return e.categoryIndex===i&&e.seriesIndex===t}).node()},y.prototype.findSeriesIndex=function(e,t,i){return(i?_.findIndex:_.findLastIndex)(this.data.series,function(e){return _.some(e.data,function(e){return e.categoryIndex===t&&null!=e.value})},e)},y.prototype.findCategoryIndex=function(e,t,i){var i=i?1:-1,a=_.findIndex(e,function(e){return e.categoryIndex===t});return a<0?a:e[this.loopIndex(a+i,e.length)].categoryIndex},y.prototype.loopIndex=function(e,t){return t<=e?0:e<0?t-1:e},y.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},y.prototype.getCategoryValueType=function(){return m.AxisHelper.getCategoryValueType(this.data.categoryMetadata)},y.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.scalarCategoryAxis},y.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,e=m.AxisHelper.getCategoryValueType(e);return m.AxisHelper.isOrdinal(e)?m.axisType.categorical:m.axisType.both},y.prototype.setFilteredData=function(e,t){var i=this.scrolledData=u.Prototype.inherit(this.data);return i.series=y.sliceSeries(i.series,t,e),i.categories=i.categories.slice(e,t),this.strategy.setData(i),i},y.prototype.supportsTotalLabels=function(){return!!(!this.data||!this.data.multipleIdentity)&&this.isStacked()&&!y.isStacked100(this.chartType)},y.prototype.supportsTrendLine=function(){var e,t;return!this.data.multipleIdentity&&(e=this.dataView,e=u.data.createDataViewCategoricalReader(e),t=this.getVisualCategoryAxisIsScalar(),12===this.chartType)&&t&&e.data.hasValues("Y")},y.prototype.supportsStaticReferenceLines=function(){return 68!==this.chartType},y.prototype.supportsValueAxis=function(){return 68!==this.chartType},y.prototype.isStacked=function(){return y.isStacked(this.chartType,this.data&&this.data.series.length)},y.isBar=function(e){return a.hasFlag(e,2)},y.isColumn=function(e){return a.hasFlag(e,4)},y.isClustered=function(e){return a.hasFlag(e,8)},y.isStacked=function(e,t){return a.hasFlag(e,16)&&(1!==t||y.isStacked100(e))},y.isStacked100=function(e){return a.hasFlag(e,48)},y.isRibbon=function(e){return a.hasFlag(e,64)},y.isHistogram=function(e){return a.hasFlag(e,128)},y.prototype.getCartesianVisualCapabilities=function(){var e=this.supportsValueAxis(),t=e&&!this.isStacked();return{supportsHierarchicalCategoryAxis:!0,supportsValueAxis:e,axesCapabilities:{categoryAxis:{domainAggregateRole:m.columnRoleNames.category,supportedDomainAggregates:this.data&&this.data.scalarCategoryAxis?3:0},valueAxis:{domainAggregateRole:m.columnRoleNames.y,supportedDomainAggregates:t?3:1}}}},y.prototype.getStaticSeriesRole=function(){return"Y"},y.getRibbonsUtils=function(){return u.ribbonChartUtilsModuleFactory()},y.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},y.prototype.getDataViewObjectLayerChanges=function(e){var t,i,a,r;return this.featureSwitches.onObject?(t={type:0,visualChangeObject:{objectName:"labels",propertyName:"revertToDefault",propertyValue:void 0,propertyType:{bool:!0}}},i=this.isComboChart?m.comboChartObjectProps:m.columnChartProps,a=(r=1===this.data.series.length)?m.DataViewObjectChangeHelper.createToggleTurnOnAction:m.DataViewObjectChangeHelper.createSeriesLevelToggleTurnOnAction,r=r?void 0:e[0].selector,r=a(i.labels.backgroundColor,this.data.dataLabelsSettings.enableBackground,[{type:0,visualChangeObject:__assign(__assign({objectName:"labels"},a={propertyName:"enableBackground",propertyValue:!0,propertyType:{bool:!0}}),r?{selector:r}:{})}]),a=m.DataViewObjectChangeHelper.createToggleTurnOnAction(i.totals.backgroundColor,this.data.totalLabelsSettings.enableBackground,[{type:0,visualChangeObject:__assign({objectName:"totals"},a)}]),r=[r,m.DataViewObjectChangeHelper.createSeriesLevelToggleTurnOnAction(i.labels.showSeries,this.data.dataLabelsSettings.show,[{type:0,visualChangeObject:__assign(__assign({},i.labels.showByDefault),{propertyValue:!1,propertyType:{bool:!0}})},{type:0,visualChangeObject:__assign(__assign({},i.labels.show),{propertyValue:!0,propertyType:{bool:!0}})}]),m.DataViewObjectChangeHelper.createTopLevelToggleTurnOffAction(i.labels.show,[t]),m.DataViewObjectChangeHelper.createAllSeriesTogglesTurnOffAction(i.labels.showSeries,this.data.dataLabelsSettings.show,this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:null==(e=e.labelSettings)?void 0:e.show}}),[t]),a],m.DataViewObjectChangeHelper.getDataViewObjectsBehaviorChanges(e,r)):[]},y.RibbonChartItemClasses=e("ribbonChartArea"),y.RibbonChartLayerClasses=e("ribbonChartLayer"),y.ribbonChartInnerPaddingRatio=.6,y.DefaultZeroScalarDomain=[0,1],y);function y(e){var t=e.chartType;this.chartType=t,this.isScrollable=e.isScrollable,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.ribbonChart=68===this.chartType,this.viewModelAdapterFactory=e.viewModelAdapterFactory}m.ColumnChart=r,t.prototype.queryRegion=function(e){var t,i,a,r,o=this,s=[],e=e.dataSpace;return(this.isScalar||this.hasCategories&&!_.some([e.bottom,e.left,e.right,e.top],function(e){return void 0===e}))&&(r=(this.isBar?(i=this.isScalar?(t=e.bottom.value,e.top.value):(t=this.getAdjustedCategoryIndex(e.top.value,e.top.seriesIndex,this.seriesLength),this.getAdjustedCategoryIndex(e.bottom.value,e.bottom.seriesIndex,this.seriesLength)),a=e.left.value,e.right):(i=this.isScalar?(t=e.left.value,e.right.value):(t=this.getAdjustedCategoryIndex(e.left.value,e.left.seriesIndex,this.seriesLength),this.getAdjustedCategoryIndex(e.right.value,e.right.seriesIndex,this.seriesLength)),a=e.bottom.value,e.top)).value,s=_.filter(this.dataPoints,function(e){return 0!==e.valueAbsolute&&t<=i&&a<=r&&n.overlappingRange(t,i,o.getAreaCategoryBound(e,!1),o.getAreaCategoryBound(e,!0))&&n.overlappingRange(a,r,o.getAreaValueLowerBound(e),o.getAreaValueUpperBound(e))})),s},t.prototype.getAreaValueLowerBound=function(e){return this.isClustered?Math.min(0,e.value):e.position-e.valueAbsolute},t.prototype.getAreaValueUpperBound=function(e){return this.isClustered?Math.max(0,e.value):e.position},t.prototype.getAreaCategoryBound=function(e,t){var i,a;return this.isScalar?(t=(t=this.isBar?!t:t)?this.columnWidth:0,i=this.isClustered?e.seriesIndex:0,a=this.categoryAxisScale(e.categoryValue)-this.categoryWidth/2,m.AxisHelper.invertScale(this.categoryAxisScale,a+i*this.columnWidth+t,0,0,void 0).value):this.getAdjustedCategoryIndex(e.categoryIndex,e.seriesIndex,this.seriesLength)},t.prototype.getAdjustedCategoryIndex=function(e,t,i){return this.isClustered?e*i+t:e};var v=t;function t(e){e.columnWidth,e.categoryWidth,this.categoryAxisScale=e.categoryAxisScale,this.categoryWidth=e.categoryWidth,this.columnWidth=e.columnWidth,this.dataPoints=e.dataPoints,this.hasCategories=e.hasCategories,this.isBar=e.isBar,this.isClustered=e.isClustered,this.isScalar=e.isScalar,this.seriesLength=e.seriesLength}function S(e,t){return!r.isStacked(e,t)&&!r.isRibbon(e)}m.ColumnChartHitTester=v,m.canSupportOutsidePosition=S}(powerbi=powerbi||{}),function(e){var l,t;function i(e){return t.call(this,e)||this}l=e.visuals||(e.visuals={}),t=l.BaseAnimator,__extends(i,t),i.prototype.animate=function(e){var t={failed:!0,shapes:null},i=e.viewModel,a=this.previousViewModel;return i.categories.length*i.series.length>l.AnimatorCommon.MaxDataPointsToAnimate||a&&a.categories.length!==i.categories.length||(a&&(i.hasHighlights&&!a.hasHighlights?t=this.animateNormalToHighlighted(e):i.hasHighlights&&a.hasHighlights?t=this.animateHighlightedToHighlighted(e):!i.hasHighlights&&a.hasHighlights&&(t=this.animateHighlightedToNormal(e))),this.previousViewModel=i),t},i.prototype.animateNormalToHighlighted=function(e){var t=e.viewModel,i=e.itemCS,a=e.layout,r=e.series.selectAll(i.selector).data(function(e){return e.data},function(e){return e.key}),o=e.interactivityService&&e.interactivityService.hasSelection(),s=t.hasHighlights,n=r.enter().append("rect").attr("class",function(e){return i.class.concat(e.highlight?" highlight":"")}).attrs(a.shapeLayoutWithoutHighlights).merge(r),a=(n.style("fill",function(e){return e.color}).attr("aria-hidden",function(e){return!!e.highlight||null}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,o,s)}).transition().duration(this.animationDuration).attrs(a.shapeLayout),r.exit().remove(),l.ColumnUtil.drawUncertainty(t,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService));return{failed:!1,shapes:n,uncertaintyShapes:a}},i.prototype.animateHighlightedToHighlighted=function(e){return{failed:!1,shapes:this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS,e.interactivityService&&e.interactivityService.hasSelection()),uncertaintyShapes:l.ColumnUtil.drawUncertainty(e.viewModel,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService)}},i.prototype.animateHighlightedToNormal=function(e){var t=e.itemCS,i=e.series.selectAll(t.selector).data(function(e){return e.data},function(e){return e.key}),a=e.interactivityService&&e.interactivityService.hasSelection(),r=i.enter().append("rect").attr("class",function(e){return t.class.concat(e.highlight?" highlight":"")}).merge(i),i=(r.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,e.selected,!e.selected)}).attr("aria-hidden",function(e){return!!e.highlight||null}).transition().duration(this.animationDuration).attrs(e.layout.shapeLayout).transition().duration(0).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,a,!1)}),i.exit().transition().duration(this.animationDuration).attrs(a?e.layout.zeroShapeLayout:e.layout.shapeLayoutWithoutHighlights).remove(),l.ColumnUtil.drawUncertainty(e.viewModel,e.isBar,e.mainGraphicsContext,e.valueAxisProps,e.layout,e.columnWidth,e.interactivityService));return{failed:!1,shapes:r,uncertaintyShapes:i}},i.prototype.animateDefaultShapes=function(t,e,i,a,r){var e=e.selectAll(a.selector).data(function(e){return e.data},function(e){return e.key}),o=e.enter().append("rect").attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}).merge(e);return o.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return l.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,t.hasHighlights)}).attr("aria-hidden",function(e){return!!e.highlight||null}).transition().duration(this.animationDuration).attrs(i.shapeLayout),e.exit().remove(),o},l.WebColumnChartAnimator=i}(powerbi=powerbi||{}),function(e){var n=e.visuals||(e.visuals={}),l=jsCommon.BrowserUtils,c=jsCommon.DOMConstants.mouseClickEventName;function t(){}t.prototype.create=function(){return new i},n.ColumnChartWebBehaviorFactory=t,a.prototype.bindEvents=function(e,i,t,a){var r=this,o=(this.options=e,this.hitTester=e.hitTester,e.columnChartDrawInfo.eventGroup),s=e.root;a?(o&&(o.on(c,null),o.on("keydown.select",null),n.InteractivityUtils.removeStandardContextMenuHandler(o)),n.InteractivityUtils.removeStandardInteractivityHandlers(s)):(t&&(a=t.dataPointNavigationManager,t=t.pointSourceKey,a.isEmpty(t)||(n.InteractivityUtils.appendUseElementForFocus(s,e.visualInstanceId,t),n.InteractivityUtils.registerEnterPlotAreaHandler(s,a,t),n.InteractivityUtils.registerDataPointNavigationHandler(s,a,t),n.InteractivityUtils.registerClearCatcherShortcut(s,i))),o.on(c,function(){return r.handleSelection(i)}).on("keydown.select",function(){var e=d3.event.keyCode;32!==e&&13!==e||r.handleSelection(i)},!0),o.on("contextmenu",function(){var t,e=d3.event;l.isCtrlOrMeta(e)||(e.preventDefault(),n.EventBubblingUtil.markAsHandled(e),t=n.InteractivityUtils.getPositionOfLastInputEvent(),n.InteractivityUtils.tryToSelectD3Target(function(e){return i.handleContextMenu(e,t)}))}))},a.prototype.renderSelection=function(t){var e,i=this.options,a=i.columnChartDrawInfo;a.ribbonChartEventGroup&&(e=(100-i.bandsTransparency)/100,e=n.ColumnUtil.getFillOpacity(!1,!1,t,i.hasHighlights,e),a.ribbonChartEventGroup.style("fill-opacity",e).style("stroke-opacity",e)),a.shapesSelection.attr("aria-selected",function(e){return e.selected}).style("fill-opacity",function(e){return n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights)}).style("stroke-opacity",function(e){return n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights)}),a.uncertaintyShapes&&(null!=(e=a.uncertaintyShapes.bars)&&e.each(function(e){e.uncertainty.bar;d3.select(this).selectAll(n.ColumnUtil.UncertaintyBar.selector).style("fill-opacity",function(e){return t?n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights):null}).style("stroke-opacity",function(e){return t?n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,i.hasHighlights):null})}),null!=(e=a.uncertaintyShapes.markerPaths)&&e.style("opacity",t?n.ColumnUtil.getFillOpacity(!1,!0,t,i.hasHighlights):null),null!=(a=(e=a.uncertaintyShapes).updateActiveHighlightMarkers))&&a.call(e,t,i.hasHighlights)},a.prototype.renderFocus=function(e){var t="".concat(n.CurrentFocusDataPointId,"-").concat(this.options.visualInstanceId);this.options.root.select("#"+t).attr("id",null),e&&(e.setAttribute("id",t),(t=this.options.root.select("#".concat(t))).empty()||(t.attr("aria-label",function(e){return e.formattedTooltip}),l.focus(e)))},a.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},a.prototype.getLassoSelectDirectionMode=function(){return 2},a.prototype.handleSelection=function(t){n.InteractivityUtils.tryToSelectD3Target(function(e){return n.InteractivityUtils.handleSelection(e,t)},!this.options.useManagedTabIndex)};var i=a;function a(){}n.ColumnChartWebBehavior=i}(powerbi=powerbi||{}),function(e){var y;function u(){}function d(){}y=e.visuals||(e.visuals={}),u.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.hostService=e.hostService,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},u.prototype.setData=function(e){this.data=e},u.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t,e&&this.setSeriesOffsetScale(e.innerPaddingRatio)},u.prototype.createXAxis=function(e,t){var i=e.includeXDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.width,c=y.AxisHelper.hasForcedDomain(i),l=y.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!1,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis,y.AxisOrientation.bottom);return this.setSeriesOffsetScale(e.innerPaddingRatio),l},u.prototype.createYAxis=function(e,t){e.is100Pct;var i=e.forcedTickCount,a=e.includeYDomain,r=e.axisScaleType,o=e.logAxisScale,s=e.axisDisplayUnits,n=e.axisPrecision,l=e.outerPaddingRatio,c=e.margin,u=this.viewportHeight,d=y.AxisHelper.createUncertaintyAwareValueDomain(this.data.series)||y.emptyDomain,h=y.AxisHelper.getAxisFormatString(this.data.series),p=y.AxisHelper.mergeScalarAxisDomains(a,y.AxisHelper.createScalarDomainOptions(d,0)),d=y.AxisHelper.scaleShouldClamp(p&&p.domain,d),a=(a&&_.includes(a.domainSources,10)&&a.forced&&a.domain,y.AxisHelper.hasForcedDomain(p));return y.AxisHelper.createAxis({pixelSpan:u,domainOptions:p,axisZoom:e.axisZoom,zeroScalarDomain:y.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:null!=h?h:y.valueFormatter.getFormatString(this.data.valuesMetadata[0],y.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,logAxisScale:o,axisDisplayUnits:s,axisPrecision:n,shouldClamp:d,outerPaddingRatio:l,margin:c,preventNice:a,includeZero:y.AxisHelper.shouldIncludeZero(p),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,featureSwitches:t,orientation:e.switchAxisPosition?y.AxisOrientation.right:y.AxisOrientation.left})},u.prototype.createLabelDataPoints=function(e){return y.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!0,e,this.yProps.invertAxis)},u.prototype.createUncertaintyLabels=function(e){return y.ColumnUtil.createUncertaintyLabels(this.data,this.layout,this.getColumnWidth(),this.yProps,!1,e,this.hostService)},u.prototype.getColumnWidth=function(){return this.getCategoryWidth()/this.data.series.length},u.prototype.getCategoryWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},u.prototype.getCategoryAxisScale=function(){return this.xProps.scale},u.prototype.drawColumns=function(e,t){var i,a,r,o=this.data,s=(this.columnsCenters=null,this.getCategoryWidth()),s={columnWidth:this.getColumnWidth(),categoryWidth:s,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.yProps.invertAxis},n=this.layout=u.getLayout(o,s),l=o.dataLabelsSettings,c=[],l=(l&&l.show&&(c=this.createLabelDataPoints(t)),_.filter(o.series,function(e){return null==(e=e.uncertainty)?void 0:e.labels.show})),l=(_.isEmpty(l)||(c=c.concat(this.createUncertaintyLabels(t))),y.ColumnUtil.drawSeries(o,this.graphicsContext.mainGraphicsContext,s));return this.animator&&e&&(a=(i=this.animator.animate({viewModel:o,series:l,valueAxisProps:this.yProps,isBar:!1,columnWidth:this.getColumnWidth(),layout:n,itemCS:u.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes,r=i.uncertaintyShapes),this.animator&&e&&!i.failed||(r=y.ColumnUtil.drawUncertainty(o,!1,this.graphicsContext.mainGraphicsContext,this.yProps,this.layout,this.getColumnWidth(),this.interactivityService),a=y.ColumnUtil.drawDefaultShapes(o,l,n,u.classes.item,!this.animator,this.interactivityService,this.hostService,!1),y.ColumnUtil.orderColumnChartShapes(this.graphicsContext.mainGraphicsContext)),y.ColumnUtil.applyInteractivity(a,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:a,uncertaintyShapes:r,viewport:{height:this.height,width:this.width},axisOptions:s,labelDataPointGroups:c,animateLabels:i&&!i.failed}},u.prototype.selectColumn=function(e,t,i){y.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,u.classes.item.selector,e,t,i),this.moveHandle(e)},u.prototype.getClosestColumnIndex=function(e,t){return y.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},u.prototype.getColumnsCenters=function(){var t,e,i=this;return this.columnsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.columnsCenters=e.data.map(function(e){return i.xProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.columnsCenters},u.prototype.setSeriesOffsetScale=function(e){var t=this.data.series.length,e=this.categoryLayout.categoryThickness*(1-e)/t;this.seriesOffsetScale=d3.scaleBand().domain(this.data.series.map(function(e){return e.index.toString()})).range([0,t*e])},u.prototype.moveHandle=function(e){var t,i=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentElement)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(a=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({x1:a,x2:a}),t.select("circle").attrs({cx:a})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:a,x2:a,y1:0,y2:this.height}),t.append("circle").attrs({cx:a,cy:this.height,r:"6px"}).classed("drag-handle",!0)))},u.getLayout=function(e,t){var i=t.columnWidth,a=.5*i,r=a/2,o=t.isScalar,s=t.xScale,n=t.yScale,l=t.seriesOffsetScale,c=t.invertAxis,u=n(0),d=0;return o&&(d=t.categoryWidth/2),{shapeLayout:{width:function(e){return e.drawThinner?a:i},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},y:function(e){e=c?Math.min(0,e.value):Math.max(0,e.value);return u+y.AxisHelper.diffScaled(n,e,0)},height:function(e){return Math.abs(y.AxisHelper.diffScaled(n,0,e.value))}},shapeLayoutWithoutHighlights:{width:function(e){return i},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d},y:function(e){e=c?Math.min(0,e.originalValue):Math.max(0,e.originalValue);return u+y.AxisHelper.diffScaled(n,e,0)},height:function(e){return Math.abs(y.AxisHelper.diffScaled(n,0,e.originalValue))}},zeroShapeLayout:{width:function(e){return e.drawThinner?a:i},x:function(e){return s(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},y:function(e){return u},height:function(e){return 0}},uncertaintyLayout:{lower:function(e){e=e.uncertainty&&e.uncertainty.lower;if(null!=e)return n(e)},upper:function(e){e=e.uncertainty&&e.uncertainty.upper;if(null!=e)return n(e)}}}},u.classes={item:{class:"column",selector:".column"}},y.ClusteredColumnChartStrategy=u,d.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.hostService=e.hostService,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},d.prototype.setData=function(e){this.data=e},d.prototype.setAxisProperties=function(e,t){this.xProps=e,(this.yProps=t)&&this.setSeriesOffsetScale(t.innerPaddingRatio)},d.prototype.createYAxis=function(e,t){var i=e.includeYDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.height,c=y.AxisHelper.hasForcedDomain(i),l=y.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!0,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis,e.switchAxisPosition?y.AxisOrientation.right:y.AxisOrientation.left);return this.setSeriesOffsetScale(e.innerPaddingRatio),l},d.prototype.createXAxis=function(e,t){e.is100Pct;var i=e.forcedTickCount,a=e.includeXDomain,r=e.axisScaleType,o=e.logAxisScale,s=e.axisDisplayUnits,n=e.axisPrecision,l=e.outerPaddingRatio,c=e.margin,u=e.invertAxis,d=this.width,h=y.AxisHelper.createUncertaintyAwareValueDomain(this.data.series)||y.emptyDomain,p=y.AxisHelper.getAxisFormatString(this.data.series),a=y.AxisHelper.mergeScalarAxisDomains(a,y.AxisHelper.createScalarDomainOptions(h,0)),h=y.AxisHelper.scaleShouldClamp(a&&a.domain,h),g=y.AxisHelper.hasForcedDomain(a),d=y.AxisHelper.createAxis({pixelSpan:d,domainOptions:a,axisZoom:e.axisZoom,zeroScalarDomain:y.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:null!=p?p:y.valueFormatter.getFormatString(this.data.valuesMetadata[0],y.columnChartProps.general.formatString),outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:i,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:r,logAxisScale:o,axisDisplayUnits:s,axisPrecision:n,shouldClamp:h,outerPaddingRatio:l,margin:c,preventNice:g,includeZero:y.AxisHelper.shouldIncludeZero(a),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:u,featureSwitches:t,orientation:y.AxisOrientation.bottom});return d.axis.tickSizeInner(-this.viewportHeight).tickSizeOuter(0),d},d.prototype.createLabelDataPoints=function(e){return y.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!0,e,this.xProps.invertAxis)},d.prototype.createUncertaintyLabels=function(e){return y.ColumnUtil.createUncertaintyLabels(this.data,this.layout,this.getColumnWidth(),this.xProps,!0,e,this.hostService)},d.prototype.getColumnWidth=function(){return this.getCategoryWidth()/this.data.series.length},d.prototype.getCategoryWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},d.prototype.getCategoryAxisScale=function(){return this.yProps.scale},d.prototype.drawColumns=function(e,t){var i,a,r,o=this.data,s=(this.barsCenters=null,this.getCategoryWidth()),s={columnWidth:this.getColumnWidth(),categoryWidth:s,xScale:this.xProps.scale,yScale:this.yProps.scale,seriesOffsetScale:this.seriesOffsetScale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.xProps.invertAxis},n=this.layout=d.getLayout(o,s),l=o.dataLabelsSettings,c=[],l=(l&&l.show&&(c=this.createLabelDataPoints(t)),_.filter(o.series,function(e){return null==(e=e.uncertainty)?void 0:e.labels.show})),l=(_.isEmpty(l)||(c=c.concat(this.createUncertaintyLabels(t))),y.ColumnUtil.drawSeries(o,this.graphicsContext.mainGraphicsContext,s));return this.animator&&e&&(r=(i=this.animator.animate({viewModel:o,series:l,valueAxisProps:this.xProps,columnWidth:this.getColumnWidth(),isBar:!0,layout:n,itemCS:d.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!i.failed||(a=y.ColumnUtil.drawUncertainty(o,!0,this.graphicsContext.mainGraphicsContext,this.xProps,this.layout,this.getColumnWidth(),this.interactivityService),r=y.ColumnUtil.drawDefaultShapes(o,l,n,d.classes.item,!this.animator,this.interactivityService,this.hostService,!0),y.ColumnUtil.orderColumnChartShapes(this.graphicsContext.mainGraphicsContext)),y.ColumnUtil.applyInteractivity(r,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:r,uncertaintyShapes:a,viewport:{height:this.height,width:this.width},axisOptions:s,labelDataPointGroups:c,animateLabels:i&&!i.failed}},d.prototype.selectColumn=function(e,t,i){y.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,d.classes.item.selector,e,t,i),this.moveHandle(e)},d.prototype.getClosestColumnIndex=function(e,t){return y.ColumnUtil.getClosestColumnIndex(t,this.getBarsCenters())},d.prototype.getBarsCenters=function(){var t,e,i=this;return this.barsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.barsCenters=e.data.map(function(e){return i.yProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.barsCenters},d.prototype.setSeriesOffsetScale=function(e){var t=this.data.series.length,e=this.categoryLayout.categoryThickness*(1-e)/t;this.seriesOffsetScale=d3.scaleBand().domain(this.data.series.map(function(e){return e.index.toString()})).range([0,t*e])},d.prototype.moveHandle=function(e){var t,i=this.getBarsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentElement)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(a=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({y1:a,y2:a}),t.select("circle").attrs({cy:a})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:0,x2:this.width,y1:a,y2:a}),t.append("circle").attrs({cx:0,cy:a,r:"6px"}).classed("drag-handle",!0)))},d.getLayout=function(e,t){var i=t.columnWidth,a=.5*i,r=a/2,o=t.isScalar,s=t.xScale,n=t.yScale,l=t.seriesOffsetScale,c=t.invertAxis,u=s(0),d=0;return o&&(d=t.categoryWidth/2),{shapeLayout:{width:function(e){return Math.abs(y.AxisHelper.diffScaled(s,0,e.value))},x:function(e){e=c?Math.max(0,e.value):Math.min(0,e.value);return u+y.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},height:function(e){return e.drawThinner?a:i}},shapeLayoutWithoutHighlights:{width:function(e){return Math.abs(y.AxisHelper.diffScaled(s,0,e.originalValue))},x:function(e){e=c?Math.max(0,e.originalValue):Math.min(0,e.originalValue);return u+y.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d},height:function(e){return i}},zeroShapeLayout:{width:function(e){return 0},x:function(e){e=c?Math.max(0,e.value):Math.min(0,e.value);return u+y.AxisHelper.diffScaled(s,e,0)},y:function(e){return n(o?e.categoryValue:e.categoryIndex)+l(e.seriesIndex)-d+(e.drawThinner?r:0)},height:function(e){return e.drawThinner?a:i}},uncertaintyLayout:{lower:function(e){e=e.uncertainty&&e.uncertainty.lower;if(null!=e)return s(e)},upper:function(e){e=e.uncertainty&&e.uncertainty.upper;if(null!=e)return s(e)}}}},d.classes={item:{class:"bar",selector:".bar"}},y.ClusteredBarChartStrategy=d}(powerbi=powerbi||{}),function(e){var m;function c(){}function u(){}m=e.visuals||(e.visuals={}),c.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight},c.prototype.setData=function(e){this.data=e},c.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t},c.prototype.createXAxis=function(e,t){var i=e.includeXDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.width,c=m.AxisHelper.hasForcedDomain(i);return m.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!1,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis,m.AxisOrientation.bottom)},c.prototype.createYAxis=function(e,t){var i=e.is100Pct,a=e.forcedTickCount,r=e.includeYDomain,o=e.axisScaleType,s=e.logAxisScale,n=e.axisDisplayUnits,l=e.axisPrecision,c=e.outerPaddingRatio,u=e.margin,d=this.viewportHeight,h=m.StackedUtil.calcValueDomain(this.data.series,i),p=m.AxisHelper.getAxisFormatString(this.data.series),h=[h.min,h.max],g=m.AxisHelper.mergeScalarAxisDomains(r,m.AxisHelper.createScalarDomainOptions(h,0)),h=m.AxisHelper.scaleShouldClamp(g&&g.domain,h),y=this.data.valuesMetadata[0],p=i?this.graphicsContext.hostService.getLocalizedString("Percentage"):null!=p?p:m.valueFormatter.getFormatString(y,m.columnChartProps.general.formatString),y=m.AxisHelper.hasForcedDomain(g);return m.AxisHelper.createAxis({pixelSpan:d,domainOptions:g,axisZoom:e.axisZoom,zeroScalarDomain:m.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:p,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!0,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,logAxisScale:s,axisDisplayUnits:n,axisPrecision:l,is100Pct:i,shouldClamp:h,margin:u,preventNice:y,includeZero:m.AxisHelper.shouldIncludeZero(r),skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,featureSwitches:t,orientation:e.switchAxisPosition?m.AxisOrientation.right:m.AxisOrientation.left})},c.prototype.createLabelDataPoints=function(e){return m.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,!1,e,this.yProps.invertAxis)},c.prototype.createTotalLabelDataPoints=function(e){var t=m.CartesianHelper.getFirstMetadataColumn(this.data.valuesMetadata),t=m.valueFormatter.getFormatString(t,m.columnChartProps.general.formatString);return m.ColumnUtil.createTotalLabelDataPoints(this.data,this.layout,this.graphicsContext,this.yProps,!1,e,t,this.yProps.invertAxis)},c.prototype.getColumnWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},c.prototype.getCategoryAxisScale=function(){return this.xProps.scale},c.prototype.drawColumns=function(e,t){var i,a,r=this.data,o=(this.columnsCenters=null,{columnWidth:this.getColumnWidth(),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.yProps.invertAxis}),s=this.layout=c.getLayout(r,o),n=r.dataLabelsSettings,l=[],n=(n&&n.show&&(l=l.concat(this.createLabelDataPoints(t))),r.totalLabelsSettings),n=(n&&n.show&&!this.graphicsContext.is100Pct&&(l=l.concat(this.createTotalLabelDataPoints(t))),m.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,o)),e=(this.animator&&e&&(a=(i=this.animator.animate({viewModel:r,series:n,layout:s,itemCS:c.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!i.failed||(m.ColumnUtil.drawUncertainty(r,!1,this.graphicsContext.mainGraphicsContext,void 0,void 0,void 0),a=m.ColumnUtil.drawDefaultShapes(r,n,s,c.classes.item,!this.animator,this.interactivityService,this.graphicsContext.hostService,!1)),this.data.ribbonChartData);return s=(n=e&&e.ribbonChartDataPoints?(r=m.ColumnChart.getRibbonsUtils().getRibbonChartAreaLayout(this.layout,e.ribbonChartDataPoints,!0),{graphicsContext:this.graphicsContext.mainGraphicsContext,layout:r,ribbonChartAreaSelector:m.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:m.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:e.ribbonOptions.colorBands,bandsTransparency:e.ribbonOptions.bandsTransparency,showBorder:e.ribbonOptions.showBorder,style:t,interactivityService:this.interactivityService}):{graphicsContext:this.graphicsContext.mainGraphicsContext,layout:[],ribbonChartAreaSelector:m.ColumnChart.RibbonChartItemClasses,ribbonChartGroupSelector:m.ColumnChart.RibbonChartLayerClasses,isColumn:!0,colorBands:!1,bandsTransparency:c.defaultBandsTransparency,showBorder:!1,style:t,interactivityService:this.interactivityService},m.ColumnChart.getRibbonsUtils().drawRibbonChartAreaSmooth(n)),m.ColumnUtil.applyInteractivity(a,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,ribbonChartEventGroup:s,shapesSelection:a,viewport:{height:this.height,width:this.width},axisOptions:o,labelDataPointGroups:l,animateLabels:i&&!i.failed}},c.prototype.selectColumn=function(e,t,i){m.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,c.classes.item.selector,e,t,i),this.moveHandle(e)},c.prototype.getClosestColumnIndex=function(e,t){return m.ColumnUtil.getClosestColumnIndex(e,this.getColumnsCenters())},c.prototype.getColumnsCenters=function(){var t,e,i=this;return this.columnsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.columnsCenters=e.data.map(function(e){return i.xProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.columnsCenters},c.prototype.moveHandle=function(e){var t,i=this.getColumnsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentElement)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(a=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({x1:a,x2:a}),t.select("circle").attrs({cx:a})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:a,x2:a,y1:0,y2:this.height}),t.append("circle").attrs({cx:a,cy:this.height,r:"6px"}).classed("drag-handle",!0)))},c.getLayout=function(e,t){var i=t.columnWidth,a=t.isScalar,r=t.xScale,o=t.yScale,s=t.invertAxis,n=a?i/2:0;return{shapeLayout:{width:function(e){return i},x:function(e){return r(a?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(s?e.position-e.valueAbsolute:e.position)},height:function(e){return Math.abs(o(e.position-e.valueAbsolute)-o(e.position))}},shapeLayoutWithoutHighlights:{width:function(e){return i},x:function(e){return r(a?e.categoryValue:e.categoryIndex)-n},y:function(e){return o(s?e.originalPosition-e.originalValueAbsolute:e.originalPosition)},height:function(e){return Math.abs(o(e.originalPosition-e.originalValueAbsolute)-o(e.originalPosition))}},zeroShapeLayout:{width:function(e){return i},x:function(e){return r(a?e.categoryValue:e.categoryIndex)-n},y:function(e){return 0<=e.value?o(e.position-e.valueAbsolute):o(e.position)},height:function(e){return 0}}}},c.classes={item:{class:"column",selector:".column"},highlightItem:{class:"highlightColumn",selector:".highlightColumn"}},c.defaultBandsTransparency=30,m.StackedColumnChartStrategy=c,u.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.isComboChart=e.isComboChart},u.prototype.setData=function(e){this.data=e},u.prototype.setAxisProperties=function(e,t){this.xProps=e,this.yProps=t},u.prototype.createYAxis=function(e,t){var i=e.includeYDomain,a=e.axisScaleType,r=e.logAxisScale,o=e.axisDisplayUnits,s=e.axisPrecision,n=e.margin,l=this.height,c=m.AxisHelper.hasForcedDomain(i);return m.ColumnUtil.getCategoryAxis(this.data,l,this.categoryLayout,!0,e.axisZoom,t,[i],a,r,o,s,n,c,e.innerPaddingRatio,e.invertAxis,e.switchAxisPosition?m.AxisOrientation.right:m.AxisOrientation.left)},u.prototype.createXAxis=function(e,t){var i=e.is100Pct,a=e.forcedTickCount,r=e.includeXDomain,o=e.axisScaleType,s=e.logAxisScale,n=e.axisDisplayUnits,l=e.axisPrecision,c=e.outerPaddingRatio,u=e.margin,d=this.width,h=m.StackedUtil.calcValueDomain(this.data.series,i),p=m.AxisHelper.getAxisFormatString(this.data.series),h=[h.min,h.max],r=m.AxisHelper.mergeScalarAxisDomains(r,m.AxisHelper.createScalarDomainOptions(h,0)),h=m.AxisHelper.scaleShouldClamp(r&&r.domain,h),g=this.data.valuesMetadata[0],p=i?this.graphicsContext.hostService.getLocalizedString("Percentage"):null!=p?p:m.valueFormatter.getFormatString(g,m.columnChartProps.general.formatString),g=m.AxisHelper.hasForcedDomain(r),d=m.AxisHelper.createAxis({pixelSpan:d,domainOptions:r,axisZoom:e.axisZoom,zeroScalarDomain:m.ColumnChart.DefaultZeroScalarDomain,metaDataColumn:this.data.valuesMetadata,formatString:p,outerPadding:0,outerPaddingRatio:c,isScalar:!0,isVertical:!1,forcedTickCount:a,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:o,logAxisScale:s,axisDisplayUnits:n,axisPrecision:l,is100Pct:i,shouldClamp:h,margin:u,preventNice:g,skipAxisZoomUpdate:e.skipAxisZoomUpdate,invertAxis:e.invertAxis,featureSwitches:t,orientation:m.AxisOrientation.bottom});return d.axis.tickSizeInner(-this.viewportHeight).tickSizeOuter(0),d},u.prototype.createLabelDataPoints=function(e){return m.ColumnUtil.createLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,!1,e,this.xProps.invertAxis)},u.prototype.createTotalLabelDataPoints=function(e){var t=m.CartesianHelper.getFirstMetadataColumn(this.data.valuesMetadata),t=m.valueFormatter.getFormatString(t,m.columnChartProps.general.formatString);return m.ColumnUtil.createTotalLabelDataPoints(this.data,this.layout,this.graphicsContext,this.xProps,!0,e,t,this.xProps.invertAxis)},u.prototype.getColumnWidth=function(){return this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio)},u.prototype.getCategoryAxisScale=function(){return this.yProps.scale},u.prototype.drawColumns=function(e,t){var i,a,r=this.data,o=(this.barsCenters=null,{columnWidth:this.getColumnWidth(),xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin,invertAxis:this.xProps.invertAxis}),s=this.layout=u.getLayout(r,o),n=r.dataLabelsSettings,l=[],n=(n&&n.show&&(l=l.concat(this.createLabelDataPoints(t))),r.totalLabelsSettings),n=(n&&n.show&&!this.graphicsContext.is100Pct&&(l=l.concat(this.createTotalLabelDataPoints(t))),m.ColumnUtil.drawSeries(r,this.graphicsContext.mainGraphicsContext,o));return this.animator&&e&&(a=(i=this.animator.animate({viewModel:r,series:n,layout:s,itemCS:u.classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}})).shapes),this.animator&&e&&!i.failed||(m.ColumnUtil.drawUncertainty(r,!0,this.graphicsContext.mainGraphicsContext,void 0,void 0,void 0),a=m.ColumnUtil.drawDefaultShapes(r,n,s,u.classes.item,!this.animator,this.interactivityService,this.graphicsContext.hostService,!0)),m.ColumnUtil.applyInteractivity(a,this.graphicsContext.onDragStart),{eventGroup:this.graphicsContext.mainGraphicsContext,shapesSelection:a,viewport:{height:this.height,width:this.width},axisOptions:o,labelDataPointGroups:l,animateLabels:i&&!i.failed}},u.prototype.selectColumn=function(e,t,i){m.ColumnUtil.setSelectedColumnOpacity(this.graphicsContext.mainGraphicsContext,u.classes.item.selector,e,t,i),this.moveHandle(e)},u.prototype.getClosestColumnIndex=function(e,t){return m.ColumnUtil.getClosestColumnIndex(t,this.getBarsCenters())},u.prototype.getBarsCenters=function(){var t,e,i=this;return this.barsCenters||(e=this.categoryLayout.categoryThickness*(1-this.categoryLayout.innerPaddingRatio),0<this.data.series.length&&(t=0,this.categoryLayout.isScalar||(t=e/2),e=this.data.series[0],this.barsCenters=e.data.map(function(e){return i.yProps.scale(i.categoryLayout.isScalar?e.categoryValue:e.categoryIndex)+t}))),this.barsCenters},u.prototype.moveHandle=function(e){var t,i=this.getBarsCenters(),a=d3.select(".interactive-hover-line");a.empty()||this.columnSelectionLineHandle||(this.columnSelectionLineHandle=d3.select(a.node().parentElement)),!i||i.length<=1?this.columnSelectionLineHandle&&this.columnSelectionLineHandle.remove():(a=i[e],this.columnSelectionLineHandle?((t=this.columnSelectionLineHandle).select("line").attrs({y1:a,y2:a}),t.select("circle").attrs({cy:a})):((t=this.columnSelectionLineHandle=this.graphicsContext.unclippedGraphicsContext.append("g")).append("line").classed("interactive-hover-line",!0).attrs({x1:0,x2:this.width,y1:a,y2:a}),t.append("circle").classed("drag-handle",!0).attrs({cx:0,cy:a,r:"6px"})))},u.getLayout=function(e,t){var i=t.columnWidth,a=t.isScalar,r=t.xScale,o=t.yScale,s=t.invertAxis,n=a?i/2:0;return{shapeLayout:{width:function(e){return s?r(e.position-e.valueAbsolute)-r(e.position):r(e.position)-r(e.position-e.valueAbsolute)},x:function(e){return r(s?e.position:e.position-e.valueAbsolute)},y:function(e){return o(a?e.categoryValue:e.categoryIndex)-n},height:function(e){return i}},shapeLayoutWithoutHighlights:{width:function(e){return s?r(e.originalPosition-e.originalValueAbsolute)-r(e.originalPosition):r(e.originalPosition)-r(e.originalPosition-e.originalValueAbsolute)},x:function(e){return r(s?e.originalPosition:e.originalPosition-e.originalValueAbsolute)},y:function(e){return o(a?e.categoryValue:e.categoryIndex)-n},height:function(e){return i}},zeroShapeLayout:{width:function(e){return 0},x:function(e){return 0<=e.value?r(e.position-e.valueAbsolute):r(e.position)},y:function(e){return o(a?e.categoryValue:e.categoryIndex)-n},height:function(e){return i}}}},u.classes={item:{class:"bar",selector:".bar"},highlightItem:{class:"highlightBar",selector:".highlightBar"}},m.StackedBarChartStrategy=u}(powerbi=powerbi||{}),function(e){var v,b,x,S,C,f,t;function g(r,e,o,s,n,t){var t=(t===s?e:r).topLevelToggle,l=__assign(__assign({},r),{topLevelToggle:t}),c={};e.groups.forEach(function(e){return c[e.uid]=e}),r.groups.forEach(function(e,t){var i,a;b.isPlaceholder(e)||(i=c[e.uid])&&(a="errorBars"===r.uid,l.groups[t]=w(e,i,o,s,n,a),delete c[e.uid])});for(var i=0,a=e.groups;i<a.length;i++){var u=a[i];if(b.isPlaceholder(u))return;u=c[u.uid];u&&l.groups.push(u)}var t=_.unionWith(r.revertToDefaultDescriptors,e.revertToDefaultDescriptors,_.isEqual),d=v.comboChartObjectProps;return l.revertToDefaultDescriptors=t.filter(function(e){return d[e.objectName]&&d[e.objectName][e.propertyName]}),l}function w(e,t,i,a,r,o){var s=__assign({},t),n=e.slices,l=(n&&n.every(function(e){return!b.isPlaceholder(e)}),t.slices);return l&&l.every(function(e){return!b.isPlaceholder(e)}),s.slices=A(n,l,i,a,r),e.container&&t.container?s.container=function(e,t,i,a,r,o){var s=__assign({},t),n=(s.containerItems=[],__spreadArray([],e.containerItems,!0)),l=__spreadArray([],t.containerItems,!0);if(o)(o=s.containerItems).push.apply(o,__spreadArray(__spreadArray([],l,!1),n,!1));else{for(var c=void 0,u=(n[0].displayName,l[0].displayName,0<e.containerItems.length&&0<t.containerItems.length&&(c=function(e,t,a,r,o){var s=__assign(__assign({},t),{groups:[],slices:[]}),n={};t.groups.forEach(function(e){return n[e.uid]=e}),e.groups.forEach(function(e,t){var i=n[e.uid];i?(s.groups[t]=w(e,i,a,r,o),delete n[e.uid]):s.groups[t]=e});for(var i=0,l=t.groups;i<l.length;i++){var c=l[i];n[c.uid]&&s.groups.push(n[c.uid])}return s.slices=A(e.slices,t.slices,a,r,o),s}(n.shift(),l.shift(),i,a,r)),s.containerItems.push(c),[]),d=0,h=n;d<h.length;d++){var p=h[d];u.push({containerItem:p,layerType:i})}for(var g=0,y=l;g<y.length;g++){var m=y[g];u.push({containerItem:m,layerType:a})}for(var v=0,S=u;v<S.length;v++){var f=S[v];s.containerItems.push(function(e,t,o){var s=__assign({},t),i={};return t.groups.forEach(function(e){return i[x.getGroupUid(e.uid)]=e}),e.groups.length,t.groups.length,e.groups.forEach(function(e,a){var r,t=x.getGroupUid(e.uid);i[t]&&(r={},i[t].slices.forEach(function(e){return r[C.getGroupAndSliceUid(e.uid)]=e}),s.groups[a].slices=[],e.slices.forEach(function(e){var t,i;b.isPlaceholder(e)||(t=C.getGroupAndSliceUid(e.uid),(i=(i=r[t])||r[t.replace("__".concat(o,"__"),"")])&&("Dropdown"!==i.control.type||"Dropdown"!==e.control.type||P(i.control.properties,e.control.properties))?(i.displayName=e.displayName,s.groups[a].slices.push(i)):s.groups[a].slices.push(__assign(__assign({},e),{displayName:e.displayName,disabled:!0})))}))}),s}(c,f.containerItem,f.layerType))}}return s}(e.container,t.container,i,a,r,o):s.container=e.container||t.container,s}function D(e){return _.findIndex(e,function(e){return!b.isCompositeSlice(e)&&(t=e,i=v.comboChartObjectProps.labels.labelDensity,(t=e.control.properties.descriptor).objectName===i.objectName)&&t.propertyName===i.propertyName;var t,i})}function A(e,t,o,i,s){var n=[],a=D(e),r=e[a],l=D(t),c=t[l],u=(r&&c&&(e=e.filter(function(e,t){return!b.isCompositeSlice(e)&&t!==a}),t=t.filter(function(e,t){return!b.isCompositeSlice(e)&&t!==l})),v.comboChartObjectProps),d={};t.forEach(function(e){L(e,u)&&(d[S.getSliceUid(e,!1)]=e)}),e.forEach(function(e){if(L(e,u)){var t=d[S.getSliceUid(e,!1)],i=e.displayName;if(function(e,t){if(t&&t.control.type===e.control.type&&function(e,t){if(b.isCompositeSlice(e)||b.isCompositeSlice(t))return 1;var i=e.control.properties.descriptor,a=t.control.properties.descriptor;if(_.isEqual(_.omit(a,["selector","instanceKind"]),_.omit(i,["selector","instanceKind"]))){if(f.equals(a.selector,i.selector))return 1;var r=void 0;if(null==a.selector&&(r=f.isWildcardSelector(i.selector)),r=null==i.selector?f.isWildcardSelector(a.selector):r)return function(e,t){e=e.control.properties.descriptor,t=t.control.properties.descriptor;e.instanceKind|=t.instanceKind,null!=e.selector||(e.selector=t.selector)}(e,t),1}return}(e,t))return"Dropdown"!==t.control.type||(t=t.control.properties,e=e.control.properties,!!P(t,e));return}(e,t)){if(b.isCompositeSlice(e)&&b.isCompositeSlice(t))for(var a in e.control.properties){var r=e.control.properties[a],a=t.control.properties[a];r&&a&&_.isEqual(r.descriptor,a.descriptor)&&(r.value=a.value)}else e.control.properties.value=t.control.properties.value;delete d[S.getSliceUid(t,!1)]}else i=M(e.uid,o,s);n.push(__assign(__assign({},e),{displayName:i}))}});for(var h=0,p=t;h<p.length;h++){var g,y=p[h],m=d[S.getSliceUid(y,!1)],y=y.uid+"__".concat(i,"__");m&&(g=M(m.uid,i,s),n.push(__assign(__assign({},m),{displayName:g,uid:y})))}return r&&c&&(e=c,t=n,c=s,(r=r).control.properties.value=e.control.properties.value,e=c("Visual_LabelDensity"),t.push(__assign(__assign({},r),{displayName:e}))),n}function i(e){return void 0===e.items}function P(e,t){return i(e)&&i(t)&&_.isEqual(e.filterValues,t.filterValues)}function L(e,t){var i;return b.isCompositeSlice(e)?!!(i=e.control.properties)&&Object.keys(i).every(function(e){e=i[e],e=null==e?void 0:e.descriptor;return!e||!!(e&&t[e.objectName]&&t[e.objectName][e.propertyName])}):!!((e=e.control.properties.descriptor)&&t[e.objectName]&&t[e.objectName][e.propertyName])}function r(e,t){if(0===t.length)return e;for(var i={},a=(e.forEach(function(e){return i[e.uid]=e}),[]),r=0,o=t;r<o.length;r++){var s=o[r];i[s]&&a.push(i[s])}return a}function M(e,t,i){return i("Visual_Slice_Placeholder_"+C.getSliceUid(e),function(e,t){switch(e){case 5:return t("DisplayName_QuickCalc_PercentOfColumnTotal");case 0:return t("Visual_Slice_PlaceholderChartType_Line")}}(t,i))}v=e.visuals||(e.visuals={}),b=e.visuals.builder,x=b.FormattingGroupUidBuilder,S=e.visuals.FormattingModelUtil,C=b.FormattingSliceUidBuilder,f=e.data.Selector,t=[[v.comboChartRoleNames.y,v.comboChartRoleNames.tooltips],[v.comboChartRoleNames.y2]],(e=v.ComboChart||(v.ComboChart={})).enumerateDataPoints=function(e,t,i){if(i){for(var a,r=i.length,o=0;o<r;o++){var s=i[o];s.enumerateObjectInstances&&(s instanceof v.ColumnChart?a=o:s.enumerateObjectInstances(e,t))}void 0!==a&&i[a].enumerateObjectInstances(e,t)}},e.isComboChart=function(e){return 11===e||14===e||15===e||16===e||17===e},e.getRoleGroups=function(){return t},e.mergeFormattingCards=function(e,t,i){if(0!==e.length){var a,r;switch(t){case 14:case 15:a=[5,0],r=5}if(0===(t=function(e,t){if(0===t.length)return;for(var i={},a=(e.forEach(function(e){return i[e.type]=e.card}),[]),r=0,o=t;r<o.length;r++)!function(t){i[t]&&i[t].forEach(function(e){return a.push({card:e,type:t})})}(o[r]);return a}(e,a)).length)return[];for(var o={},s=0,n=t;s<n.length;s++){var l=n[s],c=l.card;o[c.uid]?o[c.uid]={card:g(o[c.uid].card,c,o[c.uid].type,l.type,i,r),type:l.type}:o[c.uid]={card:c,type:l.type}}for(var u=[],d=0,h=_.values(o);d<h.length;d++){var p=h[d];u.push(p.card)}return u}},e.mergeFormattingCard=g,e.existsInProps=L,e.sortComboChartFormattingCards=function(e,t,i){var a=[];switch(t){case 14:case 15:a=["bars","lines","markers","labels","seriesLabels","totals"],i&&a.push("errorBars")}return r(e,a)},e.sortFormattingCards=r}(powerbi=powerbi||{}),function(y){var m;function v(e){this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}m=y.visuals||(y.visuals={}),v.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.animationOptions=e.animation},v.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed(v.ClassName,!0),this.mainGraphicsG=this.svg.append("g").classed("dataDotChartMainGraphicsContext",!0),this.mainGraphicsContext=this.mainGraphicsG.append("svg")},v.prototype.setData=function(e){this.data={series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1},0<e.length&&null!=(e=e[0])&&e.categorical&&(this.data=v.converter(e,m.valueFormatter.format(null),this.interactivityService))},v.prototype.setFilteredData=function(e,t){var i,a=this.clippedData=y.Prototype.inherit(this.data);return null!=(i=null==a?void 0:a.series)&&i.data&&(a.series={data:a.series.data.slice(e,t),xCol:a.series.xCol,yCol:a.series.yCol}),a},Object.defineProperty(v.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),v.prototype.calculateAxesProperties=function(r){function e(e){var t="x"===e,e="y"===e,i=t?s:n,a=t?null==(a=o.data)?void 0:a.series.xCol:null==(a=o.data)?void 0:a.series.yCol;return m.AxisHelper.createAxis({pixelSpan:t?o.availableWidth:o.availableHeight,domainOptions:t?u:c,metaDataColumn:a,axisZoom:void 0,isScalar:e,isVertical:e,isCategoryAxis:t,formatString:m.valueFormatter.getFormatString(a,v.formatStringProp),outerPadding:t?l.categoryThickness*l.outerPaddingRatio:0,forcedTickCount:r.forcedTickCount,useTickIntervalForDisplayUnits:!0,margin:o.margin,preventNice:m.AxisHelper.hasForcedDomain(t?i.includeDomain:c),includeZero:e,categoryThickness:t?l.categoryThickness:void 0,innerPaddingRatio:t?r.innerPaddingRatio:void 0,getValueFn:t?function(e,t){return o.lookupXValue(e,t)}:void 0})}var o=this,s=r.categoryAxisOptions,n=r.valueAxisOptions,t=(this.currentViewport=r.viewport,this.margin=r.margin,this.clippedData=this.data,null!=(t=null==(t=null==(t=null==(t=this.data)?void 0:t.series)?void 0:t.data)?void 0:t.length)?t:0),l=(this.data.hasHighlights&&(t/=2),m.CartesianChartLayout.getLayout(null,{availableWidth:this.availableWidth,categoryCount:t,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:r.trimOrdinalDataOnOverflow,outerPaddingRatio:r.outerPaddingRatio,innerPaddingRatio:r.innerPaddingRatio})),c=(this.isScrollable||(this.clippedData=v.createClippedDataIfOverflowed(this.data,l.categoryCount)),m.AxisHelper.createScalarDomainOptions(this.getAxesDomains(!1,{valueAxis:!0}).valueAxis,0)),c=m.AxisHelper.mergeScalarAxisDomains(c,n.includeDomain),u=m.AxisHelper.createDomain(0<(null==(t=null==(t=this.data.series)?void 0:t.data)?void 0:t.length)?[this.data.series]:[],null!=(t=null==(t=this.xAxisProperties)?void 0:t.axisType)?t:y.ValueType.fromDescriptor({text:!0}),!1,[s.includeDomain]);return this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),[this.xAxisProperties,this.yAxisProperties]},v.prototype.getAxesDomains=function(e,t){var i={},a=this.clippedData||this.data;return a&&t.valueAxis&&(t=a.series&&!_.isEmpty(a.series.data)?[a.series]:[],i.valueAxis=m.AxisHelper.createValueDomain(t)),i},v.prototype.setAxesLayout=function(e){},v.createClippedDataIfOverflowed=function(e,t){var i,t=e.hasHighlights?Math.min(e.series.data.length,2*t):Math.min(e.series.data.length,t);return t>=e.series.data.length?e:((i=y.Prototype.inherit(e)).series=y.Prototype.inherit(e.series),i.series.data=i.series.data.slice(0,t),i)},v.prototype.lookupXValue=function(e,t){var i=this.data;if(m.AxisHelper.isDateTime(t))return new Date(e);if(i&&i.series){t=i.series.data;if(t){i=t[e];if(i)return i.categoryValue}}return e},v.prototype.overrideXScale=function(e){this.xAxisProperties=e},v.prototype.render=function(e){var t,i,a,r,o,s,n,l,c,u,d,h,p,g=this;if(this.clippedData)return t=(u=this.clippedData).series.data,i=u.hasHighlights,u=this.margin,l=(c=this.currentViewport).width-(u.left+u.right),c=c.height-(u.top+u.bottom),a=this.xAxisProperties.scale,r=this.yAxisProperties.scale,o=this.xAxisProperties.categoryThickness*(1-this.xAxisProperties.innerPaddingRatio),s=o/2,u=this.style.colorPalette.dataColors.getNewColorScale().getColor(v.DotColorKey),n=!!this.interactivityService&&this.interactivityService.hasSelection(),this.mainGraphicsContext.attr("width",l).attr("height",c),(c=(l=this.mainGraphicsContext.selectAll(v.DotClassSelector).data(t,function(e){return e.identity.getKey()})).enter().append("circle").classed(v.DotClassName,!0).merge(l)).styles({fill:u.value}).style("fill-opacity",function(e){return m.ColumnUtil.getFillOpacity(e.selected,e.highlight,n,i)}).classed("null-value",function(e){return null===e.value}).attrs({r:function(e){return s},cx:function(e){return a(e.categoryIndex)+s},cy:function(e){return r(e.value)}}),l.exit().remove(),u=this.mainGraphicsContext.selectAll(v.DotLabelClassSelector).data(t,function(e){return e.identity.getKey()}),(d=u.enter().append("text").classed(v.DotLabelClassName,!0).attrs({"text-anchor":v.DotLabelTextAnchor,dy:v.DotLabelVerticalOffset}).merge(u)).classed("null-value",function(e){return null===e.value}).classed("overflowed",!1).attrs({x:function(e){return a(e.categoryIndex)+s},y:function(e){return r(e.value)}}).text(function(e){return g.yAxisProperties.formatter.format(e.value)}),h=!1,d.each(function(){var e;h||$("<div>").addClass($(this).attr("class")).hasClass("null-value")||(e=y.TextMeasurementService.measureSvgTextElementWidth(this),o<e&&(d.classed("overflowed",!0),h=!0))}),u.exit().remove(),this.interactivityService&&(p={dots:c,dotLabels:d,datapoints:t}),m.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions,c,d),{dataPoints:t,behaviorOptions:p,labelDataPoints:[],labelsAreNumeric:!0,animateLabels:!1}},v.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},v.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},v.converter=function(e,t,i){var e=e.categorical,a=e.categories&&0<e.categories.length?e.categories[0]:{source:void 0,values:[t],identity:void 0},r=null!=(t=e.originalCategories)?t:[a],t=m.AxisHelper.getCategoryValueType(a.source),o=m.AxisHelper.isDateTime(t),s=a.values;if(_.isEmpty(e.values))return{series:{data:[]},hasHighlights:!1,hasDynamicSeries:!1};for(var n=e.values[0],l=!!n.highlights,c=[],u=0,d=n.values.length;u<d;u++){a.identity&&a.identity.length;var h,p,g=new m.SelectionIdBuilder,y=(g=a.identity?g.withCategory(r,u,null==(y=null==a?void 0:a.source)?void 0:y.queryName,!0):g).withMeasure(n.source.queryName).createSelectionId(),g=s[u];(!o||null==g||g instanceof Date)&&(c.push({categoryValue:o&&g?g.getTime():g,value:n.values[u],categoryIndex:u,seriesIndex:0,selected:!1,identity:y,highlight:!1}),l)&&(h=m.SelectionId.createWithHighlight(y),p=n.highlights[u],c.push({categoryValue:o&&g?g.getTime():g,value:p,categoryIndex:u,seriesIndex:0,selected:!1,identity:h,highlight:!0}))}return i&&i.applySelectionStateToData(c),{series:{xCol:a.source,yCol:n.source,data:c},hasHighlights:l,hasDynamicSeries:!0}},v.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},v.prototype.getStaticSeriesRole=function(){},v.formatStringProp={objectName:"general",propertyName:"formatString"},v.ClassName="dataDotChart",v.DotClassName="dot",v.DotClassSelector=".dot",v.DotColorKey="dataDot",v.DotLabelClassName="label",v.DotLabelClassSelector=".label",v.DotLabelVerticalOffset="0.4em",v.DotLabelTextAnchor="middle",m.DataDotChart=v}(powerbi=powerbi||{}),function(e){var r=e.visuals||(e.visuals={});function t(){}t.prototype.create=function(){return new i},r.DataDotChartWebBehaviorFactory=t,a.prototype.bindEvents=function(e,t,i){var a=this.dots=e.dots,e=e.dotLabels;r.InteractivityUtils.registerStandardInteractivityHandlers(a,t),e&&r.InteractivityUtils.registerStandardInteractivityHandlers(e,t)},a.prototype.renderSelection=function(t){this.dots.style("fill-opacity",function(e){return r.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)})};var i=a;function a(){}r.DataDotChartWebBehavior=i}(powerbi=powerbi||{}),function(l){var d,e,t,h;function c(e){this.chartType=132,this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService}d=l.visuals||(l.visuals={}),e=jsCommon.CssConstants.createClassAndSelector,t=l.data.DataViewTransform,h=d.histogramProps.general.formatString,c.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.hostService=e.host,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches},c.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed("histogram",!0),this.unclippedGraphicsContext=this.svg.append("g").classed("histogramUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("mainGraphicsContext",!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({tabindex:0,focusable:!0,"aria-label":this.hostService.getLocalizedString("Visual_Plot")}).classed(d.SetFocusRingClassName,!e))},c.prototype.setData=function(e){this.data=this.originalData={categories:[],categoryFormatter:null,series:[],totals:[],valuesMetadata:[],hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!0,dataLabelsSettings:null,legendData:null,hasDynamicSeries:!0,isMultiMeasure:!1,binType:d.binType.numOfBins,binSize:c.DefaultBinSize,numberOfBins:c.DefaultBinCount},0<e.length&&(e=this.dataView=c.view)&&e.categorical&&(this.data=this.originalData=c.converter(e,this.style,e.metadata,this.featureSwitches,this.chartType,this.interactivityService,!0,this.hostService))},c.prototype.calculateAxesProperties=function(a){function e(e){var t="x"===e,e="y"===e,i=t?r:o;return d.AxisHelper.createAxis({pixelSpan:t?n.width:n.height,domainOptions:t?d.AxisHelper.createDomain(s.series,d.AxisHelper.getCategoryValueType(s.categoryMetadata,!0),!0,[u]):c,metaDataColumn:t?s.categoryMetadata:s.valuesMetadata,axisZoom:void 0,isScalar:!0,isVertical:e,isCategoryAxis:t,formatString:d.valueFormatter.getFormatString(t?s.categoryMetadata:s.valuesMetadata[0],h),outerPadding:t?l.categoryThickness*l.outerPaddingRatio:0,outerPaddingRatio:t?l.outerPaddingRatio:0,forcedTickCount:a.forcedTickCount,axisDisplayUnits:i.displayUnits,axisPrecision:i.precision,preventNice:d.AxisHelper.hasForcedDomain(t?r.includeDomain:c),categoryThickness:t?l.categoryThickness:void 0,innerPaddingRatio:t?0:void 0,useTickIntervalForDisplayUnits:e||void 0})}var r=a.categoryAxisOptions,o=a.valueAxisOptions,s=(this.currentViewport=a.viewport,this.margin=a.margin,this.viewModelAdapterFactory&&this.originalData&&(t=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=t.getData()),this.data),t=s.categories.length,n=this.getPreferredPlotArea(!0,t,d.CartesianHelper.MinOrdinalRectThickness,a.outerPaddingRatio),i=null!=(i=null==s?void 0:s.preferredCategoryWidth)?i:null,l=d.CartesianChartLayout.getLayout(null,{availableWidth:n.width,categoryCount:t,preferredCategoryWidth:i,domain:null,isScalar:!0,isScrollable:!1,trimOrdinalDataOnOverflow:a.trimOrdinalDataOnOverflow,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:0}),c=d.AxisHelper.createScalarDomainOptions(d.AxisHelper.createValueDomain(s.series),0),c=d.AxisHelper.mergeScalarAxisDomains(c,o.includeDomain),u=d.AxisHelper.createScalarDomainOptions(d.AxisHelper.createIntervalDomain(s.series),0,[!0,!0]);return this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),[this.xAxisProperties,this.yAxisProperties]},c.prototype.getAxesDomains=function(e,t){var i,a={},r=this.data;return r&&(t.categoryAxis&&(i=d.AxisHelper.getCategoryValueType(r.categoryMetadata,!0),i=d.AxisHelper.createDomain(r.series,i,!0,[d.AxisHelper.createScalarDomainOptions(d.AxisHelper.createIntervalDomain(r.series),0,[!0,!0])]))&&(d.AxisHelper.assertScalarDomain(i.domain),a.categoryAxis=i.domain),t.valueAxis)&&(a.valueAxis=d.AxisHelper.createValueDomain(r.series)),a},c.prototype.setAxesLayout=function(e){},c.prototype.getVisualCategoryAxisIsScalar=function(){return!0},c.prototype.getPreferredPlotArea=function(e,t,i,a){return d.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,!1,e,this.margin,a)},c.prototype.overrideXScale=function(e){this.xAxisProperties=e},c.prototype.render=function(e){var t=this,i=this.data;if(i){var a=this.margin,r=this.currentViewport,o=r.height-(a.top+a.bottom),r=r.width-(a.left+a.right),a=i.series;this.mainGraphicsContext.attr("height",o).attr("width",r),this.mainGraphicsContext.selectAll(c.SeriesSelector.selector).remove();var r=this.mainGraphicsContext.selectAll(c.SeriesSelector.selector).data(a).enter().append("g").classed("bar",!0),a=r.selectAll(c.BinsSelector.selector).data(function(e){return e.data}),s=(a.enter().append("rect").classed(c.BinsSelector.class,!0).attr("x",function(e){return t.xAxisProperties.scale(e.categoryValue.min)}).attr("y",function(e){return t.yAxisProperties.scale(e.value)}).attr("height",function(e){return o-t.yAxisProperties.scale(e.value)}).attr("width",function(e){return t.xAxisProperties.scale(e.categoryValue.max)-t.xAxisProperties.scale(e.categoryValue.min)}).style("fill",function(e){return e.color}),a.exit().remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(r,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&e.data.identity&&[e.data.identity]}),[]);if(this.interactivityService)for(var n=0,l=i.series.length;n<l;n++)s=s.concat(i.series[n].data);return{dataPoints:s,behaviorOptions:void 0,navigationOptions:void 0,labelDataPoints:[],labelsAreNumeric:!0,labelOrientation:i.dataLabelsSettings.labelOrientation,animateLabels:!0}}},c.converter=function(e,t,i,a,r,o,s,n){t=d.ColumnChart.converter({dataView:e,style:t,is100PercentStacked:!1,isScalar:!0,dataViewMetadata:i=void 0===i?null:i,multipleInfo:void 0,chartType:r,interactivityService:o,tooltipsEnabled:s=void 0===s?!0:s,hostServices:n,ribbonChart:!1,isCombo:!1,buildCategories:c.buildCategories,supportsTotalLabels:!1,featureSwitches:a}),i=l.DataViewObjects.getValue(e.metadata.objects,d.histogramProps.binning.binType),r=l.DataViewObjects.getValue(e.metadata.objects,d.histogramProps.binning.binCount,c.DefaultBinCount),o=l.DataViewObjects.getValue(e.metadata.objects,d.histogramProps.binning.binSize,c.DefaultBinSize);return __assign(__assign({},t),{series:t.series,binType:i,numberOfBins:r,binSize:o})},c.buildCategories=function(e){e.categories,e.categories.length;for(var t=new Array,i=e.categories[0].values.length,a=0;a<i;a++)t.push({min:e.categories[0].values[a],max:e.categories[1].values[a]});return t},c.buildTooltipCategories=function(e,t,i){return e.length,(t+=1)===i?{displayName:_.first(e).displayName,value:"[".concat(_.map(e,function(e){return e.value}).join(", "),"]")}:{displayName:_.first(e).displayName,value:"[".concat(_.map(e,function(e){return e.value}).join(", "),")")}},c.prototype.enumerateObjectInstances=function(e,t){if(this.originalData)switch(t.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"binning":this.enumerateBinning(e,t.objectName)}},c.prototype.enumerateBinning=function(e,t){t={selector:null,properties:{binType:this.data.binType===d.binType.binSize?d.binType.binSize:d.binType.numOfBins},validValues:{},objectName:t};this.data.binType===d.binType.binSize?t.properties[d.histogramProps.binning.binSize.propertyName]=this.data.binSize:t.properties[d.histogramProps.binning.binCount.propertyName]=this.data.numberOfBins,e.pushInstance(t)},c.prototype.enumerateDataPoints=function(e){var t=this.originalData;t&&t.series&&0!==t.series.length&&l.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(t.series,function(e){return{color:e.color,displayName:e.displayName,identity:e.identity}})},this.featureSwitches)},c.prototype.hasLegend=function(){return!0},c.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},c.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1,supportsValueAxis:!0}},c.prototype.getStaticSeriesRole=function(){return"Y"},c.BinsSelector=e("bin"),c.SeriesSelector=e("bar"),c.DefaultBinCount=5,c.DefaultBinSize=10,c.view={metadata:{columns:[{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:"Max of HourOfDay",queryName:"Sum(commits5.HourOfDay)",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}}],objects:{categoryAxis:{axisType:"Categorical"},general:{formatString:"0"}}},categorical:{categories:[{source:{roles:{Category:!0},type:{integer:!0},format:"0",displayName:"HourOfDayBin",queryName:"commits5.HourOfDayBin",expr:null,sort:1,sortOrder:0,objects:{general:{formatString:"0"}},index:1,identityExprs:null},values:[0,4,8,12,16,20],identity:null,identityFields:null},{source:{roles:{Category:!0},type:{numeric:!0},format:"0",displayName:null,queryName:"query",expr:null,objects:{general:{formatString:"0"}},index:2,isMeasure:!0,aggregates:{minLocal:3,maxLocal:23}},values:[4,8,12,16,20,24]}],values:t.createValueColumns([{source:{roles:{Y:!0},type:{numeric:!0},displayName:"Count of Commit",queryName:"CountNonNull(commits5.Commit)",expr:null,index:0,isMeasure:!0,aggregates:{minLocal:5158,maxLocal:15509}},values:[5272,5427,11478,15509,12732,5158],highlights:[null,null,null,null,1662,2519]}])}},d.Histogram=c}(powerbi=powerbi||{}),function(N){var re=N.visuals||(N.visuals={}),C=N.visuals.AxisHelper,d=jsCommon.BrowserUtils,h=N.visuals.builder,oe=jsCommon.Color,e=jsCommon.CssConstants.createClassAndSelector,c=N.visuals.DataViewObjectChangeHelper,u=N.data.DataViewRoleWildcard,p=N.data.DataViewWildcard,o=jsCommon.DOMConstants,se=jsCommon.EnumExtensions,s=N.visuals.OnObjectUtil,g=N.data.Selector,y=N.data.Selector.normalizeSelector,n=(re.horizontalLabelBackgroundPadding=4,ne.getDefaultLineChartLabelSettings=function(e,t){void 0===t&&(t=!1);var i=re.ColorHelper.getThemeColor(e,re.DataLabelViewModel.DefaultLabelColorName),i=re.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:i,textClassName:"smallLightLabel"}).fontProperties,i={show:!1,showByDefault:!0,position:re.labelPosition.auto,displayUnits:0,precision:re.DataLabelViewModel.defaultLabelPrecision,fontProperties:i,labelDensity:re.DataLabelViewModel.defaultLabelDensity};return t?(i.enableBackground=!0,i.backgroundColor=re.ColorHelper.getThemeColor(e,re.BackgroundColorName),i.backgroundTransparency=re.DataLabelViewModel.defaultComboChartLabelBackgroundOpacity):i.enableBackground=!1,i.bold=!1,i.italic=!1,i.underline=!1,i},ne.getDefaultLineChartSeriesLabelSettings=function(e){var t=re.ColorHelper.getThemeColor(e,re.DataLabelViewModel.DefaultLabelColorName),e=re.DataLabelViewModel.getDefaultLabelSettings({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,seriesColor:t,seriesPosition:re.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1,bold:!1,italic:!1,underline:!1}},ne.getDefaultLineChartSeriesWidthSettings=function(e,t){var i=1;if(t)for(var a=t.length,r=0;r<a;r++)var o=re.DataLabelRenderer.LabelTextProperties,o={text:t[r],fontFamily:e.family,fontSize:jsCommon.PixelConverter.fromPoint(e.size.pt),fontWeight:o.fontWeight},o=N.TextMeasurementService.measureSvgTextWidth(o)+2*re.horizontalLabelBackgroundPadding,i=i<o?o:i;return i},ne.converter=function(e){return new re.LineChartConverter(e).convert()},ne.getInteractiveLineChartDomElement=function(e){return e.children("svg").get(0)},ne.createStackedValueDomain=function(e){return 0===e.length?null:[d3.min(e,function(e){return d3.min(e.data,function(e){return e&&e.stackedValue})}),d3.max(e,function(e){return d3.max(e.data,function(e){return e&&e.stackedValue})})]},ne.prototype.initData=function(e){this.options=e,this.style=e.style;var t=e.chartType;this.isComboChart=11===t||14===t||15===t,this.isAreaChart=1===t||2===t,this.element=e.element,this.currentViewport=e.viewport,this.isInteractiveChart=null==(t=e.interactivity)?void 0:t.isInteractiveLegend,this.isInteractiveVisual=null==(t=e.interactivity)?void 0:t.isVisualInteractive,this.host=e.host},ne.prototype.initRenderer=function(e){var t,i=this,a=(this.animator=e.animator,this.cartesianHost=e.cartesianHost,e.svg),a=(a.classed(ne.ClassName,!0),this.mainGraphicsSVG=a.append("svg").classed(ne.lineChartSVGClassName,!0)),r=(this.svgDefs=a.append("defs"),!this.isComboChart&&!this.isInteractiveChart),e=(this.tooltipService=new l(this.options.services.tooltips,a,r),this.mainGraphicsContext=a.append("g").attr("role","listbox").attr("aria-label",this.host.getLocalizedString("Visual_Plot")).attr("aria-live","polite").classed(ne.MainGraphicsContextClassName,!0),this.interactivityService&&(this.isComboChart?this.mainGraphicsContext.attr(o.skipChildrenFocusAttribute,!0):(r=d.isInternetExplorerOrEdge(),e.useManagedTabIndex?(this.mainGraphicsContext.classed(re.managedTabIndexElement.class,!0),this.mainGraphicsContext.attr(o.skipChildrenFocusAttribute,!0)):this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0),this.mainGraphicsContext.classed(re.SetFocusRingClassName,!r))),this.hoverLineContext=a.append("g").classed("hover-line",!0),this.hoverLineContext.append(ne.LineElementName).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0),this.hoverLine=this.hoverLineContext.select(ne.LineElementName));this.isInteractiveChart&&e.classed("interactive",!0),e.style("opacity",re.SVGUtil.AlmostZero),e.style("stroke",re.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")),this.selectionCircles=[],this.xAxisProperties={axis:null,scale:null,axisType:null,formatter:null,graphicsContext:null,values:null,axisLabel:null,isCategoryAxis:!0},this.isInteractiveChart&&(t=ne.getInteractiveLineChartDomElement(this.element),r=function(){i.lastDragMoveXPosition=d3.mouse(t)[0],i.deferDragMoveOperation()},a=d3.drag().on("drag",r),d3.select(t).style("touch-action","none").call(a).on("click",r)),this.markerRenderer=new re.MarkerRenderer,this.anomalyNavigationHelper=new re.AnomalyDetectionKeyboardNavigationHelper},ne.prototype.setData=function(e,t){var i,a,r,o,s;this.data=this.originalData={series:[],dataLabelsSettings:ne.getDefaultLineChartLabelSettings(this.style),seriesLabelSetings:ne.getDefaultLineChartSeriesLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],categoryIdentities:[],lineStyle:re.LineStyle.getDefault(),binnedLineSamplingApplied:!1,legendMarkerRendering:null!=(o=this.featureSwitches)&&o.removeDefaultToCircleToggle?re.legendMarkerRendering.markerCircleDefault:re.legendMarkerRendering.markerOnly,matchLineColor:!1,defaultToCircle:null==(o=this.featureSwitches)||!o.removeDefaultToCircleToggle},this.focusedDatum=void 0,_.isEmpty(e)?this.dataView=void 0:(o=_.first(e),i=_.find(e,function(e){return re.ForecastHelper.isDataViewForForecast(e)}),e=_.find(e,function(e){return re.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection(e)}),o&&o.categorical&&(s={text:!0},a=void 0,(r=(this.dataView=o).categorical.categories)&&!_.isEmpty(r)&&(r[0].source&&r[0].source.type&&(s=r[0].source.type),a=re.ScalarUtils.getScalarKeys(r[0])),r=re.CartesianHelper.hasCategoryHierarchy(o),s=re.ScalarUtils.shouldDrawScalar(o.metadata?o.metadata.objects:null,re.lineChartProps.categoryAxis.axisType,s,a,r),r=!(!(a=this.host&&this.host.tooltips())||!a.enabled()),a=this.tooltipsEnabled=this.tooltipsEnabledOnHost&&(!a||r),this.data=this.originalData=ne.converter({dataView:o,style:this.style,isScalar:s,host:this.host,interactivityService:this.interactivityService,isComboChart:this.isComboChart,tooltipsEnabled:a,forecastDataView:i,anomalyDetectionDataView:e,shouldCalculateStacked:se.hasFlag(this.lineType,16),multipleInfo:t,supportsTotalLabels:!t&&this.supportsTotalLabels(),featureSwitches:this.featureSwitches}),r=this.previousCategoryIds,o=this.data.categoryIdentities,this.suppressAnimation=ne.shouldSuppressAnimations(r,o),this.previousCategoryIds=o,s=_.find(this.data.series,function(e){return e.data[0]}),this.focusedDatum=s&&s.data[0]))},ne.shouldSuppressAnimations=function(e,t){var i;if(null!=e&&!(e.length>re.AnimatorCommon.MaxDataPointsToAnimate||t.length>re.AnimatorCommon.MaxDataPointsToAnimate))if(i=!1,0===e.length)i=!0;else for(var a=0,r=Math.min(e.length,t.length);a<r;a++)if(!re.SelectionId.isEqual(e[a],t[a])){i=!0;break}return i},ne.prototype.getCategoryDomain=function(e){return C.createDomain(e.series,this.getCategoryValueType(),e.isScalar,[C.createScalarDomainOptions(null==(e=ne.getForecastDomain(e.forecastLines))?void 0:e.x,0)])},ne.prototype.getAxesDomains=function(e,t){var i,a,r,o,s,n;return this.data?(n=this.data,i={},s=ne.getForecastDomain(n.forecastLines),t.categoryAxis&&n.isScalar&&(r=this.getCategoryDomain(n))&&(C.assertScalarDomain(r.domain),a=(r=r.domain)[0],r=r[1],void 0!==a)&&void 0!==r&&(i.categoryAxis=[a,r]),(t.valueAxis||t.secondaryValueAxis)&&(a=s&&s.y,r=this.lineType,t.valueAxis&&(s=ne.getValueDataDomain(n,e,!1,r),o=(s=C.mergeDomains(a,s))[0],s=s[1],void 0!==o)&&void 0!==s&&(i.valueAxis=[o,s]),t.secondaryValueAxis)&&(o=ne.getValueDataDomain(n,e,!0,r),t=(s=C.mergeDomains(a,o))[0],n=s[1],void 0!==t)&&void 0!==n&&(i.secondaryValueAxis=[t,n]),i):{}},ne.getValueDataDomain=function(e,t,i,a){e=ne.getDataForValueAxis(e,i).seriesData;return se.hasFlag(a,16)?ne.createStackedValueDomain(e):C.createUncertaintyAwareValueDomain(e,t)},ne.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&(1<this.data.series.length||1<this.data.valuesMetadata.length))},ne.prototype.setFilteredData=function(e,t){var i=t-e,a=this.scrolledData=N.Prototype.inherit(this.data);return a.series=ne.sliceSeries(a.series,i,e),a.categories=a.categories.slice(e,t),a},ne.prototype.getSeriesSettings=function(){return N.Prototype.inherit(this.data).seriesLabelSetings},ne.getForecastDomain=function(e){if(!_.isEmpty(e)){for(var t=[],i=[],a=0,r=e;a<r.length;a++){var o=r[a];_.isEmpty(o.points)||(t.push.apply(t,_.map(o.points,function(e){return e.point.x})),i.push.apply(i,_.map(o.points,function(e){return e.point.y})),t.push.apply(t,_.map(o.points,function(e){return e.upperBound.x})),i.push.apply(i,_.map(o.points,function(e){return e.upperBound.y})),t.push.apply(t,_.map(o.points,function(e){return e.lowerBound.x})),i.push.apply(i,_.map(o.points,function(e){return e.lowerBound.y})))}return{x:[d3.min(t),d3.max(t)],y:[d3.min(i),d3.max(i)]}}},ne.prototype.calculateAxesProperties=function(a){function e(e){var t="x"===e,e="y"===e,i=t?s:n,i={pixelSpan:t?d.width:d.height,domainOptions:t?f:S,metaDataColumn:t?g:p,axisZoom:a.axisZoom,isScalar:e||l.isScalar,isVertical:e,isCategoryAxis:t,forcedTickCount:a.forcedTickCount,scaleType:i.scaleType,logAxisScale:i.logAxisScale,axisDisplayUnits:i.displayUnits,axisPrecision:i.precision,useTickIntervalForDisplayUnits:!0,margin:o.margin,invertAxis:!(!e&&!l.isScalar)&&i.invertAxis,featureSwitches:o.featureSwitches,zeroScalarDomain:ne.DefaultZeroScalarDomain,formatString:t?re.valueFormatter.getFormatString(g,re.lineChartProps.general.formatString):null!=v?v:re.valueFormatter.getFormatString(y,re.lineChartProps.general.formatString),outerPadding:t&&l.isScalar?ne.ScalarOuterPadding:0,outerPaddingRatio:t?u.outerPaddingRatio:0,preventNice:t?!!l.isScalar&&C.hasForcedDomain(f):C.hasForcedDomain(S)};return t?(i.getValueFn=function(e,t){return re.CartesianHelper.lookupXValue(l,e,t,l.isScalar,o.featureSwitches)},i.categoryThickness=u.categoryThickness,i.allowSingleScalarTick=l.isScalar,i.maxTickCount=l.scalarKeyCount):e&&(i.isSecValueAxis=h||o.isComboChart,i.shouldClamp=!1),i}var t,i,r,o=this,s=a.categoryAxisOptions,n=a.valueAxisOptions,l=(this.currentViewport=a.viewport,this.margin=a.margin,this.trimOrdinalDataOnOverflow=a.trimOrdinalDataOnOverflow,this.data),c=0<(null==(c=(l=this.viewModelAdapter&&this.originalData?(this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport})).getData():l).series)?void 0:c.length)?l.series[0].data.length:0,u=this.getCategoryLayout(c,a,l),d=this.getPreferredPlotArea(u.isScalar,u.categoryCount,u.categoryThickness,u.outerPaddingRatio),c=(l=this.adjustLayoutForScroll(l,c,u)).series,h=!1,p=this.data.valuesMetadata,g=(_.some(c,function(e){return e.isY2})&&(h=a.roleName===re.LineChartRoles.Y2,c=(m=ne.getDataForValueAxis(l,h)).seriesData,p=m.valuesMetadata),!_.isEmpty(l.series)&&l.series[0].xCol),y=!_.isEmpty(c)&&c[0].yCol,m=this.getAxesDomains(!1,{categoryAxis:!0,valueAxis:!h,secondaryValueAxis:h}),v=C.getAxisFormatString(c),S=C.createScalarDomainOptions(h?m.secondaryValueAxis:m.valueAxis,0),S=C.mergeScalarAxisDomains(n.includeDomain,S),f=l.isScalar?C.mergeScalarAxisDomains(C.createScalarDomainOptions(m.categoryAxis,0),s.includeDomain):this.getCategoryDomain(l),c=C.createAxis(__assign(__assign({},e("y")),{includeZero:this.axisShouldIncludeZero()})),m=!1,b=0,x=!1,b=(c.dataDomain&&_.isNumber(c.dataDomain[0])&&_.isNumber(c.dataDomain[1])&&(m=(null==(r=l.totalLabelsSettings)?void 0:r.show)&&this.supportsTotalLabels(),b=ne.getMaximumMarkerSize(l.series),x=_.some(l.anomalyDetections,function(e){return-1!==e.highestAnomalyPointIndex||-1!==e.lowestAnomalyPointIndex})),(m||b||x)&&(!!c.dataDomain&&_.isNumber(c.dataDomain[0])&&_.isNumber(c.dataDomain[1]),t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],i=!1,r=function(e){t=[Math.min(t[0],e[0]),Math.max(t[1],e[1])],i=!0},m&&(m=ne.adjustDomainForLabels(c,l)).adjusted&&r(m.domain),b&&(m=ne.adjustDomainCommon(c,b)).adjusted&&r(m.domain),x&&r(re.AnomalyDetectionVisualPlugin.adjustDomainForAnomalyMarkers(c.dataDomain,c.scale,l.anomalyDetections)),i)&&(c=C.createAxis(__assign(__assign({},e("y")),{domainOptions:C.mergeScalarAxisDomains(n.includeDomain,S,C.createScalarDomainOptions(t,0)),preventNice:!0}))),h?this.y2AxisProperties=c:this.yAxisProperties=c,C.createAxis(e("x")));return this.interactivityService&&!this.data.isScalar&&(b.categoryIdentities=_.map(l.categoryIdentities,function(e){return function(){return e}})),[b,c]},ne.prototype.getCategoryValueType=function(){var e=this.data.scalarMetadata||this.data.categoryMetadata;return C.getCategoryValueType(e)},ne.getDataForValueAxis=function(e,t){var i=e.series,e=e.valuesMetadata,a=t?{roles:{Y2:!0}}:{roles:{Y:!0}};return{seriesData:_.filter(i,function(e){return e.isY2===t}),valuesMetadata:_.filter(e,a)}},ne.prototype.adjustLayoutForScroll=function(e,t,i){return this.scrolledData=void 0,e&&!e.isScalar&&!this.isScrollable&&this.trimOrdinalDataOnOverflow&&t!==(t=Math.min(t,i.categoryCount))&&((e=this.scrolledData=N.Prototype.inherit(e)).series=ne.sliceSeries(e.series,t),e.categories=e.categories.slice(0,t),e.categoryIdentities)&&(e.categoryIdentities=e.categoryIdentities.slice(0,t)),e},ne.prototype.setAxesLayout=function(e){var t=e.layout,i=(this.currentViewport=t.viewport,this.margin=t.margin,this.trimOrdinalDataOnOverflow=e.trimOrdinalDataOnOverflow,this.viewModelAdapter&&this.originalData&&(i=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=i.getData()),this.data.series&&0<this.data.series.length?this.data.series[0].data.length:0),a=e.layout.axes.x,a=this.data?{categoryCount:_.isEmpty(a.values)?0:a.values.length,categoryThickness:a.categoryThickness,outerPaddingRatio:a.outerPaddingRatio,innerPaddingRatio:a.innerPaddingRatio,isScalar:this.getVisualCategoryAxisIsScalar()}:{categoryCount:0,categoryThickness:re.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:0,innerPaddingRatio:0,isScalar:!1};this.data=this.adjustLayoutForScroll(this.data,i,a),this.xAxisProperties=t.axes.x,2&e.axisType&&(this.isComboChart?this.yAxisProperties=t.axes.y2:this.y2AxisProperties=t.axes.y2),1&e.axisType&&(this.yAxisProperties=t.axes.y1)},ne.adjustDomainForLabels=function(e,t){var i="",a=(0<t.series.length&&0<t.series[0].data.length&&(i=t.series[0].data[0].labelFormatString),re.DataLabelViewModel.createColumnFormatterCacheManager()),r=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(e,t.totalLabelsSettings),a=a.getOrCreate(i,t.totalLabelsSettings,r.units,t.totalLabelsSettings.precision),i=e.dataDomain[0].toString(),r=re.DataLabelRenderer.getLabelFormattedText(a.format(i)),a=re.FontProperties.toTextProperties(t.totalLabelsSettings.fontProperties,r),i=N.TextMeasurementService.estimateSvgTextHeight(a)+re.DataLabelViewModel.labelMargin;return ne.adjustDomainCommon(e,i)},ne.getMaximumMarkerSize=function(e){return 0<e.length?d3.max(e,function(e){return e.lineStyle.markerProperties.showMarker?e.lineStyle.markerProperties.size:0})*re.MarkerRenderer.sizeRatio:0},ne.adjustDomainCommon=function(e,t){var i=e.dataDomain,a=e.scale.domain(),e=e.scale,r=e(i[0])+t,i=e(i[1])-t,t=e.invert(r),r=e.invert(i);return C.adjustDomainWithConstantPixelDifference(a[0],a[1],t,r)},ne.prototype.getCategoryLayout=function(e,t,i){var a;return i?(a=this.getVisualCategoryAxisIsScalar(),re.CartesianChartLayout.getLayout(this.data,{availableWidth:this.availableWidth,categoryCount:e,preferredCategoryWidth:null!=(e=null==i?void 0:i.preferredCategoryWidth)?e:null,domain:null==(e=C.createDomain(i.series,C.getCategoryValueType(null==i?void 0:i.categoryMetadata),a,[t.categoryAxisOptions.includeDomain]))?void 0:e.domain,isScalar:a,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio})):{categoryCount:0,categoryThickness:re.CartesianHelper.MinOrdinalRectThickness,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio,isScalar:!1}},ne.prototype.getErrorBarsCard=function(){var n=this;if(!this.isAreaChart){var l,e,c=this.originalData;if(c&&c.series&&0!==c.series.length)return l=function(e){return n.host.getLocalizedString(e)},e=[(e=re.StandardObjectIdentifiers.error).enabled,e.errorRange,e.barShow,e.barMatchSeriesColor,e.barColor,e.barWidth,e.barBorderColor,e.barBorderSize,e.shadeShow,e.shadeBandStyle,e.shadeColor,e.shadeMatchSeriesColor,e.shadeTransparency,e.labelShow,e.labelFontFamily,e.labelFontSize,e.labelBold,e.labelItalic,e.labelUnderline,e.labelColor,e.labelMatchSeriesColor,e.labelFormat,e.labelBackground,e.labelBackgroundColor,e.labelBackgroundTransparency,e.markerShape,e.markerSize,e.showMarkerByDefault,e.tooltipShow,e.tooltipFormat],(e=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("errorBars"),"Visual_Error_Bars",e,l,!0,!0)).addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("measure",function(s){s.withDisplayName("Series");for(var e=0,t=c.valuesMetadataBySeries;e<t.length;e++)!function(e){var t=_.first(e.usedInSeriesIndices);if(null!=t){var i=e.metadataColumn,t=c.series[t];if(null==t)return;var a=e.valueSelector.getSelector(),r=n.isComboChart?u.fromRoles([re.LineChartRoles.Rows,re.LineChartRoles.Category]):p.create(),r=__assign(__assign({},a),{data:[r],highlightMatching:1}),o={localize:l,uncertainty:t.uncertainty,targetMeasure:e.metadataColumn.expr,measureSelector:a,dataPointSelector:r,featureSwitches:n.featureSwitches};s.addContainerItem(i.queryName,i.displayName,function(e){return re.UncertaintyHelper.getFormattingContainer(o,e)})}}(t[e])})}),e.build()}},ne.prototype.getDataPointCard=function(a){var r,o,e,s,n,l,c=this,u=this.originalData;if(u&&u.series&&0!==u.series.length)return r=function(e){return c.host.getLocalizedString(e)},o=N.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,re.lineChartObjectProps.lineStyles.showSeries,!0),e=[re.lineChartObjectProps.lineStyles.lineStyle,re.lineChartObjectProps.lineStyles.showSeries,re.lineChartObjectProps.lineStyles.strokeWidth,re.lineChartObjectProps.lineStyles.strokeLineJoin,re.lineChartObjectProps.lineStyles.stepped,re.lineChartObjectProps.dataPoint.fill,re.lineChartObjectProps.dataPoint.showAllDataPoints,re.lineChartObjectProps.dataPoint.defaultColor,re.lineChartObjectProps.dataPoint.transparency,re.cartesianChartProps.categoryAxis.preferredCategoryWidth,re.comboChartObjectProps.lineStyles.shadeArea,re.cartesianChartProps.categoryAxis.reverseStackOrder],e=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("lines"),"Visual_Lines",e,r),s={lineStyle:re.lineChartObjectProps.lineStyles.lineStyle,strokeLineJoin:re.lineChartObjectProps.lineStyles.strokeLineJoin,strokeWidth:re.lineChartObjectProps.lineStyles.strokeWidth,stepped:re.lineChartObjectProps.lineStyles.stepped,showSeries:re.lineChartObjectProps.lineStyles.showSeries},n={styleProps:s,style:u.lineStyle,showSeries:!0,showSeriesValue:o},l=this.getValidDataPointIndices(u),e.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).withContainerDisabled(!o).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",r("All"),function(e){var t;c.addDataPointGroupsToContainer(a,n,e,l),o||(t=[re.lineChartObjectProps.lineStyles.lineStyle,re.lineChartObjectProps.lineStyles.strokeWidth,re.lineChartObjectProps.lineStyles.strokeLineJoin,re.lineChartObjectProps.lineStyles.stepped,re.lineChartObjectProps.lineStyles.showMarkerByDefault,re.lineChartObjectProps.lineStyles.showMarker,re.lineChartObjectProps.lineStyles.markerShape,re.lineChartObjectProps.lineStyles.markerSize,re.lineChartObjectProps.lineStyles.markerColor],e.addSimpleSlice("showSeriesLink",function(){return new h.SeriesDialogLinkBuilder({descriptor:re.lineChartObjectProps.lineStyles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<u.series.length)for(var t=0,i=u.series;t<i.length;t++)!function(t){n={styleProps:s,style:t.lineStyle,selector:y(t.identity.getSelector())},e.addContainerItem(t.seriesName,t.seriesName,function(e){return c.addDataPointGroupsToContainer(a,n,e,l,t)})}(i[t])})}),this.getVisualCategoryAxisIsScalar()||e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("categoryWidth",new re.builder.NumUpDownBuilder({descriptor:re.cartesianChartProps.categoryAxis.preferredCategoryWidth,value:a.preferredCategoryWidth,options:{minValue:{type:0,value:20},maxValue:{type:1,value:180},unitSymbol:"Numeric_Pixel"}}).build())}),e.build()},ne.prototype.addDataPointGroupsToContainer=function(i,a,e,t,r){function o(e){return s.host.getLocalizedString(e)}var s=this,n=(re.LineStyle.addLineStyleFormattingContainers(a,e),this.originalData),l=_.map(n.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}}),t=(i.reverseStackOrder||l.reverse(),0<t.length&&ne.chartTypeSupportsExplicitDots(n.isComboChart)),c=(e.addGroup("colors",function(e){e.withDisplayName("Visual_Colors");var t={groupBuilder:e,dataPoints:l,seriesColorProps:re.lineChartObjectProps.dataPoint,localize:o,featureSwitches:s.featureSwitches},t=(r?(t=__assign(__assign({},t),{selector:a.selector}),N.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t,a.selector)):N.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t),s.originalData.series.length);(s.originalData.hasDynamicSeries||1<t)&&s.featureSwitches&&s.featureSwitches.flipStackOrder&&s.isStacked()&&e.addSimpleSlice("Visual_ReverseStackOrder",new h.ToggleSwitchBuilder({descriptor:re.cartesianChartProps.categoryAxis.reverseStackOrder,value:i.reverseStackOrder}).build()),s.isComboChart&&(r?e.addSimpleSlice("shadearea",function(){return new h.ToggleSwitchBuilder({descriptor:__assign(__assign({},re.comboChartObjectProps.lineStyles.shadeArea),{selector:r.identity.getSelector()}),value:r.lineStyle.shadeArea}).build()}):e.addSimpleSlice("shadearea",function(){return new h.ToggleSwitchBuilder({descriptor:re.comboChartObjectProps.lineStyles.shadeArea,value:n.lineStyle.shadeArea}).build()}))}),this.isAreaChart&&this.featureSwitches.areaChartTransparency),u=n.areaTransparency;t&&c&&e.addGroup("shadeArea",function(e){e.withDisplayName("Visual_Shapes_ShadeArea").addSimpleSlice("transparency",h.SliderBuilder.getTransparencySliderBuilder({descriptor:re.lineChartObjectProps.dataPoint.transparency,value:u,localize:o}).build(),function(e){return e.withDisabled(!!r)}),r&&e.withDisabled(!0,"")})},ne.prototype.getMarkersCard=function(){var s,n,l,e,a=this,c=this.originalData;if(c&&c.series&&0!==c.series.length)return s=function(e){return a.host.getLocalizedString(e)},n=N.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,re.lineChartObjectProps.lineStyles.showSeries,!0),l={showMarker:re.lineChartObjectProps.lineStyles.showMarker,markerShape:re.lineChartObjectProps.lineStyles.markerShape,markerSize:re.lineChartObjectProps.lineStyles.markerSize,markerColor:re.lineChartObjectProps.lineStyles.markerColor,showAllDataPoints:re.lineChartObjectProps.dataPoint.showAllDataPoints,fill:re.lineChartObjectProps.dataPoint.fill,showSeries:re.lineChartObjectProps.lineStyles.showSeries},(e=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("markers"),"Visual_Markers",l,s)).addTopLevelToggle("showMarkerTopLevel",function(){return new h.ToggleSwitchBuilder({descriptor:__assign({},l.showMarker),value:c.lineStyle.markerProperties.showMarker}).build()}),e.addGroup("applySettingsTo",function(e){var t=a.getValidDataPointIndices(c),i=0<t.length&&ne.chartTypeSupportsExplicitDots(c.isComboChart),r=i?a.getCategoryColorsOptions(c,t,e,i):void 0,o={styleProps:l,style:c.lineStyle,categoryColorsOptions:r};e.withContainerDisabled(!n).withDisplayName("Apply_Settings_To").withCollapsible(!1),e.addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",s("All"),function(e){var t;re.MarkerProperties.addMarkersFormattingContainers(o,e),n||(t=[re.lineChartObjectProps.lineStyles.lineStyle,re.lineChartObjectProps.lineStyles.strokeWidth,re.lineChartObjectProps.lineStyles.strokeLineJoin,re.lineChartObjectProps.lineStyles.stepped,re.lineChartObjectProps.lineStyles.showMarker,re.lineChartObjectProps.lineStyles.showMarkerByDefault,re.lineChartObjectProps.lineStyles.markerShape,re.lineChartObjectProps.lineStyles.markerSize,re.lineChartObjectProps.lineStyles.markerColor,re.lineChartObjectProps.dataPoint.showAllDataPoints,re.lineChartObjectProps.dataPoint.fill],e.addSimpleSlice("showSeriesLink",function(){return new h.SeriesDialogLinkBuilder({descriptor:re.lineChartObjectProps.lineStyles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<c.series.length)for(var t=0,i=c.series;t<i.length;t++){var a=i[t];o={styleProps:l,style:a.lineStyle,categoryColorsOptions:r,selector:y(a.identity.getSelector())},e.addContainerItem(a.seriesName,a.seriesName,function(e){return re.MarkerProperties.addMarkersFormattingContainers(o,e)})}})}),e.build()},ne.prototype.getDataLabelsCard=function(){function o(e){return s.host.getLocalizedString(e)}var s=this,n=this.originalData,e=n.dataLabelsSettings,l=n.series.length,c=1<l||!n.categoryMetadata||this.isComboChart,u=[re.labelPosition.auto,re.labelPosition.above,re.labelPosition.under],t=(this.isStacked()&&(u=[re.labelPosition.auto,re.labelPosition.insideCenter,re.labelPosition.insideEnd]),e.position&&u.indexOf(e.position)<0&&(e.position=re.labelPosition.auto),__assign(__assign({},re.lineChartObjectProps.labels),{position:re.lineChartObjectProps.labels.labelPosition,precision:re.lineChartObjectProps.labels.labelPrecision,displayUnits:re.lineChartObjectProps.labels.labelDisplayUnits,labelBackgroundColor:re.lineChartObjectProps.labels.backgroundColor,labelBackgroundTransparency:re.lineChartObjectProps.labels.backgroundTransparency,showDynamicLabels:re.lineChartObjectProps.labels.showDynamicLabels,dynamicLabelValue:re.lineChartObjectProps.labels.dynamicLabelValue})),i=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",t,o),a=this.getLabelSettingsOptions(void 0,e,null,c,u),d={cardBuilder:i,dataLabelsProps:t,featureSwitches:this.featureSwitches,hostServices:this.host,options:a,includeAltConstantValueSelector:!0,individualSelector:this.isComboChart?void 0:this.getLabelIndividualSelector(!1)};return i.withDescription("Visual_DataPointsLabelsDescription"),t.show&&i.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:t.show,value:a.dataLabelsSettings.show}).build()}),i.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){return re.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)}),c)for(var t=0;t<l;t++){var i=n.series[t],a=i.labelSettings||n.dataLabelsSettings,r=(a.position&&u.indexOf(a.position)<0&&(a.position=re.labelPosition.auto),i.identity.getSelector()),a=s.getLabelSettingsOptions(void 0,a,r,void 0,u);d.includeAltConstantValueSelector=!1,d.selector=n.hasDynamicSeries?g.normalizeSelector(r):r,d.individualSelector=s.getLabelIndividualSelector(!0),d.options=a,e.addContainerItem(i.seriesName,i.seriesName,function(e){return re.DataLabelViewModel.createDataLabelsFormattingContainers(d,e)})}})}),i.build()},ne.prototype.getSeriesLabelsCard=function(){var o,e,s,n,l,t,i,a,c,u=this;if(this.showSeriesCard())return e=(o=this.originalData).seriesLabelSetings,s=o.series.length,n=this.showLabelPerSeries(),l=function(e){return u.host.getLocalizedString(e)},t=__assign(__assign({},re.lineChartObjectProps.seriesLabels),{show:{objectName:"seriesLabels",propertyName:"show"}}),i=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("seriesLabels"),"Visual_SeriesLabels",t,l),a=this.getSeriesLabelSettingsOptions(void 0,e,null,n),c={cardBuilder:i,seriesLabelsProps:t,featureSwitches:this.featureSwitches,hostServices:this.host,seriesOptions:a},i.withDescription("Visual_SeriesDescription"),t.show&&i.addTopLevelToggle("show",function(){return new h.ToggleSwitchBuilder({descriptor:t.show,value:a.seriesLabelsSettings.show}).build()}),i.addGroup("applySettingsTo",function(e){e.withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",l("All"),function(e){return re.DataLabelViewModel.createSeriesLabelsFormattingContainers(c,e)}),n)for(var t=0;t<s;t++){var i=o.series[t],a=i.seriesSettings||o.seriesLabelSetings,r=i.identity.getSelector(),a=u.getSeriesLabelSettingsOptions(void 0,a,r,void 0);c.selector=o.hasDynamicSeries?g.normalizeSelector(r):r,c.seriesOptions=a,e.addContainerItem(i.seriesName,i.seriesName,function(e){return re.DataLabelViewModel.createSeriesLabelsFormattingContainers(c,e)})}})}),i.build()},ne.prototype.getTotalsCard=function(){var t=this;if(this.supportsTotalLabels()){var e,i,a=this.originalData.totalLabelsSettings;if(a)return e=__assign(__assign({},re.lineChartObjectProps.totals),{precision:re.lineChartObjectProps.totals.labelPrecision,displayUnits:re.lineChartObjectProps.totals.labelDisplayUnits}),(i=new re.builder.FormattingCardBuilder(new re.builder.FormattingCardUidBuilder("totals"),"Visual_DataTotalLabels",e,function(e){return t.host.getLocalizedString(e)})).withDescription("Visual_DataTotalLabelsDescription"),i={cardBuilder:i,dataLabelsProps:e,featureSwitches:this.featureSwitches,hostServices:this.host,options:this.getTotalLabelSettingsOptions(void 0,a),individualSelector:this.getLabelIndividualSelector(!1)},re.DataLabelViewModel.getDataLabelsFormattingModel(i)}},ne.prototype.getLabelIndividualSelector=function(e){return re.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:null!=_.first(this.originalData.categories),hasDynamicSeries:this.originalData.hasDynamicSeries,hasSeriesSelector:e})},ne.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getDataPointCard(e.categoryAxisData)},function(){return t.getMarkersCard()},function(){return t.getDataLabelsCard()},function(){return t.getSeriesLabelsCard()},function(){return t.getTotalsCard()},function(){return t.getErrorBarsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:0}},ne.prototype.getDisambiguationSubSelectables=function(e,t){if(!this.data)return[];var i=[];if(void 0===t||3===t)for(var a=0,r=this.data.series;a<r.length;a++){var o,s=r[a];s.lineStyle.markerProperties.showMarker&&(o=null==(o=null==s?void 0:s.identity)?void 0:o.getSelectorsByColumn(),s=this.host.getLocalizedString("MiniToolbar_Markers",s.seriesName),i.push(e.createVisualSubSelectionForSingleObject({objectName:"markers",subSelectionType:3,displayName:s,showUI:!0,selectorsByColumn:o})))}return i},ne.prototype.getSelectorsByColumnFromSubselectedElement=function(e){switch(d3.select(e).attr(re.SubSelectableObjectNameAttribute)){case"area":case"lines":var t=d3.select(e).datum(),t=null==(t=null==t?void 0:t.identity)?void 0:t.getSelectorsByColumn();if(t)return t;break;case"data-labels":case"series-labels":t=re.DataLabelUtil.getLabelSeriesSelectorsByColumn(e,this.data.series);if(t)return t;break;default:return}},ne.prototype.getSubSelectionCustomOutlines=function(e){var t=e.visualObjects[0].objectName,i=e.visualObjects[0].selectorsByColumn;if("markers"===t){e=(null==(e=this.scrolledData)?void 0:e.series)||(null==(t=this.data)?void 0:t.series);if(e)for(var a=0,r=e;a<r.length;a++){var o=r[a],s=null==(s=o.identity)?void 0:s.getSelectorsByColumn();if(g.equalsSelectorsByColumn(s,i))return ne.getMarkerOutlinesForSeries(o,this.buildViewModel(0),this.tooltipService.getTooltipOverlayElement()||this.mainGraphicsPositionRect)}}},ne.prototype.getSubSelectionCustomElements=function(e){var t,e=e.visualObjects[0].objectName;if("area"===e)return e=d3.event,t=this.buildViewModel(0),(e=ne.findSubSelectedAreaElement({x:e.clientX,y:e.clientY},this.mainGraphicsSVG,t))?[e]:void 0},ne.prototype.getSubSelectionStyles=function(e){var t,e=_.first(e).visualObjects;if(0<e.length){(e=e[0])&&e.selectorsByColumn&&(t=g.normalizeSelector(g.convertSelectorsByColumnToSelector(e.selectorsByColumn)));var i,a,r=1===this.data.series.length;switch(e.objectName){case"lines":return t?{type:3,stroke:{reference:{cardUid:"Visual-lines",groupUid:"lines-applySettingsTo-series--colors",sliceUid:"lines-applySettingsTo-series--colors-datapoint",selector:t},label:this.host.getLocalizedString("Visual_Shape_Line")}}:void 0;case"area":return t?s.getShapeSubSelectionStyles("".concat("Visual","-").concat("lines"),"".concat("lines-applySettingsTo-series","--").concat("colors"),"".concat("lines-applySettingsTo-series","--").concat("colors","-datapoint"),this.host,!1,!0,t):void 0;case"markers":return t?(i="".concat("Visual","-").concat("markers"),a="".concat("markers-applySettingsTo-series","--").concat("colors"),s.getShapeSubSelectionStyles(i,r?void 0:a,"".concat(a,"-markerColor"),this.host,!1,!0,r?void 0:t)):void 0;case"data-labels":return s.getDataLabelsSubSelectionStyles({hostServices:this.host,omitSelectorForSingleSeries:r,individualSelector:this.getLabelIndividualSelector(!r),selector:t,repetitionSelector:void 0,inContainer:!0});case"total-labels":return s.getTotalLabelsSubSelectionStyles(this.host,this.getLabelIndividualSelector(!1),void 0);default:return}}},ne.prototype.getSubSelectionShortcuts=function(e,t){if(!t){t=_.first(e).visualObjects;if(0<t.length){var i,a,r,e=t[0],o=(_.isEmpty(e.selectorsByColumn)||(i=g.normalizeSelector(g.convertSelectorsByColumnToSelector(e.selectorsByColumn))),{key:"Delete",nextValue:!1}),s={sourceUid:"".concat("markers-applySettingsTo-series","--showMarker"),selector:i};switch(e.objectName){case"lines":case"area":return i?[{type:0,excludedResetSourceUids:[{sourceUid:"".concat("Visual","-").concat("labels")},a={sourceUid:"".concat("labels","-").concat("applySettingsTo","-series--showSeries"),selector:i},s,r={sourceUid:"".concat("seriesLabels","-").concat("applySettingsTo","-series--showSeries"),selector:i}]},{type:2,sourceUid:a.sourceUid,enabledLabel:this.host.getLocalizedString("Format_AddDataLabels"),selector:a.selector},{type:2,sourceUid:s.sourceUid,enabledLabel:this.host.getLocalizedString("Format_AddMarkers"),selector:s.selector,keyboardShortcuts:[o]},{type:2,sourceUid:r.sourceUid,enabledLabel:this.host.getLocalizedString("Format_AddSeriesLabel"),selector:r.selector},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("lines")}],label:this.host.getLocalizedString("Format_Line")}]:void 0;case"markers":return i?[{type:2,sourceUid:s.sourceUid,disabledLabel:this.host.getLocalizedString("Delete"),selector:s.selector,keyboardShortcuts:[o]},{type:0,excludedResetSourceUids:[s]},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("markers")}],label:this.host.getLocalizedString("Format_Markers")}]:void 0;default:return}}}},ne.prototype.enumerateObjectInstances=function(e,t){var i,a=this.originalData;if(a)switch(t.objectName){case"dataPoint":this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e);break;case"seriesLabels":null!=(i=this.featureSwitches)&&i.lineChartSeriesLabels&&this.enumerateSeriesDataLabels(e);break;case"totals":this.supportsTotalLabels()&&this.enumerateTotalLabels(e);break;case re.lineChartProps.lineStyles.strokeLineJoin.objectName:ne.enumerateLineStyles(e,a,this.dataView);break;case re.ForecastHelper.forecastObjectName:this.supportsForecast()&&(i=void 0,_.isEmpty(a.anomalyDetections)||(i=this.host.getLocalizedString("Visual_AnomalyDetection_WarningMessage_NoWithForecast")),re.ForecastHelper.enumerateObjectInstances(e,a.forecastLines,this.style,i));break;case re.AnomalyDetectionObjectConstants.capabilityObjectName:this.supportsAnomalyDetection()&&(i=a.isScalar,re.AnomalyDetectionVisualPlugin.enumerateAnomalyObjectInstances(this.host,this.data,this.dataView,e,a.anomalyDetections,this.style,i,t.selectors))}},ne.prototype.enumerateDataPoints=function(e){var i=this.originalData;if(i&&i.series&&0!==i.series.length){N.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(i.series,function(e){return{color:e.color,displayName:e.seriesName,identity:e.identity}})},this.featureSwitches);var t=this.getValidDataPointIndices(i),a=0<t.length&&ne.chartTypeSupportsExplicitDots(i.isComboChart);if(a){for(var r=[],o=0,s=t;o<s.length;o++){var n=s[o],n=re.CategoryLevelUtils.concatenateCategoryLevels(i.categoryData[n.categoryIndex].hierarchyCategoryLevels);r.push(n.value)}N.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(t,function(e,t){return{color:i.series[e.seriesIndex].data[e.dataPointIndex].pointColor,displayName:r[t],identity:i.categoryIdentities[e.categoryIndex]}}),fillInstanceKind:i.hasDynamicSeries?1:3,noDefaultFillColor:a,multipleRole:i.multipleIdentity?re.LineChartRoles.Rows:void 0,supportDataPointTransparency:this.isAreaChart&&this.featureSwitches.areaChartTransparency,dataPointTransparency:i.areaTransparency},this.featureSwitches)}}},ne.prototype.enumerateDataLabels=function(e){var t=this.originalData,i=t.dataLabelsSettings,a=t.series.length,r=this.showLabelPerSeries(),o=[re.labelPosition.auto,re.labelPosition.above,re.labelPosition.under];if(this.isStacked()&&(o=[re.labelPosition.auto,re.labelPosition.insideCenter,re.labelPosition.insideEnd],i.position)&&o.indexOf(i.position)<0&&(i.position=re.labelPosition.auto),re.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,i,null,r,o),this.featureSwitches),r&&i.showLabelPerSeries)for(var s=0;s<a;s++){var n=t.series[s],l=n.labelSettings||t.dataLabelsSettings,n=(e.pushContainer({displayName:n.seriesName}),n.identity.getSelector());t.hasDynamicSeries&&(n=g.normalizeSelector(n)),re.DataLabelViewModel.enumerateDataLabels(this.getLabelSettingsOptions(e,l,n,void 0,o),this.featureSwitches),e.popContainer()}},ne.prototype.showSeriesCard=function(){return!(this.isComboChart&&!this.data.hasY2Role)},ne.prototype.enumerateSeriesDataLabels=function(e){if(this.showSeriesCard()){var t=this.originalData,i=t.seriesLabelSetings,a=t.series.length,r=this.showLabelPerSeries();if(re.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,i,null,r),this.featureSwitches),r&&i.showLabelPerSeries)for(var o=0;o<a;o++){var s=t.series[o],n=s.seriesSettings||t.seriesLabelSetings,s=(e.pushContainer({displayName:s.seriesName}),s.identity.getSelector());t.hasDynamicSeries&&(s=g.normalizeSelector(s)),re.DataLabelViewModel.enumerateSeriesDataLabels(this.getSeriesLabelSettingsOptions(e,n,s,void 0),this.featureSwitches),e.popContainer()}}},ne.prototype.enumerateTotalLabels=function(e){var t=this.originalData.totalLabelsSettings;t&&re.DataLabelViewModel.enumerateDataLabels(this.getTotalLabelSettingsOptions(e,t),this.featureSwitches)},ne.enumerateLineStyles=function(e,t,i){var a;if(1<t.series.length&&(a=N.DataViewObjects.getValue(i&&i.metadata&&i.metadata.objects,re.lineChartProps.lineStyles.showSeries,!1)),re.LineStyle.enumerate({enumeration:e,style:t.lineStyle,showSeries:a}),a)for(var r=0,o=t.series.length;r<o;r++){var s=t.series[r];e.pushContainer({displayName:s.seriesName}),re.LineStyle.enumerate({enumeration:e,style:s.lineStyle,selector:s.identity.getSelector()}),e.popContainer()}},ne.prototype.supportsTotalLabels=function(){return!!(!this.data||!this.data.multipleIdentity)&&this.isStacked()},ne.prototype.supportsTrendLine=function(){var e,t;return!this.data.multipleIdentity&&(e=this.getVisualCategoryAxisIsScalar(),t=this.haveY2Data()&&!this.isComboChart,!se.hasFlag(this.lineType,16))&&e&&this.data.hasValues&&!t},ne.prototype.supportsStaticReferenceLines=function(){return this.getVisualCategoryAxisIsScalar()},ne.prototype.supportsForecast=function(){var e;return!this.data.multipleIdentity&&(e=this.getVisualCategoryAxisIsScalar(),!se.hasFlag(this.lineType,16))&&e&&this.data.hasValues&&1===this.data.series.length&&!this.hasLegend()},ne.prototype.supportsAnomalyDetection=function(){return!this.data.multipleIdentity&&this.options.featureSwitches.daxTransformEnabled&&!se.hasFlag(this.lineType,16)&&this.data.hasValues},ne.prototype.isStacked=function(){return se.hasFlag(this.lineType,16)},ne.prototype.shouldSuppressAnimation=function(){return!!this.suppressAnimation},ne.prototype.showLabelPerSeries=function(){var e=this.originalData;return 1<e.series.length||!e.categoryMetadata||this.isComboChart},ne.prototype.getLabelSettingsOptions=function(e,t,i,a,r){return{enumeration:e,dataLabelsSettings:t,show:!0,position:!0,positionObject:r,displayUnits:!0,precision:!0,selector:i,showAll:a,fontSize:!0,fontFamily:!0,labelDensity:this.data.isScalar,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},ne.prototype.getSeriesLabelSettingsOptions=function(e,t,i,a){return{enumeration:e,show:!0,seriesLabelsSettings:t,seriesColor:t.seriesColor,seriesPosition:t.seriesPosition,selector:i,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,fontProperties:t.fontProperties,seriesWordWrap:t.seriesWordWrap,seriesMaximumWidth:t.seriesMaximumWidth,defaultSeriesWidth:t.defaultSeriesWidth,showAll:a,fontSize:!0,fontFamily:!0,bold:!0,italic:!0,underline:!0}},ne.prototype.getTotalLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,enableBackground:t.enableBackground,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0}},ne.prototype.overrideXScale=function(e){this.xAxisProperties=e},ne.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},ne.prototype.render=function(e,t,i){var a,r=this,o=re.AnimatorCommon.GetAnimationDuration(this.animator,e),o=(this.suppressAnimation&&(o=0),this.buildViewModel(o)),s=this.tooltipService.getTooltipOverlayElement(),n=(this.mainGraphicsPositionRect=this.mainGraphicsSVG.selectAll(ne.PositionRectSelector.selector).data(function(e){return!s&&i?[e]:[]}).join("rect").attrs({x:0,width:0,height:0}).style("pointer-events","none").classed(ne.PositionRectSelector.class,!0),{hoverLine:this.hoverLine,hoverLineContext:this.hoverLineContext,mainGraphicsContext:this.mainGraphicsContext,svgDefs:this.svgDefs,mainGraphicsSVG:this.mainGraphicsSVG,mainGraphicsPositionOverlay:s||this.mainGraphicsPositionRect}),l=(re.AnomalyDetectionCartesianRenderer.render(this.data.anomalyDetections,n.mainGraphicsSVG,o.xAxisProperties.scale,o.yAxisProperties.scale,o.currentViewport,o.animationDuration,this.host,this.isInteractiveVisual),ne.hasAnomalies(this.data)?this.data.anomalyDetections[0].anomalies:[]);return this.anomalyNavigationHelper.update(l,this.scrolledData,this.focusedDatum,function(e){return ne.updateFocusElement(r.mainGraphicsContext,e,r.buildViewModel(0),r.host)},this.mainGraphicsContext),this.isInteractiveChart?(l=$.extend(n,{dragHandle:this.dragHandle,selectionCircles:this.selectionCircles}),a=ne.renderOld(o,l,this.interactivityService,this,this,this.isInteractiveChart,e,this.markerRenderer,this.style),l.dragHandle&&(this.dragHandle=l.dragHandle)):a=ne.renderNew({viewModel:o,renderContext:n,interactivityService:this.interactivityService,plotAreaHelper:this,tooltipService:this.tooltipService,tooltipInteractivity:this,markerRenderer:this.markerRenderer,style:this.style,host:this.host,anomalyNavigationHelper:this.anomalyNavigationHelper,formatMode:i}),this.interactivityService&&(a.navigationOptions={helper:this,navigationStrategy:o.data.isScalar?re.DataPointNavigationStrategy.SeriesFirst:re.DataPointNavigationStrategy.CategoryFirst}),re.ForecastHelper.render(this.data.forecastLines,n.mainGraphicsSVG,o.xAxisProperties.scale,o.yAxisProperties.scale,o.currentViewport,o.animationDuration),re.SVGUtil.flushAllD3TransitionsIfNeeded(this.options),a},ne.prototype.buildViewModel=function(e){return{currentViewport:this.currentViewport,data:this.scrolledData||this.data,allData:this.data,animationDuration:e,horizontalOffset:this.getXOfFirstCategory(),isComboChart:this.isComboChart,lineClassAndSelector:ne.LineClassSelector,lineType:this.lineType,margin:this.margin,tooltipsEnabled:this.tooltipsEnabled,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,y2AxisProperties:this.y2AxisProperties,focusedDatum:this.focusedDatum}},ne.renderNew=function(o){var s=o.viewModel,d=o.renderContext,R=o.plotAreaHelper,a=o.tooltipService,B=o.tooltipInteractivity,t=o.viewModel.data,e=o.markerRenderer,i=o.style;if(t){for(var r=_.filter(t.series,function(e){return e.uncertainty&&e.uncertainty.renderUncertainty}),H=!_.isEmpty(r),n=!s.isComboChart,l=[],U=0,j=s.data.series;U<j.length;U++){var c=j[U];l.push(c.lineStyle.markerProperties),H&&c.uncertainty&&(l.push(c.uncertainty.markers),c.uncertainty.markersFlipped)&&l.push(c.uncertainty.markersFlipped)}e.ensureMarkers(o.renderContext.svgDefs,l);var h,u,z,p,E,W,G,Y,X,g,K,Z,y=se.hasFlag(s.lineType,16),m=s.margin,q=s.currentViewport,$=q.height-(m.top+m.bottom),m=q.width-(m.left+m.right),v=s.xAxisProperties.scale,S=s.yAxisProperties.scale,f=s.y2AxisProperties&&s.y2AxisProperties.scale,b=s.horizontalOffset,x=t.isScalar,C=t.seriesLabelSetings,w=(C&&C.show&&(w=C?100*C.defaultSeriesWidth/m:0,w=Math.min(Math.max(1,w),50),m-=(C?C.defaultSeriesWidth?w:C.seriesMaximumWidth:0)/100*m),s.focusedDatum),D=o.interactivityService&&o.interactivityService.hasSelection(),J=se.hasFlag(s.lineType,2)||se.hasFlag(s.lineType,16),A=J||t.lineStyle.shadeArea||_.some(t.series,function(e){return e.lineStyle.shadeArea}),P=s.animationDuration,L=((t.categories.length*t.series.length>re.AnimatorCommon.MaxDataPointsToAnimate||e.shouldDisableAnimations()&&_.some(l,function(e){return e.showMarker})||A)&&(P=0),function(e){return v(ne.getXValue(e,x))+b}),M=y?(h=function(e){return S(e.stackedValue-e.value)},function(e){return S(e.stackedValue)}):(h=function(e){return(e.isY2?f:S)(0)},function(e){return(e.isY2?f:S)(e.value)}),V=(A&&(u=ne.getAreaGenerator(L,h,M),z=ne.getAreaGenerator(L,h,M).curve(d3.curveStep)),ne.getLineGenerator(L,M)),T=ne.getLineGenerator(L,M).curve(d3.curveStep),F=(se.hasFlag(s.lineType,4)&&(V.curve(d3.curveBasis),u)&&u.curve(d3.curveBasis),ne.hasAnomalies(t)?o.host.getLocalizedString("Visual_Plot")+" "+o.host.getLocalizedString("Visual_Plot_ScreenReader_NavigateToAnomalies"):o.host.getLocalizedString("Visual_Plot")),F=(d.mainGraphicsContext.attr("aria-label",F),d.mainGraphicsSVG.attr("height",$).attr("width",m),A?(p=(F=d.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).data(_.filter(t.series,function(e){return J||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()})).enter().append(ne.PathElementName).classed(ne.CategoryAreaSelector.class,!0).merge(F).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return D&&!e.selected?ne.AreaTransparencyReductionFactor*(1-t.areaTransparency/100):1-t.areaTransparency/100}).classed(re.HtmlSubSelectableClass,n).attr(re.SubSelectableObjectNameAttribute,"area").attr(re.SubSelectableTypeAttribute,3).each(function(u){var t=this;re.HtmlSubSelectionHelper.setDataForElement(t,{getDisplayName:function(){var e=d3.select(t).datum().seriesName;return o.host.getLocalizedString("MiniToolbar_Area",e)},getRegionOutlines:function(){for(var e=d.mainGraphicsSVG.node().getBoundingClientRect(),t=e.left,r=e.top,o={type:1,x:e.x,y:e.y,height:e.height,width:e.width},s=q.scale,e=S.range(),n=_.min(e),l=_.max(e),c=[],i=0,a=ne.getDefinedDataArray(u.data);i<a.length;i++)!function(i){var e=i.map(function(e){return{x:ne.convertSvgXToClientX(L(e),0,s,t),y:ne.convertSvgYToClientY(M(e),s,r)}}),a=[],e=(e.forEach(function(e,t){t=_.clamp(h(i[t]),n,l);a.unshift({x:e.x,y:ne.convertSvgYToClientY(t,s,r)})}),__spreadArray(__spreadArray([],e,!0),a,!0));c.push({type:3,points:e,clipPath:o})}(a[i]);return[{id:"".concat("area","-").concat(u.lineIndex),outline:{type:0,outlines:c}}]}})}),o.formatMode&&n&&p.style("pointer-events","auto"),p.interrupt(),P?p.transition().ease(d3.easeLinear).duration(P).attr("d",function(e){return(e.lineStyle.stepped?z:u)(e.data)}):p.attr("d",function(e){return(e.lineStyle.stepped?z:u)(e.data)}),p.order(),F.exit().remove()):p=d.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).remove(),H?(F=d.mainGraphicsContext.selectAll(ne.UncertaintySelector.selector).data([1]).join("g").attr("class",ne.UncertaintySelector.class),E=d3.area().x(L).y0(function(e){return null!=e.uncertainty.lower?(e.isY2?f:S)(e.uncertainty.lower):M(e)}).y1(function(e){return null!=e.uncertainty.upper?(e.isY2?f:S)(e.uncertainty.upper):M(e)}).defined(function(e){return e&&e.uncertainty&&(null!=e.uncertainty.upper||null!=e.uncertainty.lower)}),W=d3.line().x(L).y(function(e){return(e.isY2?f:S)(e.uncertainty.lower)}).defined(function(e){return e&&e.uncertainty&&null!=e.uncertainty.lower}),G=d3.line().x(L).y(function(e){return(e.isY2?f:S)(e.uncertainty.upper)}).defined(function(e){return e&&e.uncertainty&&null!=e.uncertainty.upper}),Y=function(e,t){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,D,oe.convertTransparencyToOpacity(t))},F.selectAll(ne.UncertaintyAreas.selector).data(_.filter(r,function(e){return e.uncertainty.band.show}),function(e){return e.identity.getKey()}).join("g").attr("class",ne.UncertaintyAreas.class).order().each(function(e){var t,i,a,r;null==e||_.isEmpty(e.data)||(t=e.uncertainty.band,i=d3.select(this),a=_.filter(e.data,function(e){return!!e}),r=t.bandStyle!==re.confidenceBandStyle.line?["0"]:[],i.selectAll(ne.UncertaintyArea.selector).data(r,function(e){return e}).join("path").attr("class",ne.UncertaintyArea.class).style("fill",t.color).style("fill-opacity",Y(e,t.transparency)).attr("d",E(a)),r=t.bandStyle!==re.confidenceBandStyle.fill?["0"]:[],i.selectAll(ne.UncertaintyLines.selector).data(r,function(e){return e}).join("g").attr("class",ne.UncertaintyLines.class).style("stroke",t.color).style("stroke-opacity",Y(e,t.transparency)).style("stroke-width",2).selectAll(ne.UncertaintyLine.selector).data(["upper","lower"],function(e){return e}).join("path").attr("class",ne.UncertaintyLine.class).attr("d",function(e){return("upper"===e?G:W)(a)}))}),F.selectAll(ne.UncertaintyBars.selector).data(_.filter(r,function(e){return e.uncertainty.bar.show}),function(e){return e.identity.getKey()}).join("g").attr("class",ne.UncertaintyBars.class).style("fill",function(e){return e.uncertainty.bar.color}).style("stroke",function(e){return e.uncertainty.bar.borderColor}).style("stroke-width",function(e){return e.uncertainty.bar.borderWidth}).order().each(function(e){var t;null==e||_.isEmpty(e.data)||(t=e.uncertainty.bar,e=_.filter(e.data,function(e){return!!e}),d3.select(this).selectAll(ne.UncertaintyBar.selector).data(e,function(e){return e.identity.getKey()}).join("path").attr("class",ne.UncertaintyBar.class).attr("transform",function(e){return"translate(".concat(L(e),", ").concat((e.isY2?f:S)(e.value),")")}).attr("d",function(e){return d3.symbol().type(re.UncertaintyHelper.errorBarSymbol(e,t,e.isY2?f:S)).size(10)()}))}),X=S.range()[1]>S.range()[0],I=F.selectAll(ne.UncertaintyMarkers.selector).data(_.filter(r,function(e){return e.uncertainty.markers.showMarker}),function(e){return e.identity.getKey()}).join("g").attr("class",ne.UncertaintyMarkers.class).style("stroke-opacity",0).style("stroke-width",2).order().selectAll(ne.UncertaintyMarker.selector).data(function(t){return _.map(["upper","lower"],function(e){return{seriesData:t,type:e}})}).join("path").attr("class",ne.UncertaintyMarker.class).style("stroke-width","inherit").attr("d",function(e){return("upper"===e.type&&!X||"lower"===e.type&&X?G:W)(e.seriesData.data)}),e.renderUncertaintyMarkers(I),g=[ne.UncertaintyAreas,ne.UncertaintyBars,ne.UncertaintyMarkers],(I=F.selectAll(_.map(g,function(e){return e.selector}).join(", ")).nodes()).sort(function(e,t){for(var i=0,a=0,r=g.length;a<r;a++)i=(i+=Number(d3.select(e).classed(g[a].class))*a)-Number(d3.select(t).classed(g[a].class))*a;return i}),d3.selectAll(I).order()):d.mainGraphicsContext.selectAll(ne.UncertaintySelector.selector).remove(),d.mainGraphicsContext.selectAll(s.lineClassAndSelector.selector).data(t.series,function(e){return e.identity.getKey()})),I=F.enter().append(ne.PathElementName).classed(s.lineClassAndSelector.class,!0).merge(F),I=(I.style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,D)}).style("stroke-width",function(e){return i.isHighContrast?re.CartesianHelper.defaultLineStrokeWidth:e.lineStyle.strokeWidth}).style("stroke-linejoin",function(e){return e.lineStyle.lineJoin}).style("stroke-dasharray",function(e){return re.LineStyle.getStrokeDashArrayFromLineStyle(e.lineStyle.style)}),I.interrupt(),P?I.transition().ease(d3.easeLinear).duration(P).attr("d",function(e){return(e.lineStyle.stepped?T:V)(e.data)}):I.attr("d",function(e){return(e.lineStyle.stepped?T:V)(e.data)}),I.order(),F.exit().remove(),d.mainGraphicsContext.selectAll(ne.MarkerLineClassSelector.selector).data(_.filter(t.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()})),F=I.enter().append(ne.PathElementName).classed(ne.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",re.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0).merge(I),e=(P?k=F.transition().ease(d3.easeLinear).duration(P).attr("d",function(e){return V(e.data)}).style("opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}).style("pointer-events","none"):F.attr("d",function(e){return V(e.data)}).style("opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}).style("pointer-events","none"),F.order(),e.renderMarkers(k||F),I.exit().remove(),d.mainGraphicsContext.selectAll(ne.InteractivityLineClassSelector.selector).data(_.filter(t.series,function(e){return ne.getLeftmostPathPointFromSeriesData(e)}),function(e){return e.identity.getKey()})),k=e.enter().append(ne.PathElementName).classed(ne.InteractivityLineClassSelector.class,!0).style("stroke-width",ne.InteractivityStrokeWidth).style("stroke-linejoin",re.strokeLineJoin.round).attr(re.SubSelectableObjectNameAttribute,"lines").attr(re.SubSelectableAltObjectNameAttribute,"markers").attr(re.SubSelectableTypeAttribute,3).classed(re.HtmlSubSelectableClass,!A||!n).merge(e),F=(k.attr("d",function(e){if(!x){var t=ne.getLeftmostPathPointFromSeriesData(e);if(t){var i=_.findIndex(e.data,function(e){return e&&e.categoryIndex===t.categoryIndex});if(0<i&&i<e.data.length)return i=e.data.slice(i),(e.lineStyle.stepped?T:V)(i)}}return(e.lineStyle.stepped?T:V)(e.data)}),e.exit().remove(),k.order(),k.each(function(){var a=this;re.HtmlSubSelectionHelper.setDataForElement(a,{getDisplayName:function(){var e=d3.select(a).datum();return o.host.getLocalizedString("MiniToolbar_Line",e.seriesName)},getRegionOutlines:function(){var e=d3.select(a).datum(),t=o.renderContext,i=o.viewModel;return ne.getMarkerOutlinesForSeries(e,i,t.mainGraphicsPositionOverlay)}})}),d.mainGraphicsContext.selectAll(ne.CategorySelector.selector).data(t.series,function(e){return e.identity.getKey()})),I=F.enter().append("g").classed(ne.CategorySelector.class,!0).merge(F),A=(F.exit().remove(),F.order(),I.selectAll(ne.CategoryValuePoint.selector).data(function(i){return i.data.filter(function(e,t){return ne.shouldDrawCircle(i,t)})},function(e){return e.key})),n=A.enter().append(ne.CircleElementName).classed(ne.CategoryValuePoint.class,!0).classed(re.HtmlSubSelectableClass,!0).attr(re.SubSelectableObjectNameAttribute,"lines").attr(re.SubSelectableAltObjectNameAttribute,"markers").attr(re.SubSelectableTypeAttribute,3).merge(A),e=(n.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return e.lineStyle.markerProperties.showMarker?0:re.ColumnUtil.getFillOpacity(e.selected,!1,D,!1)}),P?n.transition().duration(P).attrs({cx:function(e,t){return v(ne.getXValue(e,x))+b},cy:function(e,t){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.CircleRadiusExtra}):n.attrs({cx:function(e,t){return v(ne.getXValue(e,x))+b},cy:function(e,t){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.CircleRadiusExtra}),A.exit().remove(),n.each(function(){var i=d3.select(this.parentNode).datum();re.HtmlSubSelectionHelper.setDataForElement(this,{getDisplayName:function(){return o.host.getLocalizedString("MiniToolbar_Line",i.seriesName)},getRegionOutlines:function(){var e=o.renderContext,t=o.viewModel;return ne.getMarkerOutlinesForSeries(i,t,e.mainGraphicsPositionOverlay)}})}),I.selectAll(ne.CategoryPointSelector.selector).data(function(e){return ne.chartTypeSupportsExplicitDots(s.isComboChart)?_.filter(e.data,function(e){return e&&null!=e.pointColor}):[]},function(e){return e.key})),F=e.enter().append(ne.CircleElementName).classed(ne.CategoryPointSelector.class,!0).style("pointer-events","none").merge(e),A=(F.style("fill",function(e){return e.pointColor}),P?F.transition().duration(P).attrs({cx:function(e){return v(ne.getXValue(e,x))+b},cy:function(e,t){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.PointRadiusExtra}):F.attrs({cx:function(e){return v(ne.getXValue(e,x))+b},cy:function(e,t){return e.isY2?f(e.value):S(y?e.stackedValue:e.value)},r:t.lineStyle.strokeWidth/2+ne.PointRadiusExtra}),e.exit().remove(),F.order(),0<t.series.length&&(d.mainGraphicsContext.selectAll(ne.SelectedMarkerLineClassSelector.selector).data([0]).enter().append("g").attr("class",ne.SelectedMarkerLineClassSelector.class),(K=this.renderSelectedPointsGenerator(d.mainGraphicsContext,s))(D)),o.interactivityService&&(Z=this.updateFocusElement(d.mainGraphicsContext,w,s,o.host)),t.dataLabelsSettings),I=[],P=[],w=(A&&A.show&&(I=I.concat(this.createLabelDataPoints(s,i))),C&&C.show&&(e=C.seriesPosition===re.labelSeriesPosition.right?1:0,P=P.concat(this.createSeriesLabelDataPoints(s,i,e?m:0,e))),t.totalLabelsSettings);w&&w.show&&y&&(I=I.concat(this.createTotalLabelDataPoints(s,i)));_.map(_.filter(r,function(e){return e.uncertainty.labels.show}),function(e){return e.uncertainty.labels})&&(I=I.concat(this.createUncertaintyLabels(s,i,o.host)));var O,A={width:m,height:$,interactivityLines:k,dots:n,focusElement:Z,explicitDots:F,isComboChart:s.isComboChart,binnedLineSamplingApplied:t.binnedLineSamplingApplied,hasDynamicSeries:t.hasDynamicSeries},Q=(a.removeTooltips(A,B),s.tooltipsEnabled&&!o.formatMode&&a.applyTooltips(A,R,B),re.D3Helper.orderShapesByClass(d.mainGraphicsContext,ne.RenderOrderableElements),[]);if(o.interactivityService){for(var N=[],ee=0,te=s.allData.series;ee<te.length;ee++){var c=te[ee],ie=(Q.push(c),_.filter(c.data,function(e){return e}));N.push.apply(N,ie||[])}O=[],ne.hasAnomalies(t)&&(C=_.filter(t.anomalyDetections[0].anomalies,function(e){return e.isAnomaly}),O.push.apply(O,C||[]));var e=d.mainGraphicsSVG.selectAll(re.AnomalyDetectionCartesianRenderer.anomalyPointClassSelector.selector),ae={interactivityLines:k,root:d.mainGraphicsContext,focusMarker:Z,selectedMarkersCallback:K,dots:n,areas:p,tooltipOverlay:a.getTooltipOverlayElement(),showHoverline:a.usingHoverLine,getCategoryIndex:function(e,t,i){return i=i&&!a.usingHoverLine,R.getCategoryIndexFromSeriesAndPointX(e,t,i)},categoryIdentities:t.categoryIdentities,hitTester:new le({dataPoints:N,isComboChart:s.isComboChart,isScalar:x,hasCategories:0<t.categoryIdentities.length}),onSelecting:o.host.onSelecting,anomalies:e,anomalyNavigationHelper:o.anomalyNavigationHelper,areaTransparency:t.areaTransparency,onLineSubSelection:function(e,t,i,a,r){ne.onLineSubSelection(e,t,i,a,R,o.host,s,d.mainGraphicsSVG,r)},onDotSubSelection:function(e,t,i,a){ne.onDotSubSelection(e,t,i,o.host,a)},onAreaPointerMove:function(e){ne.onAreaPointerMove(e,d.mainGraphicsSVG,s)}}}return{dataPoints:N?__spreadArray(__spreadArray([],Q,!0),N,!0):void 0,behaviorOptions:ae,labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:I,labelDataPointSeriesGroups:P,animateLabels:!1,anomalies:O}}},ne.hasAnomalies=function(e){return _.some(e.anomalyDetections,function(e){return!_.isEmpty(e.anomaliesCategoryIndex)})},ne.isAnomaly=function(e){return e.isAnomaly},ne.getAreaGenerator=function(e,t,i){return d3.area().x(e).y0(t).y1(i).defined(function(e){return ne.isDataPointDefined(e)})},ne.getLineGenerator=function(e,t){return d3.line().x(e).y(t).defined(function(e){return ne.isDataPointDefined(e)})},ne.isDataPointDefined=function(e){return e&&null!==e.value},ne.renderSelectedPointsGenerator=function(s,n){var e=n.data,l=e.series,c=e.isScalar,u=se.hasFlag(n.lineType,16),d=n.horizontalOffset,h=n.xAxisProperties.scale,p=n.yAxisProperties.scale,g=n.y2AxisProperties&&n.y2AxisProperties.scale,y=s.selectAll(ne.SelectedMarkerLineClassSelector.selector);return function(i){var e=_.flatten(_.map(l,function(e){return _.filter(e.data,function(e){return e&&e.selected&&null!==e.value})})),t=y.selectAll(ne.PathElementName).data(e,function(e){return e.key}),a=_.map(e,function(e){return e.seriesIndex}),e=t.enter().append(ne.PathElementName).attr("pointer-events","none").merge(t),t=(e.attr("d",function(e){return e.lineStyle.markerProperties.showMarker?re.Markers.getPathWithRadius(e.lineStyle.markerProperties.shape,e.lineStyle.markerProperties.size*re.MarkerRenderer.sizeRatio):re.Markers.getPathWithRadius(re.markerShape.circle,e.lineStyle.strokeWidth/2+ne.TooltipCircleRadiusExtra)}).attr("transform",function(e){var t=h(ne.getXValue(e,c))+d,e=e.isY2?g(e.value):p(u?e.stackedValue:e.value);return"translate(".concat(t,",").concat(e,")")}).style("stroke-width",function(e){return re.Markers.getStrokeWidth(e.lineStyle.markerProperties.shape)}).style("stroke-opacity",1).style("stroke",function(e){return e.lineStyle.markerProperties.color}).style("fill",function(e){return e.lineStyle.markerProperties.color}),t.exit().remove(),s.selectAll(n.lineClassAndSelector.selector)),r=[];t.each(function(e,t){r[t]=e.selected,e.selected=-1<a.indexOf(e.lineIndex)}).style("stroke-opacity",function(e,t){return re.ColumnUtil.getFillOpacity(e.selected,!1,i,i&&!r[t])});function o(e,t){return re.ColumnUtil.getFillOpacity(e.selected||-1<a.indexOf(e.lineIndex),!1,i,i&&!r[e.lineIndex],null!=t?oe.convertTransparencyToOpacity(t):void 0)}s.selectAll(ne.MarkerLineClassSelector.selector).style("opacity",function(e){return re.ColumnUtil.getFillOpacity(!1,!1,i,!1)});t=s.select(ne.UncertaintySelector.selector);return t.selectAll(ne.UncertaintyAreas.selector).each(function(e){var t=e.uncertainty.band.transparency,i=d3.select(this);i.selectAll(ne.UncertaintyArea.selector).style("fill-opacity",o(e,t)),i.selectAll(ne.UncertaintyLines.selector).style("stroke-opacity",o(e,t))}),t.selectAll(ne.UncertaintyBars.selector).style("fill-opacity",function(e){return o(e)}).style("stroke-opacity",function(e){return o(e)}),t.selectAll(ne.UncertaintyMarker.selector).style("opacity",function(e){return o(e.seriesData)}),e}},ne.updateFocusElement=function(e,t,r,o){var i=r.xAxisProperties.scale,a=r.yAxisProperties.scale,s=r.y2AxisProperties&&r.y2AxisProperties.scale,n=r.data.isScalar,l=r.horizontalOffset,c=se.hasFlag(r.lineType,16),u=d.isInternetExplorerOrEdge(),e=e.selectAll(ne.FocusElementSelector.selector).data(t?[t]:[]),t=e.enter().append(ne.CircleElementName).attr("class",ne.FocusElementSelector.class).attr("tabindex",0).attr("focusable",!0).attr("role","option").classed(re.SetFocusRingClassName,!u).merge(e);return t.attr("aria-label",function(t){var e,i,a;return ne.isAnomaly(t)?o.getLocalizedString("Anomaly_ScreenReader_Hint"):(a=t,e=!1,ne.hasAnomalies(r.data)&&(i=r.data.anomalyDetections[0].anomaliesCategoryIndex,e=_.some(i,function(e){return e===t.categoryIndex})),i=re.tooltipUtils.formatTooltipInfo(a.tooltipInfo),(a=a.uncertainty)&&(a.upperTooltip&&(i+=" "+re.tooltipUtils.formatTooltipInfo([a.upperTooltip])),a.lowerTooltip)&&(i+=" "+re.tooltipUtils.formatTooltipInfo([a.lowerTooltip])),e&&(i+=" "+o.getLocalizedString("AnomalyPoint_ScreenReader_Hint")),i)}).attr("cx",function(e){return i(ne.getXValue(e,n))+l||0}).attr("cy",function(e){var t;return ne.isAnomaly(e)?(t=r.data.anomalyDetections[0].markerShapeSize,re.AnomalyDetectionCartesianRenderer.getAnomalyYPosition(e,a,t)):(t=e).isY2?s(t.value):a(c?t.stackedValue:t.value)}).attr("r",function(e){var t;return ne.isAnomaly(e)?(t=r.data.anomalyDetections[0].markerShapeSize,re.AnomalyDetectionCartesianRenderer.getAnomalySize(t)):(t=e.lineStyle.markerProperties).showMarker?t.size*re.MarkerRenderer.sizeRatio:e.lineStyle.strokeWidth/2+ne.TooltipCircleRadiusExtra}).style("fill","none"),e.exit().remove(),t},ne.getMarkerXPositionCalc=function(e,t,i,a){t=t(ne.getXValue(e,i.data.isScalar));return ne.convertSvgXToClientX(t,i.horizontalOffset,i.currentViewport.scale,a)},ne.getMarkerXPosition=function(e,t,i,a){var r=t.xAxisProperties.scale,i=i.node().getBoundingClientRect().left,e=_.find(e.data,function(e){return e&&e.categoryIndex===a});return Math.floor(ne.getMarkerXPositionCalc(e,r,t,i))},ne.getMarkerOutlinesForSeries=function(e,t,i){var a=e.data,i=i.node().getBoundingClientRect(),r=i.left,o=i.top,i=null==(i=_.first(e.data))?void 0:i.isY2,s=t.currentViewport,n=t.data,l=t.xAxisProperties,c=t.yAxisProperties,u=l.scale,d=(i?t.y2AxisProperties:c).scale,h=s.scale,l=n.lineStyle.markerProperties.size*h,p=Math.max(l+1.2*l,10)*h,g=(p%2==0&&++p,[]),y=1;a.length*p>s.width&&(i=re.DataLabelRenderer.getNumberOfLabelsToRender(s.width,50,4,p),y=Math.floor(a.length/i));for(var m=0;m<a.length;m+=y){var v=a[m];v&&g.push({x:Math.floor(ne.getMarkerXPositionCalc(v,u,t,r)-p/2),y:Math.floor(ne.convertSvgYToClientY(d(v.value),h,o)-p/2),width:p,height:p,type:1})}c={type:1,x:r,y:o,height:(t.currentViewport.height-t.margin.bottom-t.margin.top)*h,width:(t.currentViewport.width-t.margin.left-t.margin.right)*h};return[{id:e.key,outline:{type:0,outlines:g,clipPath:c}}]},ne.onLineSubSelection=function(e,t,i,a,r,o,s,n,l){var c,u=re.InteractivityUtils.getPositionOfLastInputEvent(),r=r.getCategoryIndexFromSeriesAndPointX(e,t,!0);try{c=ne.getMarkerXPosition(e,s,n,r)}catch(e){return}var d,s=null==(t=e.identity)?void 0:t.getSelectorsByColumn(),n=e.lineStyle.markerProperties.showMarker&&Math.abs(c-u.x)<=e.lineStyle.markerProperties.size/2?(d="markers",o.getLocalizedString("MiniToolbar_Markers",e.seriesName)):(d="lines",o.getLocalizedString("MiniToolbar_Line",e.seriesName)),r={x:a.clientX,y:a.clientY},t=i.createVisualSubSelectionForSingleObject({objectName:d,subSelectionType:3,displayName:n,showUI:l,selectorsByColumn:s,selectionOrigin:r});i.subSelect(t)},ne.onDotSubSelection=function(e,t,i,a,r){var o,s=null==(s=e.identity)?void 0:s.getSelectorsByColumn(),a=e.lineStyle.markerProperties.showMarker?(o="markers",a.getLocalizedString("MiniToolbar_Markers",e.seriesName)):(o="lines",a.getLocalizedString("MiniToolbar_Line",e.seriesName)),e={x:i.clientX,y:i.clientY},i=t.createVisualSubSelectionForSingleObject({objectName:o,subSelectionType:3,displayName:a,showUI:r,selectorsByColumn:s,selectionOrigin:e});t.subSelect(i)},ne.onAreaPointerMove=function(e,t,i){var a=new MouseEvent("pointerover",e),e=ne.findSubSelectedAreaElement({x:e.clientX,y:e.clientY},t,i);null!=e&&e.dispatchEvent(a)},ne.prototype.getFirstElement=function(t,e){var i,a;return void 0===e&&(e=!1),null!=t?((i=e?_.findLast:_.find)(this.data.series,function(e){return a=i(e.data,function(e){return e&&e.categoryIndex===t&&null!=e.value})}),a&&this.scrolledData&&-1===this.scrolledData.categories.indexOf(a.categoryValue)?{element:null,targetCategoryIndex:a.categoryIndex,targetSeriesIndex:a.seriesIndex}:a?(this.focusedDatum=a,{element:ne.updateFocusElement(this.mainGraphicsContext,a,this.buildViewModel(0),this.host).node(),targetCategoryIndex:t,targetSeriesIndex:a.seriesIndex}):(e=e?this.data.series.length-1:0,{element:null,targetCategoryIndex:t,targetSeriesIndex:e})):{element:this.mainGraphicsContext.select(ne.FocusElementSelector.selector).node()}},ne.prototype.getNextDataPoint=function(t,e,i){var a,r,o=this.focusedDatum;switch(i){case re.DataDirection.NextCategory:case re.DataDirection.PreviousCategory:var s,n=this.data.series[e];o=n?(n=n.data,s=_.findIndex(n,function(e){return e&&e.categoryIndex===t}),this.pickNextAvailableIndex(n,s,e,i)):void 0;break;case re.DataDirection.NextSeries:case re.DataDirection.PreviousSeries:n=_.map(this.data.series,function(e){return _.find(e.data,function(e){return e&&e.categoryIndex===t})});o=this.pickNextAvailableIndex(n,e,t,i)}return o?this.scrolledData&&-1===this.scrolledData.categories.indexOf(o.categoryValue)?{element:null,targetCategoryIndex:o.categoryIndex,targetSeriesIndex:o.seriesIndex}:(this.focusedDatum=o,{element:ne.updateFocusElement(this.mainGraphicsContext,o,this.buildViewModel(0),this.host).node(),targetCategoryIndex:o.categoryIndex,targetSeriesIndex:o.seriesIndex}):(a=i===re.DataDirection.NextSeries||i===re.DataDirection.NextCategory?1:-1,r=this.data.categories.length,t=this.incrementIndex(t,a,r),r=e,i!==re.DataDirection.NextSeries&&i!==re.DataDirection.PreviousSeries||(r=a<0?this.data.series.length-1:0),{element:null,targetCategoryIndex:t,targetSeriesIndex:r})},ne.prototype.pickNextAvailableIndex=function(e,t,i,a){var r=a===re.DataDirection.NextCategory||a===re.DataDirection.PreviousCategory?this.rollToNextSeries:this.rollToNextCategory,o=a===re.DataDirection.NextSeries||a===re.DataDirection.NextCategory?1:-1,s=t;do{if((s+=o)>=e.length||s<0)return r.call(this,i,a)}while(s!==t&&(!e[s]||null==e[s].value));if(null!=e[s].value)return e[s]},ne.prototype.rollToNextSeries=function(e,t){t!==re.DataDirection.PreviousCategory&&re.DataDirection.NextCategory;var i=t===re.DataDirection.PreviousCategory?-1:1,t=t===re.DataDirection.PreviousCategory?_.findLast:_.find,a=this.data.series.length;return e=this.incrementIndex(e,i,a),t(this.data.series[e].data,function(e){return e&&null!=e.value})},ne.prototype.rollToNextCategory=function(t,e){e!==re.DataDirection.PreviousSeries&&re.DataDirection.NextSeries;var i=e===re.DataDirection.PreviousSeries?-1:1,e=e===re.DataDirection.PreviousSeries?_.findLast:_.find,a=this.data.categories.length,i=(t=this.incrementIndex(t,i,a),_.map(this.data.series,function(e){return _.find(e.data,function(e){return e&&e.categoryIndex===t})}));return e(i,function(e){return e&&null!=e.value})||e(i,function(e){return!!e})},ne.prototype.incrementIndex=function(e,t,i){return i<=(e+=t)?e=0:e<0&&(e=i-1),e},ne.renderOld=function(e,t,i,a,r,o,s,n,l){var c=this,u=e.data;if(u){for(var d,h=e.margin,p=e.currentViewport,g=p.height-(h.top+h.bottom),y=e.xAxisProperties.scale,m=e.yAxisProperties.scale,v=e.y2AxisProperties&&e.y2AxisProperties.scale,S=u.isScalar,f=e.animationDuration,b=(n.shouldDisableAnimations()&&(f=0),p.width-(h.left+h.right)),p=p.height-(h.top+h.bottom),x=i&&i.hasSelection(),C=function(e){return(e.isY2?v:m)(e.value)},w=se.hasFlag(e.lineType,16)||se.hasFlag(e.lineType,2),h=w||u.lineStyle.shadeArea||_.some(u.series,function(e){return e.lineStyle.shadeArea}),D=(h&&(d=d3.area().x(function(e){return y(ne.getXValue(e,S))}).y0(g).y1(C).defined(function(e){return null!==e.value})),d3.line().x(function(e){return y(ne.getXValue(e,S))}).y(C).defined(function(e){return!!e&&null!==e.value})),i=(se.hasFlag(e.lineType,4)&&(D.curve(d3.curveBasis),d)&&d.curve(d3.curveBasis),e.horizontalOffset),b=(t.mainGraphicsContext.attr("transform",re.SVGUtil.translate(i,0)),t.mainGraphicsSVG.attr("height",p).attr("width",b),t.hoverLineContext.attr("transform",re.SVGUtil.translate(i,0)),(h?((g=t.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).data(_.filter(u.series,function(e){return w||e.lineStyle&&e.lineStyle.shadeArea}),function(e){return e.identity.getKey()})).enter().append("g").classed(ne.CategoryAreaSelector.class,!0).append(ne.PathElementName),t.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector).select(ne.PathElementName).transition().ease(d3.easeLinear).duration(f).attr("d",function(e){return d(e.data)}).style("fill",function(e){return e.areaColor}).style("fill-opacity",function(e){return x&&!e.selected?c.AreaTransparencyReductionFactor*(1-u.areaTransparency/100):1-u.areaTransparency/100}),g.exit()):t.mainGraphicsContext.selectAll(ne.CategoryAreaSelector.selector)).remove(),t.mainGraphicsContext.selectAll(ne.CategorySelector.selector).data(u.series,function(e){return e.identity.getKey()})),i=b.enter().append("g").classed(ne.CategorySelector.class,!0),h=(i.append(ne.PathElementName),i.selectAll(ne.CategoryValuePoint.selector).data(function(e){return e.data}).enter().append(ne.CircleElementName).classed(ne.CategoryValuePoint.class,!0),i.merge(b)),A=(b.exit().remove(),o&&!t.dragHandle&&(g=p,t.dragHandle=t.hoverLineContext.append("circle").attr("cx",0).attr("cy",g).attr("r","6px").classed("drag-handle",!0)),h.data().length);t.selectionCircles.length<A;){var P=t.hoverLineContext.append(ne.CircleElementName).classed(ne.CircleClassName,!0).attr("r",u.lineStyle.strokeWidth/2+ne.CircleRadiusExtra).style("opacity",0);t.selectionCircles.push(P)}for(;t.selectionCircles.length>A;)t.selectionCircles.pop().remove();var L,M,V,i=t.mainGraphicsContext.selectAll(ne.CategorySelector.selector),p=(i.select(ne.PathElementName).classed(e.lineClassAndSelector.class,!0).style("stroke",function(e){return e.color}).style("stroke-opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,x,x)}).style("stroke-width",u.lineStyle.strokeWidth).style("stroke-linejoin",u.lineStyle.lineJoin).transition().ease(d3.easeLinear).duration(f).attr("d",function(e){return D(e.data)}),n.ensureMarkers(t.svgDefs,_.map(e.data.series,function(e){return e.lineStyle.markerProperties})),t.mainGraphicsContext.selectAll(ne.MarkerLineClassSelector.selector).data(_.filter(u.series,function(e){return e.lineStyle.markerProperties.showMarker}),function(e){return e.identity.getKey()})),g=p.enter().append(ne.PathElementName).classed(ne.MarkerLineClassSelector.class,!0).style("stroke","#ffffff").style("stroke-width",re.CartesianHelper.defaultLineStrokeWidth).style("stroke-opacity",0).merge(p).transition().ease(d3.easeLinear).duration(f).attr("d",function(e){return D(e.data)}).style("opacity",function(e){return re.ColumnUtil.getFillOpacity(e.selected,!1,x,!1)}).style("pointer-events","none"),T=(n.renderMarkers(g),p.exit().remove(),this),h=i.selectAll(ne.CategoryValuePoint.selector),n=h.style("fill",function(){return d3.select(this.parentNode).datum().color}).style("fill-opacity",function(){var e=d3.select(this.parentNode).datum();return re.ColumnUtil.getFillOpacity(e.selected,!1,x,!1)}).transition().duration(f).attrs({cx:function(e,t){var i=d3.select(this.parentNode).datum();return T.shouldDrawCircle(i,t)?y(T.getXValue(e,S)):0},cy:function(e,t){var i=d3.select(this.parentNode).datum();return T.shouldDrawCircle(i,t)?C(e):0},r:function(e,t){var i=d3.select(this.parentNode).datum();return T.shouldDrawCircle(i,t)?u.lineStyle.strokeWidth/2+ne.CircleRadiusExtra:0}}),F=(o&&ne.hasDataPoint(u.series)&&(L=h.size(),M=0,n.on("end",function(){++M===L&&r.selectColumn(re.CartesianHelper.findMaxCategoryIndex(u.series),!0)})),null);if(u.dataLabelsSettings.show)for(var F=[],I=0,k=u.series.length;I<k;I++)Array.prototype.push.apply(F,u.series[I].data);return b.exit().remove(),u.dataLabelsSettings.show&&(V=ne.createLabelDataPoints(e,l)),null==F?null:{dataPoints:F,behaviorOptions:null,labelDataPoints:null,labelsAreNumeric:null,labelDataPointGroups:V,animateLabels:!s}}},ne.getLeftmostPathPointFromSeriesData=function(e,a){return(a?_.findLast:_.find)(e.data,function(e,t,i){i=a?i[t-1]:i[t+1];return null!=e&&null!=e.value&&null!=i&&null!=i.value})},ne.getSeriesTooltipInfo=function(e,t){var i;if(!e)return null;var a=e.dataPoints;if(_.isEmpty(a))return null;var r="#000000",o=!_.isEmpty(a)&&a[0].seriesDisplayName,s=[],n=[],l=0,c=e.legendMarkerRendering,u=c!==re.legendMarkerRendering.markerOnly&&c!==re.legendMarkerRendering.markerCircleDefault,d=a[0].additionalTooltipItems;if(a.every(function(e){return _.isEqual(e.additionalTooltipItems,d)})){for(var h in a){var p,g=a[h];if(10<=l)break;null!=g.value&&(p=g.measure,null!=(i=g.uncertaintyTooltipItems)&&i.rangeTooltip&&(p=g.uncertaintyTooltipItems.rangeTooltip.value),s.push({header:g.category,subheader:g.multiple,color:g.color,displayName:g.seriesName||g.measureDisplayName,value:p,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),n.push(+h),l++)}if(e.hasUncertainty&&(s=ne.augmentTooltipInfoWithUncertainty(s,a,n,t)),!_.isEmpty(d))for(var y=0,m=d;y<m.length;y++){var v=m[y];if(10<=l)break;s.push({color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:re.markerShape.none}),l++}}else for(var S=0,f=a;S<f.length;S++){g=f[S];if(10<=l)break;if(null!=g.value&&(o&&(s.push({header:g.category,subheader:g.multiple,displayName:g.seriesDisplayName,value:g.seriesName,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),l++),s.push({header:g.category,subheader:g.multiple,color:g.color,displayName:g.measureDisplayName,value:g.measure,markerShape:g.markerShape,lineStyle:u?g.lineStyle:void 0,lineColor:g.lineColor}),l++,!_.isEmpty(g.additionalTooltipItems)))for(var b=0,x=g.additionalTooltipItems;b<x.length;b++){v=x[b];if(10<=l)break;s.push({header:g.category,subheader:g.multiple,color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:re.markerShape.none}),l++}}if(!_.isEmpty(e.additionalTooltipItems))for(var C=0,w=e.additionalTooltipItems;C<w.length;C++){v=w[C];if(10<=l)break;s.push({header:a[0].category,subheader:a[0].multiple,color:r,displayName:v.displayName,value:v.value,opacity:"0",markerShape:re.markerShape.none}),l++}return 0===s.length?null:s},ne.augmentTooltipInfoWithUncertainty=function(e,t,i,a){e.length,i.length;for(var r,o=[],s=1/0,n=-1,l=0,c=i.length;l<c;l++)(h=t[i[l]]).uncertaintyTooltipItems&&(h.isY2?(r=Math.abs(h.value-a.y2.point))<a.y2.threshold?o.push(l):r<s&&(s=r,n=l):((r=Math.abs(h.value-a.y.point))<a.y.threshold&&o.push(l),r<s&&(s=r,n=l)));for(var u=[],l=0,c=i.length;l<c;l++){var d,h=t[i[l]],p=e[l];_.includes(o,l)||n===l?((d=h.uncertaintyTooltipItems).upperTooltip&&u.push(__assign({header:h.category,subheader:h.multiple},d.upperTooltip)),u.push(p),d.lowerTooltip&&u.push(d.lowerTooltip)):u.push(p)}return u},ne.prototype.getTooltipInfoForPoint=function(e,t){var i,a=e.data,r=this.getCategoryIndexFromSeriesAndPointX(a,t,!0,e.context);if(i=a&&a.data&&a.data.length?_.find(a.data,function(e){return e&&e.categoryIndex===r}):i)return i.tooltipInfo},ne.isDataPointData=function(e){return e&&null!=e.categoryIndex},ne.isForecastPoint=function(e){return e&&null!=e.points},ne.prototype.getCategoryIndexFromTooltipEvent=function(e,t){e=e.data;if(!ne.isForecastPoint(e))return ne.isDataPointData(e)?e.categoryIndex:this.getCategoryIndexFromSeriesAndPointX(e,t,!1)},ne.prototype.getCategoryIndexFromSeriesAndPointX=function(e,t,i,a){var r=0,o=this.data.categoryData,s=this.xAxisProperties.scale;return e&&!_.isEmpty(e.data)&&this.xAxisProperties&&(t=this.adjustPathXCoordinate(t,a),a=this.data.isScalar&&s.range()[1]<s.range()[0],(a=ne.getLeftmostPathPointFromSeriesData(e,a))&&(r=s(ne.getXValue(a,this.data.isScalar))+this.getXOfFirstCategory()),i)&&(o=_.map(e.data,function(e){return re.CartesianHelper.extractCategoryFromDataPoint(e)})),ne.findCategoryIndex({pointX:t,offsetX:r,categoryData:o,currentViewport:this.currentViewport,scale:s,categoryThickness:this.xAxisProperties.categoryThickness,isScalar:this.data.isScalar},this.featureSwitches)},ne.prototype.getYValueFromTooltipEvent=function(e,t){var i,a=null==(a=this.yAxisProperties)?void 0:a.scale,r=null==(r=this.y2AxisProperties)?void 0:r.scale,o=this.currentViewport.scale,o=(N.Double.equalWithPrecision(o,1,1e-5)||(e/=o),t.classList.contains(ne.TooltipOverlaySelector.class)||t.classList.contains(ne.lineChartSVGClassName)||(e+=t.getBBox().y),{});return a&&(i=a.domain(),o.y={point:a.invert(e),threshold:.1*(i[1]-i[0])}),r&&(i=r.domain(),o.y2={point:r.invert(e),threshold:.1*(i[1]-i[0])}),o},ne.prototype.getVisualCategoryAxisIsScalar=function(){return!!this.data&&this.data.isScalar},ne.prototype.getSupportedCategoryAxisType=function(){var t,e=!1,i=this.dataView&&this.dataView.categorical?this.dataView.categorical.categories:void 0;return(e=_.isEmpty(i)?e:i.some(function(e){if(e.source&&e.source.type)return t=e.source.type,e=re.ScalarUtils.getScalarKeys(e),!C.isOrdinal(t)||e&&!_.isEmpty(e.values)}))?re.axisType.both:re.axisType.categorical},ne.prototype.getPreferredPlotArea=function(e,t,i,a){return re.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,this.isScrollable,e,this.margin,a=void 0===a?0:a)},Object.defineProperty(ne.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),ne.sliceSeries=function(e,t,i){void 0===i&&(i=0);var a=[];if(e&&0<e.length)for(var r=0,o=e.length;r<o;r++){for(var s=e[r],n=(a[r]=N.Prototype.inherit(s),[]),l=i,c=i+t;l<c;l++)n.push(s.data[l]);a[r].data=n}return a},ne.prototype.getXOfFirstCategory=function(){if(!this.data.isScalar){var e=this.xAxisProperties.scale;if(re.D3Helper.isScaleBand(e))return e.bandwidth()/2}return 0},ne.hasDataPoint=function(e){if(0!==e.length)for(var t=0,i=e.length;t<i;t++)if(0<e[t].data.length)return!0;return!1},ne.getXValue=function(e,t){return t?e.categoryValue:e.categoryIndex},ne.shouldDrawCircle=function(e,t){var i=e.data[t];return null!=i&&null!==i.value&&(i=null==(i=e.data[t-1])||null===i.value,t=null==(e=e.data[t+1])||null===e.value,i)&&t},ne.prototype.getHoverLineDataForCategory=function(e){var t,i=this.getChartX(e)+this.getXOfFirstCategory(),e=this.createTooltipData(e);if(e)return t=e.dataPoints,0<e.dataPoints.length&&this.setHoverLineForTooltip(i),this.setDotsForTooltip(i,t,this.data.lineStyle.strokeWidth/2+ne.TooltipCircleRadiusExtra),e},ne.prototype.getHoverLineIdentities=function(t,e){var i,a=null==(a=null==(a=this.data)?void 0:a.categoryIdentities)?void 0:a[t],r=null==(r=null==(r=this.data)?void 0:r.multiplesCategoryIdentities)?void 0:r[t],o=[],e=_.find(null!=e?e:[],function(e){return(null==e?void 0:e.categoryIndex)===t}),e=null==e?void 0:e.identity;return e&&(r.exclude=((i={})[1]=!0,i),a.exclude=((i={})[1]=!0,i),e.exclude=((i={})[0]=!0,i),o.push(e)),(r||a)&&o.push(null!=r?r:a),o},ne.prototype.setHoverLineForTooltip=function(e){this.hoverLine.attr("x1",e=e||0).attr("x2",e).attr("y1",0).attr("y2",this.availableHeight).style("opacity",1)},ne.prototype.clearHoverLine=function(){this.hoverLine.style("opacity",re.SVGUtil.AlmostZero),this.hoverLineContext.selectAll(ne.HoverLineCircleDot.selector).remove()},ne.prototype.setDotsForTooltip=function(e,t,i){var a=this;void 0===i&&(i=3);var r=se.hasFlag(this.lineType,16)?function(e){return a.yAxisProperties.scale(e.stackedValue)}:function(e){return(e.isY2?a.y2AxisProperties:a.yAxisProperties).scale(e.value)},t=this.hoverLineContext.selectAll(ne.HoverLineCircleDot.selector).data(_.filter(t,function(e){return e.showDot}));t.enter().append(ne.CircleElementName).classed(ne.HoverLineCircleDot.class,!0).merge(t).filter(function(e){return null!=e.value}).attr("fill",function(e){return e.color}).attr("r",i).attr("cx",e).attr("cy",r),t.exit().remove()},ne.prototype.selectColumn=function(e,t){((t=void 0===t?!1:t)||this.lastInteractiveSelectedColumnIndex!==e)&&(this.lastInteractiveSelectedColumnIndex=e,t=this.getChartX(e),this.setHoverLine(t,e),t=this.createLegendDataPoints(e))&&this.cartesianHost.updateLegend(t)},ne.prototype.setHoverLine=function(r,o){this.hoverLine.attr("x1",r).attr("x2",r).attr("y1",0).attr("y2",this.availableHeight).style("opacity",1);var s=this;this.mainGraphicsContext.selectAll(ne.CategorySelector.selector).selectAll(ne.PathElementName).each(function(e){var t=this,i=e.color,a=s.selectionCircles[e.lineIndex];a&&a.attrs({cx:r,cy:function(){var e=d3.select(t).node();return ne.getPosition(r,e).y}}).styles({opacity:function(){return _.some(e.data,function(e){return!!e&&e.categoryIndex===o})?1:0},fill:i}),s.dragHandle&&s.dragHandle.attr("cx",r)})},ne.prototype.getChartX=function(e){var t=0,e=(this.data.isScalar?0<=e&&e<this.data.categoryData.length&&(t=Math.max(0,this.xAxisProperties.scale(this.data.categoryData[e].categoryValue))):t=Math.max(0,this.xAxisProperties.scale(e)),Math.max.apply(Math,N.visuals.AxisHelper.extent(this.xAxisProperties.scale))),t=Math.min(t,e);return isNaN(t)?0:t},ne.findCategoryIndex=function(e,t){var i=e.pointX,a=e.offsetX,r=e.categoryData,o=e.scale,s=e.currentViewport.scale,s=(N.Double.equalWithPrecision(s,1,1e-5)||(i/=s),a&&(i+=a),N.visuals.AxisHelper.invertScale(o,i,0,0,void 0).value);if(e.isScalar)return 0<=(a=C.findClosestXAxisIndex(s,r,o))?r[a].categoryIndex:-1;if(r[s]&&!r[s].hasData){for(var n=-1,l=s;0<l&&-1===n&&r[--l].hasData;)n=l;for(var c=-1,u=s,d=r.length-1;u<d&&-1===c&&r[++u].hasData;)c=u;var a=Math.abs(n-s),h=Math.abs(c-s);a<h?s=n:h<a?s=c:a===h&&(s=o(s)+e.categoryThickness/2<i?c:n)}return s},ne.getPosition=function(e,t,i,a){for(var r,o,s=0,n=t.getTotalLength();r=t.getPointAtLength(o=s+n>>1),re.SVGUtil.ensureValidSVGPoint(r),i&&(r.x=i(r.x)),a&&(r.y=a(r.y)),o!==n&&o!==s||r.x===e;)if(r.x>e)n=o;else{if(!(r.x<e))break;s=o}return r},ne.getDefinedDataArray=function(e){for(var t=e.length,i=[],a=[],r=0;r<t;r++){var o=e[r];ne.isDataPointDefined(o)?(a.push(o),r===t-1&&i.push(a)):0<a.length&&(i.push(a),a=[])}return i},ne.findSubSelectedAreaIndex=function(e,t,i,a){for(var r,o=Number.MAX_VALUE,i=i.node().getBoundingClientRect(),s=i.left,n=i.top,l=0;l<t.length;l++){var c=t[l],c=ne.getPosition(e.x,c,function(e){return ne.convertSvgXToClientX(e,0,a.currentViewport.scale,s)},function(e){return ne.convertSvgYToClientY(e,a.currentViewport.scale,n)}).y,c=e.y-c;-4<=c&&(c=Math.abs(c))<o&&(o=c,r=l)}return r},ne.findSubSelectedAreaElement=function(e,t,i){var a=t.selectAll(ne.LineClassSelector.selector).filter(function(e){return e.data.some(function(e){return ne.isDataPointDefined(e)})}).nodes(),r=ne.findSubSelectedAreaIndex(e,a,t,i);if(null!=r)return t.selectAll(ne.CategoryAreaSelector.selector).filter(function(e){return e.lineIndex===r}).node()},ne.convertSvgXToClientX=function(e,t,i,a){return(e+t)*i+a},ne.convertSvgYToClientY=function(e,t,i){return e*t+i},ne.prototype.createTooltipData=function(e){var t=this.data;if(t&&0!==t.series.length&&t.categories&&t.categoryData){for(var i,a=[],r=(t.categoryData.length,t.categories.length,t.categoryData[e]),o=!1,s=t.multipleDisplayName,n=re.lineChartProps.general.formatString,l=0,c=t.series;l<c.length;l++){var u,d,h=(g=c[l]).data,p=void 0;this.data.isScalar?r&&(p=h.filter(function(e){return e.categoryValue===r.categoryValue})[0]):p=h[e],null!=(v=p&&p.value)&&(h=re.CategoryLevelUtils.concatenateCategoryLevels(r.hierarchyCategoryLevels),u=g.lineStyle.markerProperties,d=this.getDefaultMarkerShape(t.defaultToCircle),S={color:re.Markers.resolveMarkerColor(u,g.color,t.legendMarkerRendering,t.matchLineColor),category:h.value,multiple:s,measureDisplayName:g.seriesName,measure:re.valueFormatter.format(v,p.labelFormatString||re.valueFormatter.getFormatString(g.yCol,n)),value:v,stackedValue:p.stackedValue,uncertaintyTooltipItems:p.uncertainty,showDot:!u.showMarker,markerShape:re.Markers.resolveMarkerShape(u,t.legendMarkerRendering,d),lineStyle:g.lineStyle.style,lineColor:g.color,isY2:p.isY2},o=o||!!p.uncertainty,t.hasDynamicSeries?(S.seriesDisplayName=t.seriesDisplayName,S.seriesName=g.seriesName,S.additionalTooltipItems=p.additionalTooltipItems):i=i||p.additionalTooltipItems,a.push(S))}if(!_.isEmpty(t.forecastLines)&&r)for(var g=_.head(t.series),y=0,m=t.forecastLines;y<m.length;y++){var v,S,f=m[y],b=_(f.points).filter(function(e){return e.point.x===r.categoryValue}).first();null!=(v=b&&b.point.y)&&(S={color:f.lineColor.solid.color,category:re.CategoryLevelUtils.concatenateCategoryLevels(r.hierarchyCategoryLevels).value,multiple:s,measureDisplayName:f.displayName,measure:re.valueFormatter.format(v,re.valueFormatter.getFormatString(g.yCol,n)),value:v,stackedValue:void 0,additionalTooltipItems:[{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Upper"),value:re.valueFormatter.format(b.upperBound.y,re.valueFormatter.getFormatString(g.yCol,n))},{displayName:this.host.getLocalizedString("Visual_Confidence_Band_Lower"),value:re.valueFormatter.format(b.lowerBound.y,re.valueFormatter.getFormatString(g.yCol,n))}],showDot:!0,markerShape:re.markerShape.circle,lineStyle:void 0,lineColor:void 0},a.push(S))}return{dataPoints:a,additionalTooltipItems:i,legendMarkerRendering:t.legendMarkerRendering,hasUncertainty:o}}},ne.prototype.createLegendDataPoints=function(e){var t=this.data;if(t&&t.series&&!(t.series.length<1)){for(var i,a=[],r=t.categoryData[e],o=(this.isInteractiveChart&&r&&(this.data.isScalar?(i=r.categoryValue,C.isDateTime(this.xAxisProperties.axisType)&&(i=N.FeatureSwitchedDate.fromTimeValue(this.featureSwitches.utcDates,i))):i=re.CartesianHelper.lookupXValue(this.data,e,this.xAxisProperties.axisType,this.data.isScalar,this.featureSwitches)),re.lineChartProps.general.formatString),s=0,n=t.series.length;s<n;s++){var l=t.series[s],c=l.data,u=void 0;if(this.isInteractiveChart){var d=void 0;if(this.data.isScalar){if(r)for(var h=r.categoryValue,p=0,g=c;p<g.length;p++){var y=g[p];if(y.categoryValue===h){d=y;break}}}else d=c[e];u=d&&d.value}c=re.converterHelper.getFormattedLegendLabel(l.yCol,this.dataView.categorical.values,o);a.push({color:l.color,icon:re.LegendIcon.Line,label:c,category:re.valueFormatter.format(i,re.valueFormatter.getFormatString(l.xCol,o)),measure:re.valueFormatter.format(u,re.valueFormatter.getFormatString(l.yCol,o)),identity:l.identity,selected:l.selected,index:s})}var m=this.dataView&&this.dataView.categorical?this.dataView.categorical.values:null,m=m&&m.source?m.source.displayName:"",v=re.Legend.getDefaultLegendData(this.style);return v.title=m,v.dataPoints=a,v.grouped=t.hasDynamicSeries,v}},ne.createLabelDataPoints=function(m,v){for(var S,f,b=m.xAxisProperties.scale,x=m.yAxisProperties.scale,C=m.y2AxisProperties&&m.y2AxisProperties.scale,e=m.data,c=e.series,u=e.dataLabelsSettings,w=re.DataLabelViewModel.createColumnFormatterCacheManager(),D=se.hasFlag(m.lineType,16),d=[],A=e.isScalar,t=function(e,t){f=c[e];var g=100===(S=f.labelSettings||u).labelDensity,i=re.DataLabelRenderer.getNumberOfLabelsToRender(m.currentViewport.width,S.labelDensity,h.MinimumLabelsToRender,re.MinMaxLabelDataPointSorter.estimatedLabelWidth),i=!g&&A?i:f.data.length;if(!S.show)return d[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";var a=f.isY2?m.y2AxisProperties:m.yAxisProperties,y=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(a,S),r=f.data,o=[];if(!_.isEmpty(r))for(var s=0,n=r.length;s<n;s++){var l=r[s];null!=l&&null!=l.value&&(l=function(e,t,i){var a,r=t.labelFormatString,o=S.fontProperties,s=!1,n=m.horizontalOffset,l=e.isY2?C:x,c=null!=(c=t.labelFill)?c:o.color,u=t.dynamicLabelValue,r=(a=null!=u&&u.enabled&&null!=u&&u.value?(a=null==(a=t.dynamicLabelValue)?void 0:a.value,null!=(null==u?void 0:u.formatString)&&(u=w.getOrCreate(null==u?void 0:u.formatString,S,y.units,y.getPrecision(!(null==u||!u.formatString),f.type)),a=re.DataLabelRenderer.getLabelFormattedText(u.format(a))),jsCommon.StringExtensions.encodeHtml(a)):(u=w.getOrCreate(r,S,y.units,y.getPrecision(!!r,e.type)),re.DataLabelRenderer.getLabelFormattedText(u.format(t.value))),re.FontProperties.toTextProperties(o,a)),u=N.TextMeasurementService.measureSvgTextWidth(r)+re.DataLabelViewModel.LabelDensityPadding,r=N.TextMeasurementService.estimateSvgTextHeight(r,!0);if(D){var d=Math.max(t.stackedValue-t.value,l.domain()[0]),h=m.currentViewport.width,p=void 0;switch(S&&S.position){case re.labelPosition.insideCenter:p=[1];break;case re.labelPosition.insideEnd:p=[4];break;default:re.labelPosition.auto;p=ne.validStackedLabelPositions}h={rect:{left:b(ne.getXValue(t,A))+n-h/2,top:l(Math.max(t.stackedValue,t.stackedValue-t.value)),width:h,height:Math.abs(l(t.stackedValue)-l(d))},orientation:0<=t.value?1:2,validPositions:p},s=!0}else{d=e.lineStyle.markerProperties,p=void 0;switch(S&&S.position){case re.labelPosition.above:p=[1];break;case re.labelPosition.under:p=[2];break;default:re.labelPosition.auto;p=g?[1]:ne.getValidLabelPositions(f,i)}h={point:{x:b(ne.getXValue(t,A))+n,y:l(t.value)},radius:d.showMarker?d.size:0,validPositions:p}}return{isPreferred:!1,text:a,textSize:{width:u,height:r},outsideFill:null!=c?c:re.ColorHelper.getThemeColor(v,re.DataLabelViewModel.DefaultLabelColorName),insideFill:c&&D?c:re.ColorHelper.getThemeColor(v,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:s?1:0,parentShape:h,fontProperties:o,identity:t.identity,key:t.key,hasBackground:S.enableBackground,backgroundColor:S.backgroundColor,backgroundTransparency:S.backgroundTransparency}}(f,l,s),o.push(l))}d[e]={labelDataPoints:o,maxNumberOfLabels:i}},h=this,i=0,a=c.length;i<a;i++)t(i);return new re.MinMaxLabelDataPointSorter({unsortedLabelDataPointGroups:d,series:c,viewport:m.currentViewport,yScale:x,y2Scale:C}).getSortedDataLabels()},ne.createSeriesLabelDataPoints=function(e,S,f,b){for(var x,C,t=e.xAxisProperties.scale,w=e.yAxisProperties.scale,D=e.y2AxisProperties&&e.y2AxisProperties.scale,i=e.data,A=i.series,P=i.seriesLabelSetings,a=e.margin,L=e.currentViewport,M=se.hasFlag(e.lineType,16),V=[],T=i.isScalar,F=N.TextMeasurementService.estimateSvgTextHeight(re.DataLabelRenderer.LabelTextProperties),I=L.width-(a.left+a.right),k=t.domain()[0],O=t.domain()[1],r=function(e,t){var l=(C=A[e]).isY2?D:w,i=l.domain()[0],a=l.domain()[1];if(!(x=C.seriesSettings||P)||!x.show)return V[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";function r(e,t){var i=e.seriesName,a=x.fontProperties,r=re.FontProperties.toTextProperties(a,i),o=N.TextMeasurementService.measureSvgTextWidth(r),s=N.TextMeasurementService.estimateSvgTextHeight(r,!0),e=e.lineStyle.markerProperties,n=[512],e=(t.value,{point:{x:f,y:l(M?t.stackedValue:t.value)},radius:e.showMarker?e.size:0,validPositions:n}),n=!1;return d&&(n=1<re.DataLabelRenderer.checkWordBreak(i,r,u,L.height-(c+F+h),void 0,!0,!0).length),{isPreferred:!1,text:i,textSize:{width:o,height:s},outsideFill:x.seriesColor||re.ColorHelper.getThemeColor(S,re.DataLabelViewModel.DefaultLabelColorName),insideFill:x.seriesColor&&M?x.seriesColor:re.ColorHelper.getThemeColor(S,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:e,fontProperties:a,identity:t.identity,key:t.key,wordBreak:n,hasBackground:x.enableBackground,backgroundColor:x.backgroundColor,backgroundTransparency:x.backgroundTransparency}}var c=x?x.fontProperties.size.px:0,u=x?x.seriesMaximumWidth/100*I:0,d=!!x&&!!x.seriesWordWrap,h=(L.height-F-c)/2,o=C.data,s=[],n=0,p=o.length;if(!_.isEmpty(o)&&C.seriesName){var g=b?_.last(_.compact(o)):_.first(_.compact(o));if(T){for(n=0;n<p;n++){var y=o[n];if(null!=y&&null!=y.value&&y){y=ne.getXValue(y,T);if(b?O<y:k<y){var m,v,y=-1;b&&0<=n-1?y=n-1:b||(y=n),0<=y&&null!=(y=o[y])&&(i<=(m=M?y.stackedValue:y.value)&&m<=a)&&(v=r(C,y),s.push(v));break}}}g&&n===o.length&&null!=(m=M?g.stackedValue:g.value)&&(i<=m&&m<=a)&&(v=r(C,g),s.push(v))}else g&&null!=(m=M?g.stackedValue:g.value)&&(i<=m&&m<=a)&&(v=r(C,g),s.push(v))}V[e]={labelDataPoints:s,maxNumberOfLabels:1}},o=0,s=A.length;o<s;o++)r(o);return V},ne.createTotalLabelDataPoints=function(e,t){for(var i,a,r,o,s,n,l,c=re.CartesianHelper.getFirstMetadataColumn(e.data.valuesMetadata),u=re.valueFormatter.getFormatString(c,re.columnChartProps.general.formatString),d=e.xAxisProperties.scale,h=e.yAxisProperties.scale,p=e.data,g=re.DataLabelViewModel.createColumnFormatterCacheManager(),c=[],y=p.totalLabelsSettings,m=p.isScalar,v=e.horizontalOffset,S=e.yAxisProperties,f=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(S,y),b=[],x=0;x<p.totals.length;x++){var C,w=p.totals[x];w&&0!==(w=w.net)&&(w=w,i=x,l=C=n=o=s=o=r=a=void 0,i=p.totals[i],a=g.getOrCreate(i.dynamicFormatString||u,y,f.units,y.precision),a=re.DataLabelRenderer.getLabelFormattedText(a.format(w)),r=y.fontProperties,o=re.FontProperties.toTextProperties(r,a),s=N.TextMeasurementService.measureSvgTextWidth(o),o=N.TextMeasurementService.estimateSvgTextHeight(o,!0),n=null!=(n=i.labelFill)?n:r.color,C=0<w?i.positive:i.negative,i={value:C,stackedValue:C,categoryIndex:i.categoryIndex,categoryValue:i.categoryValue,labelSettings:void 0,key:void 0,identity:void 0,lineStyle:void 0,seriesIndex:void 0,selected:!1},l=e.currentViewport.width,C={isPreferred:!(i={left:d(ne.getXValue(i,m))+v-l/2,top:h(C),width:l,height:0}),text:a,textSize:{width:s,height:o},outsideFill:null!=n?n:re.ColorHelper.getThemeColor(t,re.DataLabelViewModel.DefaultLabelColorName),insideFill:null!=n?n:re.ColorHelper.getThemeColor(t,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:i,orientation:0<=w?1:2,validPositions:[16]},identity:void 0,fontProperties:r,hasBackground:y.enableBackground,backgroundColor:y.backgroundColor,backgroundTransparency:y.backgroundTransparency},b.push(C))}return c.push({labelDataPoints:b,maxNumberOfLabels:2*p.totals.length}),c},ne.createUncertaintyLabels=function(n,p,g){for(var y,m,e=n.data,l=e.series,v=re.DataLabelViewModel.createColumnFormatterCacheManager(),S=n.xAxisProperties.scale,f=e.isScalar,b=n.horizontalOffset,c=[],t=function(e,t){var i=(y=l[e]).uncertainty;if(!i||!i.renderUncertainty||!i.labels.show)return c[e]={labelDataPoints:[],maxNumberOfLabels:0},"continue";m=i.labels;for(var i=y.isY2?n.y2AxisProperties:n.yAxisProperties,u=re.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(i,m),d=i.scale,h=m.fontProperties,a=[],r=0,o=y.data;r<o.length;r++){var s=o[r];null==s||null==s.value||null==s.uncertainty||(s=function(e){for(var t=[],i=re.UncertaintyHelper.formatUncertaintyByErrorFormat(e.value,e.uncertainty,m.errorFormat),a=[i.lower,i.upper],r=0;r<2;r++){var o,s,n=a[r],l=1===r,c=l?e.uncertainty.upper:e.uncertainty.lower;null!=c&&(o=void 0,o=m.errorFormat===re.errorFormat.relativePercentage?re.UncertaintyHelper.formatUncertaintyRelativePercentage(n,g):(s=e.labelFormatString,s=v.getOrCreate(s,m,u.units,u.getPrecision(!!s,y.type)),re.DataLabelRenderer.getLabelFormattedText(s.format(n))),s=re.FontProperties.toTextProperties(h,o),n={isPreferred:!1,text:o,textSize:{width:N.TextMeasurementService.measureSvgTextWidth(s)+re.DataLabelViewModel.LabelDensityPadding,height:N.TextMeasurementService.estimateSvgTextHeight(s,!0)},outsideFill:h.color||re.ColorHelper.getThemeColor(p,re.DataLabelViewModel.DefaultLabelColorName),insideFill:h.color||re.ColorHelper.getThemeColor(p,re.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:S(ne.getXValue(e,f))+b,y:d(c)},radius:0,validPositions:[l?1:2]},identity:void 0,fontProperties:h,hasBackground:m.enableBackground,backgroundColor:m.backgroundColor,backgroundTransparency:m.backgroundTransparency},t.push(n))}return t}(s),_.isEmpty(s))||a.push.apply(a,s)}c[e]={labelDataPoints:a,maxNumberOfLabels:100}},i=0,a=l.length;i<a;i++)t(i);return c},ne.prototype.axisShouldIncludeZero=function(){var e;return null!=(null==(e=null==(e=null==(e=null==(e=this.dataView)?void 0:e.metadata)?void 0:e.objects)?void 0:e.categoryAxis)?void 0:e.reverseStackOrder)&&this.isStacked()},ne.prototype.adjustPathXCoordinate=function(e,t){jsCommon.BrowserUtils.isFirefox()&&null!=t&&(this.pathXAdjustment=this.getPathXAdjustmentForFirefox(t)),jsCommon.BrowserUtils.isInternetExplorerOrEdge()&&(this.pathXAdjustment=ne.InteractivityStrokeWidth/2);t=this.currentViewport.scale;return N.Double.equalWithPrecision(t,1,1e-5)?e-=this.pathXAdjustment:e-=this.pathXAdjustment*t,e},ne.prototype.getPathXAdjustmentForFirefox=function(e){var t,i=e.getBoundingClientRect(),e=re.SVGUtil.tryGetBBox(e);if(0<e.height&&0<e.width)return t=this.currentViewport.scale,(i.width/t-e.width)/2},ne.getValidLabelPositions=function(e,t){var e=e.data,i=e.length,a=e[t].value,r=e[t-1]&&e[t-1].value,e=e[t+1]&&e[t+1].value,o=1,s=1;if(null==r?o=0:a<r?o=3:r<a&&(o=2),null===e?s=0:a<e?s=3:e<a&&(s=2),0===t)return 3!==s?[1,2]:[2,1];if(t===i-1)return 3!==o?[1,2]:[2,1];switch(o){case 0:switch(s){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:return[2,1,4,8];case 2:return[1,2,4,8]}case 1:switch(s){case 0:case 1:return[1,2,8,4];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 3:switch(s){case 0:return[2,1,8,4];case 1:return[2,1,4,8];case 3:return[2,1,8,4];case 2:return[1,2,8,4]}case 2:switch(s){case 0:return[1,2,8,4];case 1:return[1,2,4,8];case 3:case 2:return[1,2,8,4]}}},ne.prototype.getCartesianVisualCapabilities=function(){var e=this.data,t=e&&!e.hasDynamicSeries&&this.hasSingleSeriesPerValueAxis(e),t=!se.hasFlag(this.lineType,16)||t;return{supportsHierarchicalCategoryAxis:!0,axesCapabilities:{categoryAxis:{domainAggregateRole:re.LineChartRoles.Category,supportedDomainAggregates:e&&e.isScalar?e.scalarKeyCount?1:3:0},valueAxis:{domainAggregateRole:re.LineChartRoles.Y,supportedDomainAggregates:t?3:1},secondaryValueAxis:this.haveY2Data()||this.isComboChart?{domainAggregateRole:re.LineChartRoles.Y2,supportedDomainAggregates:t?3:1}:void 0}}},ne.prototype.hasSingleSeriesPerValueAxis=function(e){if(!e||_.isEmpty(e.valuesMetadata))return!1;for(var t=!1,i=!1,a=0,r=e.valuesMetadata;a<r.length;a++){var o,s=r[a].roles;for(o in s)if(s[o]){if(o===re.LineChartRoles.Y){if(t)return!1;t=!0}if(o===re.LineChartRoles.Y2){if(i)return!1;i=!0}}}return!0},ne.prototype.getStaticSeriesRole=function(){return this.isComboChart?re.LineChartRoles.Y2:re.LineChartRoles.Y},ne.prototype.haveY2Data=function(){return this.data&&this.data.series&&_.some(this.data.series,function(e){return e&&e.isY2})},ne.prototype.calculateCustomLegend=function(){var e,t;return this.dataView?(e=this.data,t=this.getDefaultMarkerShape(e.defaultToCircle),re.Legend.buildSeriesLegendData({dataView:this.dataView,allowLegendWithNoSeries:this.isComboChart,showByDefault:!0,staticSeriesRoleNames:this.isComboChart?["Y2"]:["Y","Y2"],style:this.style,ignoreDefaultColor:this.isComboChart,ignoreDefaultCategoryColor:!0,lineAndMarkerOptions:{renderLineStyle:!0,legendMarkerRendering:e.legendMarkerRendering,matchSeriesColor:e.matchLineColor,defaultMarkerShape:t},featureSwitches:this.featureSwitches})):re.Legend.getDefaultLegendData(this.style)},ne.prototype.enumerateCustomLegend=function(e){e=__assign(__assign({},this.customizeLegendFormattingModelOptions(e)),{enumeration:e.enumeration});re.Legend.enumerate(e,this.featureSwitches)},ne.prototype.customizeLegendFormattingModelOptions=function(e){var t=this.originalData,i=t.legendMarkerRendering,a=this.featureSwitches.removeDefaultToCircleToggle&&i===re.legendMarkerRendering.markerCircleDefault;return __assign(__assign({},e),{legendMarkerRendering:i,matchLineColor:i===re.legendMarkerRendering.markerOnly||a?t.matchLineColor:void 0,defaultToCircle:i===re.legendMarkerRendering.markerOnly?t.defaultToCircle:void 0})},ne.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},ne.chartTypeSupportsExplicitDots=function(e){return!e},ne.prototype.getTelemetryInformation=function(){var e,t={};if(_.isEmpty(null==(e=this.data)?void 0:e.anomalyDetections)||(t.AnomalyDetections=!0),!_.isEmpty(t))return t},ne.prototype.getDefaultMarkerShape=function(e){return!this.featureSwitches.removeDefaultToCircleToggle&&e?re.markerShape.circle:re.markerShape.longDash},ne.prototype.getValidDataPointIndices=function(a){for(var r=[],e=0,t=a.categoryData;e<t.length;e++)!function(t){if(t&&a.categoryIdentities[t.categoryIndex])for(var e=0;e<a.series.length;e++){var i=_.findIndex(a.series[e].data,function(e){return e.categoryIndex===t.categoryIndex});if(0<=i){r.push({categoryIndex:t.categoryIndex,seriesIndex:e,dataPointIndex:i});break}}}(t[e]);return r},ne.prototype.getCategoryColorsOptions=function(i,e,t,a){var r=e.map(function(e){return re.CategoryLevelUtils.concatenateCategoryLevels(i.categoryData[e.categoryIndex].hierarchyCategoryLevels).value});return{colorProps:{showAllDataPoints:re.lineChartObjectProps.dataPoint.showAllDataPoints,fill:re.lineChartObjectProps.dataPoint.fill},featureSwitches:this.featureSwitches,groupBuilder:t,hostService:this.host,options:{dataView:this.dataView,style:this.style,categories:_.map(e,function(e,t){return{color:i.series[e.seriesIndex].data[e.dataPointIndex].pointColor,displayName:r[t],identity:i.categoryIdentities[e.categoryIndex]}}),fillInstanceKind:i.hasDynamicSeries?1:3,noDefaultFillColor:a,multipleRole:i.multipleIdentity?re.LineChartRoles.Rows:void 0}}},ne.prototype.getDataViewObjectLayerChanges=function(e){var t,i,a,r,o,s,n,l;return this.featureSwitches.onObject?(t={type:0,required:!0,visualChangeObject:__assign({objectName:"lineStyles"},a={propertyName:"revertToDefault",propertyValue:void 0,propertyType:{bool:!0}})},i={type:0,required:!0,visualChangeObject:__assign({objectName:"seriesLabels"},a)},a={type:0,visualChangeObject:__assign({objectName:"labels"},a)},r=this.isComboChart?re.comboChartObjectProps:re.lineChartObjectProps,n=(o=1===this.data.series.length)?c.createToggleTurnOnAction:c.createSeriesLevelToggleTurnOnAction,o=o?void 0:e[0].selector,s=n(re.lineChartObjectProps.seriesLabels.backgroundColor,this.data.seriesLabelSetings.enableBackground,[{type:0,visualChangeObject:__assign(__assign({objectName:"seriesLabels"},l={propertyName:"enableBackground",propertyValue:!0,propertyType:{bool:!0}}),o?{selector:o}:{})}]),n=n(r.labels.backgroundColor,this.data.dataLabelsSettings.enableBackground,[{type:0,visualChangeObject:__assign(__assign({objectName:"labels"},l),o?{selector:o}:{})}]),l=[c.createSeriesLevelToggleTurnOnAction(r.lineStyles.showMarker,this.data.lineStyle.markerProperties.showMarker,[{type:0,required:!0,visualChangeObject:__assign(__assign({},r.lineStyles.showMarkerByDefault),{propertyValue:!1,propertyType:{bool:!0}})},{type:0,required:!0,visualChangeObject:__assign(__assign({},r.lineStyles.showMarker),{propertyValue:!0,propertyType:{bool:!0}})}]),c.createTopLevelToggleTurnOffAction(r.lineStyles.showMarker,[t]),c.createAllSeriesTogglesTurnOffAction(r.lineStyles.showMarker,this.data.lineStyle.markerProperties.showMarker,this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:e.lineStyle.markerProperties.showMarker}}),[t]),s,c.createSeriesLevelToggleTurnOnAction(re.lineChartObjectProps.seriesLabels.show,this.data.seriesLabelSetings.show,[{type:0,required:!0,visualChangeObject:__assign(__assign({},re.lineChartObjectProps.seriesLabels.showByDefault),{propertyValue:!1,propertyType:{bool:!0}})},{type:0,required:!0,visualChangeObject:__assign(__assign({},re.lineChartObjectProps.seriesLabels.show),{propertyValue:!0,propertyType:{bool:!0}})}]),c.createTopLevelToggleTurnOffAction(re.lineChartObjectProps.seriesLabels.show,[i]),c.createAllSeriesTogglesTurnOffAction(re.lineChartObjectProps.seriesLabels.show,this.data.seriesLabelSetings.show,this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:e.seriesSettings.show}}),[i]),n,c.createSeriesLevelToggleTurnOnAction(r.labels.showSeries,this.data.dataLabelsSettings.show,[{type:0,visualChangeObject:__assign(__assign({},r.labels.showByDefault),{propertyValue:!1,propertyType:{bool:!0}})},{type:0,visualChangeObject:__assign(__assign({},r.labels.show),{propertyValue:!0,propertyType:{bool:!0}})}]),c.createTopLevelToggleTurnOffAction(r.labels.show,[a]),c.createAllSeriesTogglesTurnOffAction(r.labels.showSeries,this.data.dataLabelsSettings.show,this.data.series.map(function(e){return{selector:e.identity.getSelector(),value:null==(e=e.labelSettings)?void 0:e.show}}),[a])],c.getDataViewObjectsBehaviorChanges(e,l)):[]},ne.ClassName="lineChart",ne.MainGraphicsContextClassName="mainGraphicsContext",ne.lineChartSVGClassName="lineChartSVG",ne.CategorySelector=e("cat"),ne.CategoryValuePoint=e("dot"),ne.CategoryPointSelector=e("point"),ne.CategoryAreaSelector=e("catArea"),ne.HoverLineCircleDot=e("circle-item"),ne.UncertaintySelector=e("uncertainty"),ne.UncertaintyAreas=e("uncertainty-areas"),ne.UncertaintyArea=e("uncertainty-area"),ne.UncertaintyLines=e("uncertainty-lines"),ne.UncertaintyLine=e("uncertainty-line"),ne.UncertaintyBars=e("uncertainty-bars"),ne.UncertaintyBar=e("uncertainty-bar"),ne.UncertaintyMarkers=e("uncertainty-markers"),ne.UncertaintyMarker=e("uncertainty-marker"),ne.LineClassSelector=e("line"),ne.MarkerLineClassSelector=e("marker-line"),ne.InteractivityLineClassSelector=e("interactivity-line"),ne.TooltipOverlaySelector=e("tooltip-overlay"),ne.SelectedMarkerLineClassSelector=e("selected-markers"),ne.FocusElementSelector=e("focus-element"),ne.PositionRectSelector=e("position-rect"),ne.RenderOrderableElements=[ne.CategoryAreaSelector,ne.UncertaintySelector,ne.LineClassSelector,ne.MarkerLineClassSelector,ne.InteractivityLineClassSelector,ne.CategorySelector,ne.SelectedMarkerLineClassSelector,ne.FocusElementSelector],ne.PointRadiusExtra=4,ne.CircleRadiusExtra=3,ne.TooltipCircleRadiusExtra=2,ne.PathElementName="path",ne.CircleElementName="circle",ne.CircleClassName="selection-circle",ne.LineElementName="line",ne.ScalarOuterPadding=10,ne.InteractivityStrokeWidth=10,ne.MinimumLabelsToRender=4,ne.DefaultZeroScalarDomain=[-1,1],ne.DefaultAreaTransparency=60,ne.AreaTransparencyReductionFactor=.4,ne.validStackedLabelPositions=[1,4],ne);function ne(e){var t,i=this;this.pathXAdjustment=0,this.deferDragMoveOperation=jsCommon.DeferUtility.deferUntilNextFrame(function(){var e;i.lastDragMoveXPosition&&i.data&&i.margin&&(e=ne.findCategoryIndex({pointX:i.lastDragMoveXPosition-i.margin.left,offsetX:0,categoryData:i.data.categoryData,currentViewport:i.currentViewport,scale:i.xAxisProperties.scale,categoryThickness:i.xAxisProperties.categoryThickness,isScalar:i.data.isScalar},i.featureSwitches),i.selectColumn(e),i.lastDragMoveXPosition=void 0)}),this.isScrollable=null!=(t=e.isScrollable)&&t,this.tooltipsEnabledOnHost=e.tooltipsEnabled,this.lineType=null!=(t=e.chartType)?t:1,this.interactivityService=e.interactivityService,this.featureSwitches=e.featureSwitches,this.viewModelAdapterFactory=e.viewModelAdapterFactory}re.LineChart=n,Object.defineProperty(m.prototype,"usingHoverLine",{get:function(){return this.showHoverLine},enumerable:!1,configurable:!0}),m.prototype.getTooltipOverlayElement=function(){return this.tooltipOverlay},m.prototype.applyTooltips=function(e,t,i){!this.tooltipOverlay||e.binnedLineSamplingApplied&&e.hasDynamicSeries?this.applyPointTooltip(e,t,i):(e.isComboChart,this.applyHoverLineTooltip(e,t,i))},m.prototype.removeTooltips=function(e,t){this.removePointTooltip(e),this.removeHoverLineTooltip(t)},m.prototype.applyHoverLineTooltip=function(e,a,r){this.tooltipOverlay,this.tooltipOverlay&&(this.showHoverLine||this.removePointTooltip(e),this.tooltipOverlay.attrs({x:0,width:e.width,height:e.height}),this.tooltipService.addTooltip(this.mainGraphicsSVG,function(e){var t,i=e.elementCoordinates[0],i=a.getCategoryIndexFromTooltipEvent(e,i),i=r.getHoverLineDataForCategory(i);return i&&i.hasUncertainty&&(t=e.elementCoordinates[1],t=a.getYValueFromTooltipEvent(t,e.context)),n.getSeriesTooltipInfo(i,t)},function(e){return m.getCategoryIdentityForHoverLineTooltipEvent(a,r,e)},!0),this.mainGraphicsSVG.on("mouseout.hoverline",function(){return r.clearHoverLine()}),this.mainGraphicsSVG.on("touchmove.hoverline",function(){return r.clearHoverLine()}),this.showHoverLine=!0)},m.prototype.removeHoverLineTooltip=function(e){e.clearHoverLine(),this.tooltipService.removeTooltips(this.mainGraphicsSVG),this.mainGraphicsSVG.on(".hoverline",null),this.showHoverLine=!1},m.prototype.applyPointTooltip=function(e,i,t){this.showHoverLine&&this.removeHoverLineTooltip(t);var a=e.isComboChart?function(e){return m.getCategoryIdentityForHoverLineTooltipEvent(i,t,e)}:function(e){return e.data&&[e.data.identity]};e.interactivityLines,this.tooltipService.addTooltip(e.interactivityLines,function(e){var t=e.elementCoordinates[0];return i.getTooltipInfoForPoint(e,t)},a,!0),e.dots,this.tooltipService.addTooltip(e.dots,function(e){return e.data&&e.data.tooltipInfo},a,!0),e.explicitDots&&this.tooltipService.addTooltip(e.explicitDots,function(e){return e.data&&e.data.tooltipInfo},function(e){return e.data&&[e.data.identity]},!0),e.focusElement&&this.tooltipService.addTooltip(e.focusElement,function(e){return e.data&&e.data.tooltipInfo},a,!0),this.showHoverLine=!1},m.prototype.removePointTooltip=function(e){e.interactivityLines&&this.tooltipService.removeTooltips(e.interactivityLines),e.dots&&this.tooltipService.removeTooltips(e.dots),e.explicitDots&&this.tooltipService.removeTooltips(e.explicitDots)},m.getCategoryIdentityForHoverLineTooltipEvent=function(e,t,i){var a;if(i)return i.data&&n.isForecastPoint(i.data)?null:(a=i.elementCoordinates[0],e=e.getCategoryIndexFromTooltipEvent(i,a),t.getHoverLineIdentities(e,null==(a=i.data)?void 0:a.data))};var l=m;function m(e,t,i){this.tooltipService=e,this.mainGraphicsSVG=t,i&&(this.tooltipOverlay=t.append("rect").classed(n.TooltipOverlaySelector.class,!0)),this.showHoverLine=!1}t.prototype.queryRegion=function(e){var t=this,i=[],a=e.dataSpace;return i=this.isScalar||this.hasCategories&&void 0!==a.left&&void 0!==a.right?_.filter(this.dataPoints,function(e){return N.Double.lessOrEqualWithPrecision(a.left.value,t.isScalar?e.categoryValue:e.categoryIndex)&&N.Double.lessOrEqualWithPrecision(t.isScalar?e.categoryValue:e.categoryIndex,a.right.value)&&N.Double.lessOrEqualWithPrecision(t.getBottom(a,e),e.value)&&N.Double.lessOrEqualWithPrecision(e.value,t.getTop(a,e))}):i},t.prototype.getBottom=function(e,t){return(t.isY2||this.isComboChart&&e.bottom2?e.bottom2:e.bottom).value},t.prototype.getTop=function(e,t){return(t.isY2||this.isComboChart&&e.top2?e.top2:e.top).value};var le=t;function t(e){this.dataPoints=e.dataPoints,this.isComboChart=e.isComboChart,this.isScalar=e.isScalar,this.hasCategories=e.hasCategories}re.LineChartHitTester=le}(powerbi=powerbi||{}),function(e){var g=e.visuals||(e.visuals={}),y=jsCommon.BrowserUtils,n=jsCommon.DOMConstants.KeyDictionary,m=jsCommon.DOMConstants.mouseClickEventName;function t(){}t.prototype.create=function(){return new i},g.LineChartWebBehaviorFactory=t,v.prototype.bindEvents=function(n,l,e,t){function c(e){return a.getPointX(e)}var a=this,i=n.areas,r=n.focusMarker,o=n.interactivityLines,s=n.root,u=n.showHoverline,d=n.tooltipOverlay,h=this.dots=n.dots,p=(this.areas=i,n.onSelecting);this.anomalies=n.anomalies,this.areaTransparency=n.areaTransparency,this.anomalyNavigationHelper=n.anomalyNavigationHelper,this.selectedMarkersCallback=n.selectedMarkersCallback,this.hitTester=n.hitTester;t?(this.unbindEventsFormatMode(n),o.on(m,function(e){S(n,c(this),e,l.getSubSelectionHelper(),!1)}),o.on("contextmenu",function(e){S(n,c(this),e,l.getSubSelectionHelper(),!0)}),h.on(m,function(){var e=d3.select(this.parentNode).datum();f(n,e,l.getSubSelectionHelper(),!1)}),h.on("contextmenu",function(){var e=d3.select(this.parentNode).datum();f(n,e,l.getSubSelectionHelper(),!0)}),i.on("pointermove",function(){var e;e=d3.event,n.onAreaPointerMove(e),g.EventBubblingUtil.markAsHandled(e)})):(o.on(m,function(e,t){var i,a,r,o;i=n,a=l,r=c(this),e=e,o=i.getCategoryIndex(e,r,!0),(r=_.find(e.data,function(e){return e&&e.categoryIndex===o}))?g.InteractivityUtils.handleSelection(r,a):(r={selected:e.selected,identity:e.identity,specificIdentity:i.categoryIdentities[o]},g.InteractivityUtils.handleSelection(r,a))}),o.on("contextmenu",function(e,t){var i,a,r,o,s;i=n,a=l,r=c(this),e=e,s=d3.event,y.isCtrlOrMeta(s)||(s.preventDefault(),g.EventBubblingUtil.markAsHandled(s),s=g.InteractivityUtils.getPositionOfLastInputEvent(),o=i.getCategoryIndex(e,r,!0),(r=_.find(e.data,function(e){return e&&e.categoryIndex===o}))?a.handleContextMenu(r,s):a.handleContextMenu({selected:e.selected,identity:e.identity,specificIdentity:i.categoryIdentities[o]},s))}),g.InteractivityUtils.registerStandardInteractivityHandlers(h,l),g.InteractivityUtils.registerClearCatcherShortcut(s,l),r&&(r.on(m,function(e){e=g.InteractivityUtils.isSelectableDataPointContainer(e)?e.data:e;g.InteractivityUtils.handleSelection(e,l)}),r.on("keydown.select",function(t){var e=d3.event,i=e.keyCode;32!==i&&13!==i||(v.isAnomaly(t)?(i=a.anomalies.filter(function(e){return e.isAnomaly&&e===t}),g.AnomalyDetectionCartesianRenderer.handleSelectedAnomaly(i.node(),t,p)):(i=g.InteractivityUtils.isSelectableDataPointContainer(t)?t.data:t,g.InteractivityUtils.handleSelection(i,l)),e.preventDefault(),e.stopPropagation())},!0),g.InteractivityUtils.registerStandardContextMenuHandler(r,l)),d&&u&&(d.style("pointer-events","all"),_.isEmpty(n.categoryIdentities)?d.on(m,function(){y.isCtrlOrMeta(d3.event)||l.handleClearSelection()}):(d.on(m,function(){var e=n.getCategoryIndex(void 0,c(this),!1),e={selected:!1,identity:void 0,specificIdentity:n.categoryIdentities[e]};g.InteractivityUtils.handleSelection(e,l)}),d.on("contextmenu",function(){var e,t=d3.event;y.isCtrlOrMeta(t)||(t.preventDefault(),g.EventBubblingUtil.markAsHandled(t),t=g.InteractivityUtils.getPositionOfLastInputEvent(),e=n.getCategoryIndex(void 0,c(this),!1),l.handleContextMenu({selected:!1,identity:void 0,specificIdentity:n.categoryIdentities[e]},t))})))),e&&(t=e.dataPointNavigationManager,i=e.pointSourceKey,t.isEmpty(i)||("0"!==s.attr("tabindex")&&!s.classed(g.managedTabIndexElement.class)||this.registerEnterPlotAreaHandler(s,t,i),r&&this.registerDataPointNavigationHandler(r,t,i)))},v.prototype.unbindEventsFormatMode=function(e){var t=e.dots,i=e.focusMarker,e=e.tooltipOverlay;i&&(i.on(m,null),i.on("keydown.select",null),g.InteractivityUtils.removeStandardContextMenuHandler(i)),e&&(e.style("pointer-events","none"),g.InteractivityUtils.removeStandardSelectionHandler(e)),g.InteractivityUtils.removeStandardInteractivityHandlers(t)},v.prototype.registerEnterPlotAreaHandler=function(a,r,o){var s=this;a.on("keydown.enterPlotArea",function(){var e,t=d3.event,i=t.keyCode;i===n.F1&&t.ctrlKey?(t.preventDefault(),t.stopPropagation(),(e=s.anomalyNavigationHelper.getFirstElement(0))&&s.renderFocus(e.element)):13===i?(t.preventDefault(),t.stopPropagation(),r.goToFirstElement(o)):27===i&&t.target!==a.node()&&(t.preventDefault(),t.stopPropagation(),e=a.node(),s.renderFocus(e))})},v.prototype.registerDataPointNavigationHandler=function(e,r,o){var s=this;e.on("keydown.dataPoint",function(e){var i=d3.event,a=i.keyCode;(9===a||37===a||39===a||38===a||40===a||a===n.F1&&y.isCtrlOrMeta(i))&&g.InteractivityUtils.tryToSelectD3Target(function(e){i.preventDefault(),i.stopPropagation();var t,e=g.InteractivityUtils.isNavigableDataPointContainer(e)?e.data:e;v.isAnomaly(e)?s.handleAnomalyKeyDownEvent(e.categoryIndex,e.seriesIndex,a,y.isCtrlOrMeta(i),r,o):a===n.F1&&y.isCtrlOrMeta(i)?(t=s.anomalyNavigationHelper.getFirstElement(e.categoryIndex))&&s.renderFocus(t.element):r.handleKeyDownEvent(o,e.categoryIndex,e.seriesIndex,a,i.shiftKey)},void 0)},!0)},v.isAnomaly=function(e){return e.isAnomaly},v.prototype.handleAnomalyKeyDownEvent=function(e,t,i,a,r,o){var s;switch(i){case 37:return s=this.anomalyNavigationHelper.getNextDataPoint(e,t,g.DataDirection.PreviousCategory),void this.renderFocus(s.element);case 39:return s=this.anomalyNavigationHelper.getNextDataPoint(e,t,g.DataDirection.NextCategory),void this.renderFocus(s.element);case n.F1:return void(a&&(0<e?r.handleKeyDownEvent(o,e-1,t,39,!1):r.goToFirstElement(o)));default:return}},v.prototype.renderSelection=function(t){var i=this;this.dots.style("fill-opacity",function(e){return e.lineStyle.markerProperties.showMarker?0:g.ColumnUtil.getFillOpacity(e.selected,!1,t,!1)}),this.areas&&this.areas.style("fill-opacity",function(e){return t&&!e.selected?g.LineChart.AreaTransparencyReductionFactor*(1-i.areaTransparency/100):1-i.areaTransparency/100}),this.selectedMarkersCallback&&this.selectedMarkersCallback(t)},v.prototype.renderFocus=function(e){e&&y.focus(e)},v.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},v.prototype.getLassoSelectDirectionMode=function(){return 1},v.prototype.getPointX=function(e){for(var t,i=d3.event;t=i.sourceEvent;)i=t;var a=e.getBoundingClientRect();return i.clientX-a.left-e.clientLeft};var i=v;function v(){}function S(e,t,i,a,r){var o=d3.event;e.onLineSubSelection(i,t,a,o,r),g.EventBubblingUtil.markAsHandled(o)}function f(e,t,i,a){var r=d3.event;e.onDotSubSelection(t,i,r,a),g.EventBubblingUtil.markAsHandled(r)}g.LineChartWebBehavior=i}(powerbi=powerbi||{}),function(S){var f=S.visuals||(S.visuals={}),e=jsCommon.CssConstants.createClassAndSelector,n=S.data.createDataViewScopeIdentity,i=S.data.DataViewConcatenateCategoricalColumns,l=S.data.ScopeIdentityExtractor;function c(e){e&&(this.interactivityService=e.interactivityService)}c.prototype.initData=function(e){this.style=e.style,this.element=e.element,this.host=e.host,this.featureSwitches=e.featureSwitches,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend},c.prototype.initRenderer=function(e){var t=this;this.rendererInitialized,this.svg=e.svg,this.interactivityService&&(this.playControl=new a(this.element,function(e){return t.moveToFrameAndRender(e)},this.isMobileChart),this.playControl.onPlay(function(){return t.play()})),this.rendererInitialized=!0},c.prototype.isRendererInitialized=function(){return this.rendererInitialized},c.prototype.setData=function(e,t){if(e){if(this.ridiculousFlagForPersistProperties&&e.metadata)return this.ridiculousFlagForPersistProperties=!1,this.playData;e.matrix||e.categorical?this.playData=u.converter(e,t,this.style):this.playData=u.getDefaultPlayData()}else this.playData=u.getDefaultPlayData();return this.lastViewport=void 0,this.playData},c.prototype.render=function(e,t,i,a){var r,o=this.playData,s=!this.lastViewport||this.lastViewport.height!==i.height||this.lastViewport.width!==i.width;if(this.lastViewport=i,s&&this.stop(),o)return t={data:this.playData,viewModel:t,viewport:i},this.interactivityService&&(r=o.currentViewModel,this.interactivityService.applySelectionStateToData(r.dataPoints)),this.updateCallout(i,a),this.playControl&&s&&this.playControl.rebuild(o,i,this.playControlWidth),r=o.allViewModels.map(function(e){return e.dataPoints}),{allDataPoints:_.flatten(r),viewModel:t}},c.prototype.updateCallout=function(e,t){var i=this.playData,a=i.frameData,i=i.currentFrameIndex,r=e.height,o=r-t.top-t.bottom,e=e.width,t=e-t.left-t.right,s=0,r=Math.min(r,1.3*e),e=Math.max(12,Math.round(r/7)),e=Math.min(e,70),r=[],o=(i<a.length&&0<=i&&(a={fontSize:jsCommon.PixelConverter.toString(e),text:a[i].text||"",fontFamily:f.Font.Family.regular.css},(s=S.TextMeasurementService.estimateSvgTextHeight(a)-S.TextMeasurementService.estimateSvgTextBaselineDelta(a))<o)&&(i=t-2*c.calloutOffsetMultiplier*s,r=[S.TextMeasurementService.getTailoredTextOrDefault(a,i)]),this.svg.selectAll(c.PlayCallout.selector).data(r));o.enter().append("text").classed(c.PlayCallout.class,!0).merge(o).text(function(e){return e}).attrs({x:t-c.calloutOffsetMultiplier*s,y:function(){return s}}).styles({"font-size":e+"px","text-anchor":"end"}),o.exit().remove()},c.prototype.play=function(){var e,t=this.playData;this.isPlaying?this.stop():this.playControl&&(this.isPlaying=!0,this.playControl.play(),null!=(e=this.playControl.getCurrentIndex()))&&((e=Math.round(e))>=t.allViewModels.length-1?t.currentFrameIndex=-1:t.currentFrameIndex=e-1,this.playNextFrame(t))},c.prototype.playNextFrame=function(e,t,i){var a,r,o=this;this.isPlaying&&(a=e.currentFrameIndex+1,null!=t&&null!=i&&(a=Math.abs(i-t+1),t=a),a<e.allViewModels.length)&&-1<a?((r=this.host.tooltips())&&r.hide({immediately:!0,isTouchEvent:!1}),e.currentFrameIndex=a,e.currentViewModel=e.allViewModels[a],this.renderDelegate(e.currentViewModel),this.playControl.setFrame(a),a<e.allViewModels.length&&window.setTimeout(function(){o.playNextFrame(e,t,i)},u.FrameStepDuration)):this.stop()},c.prototype.stop=function(){this.playControl&&this.playControl.pause(),this.isPlaying=!1},c.prototype.remove=function(){this.playControl&&this.playControl.remove(),d3.selectAll(c.PlayCallout.selector).remove()},c.prototype.setRenderFunction=function(e){this.renderDelegate=e},c.prototype.getCartesianExtents=function(e,t){return this.playData&&!_.isEmpty(this.playData.allViewModels)&&!_.isEmpty(this.playData.frameData)&&u.getMinMaxForAllFrames(this.playData,t)||e},c.prototype.setPlayControlPosition=function(e){var t;this.playControl&&((t=this.playControl.getContainer()).css("left",e.left?e.left+"px":""),t.css("top",e.top?e.top+"px":""),t.css("width",e.width?e.width+"px":""),this.playControlWidth=e.width)},c.prototype.moveToFrameAndRender=function(e){var t=this.playData;this.isPlaying=!0,t&&0<=e&&e<t.allViewModels.length&&e!==t.currentFrameIndex&&(t.currentFrameIndex=e,e=t.allViewModels[e],t.currentViewModel=e,this.renderDelegate(e)),this.isPlaying=!1},c.prototype.isCurrentlyPlaying=function(){return this.isPlaying},c.prototype.enumerateDataPoints=function(e,t,i,a){var r=_.filter(i.metadata.columns,function(e){return e.roles[f.scatterRoleNames.category]}),o=0<r.length&&r[r.length-1].queryName,r=_.filter(i.metadata.columns,function(e){return e.roles[f.scatterRoleNames.series]}),s=0<r.length&&r[0].queryName;t.hasDynamicSeries?S.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:_.map(t.dataPoints,function(e){return{color:e.fill,displayName:t.dataPointSeries[e.seriesIndex].name,identity:new f.SelectionId({data:__spreadArray([],e.identity.getSelectorsByColumn().dataMap[s]||[],!0)},!1)}})},this.featureSwitches):S.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:i,style:a,categories:_.map(t.dataPoints,function(e){var t=e.identity.getSelectorsByColumn().dataMap[o],t=l.getKeyValuePairs(t[0].expr);return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:new f.SelectionId({data:__spreadArray([S.data.DataViewRoleWildcard.fromRoles([f.scatterRoleNames.play])],_.map(t,function(e){return n(e)}),!0)},!1)}}),fillInstanceKind:3},this.featureSwitches)},c.PlayCallout=e("play-callout"),c.calloutOffsetMultiplier=.3,f.PlayAxis=c,d.prototype.getContainer=function(){return this.playAxisContainer},d.prototype.remove=function(){this.playAxisContainer&&this.playAxisContainer.remove()},d.prototype.pause=function(){this.playButton.removeClass("pause").addClass("play")},d.prototype.play=function(){this.playButton.removeClass("play").addClass("pause")},d.prototype.getCurrentIndex=function(){if(this.noUiSlider)return Number(this.noUiSlider.get())},d.prototype.onPlay=function(e){this.playButtonCircle.off("click"),this.playButtonCircle.on("click",e)},d.prototype.setFrame=function(e){this.noUiSlider.set([e])},d.prototype.rebuild=function(e,t,i){var a=this,r=(this.noUiSlider&&this.noUiSlider.destroy(),e.labelData),i=d.calucalateSliderSize(r,i),o=this.getContainer(),o=(i.marginLeft>d.SliderMarginLeft&&(o.css("padding-left",i.marginLeft-d.SliderMarginLeft+"px"),o.css("box-sizing","border-box")),this.updateSliderControl(e,i.width)),e=d.adjustWidthRegardingLastItem(r,o,i.width);this.slider.css("width",e+"px"),this.noUiSlider.on("slide",function(){var e=a.getCurrentIndex();a.renderDelegate(e)}),this.noUiSlider.on("update",function(){return $(".noUi-target").removeClass("noUi-state-tap")})},d.prototype.updateSliderControl=function(i,e){var t=i.labelData,a=this.slider.get(0),r=i.frameData.length,o={start:r<=1?1:i.currentFrameIndex,step:1,range:{min:0,max:r<=1?1:r-1},animationDuration:u.FrameStepDuration},s=null,n=0;return 1<r&&(n=(e=d.createPipsFilterFn(i,e,t)).skipStep,s={mode:"steps",density:Math.ceil(100/r),format:{to:function(e){return i.frameData[e].escapedText},from:function(t){return _.findIndex(i.frameData,function(e){return e.escapedText===t})}},filter:e.filter}),o.pips=s,noUiSlider.create(a,o),this.noUiSlider=a.noUiSlider,n},d.createPipsFilterFn=function(e,t,i){var a=_.max(_.map(i.labelInfo,function(e){return e.labelWidth})),r=1,o=1,a=a/(1<e.frameData.length?t/(e.frameData.length-1):t);1.25<a?(o=Math.ceil(a),r=2):(1<a||i.anyWordBreaks)&&(r=2);return{filter:function(e,t){return e%o==0?r:0},skipStep:o}},d.adjustWidthRegardingLastItem=function(e,t,i){var a;return!(_.isEmpty(e.labelInfo)||e.labelInfo.length<=1)&&(a=e.labelInfo.length,t=Math.floor((a-1)/t)*t,0<(e=e.labelInfo[t].labelWidth/2-(i+d.SliderMarginRight-i/a*(1+t))))?i-(e=(a=d.SliderMaxMargin-d.SliderMarginRight)<e?a:e):i},d.prototype.createSliderDOM=function(e){this.playAxisContainer=$('<div class="play-axis-container"></div>').appendTo(e).css("height",d.PlayControlHeight+"px"),this.playButtonCircle=$('<div class="button-container"></div>').appendTo(this.playAxisContainer),this.isMobileChart&&this.playButtonCircle.addClass("mobile-button-container"),this.playButton=$('<div class="play"></div>').appendTo(this.playButtonCircle),this.slider=$('<div class="sliders"></div>').attr("drag-resize-disabled","true").attr("rtl",("rtl"===document.dir).toString()).appendTo(this.playAxisContainer)},d.calucalateSliderSize=function(e,t){var i=0,e=(!_.isEmpty(e.labelInfo)&&1<e.labelInfo.length&&(i=_.head(e.labelInfo).labelWidth/2),Math.max(i,d.SliderMarginLeft)),e=Math.min(d.SliderMaxMargin,e);return{width:Math.max(t-e-d.SliderMarginRight,1),marginLeft:e}},d.SliderMarginLeft=44,d.SliderMarginRight=20,d.SliderMaxMargin=100,d.PlayControlHeight=80;var u,t,a=d;function d(e,t,i){this.isMobileChart=i,this.createSliderDOM(e),this.renderDelegate=t}function b(e,t){t=t.convertFrame(e);return i.concatenateCategoryColumnsForVisual(t.metadata,f.StandardObjectPropertyIdentifiers.formatString,f.cartesianRoleNames.category,t.categorical)}(e=u=f.PlayChart||(f.PlayChart={})).FrameStepDuration=800,t=750,e.AnimationEase="linear",e.ClassName="playChart",e.getFrameAnimationDuration=function(){return t},e.setFrameAnimationDuration=function(e){t=e},e.convertFrame=b,e.converter=function(e,t,i){var a=e.metadata,a=(f.DataLabelViewModel.getDefaultPointLabelSettings(i,"smallLightLabel"),i={},(a=a)&&a.objects&&(a=a.objects,i.currentFrameIndex=S.DataViewObjects.getValue(a,f.scatterChartProps.currentFrameIndex.index,null)),i),r=[],o=[],s=f.DataViewMultipleReader.create(e,f.StandardObjectPropertyIdentifiers.formatString),i=s.getFrameCount(),n=s.getSubtotals();if(s.hasFrames()){var l,c,e=s.getFrameSourceColumns(),u=e&&e[0],e=f.valueFormatter.getFormatString(u,f.scatterChartProps.general.formatString),d=void 0;d=u.type.numeric?(c=null==(c=s.getFrameNode(i-1))?void 0:c.value,l=null==(l=s.getFrameNode(0))?void 0:l.value,c=Math.abs(c-l),f.valueFormatter.create({format:e,value:c,value2:0,columnType:u.type})):f.valueFormatter.createDefaultFormatter(e,!0);for(var h=0,p=i;h<p;h++){var g,y,m,v=s.getFrameNode(h);v.isSubtotal||(g=d.format(v.value),y=$("<div></div>").text(g).html(),o.push({escapedText:y,text:g}),m=t(b(h,s),{label:y,column:u,identity:v.identity,value:v.value,formattedValue:g},n),r.push(m))}}else m=t(b(0,s),void 0,n),r.push(m);return a.currentFrameIndex=o.length-1,{allViewModels:r,currentViewModel:m,frameData:o,currentFrameIndex:a.currentFrameIndex,labelData:function(e,t){for(var i={fontFamily:f.Font.Family.regular.css,fontSize:jsCommon.PixelConverter.toString(14)},a=[],r=!1,o=0,s=e;o<s.length;o++){var n=s[o],l=jsCommon.WordBreaker.getMaxWordWidth(n.escapedText,S.TextMeasurementService.measureSvgTextWidth,i);r=r||jsCommon.WordBreaker.hasBreakers(n.escapedText)||-1<n.escapedText.indexOf("-"),a.push({label:n.escapedText,labelWidth:l})}return{labelInfo:a,anyWordBreaks:r,labelFieldName:t&&t.displayName}}(o,u)}},e.getDefaultPlayData=function(){return{frameData:[],allViewModels:[],currentFrameIndex:0,currentViewModel:void 0,labelData:{anyWordBreaks:!1,labelInfo:[]}}},e.getMinMaxForAllFrames=function(e,t){var i={},a=!1;if(e.allViewModels&&0<e.allViewModels.length)for(var r=0,o=e.allViewModels.length;r<o;r++){var s=e.allViewModels[r];_.isEmpty(s.dataPoints)||(a=!0,s=t(s),i={minY:d3.min([s.minY,i.minY]),maxY:d3.max([s.maxY,i.maxY]),minX:d3.min([s.minX,i.minX]),maxX:d3.max([s.maxX,i.maxX]),formatStringX:s.formatStringX||i.formatStringX,formatStringY:s.formatStringY||i.formatStringY})}return a?i:null},e.isDataViewPlayable=function(e,t){return void 0===t&&(t="Play"),(e=e.matrix&&e.matrix.rows&&e.matrix.rows.levels&&e.matrix.rows.levels[0]&&e.matrix.rows.levels[0].sources&&e.matrix.rows.levels[0].sources[0]&&e.matrix.rows.levels[0].sources[0].roles)&&e[t]},e.renderTraceLines=function(e,t,i){e=_.filter(e,function(e){return e.selected}),e=_.uniqBy(e,function(e){return e.identity.getKey()}),t.render(e,i)}}(powerbi=powerbi||{}),function(o){var c;function t(e){this.maxDataValue=Number.MIN_VALUE,this.newDataInterval=0,this.duration=3e5,this.featureSwitches=e.featureSwitches}c=o.visuals||(o.visuals={}),t.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.data={series:[],dataLabelsSettings:c.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:c.LineStyle.getDefault()}},t.prototype.initRenderer=function(e){this.animator=e.animator;e=e.svg,e.classed("realTimeLineChart",!0).classed("cartesianChart",!0),e=this.mainGraphicsSVG=e.append("svg");e.classed("mainGraphicsSVG",!0),this.mainGraphicsContext=e.append("g").classed("mainGraphicsContext",!0)},t.prototype.setData=function(e){var t,i;this.data||(this.data={series:[],dataLabelsSettings:c.LineChart.getDefaultLineChartLabelSettings(this.style),hasDynamicSeries:!1,categories:[],categoryMetadata:void 0,valuesMetadata:[],categoryData:[],lineStyle:c.LineStyle.getDefault()}),_.isEmpty(e)||(e=_.head(e)).categorical&&((t=c.CartesianHelper.getCategoryAxisProperties(e.metadata).duration)&&(this.duration=t),t=e.categorical,this.removeOldData(),t=t.categories,i=o.ValueType.fromDescriptor({text:!0}),t&&0<t.length&&t[0].source&&t[0].source.type&&(i=t[0].source.type),t=c.ScalarUtils.canHaveScalarAxis(e.metadata?e.metadata.objects:null,c.lineChartProps.categoryAxis.axisType,i),i=c.LineChart.converter({dataView:e,style:this.style,isScalar:t,featureSwitches:this.featureSwitches}),this.mergeNewData(i),this.removeOldData(this.newDataInterval))},t.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||!_.isEmpty(this.data.series))},t.prototype.calculateAxesProperties=function(r){var o,e,s=this,n=r.categoryAxisOptions,l=r.valueAxisOptions;return this.currentViewport=r.viewport,this.margin=r.margin,this.newAxisData&&(this.axisData=this.newAxisData),this.data&&(o=this.getAxesDomains(!1,{categoryAxis:!0,valueAxis:!0}),this.xAxisProperties=(e=function(e){var t="x"===e,e="y"===e,i=t?n:l,a=t?s.data.categoryMetadata:s.containsEmptySeries()?void 0:s.data.series[0].yCol,a=c.AxisHelper.createAxis({pixelSpan:t?r.viewport.width:r.viewport.height-s.margin.top-s.margin.bottom,domainOptions:t?{domain:o.categoryAxis,type:0}:{domain:o.valueAxis,type:0},axisZoom:void 0,metaDataColumn:a,isScalar:!0,isCategoryAxis:t,isVertical:e,formatString:c.valueFormatter.getFormatString(a,c.columnChartProps.general.formatString),outerPadding:t?10:0,useTickIntervalForDisplayUnits:!0,getValueFn:t?function(e,t){return c.CartesianHelper.lookupXValue(s.data,e,t,!0,s.featureSwitches)}:void 0,scaleType:c.axisScale.linear,logAxisScale:!1,margin:r.margin,preventNice:c.AxisHelper.hasForcedDomain(i.includeDomain),categoryThickness:null,featureSwitches:s.featureSwitches});return e&&a.axis.tickSize(-r.viewport.width),a})("x"),this.yAxisProperties=e("y"),this.newAxisData={x:this.xAxisProperties,y1:this.yAxisProperties}),this.axisData||(this.axisData=this.newAxisData),[this.xAxisProperties,this.yAxisProperties]},t.prototype.getAxesDomains=function(e,t){var i,a,r={};return this.data&&(i=this.truncateSeries(),_.isEmpty(i)||(t.categoryAxis&&(a=c.AxisHelper.createDomain(i,null!=(a=null==(a=null==(a=this.data)?void 0:a.categoryMetadata)?void 0:a.type)?a:o.ValueType.fromDescriptor({text:!0}),!0,[c.AxisHelper.createScalarDomainOptions([this.getMinData()+this.newDataInterval,void 0],0,[!0,void 0])]))&&(c.AxisHelper.assertScalarDomain(a.domain),r.categoryAxis=a.domain),t.valueAxis&&(r.valueAxis=c.AxisHelper.createValueDomain(i)))),r},t.prototype.setAxesLayout=function(e){},t.prototype.overrideXScale=function(e){this.xAxisProperties=e},t.prototype.render=function(e,t){if(!this.containsEmptySeries())return this.renderLines(),this.animator&&this.animator.refreshLastUpdate(),{dataPoints:[],behaviorOptions:{},labelDataPoints:[],labelsAreNumeric:!0,labelDataPointGroups:[],animateLabels:!1}},t.prototype.onClearSelection=function(){},t.prototype.truncateSeries=function(){var a=this.getMinData(),e=this.data.series;return e?_.map(e,function(e,t){(e=o.Prototype.inherit(e)).data=o.Prototype.inherit(e.data);var i=0;return 0<_.findIndex(e.data,function(e){return e&&e.categoryValue>=a})&&i++,e.data=e.data.slice(i),e}):[]},t.prototype.removeOldData=function(e){if(void 0===e&&(e=0),!this.containsEmptySeries()){for(var t=this.getMinData(e),e=this.data,i=0,a=e.series;i<a.length;i++){var r=a[i],o=_.findIndex(r.data,function(e){return e&&e.categoryValue>t});0<o&&(r.data=r.data.slice(o))}var s=_.findIndex(e.categoryData,function(e){return e&&e.categoryValue>t});0<s&&(e.categoryData=this.data.categoryData.slice(s),e.categories=this.data.categories.slice(s))}},t.prototype.mergeNewData=function(e){this.containsEmptySeries()?(this.data=e,this.maxDataValue=this.getMaxData()):(this.data.series=t.mergeSeries(this.data.series,e.series,this.maxDataValue),t.mergeCategories(this.data,e,this.maxDataValue),e=this.getMaxData(),this.newDataInterval=this.maxDataValue&&e?e-this.maxDataValue:0,this.maxDataValue=e)},t.prototype.getMaxData=function(){for(var e=0,t=0,i=this.data.series;t<i.length;t++){var a=i[t];a.data.length&&(e=Math.max(_.last(a.data).categoryValue,e))}return e},t.prototype.getMinData=function(e){return this.maxDataValue-this.duration-1.5*(e=void 0===e?0:e)},t.prototype.renderLines=function(){var i=this.axisData.x.scale,a=this.axisData.y1.scale,e=this.currentViewport,t=this.margin,r=e.height-t.top-t.bottom,e=e.width-t.left-t.right,t=i(i.domain()[0]+this.newDataInterval)-i(i.domain()[0]),o=d3.line().x(function(e,t){return i(e.categoryValue)}).y(function(e,t){return a(e.value)}),r=(this.mainGraphicsSVG.attrs({x:0,height:r,width:e}),this.mainGraphicsContext.attr("transform",c.SVGUtil.translate(0,0)),this.mainGraphicsContext.selectAll(".line").data(this.data.series,function(e){return e.identity.getKey()}));r.enter().append("path").classed("line",!0).merge(r).style("stroke",function(e){return e.color}).attr("d",function(e){return o(e.data)}),r.exit().remove(),this.animator&&this.animator.animate({mainGraphicsContext:this.mainGraphicsContext,interactivityService:null,xTranslation:t})},t.prototype.containsEmptySeries=function(){return!this.data||_.isEmpty(this.data.series)},t.mergeCategories=function(e,t,i){var a=t.categories,a=_.findIndex(a,function(e){return e&&e.categoryValue>i});-1<a?(e.categories=e.categories.concat(t.categories.slice(a)),e.categoryData=e.categoryData.concat(t.categoryData.slice(a))):(e.categories=t.categories,e.categoryData=t.categoryData)},t.mergeSeries=function(e,t,i){for(var a=[],r=0,o=t;r<o.length;r++){var s=o[r],n=_.find(e,function(e){return e.identity.equals(s.identity)});if(n){a.push(n);for(var l=0,c=s.data;l<c.length;l++){var u=c[l];u.categoryValue>i&&n.data.push(u)}}else a.push(s)}return a},t.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},t.prototype.getStaticSeriesRole=function(){return"Y"},c.RealTimeLineChart=t}(powerbi=powerbi||{}),function(e){var t,o=e.visuals||(e.visuals={});function i(e){e=t.call(this,e)||this;return e.lastUpdateTime=null,e}t=o.BaseAnimator,__extends(i,t),i.prototype.refreshLastUpdate=function(){this.lastUpdateTime=Date.now()},i.prototype.getDuration=function(){var e;return this.lastUpdateTime?(e=Math.min(Date.now()-this.lastUpdateTime,250),Math.max(this.animationDuration,e)):this.animationDuration},i.prototype.getEasing=function(){return o.D3Helper.easeCompat("linear")},i.prototype.animate=function(a){var e=a.mainGraphicsContext,t=this.getDuration();return e.transition().duration(t).ease(this.getEasing()).attrTween("transform",function(e,t,i){return function(e){return o.SVGUtil.translate(-a.xTranslation*e,0)}}),{failed:!1}},o.RealTimeLineChartAnimator=i,a=o.BaseAnimator,__extends(r,a),r.prototype.animate=function(e){var t={failed:!0,shapes:null},i=e.viewModel,a=this.previousViewModel;return i.categories.length*i.series.length>o.AnimatorCommon.MaxDataPointsToAnimate||(a&&(t=this.animateDefaultShapes(e.viewModel,e.series,e.layout,e.itemCS)),this.previousViewModel=i),t},r.prototype.getEasing=function(){return o.D3Helper.easeCompat("linear")},r.prototype.animateDefaultShapes=function(t,e,i,a){var e=e.selectAll(a.selector).data(function(e){return e.data},function(e){return e.key}),r=e.enter().append("rect").attr("class",function(e){return a.class.concat(e.highlight?" highlight":"")}).merge(e);return r.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return o.ColumnUtil.getFillOpacity(e.selected,e.highlight,!1,t.hasHighlights)}).transition().ease(this.getEasing()).duration(this.animationDuration).attrs(i.shapeLayout),e.exit().remove(),{failed:!1,shapes:r}};var a;function r(e){return a.call(this,e)||this}o.DashboardColumnChartAnimator=r}(powerbi=powerbi||{}),function(J){var Q;(Q=J.visuals||(J.visuals={})).scatterChartConverterModuleFactory=function(){var e=J.data,n=J.visuals,U=n.AxisHelper,l=n.cartesianChartProps,c=J.visuals.CartesianHelper,j=n.CategoricalLazyTooltipBuilder,A=J.visuals.ColorHelper,u=n.columnChartProps,P=e.DataRoleHelper,H=n.DataViewConcatenateUtil,z=J.DataViewObjects,E=n.ForegroundColorName,W=n.FormattingStrategies,L=n.GradientUtils,M=n.DataLabelViewModel,V=n.Legend,G=n.ScatterChart,Y=n.scatterChartProps,X=n.scatterRoleNames,K=n.SelectionIdBuilder,d=n.shapeUtil,Z=n.valueFormatter;function t(e,t,i,a){var r,o,s,n,l,c,u;if(!t.useMatrixDV)return e.categorical&&e.categorical.values?(p=e,g=t,h=i,a=a,S=J.data.createDataViewCategoricalReaderAdvanced(p,{colorOptions:{valueRole:"Size",visualStyle:g.style},formatStringProp:Y.general.formatString}),c=g.style,v=g.interactivityService,y=g.categoryAxisProperties,m=g.valueAxisProperties,D=p.categorical,d=L.getGradientValueColumn(D),f=D.categories&&0<D.categories.length?(r=D.categories[0].values,Z.create({format:Z.getFormatString(D.categories[0].source,Y.general.formatString),value:r[0],value2:r[r.length-1],columnType:S.data.getCategoryType("Category")})):(r=[null],Z.createDefaultFormatter(null)),o=!!(u=D.values).source,l=u.grouped(),u.source,s=function(e){var t,i,a,r=P.getMeasureIndexOfRole(e,"X"),o=P.getMeasureIndexOfRole(e,"Y"),s=P.getMeasureIndexOfRole(e,"Size"),n="",l="";e&&e.length&&(e=e[0],0<=r&&(t=e.values[r].source,n=e.values[r].source.displayName),0<=o&&(i=e.values[o].source,l=e.values[o].source.displayName),0<=s)&&(a=e.values[s].source);return{idx:{x:[r],y:o,size:s},cols:{x:t,y:i,size:a},axesLabels:{x:n,y:l}}}(l),n=M.getDefaultPointLabelSettings(c,"smallLightLabel"),l=function(e,t){var i={};e&&e.forEach(function(e){e=G.getMeasureValue(t,e.values),e=U.getRangeForColumn(e);(null==i.min||i.min>e.min)&&(i.min=e.min),(null==i.max||i.max<e.max)&&(i.max=e.max)});return i}(l,s.idx.size),c=O(p,n,!1,c),u=function(p,g,e,y,m,v,S,f,b,x,C,w){var D,A=p.data.hasValues("X"),P=p.data.hasValues("Y"),L=y.categories;if(!A&&!P)return[];for(var t=[],i=e.idx,M=Y.general.formatString,V=g.source,a=g.grouped(),T=(_.size(i.x),_.isEmpty(L)?null:L[0]),r=p.objects.getStaticObjects(),o=z.getValue(r,Y.bubbles.markerShape,Q.markerShape.circle),F=$(e),I=0,s=a.length;I<s;I++)for(var k=a[I],n=k.values,O=G.getMeasureValue(_.first(i.x),n),N=G.getMeasureValue(i.y,n),R=G.getMeasureValue(i.size,n),n=void 0,B=(S&&(n=p.colors.createBySeries(I,void 0,E)),void 0),l=(B=p.data.hasSeries()&&z.getValue(r,Y.bubbles.showSeries,!0)?z.getValue(p.objects.getSeriesDataObjects(I),Y.bubbles.markerShape,o):o,p.identities.createForSeries(I,[X.size])),H={identityKey:k&&k.identity&&k.identity.key||"",dataPoints:[],hasSize:!(!R||!R.values),fill:n,identity:l,markerShape:B,name:S?Z.format(p.data.getSeriesName(I),p.objects.getSeriesFormatString()):void 0},c=(t.push(H),0),u=m.length;c<u;c++)!function(e){var t=m[e],i=A?U.normalizeNonFiniteNumber(p.data.getValue(X.x,e,I)):0,a=P?U.normalizeNonFiniteNumber(p.data.getValue(X.y,e,I)):0,r=A?p.data.getFormatString(X.x,e,I):void 0,o=P?p.data.getFormatString(X.y,e,I):void 0,s=U.normalizeNonFiniteNumber(p.data.getValue("Size",e,I));if(null==i||null==a)return;var n,l=void 0,l=x&&!S?p.colors.createByCategory(e,E):p.colors.createBySeries(I,e,E),c=void 0,u=null!=(D=y.originalCategories)?D:[T],u=K.builder().withCategory(u,e,null==(D=null==T?void 0:T.source)?void 0:D.queryName,!0).withSeries(g,k,!0).withMeasures(F),d=(C?(c=u.clone(),d={expr:C.column.expr,formattedValue:C.formattedValue,identity:C.identity,value:C.value},c.withColumnIdentity(C.identity,C.column.queryName,[d])):c=u,c.createSelectionId()),c=u?u.createSelectionId():d,h=new j(p.columns,M),u=(w&&(u=W.defaultFormatter(M),n=W.fallbackBasedOnType(M),h.withColumnValueByIndex(T,e,!0,u),S&&h.withColumnValue(V,k.name,void 0,!0,u),h.withColumnValueByIndex(O,e,!1,n).withColumnValueByIndex(N,e,!1,n).withColumnValueByIndex(R,e,!1,n).withColumnValueByIndex(b,e,!1,n),C&&h.withValue(C.column.displayName,C.label),h.withAllValuesForRole("Tooltips",e,I,!1,n)),{x:i,y:a,xFormatString:r,yFormatString:o,size:s,radius:{sizeMeasure:R,index:e},fill:l,formattedCategory:G.createLazyFormattedCategory(v,null!=L?t:k.name),selected:!1,identity:d,renderIdentity:c,tooltipInfo:function(){return h.getTooltipItems()},labelFill:f.fontProperties.color,markerShape:B,categoryIndex:e,seriesIndex:I});H.dataPoints.push(u)}(c);return t}(S,u,s,D,r,f,o,n,d,c.colorByCategory,h,g.tooltipsEnabled),D=_.reduce(u,function(e,t){return e.concat(t.dataPoints)},[]),r=o?V.buildSeriesLegendData({dataView:p,style:g.style,showByDefault:!0,simpleMarkerProp:Y.bubbles.markerShape}):V.getDefaultLegendData(),y&&null!==y.showAxisTitle&&!1===y.showAxisTitle&&(s.axesLabels.x=null),m&&null!==m.showAxisTitle&&!1===m.showAxisTitle&&(s.axesLabels.y=null),v&&(v.applySelectionStateToData(D),v.applySelectionStateToData(r.dataPoints)),f=S.data.hasCategories(),{xCol:s.cols.x,yCol:s.cols.y,hasCategory:f,hasSize:!!s.cols.size,dataPoints:D,dataPointSeries:u,legendData:r,axesLabels:s.axesLabels,size:s.cols.size,sizeRange:l,dataLabelsSettings:n,hasDynamicSeries:o,fillPoint:c.fillPoint,fillPointStyle:c.fillPointStyle,colorBorder:c.colorBorder,colorByCategory:c.colorByCategory,multiplier:c.bubbleSizeMultiplier,xSubtotal:a&&a[X.x],ySubtotal:a&&a[X.y],plotAreaShadingSettings:c.plotAreaShadingSettings,ratioLineSettings:c.ratioLineSettings,markerShape:c.markerShape,dataVolume:c.dataVolume}):void 0;var d=e,h=t,p=i;if(d&&d.matrix&&(0!==_.size(d.matrix.valueSources)||0!==_.size(d.matrix.rows.levels))){for(var g=h.interactivityService,y=M.getDefaultPointLabelSettings(h.style,"smallLightLabel"),m=O(d,y,!0,h.style),v=function(e,t){var i,a,r,e=e.matrix,o=e.valueSources,s=!1,n=!1,l=[_.findIndex(o,function(e){return P.hasRole(e,"X")})],c=_.findIndex(o,function(e){return P.hasRole(e,"Y")}),u=_.findIndex(o,function(e){return P.hasRole(e,"Size")}),d="",h="";0<=l[0]?(i=o[l[0]],d=i.displayName):(g=N(e.rows,X.x))&&(i=g.column,l=g.levelSourceIndices,d=i.displayName,s=!0);0<=c?(a=o[c],h=a.displayName):(g=N(e.rows,X.y))&&(a=g.column,c=g.levelSourceIndices[0],h=a.displayName,n=!0);0<=u&&(r=o[u]);var p,g=_.find(e.rows.levels,function(e){return!_.isEmpty(e.sources)&&P.hasRole(e.sources[0],X.series)});g?p=e.rows.root:(g=_.find(e.columns.levels,function(e){return!_.isEmpty(e.sources)&&P.hasRole(e.sources[0],X.series)}))&&(p=e.columns.root);var o=!1,y=!1;{var m;i&&(m=i.type,o=_.size(l)<=1&&!(!m.integer&&!m.numeric),y=t.categoryAxisType===J.visuals.axisType.categorical||!o)}(s||n)&&_.find(e.rows.levels,function(e){return P.hasRole(e.sources[0],X.category)});m=s?_.find(e.rows.levels,function(e){return P.hasRole(e.sources[0],X.x)}):n?_.find(e.rows.levels,function(e){return P.hasRole(e.sources[0],X.y)}):_.find(e.rows.levels,function(e){return P.hasRole(e.sources[0],X.category)});return{idx:{x:l,y:c,size:u},cols:{x:i,y:a,size:r},axesLabels:{x:d,y:h},xGroupMetadata:s?{isCategoricalAxis:y,isScalarType:o}:void 0,yGroupMetadata:n?{isCategoricalAxis:!1,isScalarType:!0}:void 0,seriesLevel:g,seriesNode:p,categoryLevel:m,treatNullsAsZero:{x:t.xValuesTreatNullsAsZero,y:t.yValuesTreatNullsAsZero}}}(d,m),S={min:Number.MAX_VALUE,max:Number.MIN_VALUE},f=v.cols.size,b=(f&&f.aggregates&&(S={min:f.aggregates.minLocal||f.aggregates.min,max:f.aggregates.maxLocal||f.aggregates.max}),d.matrix.valueSources),x=[],C=0;C<b.length;C++)P.hasRole(b[C],"Tooltips")&&x.push(C);var w,f={colorHelper:A.create(h.style,Y.dataPoint.fill,m.defaultDataPointColor,m.fill),metadata:v,hasDynamicSeries:P.hasRoleInDataView(d,"Series"),tooltipsEnabled:h.tooltipsEnabled,sizeRange:S,dataLabelSettings:y,playFrameInfo:p,tooltipValuesIndices:x,gradientIndex:_.findIndex(b,function(e){return P.hasRole(e,"Gradient")}),objProps:m,categoryMap:{},categoryMapNextIndex:0,categoryIdentities:[]},p=function(e,t){var i=[],a=e.matrix;if(!a.rows.root||0===_.size(a.rows.root.children))return{series:i};var r,o=t.metadata,s=o.seriesLevel,n=o.categoryLevel,l=o.seriesNode,c=-1!==o.idx.size?a.valueSources[o.idx.size]:void 0;if(l){for(var u=0;u<l.children.length;u++){var d=l.children[u];if(!d.isSubtotal){for(var h=t.colorHelper.getColorForSeriesValue(d.objects,l.childIdentityFields,d.value,E),p=[],g=(_.size(s.sources),s.sources[0]),y=0,m=d.levelValues;y<m.length;y++){var v=m[y];p.push({expr:g.expr,formattedValue:Z.format(v.value,g.format),value:v.value,identity:d.identity})}var S=(new K).withColumnIdentity(d.identity,g.queryName,p).createSelectionId(),f=void 0,b=(f=t.objProps.markerShapeShowAllSeries?J.DataViewObjects.getValue(d.objects,Y.bubbles.markerShape,t.objProps.markerShape):t.objProps.markerShape,Z.format(d.value,J.DataViewObjects.getValue(g.objects,Y.general.formatString))),x={identityKey:d.identity&&d.identity.key||"",dataPoints:[],hasSize:!!c,fill:h,identity:S,markerShape:f,name:b},C=(i.push(x),{currentSeries:d,currentSeriesColor:h,seriesShape:f,seriesIndex:u});x.dataPoints=F(e,C,t),!n&&0===_.size(x.dataPoints)&&(S=I(void 0,g),b={category:d,categoryMetadataColumns:[g],categoryIdentityFields:d.childIdentityFields,currentSeries:d,currentSeriesMetadata:g,currentSeriesColor:h,categoryFormatter:S,valueColumnIds:$(t.metadata),seriesShape:f,currentSeriesIndex:u},S=k(e,b,t))&&x.dataPoints.push(S)}}var w=e.matrix.rows.root.children;(D=_.find(w,function(e){return e.isSubtotal}))&&(r=T(o,D))}else{var D,A;n?(A=null!=c?c.queryName:"",h=t.colorHelper.getColorForMeasure(null,A,E),x={identityKey:"",dataPoints:[],hasSize:!!c,fill:h,markerShape:t.objProps.markerShape},i.push(x),C={currentSeries:a.rows.root,currentSeriesColor:h,seriesShape:t.objProps.markerShape},x.dataPoints=F(e,C,t),w=e.matrix.rows.root.children,(D=_.find(w,function(e){return e.isSubtotal}))&&(r=T(t.metadata,D))):(A=null!=c?c.queryName:"",h=t.colorHelper.getColorForMeasure(null,A,E),i.push(o={identityKey:"",dataPoints:[],hasSize:!!c,fill:h}),C={currentSeries:a.rows.root,currentSeriesColor:h,seriesShape:t.objProps.markerShape},o.dataPoints=F(e,C,t),(w=t.metadata).xGroupMetadata||w.yGroupMetadata||(r=T(w,e.matrix.rows.root.children[0])))}return{series:i,xSubtotal:r&&r.xSubtotal,ySubtotal:r&&r.ySubtotal}}(d,f),D=_.reduce(p.series,function(e,t){return e.concat(t.dataPoints)},[]),d=(w=f.hasDynamicSeries?(d={dataView:d,colorHelper:f.colorHelper,style:h.style,formatStringProp:null,showByDefault:!0,markerShapePropIdentifier:Y.bubbles.markerShape,markerShowSeriesPropIdentifier:Y.bubbles.showSeries},(w=f.metadata.xGroupMetadata)&&w.isCategoricalAxis?V.buildFromFirstMatrixColumnLevel(d):V.buildFromFirstMatrixRowLevel(d)):V.getDefaultLegendData(h.style),g&&(g.applySelectionStateToData(D),g.applySelectionStateToData(w.dataPoints)),!!(v.xGroupMetadata||v.yGroupMetadata||v.categoryLevel));return{xCol:v.cols.x,yCol:v.cols.y,hasCategory:d,hasSize:!!v.cols.size,dataPoints:D,dataPointSeries:p.series,legendData:w,axesLabels:v.axesLabels,categoryIdentities:f.categoryIdentities,size:v.cols.size,sizeRange:S,dataLabelsSettings:y,hasDynamicSeries:f.hasDynamicSeries,fillPoint:m.fillPoint,fillPointStyle:m.fillPointStyle,colorBorder:m.colorBorder,colorByCategory:m.colorByCategory,multiplier:m.bubbleSizeMultiplier,xSubtotal:p.xSubtotal,ySubtotal:p.ySubtotal,plotAreaShadingSettings:m.plotAreaShadingSettings,ratioLineSettings:m.ratioLineSettings,markerShape:m.markerShape,dataVolume:m.dataVolume,xGroupMetadata:v.xGroupMetadata,yGroupMetadata:v.yGroupMetadata,treatNullsAsZero:v.treatNullsAsZero}}}function T(e,t){e.xGroupMetadata||e.yGroupMetadata;var i,a,r=e.idx.x,e=e.idx.y,r=(_.size(r),_.first(r));return{xSubtotal:i=-1!==r?U.normalizeNonFiniteNumber(t.values[r].value):i,ySubtotal:a=-1!==e?U.normalizeNonFiniteNumber(t.values[e].value):a}}function F(e,t,i){var a=[],r=t.currentSeries,o=i.metadata.seriesLevel?i.metadata.seriesLevel.sources[0]:void 0,s=$(i.metadata),n=function(e,t,i){var a,r,o=i.metadata.seriesLevel?i.metadata.seriesLevel.sources[0]:void 0,t=t.currentSeries,s=Z.createDefaultFormatter(null);i.metadata.xGroupMetadata&&i.metadata.xGroupMetadata.isCategoricalAxis?(i=e.matrix.rows,a=i.root.children,r=i.levels[0].sources,s=I(a[0],r[0])):t.children?(a=t.children,r=0<e.matrix.rows.levels.length?e.matrix.rows.levels[a[0].level].sources:void 0,o&&(s=I(a[0],r[0]))):o&&P.hasRole(o,"Category")&&(s=I((a=[t])[0],(r=[o])[0]));return{categories:a,categoryMetadataColumns:r,formatter:s}}(e,t,i);if(!_.isEmpty(n.categories))for(var l=0,c=n.categories;l<c.length;l++){var u=k(e,{category:c[l],categoryMetadataColumns:n.categoryMetadataColumns,categoryIdentityFields:r.childIdentityFields,currentSeries:r,currentSeriesMetadata:o,currentSeriesColor:t.currentSeriesColor,categoryFormatter:n.formatter,valueColumnIds:s,seriesShape:t.seriesShape,currentSeriesIndex:t.seriesIndex},i);u&&a.push(u)}return a}function I(e,t){var i;return e?(i=e.levelValues,Z.create({format:Z.getFormatString(t,Y.general.formatString),value:i[0],value2:i[_.size(e.values)-1],columnType:null})):Z.createDefaultFormatter(null)}function k(e,l,t){if(!l.category.isSubtotal){var i,a,r=t.metadata,e=e.matrix,o=r.idx.x,s=r.idx.y,n=r.idx.size,c=_.size(e.valueSources),u=r.xGroupMetadata,d=r.yGroupMetadata,h=_.first(o),p=0,g=Y.general.formatString,h=(u||-1===h||(p=U.normalizeNonFiniteNumber(l.category.values[h].value),p=r.treatNullsAsZero&&r.treatNullsAsZero.x&&null==p?0:p,i=z.getValue(l.category.values[h].objects,g)),null==p?null:[p]),p=(u&&(h=_.map(o,function(e){return l.category.levelValues[e].value})),0),y=r.xGroupMetadata&&r.xGroupMetadata.isCategoricalAxis;if(d||-1===s?d&&(p=l.category.levelValues[s].value):(D=q(y,l,c,s),p=U.normalizeNonFiniteNumber(l.category.values[D].value),p=r.treatNullsAsZero&&r.treatNullsAsZero.y&&null==p?0:p,a=z.getValue(l.category.values[D].objects,g)),null!=h&&null!=p){-1!==n&&(D=q(y,l,c,n),m=U.normalizeNonFiniteNumber(l.category.values[D].value),N=z.getValue(l.category.values[D].objects,g));var m,o=K.builder();if(!_.isEmpty(l.categoryMetadataColumns)){for(var s=_.last(l.categoryMetadataColumns),v=[],S=0,f=l.category.levelValues;S<f.length;S++){var b=f[S],x=l.categoryMetadataColumns[b.levelSourceIndex];v.push({expr:x.expr,formattedValue:Z.format(b.value,x.format),value:b.value,identity:l.category.identity})}o.withColumnIdentity(l.category.identity,s.queryName,v)}if(l.currentSeriesMetadata){for(var v=[],C=0,w=l.currentSeries.levelValues;C<w.length;C++){b=w[C];v.push({expr:l.currentSeriesMetadata.expr,formattedValue:Z.format(b.value,l.currentSeriesMetadata.format),value:b.value,identity:l.currentSeries.identity})}o.withColumnIdentity(l.currentSeries.identity,l.currentSeriesMetadata.queryName,v)}_.isEmpty(l.valueColumnIds)||o.withMeasures(l.valueColumnIds),t.playFrameInfo&&(L=t.playFrameInfo,V=o.clone(),v={expr:L.column.expr,formattedValue:L.formattedValue,identity:L.identity,value:L.value},o.withColumnIdentity(L.identity,L.column.queryName,[v]));var n=o.createSelectionId(),D=V?V.createSelectionId():n,s=t.sizeRange,o=(s.min>m&&(s.min=m),s.max<m&&(s.max=m),l.currentSeriesColor),A=(t.hasDynamicSeries||(t.objProps.colorByCategory?o=t.colorHelper.getColorForSeriesValue(l.category.objects,l.categoryIdentityFields,l.category.value,E):l.category.objects&&(V=null!=t.metadata.cols.size?t.metadata.cols.size.queryName:"",o=t.colorHelper.getColorForMeasure(l.category.objects,V,E))),W.defaultFormatter(g)),s=function(){var e=l.category.levelValues,t=l.currentSeries.value;return t=e?1<_.size(e)?H.concatenateValues(_.map(e,function(e,t){return A(e.value,l.categoryMetadataColumns[t])})):e[0].value:t},P=new J.visuals.LazyTooltipBuilder;if(t.tooltipsEnabled){var L,M=W.fallbackBasedOnType(g),V=l.category.levelValues,T=1<_.size(l.categoryMetadataColumns),d=(u||d||(T?P.withMultipleColumnAndValues(l.categoryMetadataColumns,_.map(V,function(e){return e.value}),!0,A):V&&P.withColumnValue(_.head(l.categoryMetadataColumns),V[0].value,void 0,!0,A)),t.hasDynamicSeries&&P.withColumnValue(l.currentSeriesMetadata,l.currentSeries.value,void 0,!0,A),u&&t.metadata.xGroupMetadata.isCategoricalAxis?P.withMultipleColumnAndValues(l.categoryMetadataColumns,h,!0,A):P.withColumnValue(r.cols.x,h[0],i,!1,M),P.withColumnValue(r.cols.y,p,a,!1,M).withColumnValue(r.cols.size,m,N,!1,M),t.gradientIndex),F=e.valueSources;0<=d&&(O=z.getValue(l.category.values[d].objects,g),P.withColumnValue(F[d],l.category.values[d].value,O,!1,M)),(L=t.playFrameInfo)&&P.withValue(L.column.displayName,L.label);for(var I=0,R=t.tooltipValuesIndices;I<R.length;I++){var k=R[I],O=z.getValue(l.category.values[k].objects,g),B=q(y,l,c,k);P.withColumnValue(F[k],l.category.values[B].value,O,!1,M)}}var T=1<_.size(h)?h.join(" "):h[0],V=y?T:s(),u=t.categoryMap,r=String(V),N=u[r];return void 0===N&&(u[r]=N=t.categoryMapNextIndex,t.categoryMapNextIndex=N+1,e=t.categoryIdentities)&&(e[N]=function(){var e=K.builder();if(!_.isEmpty(l.categoryMetadataColumns))for(var t=0,i=l.categoryMetadataColumns;t<i.length;t++){for(var a=i[t],r=[],o=0,s=l.category.levelValues;o<s.length;o++){var n=s[o];r.push({expr:a.expr,formattedValue:Z.format(n.value,a.format),value:n.value,identity:l.category.identity})}e.withColumnIdentity(l.category.identity,a.queryName,r)}return e.withMeasures(l.valueColumnIds).createSelectionId()}),{x:T,y:p,size:m,radius:{sizeMeasure:null,index:-1,value:m},fill:o,xFormatString:i,yFormatString:a,formattedCategory:G.createLazyFormattedLazyValue(l.categoryFormatter,s),selected:!1,identity:n,renderIdentity:D,tooltipInfo:function(){return P.getTooltipItems()},labelFill:t.dataLabelSettings.fontProperties.color,markerShape:l.seriesShape,categoryIndex:N,seriesIndex:l.currentSeriesIndex||0}}}}function q(e,t,i,a){return e&&null!=t.currentSeriesIndex?t.currentSeriesIndex*i+a:a}function O(e,t,i,a){var r={},o=(e&&e.metadata&&e.metadata.objects&&(r=e.metadata.objects),{}),s=(o.defaultDataPointColor=J.DataViewObjects.getFillColor(r,u.dataPoint.defaultColor),o.fill=J.DataViewObjects.getFillColor(r,u.dataPoint.fill),r.categoryLabels),s=(s&&t&&M.updateLabelSettingsFromLabelsObject(s,t,void 0,a),!1),s=i?e&&L.hasGradientRoleInMatrix(e.matrix):e&&L.hasGradientRole(e.categorical),t=(o.fillPoint=J.DataViewObjects.getValue(r,Y.fillPoint.show,s),o.fillPointStyle=J.DataViewObjects.getValue(r,Y.fillPoint.style,n.fillStyle.fillOnly),o.colorBorder=J.DataViewObjects.getValue(r,Y.colorBorder.show,!1),o.colorByCategory=J.DataViewObjects.getValue(r,Y.colorByCategory.show,!1),o.bubbleSizeMultiplier=d.getBubbleSizeMultiplier(J.DataViewObjects.getValue(r,Y.bubbles.bubbleSize)),o.markerShape=J.DataViewObjects.getValue(r,Y.bubbles.markerShape,Q.markerShape.circle),o.markerShapeShowAllSeries=z.getValue(r,Y.bubbles.showSeries,!0),A.create(a)),i=(o.plotAreaShadingSettings={show:J.DataViewObjects.getValue(r,Y.plotAreaShading.show,G.DefaultPlotAreaShadingSettings.show),upperShadingColor:h(t,r,Y.plotAreaShading.upperShadingColor,G.DefaultPlotAreaShadingSettings.upperShadingColor),lowerShadingColor:h(t,r,Y.plotAreaShading.lowerShadingColor,G.DefaultPlotAreaShadingSettings.lowerShadingColor),transparency:J.DataViewObjects.getValue(r,Y.plotAreaShading.transparency,G.DefaultPlotAreaShadingSettings.transparency)},c.getDefaultScatterRatioLineSettings(a));return o.ratioLineSettings={show:J.DataViewObjects.getValue(r,Y.ratioLine.show,i.show),lineColor:h(t,r,Y.ratioLine.lineColor,i.lineColor),transparency:J.DataViewObjects.getValue(r,Y.ratioLine.transparency,i.transparency),style:J.DataViewObjects.getValue(r,Y.ratioLine.style,i.style)},o.dataVolume=J.DataViewObjects.getValue(r,Y.general.dataVolume,G.DefaultDataVolume),o.categoryAxisType=J.DataViewObjects.getValue(r,l.categoryAxis.axisType),o.xValuesTreatNullsAsZero=J.DataViewObjects.getValue(r,Y.categoryAxis.treatNullsAsZero,!1),o.yValuesTreatNullsAsZero=J.DataViewObjects.getValue(r,Y.valueAxis.treatNullsAsZero,!1),o}function h(e,t,i,a){return{solid:{color:e.getColorForPropertyWithDefaultColor(t,i,a?a.solid.color:void 0)}}}function N(e,t){for(var i=0,a=e.levels.length;i<a;i++){var r=e.levels[i],o=_.chain(r.sources).map(function(e,t){return{levelSource:e,index:t}}).filter(function(e){return P.hasRole(e.levelSource,t)}).map(function(e){return e.index}).value();if(!_.isEmpty(o))return{levelIndex:i,levelSourceIndices:o,column:r.sources[_.first(o)]}}}function $(e){var t=[],i=e.cols;return!e.xGroupMetadata&&i.x&&t.push(i.x.queryName),!e.yGroupMetadata&&i.y&&t.push(i.y.queryName),i.size&&t.push(i.size.queryName),t}return{scatterConverter:t}}}(powerbi=powerbi||{}),function(k){var r=k.visuals.D3Helper,w=k.visuals.HtmlSubSelectionHelper;k.scatterChartRendererModuleFactory=function(){var e=k.visuals,P=e.CartesianHelper,t=jsCommon.CssConstants.createClassAndSelector,d=k.visuals.DataDirection,h=k.visuals.HtmlSubSelectableClass,s=e.LineStyle,p="markers",L=e.PlayChart,M=e.ScatterChart,g=k.visuals.SetFocusRingClassName,y=k.visuals.SubSelectableObjectNameAttribute,m=k.visuals.SubSelectableTypeAttribute,V=e.SVGUtil,v=t("scatterMarker"),l=t("mainGraphicsContext"),S=t("scatterMarkerSeriesGroup"),n=t("plotAreaShadingLayer"),c=t("upperShadingArea"),u=t("lowerShadingArea"),f=t("ratioLineLayer"),b=t("ratioLine"),T=(x.prototype.init=function(e,t,i,a,r,o,s,n){this.axisGraphicsContext=e,this.mainGraphicsG=e.append("g").classed(l.class,!0),i&&(this.mainGraphicsBackgroundRect=this.mainGraphicsG.append("rect").classed("backgroundRect",!0).attrs({width:"100%",height:"100%"})),this.mainGraphicsContext=this.mainGraphicsG.append("svg"),this.tooltipsEnabled=a,this.tooltipService=r,this.eventManager=n,this.mainGraphicsContext.attr("stroke-width","1"),o&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attr("tabindex",0).attr("focusable","true").attr("aria-label",s.getLocalizedString("Visual_Plot")).classed(g,!e))},x.prototype.markersHaveChanged=function(e){var t=_.map(e.data.dataPointSeries,function(e){return e.markerShape}),i=this.previousMarkers;if(i)for(var a=0,r=Math.min(t.length,i.length);a<r;a++)if(t[a]!==i[a])return this.previousMarkers=t,!0;return this.previousMarkers=t,!1},x.prototype.render=function(o,e,s,t,i){var a=o.plotArea,r=jsCommon.BrowserUtils.isInternetExplorerOrEdge();return this.formatMode=i,this.mainGraphicsContext.attrs({width:a.width,height:a.height}).classed(g,!r&&!!e),this.drawRatioLine(o,t),this.drawShadedBackground(o),i=o.suppressDataPointRendering?this.removeScatterMarkers():0<o.animationDuration&&!this.markersHaveChanged(o)?this.drawScatterMarkers(o,e,s):this.drawScatterMarkersNoAnimation(o,o.drawBubbles,e,s),o.drawBubbles&&i.order(),this.tooltipsEnabled&&this.tooltipService.addTooltip(this.mainGraphicsContext,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),V.flushAllD3TransitionsIfNeeded(o.animationOptions),this.numSeries=o.data.dataPointSeries.length,this.scatterChartDataPoints=o.allData.dataPoints,{dataPointsSelection:i,eventGroup:this.mainGraphicsG,data:o.data,fillMarkers:o.fillMarkers,root:this.mainGraphicsContext,visualInstanceId:s.instanceId,eventManager:this.eventManager,onMarkerSubSelection:function(e,t,i,a,r){t=o.allData.dataPointSeries[t.seriesIndex];M.onMarkerSubSelection({element:e,series:t,subSelectionHelper:i,d3Event:a,hostServices:s,showUI:r})}}},x.prototype.getNextDataPoint=function(t,i,e){var a=this.mainGraphicsContext.selectAll(v.selector),r=this.scatterChartDataPoints,o=t,s=i;switch(e){case d.PreviousCategory:case d.NextCategory:var n=e===d.PreviousCategory?-1:1,l=_.sortBy(_.filter(r,function(e){return e.seriesIndex===i}),"categoryIndex"),c=n+_.findIndex(l,function(e){return e.categoryIndex===t});c>=l.length||c<0?(u=this.rollToNextSeries(r,i,e),o=u[0],s=u[1]):o=l[c].categoryIndex;break;case d.PreviousSeries:case d.NextSeries:n=e===d.PreviousSeries?-1:1,l=_.sortBy(_.filter(r,function(e){return e.categoryIndex===t}),"seriesIndex");var u=n+_.findIndex(l,function(e){return e.seriesIndex===i}),s=u>=l.length||u<0?(c=this.rollToNextCategory(r,t,e),o=c[0],c[1]):l[u].seriesIndex}return{element:a.filter(function(e,t){return e.seriesIndex===s&&e.categoryIndex===o}).node(),targetCategoryIndex:o}},x.prototype.rollToNextSeries=function(e,t,i){i!==d.PreviousCategory&&d.NextCategory;for(var a,r=i===d.PreviousCategory?-1:1,i=i===d.PreviousCategory?_.last:_.first;_.isEmpty(a);)(t+=r)>=this.numSeries?t=0:t<0&&(t=this.numSeries-1),a=_.sortBy(_.filter(e,function(e){return e.seriesIndex===t}),function(e){return e.categoryIndex});return[i(a).categoryIndex,t]},x.prototype.rollToNextCategory=function(e,t,i){i!==d.PreviousSeries&&d.NextSeries;for(var a,r=d3.max(e,function(e){return e.categoryIndex})+1,o=i===d.PreviousSeries?-1:1,i=i===d.PreviousSeries?_.last:_.first;_.isEmpty(a);)r<=(t+=o)?t=0:t<0&&(t=r-1),a=_.sortBy(_.filter(e,function(e){return e.categoryIndex===t}),function(e){return e.seriesIndex});i=i(a).seriesIndex;return[t,i]},x.prototype.getFirstElement=function(){return{element:this.mainGraphicsContext.selectAll(v.selector).node()}},x.prototype.createTraceLineRenderer=function(e){return new i(e,this.mainGraphicsContext,this.tooltipsEnabled,this.tooltipService)},x.prototype.drawShadedBackground=function(e){var t,i,a,r=e.data.plotAreaShadingSettings||M.DefaultPlotAreaShadingSettings,o=this.axisGraphicsContext.select(n.selector);r.show&&e.supportsPlotAreaSymmetryShading?((o=o.empty()?this.axisGraphicsContext.insert("svg",":first-child").classed(n.class,!0).style("pointer-events","none"):o).attrs({height:e.plotArea.height,width:e.plotArea.width}),a=e.xAxisProperties.scale,e=e.yAxisProperties.scale,t=a.domain(),i=e.domain(),i=[{x:a((t=[Math.min(t[0],i[0]),Math.max(t[1],i[1])])[0]),y:e(t[0])},{x:a(t[1]),y:e(t[1])}],a=r.show?[[{x:i[0].x,y:i[0].y},{x:i[0].x,y:i[1].y}],[{x:i[1].x,y:i[1].y},{x:i[1].x,y:i[1].y}]]:[],this.drawArea(c,o,a,r.upperShadingColor,r.transparency),e=r.show?[[{x:i[0].x,y:i[0].y},{x:i[0].x,y:i[0].y}],[{x:i[1].x,y:i[0].y},{x:i[1].x,y:i[1].y}]]:[],this.drawArea(u,o,e,r.lowerShadingColor,r.transparency)):o.empty()||o.remove()},x.prototype.drawRatioLine=function(e,t){var i,a,r,o,s,n,l,t=e.data.ratioLineSettings||P.getDefaultScatterRatioLineSettings(t),c=this.axisGraphicsContext.select(f.selector);t.show?((c=c.empty()?this.axisGraphicsContext.append("svg").classed(f.class,!0):c).attrs({height:e.plotArea.height,width:e.plotArea.width}),i=e.xAxisProperties.scale,a=e.yAxisProperties.scale,r=i.domain(),o=a.domain(),s=e.data.xSubtotal,e=e.data.ySubtotal,l=[],t.show&&_.isFinite(s)&&_.isFinite(e)&&(0!==s&&0!==e?(n=e/s,l=[{x:i(r[0]),y:a(r[0]*n)},{x:i(r[1]),y:a(r[1]*n)}]):0!==e?l=[{x:i(0),y:a(o[0])},{x:i(0),y:a(o[1])}]:0!==s&&(l=[{x:i(r[0]),y:a(0)},{x:i(r[1]),y:a(0)}])),this.drawLine(b,c,l,t)):c.empty()||c.remove()},x.prototype.removeScatterMarkers=function(){return this.mainGraphicsContext.selectAll(S.selector).remove(),this.mainGraphicsContext.selectAll(v.selector)},x.getXOfFirstCategory=function(e){if(e.hasCategoricalAxis){e=e.xAxisProperties.scale;if(r.isScaleBand(e))return e.bandwidth()/2}return 0},x.prototype.drawScatterMarkers=function(i,e,a){var r=i.data,o=i.xAxisProperties.scale,s=i.yAxisProperties.scale,n=i.hasCategoricalAxis,l=x.getXOfFirstCategory(i),t=[{identityKey:"",dataPoints:r.dataPoints}],t=this.mainGraphicsContext.selectAll(S.selector).data(t,function(e){return e.identityKey}),c=t.enter().append("g").attrs({"aria-multiselectable":"true",role:"listbox"}).classed(S.class,!0).merge(t),t=(t.exit().remove(),c.selectAll(v.selector).data(function(e){return e.dataPoints},function(e){return e.renderIdentity.getKey()}).classed(h,!0).attr(y,p).attr(m,3)),c=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),c=t.enter().append("path").classed(v.class,!0).classed(g,!c&&!!e).classed(h,!0).attr(y,p).attr(m,3).style("opacity",0).attrs({transform:function(e){return V.translate(o(n?e.categoryIndex:e.x)+l,s(e.y))},tabindex:e?0:null,focusable:!!e||null,role:"option","aria-selected":function(e){return e.selected}}).merge(t);return c.styles({"stroke-opacity":function(e){return M.getMarkerStrokeOpacity(null!=e.size,r.colorBorder,i.hasSelection,e.selected)},stroke:function(e){return M.getStrokeFill(e,r.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return M.getMarkerFillOpacity(null!=e.size,i.fillMarkers,i.hasSelection,e.selected)}}).transition().ease(i.easeType).duration(i.animationDuration).style("opacity",1).attrs({d:function(e){var t=P.getBubbleRadius(e.radius,r.sizeRange,i.plotArea,r.multiplier);return e.geometry=e.geometry||{},e.geometry.size=t,e.geometry.markerShape=r.markerShape,k.visuals.Markers.getPathWithRadius(e.markerShape,t)},transform:function(e){var t=o(n?e.categoryIndex:e.x)+l,i=s(e.y);return e.geometry=e.geometry||{},e.geometry.x=t,e.geometry.y=i,e.geometry.markerShape=r.markerShape,V.translate(t,i)}}),this.formatMode&&c.each(function(){var e=d3.select(this).datum(),t=i.data.dataPointSeries[e.seriesIndex];w.setDataForElement(this,{getDisplayName:function(){return a.getLocalizedString("MiniToolbar_Markers",t.name)}})}),t.exit().transition().ease(i.easeType).duration(i.animationDuration).style("opacity",0).attr("r",0).remove(),c},x.prototype.drawScatterMarkersNoAnimation=function(o,e,i,a){var s=o.data,n=o.xAxisProperties.scale,l=o.yAxisProperties.scale,c=o.hasCategoricalAxis,u=x.getXOfFirstCategory(o),t=(e=e?(e=[{identityKey:"",dataPoints:s.dataPoints}],this.mainGraphicsContext.selectAll(S.selector).data(e,function(e){return e.identityKey})):this.mainGraphicsContext.selectAll(S.selector).data(s.dataPointSeries,function(e){return e.identityKey})).enter().append("g").attrs({"aria-multiselectable":"true",role:"listbox"}).classed(S.class,!0).merge(e),d=(e.exit().remove(),this.formatMode);return t.each(function(e){var r=M.getSeriesStyle(e.hasSize,s.colorBorder,o.hasSelection,o.fillMarkers,e.fill),t=d3.select(this),t=(C(this,r),t.selectAll(v.selector).data(e.dataPoints,function(e){return e.renderIdentity.getKey()})),e=(t.interrupt(),t.enter().append("path").classed(h,!0).classed(v.class,!0).attr(y,p).attr(m,3).merge(t)),t=(t.exit().remove(),e.each(function(e){var e=M.getMarkerStyle(e,s.colorBorder,o.hasSelection,o.fillMarkers),t=e,i=r;if(i)for(var a in t)t[a]===i[a]&&(t[a]=null);C(this,e)}),jsCommon.BrowserUtils.isInternetExplorerOrEdge());e.classed(g,!t&&!!i).attrs({d:function(e){var t=P.getBubbleRadius(e.radius,s.sizeRange,o.plotArea,s.multiplier);return e.geometry=e.geometry||{},e.geometry.size=t,e.geometry.markerShape=s.markerShape,k.visuals.Markers.getPathWithRadius(e.markerShape,t)},transform:function(e){var t=n(c?e.categoryIndex:e.x)+u,i=l(e.y);return e.geometry=e.geometry||{},e.geometry.x=t,e.geometry.y=i,e.geometry.markerShape=s.markerShape,V.translate(t,i)},tabindex:i?0:null,focusable:!!i||null,role:"option","aria-selected":function(e){return e.selected}}).style("opacity",null),d&&e.each(function(){var e=d3.select(this).datum(),t=o.data.dataPointSeries[e.seriesIndex];w.setDataForElement(this,{getDisplayName:function(){return a.getLocalizedString("MiniToolbar_Markers",t.name)}})})}),this.mainGraphicsContext.selectAll(v.selector)},x.prototype.drawLine=function(e,t,i,a){var r={},o=(r.stroke=a.lineColor.solid.color,r["stroke-width"]=2,r["stroke-opacity"]=(100-a.transparency)/100,r["stroke-dasharray"]=s.getStrokeDashArrayFromLineStyle(a.style),r["stroke-linecap"]=s.getStrokeLineCapFromLineStyle(a.style),r.fill="none",r["stroke-width"]="3px",d3.line().x(function(e){return e.x}).y(function(e){return e.y})),a=t.selectAll(e.selector).data([i]);return a.enter().append("path").classed(e.class,!0).merge(a).attr("d",function(e){return o(e)}).styles(r),a.exit().remove(),t},x.prototype.drawArea=function(e,t,i,a,r){var o=d3.area().x0(function(e){return e[0].x}).y0(function(e){return e[0].y}).x1(function(e){return e[1].x}).y1(function(e){return e[1].y}),t=t.selectAll(e.selector).data([i]);t.enter().append("path").classed(e.class,!0).merge(t).attr("d",function(e){return o(e)}).styles({fill:a.solid.color,"fill-opacity":(100-r)/100}),t.exit().remove()},x);function x(){}var F=t("traceLine"),I=t("traceBubble"),i=(a.prototype.remove=function(){this.element.selectAll(F.selector).remove(),this.element.selectAll(I.selector).remove()},a.prototype.render=function(a,e){var t=this.viewModel,i=t.data.currentViewModel,r=t.viewModel,o=[];if(_.isEmpty(a)||r.suppressDataPointRendering)this.remove();else{for(var s=t.data.currentFrameIndex,n=[],l=0,c=a.length;l<c;l++){o[l]=[],n[l]=!1;for(var u=0,d=t.data.allViewModels.length;u<d&&u<=s;u++){var h=_.find(t.data.allViewModels[u].dataPoints,function(e,t){var i=a[l];return i.renderIdentity?e.renderIdentity.getKey()===i.renderIdentity.getKey():e.identity.getKey()===a[l].identity.getKey()});null!=h&&(h.frameIndex=u,o[l].push(h),u===s)&&(n[l]=!0)}}for(var p=r.xAxisProperties.scale,g=r.yAxisProperties.scale,y=d3.line().x(function(e){return p(e.x)}).y(function(e){return g(e.y)}).defined(function(e){return null!==e.x&&null!==e.y}),m=this.element.selectAll(F.selector).data(a,function(e){return e.renderIdentity.getKey()}),v=m.enter().append("path").classed(F.class,!0).merge(m),S=[],f=[],b=!1,x=(v.each(function(e,t){var i=this.hasAttribute("d")?this.getTotalLength():0,a=(S.push(i),$("<svg><path></path></svg>")),a=$("path",a),t=(a.attr("d",y(o[t])),0<o[t].length?a.get()[0].getTotalLength():0);f.push(t),b=b||t<i}),b?e?v.transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).attr("stroke-dashoffset",function(e,t){return S[t]-f[t]}).transition().ease(d3.easeLinear).duration(1).delay(0).style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return f[t]+" "+f[t]},"stroke-dashoffset":0}):v.style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return f[t]+" "+f[t]},"stroke-dashoffset":0}):(v.style("stroke",function(e){return M.getStrokeFill(e,!0)}).attrs({d:function(e,t){return y(o[t])},"stroke-dasharray":function(e,t){return f[t]+" "+f[t]},"stroke-dashoffset":function(e,t){return f[t]-S[t]}}),(e?v.transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()):v).attr("stroke-dashoffset",0)),m.exit().remove(),T.getXOfFirstCategory(r)),C=r.hasCategoricalAxis,w=[],D=0;D<o.length;D++)var A=o[D],A=n[D]?A.slice(0,A.length-1):A,w=w.concat(A);e=this.element.selectAll(I.selector).data(w,function(e){return e.renderIdentity.getKey()+e.x+e.y+e.size}),v=e.enter().append("path").style("opacity",0).classed(I.class,!0).merge(e);v.attrs({d:function(e){return k.visuals.Markers.getPathWithRadius(e.markerShape,P.getBubbleRadius(e.radius,r.data.sizeRange,r.plotArea,r.data.multiplier))},transform:function(e){return V.translate(p(C?e.categoryIndex:e.x)+x,g(e.y))}}).styles({"stroke-opacity":function(e){return M.getBubbleOpacity(e,!0)},stroke:function(e){return M.getStrokeFill(e,i.colorBorder)},fill:function(e){return e.fill},"fill-opacity":function(e){return null!=e.size?.2+e.frameIndex/s*.6:0}}).transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).style("opacity",1),e.exit().transition().ease(d3.easeLinear).duration(L.getFrameAnimationDuration()).style("opacity",0).remove(),this.tooltipsEnabled&&this.tooltipService.addTooltip(v,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),v.sort(function(e,t){return t.size-e.size})}},a);function a(e,t,i,a){this.viewModel=e,this.element=t,this.tooltipsEnabled=i,this.tooltipService=a}function C(e,t){for(var i in t){var a=e.style[i],r=t[i];if(null==r){if(""===a)continue}else if((r=r.toString())===a)continue;e.style[i]=r}}return{create:function(){return new T}}}}(powerbi=powerbi||{}),function(x){var y,C,w=x.visuals||(x.visuals={}),a=jsCommon.Color,c=x.data.Selector,e=(w.MARKERS_MAX_COUNT_THRESHOLD=7,w.MIN_OUTLINE_SIZE=10,m.prototype.initData=function(e){this.dataInitOptions=e,this.style=e.style,this.element=e.element,this.currentViewport=e.viewport,this.hostService=e.host,this.isMobileChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.tooltipService=e.services.tooltips,this.featureSwitches=e.featureSwitches,this.animationOptions=e.animation},m.prototype.initRenderer=function(e){this.animator=e.animator,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=e.cartesianHost;var t=this.svg=e.svg;t.classed(m.ClassName+" "+w.PlayChart.ClassName,!0),this.renderer.init(t,e.labelsContext,this.isMobileChart,this.tooltipsEnabled,this.tooltipService,this.interactivityService,this.hostService,e.eventManager),m.DefaultPlotAreaShadingSettings.upperShadingColor={solid:{color:w.ColorHelper.getDataColorByIndex(this.style,3)}},m.DefaultPlotAreaShadingSettings.lowerShadingColor={solid:{color:w.ColorHelper.getDataColorByIndex(this.style,5)}}},m.createLazyFormattedCategory=function(e,t){return new jsCommon.Lazy(function(){return e.format(t)})},m.createLazyFormattedLazyValue=function(e,t){return new jsCommon.Lazy(function(){return e.format(t())})},m.getMeasureValue=function(e,t){return 0<=e?t[e]:null},m.getDefaultData=function(e){return{xCol:void 0,yCol:void 0,hasCategory:void 0,dataPoints:[],dataPointSeries:[],legendData:w.Legend.getDefaultLegendData(e),axesLabels:{x:"",y:""},sizeRange:{min:void 0,max:void 0},dataLabelsSettings:w.DataLabelViewModel.getDefaultPointLabelSettings(e,"smallLightLabel"),hasDynamicSeries:!1,plotAreaShadingSettings:m.DefaultPlotAreaShadingSettings,ratioLineSettings:w.CartesianHelper.getDefaultScatterRatioLineSettings(e),markerShape:w.markerShape.circle,dataVolume:m.DefaultDataVolume,multiplier:w.shapeUtil.MinBubbleMultiplier}},m.prototype.renderAtFrame=function(e){this.data=this.originalData=e,this.viewModelAdapterFactory&&this.originalData&&(e=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=e.getData()),this.cartesianVisualHost.triggerRender(!1)},m.prototype.setData=function(e){var a,r,t,i=this;this.data=m.getDefaultData(this.style),this.playAxis&&this.playAxis.isCurrentlyPlaying()&&this.playAxis.stop(),0<e.length?(e=e[0]||e[1])&&(this.categoryAxisProperties=w.CartesianHelper.getCategoryAxisProperties(e.metadata,!0),this.valueAxisProperties=w.CartesianHelper.getValueAxisProperties(e.metadata,!0),this.dataView=e,a={viewport:this.currentViewport,colors:this.colors,interactivityService:this.interactivityService,categoryAxisProperties:this.categoryAxisProperties,valueAxisProperties:this.valueAxisProperties,style:this.style,tooltipsEnabled:this.tooltipsEnabled,useMatrixDV:!0},r=w.scatterChartConverterModuleFactory(),w.PlayChart.isDataViewPlayable(e)?(this.playAxis||(this.playAxis=new w.PlayAxis({interactivityService:this.interactivityService,isScrollable:!1,featureSwitches:{}}),this.dataView&&w.PlayChart.isDataViewPlayable(this.dataView)&&(this.playAxis,this.playAxis.initData(this.dataInitOptions))),a.useMatrixDV=!1,t=this.playAxis.setData(e,function(e,t,i){return r.scatterConverter(e,a,t,i)}),this.mergeSizeRanges(t),this.data=t.currentViewModel,this.playAxis.setRenderFunction(function(e){return i.renderAtFrame(e)})):(this.playAxis&&(this.playAxis.remove(),this.playAxis=null),(t=r.scatterConverter(e,a))&&(this.data=t))):this.playAxis&&(this.playAxis.remove(),this.playAxis=null),this.originalData=this.data},m.prototype.mergeSizeRanges=function(e){if(e&&e.currentViewModel){for(var t=e.currentViewModel.sizeRange,i=0,a=e.allViewModels;i<a.length;i++){var r=a[i].sizeRange;null!=r.min&&(t.min=Math.min(t.min,r.min)),null!=r.max&&(t.max=Math.max(t.max,r.max))}for(var o=0,s=e.allViewModels;o<s.length;o++)s[o].sizeRange=t}},m.prototype.calculateCustomLegend=function(){return this.data&&this.data.legendData},m.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},m.prototype.enumerateObjectInstances=function(e,t){var i=this.originalData;switch(t.objectName){case"colorByCategory":!i||i.hasDynamicSeries||e.pushInstance({objectName:"colorByCategory",selector:null,properties:{show:i.colorByCategory}});break;case"dataPoint":if(this.playAxisDataColorsEnabled&&this.playAxis&&this.dataView){if(!w.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix))return this.playAxis.enumerateDataPoints(e,this.data,this.dataView,this.style)}else if(!this.playAxis&&this.dataView&&!w.GradientUtils.hasGradientRoleInMatrix(this.dataView.matrix))return this.enumerateDataPoints(e);break;case"categoryAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.categoryAxisProperties||null==this.categoryAxisProperties.showAxisTitle||this.categoryAxisProperties.showAxisTitle},objectName:"categoryAxis"}),i.xGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!i.treatNullsAsZero||!i.treatNullsAsZero.x)},objectName:"categoryAxis"});break;case"valueAxis":e.pushInstance({selector:null,properties:{showAxisTitle:!this.valueAxisProperties||null==this.valueAxisProperties.showAxisTitle||this.valueAxisProperties.showAxisTitle},objectName:"valueAxis"}),i.yGroupMetadata||e.pushInstance({selector:null,properties:{treatNullsAsZero:!(!i.treatNullsAsZero||!i.treatNullsAsZero.y)},objectName:"valueAxis"});break;case"categoryLabels":this.isXAxisCategorical()||(this.data?w.DataLabelViewModel.enumerateCategoryLabels(e,i.dataLabelsSettings,!0,this.featureSwitches,void 0,void 0,this.style):w.DataLabelViewModel.enumerateCategoryLabels(e,null,!0,this.featureSwitches,void 0,void 0,this.style));break;case"fillPoint":i.hasSize||e.pushInstance({objectName:"fillPoint",selector:null,properties:{show:i.fillPoint}});break;case"colorBorder":i.hasSize&&e.pushInstance({objectName:"colorBorder",selector:null,properties:{show:i.colorBorder}});break;case"bubbles":m.enumerateBubbles(e,i,this.dataView);break;case"plotAreaShading":this.isPlotSymettryShadingSupported()?e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{show:i.plotAreaShadingSettings.show,upperShadingColor:i.plotAreaShadingSettings.upperShadingColor,lowerShadingColor:i.plotAreaShadingSettings.lowerShadingColor,transparency:i.plotAreaShadingSettings.transparency}}):e.pushInstance({selector:null,objectName:"plotAreaShading",properties:{},disabledReason:this.hostService.getLocalizedString("Visual_Scatter_SymmetryShadingNotSupported")});break;case"ratioLine":i.xCol&&i.yCol&&i.xCol.isMeasure&&i.yCol.isMeasure&&e.pushInstance({selector:null,objectName:"ratioLine",properties:{show:i.ratioLineSettings.show,lineColor:i.ratioLineSettings.lineColor,transparency:i.ratioLineSettings.transparency,style:i.ratioLineSettings.style}});break;case"general":!i||this.playAxis||this.isXAxisCategorical()||e.pushInstance({selector:null,objectName:"general",properties:{dataVolume:i.dataVolume},validValues:{dataVolume:{numberRange:{min:m.DefaultDataVolume,max:m.MaximumDataVolume}}}})}},m.prototype.resolveFormattingPlaceholder=function(e){return!w.builder.isVisualFormattingSlicePlaceholder(e)||"dataVolume"!==e.name?void 0:this.getDataVolumeSlice()},m.prototype.getDataVolumeSlice=function(){var e,t=this,i=this.originalData;if(i&&!this.playAxis&&!this.isXAxisCategorical())return e=w.scatterChartProps.general,{item:new w.builder.SimpleFormattingSliceBuilder({uidBuilder:new w.builder.FormattingSliceUidBuilder(new w.builder.FormattingGroupUidBuilder(new w.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"dataVolume"),control:new w.builder.NumUpDownBuilder({descriptor:e.dataVolume,value:i.dataVolume,options:{minValue:{type:0,value:m.DefaultDataVolume},maxValue:{type:1,value:m.MaximumDataVolume}}}).build(),localize:function(e){return t.hostService.getLocalizedString(e)}}).withCustomDisplayName("Visual_DataVolumeModern").build(),revertToDefaultDescriptors:[e.dataVolume]}},m.prototype.enumerateDataPoints=function(e){var t=this.originalData;t&&(t.hasDynamicSeries?x.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:e,dataPoints:w.LegendData.toIEnumerableDataPoints(t.legendData)},this.featureSwitches):x.colorEnumerationHelperModuleFactory().enumerateCategoryDataColors({enumeration:e,dataView:this.dataView,style:this.style,categories:_.map(t.dataPoints,function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3},this.featureSwitches))},m.enumerateBubbles=function(e,t,i){1<t.dataPointSeries.length&&(a=x.DataViewObjects.getValue(i&&i.metadata&&i.metadata.objects,w.scatterChartProps.bubbles.showSeries,!1));var a,i={selector:null,properties:{bubbleSize:w.shapeUtil.invertBubbleSizeMultiplier(t.multiplier),markerShape:t.markerShape},validValues:{bubbleSize:{numberRange:{min:-30,max:100}},markerShape:[w.markerShape.circle,w.markerShape.square,w.markerShape.diamond,w.markerShape.triangle]},objectName:w.scatterChartProps.bubbles.markerShape.objectName};if(null!=a&&(i.properties[w.scatterChartProps.bubbles.showSeries.propertyName]=a),e.pushInstance(i),a)for(var r=0,o=t.dataPointSeries.length;r<o;r++){var s=t.dataPointSeries[r];e.pushContainer({displayName:s.name}),e.pushInstance({selector:x.data.Selector.normalizeSelector(s.identity.getSelector()),properties:{markerShape:s.markerShape},validValues:{markerShape:[w.markerShape.circle,w.markerShape.square,w.markerShape.diamond,w.markerShape.triangle]},objectName:w.scatterChartProps.bubbles.markerShape.objectName}),e.popContainer()}},m.prototype.getMarkersCard=function(t){var r,o,e,s,n=this,l=this.originalData;if(l&&l.dataPointSeries&&0!==l.dataPointSeries.length)return r=x.DataViewObjects.getValue(this.dataView&&this.dataView.metadata&&this.dataView.metadata.objects,w.scatterChartProps.bubbles.showSeries,!0),o=function(e){return n.hostService.getLocalizedString(e)},e=[w.scatterChartObjectProps.bubbles.markerShape,w.scatterChartObjectProps.bubbles.bubbleSize,w.scatterChartObjectProps.bubbles.showSeries,w.scatterChartObjectProps.fillPoint.show,w.scatterChartObjectProps.fillPoint.style,w.scatterChartObjectProps.dataPoint.fill,w.scatterChartObjectProps.dataPoint.showAllDataPoints,w.scatterChartObjectProps.dataPoint.defaultColor,w.scatterChartObjectProps.colorByCategory.show,w.scatterChartObjectProps.categoryAxis.preferredCategoryWidth,w.scatterChartObjectProps.categoryAxis.innerPadding,w.scatterChartObjectProps.colorBorder.show],e=new w.builder.FormattingCardBuilder(new w.builder.FormattingCardUidBuilder("markers"),"Visual_Markers",e,o),s={styleProps:{markerShape:w.scatterChartObjectProps.bubbles.markerShape,markerSize:w.scatterChartObjectProps.bubbles.bubbleSize,fillPointShow:w.scatterChartObjectProps.fillPoint.show,fillPointStyle:w.scatterChartObjectProps.fillPoint.style,showSeries:w.scatterChartObjectProps.bubbles.showSeries,colorBorder:w.scatterChartObjectProps.colorBorder.show},style:{markerShape:l.markerShape,fillPointShow:l.fillPoint,fillPointStyle:l.fillPointStyle,markerSize:w.shapeUtil.invertBubbleSizeMultiplier(l.multiplier),showSeries:r,colorBorder:l.colorBorder},selector:null,hasSize:l.hasSize,showSeries:r},e.addGroup("applySettingsTo",function(e){e.withContainerDisabled(!r).withDisplayName("Apply_Settings_To").withCollapsible(!1).addContainer("series",function(e){if(e.withDisplayName("Series"),e.addContainerItem("all",o("All"),function(e){var t;w.MarkerProperties.addScatterChartMarkersFormattingContainers(s,e,n.featureSwitches),r||(t=[w.scatterChartObjectProps.bubbles.markerShape],e.addSimpleSlice("showSeriesLink",function(){return new w.builder.SeriesDialogLinkBuilder({descriptor:w.scatterChartObjectProps.bubbles.showSeries,value:function(){},ariaLabel:"Enable_This_Setting",type:"SeriesDialogLink",resetToDefaultDescriptors:t,warningIcon:!0}).build()},function(e){return e.withCustomDisplayName("Enable_This_Setting").withSuppressDisplayName(!0)}))}),1<l.dataPointSeries.length)for(var t=0,i=l.dataPointSeries;t<i.length;t++){var a=i[t];s=__assign(__assign({},s),{style:__assign(__assign({},s.style),{markerShape:a.markerShape}),selector:x.data.Selector.normalizeSelector(a.identity.getSelector())}),e.addContainerItem(a.name,a.name,function(e){return w.MarkerProperties.addScatterChartMarkersFormattingContainers(s,e,n.featureSwitches)})}})}),e.addGroup("colors",function(e){var t;if(e.withDisplayName("Generic_Color"),l.hasDynamicSeries||e.addSimpleSlice("colorByCategory",new w.builder.ToggleSwitchBuilder({descriptor:__assign(__assign({},w.scatterChartObjectProps.colorByCategory.show),{selector:null}),value:l.colorByCategory}).build(),function(e){return e.withCustomDisplayName("Visual_ColorByCategory")}),l.hasDynamicSeries)return t={groupBuilder:e,dataPoints:w.LegendData.toIEnumerableDataPoints(l.legendData),seriesColorProps:w.scatterChartObjectProps.dataPoint,localize:o,featureSwitches:n.featureSwitches},x.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t);t={groupBuilder:e,colorProps:w.columnChartProps.dataPoint,featureSwitches:n.featureSwitches,hostService:n.hostService,options:{dataView:n.dataView,style:n.style,categories:_.map(l.dataPoints,function(e){return{color:e.fill,displayName:e.formattedCategory.getValue(),identity:e.identity}}),fillInstanceKind:3}},x.colorEnumerationHelperModuleFactory().appendCategoryColorSlicesToGroup(t)}),this.isXAxisCategorical()&&e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new w.builder.SliderBuilder({descriptor:w.scatterChartObjectProps.categoryAxis.innerPadding,value:100*t.categoryAxisData.innerPadding,localize:o,options:{minValue:{type:0,value:0},maxValue:{type:1,value:50}}}).build()).addSimpleSlice("maxcategoryWidth",new w.builder.NumUpDownBuilder({descriptor:w.scatterChartObjectProps.categoryAxis.preferredCategoryWidth,value:Math.round(100*t.categoryAxisData.maxMarginFactor),options:{minValue:{type:0,value:20},maxValue:{type:1,value:180}}}).build(),function(e){return e.withCustomDisplayName("Visual_Max_CategoryWidth")})}),e.build()},m.prototype.getCategoryLabelsCard=function(){var e,t,i=this;if(!this.isXAxisCategorical())return e=w.scatterChartObjectProps.categoryLabels,e=__assign(__assign({},e),{fontFamily:e.fontFamily,fontSize:e.fontSize,show:e.show}),t=this.data?this.data.dataLabelsSettings:null,w.DataLabelViewModel.getCategoryLabelsCard({cardName:"Visual_CategoryLabel",dataLabelSettings:t,isShowCategory:void 0,localize:function(e){return i.hostService.getLocalizedString(e)},props:e,revertToDefaultProps:w.scatterChartObjectProps.categoryLabels,showBackground:!0,showValueColor:!0,style:this.style,featureSwitches:this.featureSwitches})},m.prototype.customizeFormattingCard=function(e){var t;return w.builder.isPlaceholder(e)||("categoryAxis"===e.uid&&(t=this.getCustomizedCategoryAxisCard(e)),"valueAxis"===e.uid&&(t=this.getCustomizedValueAxisCard(e))),t},m.prototype.getCustomizedCategoryAxisCard=function(e){var i=this,a=__spreadArray([],e.groups,!0);return a.forEach(function(e,t){w.builder.isPlaceholder(e)||e.uid==="".concat("categoryAxis","-").concat("valuesScalar")&&(a[t]=i.getNewValuesGroup(e,!0))}),__assign(__assign({},e),{revertToDefaultDescriptors:__spreadArray(__spreadArray([],e.revertToDefaultDescriptors,!0),[w.scatterChartProps.categoryAxis.treatNullsAsZero],!1),groups:a})},m.prototype.getCustomizedValueAxisCard=function(e){var i=this,a=__spreadArray([],e.groups,!0);return a.forEach(function(e,t){w.builder.isPlaceholder(e)||e.uid==="".concat("valueAxis","-").concat("values")&&(a[t]=i.getNewValuesGroup(e,!1))}),__assign(__assign({},e),{revertToDefaultDescriptors:__spreadArray(__spreadArray([],e.revertToDefaultDescriptors,!0),[w.scatterChartProps.valueAxis.treatNullsAsZero],!1),groups:a})},m.prototype.getNewValuesGroup=function(e,t){var i=__spreadArray([],e.slices,!0),a=w.builder.FormattingUidBuilder.fromGroup(e),a=this.getShowBlankValuesSlice(a,t);return a&&i.push(a),__assign(__assign({},e),{slices:i})},m.prototype.getShowBlankValuesSlice=function(e,t){var i=this,a=this.originalData,r=t?a.xGroupMetadata:a.yGroupMetadata,o=(t?w.scatterChartProps.categoryAxis:w.scatterChartProps.valueAxis).treatNullsAsZero,t=t?!(!a.treatNullsAsZero||!a.treatNullsAsZero.x):!(!a.treatNullsAsZero||!a.treatNullsAsZero.y);if(!r)return a={type:"ToggleSwitch",properties:{descriptor:__assign(__assign({},o),{selector:null}),value:t}},new w.builder.SimpleFormattingSliceBuilder({control:a,localize:function(e){return i.hostService.getLocalizedString(e)},uidBuilder:e.withSlice("showblankvalues")}).build()},m.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getMarkersCard(e)},function(){return t.getCategoryLabelsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:2}},m.prototype.supportsTrendLine=function(){var e=this.data;return!(!e||this.isXAxisCategorical()||this.playAxis)&&!e.hasSize&&(e.hasCategory||e.hasDynamicSeries)&&!!e.xCol&&!!e.yCol},m.prototype.supportsStaticReferenceLines=function(){return this.data&&!this.isXAxisCategorical()},m.prototype.getAxisLocationForRole=function(e){return"X"===e?0:1},m.getExtents=function(e){var t,i={},a=e.dataPoints;return _.isEmpty(a)?{minY:0,maxY:0,formatStringY:void 0,minX:0,maxX:0,formatStringX:void 0}:((e=(t=!!e.xGroupMetadata)&&e.xGroupMetadata.isCategoricalAxis)||(i.minX=d3.min(a,function(e){return e.x}),i.maxX=d3.max(a,function(e){return e.x}),i.formatStringX=_.first(a).xFormatString),t&&!e&&(a=_.filter(a,function(e){return null!=e.x})),i.minY=d3.min(a,function(e){return e.y}),i.maxY=d3.max(a,function(e){return e.y}),i.formatStringY=null==(t=_.first(a))?void 0:t.yFormatString,i)},Object.defineProperty(m.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),m.prototype.calculateAxesProperties=function(n){function e(e){var t="x"===e,i="y"===e,a=t?c:u,r=t&&l.isXAxisCategorical(),o=r?{domain:_.uniq(_.map(l.data.dataPoints,function(e){return e.categoryIndex})),type:0}:(o=w.AxisHelper.createScalarDomainOptions(t?h.categoryAxis:h.valueAxis,0),w.AxisHelper.mergeScalarAxisDomains(a.includeDomain,o)),s=t?l.data.xCol:l.data.yCol,i={pixelSpan:t?l.availableWidth:l.availableHeight,domainOptions:o,metaDataColumn:s,axisZoom:n.axisZoom,zeroScalarDomain:m.DefaultZeroScalarDomain,isScalar:i||!r,isCategoryAxis:t,isVertical:i,formatString:(t?d.formatStringX:d.formatStringY)||w.valueFormatter.getFormatString(s,w.scatterChartProps.general.formatString),outerPadding:0,forcedTickCount:n.forcedTickCount,useTickIntervalForDisplayUnits:!0,scaleType:a.scaleType,logAxisScale:a.logAxisScale,axisDisplayUnits:a.displayUnits,axisPrecision:a.precision,margin:l.margin,preventNice:r?void 0:w.AxisHelper.hasForcedDomain(o),invertAxis:a.invertAxis,featureSwitches:l.featureSwitches};return r&&(s=l.getCategoryLayout(i.domainOptions.domain,n),i=__assign(__assign({},i),{outerPadding:s.outerPaddingRatio,categoryThickness:s.categoryThickness,innerPaddingRatio:s.innerPaddingRatio,outerPaddingRatio:s.outerPaddingRatio,getValueFn:function(t,e){var i=_.find(l.data.dataPoints,function(e){return e.categoryIndex===t});return null==i?void 0:i.formattedCategory.getValue()}})),(o=w.AxisHelper.createAxis(i)).axisLabel=l.data.axesLabels[e],t&&(o.axis.tickSizeInner(-l.availableHeight).tickSizeOuter(0),r)&&(o.categoryIdentities=l.data.categoryIdentities),o}var l=this,c=n.categoryAxisOptions,u=n.valueAxisOptions,d=(this.currentViewport=n.viewport,this.margin=n.margin,this.viewModelAdapterFactory&&this.originalData&&(this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=this.viewModelAdapter.getData()),{minY:0,maxY:10,formatStringY:void 0,formatStringX:void 0,minX:0,maxX:10}),h=(this.playAxis?(d=this.playAxis.getCartesianExtents(d,m.getExtents),this.playAxisControlLayout=n.playAxisControlLayout):_.isEmpty(this.data.dataPoints)||(d=m.getExtents(this.data)),this.getAxesDomains(!1,{categoryAxis:!this.isXAxisCategorical(),valueAxis:!0}));return this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),[this.xAxisProperties,this.yAxisProperties]},m.prototype.getAxesDomains=function(e,t){var i,a={},r=this.data;return r&&(i={minY:0,maxY:10,formatStringY:void 0,formatStringX:void 0,minX:0,maxX:10},this.playAxis?i=this.playAxis.getCartesianExtents(i,m.getExtents):_.isEmpty(r.dataPoints)||(i=m.getExtents(r)),t.categoryAxis&&!this.isXAxisCategorical()&&(a.categoryAxis=[i.minX,i.maxX]),t.valueAxis)&&(a.valueAxis=[i.minY,i.maxY]),a},m.prototype.setAxesLayout=function(e){},m.prototype.getCategoryLayout=function(e,t){return w.CartesianChartLayout.getLayout(void 0,{availableWidth:this.availableWidth,categoryCount:_.size(_.uniqBy(this.data.dataPoints,function(e){return e.categoryIndex})),preferredCategoryWidth:w.CartesianHelper.getPreferredCategoryWidth(w.CartesianHelper.getCategoryAxisProperties(this.dataView.metadata)),domain:e,isScalar:!this.isXAxisCategorical(),isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,outerPaddingRatio:t.outerPaddingRatio,innerPaddingRatio:t.innerPaddingRatio})},m.prototype.getPreferredPlotArea=function(e,t,i,a){return w.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,this.isScrollable,e,this.margin,a=void 0===a?0:a)},m.prototype.setFilteredData=function(i,a){var e;this.isXAxisCategorical()&&((e=this.data=x.Prototype.inherit(this.originalData)).dataPoints=_.filter(e.dataPoints,function(e){return e.categoryIndex>=i&&e.categoryIndex<a}),e.dataPointSeries=_.map(e.dataPointSeries,function(e){var t=x.Prototype.inherit(e),e=_.filter(e.dataPoints,function(e){return e.categoryIndex>=i&&e.categoryIndex<a});return t.dataPoints=e,t}))},m.prototype.overrideXScale=function(e){this.xAxisProperties=e},m.prototype.shouldSuppressAnimation=function(){return this.data&&this.data.dataPoints&&this.data.dataPoints.length>m.NoAnimationThreshold},m.prototype.render=function(e,t,i){var a,r,o,s,n,l,c,u,d,h,p,g;if(this.data)return this.playAxis&&!this.playAxis.isRendererInitialized()&&this.playAxis.initRenderer({svg:this.svg}),a=this.data,r=this.margin,o=this.currentViewport,s=this.interactivityService&&this.interactivityService.hasSelection(),l={width:o.width-(r.left+r.right),height:o.height-(r.top+r.bottom)},c=w.AnimatorCommon.GetAnimationDuration(this.animator,e),this.playAxis&&this.playAxis.isCurrentlyPlaying()&&(this.isMobileChart||0<c)&&(c=w.PlayChart.getFrameAnimationDuration()),d=this.playAxis?d3.easeLinear:d3.easeCubicInOut,g=this.data.hasSize,u=this.featureSwitches.fillPointStyle?a.fillPointStyle===w.fillStyle.fillOnly:a.fillPoint,u=!g&&u,t=1===t&&a.dataPoints&&a.dataPoints.length>m.NoRenderResizeThreshold,n=this.isXAxisCategorical(),l={data:a,allData:this.originalData,currentViewport:this.currentViewport,drawBubbles:g,isPlay:!!this.playAxis,hasCategoricalAxis:n,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,plotArea:l,hasSelection:s,animationDuration:c,animationOptions:this.animationOptions,fillMarkers:u,easeType:d,suppressDataPointRendering:t,supportsPlotAreaSymmetryShading:this.isPlotSymettryShadingSupported()},g&&!n&&(c=a.dataPoints.sort(m.sortBubbles),l.data=x.Prototype.inherit(l.data),l.data.dataPoints=c),u=[],(a.dataLabelsSettings&&a.dataLabelsSettings.show||a.dataLabelsSettings.showCategory)&&(u=y.createLabelDataPoints(l,this.style)),(d=this.renderer.render(l,this.interactivityService,this.hostService,this.style,i)).hitTester=new v({dataPoints:d.data.dataPoints,margin:this.margin}),this.isMobileChart&&(d={data:d.data,dataPointsSelection:d.dataPointsSelection,eventGroup:d.eventGroup,root:d.root,host:this.cartesianVisualHost,mobileRoot:this.svg,visualDataInitOptions:this.dataInitOptions,xAxisProperties:this.xAxisProperties,yAxisProperties:this.yAxisProperties,background:d3.select(this.element.get(0)),visualInstanceId:d.visualInstanceId,eventManager:d.eventManager}),this.playAxis&&(this.playAxisControlLayout,this.playAxis.setPlayControlPosition(this.playAxisControlLayout),h=this.playAxis.render(e,l,o,r),this.interactivityService)&&(t={traceLineRenderer:this.renderer.createTraceLineRenderer(h.viewModel)},s&&w.PlayChart.renderTraceLines(h.allDataPoints,t.traceLineRenderer,!e),d.playOptions=t),this.interactivityService&&(g=w.DataPointNavigationStrategy.SeriesFirst,n?g=w.DataPointNavigationStrategy.CategoryFirst:this.data.hasDynamicSeries||(g=w.DataPointNavigationStrategy.CategoryOnly),p={navigationStrategy:g,helper:this.renderer}),{dataPoints:h?h.allDataPoints:a.dataPoints,behaviorOptions:d,navigationOptions:p,labelDataPoints:u,labelsAreNumeric:!1,animateLabels:!0}},m.getStrokeFill=function(e,t){return null!=e.size&&(t=t&&a.parseColorString(e.fill))?a.hexString(a.darken(t,m.StrokeDarkenColorValue)):e.fill},m.getMarkerFillOpacity=function(e,t,i,a){return e||t?i&&!a?m.DimmedBubbleOpacity:m.DefaultBubbleOpacity:0},m.getMarkerStrokeOpacity=function(e,t,i,a){return e&&t?1:i&&!a?m.DimmedBubbleOpacity:m.DefaultBubbleOpacity},m.getMarkerStrokeFill=function(e,t,i){return e&&t&&(e=a.parseColorString(i))?a.hexString(a.darken(e,m.StrokeDarkenColorValue)):i},m.getMarkerStyle=function(e,t,i,a){return{"stroke-opacity":m.getMarkerStrokeOpacity(null!=e.size,t,i,e.selected),stroke:m.getMarkerStrokeFill(null!=e.size,t,e.fill),fill:e.fill,"fill-opacity":m.getMarkerFillOpacity(null!=e.size,a,i,e.selected)}},m.getSeriesStyle=function(e,t,i,a,r){return{"stroke-opacity":m.getMarkerStrokeOpacity(e,t,i,!1),stroke:null,fill:r,"fill-opacity":m.getMarkerFillOpacity(e,a,i,!1)}},m.getBubbleOpacity=function(e,t){return t&&!e.selected?m.DimmedBubbleOpacity:m.DefaultBubbleOpacity},m.prototype.getCategoryValueType=function(){var e=this.data.xCol;return w.AxisHelper.getCategoryValueType(e)},m.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},m.prototype.getSupportedCategoryAxisType=function(){return this.data.xGroupMetadata?this.data.xGroupMetadata.isScalarType?w.axisType.both:w.axisType.categorical:w.axisType.scalar},m.prototype.getVisualCategoryAxisIsScalar=function(){return!this.isXAxisCategorical()},m.sortBubbles=function(e,t){if(e.radius.sizeMeasure){var i=t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index];if(0!=i)return i}else if(null!=e.radius.value)return t.radius.value-e.radius.value;return t.identity.getKey().localeCompare(e.identity.getKey())},m.prototype.getSubSelectionMetadata=function(e){return{visualObject:e}},m.onMarkerSubSelection=function(e){var t=e.element,i=e.series,a=e.subSelectionHelper,r=e.d3Event,o=e.hostServices,e=e.showUI,s=null==(s=i.identity)?void 0:s.getSelectorsByColumn(),o=o.getLocalizedString("MiniToolbar_Markers",i.name),i={x:r.clientX,y:r.clientY,offset:15},r=a.createVisualSubSelectionForSingleObject(__assign({objectName:"markers",subSelectionType:3,displayName:o,showUI:e,selectorsByColumn:s,selectionOrigin:i},t?{metadata:{visualObject:t}}:{}));a.subSelect(r)},m.prototype.getSubSelectionShortcuts=function(e){e=_.first(e).visualObjects;if(0<e.length){var t,e=e[0];switch(_.isEmpty(e.selectorsByColumn)||(t=c.normalizeSelector(c.convertSelectorsByColumnToSelector(e.selectorsByColumn))),e.objectName){case"markers":var i="".concat("Visual","-").concat("categoryLabels");return[{type:0,excludedResetSourceUids:[{sourceUid:i}]},{type:2,sourceUid:i,enabledLabel:this.hostService.getLocalizedString("Visual_Add_CategoryLabel")},{type:3,sourceUid:"".concat("markers","-").concat("applySettingsTo","-series--").concat("shape","-markerShape"),label:this.hostService.getLocalizedString("Visual_MarkerShape"),selector:t},{type:3,sourceUid:"".concat("markers","-").concat("applySettingsTo","-series--").concat("shape","-fillStyle"),label:this.hostService.getLocalizedString("Visual_MarkerStyle"),selector:void 0},{type:1,destinationUids:[{cardUid:"".concat("Visual","-").concat("markers")}],label:this.hostService.getLocalizedString("Format_Markers")}];case"category-labels":i="".concat("Visual","-").concat("categoryLabels");return[{type:0,relatedResetSourceUids:[{sourceUid:"".concat("categoryLabels","-").concat("background","-show")}],excludedResetSourceUids:[{sourceUid:i}]},{type:1,destinationUids:[{cardUid:i,groupUid:"".concat("categoryLabels","-").concat("values")}],label:this.hostService.getLocalizedString("Format_Category_Labels")}];default:return}}},m.prototype.getSubSelectionStyles=function(e){var e=_.first(e).visualObjects;if(0<e.length){(e=e[0])&&e.selectorsByColumn&&(l=c.normalizeSelector(c.convertSelectorsByColumnToSelector(e.selectorsByColumn)));var t=this.originalData.fillPointStyle.includes("Fill"),i=1===this.data.dataPointSeries.length;switch(e.objectName){case"markers":var a="".concat("Visual","-").concat("markers"),r="".concat("markers","-").concat("colors"),o="".concat("markers","-").concat("colors","-datapoint"),s="".concat("markers","-").concat("colors","-defaultColor"),n={data:[x.data.DataViewWildcard.create(1)]},l=i?n:l;return w.OnObjectUtil.getShapeSubSelectionStyles(a,r,i?s:o,this.hostService,!t,t,l);case"category-labels":n="".concat("Visual","-").concat("categoryLabels"),a="".concat("categoryLabels","-").concat("values"),r={cardUid:n,groupUid:a,sliceUid:"".concat(a,"-font")},s={cardUid:n,groupUid:a,sliceUid:"".concat(a,"-color")},o={cardUid:n,groupUid:a,sliceUid:"".concat("categoryLabels","-background-color")};return w.OnObjectUtil.getFontOnlyTextSubSelectionStyles(this.hostService,{fontReference:r,fontColorReference:s,backgroundReference:o},void 0);case"data-labels":return w.OnObjectUtil.getDataLabelsSubSelectionStyles({hostServices:this.hostService,omitSelectorForSingleSeries:i,individualSelector:!1,selector:l,repetitionSelector:void 0,inContainer:!0});default:return}}},m.prototype.getDataViewObjectLayerChanges=function(e){var t,i;return this.featureSwitches.onObject?(t=1===this.data.dataPointSeries.length,i=w.DataViewObjectChangeHelper.createToggleTurnOnAction,t=t?void 0:e[0].selector,i=i({objectName:"categoryLabels",propertyName:"backgroundColor"},this.data.dataLabelsSettings.enableBackground,[{type:0,visualChangeObject:__assign(__assign({objectName:"categoryLabels"},{propertyName:"enableBackground",propertyValue:!0,propertyType:{bool:!0}}),t?{selector:t}:{})}]),w.DataViewObjectChangeHelper.getDataViewObjectsBehaviorChanges(e,[i])):[]},m.prototype.getSubSelectionCustomOutlines=function(e){for(var t=e.metadata,i=[],a=0,r=e.visualObjects;a<r.length;a++){var o=r[a].objectName,s=null==t?void 0:t.visualObject;if(s&&"markers"===o){o=d3.select(s).datum(),o=this.data.dataPointSeries[o.seriesIndex];if(o.dataPoints.length<=w.MARKERS_MAX_COUNT_THRESHOLD)return this.getSubselectionDefaultOutlines(o);var n=this.currentViewport.scale,n=this.getGroupBoundingRect(o.dataPoints,n,this.renderer.mainGraphicsContext),s=s.getBoundingClientRect(),l=Math.max(s.height,w.MIN_OUTLINE_SIZE),c=Math.max(s.width,w.MIN_OUTLINE_SIZE),s={x:s.x,y:s.y,height:l,width:c},l=o.identityKey;i.push(m.getMarkerOutlinesForSeries({rectangles:[n,s],identityKey:l}))}}return i},m.prototype.getSubselectionDefaultOutlines=function(e){var t=[],i=this.renderer.mainGraphicsContext,a=this.currentViewport.scale,r=i.node().getBoundingClientRect(),o=r.left,s=r.top,r=i.node().getBBox(),n=r.x,l=r.y,i=e.dataPoints.map(function(e){var t=Math.max(2*e.geometry.size*a,w.MIN_OUTLINE_SIZE);return{x:(e.geometry.x-n)*a-t/2+o,y:(e.geometry.y-l)*a-t/2+s,width:t,height:t,type:1}}),r=e.identityKey;return t.push({id:r,outline:{type:0,outlines:i}}),t},m.getMarkerOutlinesForSeries=function(e){for(var t=e.rectangles,e=e.identityKey,i=[],a=0,r=t;a<r.length;a++){var o=r[a];i.push({x:o.x,y:o.y,width:o.width,height:o.height,type:1})}return{id:e,outline:{type:0,outlines:i}}},m.prototype.getGroupBoundingRect=function(e,t,i){var r,a=i.node().getBoundingClientRect(),o=a.left,a=a.top,i=i.node().getBBox(),s=i.x,i=i.y,e=e.reduce(function(e,t){var t=(r=t.geometry).size,i=r.x,a=r.y;return e.xMin=Math.min(i-t,e.xMin),e.yMin=Math.min(a-t,e.yMin),e.xMax=Math.max(i+t,e.xMax),e.yMax=Math.max(a+t,e.yMax),e},{xMin:Number.MAX_SAFE_INTEGER,yMin:Number.MAX_SAFE_INTEGER,xMax:Number.MIN_SAFE_INTEGER,yMax:Number.MIN_SAFE_INTEGER}),n=e.xMin,l=e.yMin,c=e.xMax,e=e.yMax,c=(c-n)*t,e=Math.round(10+(e-l)*t),c=Math.round(10+c),n=(n-s)*t,s=Math.ceil((l-i)*t-5+a);return{x:Math.ceil(n-5+o),y:s,height:e,width:c}},m.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},m.prototype.getStaticSeriesRole=function(){},m.prototype.addWarnings=function(e){var t;null!=(t=this.viewModelAdapter)&&t.addWarnings(e)},m.prototype.isXAxisCategorical=function(){var e;return null==(e=null==(e=this.data)?void 0:e.xGroupMetadata)?void 0:e.isCategoricalAxis},m.prototype.isPlotSymettryShadingSupported=function(){var e;return this.featureSwitches.logAxisScale?!this.isXAxisCategorical()&&!0!==(null==(e=this.valueAxisProperties)?void 0:e.logAxisScale)&&(!1===(null==(e=this.categoryAxisProperties)?void 0:e.logAxisScale)||null==(null==(e=this.categoryAxisProperties)?void 0:e.logAxisScale)&&(null==(e=this.categoryAxisProperties)?void 0:e.axisScale)!==x.visuals.axisScale.log):!this.isXAxisCategorical()&&(null==(e=this.valueAxisProperties)?void 0:e.axisScale)!==x.visuals.axisScale.log&&(null==(e=this.categoryAxisProperties)?void 0:e.axisScale)!==x.visuals.axisScale.log},m.prototype.getSelectorsByColumnFromSubselectedElement=function(e){switch(d3.select(e).attr(w.SubSelectableObjectNameAttribute)){case"markers":case"category-labels":var t=d3.select(e).datum(),t=this.data.dataPointSeries[t.seriesIndex],t=null==(t=null==t?void 0:t.identity)?void 0:t.getSelectorsByColumn();if(t)return t;break;default:return}},m.DefaultBubbleOpacity=.85,m.DimmedBubbleOpacity=.4,m.StrokeDarkenColorValue=63.75,m.ClassName="scatterChart",m.NoAnimationThreshold=1e3,m.NoRenderResizeThreshold=1e3,m.DefaultDataVolume=3500,m.MaximumDataVolume=1e4,m.DefaultZeroScalarDomain=[-1,1],m.DefaultPlotAreaShadingSettings={show:!1,upperShadingColor:null,lowerShadingColor:null,transparency:70},m);function m(e){e&&(this.tooltipsEnabled=e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.playAxisDataColorsEnabled=e.featureSwitches.playAxisDataColors,this.viewModelAdapterFactory=e.viewModelAdapterFactory,this.isScrollable=e.isScrollable),this.renderer=x.scatterChartRendererModuleFactory().create()}w.ScatterChart=e,C=[2,1,8,4,16,32,64,128],(y=y||{}).createLabelDataPoints=function(e,t){for(var i,a,r,o,s=e.xAxisProperties.scale,n=e.yAxisProperties.scale,l=e.data.sizeRange,c=e.data.multiplier,u=[],d=e.data.dataPoints,h=e.data.dataLabelsSettings,p=(a=(i=e).plotArea.width,r=i.plotArea.height,o=new w.Point(a/2,r/2),a=function(e,t){var i=[],e=e/4,t=t/4;return i.push(new w.Point(e,t)),i.push(new w.Point(3*e,t)),i.push(new w.Point(e,3*t)),i.push(new w.Point(3*e,3*t)),i}(a,r),function(e,t,i){for(var a=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],r=[],o=i.xAxisProperties.scale,s=i.yAxisProperties.scale,n=0,l=i.data.dataPoints;n<l.length;n++){var c=l[n],u=o(c.x),d=s(c.y),h=function(e,t,i){if(e>i.x&&t<=i.y)return 0;if(e<=i.x&&t<=i.y)return 1;return e<=i.x&&t>i.y?2:3}(u,d,e);i.drawBubbles?r[h]||(r[h]=c.identity):(u=function(e,t,i,a){return Math.sqrt((e-i)*(e-i)+(t-a)*(t-a))}(t[h].x,t[h].y,u,d))<a[h]&&(r[h]=c.identity,a[h]=u)}for(var p=[],g=0,y=r;g<y.length;g++){var m=y[g];m&&p.push(m.getKey())}return p}(o,a,i)),g=0,y=d;g<y.length;g++){var m=y[g],v=m.formattedCategory.getValue(),S=h.fontProperties,f=w.FontProperties.toTextProperties(S,v),b=x.TextMeasurementService.measureSvgTextWidth(f),f=x.TextMeasurementService.estimateSvgTextHeight(f);u.push({isPreferred:!!p&&function(e,t){for(var i=0,a=t;i<a.length;i++){var r=a[i];if(0===e.localeCompare(r))return!0}return!1}(m.identity.getKey(),p),text:v,textSize:{width:b,height:f},outsideFill:S.color||w.ColorHelper.getThemeColor(t,w.DataLabelViewModel.DefaultLabelColorName),insideFill:w.ColorHelper.getThemeColor(t,w.DataLabelViewModel.DefaultInsideLabelColorName),parentType:0,parentShape:{point:{x:s(m.x),y:n(m.y)},radius:w.CartesianHelper.getBubbleRadius(m.radius,l,e.plotArea,c),validPositions:C},identity:m.renderIdentity,fontProperties:S,hasBackground:h.enableBackground,backgroundColor:h.backgroundColor,backgroundTransparency:h.backgroundTransparency,isCategory:!0})}return u},t.prototype.queryRegion=function(e){var i=this,a=w.extractBoundingRectFromLasso(e,!1);return this.adjustPositionRelativeToRoot(a),_.filter(this.dataPoints,function(e){if(void 0===e.size)return i.isPointInRect(a,e.geometry);var t=void 0;switch(e.geometry.markerShape){case w.markerShape.circle:t=w.shapes.Polygon.circleRectangleOverlap(a,{x:e.geometry.x,y:e.geometry.y},e.geometry.size);break;case w.markerShape.square:t=i.isSquareMarkerIntersect(e.geometry,a);break;case w.markerShape.diamond:t=i.isDiamondMarkerIntersect(e.geometry,a);break;case w.markerShape.triangle:t=i.isTriangleMarkerIntersect(e.geometry,a);break;default:t=!1}return t})},t.prototype.isSquareMarkerIntersect=function(e,t){e={left:e.x-e.size,right:e.x+e.size,top:e.y-e.size,bottom:e.y+e.size};return w.shapes.Rect.overlappingRange(e.left,e.right,t.left,t.right)&&w.shapes.Rect.overlappingRange(e.top,e.bottom,t.top,t.bottom)},t.prototype.isDiamondMarkerIntersect=function(e,t){if(!this.isSquareMarkerIntersect(e,t))return!1;if(this.isPointInRect(t,e))return!0;for(var i=[{x:e.x-e.size,y:e.y},{x:e.x,y:e.y-e.size},{x:e.x+e.size,y:e.y},{x:e.x,y:e.y+e.size}],a=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom}],r=[[a[0],a[1]],[a[1],a[2]],[a[3],a[2]],[a[0],a[3]]],o=0,s=[[i[0],i[1]],[i[1],i[2]],[i[0],i[3]],[i[3],i[2]]];o<s.length;o++)for(var n=s[o],l=0,c=r;l<c.length;l++){var u=c[l];if(w.shapes.Polygon.linesIntersect(n[0],n[1],u[0],u[1],!1))return!0}return this.isLassoInShape(e,t)},t.prototype.isPointInRect=function(e,t){return x.Double.lessOrEqualWithPrecision(e.left,t.x)&&x.Double.lessOrEqualWithPrecision(t.x,e.right)&&x.Double.lessOrEqualWithPrecision(e.top,t.y)&&x.Double.lessOrEqualWithPrecision(t.y,e.bottom)},t.prototype.isLassoInShape=function(e,t){e={left:e.x-e.size,right:e.x+e.size,top:e.y-e.size,bottom:e.y+e.size};return w.shapes.Rect.overlappingRange(t.left,t.right,e.left,e.right)&&w.shapes.Rect.overlappingRange(t.top,t.bottom,e.top,e.bottom)},t.prototype.isTriangleMarkerIntersect=function(e,t){if(!this.isSquareMarkerIntersect(e,t))return!1;if(this.isPointInRect(t,e))return!0;for(var i=[{x:e.x-e.size,y:e.y+e.size},{x:e.x,y:e.y-e.size},{x:e.x+e.size,y:e.y+e.size}],a=[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom}],r=[[a[0],a[1]],[a[1],a[2]],[a[3],a[2]],[a[0],a[3]]],o=0,s=[[i[0],i[1]],[i[1],i[2]],[i[0],i[2]]];o<s.length;o++)for(var n=s[o],l=0,c=r;l<c.length;l++){var u=c[l];if(w.shapes.Polygon.linesIntersect(n[0],n[1],u[0],u[1],!1))return!0}return this.isLassoInShape(e,t)},t.prototype.adjustPositionRelativeToRoot=function(e){e.left-=this.margin.left,e.top-=this.margin.top,e.right-=this.margin.left,e.bottom-=this.margin.top};var v=t;function t(e){this.dataPoints=e.dataPoints,this.margin=e.margin}w.ScatterChartHitTester=v}(powerbi=powerbi||{}),function(e){var u=e.visuals||(e.visuals={}),a=jsCommon.BrowserUtils,e=jsCommon.CssConstants.createClassAndSelector,t=jsCommon.PerfTimer;function i(){}i.prototype.create=function(){return new r},u.ScatterChartWebBehaviorFactory=i,o.prototype.bindEvents=function(i,a,e,t){var r,o,s=this.bubbles=i.dataPointsSelection,n=i.data,l=i.eventGroup,n=(!this.playOptions||!this.playOptions.traceLineRenderer||i.playOptions&&i.playOptions.traceLineRenderer||this.playOptions.traceLineRenderer.remove(),this.playOptions=i.playOptions,this.shouldEnableFill=i.fillMarkers,this.colorBorder=n.colorBorder,this.hitTester=i.hitTester,this.rootSelection=i.root),c=this.visualInstanceId=i.visualInstanceId;e&&(r=e.dataPointNavigationManager,o=e.pointSourceKey),u.InteractivityUtils.appendUseElementForFocus(n,c,o),this.selectionHandler=a,t?(l?u.InteractivityUtils.removeGroupSelectionHandler(i.eventManager,l):u.InteractivityUtils.removeStandardInteractivityHandlers(s),s.on("contextmenu",function(e){var t=d3.event;i.onMarkerSubSelection(this,e,a.getSubSelectionHelper(),t,!0),u.EventBubblingUtil.markAsHandled(t)}),s.on("click",function(e){var t=d3.event;i.onMarkerSubSelection(this,e,a.getSubSelectionHelper(),t,!1),u.EventBubblingUtil.markAsHandled(t)})):l?u.InteractivityUtils.registerGroupInteractivityHandlers(i.eventManager,l,a):u.InteractivityUtils.registerStandardInteractivityHandlers(s,a),r&&!r.isEmpty(o)&&(u.InteractivityUtils.registerEnterPlotAreaHandler(n,r,o),u.InteractivityUtils.registerDataPointNavigationHandler(n,r,o),u.InteractivityUtils.registerClearCatcherShortcut(n,a))},o.prototype.renderSelection=function(t){var e,i,a=this.shouldEnableFill,r=this.colorBorder;this.bubbles.styles({"fill-opacity":function(e){return u.ScatterChart.getMarkerFillOpacity(null!=e.size,a,t,e.selected)},"stroke-opacity":function(e){return u.ScatterChart.getMarkerStrokeOpacity(null!=e.size,r,t,e.selected)}}),this.playOptions&&this.bubbles&&(e=this.bubbles.filter(function(e){return e.selected}).data(),i=this.playOptions.traceLineRenderer,e&&0<e.length&&null!=i?i.render(e,!0):i.remove())},o.prototype.renderFocus=function(e){var t,i=u.CurrentFocusDataPointId+"-"+this.visualInstanceId;this.rootSelection.select("#"+i).attr("id",null),e&&(this.bubbles.attr("aria-label",null),(t=d3.select(e).datum())&&e.setAttribute("aria-label",u.tooltipUtils.formatTooltipInfo(t.tooltipInfo())),e.setAttribute("id",i),a.focus(e))},o.prototype.lassoSelectRectLayer=function(e){return this.hitTester.queryRegion(e)},o.prototype.getLassoSelectDirectionMode=function(){return 1};var r=o;function o(){}function s(){}u.ScatterChartWebBehavior=r,s.prototype.create=function(){return new n},u.ScatterChartMobileBehaviorFactory=s,l.prototype.bindEvents=function(e,t,i){this.setOptions(e),e.visualDataInitOptions&&e.visualDataInitOptions.interactivity.isInteractiveLegend&&(this.makeDataPointsSelectable(e.dataPointsSelection),this.makeRootSelectable(e.mobileRoot),this.makeDragable(e.mobileRoot),this.disableDefaultTouchInteractions(e.mobileRoot),this.selectRoot())},l.prototype.renderSelection=function(e){},l.prototype.setSelectionHandler=function(e){},l.prototype.makeDataPointsSelectable=function(){for(var i=this,e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var a=0,r=e.length;a<r;a++)e[a].on("click",function(e,t){i.select(t)})},l.prototype.makeRootSelectable=function(e){var i=this;e.on("click",function(e,t){i.selectRoot()})},l.prototype.makeDragable=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(var a=0,r=e.length;a<r;a++){var o=e[a],s=d3.drag().on("drag",function(e){t.drag(0)}).on("end",function(e){t.drag(1)});o.call(s)}},l.prototype.disableDefaultTouchInteractions=function(e){e.style("touch-action","none")},l.prototype.setOptions=function(e){this.data=e.data,this.mainGraphicsContext=e.root,this.xAxisProperties=e.xAxisProperties,this.yAxisProperties=e.yAxisProperties,this.host=e.host},l.prototype.select=function(e){this.selectDotByIndex(e)},l.prototype.selectRoot=function(){var e=t.start("selectRoot");this.onClick(),e()},l.prototype.drag=function(e){switch(e){case 0:this.onDrag();break;case 1:this.onClick()}},l.prototype.onDrag=function(){var e=this.getMouseCoordinates(),e=(this.moveCrosshairToXY(e.x,e.y),this.findClosestDotIndex(e.x,e.y));this.selectDot(e),this.updateLegend(e)},l.prototype.onClick=function(){var e=this.getMouseCoordinates(),e=this.findClosestDotIndex(e.x,e.y);-1!==e&&this.selectDotByIndex(e)},l.prototype.getMouseCoordinates=function(){var e=this.mainGraphicsContext,t=0;a=(a=parseInt(e.attr("height"),10))||0;try{var i=d3.mouse(e.node()),t=i[0],a=i[1]}catch(e){}return{x:t,y:a}},l.prototype.selectDotByIndex=function(e){this.selectDot(e),this.moveCrosshairToIndexDot(e),this.updateLegend(e)},l.prototype.selectDot=function(a){var r=this,e=this.mainGraphicsContext;e.selectAll(l.ScatterMarker.selector).classed("selected",!1).classed("notSelected",!0),e.selectAll(l.ScatterMarker.selector).filter(function(e,t){var i=r.data.dataPoints,i=(i.length,i.length,i[a]);return e.x===i.x&&e.y===i.y}).classed("selected",!0).classed("notSelected",!1)},l.prototype.moveCrosshairToIndexDot=function(e){var t,i=this.data.dataPoints,a=this.mainGraphicsContext,r=(i.length,i.length,this.xAxisProperties.scale(i[e].x)),i=this.yAxisProperties.scale(i[e].y);null==this.crosshair?(e=+a.attr("width"),t=+a.attr("height"),this.crosshair=this.drawCrosshair(a,r,i,e,t),this.crosshairHorizontal=this.crosshair.select(l.Horizontal.selector),this.crosshairVertical=this.crosshair.select(l.Vertical.selector)):this.moveCrosshairToXY(r,i)},l.prototype.moveCrosshairToXY=function(e,t){this.crosshairHorizontal.attrs({y1:t,y2:t}),this.crosshairVertical.attrs({x1:e,x2:e})},l.prototype.drawCrosshair=function(e,t,i,a,r){e=e.append("g");return e.classed(l.CrosshairClassName,!0),e.append("line").classed(l.Horizontal.class,!0).attrs({x1:0,x2:a,y1:i,y2:i}),e.append("line").classed(l.Vertical.class,!0).attrs({x1:t,x2:t,y1:r,y2:0}),e},l.prototype.findClosestDotIndex=function(e,t){var i,a=-1,r=Number.MAX_VALUE,o=this.data.dataPoints,s=this.xAxisProperties.scale,n=this.yAxisProperties.scale;for(i in o){var l=o[i],c=s(l.x)-e,l=n(l.y)-t,c=c*c+l*l;(r===Number.MAX_VALUE||r&&c<r)&&(a=i,r=c)}return a},l.prototype.updateLegend=function(e){var t;null!=this.lastDotIndex&&this.lastDotIndex===e||(t=this.createLegendDataPoints(e),this.host.updateLegend(t),this.lastDotIndex=e)},l.prototype.createLegendDataPoints=function(e){var t=u.scatterChartProps.general.formatString,i=[],a=this.data,r=(a.dataPoints.length,a.dataPoints.length,a.dataPoints[e]),o=u.valueFormatter.format(null),s=o,n=a.legendData,n=(n.dataPoints,n.dataPoints),l=r.formattedCategory.getValue(),l=(l!==o?(s=l,null!=r&&null!=r.radius&&null!=r.radius.sizeMeasure&&(s+="; "+u.valueFormatter.format(r.radius.sizeMeasure.source.groupName))):null!=r.radius.sizeMeasure?s=u.valueFormatter.format(r.radius.sizeMeasure.source.groupName):0<n.length&&n.length>=e&&n[e].label!==o&&(s=n[e].label),null!=a.xCol&&i.push({category:s,color:r.fill,identity:u.SelectionIdBuilder.builder().withMeasure(a.xCol.queryName).createSelectionId(),selected:r.selected,icon:u.LegendIcon.Box,label:u.valueFormatter.format(this.data.axesLabels.x),measure:u.valueFormatter.format(r.x,u.valueFormatter.getFormatString(a.xCol,t)),iconOnlyOnLabel:!0,index:0}),null!=a.yCol&&i.push({category:s,color:r.fill,identity:u.SelectionIdBuilder.builder().withMeasure(a.yCol.queryName).createSelectionId(),selected:r.selected,icon:u.LegendIcon.Box,label:u.valueFormatter.format(a.axesLabels.y),measure:u.valueFormatter.format(r.y,u.valueFormatter.getFormatString(a.yCol,t)),iconOnlyOnLabel:!0,index:1}),null!=a.size&&i.push({category:s,color:r.fill,identity:u.SelectionIdBuilder.builder().withMeasure(a.size.queryName).createSelectionId(),selected:r.selected,icon:u.LegendIcon.Box,label:u.valueFormatter.format(a.size.displayName),measure:u.valueFormatter.format(r.radius.sizeMeasure&&r.radius.sizeMeasure.values[r.radius.index]||r.radius.value,u.valueFormatter.getFormatString(a.size,t)),iconOnlyOnLabel:!0,index:2}),u.Legend.getDefaultLegendData());return l.dataPoints=i,l},l.CrosshairClassName="crosshair",l.ScatterMarker=e("scatterMarker"),l.Horizontal=e("horizontal"),l.Vertical=e("vertical");var n=l;function l(){}u.ScatterChartMobileBehavior=n}(powerbi=powerbi||{}),function(T){var F,d,e,t,y,m;function I(e){this.isScrollable=e.isScrollable,this.tooltipsEnabled=null==e.tooltipsEnabled||e.tooltipsEnabled,this.interactivityService=e.interactivityService,this.featureSwitch=e.featureSwitches,this.viewModelAdapterFactory=e.viewModelAdapterFactory}F=T.visuals||(T.visuals={}),d=F.builder,e=jsCommon.CssConstants.createClassAndSelector,t=F.labelPosition,y=jsCommon.Lazy,m=jsCommon.StringExtensions,I.prototype.initData=function(e){this.style=e.style,this.currentViewport=e.viewport,this.hostServices=e.host,this.tooltipService=e.services.tooltips,this.animationOptions=e.animation},I.prototype.initRenderer=function(e){this.svg=e.svg,this.svg.classed(I.WaterfallClassName,!0),this.mainGraphicsSVG=this.svg.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVG.append("g").classed(I.MainGraphicsContextClassName,!0),this.interactivityService&&(e=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attrs({tabindex:0,focusable:!0,role:"listbox","aria-multiselectable":!0,"aria-label":this.hostServices.getLocalizedString("Visual_Plot")}).classed(F.SetFocusRingClassName,!e))},I.converter=function(e){var t=e.dataView;if(t)return t.categorical?I.categoricalConverter(e):t.matrix?T.waterfallConverterModuleFactory().matrixConverter(e):void 0},I.categoricalConverter=function(e){var l,c,t,i=e.dataView,u=e.hostServices,d=e.dataLabelSettings,h=e.sentimentColors,a=e.interactivityService,p=e.tooltipsEnabled,g=I.formatStringProp,y=T.data.createDataViewCategoricalReaderAdvanced(i,{formatStringProp:g}),m=y.data,r=T.DataViewObjects.getValue(y.objects.getStaticObjects(),F.cartesianChartProps.valueAxis.totalsEnabled,I.DefaultTotalsEnabled),o=(m.hasValues("Breakdown")&&(r=I.DefaultTotalsEnabled),i.categorical.categories||[]),s=u.getLocalizedString(I.TotalLabel),n=I.createLegend(h,u,y.objects.getStaticObjects(),e.style,void 0,r),v={current:0,min:0,max:0,formatString:void 0},S=[],f=[],b=[],x=[];if(m.hasValues("Tooltips")&&(c=y.columns.getAllValueMetadataColumnsForRole("Tooltips",void 0)),m.hasValues("Y")){var C=(x=[y.columns.getValueMetadataColumn("Y")])[0].format;if(_.isEmpty(o))var w=m.getValue("Y",0),v={current:w,max:w,min:0,formatString:m.getFormatString("Y",0)};else{var D=o[0],A=D.source;(f=D.values.slice()).push(s);for(var P=null!=(w=i.categorical.originalCategories)?w:[D],L=d.fontProperties.color,M=0,V=m.getCategoryCount();M<V;M++)!function(e){var t=f[e],i=m.getValue("Y",e)||0,a=m.getFormatString("Y",e),r=(void 0!==a&&void 0===C&&(C=a),F.SelectionIdBuilder.builder().withCategory(P,e,null==(l=null==D?void 0:D.source)?void 0:l.queryName,!0).withMeasure(x[0].queryName,y.columns.getValueColumn("Y"),e).createSelectionId()),o=void 0,s=(p&&(o=I.createCategoryTooltip(A?[A]:null,x[0],[t],i,a,g),s=m.getAllValuesForRole("Tooltips",e),n=m.getAllFormatStringsForRole("Tooltips",e),s)&&c&&I.appendTooltipMeasures(s,n,o,c,g,u),F.DataLabelUtil.determineDataLabelFillColor({defaultColor:L,categoricalDataReader:y,categoryIndex:e})),n=F.DataLabelUtil.isAssignedColor(s)?s.color:L;d.fontProperties=F.DataLabelUtil.updateFontPropertiesColor(n,d.fontProperties),S.push(I.createDataPoint(i,v.current,h,t,e,r,o,s.color,a||C,0)),b[e]=function(){return F.CartesianHelper.getCategoryIdentity(e,D)},v=I.getNewPositionContext(v,i)}(M)}o=void 0,w=(p&&(o=I.createCategoryTooltip(A?[A]:null,x[0],[s],v.current,void 0,g)),F.SelectionId.createNull());r&&S.push(I.createDataPoint(v.current,0,h,s,m.getCategoryCount(),w,o,d.fontProperties.color,C,1,{text:!0}))}a&&a.applySelectionStateToData(S),e.style.isHighContrast&&(t={visible:!0,color:F.ColorHelper.getThemeColor(e.style,F.ForegroundColorName),width:F.CartesianHelper.defaultLineStrokeWidth});r=F.CartesianHelper.getCategoryAxisProperties(i.metadata,void 0),s=F.CartesianHelper.getPreferredCategoryWidth(r);return{series:[{data:S,type:!_.isEmpty(x)&&x[0].type}],categories:f,categoryIdentities:b,categoryMetadata:A,preferredCategoryWidth:s,valuesMetadata:x,legend:n,hasHighlights:!1,positionMin:v.min,positionMax:v.max,dataLabelsSettings:d,sentimentColors:h,strokeSettings:t}},I.createDataPoint=function(e,t,i,a,r,o,s,n,l,c,u){i=1===c||2===c?i.totalFill:3===c?i.otherFill:0<e?i.increaseFill:i.decreaseFill;return{value:e,position:t,color:i.solid.color,categoryValue:a,categoryIndex:r,identity:o,seriesIndex:0,selected:!1,highlight:!1,key:o.getKey(),tooltipInfo:s&&function(){return s.getTooltipItems()},labelFill:n,labelFormatString:l,type:T.ValueType.fromDescriptor(u),barType:c}},I.createCategoryTooltip=function(i,e,t,a,r,o){var s=new F.LazyTooltipBuilder;return _.isEmpty(i)||s.withLazyValue(new y(function(){return{displayName:_.map(i,function(e){return e.displayName}).join(" "),value:_.map(t,function(e,t){return F.converterHelper.formatFromMetadataColumn(e,i[t],o)}).join(" ")}})),null!=a&&e&&s.withLazyValue(new y(function(){return{displayName:e.displayName,value:F.converterHelper.formatFromMetadataColumn(a,e,o,!1,r)}})),s},I.appendTooltipMeasures=function(s,n,l,c,u,d,h,p,g){if(!_.isEmpty(s)&&!_.isEmpty(c))for(var e=0;e<s.length;e++)!function(e){var t,i,a,r,o;null!=s[e]&&c[e]&&(t=c[e].displayName,i=F.converterHelper.formatFromMetadataColumn(s[e],c[e],u,!1,null==n?void 0:n[e]),_.isEmpty(h)?l.withLazyValue(new y(function(){return{displayName:t,value:i}})):(a=s[e],r=h[e],_.isNumber(a)&&_.isNumber(r)?(t=m.format(d.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),t),i=I.createPercentTooltipValue(i,a,r),l.withLazyValue(new y(function(){return{displayName:t,value:i}}))):(null!=r&&(o=F.converterHelper.formatFromMetadataColumn(r,c[e],u,!1),l.withLazyValue(new y(function(){return{displayName:"".concat(g," ").concat(t),value:o}}))),null!=a&&l.withLazyValue(new y(function(){return{displayName:"".concat(p," ").concat(t),value:i}})))))}(e)},I.createPercentTooltipValue=function(e,t,i){return i?(t=t/Math.abs(i),i=F.valueFormatter.getLocalizedString("Percentage"),t=F.valueFormatter.format(t,i),"".concat(e," (").concat(t,")")):e},I.createLegend=function(e,t,i,a,r,o){var s=e.increaseFill.solid.color,n=e.decreaseFill.solid.color,l=e.totalFill.solid.color,e=e.otherFill.solid.color,c=t.getLocalizedString(I.TotalLabel),u=t.getLocalizedString(I.IncreaseLabel),d=t.getLocalizedString(I.DecreaseLabel),t=t.getLocalizedString(I.OtherLabel),u=[{label:u,color:s,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("increase").createSelectionId(),selected:!1,index:0},{label:d,color:n,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("decrease").createSelectionId(),selected:!1,index:1}];return o&&u.push({label:c,color:l,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("total").createSelectionId(),selected:!1,index:2}),r&&u.splice(2,0,{label:t,color:e,icon:F.LegendIcon.Box,identity:F.SelectionIdBuilder.builder().withMeasure("other").createSelectionId(),selected:!1,index:3}),F.LegendData.create(i,u,!0,"",!1,a)},I.getNewPositionContext=function(e,t){t=e.current+t;return{current:t,min:Math.min(e.min,t),max:Math.max(e.max,t)}},I.getDefaultWaterfallLabelSettings=function(e,t,i,a){void 0===t&&(t=!1);e=F.DataLabelViewModel.getDefaultLabelSettings({style:e,textClassName:"smallLightLabel",labelColor:i,fontSize:a}).fontProperties;return{show:t,labelOrientation:1,position:F.labelPosition.auto,displayUnits:0,precision:F.DataLabelViewModel.defaultLabelPrecision,fontProperties:e,enableBackground:!1,bold:!1,italic:!1,underline:!1}},I.doesDataLabelFitInShape=function(e,t,i){var a,r;return null!=e&&null!==e.value&&(r={text:i.labelText(e),fontFamily:F.DataLabelViewModel.LabelTextProperties.fontFamily,fontSize:F.DataLabelViewModel.LabelTextProperties.fontSize,fontWeight:F.DataLabelViewModel.LabelTextProperties.fontWeight},0<F.CartesianHelper.getRectTop(t.scale,e.position,e.value)-F.DataLabelViewModel.labelMargin||(a=T.TextMeasurementService.measureSvgTextWidth(r),r=T.TextMeasurementService.estimateSvgTextHeight(r),i=i.categoryWidth,t=Math.abs(F.AxisHelper.diffScaled(t.scale,Math.max(0,Math.abs(e.value)),0)),!(i<a||t<r)))},I.prototype.setData=function(e){var t,i,a=this.getSentimentColorsFromObjects(null),r=I.DefaultBreakdowns,e=0<e.length?e[0]:void 0;this.data=this.originalData={series:[{data:[]}],categories:[],valuesMetadata:[],legend:F.Legend.getDefaultLegendData(this.style),hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,positionMax:0,positionMin:0,dataLabelsSettings:I.getDefaultWaterfallLabelSettings(this.style,!1,void 0),sentimentColors:a,axesLabels:{x:null,y:null},numberOfBreakdowns:r,totalBreakdownCategories:0},e&&((this.dataView=e).metadata&&e.metadata.objects&&((i=(t=e.metadata.objects).labels)&&F.DataLabelViewModel.updateLabelSettingsFromLabelsObject(i,this.data.dataLabelsSettings,!0,this.style),a=this.getSentimentColorsFromObjects(t),r=T.DataViewObjects.getValue(t,F.waterfallChartProps.breakdown.maxBreakdowns,I.DefaultBreakdowns)),e.categorical||e.matrix)&&(this.data=this.originalData=I.converter({dataView:e,style:this.style,hostServices:this.hostServices,dataLabelSettings:this.data.dataLabelsSettings,sentimentColors:a,interactivityService:this.interactivityService,tooltipsEnabled:this.tooltipsEnabled,numberOfBreakdowns:r}))},I.prototype.getFormattingCards=function(e){var t=this;return{card:[function(){return t.getSentimentColorCard(e.categoryAxisData)},function(){return t.getBreakdownCard()},function(){return t.getLabelsCard()}].reduce(function(e,t){t=t();return t&&e.push(t),e},[]),type:3}},I.prototype.getSentimentColorCard=function(t){function i(e){return a.hostServices.getLocalizedString(e)}var a=this,r=F.waterfallChartPropsNew.sentimentColors,o=this.originalData,s=o.sentimentColors,n=F.waterfallChartPropsNew.valueAxis.totalsEnabled,e=F.waterfallChartPropsNew.categoryAxis,l=e.innerPadding,c=e.preferredCategoryWidth,u=this.yAxisProperties.totalsEnabled,e=new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("sentimentColors"),"Role_DisplayName_Columns",__assign(__assign({},r),{totalsEnabledProp:n,innerPaddingProp:l,preferredCategoryWidthProp:c}),i);return e.addGroup("colors",function(e){e.withDisplayName("Visual_Colors").addSimpleSlice("increaseFill",function(){var e={value:s.increaseFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.increaseFill,value:e}).build()}).addSimpleSlice("decreaseFill",function(){var e={value:s.decreaseFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.decreaseFill,value:e}).build()}).addSimpleSlice("otherFill",function(){var e={value:s.otherFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.otherFill,value:e}).build()},function(e){return e.withDisabled(!o.isBreakdown).withCustomDescription("Visual_Waterfall_Breakdown_OtherDescription")}),a.featureSwitch.waterfallTotals&&!o.isBreakdown&&e.addSimpleSlice("totalsEnabled",new d.ToggleSwitchBuilder({descriptor:n,value:u}).build(),function(e){return e.withCustomDisplayName("Visual_Axis_Total_Column")}),u&&e.addSimpleSlice("totalFill",function(){var e={value:s.totalFill.solid.color};return new d.ColorPickerBuilder({descriptor:r.totalFill,value:e}).build()})}),e.addGroup("spacing",function(e){e.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerPadding",new d.SliderBuilder({descriptor:l,value:100*t.innerPadding,localize:i,options:{minValue:{type:0,value:0},maxValue:{type:1,value:50}}}).build()).addSimpleSlice("maxcategoryWidth",new d.SliderBuilder({descriptor:c,value:Math.round(100*t.maxMarginFactor),localize:i,options:{minValue:{type:0,value:20},maxValue:{type:1,value:180}}}).build(),function(e){return e.withCustomDisplayName("Visual_Max_CategoryWidth")})}),e.build()},I.prototype.getBreakdownCard=function(){function t(e){return i.hostServices.getLocalizedString(e)}var i=this,a=this.originalData,r=F.waterfallChartPropsNew.breakdown,e=new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("breakdown"),"Visual_Waterfall_Breakdown",r,t);return a.isBreakdown?e.addGroup("breakdown",function(e){e.addSimpleSlice("maxBreakdowns",new d.SliderBuilder({descriptor:r.maxBreakdowns,value:a.numberOfBreakdowns,localize:t,options:{minValue:{type:0,value:I.MinimumBreakdowns},maxValue:{type:1,value:Math.min(I.MaximumBreakdowns,a.totalBreakdownCategories)}}}).build(),function(e){return e.withCustomDisplayName("Visual_Waterfall_MaximumBreakdown")})}):e.withDisabled(!0,"Visual_BreakdownCard_DisabledReason"),e.build()},I.prototype.getLabelsCard=function(){var t=this,e=F.waterfallChartPropsNew.labels,i=this.originalData,a=this.data.dataLabelsSettings,r={dataLabelsSettings:i.dataLabelsSettings,positionObject:I.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:a.enableBackground,backgroundColor:a.backgroundColor,backgroundTransparency:a.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0};a.position&&r.positionObject.indexOf(a.position)<0&&(a.position=I.AutoLabelPosition);a={cardBuilder:new d.FormattingCardBuilder(new d.FormattingCardUidBuilder("labels"),"Visual_DataPointsLabels",e,function(e){return t.hostServices.getLocalizedString(e)}),dataLabelsProps:e,featureSwitches:this.featureSwitch,hostServices:this.hostServices,options:r,individualSelector:F.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitch,hasCategories:null!=_.first(i.categories),hasDynamicSeries:!1,hasSeriesSelector:!1})};return i.isBreakdown&&(i=null==(r=_.first(null==(e=_.first(i.series))?void 0:e.data))?void 0:r.identity.getSelector())&&(a.repetitionSelector={metadata:i.metadata}),F.DataLabelViewModel.getDataLabelsFormattingModel(a)},I.prototype.enumerateObjectInstances=function(e,t){var i=this.originalData;switch(t.objectName){case"sentimentColors":this.enumerateSentimentColors(e);break;case"labels":var a=this.data.dataLabelsSettings,a={enumeration:e,dataLabelsSettings:i.dataLabelsSettings,positionObject:I.validLabelPositionsOptions,show:!0,displayUnits:!0,precision:!0,fontSize:!0,fontFamily:!0,labelOrientation:!0,position:!0,enableBackground:a.enableBackground,backgroundColor:a.backgroundColor,backgroundTransparency:a.backgroundTransparency,style:this.style,bold:!0,italic:!0,underline:!0};F.DataLabelViewModel.enumerateDataLabels(a,this.featureSwitch);break;case F.waterfallChartProps.breakdown.maxBreakdowns.objectName:this.enumerateBreakdown(e)}},I.prototype.enumerateSentimentColors=function(e){var t=this.originalData,i=t.sentimentColors,a=this.yAxisProperties.totalsEnabled,r={increaseFill:i.increaseFill,decreaseFill:i.decreaseFill};t.isBreakdown&&(r.otherFill=i.otherFill),a&&(r.totalFill=i.totalFill),e.pushInstance({selector:null,properties:r,objectName:"sentimentColors"})},I.prototype.enumerateBreakdown=function(e){var t=this.originalData;t.isBreakdown&&e.pushInstance({selector:null,properties:{maxBreakdowns:t.numberOfBreakdowns},validValues:{maxBreakdowns:{numberRange:{min:I.MinimumBreakdowns,max:Math.min(I.MaximumBreakdowns,t.totalBreakdownCategories)}}},objectName:F.waterfallChartProps.breakdown.maxBreakdowns.objectName})},I.prototype.calculateCustomLegend=function(){return this.data.legend},I.prototype.hasLegend=function(){return!0},I.createClippedDataIfOverflowed=function(e,t){var i=e,a=e.series[0].data;return e&&t<a.length&&((i=T.Prototype.inherit(e)).series=[{data:a.slice(0,t)}],i.categories=e.categories.slice(0,t)),i},I.prototype.calculateAxesProperties=function(r){function e(e){var t="x"===e,e="y"===e,i=t?s:n,a={pixelSpan:t?c.width:c.height,domainOptions:t?F.AxisHelper.createDomain(l.series,F.AxisHelper.getCategoryValueType(l.categoryMetadata),!1,[s.includeDomain]):d,metaDataColumn:t?l.categoryMetadata:l.valuesMetadata,axisZoom:void 0,zeroScalarDomain:e?I.DefaultZeroScalarDomain:void 0,isScalar:e,isVertical:e,isCategoryAxis:t,formatString:F.valueFormatter.getFormatString(t?l.categoryMetadata:l.valuesMetadata[0],I.formatStringProp),outerPadding:e?0:u.categoryThickness*u.outerPaddingRatio,outerPaddingRatio:e?0:u.outerPaddingRatio,forcedTickCount:r.forcedTickCount,axisDisplayUnits:i.displayUnits,axisPrecision:i.precision,preventNice:F.AxisHelper.hasForcedDomain(t?i.includeDomain:d),featureSwitches:o.featureSwitch},e=(t?(a.categoryThickness=u.categoryThickness,a.getValueFn=function(e,t){return I.lookupXValue(l,e,t,o.featureSwitch)},a.innerPaddingRatio=r.innerPaddingRatio):e&&(a.useTickIntervalForDisplayUnits=!0,a.invertAxis=i.invertAxis,a.totalsEnabled=i.totalsEnabled),F.AxisHelper.createAxis(a));return t&&(e.outerPaddingRatio=u.outerPaddingRatio,l.categoryIdentities)&&(e.categoryIdentities=l.categoryIdentities),e}var o=this,s=r.categoryAxisOptions,n=r.valueAxisOptions,l=(this.currentViewport=r.viewport,this.margin=r.margin,this.viewModelAdapterFactory&&this.originalData&&(t=this.viewModelAdapter=this.viewModelAdapterFactory.create({data:this.originalData,dataView:this.dataView,viewport:this.currentViewport}),this.data=t.getData()),this.clippedData=this.data),t=l.categories.length,c=this.getPreferredPlotArea(!1,t,F.CartesianHelper.MinOrdinalRectThickness,r.outerPaddingRatio),u=F.CartesianChartLayout.getLayout(null,{availableWidth:c.width,categoryCount:t,preferredCategoryWidth:null!=(t=null==l?void 0:l.preferredCategoryWidth)?t:null,domain:null,isScalar:!1,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:r.trimOrdinalDataOnOverflow,outerPaddingRatio:r.outerPaddingRatio,innerPaddingRatio:r.innerPaddingRatio}),d=(this.isScrollable||(l=this.clippedData=I.createClippedDataIfOverflowed(l,u.categoryCount)),F.AxisHelper.createScalarDomainOptions(this.getAxesDomains(!1,{valueAxis:!0}).valueAxis,0)),d=F.AxisHelper.mergeScalarAxisDomains(n.includeDomain,d),i=(this.xAxisProperties=e("x"),this.yAxisProperties=e("y"),F.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(this.yAxisProperties,l.dataLabelsSettings)),a=F.DataLabelViewModel.createColumnFormatterCacheManager(),t=this.xAxisProperties.categoryThickness*(1-r.innerPaddingRatio);return this.layout={categoryCount:u.categoryCount,categoryThickness:u.categoryThickness,isScalar:u.isScalar,outerPaddingRatio:u.outerPaddingRatio,categoryWidth:t,labelText:function(e){var t=l.series[e.seriesIndex].type,t=a.getOrCreate(e.labelFormatString,l.dataLabelsSettings,i.units,i.getPrecision(!!e.labelFormatString,t));return F.DataLabelViewModel.getLabelTailoredText({label:t.format(e.value)})},labelLayout:F.CartesianHelper.getLabelLayoutXYForWaterfall(this.xAxisProperties,t,this.yAxisProperties,null==d?void 0:d.domain),filter:function(e){return I.doesDataLabelFitInShape(e,o.yAxisProperties,o.layout)},style:{fill:function(e){return e.isLabelInside?F.ColorHelper.getThemeColor(o.style,F.DataLabelViewModel.DefaultInsideLabelColorName):e.labelFill}}},[this.xAxisProperties,this.yAxisProperties]},I.prototype.getAxesDomains=function(e,t){var i={},a=this.clippedData||this.data;return a&&t.valueAxis&&(i.valueAxis=[a.positionMin,a.positionMax]),i},I.prototype.setAxesLayout=function(e){},I.lookupXValue=function(e,t,i,a){var r=e.series[0].data;return t===r.length-1?r[t].categoryValue:F.CartesianHelper.lookupXValue(e,t,r[t].type||i,!1,a)},I.prototype.getPreferredPlotArea=function(e,t,i,a){return F.CartesianChartLayout.getPreferredPlotArea(t,i,this.currentViewport,this.isScrollable,e,this.margin,a)},I.prototype.getVisualCategoryAxisIsScalar=function(){return!1},I.prototype.overrideXScale=function(e){this.xAxisProperties=e},I.prototype.setFilteredData=function(e,t){var i=this.clippedData=T.Prototype.inherit(this.data);return i.series=[{data:i.series[0].data.slice(e,t)}],i.categories=i.categories.slice(e,t),i},I.prototype.createRects=function(e){var e=this.mainGraphicsContext.selectAll(I.CategoryValueClasses.selector).data(e,function(e){return e.key}),t=e.enter().append("rect").attr("class",function(e){return I.CategoryValueClasses.class.concat(e.highlight?"highlight":"")}).merge(e);return e.exit().remove(),t},I.prototype.createConnectors=function(e){var e=this.mainGraphicsContext.selectAll(I.WaterfallConnectorClasses.selector).data(e.slice(0,e.length-1),function(e){return e.key}),t=e.enter().append("line").classed(I.WaterfallConnectorClasses.class,!0).merge(e);return e.exit().remove(),t},I.prototype.render=function(e){var t,i,a=this,r=this.clippedData.series[0].data,o=this.createRects(r),r=this.createConnectors(r),s=this.clippedData.strokeSettings,n=(this.tooltipsEnabled&&this.tooltipService.addTooltip(o,function(e){return e.data&&e.data.tooltipInfo()},function(e){return e.data&&e.data.identity&&[e.data.identity]}),this.interactivityService&&this.interactivityService.hasSelection()),l=this.xAxisProperties.scale,c=this.yAxisProperties.scale,u=c.domain()[0],d=this.yAxisProperties.invertAxis,s=(this.mainGraphicsSVG.attr("height",this.availableHeight).attr("width",this.availableWidth),s&&s.visible&&this.mainGraphicsSVG.style("stroke",s.color).style("stroke-width",s.width),o.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return 1===e.barType?F.ColumnUtil.DefaultOpacity:F.ColumnUtil.getFillOpacity(e.selected,e.highlight,n,a.data.hasHighlights)}).attr("width",this.layout.categoryWidth).attr("x",function(e){return l(e.categoryIndex)}).attr("y",function(e){var t;return d?(t=0,t=e.position<u?Math.abs(c(u)-c(e.value)):Math.abs(c(e.position)-c(e.position+e.value)),F.CartesianHelper.getRectTop(c,e.position,e.value)-t):F.CartesianHelper.getRectTop(c,e.position,e.value)}).attr("height",function(e){return e.position<u?Math.abs(c(u)-c(e.value)):Math.abs(c(e.position)-c(e.position+e.value))}),this.interactivityService&&(s=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),o.attrs({tabindex:0,focusable:!0,"aria-label":function(e){return F.tooltipUtils.formatTooltipInfo(e.tooltipInfo())},role:"option","aria-selected":function(e){return e.selected}}).classed(F.SetFocusRingClassName,!s)),r.style("stroke",F.ColorHelper.getThemeColor(this.style,I.DefaultWaterfallConnectorColorName)).attrs({x1:function(e){return l(e.categoryIndex)},y1:function(e){return c(e.position+e.value)},x2:function(e){return l(e.categoryIndex+1)+a.layout.categoryWidth},y2:function(e){return c(e.position+e.value)}}),this.data.dataLabelsSettings),r=[];return(s&&s.show||s.showCategory)&&(r=this.createLabelDataPoints()),this.interactivityService&&(i={navigationStrategy:F.DataPointNavigationStrategy.CategoryOnly,helper:this},t={root:this.mainGraphicsContext,bars:o,isBreakdown:this.data.isBreakdown}),F.SVGUtil.flushAllD3TransitionsIfNeeded(this.animationOptions),{dataPoints:this.data.series[0].data,behaviorOptions:t,navigationOptions:i,labelDataPoints:r,labelsAreNumeric:!0,labelOrientation:s.labelOrientation,animateLabels:!e}},I.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},I.prototype.getSupportedCategoryAxisType=function(){return F.axisType.categorical},I.prototype.getFirstElement=function(){var e;return _.isEmpty(this.clippedData.series)||_.isEmpty(this.clippedData.series[0].data)?{element:null}:(e=this.clippedData.series[0].data[0].categoryIndex,{element:this.getHTMLElementFromCategoryIndex(e)})},I.prototype.getNextDataPoint=function(e,t,i){var a,r=e;do{switch(i){case F.DataDirection.NextCategory:e+=1,((this.yAxisProperties.totalsEnabled||this.data.isBreakdown)&&e>=this.data.categories.length||!this.yAxisProperties.totalsEnabled&&!this.data.isBreakdown&&e>=this.data.categories.length-1)&&(e=0);break;case F.DataDirection.PreviousCategory:--e<0&&(e=this.yAxisProperties.totalsEnabled||this.data.isBreakdown?this.data.categories.length-1:this.data.categories.length-2);break;case F.DataDirection.NextSeries:case F.DataDirection.PreviousSeries:}}while((a=this.data.series[t].data[e])&&0===a.value&&r!==e);return{element:this.getHTMLElementFromCategoryIndex(e),targetCategoryIndex:e}},I.prototype.getHTMLElementFromCategoryIndex=function(t){return this.mainGraphicsContext.selectAll(I.CategoryValueClasses.selector).filter(function(e){return e.categoryIndex===t}).node()},Object.defineProperty(I.prototype,"availableWidth",{get:function(){return Math.max(0,this.currentViewport.width-(this.margin.left+this.margin.right))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"availableHeight",{get:function(){return Math.max(0,this.currentViewport.height-(this.margin.top+this.margin.bottom))},enumerable:!1,configurable:!0}),I.prototype.getSentimentColorsFromObjects=function(e){var t=F.ColorHelper.create(this.style);return{increaseFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.increaseFill,F.ColorHelper.getSentimentColor(this.style,"good"))}},decreaseFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.decreaseFill,F.ColorHelper.getSentimentColor(this.style,"bad"))}},totalFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.totalFill,F.ColorHelper.getDataColorByIndex(this.style,0))}},otherFill:{solid:{color:t.getColorForPropertyWithDefaultColor(e,F.waterfallChartProps.sentimentColors.otherFill,F.ColorHelper.getSentimentColor(this.style,"neutral"))}}}},I.prototype.createLabelDataPoints=function(){for(var e=[],t=this.data,i=this.xAxisProperties.scale,a=this.yAxisProperties.scale,r=this.yAxisProperties.invertAxis,o=a(0),s=t.series,n=F.DataLabelViewModel.createColumnFormatterCacheManager(),l=t.dataLabelsSettings,c=F.DataLabelRenderer.getLabelUnitAndPrecisionForAxis(this.yAxisProperties,l),u=0,d=s;u<d.length;u++)for(var h=d[u],p=0,g=h.data;p<g.length;p++){var y=g[p],m={left:i(y.categoryIndex),top:r?F.CartesianHelper.getRectTopInverted(a,y.position,y.value):F.CartesianHelper.getRectTop(a,y.position,y.value),width:this.layout.categoryWidth,height:Math.abs(o-a(Math.abs(y.value)))},v=y.labelFormatString,v=n.getOrCreate(v,this.data.dataLabelsSettings,c.units,c.getPrecision(!!v,h.type)),v=F.DataLabelRenderer.getLabelFormattedText(v.format(y.value)),S=l.fontProperties,f=F.FontProperties.toTextProperties(S,v),b=T.TextMeasurementService.measureSvgTextWidth(f),f=T.TextMeasurementService.estimateSvgTextHeight(f,!0),x=this.getValidPositions(l.position,y.value);e.push({isPreferred:!0,text:v,textSize:{width:b,height:f},outsideFill:null!=(v=y.labelFill)?v:F.ColorHelper.getThemeColor(this.style,F.DataLabelViewModel.DefaultLabelColorName),insideFill:F.ColorHelper.getThemeColor(this.style,F.DataLabelViewModel.DefaultInsideLabelColorName),parentType:1,parentShape:{rect:m,orientation:0<=y.value?r?2:1:r?1:2,validPositions:x},fontProperties:S,identity:void 0,hasBackground:l.enableBackground,backgroundColor:l.backgroundColor,backgroundTransparency:l.backgroundTransparency})}return e},I.prototype.getValidPositions=function(e,t){if(0===t)return I.validZeroLabelPosition;switch(e){case F.labelPosition.insideEnd:return[4];case F.labelPosition.insideCenter:return[1];case F.labelPosition.insideBase:return[2];case F.labelPosition.outsideEnd:return[16];default:return I.validLabelPositionsAuto}},I.prototype.getCartesianVisualCapabilities=function(){return{supportsHierarchicalCategoryAxis:!1}},I.prototype.getStaticSeriesRole=function(){},I.prototype.addWarnings=function(e){this.viewModelAdapter&&this.viewModelAdapter.addWarnings(e)},I.formatStringProp={objectName:"general",propertyName:"formatString"},I.DefaultZeroScalarDomain=[0,1],I.WaterfallClassName="waterfallChart",I.MainGraphicsContextClassName="mainGraphicsContext",I.IncreaseLabel="Increase",I.DecreaseLabel="Decrease",I.TotalLabel="Waterfall_TotalLabel",I.OtherLabel="Waterfall_OtherLabel",I.CategoryValueClasses=e("column"),I.WaterfallConnectorClasses=e("waterfall-connector"),I.AutoLabelPosition="Auto",I.DefaultWaterfallConnectorColorName="foregroundNeutralTertiary",I.MinimumBreakdowns=1,I.MaximumBreakdowns=20,I.DefaultBreakdowns=5,I.DefaultTotalsEnabled=!0,I.validLabelPositionsOptions=[I.AutoLabelPosition,t.outsideEnd,t.insideEnd,t.insideCenter,t.insideBase],I.validLabelPositionsAuto=[16,4,1,2],I.validZeroLabelPosition=[16,8],F.WaterfallChart=I}(powerbi=powerbi||{}),function(e){var n=e.visuals||(e.visuals={}),l=jsCommon.BrowserUtils;function t(){}t.prototype.create=function(){return new i},n.WaterfallChartWebBehaviorFactory=t,a.prototype.bindEvents=function(a,r,e){var t,i,o=this,s=this.bars=a.bars;e&&(t=e.dataPointNavigationManager,e=e.pointSourceKey,t.isEmpty(e)||(i=a.root,n.InteractivityUtils.registerEnterPlotAreaHandler(i,t,e),n.InteractivityUtils.registerDataPointNavigationHandler(i,t,e),n.InteractivityUtils.registerClearCatcherShortcut(i,r))),s.on("click",function(e){return o.handleSelection(e,r,a.isBreakdown)}).on("keydown",function(e){var t=d3.event,i=t.keyCode;32!==i&&13!==i||(t.preventDefault(),t.stopPropagation(),o.handleSelection(e,r,a.isBreakdown))}),s.on("contextmenu",function(e){var t=d3.event;l.isCtrlOrMeta(t)||(t.preventDefault(),n.EventBubblingUtil.markAsHandled(t),1!==e.barType&&(t=n.InteractivityUtils.getPositionOfLastInputEvent(),r.handleContextMenu(e,t)))})},a.prototype.renderSelection=function(t){this.bars.attr("aria-selected",function(e){return e.selected}).style("fill-opacity",function(e){return 1===e.barType?n.ColumnUtil.DefaultOpacity:n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)}).style("stroke-opacity",function(e){return 1===e.barType?n.ColumnUtil.DefaultOpacity:n.ColumnUtil.getFillOpacity(e.selected,e.highlight,t,!1)})},a.prototype.renderFocus=function(e){e&&l.focus(e)},a.prototype.handleSelection=function(e,t,i){var a,r;1!==e.barType&&(a=n.InteractivityUtils.getPositionOfLastInputEvent(),r=void 0,r=i?0:jsCommon.SelectionUtility.getMultiSelectMode(d3.event),t.handleSelection(e,r,a))};var i=a;function a(){}n.WaterfallChartWebBehavior=i}(powerbi=powerbi||{}),define("CartesianVisuals/cartesianModule",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.createScatterChartMobileBehaviorFactory=t.createDashboardColumnChartAnimator=t.createRealTimeLineChartAnimator=t.createWaterfallChartWebBehaviorFactory=t.createScatterChartWebBehaviorFactory=t.createLineChartWebBehaviorFactory=t.createDataDotChartWebBehaviorFactory=t.createColumnChartWebBehaviorFactory=t.createCartesianChartBehaviorFactory=t.createWebColumnChartAnimator=t.createCartesianChart=void 0;var i=powerbi.visuals,a=i.CartesianChart,r=i.CartesianChartBehaviorFactory,o=i.ColumnChartWebBehaviorFactory,s=i.DashboardColumnChartAnimator,n=i.DataDotChartWebBehaviorFactory,l=i.LineChartWebBehaviorFactory,c=i.RealTimeLineChartAnimator,u=i.ScatterChartMobileBehaviorFactory,d=i.ScatterChartWebBehaviorFactory,h=i.WaterfallChartWebBehaviorFactory,p=i.WebColumnChartAnimator;t.createCartesianChart=function(e){return new a(e)},t.createWebColumnChartAnimator=function(e){return new p(e)},t.createCartesianChartBehaviorFactory=function(e,t){return new r(e,t)},t.createColumnChartWebBehaviorFactory=function(){return new o},t.createDataDotChartWebBehaviorFactory=function(){return new n},t.createLineChartWebBehaviorFactory=function(){return new l},t.createScatterChartWebBehaviorFactory=function(){return new d},t.createWaterfallChartWebBehaviorFactory=function(){return new h},t.createRealTimeLineChartAnimator=function(e){return new c(e)},t.createDashboardColumnChartAnimator=function(e){return new s(e)},t.createScatterChartMobileBehaviorFactory=function(){return new u}}),function(S){var f,e;function b(e){return{x:{tickLabels:e.x.labelFontProperties,title:e.x.titleFontProperties},y:{tickLabels:e.y.labelFontProperties,title:e.y.titleFontProperties},y2:{tickLabels:e.y2.labelFontProperties,title:e.y2.titleFontProperties}}}function x(e,t){var i={x:e.x.showAxisTitle,y:e.y.showAxisTitle,y2:e.y2.showAxisTitle};return i=t?t.updateShowAxisTitles(i,e):i}f=S.visuals||(S.visuals={}),(e=f.CartesianAxesLayoutBuilder||(f.CartesianAxesLayoutBuilder={})).build=function(e){var t=e.axes,i=e.axisZoom,a=e.calculatePlotArea,r=e.data,o=e.interactivityOptions,s=e.layers,n=e.playAxesRect,l=e.referenceLines,c=e.trimOrdinalDataOnOverflow,u=e.type,d=e.viewport,h=e.featureSwitches,p=e.rotateXTickLabels90,e=e.forceMarginMin,g=[],y=[],m=[];function v(e){e=d3.extent(e);return{min:e[0],max:e[1]}}return f.ReferenceLineHelper.gatherDomainExtents(l,g,y,m,f.CartesianChart.getCategoryValueType(s)),t.negotiateAxes({layers:s,parentViewport:d,padding:S.Prototype.inherit(f.SvgCartesianAxes.AxisPadding),playAxisControlLayout:n,showAxisTitles:x(r,i),shouldRenderAxis:f.CartesianChartLayout.shouldRenderAxis(r,f.ComboChart.isComboChart(u)),axesFontProperties:b(r),interactivityRightMargin:null!=o&&o.isInteractiveLegend&&!c?f.INTERACTIVITY_RIGHT_MARGIN:0,calculatePlotArea:a,skipMergeValueAxes:null==i?void 0:i.skipMergingValueAxisDomains(),ensureXDomain:v(g),ensureYDomain:v(y),ensureY2Domain:v(m),rotateXTickLabels90:p,featureSwitches:h,forceMarginMin:e})},e.getAxesFontProperties=b,e.showAxisTitles=x}(powerbi=powerbi||{}),function(e){var w,D;function t(e){var t=(this.settings=e).axes,i=e.data,a=e.container,e=e.featureSwitches;this.svgAxes=new w.SvgCartesianAxes(t),this.svgAxes.init(a,i),this.navigationHelper=new w.CartesianChartNavigationHelper,this.featureSwitches=e}w=e.visuals||(e.visuals={}),D=e.visuals.controls.SvgScrollbar,t.prototype.destroy=function(){var e;null!=(e=this.scrollableAxes)&&e.destroy(),null!=(e=this.svgScrollbar)&&e.remove(),this.scrollableAxes=void 0,this.svgScrollbar=void 0},t.prototype.update=function(e,t){var i;null!=(i=this.svgScrollbar)&&i.updateScrollbarOptions(t),this.svgAxes.update(e)},t.prototype.render=function(o,e,a,t,i,s,r,n,l){var c,u,d=this,r=this.options=r,h=r.playAxesRect,p=r.trimOrdinalDataOnOverflow,g=r.categoryLoadMoreDataHandler,y=r.suppressAnimations,m=r.animationDuration,v=r.ease,S=r.isHierarchicalAxis,f=r.formatMode,b=r.subSelectionHelper,x=r.preserveScrollPosition,C=r.supportsScrolling,r=r.navigationScrollCallbacks;return!l&&((l=w.CartesianAxesLayoutBuilder.build({data:o,interactivityOptions:this.settings.interactivity,referenceLines:t,type:this.settings.type,axes:this.settings.axes,layers:a,viewport:i,playAxesRect:h,calculatePlotArea:this.settings.calculatePlotArea,trimOrdinalDataOnOverflow:p,axisZoom:e,rotateXTickLabels90:void 0,featureSwitches:this.featureSwitches})).plotArea.width<1||l.plotArea.height<1)?l:this.settings.suppressBrush&&(i.height<1||i.width<1)?void 0:(a.forEach(function(e,t){var i;0!==t&&l.axes.y2?i=2:(i=1)===a.length&&l.axes.y2&&(i|=2),e.setAxesLayout({layout:l,trimOrdinalDataOnOverflow:p,axisType:i})}),null!=e&&e.render({cartesianAxesLayout:l,axesData:o,formatMode:f,categoryAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!0,"title","text"),valueAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!1,"title","text"),y2AxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!0,!1,"title","text")}),t=l.axes.x.isCategoryAxis?l.axes.x:l.axes.y1,null!=g&&g.setScale(t.scale),h=function(e,t,i,a,r){return d.renderAxes(e,t,i,m,v,w.CartesianAxesLayoutBuilder.getAxesFontProperties(o),s,S,n,f,a,r)},(this.svgScrollbar||this.scrollableAxes)&&this.svgScrollbar&&this.scrollableAxes,C?(this.svgScrollbar||(e=(i=this.settings).container,t=i.onExtentUpdate,c=i.axes,u=i.animateCategoryAxis,i=i.animateValueAxis,this.svgScrollbar=new D({scrollbarWidth:w.ScrollableAxes.ScrollbarWidth,onExtentUpdate:t}),this.scrollableAxes=new w.ScrollableAxes(c,this.svgScrollbar,u,i),this.svgScrollbar.init(e)),this.scrollableAxes.render(l,a,y,h,S,x,g,this.settings.suppressBrush,this.settings.type,o.hasY2Role,f,b)):(this.destroy(),h(a,l,y,this.settings.animateCategoryAxis,this.settings.animateValueAxis)),this.navigationHelper.updateScrollCallbacks(C?r:void 0),this.eventsBoundForAxesLayout!==l&&(this.bindScrollWheelEvents(l,this.settings.container,f,b),this.bindTouchEvents(l,this.settings.container,f,b),this.eventsBoundForAxesLayout=l),l)},t.prototype.renderAxes=function(e,t,i,a,r,o,s,n,l,c,u,d){a=this.svgAxes.renderAxes({axesLayout:t,duration:a,axesFontProperties:o,animateCategoryAxis:u,animateValueAxis:d,easing:r,shouldRenderGridLinesOnly:this.options.shouldRenderGridLinesOnly,useManagedTabIndex:l,featureSwitches:this.featureSwitches,formatMode:c,categoryAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!0,"title","text"),valueAxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!1,!1,"title","text"),y2AxisTitleSliceUid:w.CartesianChartOnObjectUtil.getAxisSliceUid(!0,!1,"title","text")});null!=a&&a.navigationOptions&&this.settings.behavior&&(this.navigationHelper.clearNavigationLayers(),this.navigationHelper.addNavigationLayer(a.navigationOptions.helper),r={isAxis:!0,navigationOptions:{helper:this.navigationHelper,navigationStrategy:a.navigationOptions.navigationStrategy,focusElement:null==(d=(o=this.navigationHelper).getPendingFocusElement)?void 0:d.call(o)},pointSourceKey:"cartesian-axis"+(this.settings.multipleId||""),isHierarchicalAxis:n},this.settings.interactivityService.bind(a.dataPoints,this.settings.behavior,a.behaviorOptions,r),this.settings.behavior.renderSelection(this.settings.interactivityService.hasSelection())),s(e,t,i,u,u,n)},t.prototype.getLayerContainer=function(){return this.svgAxes.getScrollableRegion()},t.prototype.getDataLabelContainers=function(){return this.svgAxes.getLabelsContainers()},t.prototype.getSeriesLabelContainers=function(){return this.svgAxes.getSeriesLabelsContainers()},t.prototype.setExtent=function(e){var t;null!=(t=this.scrollableAxes)&&t.setExtent(e)},t.prototype.scrollDelta=function(e){var t;null!=(t=this.scrollableAxes)&&t.scrollDelta(e)},t.prototype.scrollTo=function(e){var t;null!=(t=this.scrollableAxes)&&t.scrollTo(e)},t.prototype.shouldScrollTo=function(e){var t;return null==(t=this.scrollableAxes)?void 0:t.shouldScrollTo(e)},t.prototype.scrollBy=function(e){var t;null!=(t=this.scrollableAxes)&&t.scrollBy(e)},t.prototype.clearRenderingTimeout=function(){var e;null!=(e=this.scrollableAxes)&&e.clearRenderingTimeout()},t.prototype.bindTouchEvents=function(r,e,o,s){var n=this,l={x:0,y:0};this.settings.eventManager.on(e.node(),"touchstart",function(){var e;0===n.options.viewMode&&(r.isXScrollBarVisible||r.isYScrollBarVisible)&&(e=d3.event.changedTouches[0],l.x=e.pageX,l.y=e.pageY)}),this.settings.eventManager.on(e.node(),"touchmove",function(){var e,t,i,a=null==(a=n.settings.hostServices)?void 0:a.tooltips();0!==n.options.viewMode||!r.isXScrollBarVisible&&!r.isYScrollBarVisible||a&&a.isTouchScreenOptimizedEnabled()&&a.visible()||(o&&null!=s&&s.onVisualScroll(),n.settings.tooltipService.hide(),e=(a=d3.event).changedTouches[0],i=l.x-e.pageX,t=l.y-e.pageY,i=r.isXScrollBarVisible?i:t,n.settings.onScroll?n.settings.onScroll(i):null!=(t=n.scrollableAxes)&&t.scrollDelta(i),l.x=e.pageX,l.y=e.pageY,a.preventDefault())})},t.prototype.bindScrollWheelEvents=function(a,e,r,o){var s=this;this.settings.eventManager.on(e.node(),"wheel",function(){if(a.isXScrollBarVisible||a.isYScrollBarVisible){r&&null!=o&&o.onVisualScroll(),s.settings.tooltipService.hide();var e=d3.event,t=e.deltaX,i=e.deltaY,t=Math.abs(t)>Math.abs(i)?t:i;if(s.settings.onScroll){if(s.options.isSmallMultiples&&!e.shiftKey)return;s.settings.onScroll(t)}else null!=(i=s.scrollableAxes)&&i.scrollDelta(t);e.preventDefault()}})},w.CartesianAxesRenderer=t}(powerbi=powerbi||{}),function(F){var I,k,O;function N(){}function a(i,e,t,a){var r=I.CartesianChart.getLayerDataViews(e);return!_.isEmpty(t)&&(e=null==a?t:[t[a]],_.every(e,function(e,t){return!r[t]||i(e)}))}I=F.visuals||(F.visuals={}),k=I.AxisDataModel.AxesData,N.prototype.convert=function(e){for(var t=e.dataViews,i=e.layers,a=e.layerStyle,r=e.categoryAxisTitleOnByDefault,o=e.valueAxisTitleOnByDefault,s=e.chartType,n=e.hasDataChanged,l={scrollbarWidth:I.ScrollableAxes.ScrollbarWidth},c=[],u=[],d=I.CartesianChart.getLayerDataViews(t),h=_.filter(t,I.ForecastHelper.isDataViewForForecast),p=[],g=1<i.length&&!!(t[0]&&t[0].categorical&&t[0].categorical.values),y=a.colorPalette.dataColors,m=(y.clearPreferredScale(),_.filter(t,I.TrendLineHelper.isDataViewForRegression)),v=new I.VisualWarningBuilder,S=_.filter(t,I.AnomalyDetectionVisualPlugin.isDataViewForAnomalyDetection),f=0,b=i.length;f<b;f++){var x=d[f],C=i[f],w=x?[x]:[],w=(null!=h[f]&&w.push(h[f]),null!=S[f]&&w.push(S[f]),i[f].setData(w,e.multipleInfo),function(e,t,i,a,r){var o,s,n=0;e.calculateCustomLegend&&(o=e.calculateCustomLegend(),n=o?o.dataPoints.length:0);t&&n<=1&&(s=I.Legend.buildSeriesLegendData({dataView:t,showByDefault:!0,staticSeriesRoleNames:[e.getStaticSeriesRole()],style:i,allowLegendWithNoSeries:a},function(e){return 3===e||5===e||4===e||6===e||8===e||7===e||10===e}(r)));return!e.calculateCustomLegend||n<=1&&s&&s.isGradientLegend?s:o}(C,x,a,g,s));w&&p.push(w),u.push.apply(u,I.CartesianChart.getDataBoundReferenceLines(x,i[f],a,e.featureSwitches)||[]),N.supportsTrendLines(t,i,f)&&(C=m[f])&&(w=I.TrendLineHelper.readDataView(C,x,0<f,a),c.push.apply(c,w||[])),1<b&&y.rotateScale()}var D,A,P,L,M,V=1<p.length?I.Legend.mergeLegendData(p):1===p.length?p[0]:I.Legend.getDefaultLegendData(a),T=I.AxisZoom.converter(_.head(t));return _.isEmpty(t)?M=k.createDefault(a):(P=t[0],L=t[1],A=!1,(D=P.metadata)&&P.categorical&&!_.isEmpty(P.categorical.categories)&&(A=!!I.ScalarUtils.getScalarKeys(P.categorical.categories[0])),A=I.CartesianHelper.getCategoryAxisProperties(D,A||r),r=I.CartesianHelper.getValueAxisProperties(D,o),D=I.CartesianHelper.getValueAxisProperties(D,o,"y2Axis"),o=N.getDefaultLineChartSeriesLabelSettings(),r={valueAxisProperties:r,y2AxisProperties:D,categoryAxisProperties:A,isYCategorical:I.CartesianChart.shouldYAxisBeCategorical(s),isValueAxisDisabled:!N.supportsValueAxis(t,i),isScatter:10===s,isComboChart:I.ComboChart.isComboChart(s),style:a,hasY2Role:F.data.DataRoleHelper.hasRoleInDataView(P,"Y2")||L&&F.data.DataRoleHelper.hasRoleInDataView(L,"Y2"),forceShowY2:T.show&&T.showOnValueSecAxis||!_.isEmpty(e.multipleInfo)&&I.ComboChart.isComboChart(s),show:(N.isLineComboChart(s)?i[0].getSeriesSettings():o).show,seriesMaximumWidth:(N.isLineComboChart(s)?N.getMaximumSeriesSettings(i):o).seriesMaximumWidth,seriesPosition:(N.isLineComboChart(s)?i[0].getSeriesSettings():o).seriesPosition,isLineComboChart:N.isLineComboChart(s),defaultSeriesWidth:(N.isLineComboChart(s)?N.getMaximumSeriesSettings(i):o).defaultSeriesWidth},M=new k(r),n&&(D=t,A=u,P=a,L=i,o=e.chartType,r=e.featureSwitches,D)&&0<D.length&&(n=D[0].metadata)&&(D=O.supportsStaticReferenceLines(D,L),A.push.apply(A,function(e,t,i,a,r){var o=I.ColorHelper.getDataColorByIndex(t,0,I.ForegroundColorName),s=[];i&&(i=F.DataViewObjects.getUserDefinedObjects(e.objects,I.ReferenceLineHelper.xAxisRefLineObjectName),s.push.apply(s,I.ReferenceLineHelper.readDataView(i,o,I.ReferenceLineHelper.xAxisRefLineObjectName,0,t,r,a,void 0)||[]));i=F.DataViewObjects.getUserDefinedObjects(e.objects,I.ReferenceLineHelper.y1AxisRefLineObjectName);return s.push.apply(s,I.ReferenceLineHelper.readDataView(i,o,I.ReferenceLineHelper.y1AxisRefLineObjectName,1,t,r)||[]),s}(n,P,D,o,r)||[]))),{legendData:V,trendLines:c,referenceLines:u,axesData:M,warningObjectCollection:v,showIcon:!1,scrollbarOptions:l,zoomData:T}},N.getDefaultLineChartSeriesLabelSettings=function(){var e=I.DataLabelViewModel.getDefaultLabelSettings({labelColor:"#FFF",textClassName:"smallLightLabel"}).fontProperties;return{seriesColor:"#FFF",seriesPosition:I.labelSeriesPosition.right,fontProperties:e,seriesWordWrap:!1,seriesMaximumWidth:20,defaultSeriesWidth:20,showLabelPerSeries:!1,enableBackground:!1,show:!1}},N.isLineComboChart=function(e){return 0===e||11===e||14===e||15===e||1===e||2===e},N.getMaximumSeriesSettings=function(e){var t,i,a;return 1<e.length?(t=e[0].getSeriesSettings(),i=e[1].getSeriesSettings(),a=t.seriesMaximumWidth,i.seriesMaximumWidth<a?t:i):e[0].getSeriesSettings()},N.supportsTrendLines=function(e,t,i){return a(function(e){return e.supportsTrendLine&&e.supportsTrendLine()},e,t,i)},N.supportsValueAxis=function(e,t,i){return a(function(e){e=e.getCartesianVisualCapabilities().supportsValueAxis;return void 0===e||e},e,t,i)},N.supportsDataBoundReferenceLines=function(e,t,i){return a(function(e){return!e.isStacked||!e.isStacked()},e,t,i)},N.supportsStaticReferenceLines=function(e,t,i){return a(function(e){return!e.supportsStaticReferenceLines||e.supportsStaticReferenceLines()},e,t,i)},O=N,I.CartesianChartConverter=O}(powerbi=powerbi||{}),function(S){var l=S.visuals||(S.visuals={});function e(e,t,i,a,r,o,s,n){this.options=e,this.behaviorFactory=t,this.featureSwitches=i,this.axes=a,this.type=r,this.isPlayAxis=o,this.scrollOnRowsEnabled=s,this.adapterFactory=n}e.prototype.init=function(e,t,i,a,r,o,s,n){this.initOptions=e,this.tooltipService=t,this.legend=i,this.axesData=a,this.interactivityService=r,this.layerStyle=o,this.rowLoadMoreDataHandler=s,this.eventManager=n},e.prototype.create=function(e){var t=new i(this.options,this.behaviorFactory,this.featureSwitches,this.axes,this.type,this.isPlayAxis,this.axesData,this.scrollOnRowsEnabled,this.adapterFactory);return t.init(e,this.initOptions,this.tooltipService,this.legend,this.interactivityService,this.layerStyle,this.rowLoadMoreDataHandler,this.eventManager),t},l.CartesianChartLayoutBuilder=e,t.prototype.render=function(e,t){var i,a;this.shouldRender()&&(a=(i=this.data).position||l.LegendPosition.Top,this.legend.setPosition(a),1!==i.dataPoints.length||i.grouped||((i=S.Prototype.inherit(i)).dataPoints=[]),this.legend.drawLegend(i,this.viewport,{isHierarchicalAxis:e,formatMode:t,titleSliceUid:"".concat("legend","-").concat("title","-titleText")}))},t.prototype.shouldRender=function(){return!(this.interactivity&&this.interactivity.isInteractiveLegend)},t.prototype.getMargin=function(){return this.legend.getMargins()},t.prototype.getPosition=function(){return this.legend.getPosition()},t.prototype.adjustChartArea=function(e){l.Legend.positionChartArea(e,this.legend)},t.prototype.isRenderedLeftOrRight=function(){return this.legend.isVisible()&&l.Legend.isLeftOrRight(this.legend.getPosition())};var r=t;function t(e,t,i,a){this.legend=e,this.data=t,this.viewport=i,this.interactivity=a}l.CartesianLegendRender=r,f.prototype.init=function(e,t,i,a,r,o,s,n){this.options=t,this.tooltipService=i,this.legend=a,this.interactivityService=r,this.layerStyle=o,this.element=e,this.rowLoadMoreDataHandler=s,this.eventManager=n,this.hostServices=t.host,this.gridContainer=$(document.createElement("div")).appendTo(this.element),this.gridContainer.addClass(f.GridContainerClassName),this.behavior=null==(i=this.behaviorFactory)?void 0:i.create(),this.visibilityHelper=S.responsiveVisualUtilModuleFactory().visibilityHelper(this.element,f.IconClassName);a=d3.select(this.element.get(0)),r=this.chartAreaSvg=a.append("svg");r.classed(f.ClassName,!0),r.attr("name",this.getCartesianChartName()),r.style("position","absolute"),this.behavior&&(this.clearCatcher=l.appendClearCatcher(r),this.axisBehavior=new l.AxisBehavior),this.viewMode=t.host.getViewMode()},f.prototype.getCartesianChartName=function(){switch(this.type){case 0:return this.hostServices.getLocalizedString("LineChart_ToolTip");case 1:return this.hostServices.getLocalizedString("AreaChart_ToolTip");case 2:return this.hostServices.getLocalizedString("StackedAreaChart_ToolTip");case 3:return this.hostServices.getLocalizedString("ClusteredColumnChart_ToolTip");case 4:return this.hostServices.getLocalizedString("ColumnChart_ToolTip");case 5:return this.hostServices.getLocalizedString("ClusteredBarChart_ToolTip");case 6:return this.hostServices.getLocalizedString("BarChart_ToolTip");case 7:return this.hostServices.getLocalizedString("HundredPercentStackedBarChart_ToolTip");case 8:return this.hostServices.getLocalizedString("HundredPercentStackedColumnChart_ToolTip");case 9:return this.hostServices.getLocalizedString("RibbonChart_ToolTip");case 10:return this.hostServices.getLocalizedString("ScatterChart_ToolTip");case 11:return this.hostServices.getLocalizedString("ComboChart_ToolTip");case 13:return this.hostServices.getLocalizedString("WaterfallChart_ToolTip");case 14:return this.hostServices.getLocalizedString("LineClusteredColumnComboChart_ToolTip");case 15:return this.hostServices.getLocalizedString("LineStackedColumnComboChart_ToolTip");case 16:return this.hostServices.getLocalizedString("DataDotClusteredColumnComboChart_ToolTip");case 17:return this.hostServices.getLocalizedString("DataDotStackedColumnComboChart_ToolTip");case 18:return this.hostServices.getLocalizedString("LineChart_ToolTip");case 19:return this.hostServices.getLocalizedString("Histogram_Tooltip")}return this.hostServices.getLocalizedString("Chart")},f.prototype.render=function(s,n,l,c,u,d,h,p,g,y,m,v){return __awaiter(this,void 0,S.Promise,function(){var t,i,a,r,o;return __generator(this,function(e){switch(e.label){case 0:return(this.cartesianSmallMultipleFactory=s,this.viewportScale=n.scale,s.clearRenderingTimeout(),t=s.getCoreMultiple(),i=t.getData())?(this.axesData=i.axesData,this.formatMode=y,o=this.renderLegend(i.legendData,n,p,y),a=o[0],o=o[1],this.chartAreaViewport={height:n.height-a.height,width:n.width-a.width,scale:n.scale},r=u.renderContainers(this.chartAreaViewport,this.axesData,this.isPlayAxis()?f.PlayAxisBottomMargin:0,this.featureSwitches),this.legendRenderer.adjustChartArea(u.context),this.positionChartArea(a,o,this.isPlayAxis(),r),o=this.calculatePlayAxisControlLayout(this.chartAreaViewport,a,this.legendRenderer.getPosition(),r),s.isSmallMultiples()?[3,1]:(this.cartesianSmallMultiplesLayout&&(this.cartesianSmallMultiplesLayout.destroy(),this.cartesianSmallMultiplesLayout=void 0),this.setGridContainerVisibility(!1),2&t.getState()||t.initRenderer(this.buildPlotAreaLayout(!1)),this.renderMultiple({multiple:t,viewport:n,background:c,axisZoom:u,chartAreaViewport:this.chartAreaViewport,chartAreaMargins:this.chartAreaMargins,renderedViewport:this.renderedPlotArea,playAxisControlLayout:o,suppressAnimations:h,resizeMode:v,trimOrdinalDataOnOverflow:d,categoryLoadMoreDataHandler:l,isSharedAxis:!1,isHierarchicalAxis:p,preserveScrollPosition:g,supportsScrolling:!0,formatMode:y,subSelectionHelper:m}),[3,3])):[2];case 1:return this.setGridContainerVisibility(!0),this.adjustGridContainer(this.chartAreaViewport),this.cartesianSmallMultiplesLayout=this.cartesianSmallMultiplesLayout||this.createSmallMultiplesLayout(),[4,this.cartesianSmallMultiplesLayout.render({viewport:this.chartAreaViewport,axisRendererSettings:this.getAxisRendererSettings(this.chartAreaSvg,!0,!1),cartesianSmallMultipleFactory:s,axesData:this.axesData,animationSettings:this.getAnimationOptions(!0),background:c,playAxisControlLayout:o,suppressAnimations:!0,resizeMode:v,isHierarchicalAxis:p,trimOrdinalDataOnOverflow:d,categoryLoadMoreDataHandler:l,warnings:i.warningObjectCollection})];case 2:e.sent(),e.label=3;case 3:return[2]}})})},f.prototype.setGridContainerVisibility=function(e){this.gridContainer.css("display",e?"":"none")},f.prototype.scrollRowsTo=function(e){this.cartesianSmallMultiplesLayout,this.cartesianSmallMultiplesLayout.scrollRowsTo(e)},f.prototype.destroy=function(){this.cartesianSmallMultiplesLayout&&this.cartesianSmallMultiplesLayout.destroy()},f.prototype.positionChartArea=function(e,t,i,a){this.chartAreaMargins=f.getEmptyMargins(),l.Legend.isLeft(t)&&(this.chartAreaMargins.left=e.width),l.Legend.isTop(t)&&(this.chartAreaMargins.top=e.height),i&&(this.chartAreaViewport.height-=f.PlayAxisBottomMargin),a&&(this.chartAreaViewport.height-=a.top+a.bottom,this.chartAreaViewport.width-=a.left+a.right,this.chartAreaMargins.left=(this.chartAreaMargins.left||0)+a.left,this.chartAreaMargins.top=(this.chartAreaMargins.top||0)+a.top),this.chartAreaSvg.attrs({width:this.chartAreaViewport.width,height:this.chartAreaViewport.height}).styles({"margin-top":this.chartAreaMargins.top?this.chartAreaMargins.top+"px":null,"margin-left":this.chartAreaMargins.left?this.chartAreaMargins.left+"px":null})},f.prototype.createSmallMultiplesLayout=function(){var t=this;return new l.CartesianSmallMultipleLayout(this.gridContainer,this.interactivityService,this.featureSwitches,function(e){return t.hostServices.getLocalizedString(e)},this.rowLoadMoreDataHandler,this.scrollOnRowsEnabled,this.behaviorFactory,this.layerStyle,this.viewMode,this.buildPlotAreaLayout.bind(this),this.renderMultiple.bind(this),this.adapterFactory,this.hostServices.instanceId,this.eventManager)},f.prototype.adjustGridContainer=function(e){this.gridContainer.css({width:e.width,height:e.height}),this.legendRenderer.adjustChartArea(d3.select(this.gridContainer.get(0)))},f.prototype.getVisibleMultiples=function(){return this.cartesianSmallMultiplesLayout?this.cartesianSmallMultiplesLayout.getVisibleMultiples():{startIndex:0,endIndex:1}},f.prototype.renderMultiple=function(e){var t=this,i=this.cartesianSmallMultipleFactory.isSmallMultiples(),a={scrollTo:function(e){return t.scrollTo(e)},shouldScrollTo:function(e){return t.shouldScrollTo(e)},scrollBy:function(e){return t.scrollBy(e)}},i={background:e.background,axisZoom:e.axisZoom,labelAnimationOptions:this.getLabelAnimationOptions(e.suppressAnimations),axesAnimationOptions:this.getAnimationOptions(e.suppressAnimations),renderedPlotArea:e.renderedViewport,viewport:e.viewport,chartAreaViewport:e.chartAreaViewport,chartAreaMargins:e.chartAreaMargins,layerStyle:this.layerStyle,suppressAnimations:e.suppressAnimations,playAxisControlLayout:e.playAxisControlLayout,resizeMode:e.resizeMode,viewMode:this.viewMode,trimOrdinalDataOnOverflow:e.trimOrdinalDataOnOverflow,categoryLoadMoreDataHandler:e.categoryLoadMoreDataHandler,shouldRenderGridLinesOnly:!1,isSmallMultiples:i,multipleId:e.multiple.index.toString(),isHierarchicalAxis:e.isHierarchicalAxis,preserveScrollPosition:e.preserveScrollPosition,supportsScrolling:e.supportsScrolling,navigationScrollCallbacks:a,formatMode:e.formatMode,subSelectionHelper:e.subSelectionHelper},a=e.multiple.getData(),r=(e.isSharedAxis&&(r=this.axesData.valueAxis.show,f.adjustOptionsForSharedAxis(i,e.viewport,e.axesLayout,a,this.featureSwitches,r)),e.multiple.getRenderer());r.axesRenderer.update(a.axesData,a.scrollbarOptions),r.render(e.multiple.layers,a,e.renderedViewport,i,this.viewportScale),this.noLabelsCanBeRendered=r.noLabelsCanBeRendered,this.renderedPlotArea=r.renderedPlotArea},f.prototype.scrollTo=function(e){this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?this.cartesianSmallMultiplesLayout.scrollTo(e):this.cartesianSmallMultipleFactory.scrollTo(e,this.getVisibleMultiples())},f.prototype.shouldScrollTo=function(e){return this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?this.cartesianSmallMultiplesLayout.shouldScrollTo(e):this.cartesianSmallMultipleFactory.shouldScrollTo(e,this.getVisibleMultiples())},f.prototype.scrollBy=function(e){this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?this.cartesianSmallMultiplesLayout.scrollBy(e):this.cartesianSmallMultipleFactory.scrollBy(e,this.getVisibleMultiples())},f.prototype.getLabelAnimationOptions=function(e){e=this.getAnimationOptions(e);return{duration:this.isPlayAxis()?l.PlayChart.getFrameAnimationDuration():e.duration,ease:this.isPlayAxis()?l.D3Helper.easeCompat(l.PlayChart.AnimationEase):e.ease}},f.prototype.getAnimationOptions=function(e){return{ease:this.animator&&this.animator.getEasing(),duration:l.AnimatorCommon.GetAnimationDuration(this.animator,e)}},f.prototype.calculatePlotArea=function(e){var t,i,a;return this.cartesianSmallMultipleFactory&&this.cartesianSmallMultipleFactory.isSmallMultiples()?{width:(a=this.cartesianSmallMultiplesLayout.calculatePlotArea(e)).width,height:a.height,scale:e.viewport.scale}:(a=e.viewport,i=e.axesMargins,t={width:a.width-(i.left+i.right),height:a.height-(i.top+i.bottom),scale:a.scale},a=a.width-(i.left+i.right),i=0,null!=e.layerSeriesData.defaultSeriesWidth&&(a=100*e.layerSeriesData.defaultSeriesWidth/a,i=Math.min(Math.max(1,a),50),e.layerSeriesData.seriesMaximumWidth=i),a=e.layerSeriesData.seriesMaximumWidth/100,e&&e.showSeriesLabels&&(t.width=t.width-a*t.width),t)},f.adjustOptionsForSharedAxis=function(e,t,i,a,r,o){!r.smallMultiplesUnsharedAxes||a.axesData.y.sharedAxis&&a.axesData.x.sharedAxis?(i.shouldRenderAxis.x=!1,i.shouldRenderAxis.y=!1,i.shouldRenderAxis.y2=!1,i.margin=i.axesOverflow,e.shouldRenderGridLinesOnly=!0):e.shouldRenderGridLinesOnly=!o,i.viewport=t,e.axesLayout=i},f.getEmptyMargins=function(){return{top:0,bottom:0,left:0,right:0}},f.prototype.getAxisRendererSettings=function(e,t,i){var a=this,e={axes:this.axes,container:e,type:this.type,data:this.axesData,interactivity:this.options.interactivity,interactivityService:this.interactivityService,behavior:this.axisBehavior,animateCategoryAxis:this.animateCategoryAxis,animateValueAxis:this.animateValueAxis,calculatePlotArea:function(e){return a.calculatePlotArea(e)},hostServices:this.hostServices,tooltipService:this.tooltipService,eventManager:this.eventManager,featureSwitches:this.featureSwitches,formatMode:this.formatMode};return t&&(e.onScroll=function(e){return a.cartesianSmallMultiplesLayout.onScroll(e)},e.onExtentUpdate=function(e){return a.cartesianSmallMultiplesLayout.onExtentUpdate(e)},e.suppressBrush=i),e.data.useManagedTabIndex=!1,e},f.prototype.calculatePlayAxisControlLayout=function(e,t,i,a){var r;return this.isPlayAxis()&&(r=(null==a?void 0:a.left)||0,a=(null==a?void 0:a.bottom)||0,r={left:l.Legend.isLeft(i)?t.width:0,top:l.Legend.isTop(i)?t.height+e.height+a:e.height+a,height:f.PlayAxisBottomMargin,width:e.width+r}),r},f.addCartesianChartContainer=function(e,t){var e=d3.select(e.get(0)),i=e.select("svg"),e=(i.empty()&&((i=e.append("svg")).classed(f.ClassName,!0),i.style("position","absolute")),l.appendClearCatcher(i));return t&&i.attrs({width:t.width,height:t.height}),{element:i,clearCatcher:e}},f.prototype.renderLegend=function(e,t,i,a){return this.legendRenderer=new r(this.legend,e,t,this.options.interactivity),this.legendRenderer.render(i,a),[this.legendRenderer.getMargin(),this.legendRenderer.getPosition()]},f.prototype.buildPlotAreaLayout=function(e,t,i,a,r){var o=this.getAxisRendererSettings(t||this.chartAreaSvg,e,e&&this.isSharedAxis),o=new l.CartesianAxesRenderer(o);return new l.CartesianPlotAreaLayout(this.visibilityHelper,t||this.chartAreaSvg,o,a||this.element,this.type,this.hostServices,r||this.behavior,this.interactivityService,this.isLabelInteractivityEnabled,i||this.clearCatcher,this.animator,this.dataPointLassoSelect&&!e,this.viewportScale,this.featureSwitches)},f.shouldRenderAxis=function(e,t){return{x:e.x.show,y:e.y.show,y2:e.y2.show||t&&!1!==e.y2.show}},f.getPreferredPlotArea=function(e,t,i,a,r,o,s){i={height:i.height-(o=o||{top:0,right:0,bottom:0,left:0}).top-o.bottom,width:i.width-o.left-o.right};return!r&&a&&(o=f.getPreferredCategorySpan(e,t,s),i.width=Math.max(o,i.width)),i},f.getPreferredCategorySpan=function(e,t,i){return t*e+t*(i||0)*2},f.getLayout=function(e,t){var i=t.categoryCount,a=t.availableWidth,r=!!t.isScalar,o=!!t.isScrollable,e=f.getCategoryWidth(e?e.series:null,t),e=f.getCustomizedCategoryWidthInfo(e,t),s=e.categoryWidth,e=e.outerPaddingRatio,n=S.Double.floorWithPrecision((a-s*e*2)/s),n=Math.min(n,i);return r||n<i&&o||(e=Math.max(0,(a-s*n)/2/s),e=S.Double.equalWithPrecision(e,0)?0:e),{categoryCount:n=!r&&o?i:n,categoryThickness:s,outerPaddingRatio:e,innerPaddingRatio:t.innerPaddingRatio,isScalar:r}},f.getCustomizedCategoryWidthInfo=function(e,t){var i=e,a=t.categoryCount,r=t.availableWidth,o=t.isScalar,s=t.preferredCategoryWidth,t=t.outerPaddingRatio;return{categoryWidth:i=o||null==s||s<e?i:(o=Math.floor((r-s*t*2)/s))<=0?r/(1+2*t):o<a?(t=(r-s*o)/(2*s),s):Math.min(s,r),outerPaddingRatio:t}},f.getCategoryWidth=function(e,t){var i,a=t.categoryCount,r=t.availableWidth,o=t.domain,s=t.isScalar,n=t.trimOrdinalDataOnOverflow,t=t.outerPaddingRatio,o=(a<2?i=r*(1-t):s&&o&&1<o.length?(i=r*((e=f.getMinInterval(e))/(o[o.length-1]-o[0]+e*t*2)),i=Math.max(i,l.CartesianChart.MinScalarRectThickness)):(i=r/(a+2*t),n&&(i=Math.max(i,l.CartesianHelper.MinOrdinalRectThickness))),r/(3+2*t));return i=Math.min(i,o),!s&&3<=a&&n?Math.max(i,l.CartesianHelper.MinOrdinalRectThickness):i},f.getMinInterval=function(e){var t=Number.MAX_VALUE;if(0<e.length)for(var i=e[0].data.filter(function(e){return!e.highlight}),a=0,r=i.length-1;a<r;a++){var o=i[a+1].categoryValue,s=i[a].categoryValue;_.isNumber(o),_.isNumber(s),t=Math.min(t,Math.abs(o-s))}return t},f.ClassName="cartesianChart",f.IconClassName="cartesianChartResponsiveIcon",f.GridContainerClassName="cartesian-grid-container",f.PlayAxisBottomMargin=80;var i=f;function f(e,t,i,a,r,o,s,n,l){this.behaviorFactory=t,this.featureSwitches=i,this.axes=a,this.type=r,this.isPlayAxis=o,this.axesData=s,this.scrollOnRowsEnabled=n,this.adapterFactory=l,this.animateCategoryAxis=!1,this.animateValueAxis=!1,this.isSharedAxis=!0,e&&(this.viewMode=0,this.isLabelInteractivityEnabled=e.isLabelInteractivityEnabled,this.dataPointLassoSelect=this.featureSwitches.dataPointLassoSelect&&e.dataPointLassoSelect,this.animator=e.animator,this.animateCategoryAxis=e.animateCategoryAxis,this.animateValueAxis=e.animateValueAxis)}l.CartesianChartLayout=i}(powerbi=powerbi||{}),function(e){var l,c,u,d,s;l=e.visuals||(e.visuals={}),s=e.visuals.OnObjectUtil,(e=l.CartesianChartOnObjectUtil||(l.CartesianChartOnObjectUtil={})).getAxisTitleSubSelectionStyles=function(e,t,i){var a=u(e,t),e=d(e,t,"title"),t={cardUid:a,groupUid:e,sliceUid:"".concat(e,"-font")},a={cardUid:a,groupUid:e,sliceUid:"".concat(e,"-color")};return s.getFontOnlyTextSubSelectionStyles(i,{fontReference:t,fontColorReference:a})},e.getAxisValuesSubSelectionStyles=function(e,t,i,a){var i=c(t,i),r=u(e,t),e=d(e,t,t&&i?"valuesScalar":"values"),t={cardUid:r,groupUid:e,sliceUid:"".concat(e,"-font")},i={cardUid:r,groupUid:e,sliceUid:"".concat(e,"-color")},o={cardUid:r,groupUid:e,sliceUid:"".concat(e,"-precision")},r={cardUid:r,groupUid:e,sliceUid:"".concat(e,"-displayUnits")};return s.getNumericTextSubSelectionStyles(a,{fontReference:t,fontColorReference:i,precisionReference:o,displayUnitsReference:r})},e.getAxisTitleSubSelectionShortcuts=function(e,t,i,a){var r=u(e,t),o=d(e,t,"title"),r=[{type:1,destinationUids:[{cardUid:r,groupUid:o}],label:a.getLocalizedString("Format_AxisTitle")}],e="".concat("zoom","-default-").concat(e?"valueSecAxis":t?"categoryAxis":"valueAxis"),s="".concat("Visual","-").concat("zoom");return c(t,i)&&r.unshift({type:2,sourceUid:e,relatedToggledSourceUids:[{sourceUid:s}],enabledLabel:a.getLocalizedString("Format_AddZoomSlider")}),r.unshift({type:2,sourceUid:o,disabledLabel:a.getLocalizedString("Delete"),keyboardShortcuts:[{key:"Delete",nextValue:!1}]},{type:0,excludedResetSourceUids:[{sourceUid:o},{sourceUid:s},{sourceUid:e}]}),r},e.getAxisValuesSubSelectionShortcuts=function(e,t,i,a,r){var i=c(t,i),o=u(e,t),s=[{type:1,destinationUids:[{cardUid:o,groupUid:d(e,t,t&&i?"valuesScalar":"values")}],label:r.getLocalizedString("Format_AxisValues")}],a=(i||s.unshift({type:4,sortableField:{queryName:"",sortDirection:1},label:r.getLocalizedString("Format_SortAxis"),key:"Category"}),t&&a===l.axisType.both&&(a="".concat(d(e,t,"type"),"-type"),s.unshift({type:3,sourceUid:a,label:r.getLocalizedString("Format_Label_AxisType")})),"".concat("zoom","-default-").concat(e?"valueSecAxis":t?"categoryAxis":"valueAxis")),n="".concat("Visual","-").concat("zoom"),i=(i&&s.unshift({type:2,sourceUid:a,relatedToggledSourceUids:[{sourceUid:n}],enabledLabel:r.getLocalizedString("Format_AddZoomSlider")}),d(e,t,"title"));return s.unshift({type:2,sourceUid:i,enabledLabel:r.getLocalizedString("Format_AddAxisTitle")}),s.unshift({type:2,sourceUid:o,disabledLabel:r.getLocalizedString("Delete"),keyboardShortcuts:[{key:"Delete",nextValue:!1}]},{type:0,excludedResetSourceUids:[{sourceUid:o},{sourceUid:n},{sourceUid:a}]}),s},c=function(e,t){return!e||t},u=function(e,t){return e?"".concat("Visual","-").concat("y2Axis"):t?"".concat("Visual","-").concat("categoryAxis"):"".concat("Visual","-").concat("valueAxis")},d=function(e,t,i){return"".concat(e?"y2Axis":t?"categoryAxis":"valueAxis","-").concat(i)},e.getAxisSliceUid=function(e,t,i,a){return"".concat(d(e,t,i),"-").concat(a)}}(powerbi=powerbi||{}),function(S){var A;function e(e,t,i,a,r,o,s,n,l,c,u,d,h,p){this.visibilityHelper=e,this.chartAreaSvg=t,this.axesRenderer=i,this.element=a,this.type=r,this.hostServices=o,this.behavior=s,this.interactivityService=n,this.isLabelInteractivityEnabled=l,this.clearCatcher=c,this.animator=u,this.dataPointLassoSelect=d,this.initialViewportScale=h,this.featureSwitches=p,this.dataPointNavigationHelper=new A.CartesianChartNavigationHelper,this.dataPointLassoSelect&&(this.plotLassoManager=new A.PlotAreaLassoManager(!1),this.plotLassoManager.init([i.getLayerContainer(),c],t,this.hostServices,this.featureSwitches),this.lassoSelectionBehavior=new A.LassoSelectionBehavior(this.behavior),this.plotLassoManager.behaviors.push(this.lassoSelectionBehavior),this.plotLassoManager.setUiScale(this.initialViewportScale))}A=S.visuals||(S.visuals={}),e.prototype.attachToElement=function(e,t){this.element=e;var i=this.chartAreaSvg;i.attrs({width:t.width,height:t.height}),i.node().parentElement!==e.get(0)&&e.append(i.node())},e.prototype.render=function(e,t,i,a,r){this.options=a,this.renderedPlotArea=i,this.cartesianData=t,this.layers=e,this.plotLassoManager&&this.plotLassoManager.setUiScale(r),this.cartesianData&&(this.cartesianData.showIcon?this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon,viewport:this.options.viewport}):(this.visibilityHelper.updateVisibility({showIcon:this.cartesianData.showIcon}),this.renderCartesianChart()))},e.prototype.destroy=function(){this.axesRenderer.destroy(),this.chartAreaSvg.html(null),A.visualBackgroundHelper.removeBackgroundImage(this.element)},e.prototype.renderCartesianChart=function(){var a=this,r=this.options,e=!this.renderedPlotArea||this.renderedPlotArea.height!==r.chartAreaViewport.height||this.renderedPlotArea.width!==r.chartAreaViewport.width,e=(this.renderedPlotArea=r.chartAreaViewport,__assign(__assign({},r),{suppressAnimations:r.suppressAnimations||e,playAxesRect:r.playAxisControlLayout,animationDuration:r.axesAnimationOptions.duration,ease:r.axesAnimationOptions.ease,supportsScrolling:r.supportsScrolling,formatMode:r.formatMode,subSelectionHelper:r.subSelectionHelper}));this.axesRenderer.render(this.cartesianData.axesData,this.options.axisZoom,this.layers,this.cartesianData.referenceLines,this.options.chartAreaViewport,function(e,t,i){return a.renderPlotArea(e,t,i,r.resizeMode)},e,void 0,this.options.axesLayout),this.dataPointNavigationHelper.updateScrollCallbacks(r.supportsScrolling?r.navigationScrollCallbacks:void 0)},e.prototype.getPlotAreaRect=function(e){return{left:e.margin.left+this.options.chartAreaMargins.left,top:e.margin.top+this.options.chartAreaMargins.top,width:e.plotArea.width,height:e.plotArea.height}},e.prototype.renderBackgroundImage=function(e){A.visualBackgroundHelper.renderBackgroundImage(this.options.background,this.element,e)},e.prototype.renderPlotArea=function(e,t,i,a){i=i||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()});var r=this.getPlotAreaRect(t);this.renderBackgroundImage(r),this.renderReferenceLines(t),this.renderLayers(e,t,i,a),this.renderTrendLines(t)},e.prototype.renderTrendLines=function(e){var t=this.axesRenderer.getLayerContainer();A.TrendLineHelper.render(this.cartesianData.trendLines,t,e.axes,e.plotArea)},e.prototype.renderReferenceLines=function(e){e={graphicContext:this.axesRenderer.getLayerContainer(),axes:e.axes,viewport:e.plotArea,referenceLines:this.cartesianData.referenceLines};A.ReferenceLineHelper.render(e)},e.prototype.getReferenceLineLabels=function(e,t){e={axes:e,viewport:t,referenceLines:this.cartesianData.referenceLines,hostServices:this.hostServices,style:this.options.layerStyle};return A.ReferenceLineHelper.createLabelDataPoint(e)},e.prototype.renderDataLabels=function(e,t,i,a,r,o){var s,n,l,c,u=this.axesRenderer.getDataLabelContainers(),d=u.foreground,u=u.background,h=[],p=this.options,g=p.formatMode,p=p.labelAnimationOptions;this.behavior?(n=this.animator,s=A.DataLabelRenderer.getDataLabelLayoutOptions(this.type),h=new S.LabelLayout(s).layout(e,i),l=void 0,l=n&&!a&&o?A.DataLabelRenderer.animateLabelsAndBackgrounds({labelContext:d,dataLabels:h,duration:p.duration,numeric:t,easeType:p.ease,backgroundContext:u,formatMode:g,onObject:this.featureSwitches.onObject}):A.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:d,dataLabels:h,numeric:t,backgroundContext:u,formatMode:g,onObject:this.featureSwitches.onObject}),s.allowLeaderLines&&(n=_.filter(h,function(e){return null!=e.leaderLinePoints&&!_.isEmpty(e.leaderLinePoints)&&null!=e.identity}),A.DataLabelRenderer.drawLabelLeaderLines(d,n,function(e){return e.identity.getKey()})),this.interactivityService&&(this.isLabelInteractivityEnabled||g)&&(a={labelItems:l},this.interactivityService.bind(h,new A.LabelsBehavior,a,{isLabels:!0,pointSourceKey:"data-labels",formatMode:g}))):(h=new S.LabelLayout({maximumOffset:A.DataLabelViewModel.maxLabelOffset,startingOffset:A.DataLabelViewModel.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0}).layout(e,i),A.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:d,dataLabels:h,numeric:t,backgroundContext:u,formatMode:g,onObject:this.featureSwitches.onObject}));for(var y=0,m=e;y<m.length;y++){var v=m[y];if(!_.isEmpty(v.labelDataPoints)){c=!0;break}}return!_.isEmpty(h)||!c},e.prototype.renderSeriesLabels=function(e,t,i,a,r){var o,s=this.axesRenderer.getSeriesLabelContainers(),n=s.seriesForeground,s=s.seriesBackground,l=new S.LabelLayout({maximumOffset:A.DataLabelViewModel.maxLabelOffset,startingOffset:A.DataLabelViewModel.startingLabelOffset,attemptToMoveLabelsIntoViewport:!0}),c=!!i&&!!i.seriesWordWrap,u=i?i.fontProperties.size.px:0,l=l.layout(e,t),a=i?i.seriesMaximumWidth/100*a:0,i=i&&i.seriesPosition===A.labelSeriesPosition.right?1:0;A.DataLabelRenderer.drawSeriesLabelsAndBackgrounds({labelContext:n,dataLabels:l,backgroundContext:s,availableWidth:a,position:i,seriesWordWrap:c,plotArea:t,seriesFontSize:u,formatMode:r,onObject:this.featureSwitches.onObject});for(var d=0,h=e;d<h.length;d++){var p=h[d];if(!_.isEmpty(p.labelDataPoints)){o=!0;break}}return!_.isEmpty(l)||!o},e.prototype.renderLayers=function(e,t,i,a){for(var r,o,s,n=[],l=[],c=[],u=[],d=!0,h=t.axes,p=t.plotArea,g=(i=i||_.some(e,function(e){return e.shouldSuppressAnimation&&e.shouldSuppressAnimation()}),!0),y=0,m=e;y<m.length;y++){var v=m[y].render(i,a,this.options.formatMode);if(v){if(v.animateLabels||(g=!1),this.behavior&&(c=c.concat(v.dataPoints),u.push(v.behaviorOptions),v.navigationOptions)&&(r?r.navigationOptions.navigationStrategy=A.DataPointNavigationStrategy.CategoryFirst:(r={pointSourceKey:"cartesian-layer ".concat(this.options.multipleId||""),navigationOptions:{navigationStrategy:v.navigationOptions.navigationStrategy,helper:this.dataPointNavigationHelper}},this.dataPointNavigationHelper.clearNavigationLayers()),r.isHierarchicalAxis=this.options.isHierarchicalAxis,this.dataPointNavigationHelper.addNavigationLayer(v.navigationOptions.helper)),v.labelDataPointGroups)for(var S=0,f=v.labelDataPointGroups;S<f.length;S++)(x=f[S])&&n.push({labelDataPoints:A.DataLabelRenderer.removeDuplicates(x.labelDataPoints||[]),maxNumberOfLabels:x.maxNumberOfLabels,labelOrientation:x.isTotal?1:v.labelOrientation});else{var b=v.labelDataPoints||[];n.push({labelDataPoints:A.DataLabelRenderer.removeDuplicates(b),maxNumberOfLabels:b.length,labelOrientation:v.labelOrientation})}if(v.labelDataPointSeriesGroups)for(var x,C=0,w=v.labelDataPointSeriesGroups;C<w.length;C++)(x=w[C])&&l.push({labelDataPoints:A.DataLabelRenderer.removeDuplicates(x.labelDataPoints||[]),maxNumberOfLabels:x.maxNumberOfLabels,labelOrientation:x.isTotal?1:v.labelOrientation});d=d&&v.labelsAreNumeric,this.lassoSelectionBehavior&&(void 0!==v.categorySubRangeCount&&(void 0===o?o=v.categorySubRangeCount:v.categorySubRangeCount),void 0!==v.verticalCategoryAxis)&&(void 0===s?s=v.verticalCategoryAxis:v.verticalCategoryAxis)}}var h=this.getReferenceLineLabels(h,p),h=(_.isEmpty(h)||n.unshift({labelDataPoints:h,maxNumberOfLabels:h.length}),this.noLabelsCanBeRendered=!this.renderDataLabels(n,d,p,i,A.ComboChart.isComboChart(this.type),g),A.CartesianChartConverter.isLineComboChart(this.type)?A.CartesianChartConverter.getMaximumSeriesSettings(e):A.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings()),e=t.viewport,D=t.margin,e=e.width-(D.left+D.right);this.noSeriesLabelsCanBeRendered=!this.renderSeriesLabels(l,p,h,e,this.options.formatMode),this.dataPointNavigationHelper.getPendingFocusElement&&r&&(r.navigationOptions.focusElement=this.dataPointNavigationHelper.getPendingFocusElement()),this.interactivityService&&(D={layerOptions:u,clearCatcher:this.clearCatcher,root:this.chartAreaSvg,axesLayout:t,categorySubRangeCount:o,verticalCategoryAxis:s},this.interactivityService.bind(c,this.behavior,D,r))},A.CartesianPlotAreaLayout=e}(powerbi=powerbi||{}),function(n){var p;function e(e){this.switchAxisPosition=e,this.unSyncedLayout=[],this.maxMargin={top:0,bottom:0,left:0,right:0},this.axesRenderersByPosition=((e={})[2]=[],e[0]=[],e[1]=[],e)}p=n.visuals||(n.visuals={}),e.prototype.update=function(e,t,i,a,r,o,s,n){this.settings=e,this.coreMultiple=s,this.renderOptions=i,this.maxMargin={bottom:0,left:0,right:0,top:0},this.unSyncedLayout=[];var l=_.clone(this.getCoreMultipleData()),e=this.coreMultiple.layers;if(n.smallMultiplesUnsharedAxes&&!this.shouldShareAxis()){for(var c=0,u=t;c<u.length;c++){var d=u[c],h=d.getData(),d=d.layers,h=(h.axesData.x.showAxisTitle=!1,h.axesData.y.showAxisTitle=!1,h.axesData.y2.showAxisTitle=!1,l.axesData.y.sharedAxis||(h.axesData.x.show=!1),l.axesData.x.sharedAxis||(h.axesData.y.show=!1),p.CartesianAxesLayoutBuilder.build({data:h.axesData,interactivityOptions:this.settings.interactivity,referenceLines:h.referenceLines,type:this.settings.type,axes:this.settings.axes,layers:d,viewport:a,playAxesRect:this.renderOptions.playAxesRect,calculatePlotArea:this.settings.calculatePlotArea,trimOrdinalDataOnOverflow:this.renderOptions.trimOrdinalDataOnOverflow,axisZoom:void 0,rotateXTickLabels90:!0,featureSwitches:n}));this.unSyncedLayout.push(h),h.margin.left>=this.maxMargin.left&&(this.maxMargin.left=h.margin.left),h.margin.right>=this.maxMargin.right&&(this.maxMargin.right=h.margin.right),h.margin.top>=this.maxMargin.top&&(this.maxMargin.top=h.margin.top),h.margin.bottom>=this.maxMargin.bottom&&(this.maxMargin.bottom=h.margin.bottom)}(l=_.clone(t[0].getData())).axesData.x.showAxisTitle=this.getCoreMultipleData().axesData.x.showAxisTitle,l.axesData.y.showAxisTitle=this.getCoreMultipleData().axesData.y.showAxisTitle,l.axesData.y.sharedAxis||(l.axesData.x.show=this.getCoreMultipleData().axesData.x.show,l.axesData.y.show=!1,l.axesData.y2&&(l.axesData.y2.show=!1,l.axesData.y2.showAxisTitle=this.getCoreMultipleData().axesData.y.showAxisTitle)),l.axesData.x.sharedAxis||(l.axesData.x.show=!1,l.axesData.y.show=this.getCoreMultipleData().axesData.y.show)}return this.generateSharedAxisLayout(l,e,a,r,o,n),this.unSyncedLayout},e.prototype.generateSharedAxisLayout=function(e,t,i,a,r,o){o.smallMultiplesUnsharedAxes&&!this.shouldShareAxis()&&(s=__assign({},this.maxMargin));var s,e={data:e.axesData,interactivityOptions:this.settings.interactivity,referenceLines:e.referenceLines,type:this.settings.type,axes:this.settings.axes,layers:t,viewport:i,playAxesRect:this.renderOptions.playAxesRect,calculatePlotArea:this.settings.calculatePlotArea,trimOrdinalDataOnOverflow:this.renderOptions.trimOrdinalDataOnOverflow,axisZoom:void 0,rotateXTickLabels90:!0,featureSwitches:o,forceMarginMin:s};this.layout=p.CartesianAxesLayoutBuilder.build(e),this.clearUnusedRenderers(a,r,this.layout.shouldRenderAxis,this.layout)},e.prototype.getCoreMultipleData=function(){return this.coreMultiple.getData()},e.prototype.shouldShareAxis=function(){return this.getCoreMultipleData().axesData.x.sharedAxis&&this.getCoreMultipleData().axesData.y.sharedAxis},e.prototype.clearUnusedRenderers=function(e,t,i,a){e=i.x||a.isXScrollBarVisible?e:0,this.destroyUnusedRenderers(e,2);var e=i.y||a.isYScrollBarVisible?t:0,r=this.switchAxisPosition?this.settings.data.y.switchAxisPosition?p.yAxisPosition.right:p.yAxisPosition.left:this.settings.data.y.position,r=this.shouldRenderYAxis(0,r)?0:1,e=(this.destroyUnusedRenderers(e,r),i.y2||a.isYScrollBarVisible?t:0);this.destroyUnusedRenderers(e,0==r?1:0)},e.prototype.destroyUnusedRenderers=function(e,t){var i=this.axesRenderersByPosition[t];_.isEmpty(i)||i.length<=e||(i.slice(e,i.length).forEach(function(e){return e.destroy()}),this.axesRenderersByPosition[t]=i.slice(0,e))},e.prototype.calculateAxesLayout=function(e,t){return!e.smallMultiplesUnsharedAxes||this.shouldShareAxis()||void 0===t?this.calculateSynchronizedAxesLayout():void 0!==t?this.calculateUnSynchronizedAxesLayout(t):this.layout},e.prototype.calculateSynchronizedAxesLayout=function(){var e=_.cloneDeep(this.layout),t=(n.Prototype.copyPrototypeDeep(this.layout,e),e.axes);return t.x.scale=t.x.scale.copy(),t.y1.scale=t.y1.scale.copy(),t.y2&&(t.y2.scale=t.y2.scale.copy()),e},e.prototype.calculateUnSynchronizedAxesLayout=function(e){var t,i,a,r=_.cloneDeep(this.unSyncedLayout[e]),e=(n.Prototype.copyPrototypeDeep(this.unSyncedLayout[e],r),r.axes),o=r.plotArea=this.layout.plotArea,s=this.getCoreMultipleData().axesData;return s.y.sharedAxis||(r.axes.x.outerPadding=this.layout.axes.x.outerPadding,r.axes.x.outerPaddingRatio=this.layout.axes.x.outerPaddingRatio,r.axes.x.xLabelMaxWidth=this.layout.axes.x.xLabelMaxWidth,r.axes.x.categoryThickness=this.layout.axes.x.categoryThickness,r.isXScrollBarVisible=this.layout.isXScrollBarVisible,i=this.layout.axesOverflow.bottom+this.layout.axesOverflow.top-(r.axesOverflow.bottom+r.axesOverflow.top),a=r.axes.y1.scale,r.axes.y1.invertAxis?a.range([1,o.height+i-1]):a.range([o.height+i-1,1]),e.x.scale=this.layout.axes.x.scale.copy(),r.axes.y2&&(t=r.axes.y2.scale,r.axes.y1.invertAxis?t.range([1,o.height+i-1]):t.range([o.height+i-1,1])),r.margin.left=Math.max(this.maxMargin.left,r.margin.left),r.margin.right=Math.max(this.maxMargin.right,r.margin.right)),s.x.sharedAxis||(r.axes.y1.outerPadding=this.layout.axes.y1.outerPadding,r.axes.y1.outerPaddingRatio=this.layout.axes.y1.outerPaddingRatio,r.axes.y1.xLabelMaxWidth=this.layout.axes.y1.xLabelMaxWidth,r.axes.y1.categoryThickness=this.layout.axes.y1.categoryThickness,r.isYScrollBarVisible=this.layout.isYScrollBarVisible,t=this.layout.axesOverflow.left+this.layout.axesOverflow.right-(r.axesOverflow.left+r.axesOverflow.right),i=r.axes.x.scale,r.axes.x.invertAxis?i.range([o.width+t-1,1]):i.range([1,o.width+t-1]),s.x.show||(a=e.y1.scale,p.AxisHelper.isScaleBand(a)?(a.range([0,r.plotArea.height]),a.paddingOuter(r.axes.y1.outerPaddingRatio)):(o=null!=(i=e.y1.outerPadding)?i:0,a.range([r.plotArea.height-o,o]))),r.margin.bottom=Math.max(this.maxMargin.bottom,r.margin.bottom),r.margin.top=Math.max(this.maxMargin.top,r.margin.top)),r},e.prototype.renderAxes=function(e,t){var i,a,r,o;e.viewport.height<1||e.viewport.width<1||(r=p.CartesianChartLayout.addCartesianChartContainer(e.element,e.viewport),i=this.getCoreMultipleData(),a=__assign(__assign({},this.renderOptions),{supportsScrolling:this.shouldSupportScrolling(i,e.position),formatMode:this.settings.formatMode,subSelectionHelper:void 0}),r=this.getAxesRenderer(r.element,e.position,e.index,i),o=this.coreMultiple.layers,t=this.updateAxesLayoutByPosition(e.position,e.viewport,t),r.render(i.axesData,void 0,o,i.referenceLines,e.viewport,function(){},a,this.useManagedTabIndex(),t))},e.prototype.scrollDelta=function(t,e){this.updateScrollState(function(e){return e.scrollDelta(t)},e)},e.prototype.scrollTo=function(t,e){this.updateScrollState(function(e){return e.scrollTo(t)},e)},e.prototype.scrollBy=function(t,e){this.updateScrollState(function(e){return e.scrollBy(t)},e)},e.prototype.updateScrollbarExtent=function(t,e){this.updateScrollState(function(e){return e.setExtent(t)},e)},e.prototype.updateScrollState=function(i,a){var e=this.getCoreMultipleData(),r=this.getScrollablePosition(e),e=this.axesRenderersByPosition[r];2!==r&&_.isEmpty(a)||_.isEmpty(e)||e.forEach(function(e,t){2!==r&&(t<a.startIndex||t>a.endIndex)||i(e)})},e.prototype.updateAxesLayoutByPosition=function(e,t,i){var a=this.calculateAxesLayout(i),t=(a.viewport=this.adjustViewportForScroll(t,a.scrollHandleMargins),a.preferredPlotArea={width:0,height:0},this.getCoreMultipleData());return 2===e?(a.margin=this.getMarginByPosition(a.margin,e,a.axesOverflow),i.smallMultiplesUnsharedAxes&&(!t.axesData.y.sharedAxis&&t.axesData.y.show&&(a.margin.left=this.layout.margin.left,a.shouldRenderAxis.y=!1),t.axesData.x.sharedAxis||(a.margin.bottom=this.layout.margin.bottom),!this.shouldShareAxis())||(a.shouldRenderAxis.y=!1),a.shouldRenderAxis.y2=!1,a.shouldRenderAxis.y=!1,a.axisLabels.y=null,a.axisLabels.y2=null,a.plotArea.height=0):(i=this.switchAxisPosition?this.settings.data.y.switchAxisPosition?p.yAxisPosition.right:p.yAxisPosition.left:this.settings.data.y.position,t=this.shouldRenderYAxis(e,i),a.plotArea.width=0,t?(a.margin=this.getMarginByPosition(a.margin,e,a.axesOverflow),a.axisLabels.x=null,a.axisLabels.y2=null,a.shouldRenderAxis.x=!1,a.shouldRenderAxis.y2=!1):(a.shouldRenderAxis.x=!1,a.shouldRenderAxis.y=!1,a.axisLabels.x=null,a.axisLabels.y=null,a.margin=this.getMarginByPosition(a.margin,e,a.axesOverflow))),a},e.prototype.destroy=function(){var i=this;this.executeActionByPosition(this.axesRenderersByPosition,function(e,t){_.isEmpty(e)||(e.forEach(function(e){return e.destroy()}),i.axesRenderersByPosition[t]=[])})},e.prototype.executeActionByPosition=function(e,t){for(var i in this.axesRenderersByPosition)t(e[i],i)},e.prototype.clearRenderingTimeout=function(){this.executeActionByPosition(this.axesRenderersByPosition,function(e){_.isEmpty(e)||e.forEach(function(e){return e.clearRenderingTimeout()})})},e.prototype.shouldRenderYAxis=function(e,t){return 0===e&&t===p.yAxisPosition.left||1===e&&t===p.yAxisPosition.right},e.prototype.getMarginByPosition=function(e,t,i){i=n.Prototype.inherit(i);return 2===t?(i.bottom=e.bottom,i.top=0):(i.left=0,(i.right=0)===t?i.left=e.left:1===t&&(i.right=e.right)),i},e.prototype.getScrollablePosition=function(e){var e=e.axesData,t=this.layout,i=!1;return(this.switchAxisPosition&&e.y&&e.y.switchAxisPosition||e.y&&e.y.position===p.yAxisPosition.right)&&(i=!0),t.isYScrollBarVisible?i?1:0:t.isXScrollBarVisible?2:void 0},e.prototype.shouldSupportScrolling=function(e,t){return this.getScrollablePosition(e)===t},e.prototype.getAxesRenderer=function(e,t,i,a){var r=$(e.node()),o=r.data("CartesianAxesRenderer");return o?o.update(a.axesData,a.scrollbarOptions):((a=n.Prototype.inherit(this.settings)).container=e,a.multipleId=""+i,a.behavior=new p.AxisBehavior,a.data.useManagedTabIndex=!0,this.axesRenderersByPosition[t][i]=o=new p.CartesianAxesRenderer(a),r.data("CartesianAxesRenderer",o)),o},e.prototype.adjustViewportForScroll=function(e,t){return t?{width:e.width-(t.left+t.right),height:e.height-(t.top+t.bottom),scale:e.scale}:e},e.prototype.useManagedTabIndex=function(){return this.renderOptions.isSmallMultiples},p.CartesianSharedAxisLayout=e}(powerbi=powerbi||{}),function(C){var w;function g(e,t,i,a,r,o,s,n,l,c,u,d,h,p){this.interactivityService=t,this.featureSwitches=i,this.getLocalizedString=a,this.behaviorFactory=s,this.layerStyle=n,this.viewMode=l,this.buildPlotAreaLayout=c,this.renderMultiple=u,this.adapterFactory=d,this.visualInstanceId=h,this.isSharedAxis=!0,this.sharedAxisLayout=new w.CartesianSharedAxisLayout(i.switchAxisPosition),this.gridLayout=new w.GridLayout(e,function(){return r.loadMoreData()},o,t,p,"multiple"),this.visibilityHelper=C.responsiveVisualUtilModuleFactory().visibilityHelper(e,g.IconClassName)}w=C.visuals||(C.visuals={}),g.prototype.render=function(t){var e,i,a=this,r=(this.clearRenderingTimeout(),t.cartesianSmallMultipleFactory),o=(this.options=t).cartesianSmallMultipleFactory,s=this.adapterFactory(),n=s.getMultiplesSubheader(t.warnings),s=this.multiplesLayout=s.getMultiplesLayout(t.warnings),l=s.showIcon;if(this.visibilityHelper.updateVisibility({showIcon:l,viewport:t.viewport}),!l)return l={type:s.gridLineType,settings:{color:s.gridLineColor,style:s.gridLineStyle,width:s.gridLineWidth}},i=this.featureSwitches,e=this.getCellPadding(s,i),i=this.getOuterPadding(s,i),s={categoryLoadMoreDataHandler:t.categoryLoadMoreDataHandler,playAxisControlLayout:t.playAxisControlLayout,trimOrdinalDataOnOverflow:t.trimOrdinalDataOnOverflow,suppressAnimations:t.suppressAnimations,resizeMode:t.resizeMode,rowCount:s.rowCount,columnCount:s.columnCount,getCellBackgroundColor:function(e){return a.getColorFromMultipleObjects(e,w.StandardObjectPropertyIdentifiers.smallMultiplesBackgroundColor,a.multiplesLayout.backgroundColor)},backgroundTransparency:s.backgroundTransparency,isHierarchicalAxis:t.isHierarchicalAxis,gridLineSettings:l,cellPadding:e,outerPadding:i},this.cellDimensions&&(this.cellDimensions.maxSubheaderHeight=void 0),this.renderGridLayout(r,t.viewport,function(e){return a.renderGridCell(o,e,t.background,t.playAxisControlLayout,t.suppressAnimations,t.resizeMode,t.trimOrdinalDataOnOverflow,t.categoryLoadMoreDataHandler,t.isHierarchicalAxis,!0)},function(e){return a.renderGridCellSubheader(e,o,n)},n,s,t.axisRendererSettings.axes.isYAxisCategorical)},g.prototype.clearRenderingTimeout=function(){this.sharedAxisLayout.clearRenderingTimeout(),this.gridLayout.clearRenderingTimeout()},g.prototype.destroy=function(){this.gridLayout.destroy(),this.sharedAxisLayout.destroy()},g.prototype.onScroll=function(e){this.sharedAxisLayout.scrollDelta(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollDelta(e,this.getVisibleMultiples())},g.prototype.onExtentUpdate=function(e){this.sharedAxisLayout.updateScrollbarExtent(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.updateScrollbarExtent(e,this.getVisibleMultiples())},g.prototype.scrollTo=function(e){this.sharedAxisLayout.scrollTo(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollTo(e,this.getVisibleMultiples())},g.prototype.shouldScrollTo=function(e){return this.options.cartesianSmallMultipleFactory.shouldScrollTo(e,this.getVisibleMultiples())},g.prototype.scrollBy=function(e){this.sharedAxisLayout.scrollBy(e,this.gridLayout.getScrollPosition()),this.options.cartesianSmallMultipleFactory.scrollBy(e,this.getVisibleMultiples())},g.prototype.getVisibleMultiples=function(){var e,t=this.options.cartesianSmallMultipleFactory.getFrameCount(),i=this.gridLayout.getScrollPosition();return i?(e=i.startIndex*this.multiplesLayout.columnCount,i=i.endIndex*this.multiplesLayout.columnCount,{startIndex:e,endIndex:Math.min(i,t)}):{startIndex:0,endIndex:0}},g.prototype.calculatePlotArea=function(e){_.clone(e.axesMargins);var t=e.axesMargins,i=e.axesOverflow,a=e.titleMargins,a=w.CartesianAxes.adjustAxesMarginsForShared(t,a,e.scrollHandleMargins,e.willRenderAxis,null!=(a=this.featureSwitches)&&a.switchAxisPosition?this.options.axesData.y.switchAxisPosition:this.options.axesData.y.position===w.yAxisPosition.right,e.axes,w.CartesianAxesLayoutBuilder.showAxisTitles(this.options.axesData,void 0)),a=(this.gridLayout.updateHeaderMargins(a),this.adapterFactory()),a=a?a.getMultiplesSubheader(this.options.warnings):w.CartesianChart.getMultiplesSubheader(this.options.cartesianSmallMultipleFactory.getObjects(),this.layerStyle),r=(a.titleWrap&&(r=this.getFrameDisplayNames()),{titleWrap:a.titleWrap,subheaders:r,subheaderFontProperties:a.fontProperties,subheaderLineHeight:a.height,subheaderMargin:a.margins});return!this.featureSwitches.smallMultiplesUnsharedAxes||this.options.axesData.y.sharedAxis&&this.options.axesData.x.sharedAxis?this.cellDimensions=this.gridLayout.calculateCellDimensions(i,r,e):(a=__assign({},i),!this.options.axesData.y.sharedAxis&&this.sharedAxisLayout.getCoreMultipleData().axesData.valueAxis.show&&(a.left=Math.max(t.left,i.left),a.right=Math.max(t.right,i.right)),!this.options.axesData.x.sharedAxis&&this.sharedAxisLayout.getCoreMultipleData().axesData.valueAxis.show&&(a.bottom=Math.max(t.bottom,i.bottom),a.top=Math.max(t.top,i.top)),this.cellDimensions=this.gridLayout.calculateCellDimensions(a,r,e)),this.cellDimensions.plotAreaViewport},g.prototype.scrollRowsTo=function(e){this.gridLayout,this.gridLayout.scrollTo(e)},g.prototype.getCellPadding=function(e,t){return{top:e.rowPaddingInner,bottom:0,left:e.columnPaddingInner,right:0}},g.prototype.getOuterPadding=function(e,t){return{top:e.rowPaddingOuter,bottom:e.rowPaddingOuter,left:e.columnPaddingOuter,right:e.columnPaddingOuter}},g.prototype.getFrameDisplayNames=function(){var t=this.getLocalizedString("ListJoin_Separator"),e=this.options.cartesianSmallMultipleFactory.reader.getFrameDisplayNames();return e&&e.map(function(e){return e.join(t)})},g.prototype.renderGridLayout=function(y,m,v,S,f,b,x){return __awaiter(this,void 0,C.Promise,function(){var t,i,a,r,o,s,n,l,c,u,d,h,p,g=this;return __generator(this,function(e){return t=this.getAxesRenderOptions(b),i=y.getFrameCount(),a=y.getCoreMultiple(),p=y.getShouldResetRowMultipleScrollPosition(),r=b.rowCount,o=b.columnCount,s=b.getCellBackgroundColor,n=b.backgroundTransparency,l=b.cellPadding,c=b.outerPadding,u=f.height,d=f.margins,h=f.show,u=u+d.top+d.bottom,d={rowCount:r,columnCount:o,viewport:m,renderCell:function(t){return __awaiter(g,void 0,C.Promise,function(){return __generator(this,function(e){return v(t),[2,new C.Promise(function(e){return e()})]})})},renderCellSubheader:function(t){return __awaiter(g,void 0,C.Promise,function(){return __generator(this,function(e){return S(t),[2,new C.Promise(function(e){return e()})]})})},cellCount:i,headerMargins:w.CartesianChartLayout.getEmptyMargins(),renderHeader:function(){},subheaderShow:h,subheaderHeight:this.cellDimensions&&this.cellDimensions.maxSubheaderHeight||u,subheaderLineHeight:f.height,subheaderPosition:1!==f.vertical?0:1,shouldResetScrollPosition:p,cellPadding:l,outerPadding:c,scrollPadding:5,getCellBackgroundColor:s,backgroundTransparency:n,gridLineSettings:b.gridLineSettings,getAllCells:function(){return y.multiples},manageTabIndexOnRowHeaderFooter:x,boldedSubheaders:f.labelBold},this.isSharedAxis&&(this.gridLayout.update(d),h=Math.ceil(i/o),this.sharedAxisLayout.update(this.options.axisRendererSettings,y.multiples,t,m,o,Math.max(h,r),a,this.featureSwitches),d.renderHeader=function(e){return g.sharedAxisLayout.renderAxes(e,g.featureSwitches)},d.headerMargins=this.cellDimensions.headerMargins,d.subheaderHeight=this.cellDimensions&&this.cellDimensions.maxSubheaderHeight||u),this.gridLayout.update(d),p=_.map(y.multiples,function(e){return e.getDataPoint()}),[2,this.gridLayout.render(this.cellDimensions,p,"multiples",this.visualInstanceId)]})})},g.prototype.renderGridCellSubheader=function(e,t,i){var a=e.element,r=e.index,o=e.viewport;if(!_.isUndefined(r)){var s=1===i.horizontal?"center":2===i.horizontal?"right":"left",n=this.getSubheaderFontProperties(r,i.fontProperties),s=(a.css(w.FontProperties.toHTMLStyle(n)),a.css({padding:"".concat(i.margins.top,"px ").concat(i.margins.right,"px ").concat(i.margins.bottom,"px ").concat(i.margins.left,"px "),"text-align":s}),this.getLocalizedString("ListJoin_Separator")),l=this.options.cartesianSmallMultipleFactory.reader.getDisplayNameForFrame(r),l=l&&l.join("".concat(s));if(a.attr("title",l),a.attr("id","".concat(this.visualInstanceId,"-").concat(r)),a.empty(),i.titleWrap&&(this.cellDimensions&&this.cellDimensions.maxSubheaderHeight)>i.height+i.margins.top+i.margins.bottom)for(var s=w.FontProperties.toTextProperties(n),n=o.width,c=jsCommon.WordBreaker.splitByWidth(l,s,C.TextMeasurementService.measureSvgTextWidth,n,w.GridLayoutSubheaderMaxLines,null,!0),u=0;u<c.length;u++){var d=c[u],d=$("<div/>").text(d);u===c.length-1&&d.addClass("truncate"),a.append(d)}else a.text(l);this.interactivityService&&(o=t.get(r),s=a.closest(w.GridLayoutSelectors.Cell.selector),e.styleSubheader(s,o,i.labelBold))}},g.prototype.getSubheaderFontProperties=function(e,t){e=this.getColorFromMultipleObjects(e,{objectName:w.SmallMultiplesUtils.SubheaderObjectName,propertyName:"fontColor"});return null==e?t:w.FontProperties.inherit(t,{color:e})},g.prototype.getColorFromMultipleObjects=function(e,t,i){if(null!=e){e=null==(e=this.options.cartesianSmallMultipleFactory.reader.getFrameNode(e))?void 0:e.objects;if(e){e=C.DataViewObjects.getFillColor(e,t);if(e)return e}}return i},g.prototype.getAxesRenderOptions=function(e){var t=this,i={scrollTo:function(e){return t.scrollTo(e)},shouldScrollTo:function(e){return t.shouldScrollTo(e)},scrollBy:function(e){return t.scrollBy(e)}};return __assign(__assign({},e),{animationDuration:this.options.animationSettings.duration,ease:this.options.animationSettings.ease,playAxesRect:e.playAxisControlLayout,viewMode:this.viewMode,isSmallMultiples:!0,isHierarchicalAxis:e.isHierarchicalAxis,preserveScrollPosition:!0,navigationScrollCallbacks:i})},g.prototype.renderGridCell=function(e,t,i,a,r,o,s,n,l,c){var u,d,h,p=t.viewport,e=e.get(t.index);2&e.getState()?e.getRenderer().attachToElement(t.element,t.viewport):(h=(u=w.CartesianChartLayout.addCartesianChartContainer(t.element,p)).element,d=null==(d=this.behaviorFactory)?void 0:d.create(),e.initRenderer(this.buildPlotAreaLayout(!0,h,u.clearCatcher,t.element,d))),this.interactivityService&&(h=t.element.closest(w.GridLayoutSelectors.Cell.selector),t.bindDataToGridCell(h,e,"multiple")),this.renderMultiple({multiple:e,viewport:p,background:i,axisZoom:void 0,chartAreaViewport:p,chartAreaMargins:w.CartesianChartLayout.getEmptyMargins(),renderedViewport:p,playAxisControlLayout:a,suppressAnimations:r,resizeMode:o,trimOrdinalDataOnOverflow:s,categoryLoadMoreDataHandler:n,isSharedAxis:!0,isHierarchicalAxis:l,preserveScrollPosition:c,supportsScrolling:!0,axesLayout:this.sharedAxisLayout.calculateAxesLayout(this.featureSwitches,e.index)})},g.IconClassName="cartesianChartResponsiveIcon",w.CartesianSmallMultipleLayout=g}(powerbi=powerbi||{}),function(m){var c,F,I,a,k,e,i,n,t,l;function r(){}function o(e){var t=i.call(this)||this;return t.matrix=e,t}function s(e){return t.call(this)||this}function u(e,t){var i=this,t=(this.sourceDataView=e,this.formatStringPropId=t,e&&e.metadata&&e.matrix,this.matrix=e.matrix,this.matrix.rows.root.children);this.hasRowChildren=!_.isEmpty(t),this.hasColChildren=!_.isEmpty(this.matrix.columns.root.children),this.hasSeries=this.hasColChildren&&!_.isEmpty(this.matrix.columns.levels)&&_.every(this.matrix.columns.levels[0].sources,function(e){return!e.isMeasure}),this.hasCategories=1<this.matrix.rows.levels.length&&this.hasRowChildren,this.objects=e.metadata.objects,this.frameCount=function(e){e=e.rows;return e.root.children?_.filter(e.root.children,function(e){return!e.isSubtotal}).length:0}(this.matrix),this._frameDisplayNames=new a(function(){return i.getDisplayNameFromAllFrames()})}c=m.visuals||(m.visuals={}),F=m.data.createDataViewScopeIdentity,I=m.data.DataViewMatrixUtils,a=jsCommon.Lazy,k=m.data.SQExprBuilder,r.prototype.ensureValueGroupAtSeriesIndex=function(e,t,i){var a;return e[t]||(a=this.getValueGroupName(i),i={identity:this.getSeriesIdentity(i),values:[],objects:this.getSeriesObjects(i),name:a},e[t]=i),e[t]},__extends(o,i=e=r),o.prototype.setSource=function(e){e.source=this.matrix.columns.levels[0].sources[0]},o.prototype.getSeriesGroups=function(e,t){return e&&_.map(e,function(e){return _.isEmpty(e.children)?1:e.children.length})},o.prototype.getSeriesDataPoints=function(e){var t=this.matrix.columns.root;return _.filter(t.children,function(e){return!e.isSubtotal})},o.prototype.getValueGroupName=function(e){return e.value||e.levelValues&&e.levelValues[0].value},o.prototype.getSeriesObjects=function(e){return e.objects},o.prototype.getSeriesIdentity=function(e){return e.identity},o.prototype.getSeriesSourceColumn=function(e,t){return void 0===t&&(t=null),_.create(e,{groupName:t})},o.prototype.createValueColumnForMeasure=function(e,t,i,a,r){return t[r]||(e={identity:this.getSeriesIdentity(e),values:[],source:this.getSeriesSourceColumn(i,a),objects:void 0},t[r]=e),t[r]},n=o,__extends(s,t=e),s.prototype.setSource=function(e){},s.prototype.getSeriesGroups=function(e,t){return t?[t]:[]},s.prototype.getSeriesDataPoints=function(e){return e},s.prototype.getValueGroupName=function(e){return e.displayName},s.prototype.getSeriesObjects=function(e){return e.objects},s.prototype.getSeriesIdentity=function(e){},s.prototype.getSeriesSourceColumn=function(e,t){return e},s.prototype.createValueColumnForMeasure=function(e,t,i,a,r){return t[r]||(e={identity:this.getSeriesIdentity(e),values:[],source:this.getSeriesSourceColumn(i,a),objects:[]},t[r]=e),t[r]},l=s,u.create=function(e,t){return new u(e,t)},u.prototype.getObjects=function(){return this.objects},u.prototype.getFrameDisplayNames=function(){return this._frameDisplayNames.getValue()},u.prototype.hasFrames=function(){var e=this.matrix.rows;return this.matrix&&0<this.frameCount&&!_.isEmpty(e.levels)&&!!this.getFrameSourceColumns()},u.prototype.getFrameCount=function(){return this.frameCount},u.prototype.getFrameSourceColumns=function(){return this.matrix.rows.levels[0].sources},u.prototype.getFrameNode=function(e){return this.matrix.rows.root.children[e]},u.prototype.getValueSources=function(e){return e?(e=this.hasCategories?1:0,e=this.matrix.rows.levels[e],I.getScopedValueSources(e)):this.matrix.valueSources},u.prototype.buildCategoricals=function(e,P,L,t,i){var M=this,e=this.matrix.rows.root.children[e],V=(e.isSubtotal,[]),T=(i.forEach(function(e,t){return V[t]={shouldReadScopedValues:!e&&M.hasSeries}}),i.map(function(e){return new(M.hasSeries&&e?n:l)(M.matrix)}));V.forEach(function(e){e.allValueSources=M.getValueSources(e.shouldReadScopedValues)});for(var a=0;a<T.length;a++){var r=this.findUniqueFilteredValueSourcesAndIndices(V[a].allValueSources,t&&t[a]),o=r[0],r=r[1],o=(V[a].requiredValueSources=o,V[a].requiredValueSourcesIndices=r,T[a].setSource(P[a].values),T[a].getSeriesDataPoints(o)),o=(V[a].seriesNodes=o,T[a].getSeriesGroups(o,r.length));V[a].seriesGroups=o,V[a].valueGroups=Array(o.length)}for(var e=this.hasCategories?e.children:[e],s=(I.forEachLeafNode(e,function(t,e,i){if(!t.isSubtotal){if(M.hasCategories){var a=i,r=L;_.every(a,function(e){return 1===e.levelValues.length})&&a.length===r.length||1===a.length&&(a[0].levelValues.length,r.length);var o,s,n=_.last(a).objects,l=a[0];if(1<a.length){(s=new Array(a.length))[0]=l.levelValues[0].value;for(var c=l.identity.expr,u=1,d=a.length;u<d;u++)l=a[u],s[u]=l.levelValues[0].value,c=k.and(c,l.identity.expr);o=F(c)}else o=l.identity,s=_.map(l.levelValues,function(e){return e.value});for(var h=0,p=r.length;h<p;h++)r[h].identity.push(o),r[h].objects.push(n),r[h].values.push(s[h])}for(var g=V.map(function(e){return e.shouldReadScopedValues?I.getNodeScopedValues(t):t.values}),y=0;y<V.length;y++)for(var m=V[y],v=0;v<m.seriesGroups.length;v++){for(var S=m.seriesNodes&&m.seriesNodes[v],f=m.seriesGroups[v],b=T[y].ensureValueGroupAtSeriesIndex(m.valueGroups,v,S),x=[],C=0;C<f;C++){var w=v*f+C,D=T[y].createValueColumnForMeasure(S,P[y].values,m.requiredValueSources[m.shouldReadScopedValues?w:C],b.name,w),A=(M.hasSeries||(w=m.requiredValueSourcesIndices[w]),null==(A=null==g?void 0:g[y])?void 0:A[w]);_.isEmpty(m.requiredValueSources)||M.readValues(A,D,e),x.push(D)}b.values=x}}}),this.hasSeries&&this.hasCategories&&_.isEmpty(V.filter(function(e){return!_.isEmpty(e.requiredValueSources)}))),a=0;a<P.length;a++)m.data.DataViewTransform.setGrouped(P[a].values,V[a].valueGroups),_.isEmpty(V[a].requiredValueSources)&&(i[a]?s||(P[a].values=void 0):P[a]=void 0)},u.prototype.findUniqueFilteredValueSourcesAndIndices=function(i,a){if(_.isEmpty(i))return[[],[]];for(var r=[],o=[],s={},e=0;e<i.length;e++)!function(e){var t=i[e];!_.isEmpty(a)&&!_.some(a,function(e){return t.roles[e]})||s[t.queryName]||(r.push(e),o.push(t),s[t.queryName]=!0)}(e);return[o,r]},u.prototype.readCategories=function(){var e=this.matrix.rows;if(e.levels.length<=1||2===e.levels.length&&1<=e.levels[1].sources.length||2<=e.levels.length&&_.every(e.levels,function(e){return 1===e.sources.length}),this.hasCategories)return this.fillCategoriesMetadata(e=[]),e},u.prototype.fillCategoriesMetadata=function(e){this.hasCategories;for(var t=this.matrix.rows.levels,i=1;i<t.length;i++)for(var a=0,r=t[i].sources;a<r.length;a++){var o=r[a];e.push({source:o,values:[],identity:[],objects:[]})}},u.prototype.convertComboFrame=function(e){var t=c.ComboChart.getRoleGroups();return this.convertFrameInternal(e,t)},u.prototype.createEmptyCategorical=function(e){var t;return(t=e.values).push.apply(t,(t=this.matrix.valueSources,(_.isEmpty(t)?[]:_.map(t,function(e){return{identity:void 0,values:[],source:e,objects:[]}}))||[])),{metadata:this.sourceDataView.metadata,categorical:e}},u.prototype.convertFrame=function(e){return this.convertFrameInternal(e)[0]},u.prototype.checkValueRolesInList=function(e,t){for(var i=0,a=t;i<a.length;i++){var r=function(t){if(_.some(e,function(e){return t.roles[e]}))return{value:!0}}(a[i]);if("object"==typeof r)return r.value}return!1},u.prototype.validateValueRoles=function(e){var t;!_.isEmpty(e)&&(this.checkValueRolesInList(e,this.matrix.valueSources),t=this.getValueSources(!0))&&this.checkValueRolesInList(e,t)},u.prototype.isForColumnValues=function(e){var t=c.ComboChart.getRoleGroups()[0];return _.isEmpty(e)||0<_.intersection(e,t).length},u.prototype.convertFrameInternal=function(e,t){for(var i,a=this,r=[],o=this.matrix,s=[],n=(_.isEmpty(t)?s.push(!0):t.forEach(function(e){a.validateValueRoles(e),s.push(a.isForColumnValues(e))}),_.size(null==(i=null==o?void 0:o.rows)?void 0:i.levels),[]),l=_.isEmpty(t)?1:t.length,c=0;c<l;c++)n.push({categories:void 0,values:m.data.DataViewTransform.createValueColumns()});if(!this.hasCategories){for(var u=[],d=!0,c=0;c<n.length;c++)if(s[c]){if(!_.isEmpty(o.valueSources)&&this.hasRowChildren){d=!1;break}!this.hasSeries&&1!==n.length||(u[c]=this.createEmptyCategorical(n[c]))}else if(!_.isEmpty(this.getValueSources(this.hasSeries))){d=!1;break}if(d)return u}var h=this.readCategories();this.buildCategoricals(e,n,h,t,s);for(var p=0,g=n;p<g.length;p++){var y=g[p];y&&(y.categories=h,r.push({metadata:this.sourceDataView.metadata,categorical:y}))}return r},u.prototype.readValues=function(e,t,i){t.values||(t.values=[]),e?(t.values[i]=null==e.value?null:e.value,void 0!==e.highlight&&(t.highlights||(t.highlights=[]),t.highlights[i]=e.highlight),void 0!==e.objects&&(t.objects||(t.objects=[]),t.objects[i]=e.objects),void 0!==e.highlightObjects&&(t.highlightObjects||(t.highlightObjects=[]),t.highlightObjects[i]=e.highlightObjects)):t.values[i]=null},u.prototype.getDisplayNameFromAllFrames=function(){for(var e=new Array(this.frameCount),t=0;t<this.frameCount;t++){var i=this.getDisplayNameForFrame(t);e[t]=i}return e},u.prototype.getDisplayNameForFrame=function(e){var a=this,r=this.getFrameNode(e),e=this.getFrameSourceColumns(),o=new Array(e.length);return e.forEach(function(e,t){r.levelValues;var i=r.levelValues&&r.levelValues[t].value,e=new c.valueFormatter.VariantValueFormatter({column:e,formatStringPropId:a.formatStringPropId,nullsAreBlank:!0,trailingZeroes:!0});o[t]=e.format(i)}),o},u.prototype.getSubtotals=function(){var e=_.find(this.matrix.rows.root.children,function(e){return e.isSubtotal});if(e){for(var t=_.size(e.values),i=_.size(this.matrix.valueSources),a=t-i,r={},o=0;o<i;o++){var s,n=this.matrix.valueSources[o].roles,l=c.AxisHelper.normalizeNonFiniteNumber(e.values[a+o].value);for(s in n)r[s]=l}return r}},u.prototype.getTopLevelAggregates=function(e){for(var t={},i=0,a=this.sourceDataView.metadata.columns;i<a.length;i++){var r=a[i];if(r.roles&&r.aggregates)for(var o=0,s=e;o<s.length;o++){var n=s[o];r.roles[n]&&(t[n]=t[n]||[]).push(r.aggregates)}}return _.isEmpty(t)?void 0:t},c.DataViewMultipleReader=u}(powerbi=powerbi||{}),function(e){((e=e.powerbi||(e.powerbi={})).visuals||(e.visuals={})).importCartesianChartsModule=function(){}}(es6=es6||{}),function(Ne){var Re;function e(e){this.options=e}Re=Ne.visuals||(Ne.visuals={}),e.prototype.convert=function(){var n,P,m,X,K,Z,v,S,f,q,$,J,b,Q,L=this.options,e=this.options,M=e.dataView,l=e.style,ee=e.interactivityService,te=e.shouldCalculateStacked,V=e.isComboChart,x=e.forecastDataView,t=e.anomalyDetectionDataView,C=e.supportsTotalLabels,i=e.tooltipsEnabled,ie=void 0===i||i,T=e.featureSwitches,i=Re.CartesianHelper.getCategoryAxisProperties(M.metadata),F=Re.CartesianHelper.isScalar(L.isScalar,i),ae=Re.CartesianHelper.getReverseStackOrder(i),re=M.categorical,e=Re.CartesianHelper.getScalarKeyinfo(re,F),I=e.category,k=e.useScalarKeys,oe=e.scalarKeys,O=(k&&((X=Ne.Prototype.inherit(I.source)).type={dateTime:!0}),Re.lineChartProps.general.formatString),e=Re.AxisHelper.getCategoryValueType(I.source,F),N=Re.AxisHelper.isDateTime(e),se=I.values,R=[],ne=[],le=[],c=[],B=re.values,H=!(!B||!B.source),u=Re.LineChart.getDefaultLineChartLabelSettings(l,L.isComboChart),ce=Re.ColorHelper.create(l),U=this.options.multipleInfo,ue=(U&&(K=_.first(U.sources).metadata.queryName,Z=U.sources.map(function(e){return Re.buildValueDetailsForColumnValue(e.metadata,e.value,U.identity)}),v=(new Re.SelectionIdBuilder).withColumnIdentity(U.identity,K,Z).createSelectionId(),S=Re.FormattingStrategies.defaultFormatter(O),f=Re.DataViewConcatenateUtil.concatenateValues(_.map(U.sources,function(e){return S(e.value,e.metadata)}))),!(U&&U.isCoreMultiple)),j=V?["Y2"]:["Y","Y2"],z=Ne.data.createDataViewCategoricalReaderAdvanced(M,{staticSeriesRoleNames:j,colorOptions:{visualStyle:l,valueRole:j[0],ignoreDefaultColor:L.isComboChart,ignoreDefaultCategoryColor:!0},formatStringProp:O,errorRangeProp:Re.ErrorObjectProps.errorRange}),e=(M.metadata&&M.metadata.objects&&(_e=(q=M.metadata.objects).labels,Re.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(_e,u,void 0,l,V)),Ne.DataViewObjects.getValue(q,Re.lineChartProps.lineStyles.showMarker,!1)),a=__assign(__assign({},u),{show:!1}),C=(C&&M.metadata&&M.metadata.objects&&(C=M.metadata.objects.totals)&&Re.DataLabelViewModel.updateLabelSettingsFromLabelsObject(C,a,!1,l,V),B&&($=B.grouped()),te&&(J=B&&0<B.length?_.times(B[0].values.length,function(){return 0}):[]),!1),E=z.data,W=z.columns,de=E.hasCategories()?E.getCategoryCount():1,G=E.getSeriesCount(),he=this.allocateSeriesColors(G,z),d=z.objects.getStaticObjects(),pe=Re.LineStyle.readFromStaticObjects(d,e,l),e=Ne.DataViewObjects.getValue(d,Re.lineChartProps.dataPoint.transparency,Re.LineChart.DefaultAreaTransparency),ge=W.getAllValueMetadataColumnsForRole(j[0]),ye=(2===j.length&&(ge=__spreadArray(__spreadArray([],ge||[],!0),W.getAllValueMetadataColumnsForRole(j[1])||[],!0)),[]),Y=[],me=[],ve=(t&&F&&!te&&!V&&(Q=Re.AnomalyDetectionVisualPlugin.readDataView(t,M,l,O)).length,this.getSeriesName(z,j,ae)),h=Re.CartesianChartConverter.getDefaultLineChartSeriesLabelSettings();if(_.some(j,function(e){return E.hasValues(e)})){for(var Se=z.columns.getSeriesCount(j[0]),C=!0,fe=!1,be=(null==b&&(b=H?Re.converterHelper.formatFromMetadataColumn(E.getSeriesDisplayName(),W.getSeriesMetadataColumn(),O):void 0),h=Re.LineChart.getDefaultLineChartSeriesLabelSettings(l),M.metadata&&M.metadata.objects&&(_e=(q=M.metadata.objects).seriesLabels,Re.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(_e,h,l,V),t=Re.LineChart.getDefaultLineChartSeriesWidthSettings(h.fontProperties,ve),h.defaultSeriesWidth=h.defaultSeriesWidth?t:null,h.seriesMaximumWidth=h.defaultSeriesWidth?t:h.seriesMaximumWidth),u.fontProperties.color),w=a.fontProperties.color,D=function(e){for(var p=null!=(n=xe.options.featureSwitches)&&n.flipStackOrder&&ae?G-e-1:e,e=(Se<=p&&(fe=!0),W.getValueColumnBySeries(p)),g=$&&$[p],y=me[p]=e.source,m=[],t=y.queryName,t=Re.SelectionIdBuilder.builder().withSeries(B,g,!0).withMeasure(t).createSelectionId(),v=t.getKey(),i=he[p],S=void 0,a=void 0,r=((z.data.hasSeries()||V)&&(o=void 0,r=(o=V&&!z.data.hasSeries()?z.objects.getValueMetadataObjectsBySeries(p):z.objects.getSeriesDataObjects(p))&&o.labels,o=o&&o.seriesLabels,(S=Ne.Prototype.inherit(u)).show=u.show&&(null==(n=u.showByDefault)||n),r&&Re.DataLabelViewModel.updateLabelSettingsFromLabelsObjectWithLabelDensity(r,S,void 0,l,V),(a=Ne.Prototype.inherit(h)).show=h.show&&(null==(n=h.showByDefault)||n),o)&&Re.DataLabelViewModel.updateSeriesLabelSettingsFromLabelsObject(o,a,l,V),y.objects),f=Re.UncertaintyHelper.convertErrorMetadata(r,l,i,p,__assign(__assign({},u),{show:!1}),{isCombo:V,staticObjects:d}),b=f.hasUncertainty,x=S||u,o=a||h,C=e.highlights&&0<e.highlights.length,r=Ne.DataViewObjects.getValue(q,Re.lineChartProps.lineStyles.showSeries,!0),w=Re.LineStyle.readFromSeriesObjects(z,pe,p,r,l),D=-1,a=_.get(Q,p),A=void 0,s=(a&&(A=new Re.AnomalyDetectionVisualPlugin.AnomalyTooltipBuilder(L.host,a,y,O)),0);s<de;s++)!function(i){var e,t,a,r,o,s,n,l,c=se[i],u=void 0,d=(u=k?(d=oe.values[i])&&d.min:c,Re.AxisHelper.normalizeNonFiniteNumber(C?E.getHighlightBySeries(i,p):E.getValueBySeries(i,p))),h=C?E.getHighlightFormatStringBySeries(i,p):E.getFormatStringBySeries(i,p);F&&(null==u||null==d)||N&&null!=c&&!(c instanceof Date)||(D++,null==d&&0<p)||(c=void 0,o=void(b&&(c=Re.UncertaintyHelper.convertCategoricalDataPoint(E,i,p,d))),t=e=void 0,ie&&(o=[],U&&(n=new Re.LazyTooltipBuilder,s=Re.FormattingStrategies.defaultFormatter(O),n.withMultipleColumnAndValues(U.sources.map(function(e){return e.metadata}),U.sources.map(function(e){return e.value}),!0,s),o.push.apply(o,n.getTooltipItems())),I.source&&(t=Re.CategoryLevelUtils.getCategoryLevels(M.categorical.categories,i,O),s=Re.CategoryLevelUtils.concatenateCategoryLevels(t),o.push({displayName:s.displayName,value:s.value})),n=function(e){return Re.converterHelper.formatFromMetadataColumn(e,y,O,!1,h)},!H||I.source&&I.source===B.source||o.push({displayName:B.source.displayName,value:Re.converterHelper.formatFromMetadataColumn($[p].name,B.source,O)}),null!=d&&(s=f.tooltips,!b||!s.show||s.format!==Re.errorFormat.range||(void 0!==(s=Re.UncertaintyHelper.getTooltipItems(c,d,f,n,L.host,{overrideDisplayName:y.displayName}))&&s.length,_.isEmpty(s))?o.push({displayName:y.displayName,value:n(d)}):o.push(s[0])),b&&(V&&f.tooltips.format!==Re.errorFormat.range?o.push.apply(o,Re.UncertaintyHelper.getTooltipItems(c,d,f,n,L.host,{hideMarker:!0})):Re.UncertaintyHelper.setTooltipItems(c,d,f,n,L.host)),Re.TooltipBuilder.addTooltipMeasures(z,e=[],i,H?p:void 0,O),(s=null==A?void 0:A.getTooltipItems(i,h))&&e.push.apply(e,s),e=_.isEmpty(e)?void 0:e),n=new Re.SelectionIdBuilder,s=W.getCategoryColumn("Category"),a=null!=(P=re.originalCategories)?P:[I],E.hasCategories()&&(n=n.withCategory(a,i,null==(P=null==s?void 0:s.source)?void 0:P.queryName,!0)),H&&(n=n.withSeries(B,g,!0)),s=(n=U?n.withColumnIdentity(U.identity,K,Z):n).withMeasure(y.queryName,W.getValueColumn(fe?j[1]:j[0],p),i).createSelectionId(),n=I&&!_.isEmpty(I.identity)&&I.identity[i]?I.identity[i].key:i,Y[i]||(Y[i]={positive:0,negative:0,net:0,categoryValue:xe.convertCategoryValue(u,N,k,T),categoryIndex:i,dynamicFormatString:h}),l=Math.abs(d),isNaN(l)||(d<0?(Y[i].net-=l,Y[i].net<Y[i].negative&&(Y[i].negative=Y[i].net)):(Y[i].net+=l,Y[i].net>Y[i].positive&&(Y[i].positive=Y[i].net))),l=Re.DataLabelUtil.determineDataLabelFillColor({defaultColor:be,seriesColor:null==S?void 0:S.fontProperties.color,categoricalDataReader:z,categoryIndex:i,seriesIndex:p}),r=null!=(P=xe.options.featureSwitches)&&P.measureDrivenDataLabels?Re.DataLabelUtil.extractDynamicLabel({categoricalDataReader:z,categoryIndex:i,seriesIndex:p}):void 0,u={categoryValue:xe.convertCategoryValue(u,N,k,T),value:d,categoryIndex:i,seriesIndex:p,tooltipInfo:o,selected:!1,identity:s,key:JSON.stringify({series:v,category:n}),labelFill:l.color,labelFormatString:h||y.format,labelSettings:x,uncertainty:c,additionalTooltipItems:e,hierarchyCategoryLevels:t,lineStyle:w,isY2:fe,dynamicLabelValue:r},te&&(J[i]+=d,u.stackedValue=J[i]),o=Re.lineChartProps.dataPoint.fill,(s=I.objects&&I.objects[i])&&ce.hasColorForProperty(s,o)&&(u.pointColor=ce.getColorForProperty(s,o,void 0)),m[D]=u,R[i]||(R[i]=Re.CartesianHelper.extractCategoryFromDataPoint(u)),R[i]&&!R[i].hasData&&(R[i].hasData=null!=u.value),n=function(e){var t=(new Re.SelectionIdBuilder).withCategory(a,i,null==(t=null==I?void 0:I.source)?void 0:t.queryName,!0);return H||1!==G||t.withMeasure(y.queryName),e&&U&&t.withColumnIdentity(U.identity,K,Z),t},E.hasCategories()&&(ne[i]||(l=n(!1),ne[i]=l.createSelectionId()),le[i]||(c=n(!0),le[i]=c.createSelectionId())))}(s);r=_.findIndex(ge,y),-1!==r&&(ye[r]?ye[r].usedInSeriesIndices.push(p):ye[r]={metadataColumn:y,usedInSeriesIndices:[p],valueSelector:(new Re.SelectionIdBuilder).withMeasure(y.queryName,e).createSelectionId()}),ee&&ee.applySelectionStateToData(_.filter(m,function(e){return null!=e})),a=l.isHighContrast?Re.ColorHelper.getThemeColor(l,Re.BackgroundColorName):i;(0<m.length||!ue)&&c.push({seriesName:ve[p],key:v,lineIndex:p,color:i,areaColor:a,xCol:k?X:I.source,yCol:y,data:m,identity:t,selected:!1,uncertainty:f,labelSettings:S,seriesSettings:o,type:y.type,lineStyle:w,isY2:fe})},xe=this,r=0;r<G;r++)D(r);if(te&&L.host&&L.tooltipsEnabled&&a.show)for(var A=L.host.getLocalizedString("Visual_Total"),Ce=[],r=0;r<G;r++){var o=null!=(m=this.options.featureSwitches)&&m.flipStackOrder&&ae?G-r-1:r;if(c[o])for(var we=c[o].data,De=me[o],s=0;s<we.length;s++){var Ae,p=c[o].data[s];p&&(Ae=void 0,g=p.categoryIndex,p=Re.DataLabelUtil.determineTotalLabelFillColor({defaultColor:w,categoricalDataReader:z,categoryIndex:g,seriesIndex:o}),Y[g].labelFill=p.color,p=Re.DataLabelUtil.isAssignedColor(p)?p.color:w,a.fontProperties=Re.DataLabelUtil.updateFontPropertiesColor(p,a.fontProperties),Ce[g]||(Ce[g]={net:{displayName:A,value:Re.converterHelper.formatFromMetadataColumn(Y[g].net,De,O,!1)}}),Ae=Ce[g].net,c[o].data[s].tooltipInfo||(c[o].data[s].tooltipInfo=[]),c[o].data[s].tooltipInfo.push(Ae),c[o].data[s].additionalTooltipItems||(c[o].data[s].additionalTooltipItems=[]),c[o].data[s].additionalTooltipItems.push(Ae))}}}if(x&&F&&!te&&!V)for(var Pe=Re.ForecastHelper.readDataView(x,M,l),Le=_.last(R),Me=0,Ve=Pe;Me<Ve.length;Me++)for(var Te=Ve[Me],g=Le.categoryIndex,Fe=0,Ie=Te.points;Fe<Ie.length;Fe++){var ke,y=Ie[Fe],Oe=(y.point.x=this.convertCategoryValue(y.point.x,N,k,T),y.upperBound.x=this.convertCategoryValue(y.upperBound.x,N,k,T),y.lowerBound.x=this.convertCategoryValue(y.lowerBound.x,N,k,T),y.point.x);Oe<=Le.categoryValue||(g++,ke=Re.CategoryLevelUtils.getCategoryLevels(M.categorical.categories,g,O),R[g]||(R[g]={categoryIndex:g,categoryValue:Oe,hasData:null!=y.point.y,hierarchyCategoryLevels:ke}),ne[g]||(ne[g]=null),le[g])||(le[g]=null)}var _e=!1,t=M.metadata&&M.metadata.dataReduction,x=(t&&t.categorical&&(t.categorical.metadata&&t.categorical.metadata.binnedLineSample||t.categorical.categories&&t.categorical.categories.binnedLineSample||t.categorical.values&&t.categorical.values.binnedLineSample)&&(_e=!0),i=Re.CartesianHelper.getCategoryAxisProperties(M.metadata),Re.CartesianHelper.getPreferredCategoryWidth(i));return ee&&ee.applySelectionStateToData(c),{series:c,totals:Y,forecastLines:Pe,anomalyDetections:Q,isScalar:F,dataLabelsSettings:u,totalLabelsSettings:a,seriesLabelSetings:h,hasDynamicSeries:H,hasY2Role:Ne.data.DataRoleHelper.hasRoleInDataView(M,"Y2"),categoryMetadata:I.source,valuesMetadata:ge,valuesMetadataBySeries:ye,preferredCategoryWidth:x,scalarMetadata:X,scalarKeyCount:k?oe.values.length:void 0,categories:se,categoryData:R,seriesDisplayName:b,hasValues:C,categoryIdentities:ne,multiplesCategoryIdentities:le,lineStyle:pe,binnedLineSamplingApplied:_e,legendMarkerRendering:Ne.DataViewObjects.getValue(d,Re.lineChartProps.legend.legendMarkerRendering,null!=T&&T.removeDefaultToCircleToggle?Re.legendMarkerRendering.markerCircleDefault:Re.legendMarkerRendering.markerOnly),matchLineColor:Ne.DataViewObjects.getValue(d,Re.lineChartProps.legend.matchLineColor,!0),defaultToCircle:Ne.DataViewObjects.getValue(d,Re.lineChartProps.legend.defaultToCircle,!0),isComboChart:V,multipleIdentity:v,multipleDisplayName:f,areaTransparency:e}},e.prototype.allocateSeriesColors=function(e,t){for(var i=[],a=0;a<e;a++)i.push(t.colors.createBySeries(a,void 0,Re.ForegroundColorName));return i},e.prototype.getSeriesName=function(e,t,i){for(var a=[],r=0,o=e.data.getSeriesCount();r<o;r++){var s=null!=(s=this.options.featureSwitches)&&s.flipStackOrder&&i?o-r-1:r;e.columns.hasDynamicSeries()?a[s]=Re.valueFormatter.format(e.data.getSeriesName(s),e.objects.getSeriesFormatString(s)):e.columns.hasStaticSeries()?a[s]=e.data.getSeriesName(s):a[s]=e.data.getValueDisplayName(t[0])}return a},e.prototype.convertCategoryValue=function(e,t,i,a){return e&&(t||i)?Ne.FeatureSwitchedDate.getEpochTimeStamp(a.utcDates,e):e},Re.LineChartConverter=e}(powerbi=powerbi||{}),function(e){(e.visuals||(e.visuals={})).initializeCartesianChartsFactoryES6=function(){e.visuals.setCreateCartesianChart(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createCartesianChart(t)})}),e.visuals.setCreateWebColumnChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createWebColumnChartAnimator(t)})}),e.visuals.setCreateRealTimeLineChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createRealTimeLineChartAnimator(t)})}),e.visuals.setCreateDashboardColumnChartAnimator(function(t){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createDashboardColumnChartAnimator(t)})}),e.visuals.setCreateCartesianChartBehaviorFactory(function(t,i){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createCartesianChartBehaviorFactory(t,i)})}),e.visuals.setCreateColumnChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createColumnChartWebBehaviorFactory()})}),e.visuals.setCreateDataDotChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createDataDotChartWebBehaviorFactory()})}),e.visuals.setCreateLineChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createLineChartWebBehaviorFactory()})}),e.visuals.setCreateScatterChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createScatterChartWebBehaviorFactory()})}),e.visuals.setCreateWaterfallChartWebBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createWaterfallChartWebBehaviorFactory()})}),e.visuals.setCreateScatterChartMobileBehaviorFactory(function(){return es6.powerbi.visuals.importCartesianChartsModule().then(function(e){return e.createScatterChartMobileBehaviorFactory()})})}}(powerbi=powerbi||{}),function(Ve){Ve.waterfallConverterModuleFactory=function(){var r=Ve.data,d=Ve.visuals,Se=d.AxisHelper,fe=d.CartesianHelper,be=d.ColorHelper,xe=d.converterHelper,Ce=r.DataRoleHelper,we=d.ForegroundColorName,h=jsCommon.Lazy,De=Ve.visuals.SelectionId,Ae=r.Selector,o=r.SQExprBuilder,p=jsCommon.StringExtensions,Pe=Ve.visuals.WaterfallChart,Le=Ve.visuals.waterfallChartProps;function e(e){var R,B,t=e.dataView,o=e.hostServices,s=e.dataLabelSettings,n=e.sentimentColors,i=e.interactivityService,H=e.tooltipsEnabled,a=e.numberOfBreakdowns,r=t.matrix,l=!_.isEmpty(r.columns.levels)&&r.columns.levels[0].sources[0],c=!_.isEmpty(r.rows.levels)&&r.rows.levels[0].sources,U=_.findIndex(r.valueSources,function(e){return Ce.hasRole(e,"Y")}),u=r.valueSources[U],d=_.filter(r.valueSources,function(e){return Ce.hasRole(e,"Tooltips")}),h=[],p=[],g={current:0,min:0,max:0},j=0,y=null==(y=null==t?void 0:t.metadata)?void 0:y.objects,z=!0;if(l||(z=Ve.DataViewObjects.getValue(y,Le.valueAxis.totalsEnabled,!0)),l&&c&&u){Ce.hasRole(l,"Breakdown"),_.every(c,function(e){return Ce.hasRole(e,"Category")});var m=new Me(l,c,u),v=u.format,S=o.getLocalizedString("Waterfall_OtherLabel"),f=Pe.formatStringProp,b=r.rows.root.children,E=r.columns.root.children;if(!_.isEmpty(b)&&!_.isEmpty(E)){var W=b.length,G=E.length,Y=0,x=void 0,X=void 0,K=_.size(d)+1;0<W&&(j=_.size(b[0].values)/K-1);for(var a=Math.min(a,j),C=0;C<W;C++){for(var w=void 0,D=b[C],A=0<C?b[C-1]:void 0,Z=_.map(D.levelValues,function(e){return e.value}),P=_.map(Z,function(e,t){return xe.formatFromMetadataColumn(e,c[t],f)}).join(" "),q=m.splitIdentity(D.identity.expr),$=[],J=_.size(D.values),L=0;L<J;L+=K){for(var M,Q=void 0,ee=void 0,te=void 0,ie=void 0,ae=[],re=[],V=0;V<K;V++)V===U?(M=D.values[L+V],Q=Se.normalizeNonFiniteNumber(M.value),te=Ve.DataViewObjects.getValue(M.objects,f),ie=Ve.DataViewObject.getFillColorByPropertyName(null==(M=M.objects)?void 0:M.labels,"color"),w=w||te,ee=A&&Se.normalizeNonFiniteNumber(A.values[L+V].value)):(ae.push(D.values[L+V].value),re.push(A&&A.values[L+V].value));var oe={key:L,currentValue:Q,previousValue:ee,difference:(Q||0)-(ee||0),column:E[L/K],currentTooltipValues:ae,previousTooltipValues:re,formatString:te};null!=ie&&(oe.labelColor=ie),$.push(oe)}var se,$=_.sortBy($,function(e){return-1*Math.abs(e.difference)}),T=_.chain($).filter(function(e){return!e.column.isSubtotal}).take(a).sortBy(function(e){return-1*e.difference}).value(),F=_.find($,function(e){return e.column.isSubtotal}),I=F.currentValue,k=F.previousValue;if(A){var O=_.sumBy(T,function(e){return e.currentValue}),ne=_.sumBy(T,function(e){return e.previousValue}),le=_.chain(T).map(function(e){return m.splitIdentity(e.column.identity.expr)}).flatten().value(),ce=a+1<G,N=0,ue=void 0,de=void 0;if(ce){var O=I-O,k=k-ne,N=O-k,ue=m.createBreakdownOtherIdentity(le,q,X);if(H){for(var de=m.createBreakdownTooltip(P,x,S,O,k,N,f,o),he=[],pe=[],ge=0;ge<F.currentTooltipValues.length;ge++)!function(t){var e=F.currentTooltipValues[t],i=F.previousTooltipValues[t];_.isNumber(e)&&_.isNumber(i)&&(e=e-_.sumBy(T,function(e){return e.currentTooltipValues[t]}),i=i-_.sumBy(T,function(e){return e.previousTooltipValues[t]}),he.push(e-i),pe.push(i))}(ge);Pe.appendTooltipMeasures(he,void 0,de,d,f,o,pe,P,x)}}for(var ye=!1,me=0,ve=T;me<ve.length;me++)!function(i){ce&&N>i.difference&&!ye&&(ye=!0,h.push(Pe.createDataPoint(N,g.current,n,S,Y++,ue,de,s.fontProperties.color,v||w,3,{text:!0})),p.push(S),g=Pe.getNewPositionContext(g,N));var e,t=xe.formatFromMetadataColumn(i.column.value,l,f),a=m.splitIdentity(i.column.identity.expr),a=m.createBreakdownIdentity(q,X,a),r=void 0;H&&(r=m.createBreakdownTooltip(P,x,t,i.currentValue,i.previousValue,i.difference,f,o),e=_.map(i.currentTooltipValues,function(e,t){return _.isNumber(e)?e-i.previousTooltipValues[t]:e}),Pe.appendTooltipMeasures(e,void 0,r,d,f,o,i.previousTooltipValues,P,x)),h.push(Pe.createDataPoint(i.difference,g.current,n,t,Y++,a,r,null!=(R=i.labelColor)?R:s.fontProperties.color,i.formatString||v,0,{text:!0})),p.push(t),g=Pe.getNewPositionContext(g,i.difference)}(oe=ve[me]);ce&&!ye&&(ye=!0,h.push(Pe.createDataPoint(N,g.current,n,S,Y++,ue,de,s.fontProperties.color,v||w,3,{text:!0})),p.push(S),g=Pe.getNewPositionContext(g,N))}z&&(le={dataMap:((ne={})[c[0].queryName]=[D.identity],ne),metadata:[u.queryName]},O=Ae.convertSelectorsByColumnToSelector(le),k=new De(O,!1,le),se=void 0,H&&(se=Pe.createCategoryTooltip(c,u,Z,I,void 0,f),Pe.appendTooltipMeasures(F.currentTooltipValues,void 0,se,d,f,o)),h.push(Pe.createDataPoint(I,0,n,P,Y++,k,se,s.fontProperties.color,v||w,2,{text:!0})),p.push(P)),0===C&&(g={current:I,max:I,min:I}),x=P,X=q}}}i&&i.applySelectionStateToData(h),e.style.isHighContrast&&(B={visible:!0,color:be.getThemeColor(e.style,we),width:fe.defaultLineStrokeWidth});i=fe.getCategoryAxisProperties(t.metadata,void 0),t=fe.getPreferredCategoryWidth(i),i=_.map(h,function(e){return function(){return e.identity}});return{series:[{data:h,type:u&&u.type}],categories:p,categoryIdentities:i,categoryMetadata:c[0],preferredCategoryWidth:t,valuesMetadata:r.valueSources,legend:Pe.createLegend(n,o,y,e.style,!0,z),hasHighlights:!1,positionMin:g.min,positionMax:g.max,dataLabelsSettings:s,sentimentColors:n,isBreakdown:!0,numberOfBreakdowns:a,totalBreakdownCategories:j,strokeSettings:B}}t.prototype.splitIdentity=function(e){return r.ScopeIdentityExtractor.getKeyValuePairs(e)},t.prototype.createBreakdownIdentity=function(e,t,i){var a,t={dataMap:((a={})[this.breakdownMetadata.queryName]=[r.createDataViewScopeIdentity(o.inValues(__spreadArray(__spreadArray([],_.map(e,function(e){return e.left}),!0),_.map(i,function(e){return e.left}),!0),[__spreadArray(__spreadArray([],_.map(t,function(e){return e.right}),!0),_.map(i,function(e){return e.right}),!0),__spreadArray(__spreadArray([],_.map(e,function(e){return e.right}),!0),_.map(i,function(e){return e.right}),!0)]))],a),metadata:[this.valueMetadata.queryName]},e=Ae.convertSelectorsByColumnToSelector(t);return new De(e,!1,t)},t.prototype.createBreakdownOtherIdentity=function(e,t,i){var e={dataMap:((a={})[this.breakdownMetadata.queryName]=[r.createDataViewScopeIdentity(o.not(o.inValues([this.breakdownMetadata.expr],_.map(e,function(e){return[e.right]}))))],a),metadata:[this.valueMetadata.queryName]},a=(e.dataMap[this.categoryMetadata[0].queryName]=[r.createDataViewScopeIdentity(o.inValues(_.map(t,function(e){return e.left}),[_.map(i,function(e){return e.right}),_.map(t,function(e){return e.right})]))],Ae.convertSelectorsByColumnToSelector(e));return new De(a,!1,e)},t.prototype.createBreakdownTooltip=function(e,t,i,a,r,o,s,n){var l,c=this,u=new d.LazyTooltipBuilder;return this.breakdownMetadata&&u.withLazyValue(new h(function(){return{displayName:c.breakdownMetadata.displayName,value:xe.formatFromMetadataColumn(i,c.breakdownMetadata,s)}})),this.valueMetadata&&(null!=r&&u.withLazyValue(new h(function(){return{displayName:"".concat(t," ").concat(c.valueMetadata.displayName),value:xe.formatFromMetadataColumn(r,c.valueMetadata,s,!1)}})),null!=a&&u.withLazyValue(new h(function(){return{displayName:"".concat(e," ").concat(c.valueMetadata.displayName),value:xe.formatFromMetadataColumn(a,c.valueMetadata,s,!1)}})),null!=o)&&(l=xe.formatFromMetadataColumn(o,this.valueMetadata,s,!1),l=Pe.createPercentTooltipValue(l,o,r),u.withLazyValue(new h(function(){return{displayName:p.format(n.getLocalizedString("Waterfall_BreakdownDifferenceTooltip"),c.valueMetadata.displayName),value:l}}))),u};var Me=t;function t(e,t,i){this.breakdownMetadata=e,this.categoryMetadata=t,this.valueMetadata=i}return{matrixConverter:e}}}(powerbi=powerbi||{}),function(e){var i;function t(e,t){switch(this.layerType=e){case 5:this.adapter=new i.ColumnChartLayerViewModelAdapter(t);break;case 0:this.adapter=new i.LineChartLayerViewModelAdapter(t);break;case 2:this.adapter=new i.ScatterChartLayerViewModelAdapter(t);break;case 3:this.adapter=new i.WaterfallChartLayerViewModelAdapter(t)}}i=e.visuals||(e.visuals={}),t.prototype.getData=function(){return this.adapter.getData()},t.prototype.getCartesianChartLayerType=function(){return this.layerType},t.prototype.addWarnings=function(e){return this.adapter.addWarnings(e)},i.CartesianLayerViewModelAdapter=t}(powerbi=powerbi||{}),function(e){var i;function t(e){this.smallMultiplesResponsive=e}i=e.visuals||(e.visuals={}),t.prototype.createCartesianAdapter=function(e){return this.isSmallMultiples()?new i.SmallMultiplesCartesianViewModelAdapter(e,this.smallMultiplesOptions,this.smallMultiplesResponsive):new i.CartesianViewModelAdapter(e)},t.prototype.createLayerAdapter=function(e,t){return this.isSmallMultiples()?new i.SmallMultiplesLayerViewModelAdapter(e,t,this.smallMultiplesResponsive):new i.CartesianLayerViewModelAdapter(e,t)},t.prototype.setSmallMultiplesOptions=function(e){this.smallMultiplesOptions=e},t.prototype.createSmallMultiplesAdapter=function(e){if(this.isSmallMultiples())return new i.SmallMultiplesViewModelAdapter(e,this.smallMultiplesResponsive)},t.prototype.isSmallMultiples=function(){return this.smallMultiplesOptions&&this.smallMultiplesOptions.isSmallMultiples},i.ResponsiveCartesianAdapterFactory=t}(powerbi=powerbi||{}),function(o){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.dataView=e.dataView,this.viewport=e.viewport}t=o.visuals||(o.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 5},e.prototype.addWarnings=function(e){var t,i=this.originalData,a=this.currentData;i&&a&&(t=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(i,a),i=this.responsiveFontHelper.getFontSizeLabelWarning(i.totalLabelsSettings,a.totalLabelsSettings),t&&e.addForVisualObject("labels",t),i)&&e.addForVisualObject("totals",i)},e.prototype.applyResponsiveChanges=function(e,t){t=o.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),this.applySeriesDataLabelFontSizeChanges(e,t),this.applyTotalLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=o.Prototype.inherit(t.dataLabelsSettings),this.updateLabelSettings(e,t.dataLabelsSettings)},e.prototype.applySeriesDataLabelFontSizeChanges=function(e,t){for(var i,a=t.series=o.Prototype.inherit(t.series),r=0;r<a.length;r++)a[r].labelSettings&&((i=a[r]=o.Prototype.inherit(a[r])).labelSettings=o.Prototype.inherit(i.labelSettings),this.updateLabelSettings(e,i.labelSettings))},e.prototype.applyTotalLabelFontSizesChanges=function(e,t){t.totalLabelsSettings&&(t.totalLabelsSettings=o.Prototype.inherit(t.totalLabelsSettings),this.updateLabelSettings(e,t.totalLabelsSettings))},e.prototype.updateLabelSettings=function(e,t){var i=t.fontProperties;t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties),i!==t.fontProperties&&(t.labelOverflow=!0)},t.ColumnChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(o){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=o.visuals||(o.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 0},e.prototype.addWarnings=function(e){var t,i=this.originalData,a=this.currentData;i&&a&&(t=this.responsiveFontHelper.getFontSizeSeriesLabelWarning(i,a),i=this.responsiveFontHelper.getFontSizeLabelWarning(i.totalLabelsSettings,a.totalLabelsSettings),t&&e.addForVisualObject("labels",t),i)&&e.addForVisualObject("totals",i)},e.prototype.applyResponsiveChanges=function(e,t){t=o.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),this.applySeriesDataLabelFontSizeChanges(e,t),this.applyTotalLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=o.Prototype.inherit(t.dataLabelsSettings),this.updateLabelSettings(e,t.dataLabelsSettings)},e.prototype.applySeriesDataLabelFontSizeChanges=function(e,t){for(var i,a=t.series=o.Prototype.inherit(t.series),r=0;r<a.length;r++)a[r].labelSettings&&((i=a[r]=o.Prototype.inherit(a[r])).labelSettings=o.Prototype.inherit(i.labelSettings),this.updateLabelSettings(e,i.labelSettings))},e.prototype.applyTotalLabelFontSizesChanges=function(e,t){t.totalLabelsSettings&&(t.totalLabelsSettings=o.Prototype.inherit(t.totalLabelsSettings),this.updateLabelSettings(e,t.totalLabelsSettings))},e.prototype.updateLabelSettings=function(e,t){t.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.fontProperties)},t.LineChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(a){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=a.visuals||(a.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 2},e.prototype.addWarnings=function(e){var t=this.originalData,i=this.currentData;t&&i&&(t=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,i.dataLabelsSettings))&&e.addForVisualObject("categoryLabels",t)},e.prototype.applyResponsiveChanges=function(e,t){t=a.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=a.Prototype.inherit(t.dataLabelsSettings);var i=t.dataLabelsSettings.fontProperties;t.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(e,i)},t.ScatterChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(a){var t;function e(e){this.responsiveFontHelper=new t.ResponsiveCartesianFontHelper,this.originalData=e.data,this.viewport=e.viewport,this.dataView=e.dataView}t=a.visuals||(a.visuals={}),e.prototype.getData=function(){var e=this.originalData,e=t.ViewModelAdapterUtils.shouldApplyResponsiveChanges(this.dataView,t.cartesianChartProps)?this.applyResponsiveChanges(this.viewport,e):e;return this.currentData=e},e.prototype.getCartesianChartLayerType=function(){return 3},e.prototype.addWarnings=function(e){var t=this.originalData,i=this.currentData;t&&i&&(t=this.responsiveFontHelper.getFontSizeLabelWarning(t.dataLabelsSettings,i.dataLabelsSettings))&&e.addForVisualObject("labels",t)},e.prototype.applyResponsiveChanges=function(e,t){t=a.Prototype.inherit(t);return this.applyDataLabelFontSizesChanges(e,t),t},e.prototype.applyDataLabelFontSizesChanges=function(e,t){t.dataLabelsSettings=a.Prototype.inherit(t.dataLabelsSettings);var i=t.dataLabelsSettings.fontProperties;t.dataLabelsSettings.fontProperties=this.responsiveFontHelper.adjustFontSize(e,i)},t.WaterfallChartLayerViewModelAdapter=e}(powerbi=powerbi||{}),function(e){var o;function r(e){var t=e.columns,e=e.rows;return{legendPositionHeight:120+30*e,legendPositionWidth:210+40*t,legendShowHeight:90+30*e,legendShowWidth:90+40*t,removeXAxisTitleHeight:165+30*e,removeXAxisHeight:120+30*e,removeYAxisTitleWidth:210+40*t,removeYAxisWidth:120+40*t}}function t(e,t,i){this.smallMultiplesOptions=t,this.smallMultiplesResponsive=i,this.cartesianData=e.cartesianData,this.dataView=e.dataView,this.isCoreMultiple=e.isCoreMultiple,this.responsiveFontHelper=new o.ResponsiveCartesianFontHelper}(o=e.visuals||(e.visuals={})).calculateSMCartesianAdapterBreakpoints=r,t.prototype.getData=function(){var e=this.cartesianData,t=this.smallMultiplesOptions.isSmallMultiples;return e=this.smallMultiplesResponsive&&t&&o.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,o.cartesianChartProps).responsive?this.applyResponsiveChanges(this.cartesianData,this.smallMultiplesOptions):e},t.prototype.enumerateObjectInstances=function(e,t,i){},t.prototype.getResponsiveSlice=function(e,t,i){},t.prototype.applyResponsiveChanges=function(e,t){var i=o.ViewModelAdapterUtils.cloneData(e),a=r(t),t=t.viewport;return this.applyAxesResponsiveChanges(a,t,i),this.applyLegendResponsiveChanges(a,t,i),this.applyFontSizeReponsiveChanges(t,i),this.isCoreMultiple&&o.CartesianViewModelAdapterUtils.updatePlotResponsiveWarnings(i,e),i},t.prototype.applyAxesResponsiveChanges=function(e,t,i){var a=t.height,t=t.width;a<e.removeXAxisTitleHeight&&(i.axesData.x.showAxisTitle=!1),a<e.removeXAxisHeight&&(i.axesData.x.show=!1,i.axesData.x.showAxisTitle=!1),t<e.removeYAxisTitleWidth&&(i.axesData.y.showAxisTitle=!1,i.axesData.y2.showAxisTitle=!1),t<e.removeYAxisWidth&&(i.axesData.y.show=!1,i.axesData.y2.show=!1,i.axesData.y.showAxisTitle=!1,i.axesData.y2.showAxisTitle=!1)},t.prototype.applyLegendResponsiveChanges=function(e,t,i){var a,r;i.legendData.show&&(a=t.height,t=t.width,r=i.legendData.position,(a<e.legendPositionHeight||t<e.legendPositionWidth)&&o.Legend.isLeftOrRight(r)&&(i.legendData.position=o.LegendPosition.Top),(a<e.legendShowHeight||t<e.legendShowWidth)&&(i.legendData.show=!1),i.legendData.useLargeArrowHitArea=!0)},t.prototype.applyFontSizeReponsiveChanges=function(e,t){t.legendData&&t.legendData.fontProperties&&(t.legendData.fontProperties=this.responsiveFontHelper.adjustFontSize(e,t.legendData.fontProperties));t=t.axesData;t.x.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.labelFontProperties),t.x.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.x.titleFontProperties),t.y.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.labelFontProperties),t.y.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y.titleFontProperties),t.y2.labelFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.labelFontProperties),t.y2.titleFontProperties=this.responsiveFontHelper.adjustFontSize(e,t.y2.titleFontProperties)},o.SmallMultiplesCartesianViewModelAdapter=t}(powerbi=powerbi||{}),function(e){function t(e,t,i){this.layerType=e,this.smallMultiplesResponsive=i,this.layerData=t.data}e=e.visuals||(e.visuals={}),t.prototype.getData=function(){return this.smallMultiplesResponsive,this.layerData},t.prototype.getCartesianChartLayerType=function(){return this.layerType},t.prototype.addWarnings=function(e){},e.SmallMultiplesLayerViewModelAdapter=t}(powerbi=powerbi||{}),function(e){var s;function o(e,t,i){return e[0],e[1],t[0],t[1],d3.scaleLinear().range(t).domain(e).clamp(!0)(i)}function n(e){var t=e.rowCount,e=e.columnCount;return{showIconHeight:30*e,showIconWidth:40*t,showSubheaderHeight:80+50*t,gridlineRowUpperBreakpoint:120+52*t,gridlineRowLowerBreakpoint:120+32*t,gridlineColumnUpperBreakpoint:120+62*e,gridlineColumnLowerBreakpoint:120+42*e,removeGridLineHeight:32*t,removeGridLineWidth:42*e,paddingRowUpperBreakpoint:120+130*t,paddingRowLowerBreakpoint:120+30*t,paddingColumnUpperBreakpoint:120+140*e,paddingColumnLowerBreakpoint:120+40*e}}function t(e,t){this.smallMultiplesResponsive=t,this.multiplesLayout=e.multiplesLayout,this.multiplesSubheader=e.multiplesSubheader,this.dataView=e.dataView,this.viewport=e.viewport,this.responsiveFontHelper=new s.ResponsiveCartesianFontHelper}(s=e.visuals||(e.visuals={})).interpolateValueFromBreakpoints=o,s.calculateSmallMultiplesViewModelAdapterBreakpoints=n,t.prototype.getMultiplesLayout=function(e){var t=this.multiplesLayout;return t=this.smallMultiplesResponsive&&s.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,s.cartesianChartProps).responsive?this.applyResponsiveChanges(this.viewport,this.multiplesLayout,e):t},t.prototype.getMultiplesSubheader=function(e){var t=this.multiplesSubheader;return t=this.smallMultiplesResponsive&&s.ViewModelAdapterUtils.getResponsiveVisualProperties(this.dataView,s.cartesianChartProps).responsive?this.applySubheaderResponsiveChanges(this.viewport,t,e):t},t.prototype.enumerateObjectInstances=function(e,t,i){this.smallMultiplesResponsive&&i&&"general"===e.objectName&&this.enumerateGeneral(t,this.dataView)},t.prototype.enumerateGeneral=function(e,t){t={selector:null,properties:{responsive:s.ViewModelAdapterUtils.getResponsiveVisualProperties(t,s.cartesianChartProps).responsive},objectName:"general"};e.pushInstance(t)},t.prototype.getResponsiveSlice=function(e,t,i){if(t)return t=s.cartesianChartProps.general,e=s.ViewModelAdapterUtils.getResponsiveVisualProperties(e,s.cartesianChartProps),{item:new s.builder.SimpleFormattingSliceBuilder({uidBuilder:new s.builder.FormattingSliceUidBuilder(new s.builder.FormattingGroupUidBuilder(new s.builder.FormattingCardUidBuilder("visualPlaceholderCard"),"visualPlaceholderGroup"),"responsive"),control:new s.builder.ToggleSwitchBuilder({descriptor:t.responsive,value:e.responsive}).build(),localize:i}).build(),revertToDefaultDescriptors:[t.responsive]}},t.prototype.applyResponsiveChanges=function(e,t,i){var a=s.ViewModelAdapterUtils.cloneData(t),r=n(a);return this.applyIconResponsiveChanges(r,e,a),this.applyGridlinesResponsiveChanges(r,e,a),this.applyPaddingResponsiveChanges(r,e,a),this.updateResponsiveWarnings(a,t,i),a},t.prototype.applyIconResponsiveChanges=function(e,t,i){(t.height<e.showIconHeight||t.width<e.showIconWidth)&&(i.showIcon=!0)},t.prototype.applyGridlinesResponsiveChanges=function(e,t,i){var a=i.gridLineWidth,r=i.gridLineWidth;null!=i.gridLineWidth&&(t.height<e.removeGridLineHeight||t.width<e.removeGridLineWidth?i.gridLineWidth=0:t.height<=e.gridlineRowLowerBreakpoint||t.width<=e.gridlineColumnLowerBreakpoint?i.gridLineWidth=1:(t.height<e.gridlineRowUpperBreakpoint&&(r=Math.ceil(o([e.gridlineRowUpperBreakpoint,e.gridlineRowLowerBreakpoint],[i.gridLineWidth,1],t.height))),t.width<e.gridlineColumnUpperBreakpoint&&(a=Math.ceil(o([e.gridlineColumnUpperBreakpoint,e.gridlineColumnLowerBreakpoint],[i.gridLineWidth,1],t.width))),i.gridLineWidth=Math.min(a,r)))},t.prototype.applyPaddingResponsiveChanges=function(e,t,i){var a;(i.advancedPaddingOptions||0!==i.gridPadding)&&(t.height<e.paddingRowUpperBreakpoint&&(a=[e.paddingRowUpperBreakpoint,e.paddingRowLowerBreakpoint],i.rowPaddingOuter=i.rowPaddingOuter&&Math.ceil(o(a,[i.rowPaddingOuter,1],t.height)),i.rowPaddingInner=i.rowPaddingInner&&Math.ceil(o(a,[i.rowPaddingInner,1],t.height))),t.width<e.paddingColumnUpperBreakpoint)&&(a=[e.paddingColumnUpperBreakpoint,e.paddingColumnLowerBreakpoint],i.columnPaddingOuter=i.columnPaddingOuter&&Math.ceil(o(a,[i.columnPaddingOuter,1],t.width)),i.columnPaddingInner=i.columnPaddingInner&&Math.ceil(o(a,[i.columnPaddingInner,1],t.width)))},t.prototype.applySubheaderResponsiveChanges=function(e,t,i){var a=s.ViewModelAdapterUtils.cloneData(t),r=n(this.multiplesLayout);return e.height<r.showSubheaderHeight&&(a.show=!1),a.show&&a.fontProperties&&(a.fontProperties=this.responsiveFontHelper.adjustFontSize(e,a.fontProperties),a.height=a.fontProperties.size.px+a.margins.top+a.margins.bottom),this.updateSubheaderResponsiveWarnings(a,t,i),a},t.prototype.updateResponsiveWarnings=function(e,t,i){var a,r=i,o={};for(a in e.showIcon?o.subheader=new s.SmallMultiplesSubheadersNotRenderedWarning:(e.rowPaddingInner===t.rowPaddingInner&&e.rowPaddingOuter===t.rowPaddingOuter&&e.columnPaddingInner===t.columnPaddingInner&&e.columnPaddingOuter===t.columnPaddingOuter||(o.smallMultiplesLayout=new s.SmallMultiplesPaddingSizeWarning),e.gridLineWidth!==t.gridLineWidth&&(o.smallMultiplesLayout=new s.SmallMultiplesGridlinesSizeWarning)),o)r.addForVisualObject(a,{selector:null,warnings:[o[a]]})},t.prototype.updateSubheaderResponsiveWarnings=function(e,t,i){var a,r=i,o={};for(a in e.show!==t.show&&(o.subheader=new s.SmallMultiplesSubheadersNotRenderedWarning),_.isEqual(e.fontProperties.size,t.fontProperties.size)||(o.subheader=new s.SmallMultiplesSubheadersFontSizeWarning),o)r.addForVisualObject(a,{selector:null,warnings:[o[a]]})},s.SmallMultiplesViewModelAdapter=t}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['cartesianVisuals.min.js'] || (this.parseTimeMarkers['cartesianVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
