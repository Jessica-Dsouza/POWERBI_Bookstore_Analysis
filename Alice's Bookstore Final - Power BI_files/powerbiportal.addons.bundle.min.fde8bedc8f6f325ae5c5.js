'use strict'; 
"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] || (this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('powerbiportal.addons.bundle.min.js');var powerbi,__awaiter=this&&this.__awaiter||function(e,r,s,c){return new(s=s||Promise)(function(a,t){function i(e){try{o(c.next(e))}catch(e){t(e)}}function n(e){try{o(c.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?a(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,n)}o((c=c.apply(e,r||[])).next())})},__generator=this&&this.__generator||function(i,n){var o,r,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(a){return function(e){var t=[a,e];if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(s=2&t[0]?r.return:t[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,t[1])).done)return s;switch(r=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,r=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))c.label=t[1];else if(6===t[0]&&c.label<s[1])c.label=s[1],s=t;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(t)}}t=n.call(i,c)}catch(e){t=[6,e],r=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};!(function(t){var a=t.telemetry||(t.telemetry={}),e=jsCommon.Utility,i=t.telemetryEventFactory,n=t.telemetry.EventFactories;e?e.generateGuid:Function.prototype,a.GatewaysAddPrepopulatedDatasourceToGatewayEventName="PBI.Gateways.AddPrepopulatedDatasourceToGateway",a.GatewaysAddPrepopulatedDatasourceToGateway=n[a.GatewaysAddPrepopulatedDatasourceToGatewayEventName]=function(e){return i({name:a.GatewaysAddPrepopulatedDatasourceToGatewayEventName,baseEvent:a.CustomerAction(e),info:e,category:t.TelemetryCategory.CustomerAction,loggers:a.GatewaysAddPrepopulatedDatasourceToGatewayLoggers})},a.GatewaysTableLoadedEventName="PBI.Gateways.TableLoaded",a.GatewaysTableLoaded=n[a.GatewaysTableLoadedEventName]=function(e){return i({name:a.GatewaysTableLoadedEventName,baseEvent:a.Verbose(e),info:e,category:t.TelemetryCategory.Verbose,loggers:a.GatewaysTableLoadedLoggers})},a.GatewaysGetTokenErrorEventName="PBI.Gateways.GetTokenError",a.GatewaysGetTokenError=n[a.GatewaysGetTokenErrorEventName]=function(e){return i({name:a.GatewaysGetTokenErrorEventName,baseEvent:a.ErrorWithStackTrace(e),info:e,category:t.TelemetryCategory.CriticalError,loggers:a.GatewaysGetTokenErrorLoggers})}})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).htmlTemplate||(e.htmlTemplate={})).put=function(e){e.put("components/datasourceSettings/datasourceSettingsView.html",'<div class="formContainer"><header ng-switch on="ctrl.viewModel.waitingForDataSourceStatus || ctrl.viewModel.isLoadingForm"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false"><div class="successContainer" ng-if="ctrl.isDataSourceTestConnectionSuccessful()"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsDataSource_SettingsConnectionSuccessfulText"></span></div><div ng-if="!ctrl.viewModel.hasTestConnectionFailure && ctrl.datasourceModel.connectionError && !ctrl.datasourceModel.connected"><inline-message use-error-icon trace-details="ctrl.datasourceModel.traceDetails"><span localize="SettingsDataSource_SettingsConnectionErrorTitle"></span><span ng-bind="ctrl.datasourceModel.connectionError"></span></inline-message></div><div ng-if="!ctrl.viewModel.hasTestConnectionFailure && ctrl.datasourceModel.connectionError && ctrl.datasourceModel.connected"><inline-message class="inlineInfo" trace-details="ctrl.datasourceModel.traceDetails"><span ng-bind="ctrl.datasourceModel.connectionError"></span></inline-message></div><div class="messageContainer" ng-switch on="ctrl.viewModel.messageState"><div ng-switch-when="1"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><span localize="SettingsDataSource_SettingsAddUserText1" localize-fragments><a fragment-index="0" href=\'\' localize="SettingsDataSource_SettingsAddUserText2" ng-click="ctrl.switchToUserTab()"></a></span></inline-message></div><div ng-switch-when="2"><inline-message use-error-icon trace-details="ctrl.datasourceModel.compositeTraceDetails"><span ng-bind="ctrl.datasourceModel.errorTitle" role="alert"></span><span ng-bind="ctrl.datasourceModel.compositeErrorMessage" role="alert"></span></inline-message></div></div></div></header><form name="settingsForm" autocomplete="off" ng-hide="ctrl.viewModel.isLoadingForm"><section><label for="dataSourceName" class="input-field-label" localize="SettingsDataSource_SettingsName"></label> <input id="dataSourceName" select-pristine-on-focus type="text" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus" ng-model="ctrl.viewModel.editableSettings.dataSourceName" required/></section><section><label for="dataSourceType" class="input-field-label" localize="SettingsDataSource_SettingsType"></label> <select id="dataSourceType" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="ctrl.viewModel.editableSettings.dataSourceKind" ng-change="ctrl.onDataSourceTypeChange()" ng-options="dataSourceKind as value.name for (dataSourceKind, value) in ctrl.viewModel.dataSourceMetadataMap" required><option value="" disabled localize="SettingsGateway_SelectDataSourceType">Select a data source type</option></select></section><div class="connectionSettings" ng-show="ctrl.viewModel.editableSettings.dataSourceKind !== undefined"><section ng-repeat="parameter in ctrl.viewModel.editableSettings.requiredDataSourceConnectionParameters"> <label for="{{ ::parameter.name }}" class="input-field-label">{{ ::parameter.displayName }}</label> <input id="{{ ::parameter.name }}" type="{{ ::parameter.type }}" ng-if="::!parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value" required/> <select id="{{ ::parameter.name }}" ng-if="::parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value" ng-options="option.value as option.caption for option in parameter.options" required></select></section><section ng-show="ctrl.viewModel.dataSourceMetadataMap[ctrl.viewModel.editableSettings.dataSourceKind].credentialTypeOptions.length > 1                    || ctrl.viewModel.dataSourceMetadataMap[ctrl.viewModel.editableSettings.dataSourceKind].credentialTypeOptions[0].id === 5"><label for="dataSourceAuthenticationMethod" class="input-field-label" localize="SettingsDataSource_SettingsAuthenticationMethod"></label> <select id="dataSourceAuthenticationMethod" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus || ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" ng-model="ctrl.viewModel.editableSettings.credentialType" ng-change="ctrl.onCredentialMethodChange()" ng-options="option.id as option.name for option in ctrl.viewModel.dataSourceMetadataMap[ctrl.viewModel.editableSettings.dataSourceKind].credentialTypeOptions" required><option value="" disabled localize="SettingsGateway_SelectAnAuthenticationMethod">Select an authentication method</option></select></section><div ng-show="ctrl.viewModel.editableSettings.credentialType !== undefined && ctrl.viewModel.editableSettings.credentialType !== 0 && ctrl.viewModel.editableSettings.credentialType !== 2" ng-disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled"><section><span localize="SettingsDataSource_SettingsCredentialEncryptionText"></span> &#32;<a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></section><div ng-if="ctrl.viewModel.editableSettings.credentialType !== 5"><section ng-repeat="parameter in ctrl.viewModel.editableSettings.credentialParameters"><section ng-show="{{ parameter.shouldDisplay }}"> <label for="{{ ::parameter.name }}" class="input-field-label">{{ ::parameter.displayName }}</label><section ng-if="parameter.type === \'text\'"> <input id="{{ ::parameter.name }}" type="text" placeholder="{{ ::parameter.placeholder }}" ng-model="parameter.value" ng-change="ctrl.onCredentialParameterChange($index)" ng-focus="ctrl.onCredentialParameterFocus($index)" ng-blur="ctrl.onCredentialParameterBlur($index)" ng-required="{{ parameter.required }}" ng-disabled="{{ parameter.disabled }}"/></section><section ng-if="parameter.type === \'password\'"> <input id="{{ ::parameter.name }}" type="password" ng-model="parameter.value" ng-change="ctrl.onCredentialParameterChange($index)" ng-focus="ctrl.onCredentialParameterFocus($index)" ng-blur="ctrl.onCredentialParameterBlur($index)" ng-required="{{ parameter.required }}" ng-disabled="{{ parameter.disabled }}"/></section><section ng-if="parameter.type === \'select\'"> <select id="{{ ::parameter.name }}" ng-options="nvp.Value as nvp.Name for nvp in parameter.options" ng-model="parameter.value" ng-change="ctrl.onCredentialParameterChange($index)" ng-focus="ctrl.onCredentialParameterFocus($index)" ng-blur="ctrl.onCredentialParameterBlur($index)" ng-required="{{ parameter.required }}" ng-disabled="{{ parameter.disabled }}"><option value="" disabled localize="SelectAnOption"> Select an Option</option></select><section class="glyph-error-color" ng-if="ctrl.showSAPBWSncLibWarningMessage()"><span localize="SettingsDataSource_SettingsSAPBWSncLibWarning_Message"></span> &#32;<a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=2151620" localize="LearnMore"></a></section></section></section></section></div><div class="oauthCredentialCheck" ng-if="ctrl.viewModel.editableSettings.credentialType === 5"><i class="glyphicon pbi-glyph-error glyph-small" ng-show="ctrl.viewModel.isAddingDataSource && authDialogParameters.credentialData === undefined"></i> <button class="oauthEditCredentialButton" localize="SettingsDataset_ManageDataSources_EditButtonText" ng-click="ctrl.oauthEditCredentialButton(settingsForm.$valid)"></button></div></div><div class="skipTestConnectionCheckBox" ng-if="ctrl.isSkipTestConnectionAllowed()"> <input id="skipTestConnection" type="checkbox" ng-disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" ng-model="ctrl.isSkipTestConnectionSelected" ng-change="ctrl.onSkipTestConnectionChange()"/><label class="skipTestConnectionLabel" localize="SettingsDataSource_SettingsSkipTestConnection_Text" for="skipTestConnection"></label></div><section class="advancedSettingsContainer" ng-if="ctrl.enterpriseGatewayETLEnabled"> <button class="expandHiddenSectionButton" ng-class="{expanded: ctrl.viewModel.advancedSettingsExpanded}" ng-click="ctrl.viewModel.advancedSettingsExpanded = !ctrl.viewModel.advancedSettingsExpanded; $event.stopPropagation();" aria-expanded="{{ctrl.viewModel.advancedSettingsExpanded}}"><i class="glyphicon pbi-glyph-chevronrightmedium expandIcon"></i><span localize="SettingsDataSource_AdvancedSettings"></span></button><div ng-show="ctrl.viewModel.advancedSettingsExpanded"><section ng-if="ctrl.hasOptionalParameters()" id="optionalParametersSection"><section ng-repeat="parameter in ctrl.viewModel.editableSettings.optionalDataSourceConnectionParameters"> <label for="{{ ::parameter.name }}" class="input-field-label">{{ ::parameter.displayName }}</label> <input id="{{ ::parameter.name }}" type="{{ ::parameter.type }}" ng-if="::!parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value"/> <select id="{{ ::parameter.name }}" ng-if="::parameter.isSelectableList" ng-disabled="!ctrl.viewModel.isAddingDataSource || ctrl.viewModel.waitingForDataSourceStatus" ng-model="parameter.value" ng-options="option.value as option.caption for option in parameter.options"></select></section></section><section ng-if="ctrl.allowOnPremSingleSignOn()" id="singleSignOnOptionSection"><div class="singleSignOnSettingCheckBox"> <input id="singleSignOnKerberosForDQ" type="checkbox" ng-disabled="ctrl.isNonImportSSOCheckboxDisabled" ng-model="ctrl.isSingleSignOnKerberosEnabled" ng-change="ctrl.onSingleSignOnKerberosChange()"/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOn_Text" for="singleSignOnKerberosForDQ"></label></div><div class="singleSignOnSettingDescription"><span localize="SettingsDataSource_SettingsSingleSignOn_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></div><section ng-if="ctrl.showKerberosSSOForDQAndRefresh()"><div class="singleSignOnSettingCheckBox"> <input id="singleSignOnKerberosForDQAndRefresh" type="checkbox" ng-disabled="!ctrl.viewModel.isAddingDataSource" ng-model="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" ng-change="ctrl.onSingleSignOnKerberosForDQAndRefreshChange()"/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOnKerberosForDQAndRefresh_Text" for="singleSignOnKerberosForDQAndRefresh"></label></div><div class="singleSignOnSettingDescription singleSignOnSettingDescriptionFirstLine"><span localize="SettingsDataSource_SettingsSingleSignOnKerberosForDQAndRefresh_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></div><div ng-if="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled" class="singleSignOnSettingDescription singleSignOnSettingDescriptionLastLine"><span localize="SettingsDataSource_SettingsSingleSignOnKerberosForDQAndRefresh_DisabledWarning"></span></div></section><div class="singleSignOnSettingCheckBox" ng-if="ctrl.isSingleSignOnSAMLAllowed()"> <input id="singleSignOnSAMLForDQ" type="checkbox" ng-disabled="ctrl.isNonImportSSOCheckboxDisabled" ng-model="ctrl.isSingleSignOnSAMLEnabled" ng-change="ctrl.onSingleSignOnSAMLChange()"/><label class="singleSignOnSettingDescription singleSignOnSettingDescriptionOnlyLine" localize="SettingsDataSource_SettingsSingleSignOnSAML_Text" for="singleSignOnSAMLForDQ"></label></div></section><section ng-if="ctrl.isSingleSignOnAADSupported()"><div class="singleSignOnSettingCheckBox"> <input id="SingleSignOnAAD" type="checkbox" ng-disabled="ctrl.isNonImportSSOCheckboxDisabled" ng-model="ctrl.isSingleSignOnAADEnabled" ng-change="ctrl.onSingleSignOnAADChange()" no-label/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOnAAD_Text" for="SingleSignOnAAD"></label></div><div class="singleSignOnSettingDescription"><span localize="SettingsDataSource_SettingsSingleSignOn_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=861818" localize="LearnMore"></a></div></section><section ng-if="ctrl.showSSOTestConnection()"><sso-test-connection datasource-model="ctrl.datasourceModel" single-sign-on-type="ctrl.viewModel.singleSignOnType"></sso-test-connection></section><section ng-if="ctrl.showEncryptedConnection()" id="EncryptedConnectionSection"><section id="EncryptedConnectionSelectSection"><label for="EncryptedConnectionSelect" class="input-field-label" localize="SettingsDataSource_SettingsEncryptedConnectionOptionLabel"></label> <select id="EncryptedConnectionSelect" ng-disabled="ctrl.disableEncryptedConnection()" ng-model="ctrl.encryptedConnectionString" ng-change="ctrl.onEncryptedConnectionChange()"><option value="0" localize="Encrypted" ng-selected="ctrl.viewModel.editableSettings.encryptedConnection === 0"></option><option value="2" localize="NotEncrypted" ng-selected="ctrl.viewModel.editableSettings.encryptedConnection === 2"></option></select></section><div ng-show="ctrl.isAutoDetectEncryptedConnectionVisible" id="autoDetectEncryptedConnectionCheckBox"> <input id="autoDetectEncryptedConnection" type="checkbox" ng-model="ctrl.isAutoDetectEncryptedConnectionEnabled" ng-change="ctrl.onAutoDetectEncryptedConnectionChange()" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus"/><label for="autoDetectEncryptedConnection" class="input-field-label" localize="SettingsDataSource_SettingsAutoDetectEncryptedConnectionLabel"></label></div></section><section><label for="dataSourcePrivacyLevel" class="input-field-label" localize="SettingsDataSource_SettingsPrivacyLevelLabel"></label> <select id="dataSourcePrivacyLevel" ng-disabled="ctrl.viewModel.waitingForDataSourceStatus" ng-model="ctrl.privacyLevelString" ng-change="ctrl.onPrivacyLevelChange()"><option value="0" localize="None" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 0"></option><option value="1" localize="SettingsDataSource_SettingsPrivacyLevel_Private" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 1"></option><option value="2" localize="SettingsDataSource_SettingsPrivacyLevel_Organizational" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 2"></option><option value="3" localize="SettingsDataSource_SettingsPrivacyLevel_Public" ng-selected="ctrl.viewModel.editableSettings.privacyLevel === 3"></option></select></section></div></section></div><div class="buttonsContainer" ng-if="ctrl.viewModel.editableSettings.dataSourceKind !== undefined"><div ng-switch on="ctrl.viewModel.isAddingDataSource"> <button class="primary" localize="Apply" ng-switch-when="false" ng-disabled="ctrl.isUpdateDataSourceDisabled()" ng-click="ctrl.tryApplyChanges(settingsForm.$valid)"></button> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-switch-when="true" ng-disabled="ctrl.isAddDataSourceDisabled()" ng-click="ctrl.tryAddDataSource(settingsForm.$valid)"></button> <button localize="SettingsDataSource_SettingsDiscard" ng-disabled="!settingsForm.$dirty || ctrl.viewModel.waitingForDataSourceStatus" ng-click="ctrl.tryDiscardChanges()" formnovalidate></button></div></div><auth-dialog view-model="authDialogParameters" ng-if="authDialogParameters.showAuthDialog"></auth-dialog></form></div>'),e.put("components/pgwWarningBox/pgwWarningBoxView.html",'<span><div class="gatewayTypeSelectionContainer newPersonalGatewayInstallNow" ng-if="$ctrl.allowPersonalGateway && $ctrl.showPersonalGatewayFirstTimeInstallNow()"><label localize="SettingsDataset_No_Personal_Gateways_Installed" class="noPersonalGatewaysInstalledLabel"></label><a localize="LearnMore" target="onPremGatewayPersonalLearnMore" href="https://go.microsoft.com/fwlink/?LinkId=843378" class="pgwLink"></a> <button><a localize="SettingsDataset_OnPrem_Gateway_InstallNow" href="https://go.microsoft.com/fwlink/?LinkID=534231" target="onPremGatewayPersonalDownloadPage"></a></button></div><div class="gatewayTypeSelectionContainer newPersonalGatewayInstallNow" ng-if="$ctrl.allowPersonalGateway && $ctrl.showPersonalGatewayUpgradeRequired()"><label localize="SettingsDataset_New_OnPrem_Gateway_Available_WithExpirationInfo" class="noPersonalGatewaysInstalledLabel"></label><a localize="LearnMore" target="onPremGatewayPersonalLearnMore" href="https://go.microsoft.com/fwlink/?LinkId=843378" class="pgwLink"></a> <button><a localize="UpgradeDialogButtonText_UpgradeNow" href="https://go.microsoft.com/fwlink/?LinkID=534231" target="onPremGatewayPersonalDownloadPage"></a></button></div></span>'),e.put("components/ssoTestConnection/ssoTestConnectionView.html",'<section> <button class="expandHiddenSectionButton" ng-class="{expanded: $ctrl.ssoTestConnectionExpanded}" ng-click="$ctrl.ssoTestConnectionExpanded = !$ctrl.ssoTestConnectionExpanded; $event.stopPropagation();" aria-expanded="{{$ctrl.ssoTestConnectionExpanded}}"><i class="glyphicon pbi-glyph-chevronrightmedium expandIcon"></i><span localize="SettingsGateways_SSOTestConnection_Title"></span></button><section ng-if="$ctrl.ssoTestConnectionExpanded"><div class="description"><span localize="SettingsGateways_SSOTestConnection_Description"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=2154997" localize="LearnMore"></a></div><div class="inputContainer"> <input id="ssoTestConnectionUpnInput" ng-model="$ctrl.upn" type="text" localize-attr="{placeholder: \'UserPrincipalName\'}" ng-disabled="$ctrl.gatewayUpgradeRequired()" ignore-dirty/> <button localize="StartTest" ng-click="$ctrl.executeSSOTestConnection()" ng-disabled="$ctrl.disableStartTestButton()"></button></div><div ng-if="$ctrl.gatewayUpgradeRequired()" class="description"><i class="glyphicon glyph-small pbi-glyph-warning glyph-warning-color"></i><span localize="SettingsGateways_SSOTestConnection_UpgradeGateway"></span></div><div class="statusContainer" ng-style="{\'visibility\': $ctrl.testStatus !== \'NoResults\' ? \'visible\':\'hidden\'}" ng-switch on="$ctrl.testStatus"><div ng-switch-when="Running"><spinner></spinner><span localize="TestingGatewayCluster"></span></div><div ng-switch-when="Success"><i class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></i><span localize="CdsaAuthoring_Iframe_Succeeded"></span></div><div ng-switch-when="Failed"><i class="glyphicon glyph-small pbi-glyph-error glyph-error-color"></i><span localize="CdsaAuthoring_Iframe_Failed"></span></div><a ng-switch-when="Success|Failed" ng-switch-when-separator="|" ng-click="$ctrl.setDisplayDetailedResults(true); $event.stopPropagation();" localize="DetailedResults"></a></div></section></section><modal-dialog class="ssoTestConnectionModal" ng-if="$ctrl.displayDetailedResults" on-confirm-action="$ctrl.setDisplayDetailedResults(false)" on-cancel-action="$ctrl.setDisplayDetailedResults(false)" view-model="$ctrl.dialogModel"><section><h3 localize="DetailedResults"></h3><section class="resultContainer"><h4 ng-if="$ctrl.testResults.data.results.length > 1" class="resultsHeader" localize="ResultsByGateway"></h4><table ng-repeat="result in $ctrl.testResults.data.results"><tr><td ng-bind="::$ctrl.getGatewayNameFromObjectId(result.gatewayObjectId)" class="gatewayName"></td><td ng-switch="result.testSuccessful"><span ng-switch-when="true" localize="TestSucceeded" class="gatewayStatus"></span><span ng-switch-when="false" localize="TestFailed" class="gatewayStatus"></span></td></tr><tr ng-if="result.error || result.upgradeGateway"><td localize="SnapshotEmbed_ErrorMessage"></td><td ng-switch="result.upgradeGateway"><span ng-switch-when="true" localize="SettingsGateways_SSOTestConnection_UpgradeGateway"></span><span ng-switch-when="false" ng-bind="::$ctrl.convertToErrorMessage(result.error)"></span></td></tr><tr ng-if="result.error && result.error.code"><td localize="ErrorCode"></td><td ng-bind="::result.error.code"></td></tr><tr ng-switch="$ctrl.singleSignOnType" ng-if="result.resolvedUserPrincipalName"><td ng-switch-when="3" localize="SAMLCertificateUPN"></td><td ng-switch-default localize="LocalActiveDirectoryUPN"></td><td ng-bind="::result.resolvedUserPrincipalName"></td></tr><tr ng-if="result.activeDirectoryServer"><td localize="ActiveDirectoryServer"></td><td ng-bind="::result.activeDirectoryServer"></td></tr></table><span ng-if="$ctrl.testStatus === \'Failed\'" localize="SettingsGateways_SSOTestConnection_GatewayLogs"></span><h4 class="additionalInfo" localize="AdditionalInfo"></h4><table><tr><td localize="ServerError_ActivityIdText"></td><td ng-bind="::$ctrl.testResults.activityId"></td></tr><tr><td localize="ServerError_RequestIdText"></td><td ng-bind="::$ctrl.testResults.requestId"></td></tr><tr><td localize="DateAndTimeLabel"></td><td ng-bind="::$ctrl.testTimestamp"></td></tr></table></section> <button class="primary" ng-click="$ctrl.setDisplayDetailedResults(false)" localize="InFocus_Close"></button></section></modal-dialog>'),e.put("components/upnMappingPane/upnMappingPaneView.html",'<div class="upnMappingPane" ng-if="::$ctrl.viewModel"><header><h3 class="primaryHeading" localize="UpnMappingPane_Title"></h3><h6 class="secondaryHeading" localize="UpnMappingPane_Subtitle" localize-fragments><a fragment-index="0" href="//go.microsoft.com/fwlink/?LinkID=786855" target="_blank" localize="LearnMore"></a></h6></header><section class="contentContainer"><section class="dataSource"><h6 localize="UpnMappingPane_SelectDataSource"></h6><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="0"/><label class="form-label" localize="UpnMappingPane_EffectiveUserName"></label></div><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="1"/><label class="form-label" localize="UpnMappingPane_CustomData"></label></div></section><section class="mappingTable"><div class="mappingTableContainer"><div class="caption"><div localize="UpnMappingPane_Replace"></div><div localize="UpnMappingPane_With"></div></div><div class="tableContainer"><table><tr ng-repeat="rule in $ctrl.viewModel.mappingRules track by $index" ng-click="$ctrl.selectedRule = rule" ng-class="{selected: rule === $ctrl.selectedRule}"><td ng-bind="$index + 1"></td><td ng-bind="rule.searchString"></td><td ng-bind="rule.replacementString"></td></tr><tr><td ng-bind="$ctrl.viewModel.mappingRules.length + 1"></td><td> <input name="newSearchString" ng-model="$ctrl.newRule.searchString" placeholder="{{::$ctrl.localizedOriginalName}}"/></td><td> <input name="newReplacementString" ng-model="$ctrl.newRule.replacementString" placeholder="{{::$ctrl.localizedNewName}}"/></td></tr></table></div></div><div class="tableSelectionControl"><i class="glyphicon pbi-glyph-chevronupmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectPre()"></i><i class="glyphicon pbi-glyph-chevrondownmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectNext()"></i></div><div> <button localize="UpnMappingPane_Add" ng-disabled="!$ctrl.newRule.searchString || !$ctrl.newRule.replacementString" ng-click="$ctrl.addNewRule()"></button> <button localize="Delete" ng-disabled="!$ctrl.selectedRule" ng-click="$ctrl.deleteRule()"></button></div></section><section class="testRule"><div localize="UpnMappingPane_TestRuleTitle"></div><div class="originalValue"><div localize="UpnMappingPane_OriginalName"></div><div> <input ng-model="$ctrl.testRuleOriginalName" placeholder="{{::$ctrl.localizedOriginalName}}"/> <button localize="UpnMappingPane_TestRuleButtonText" ng-disabled="!$ctrl.testRuleOriginalName" ng-click="$ctrl.testRule()"></button></div></div><div class="replacementValue"><div localize="UpnMappingPane_AfterRuleApplied"></div><div> <input ng-model="$ctrl.testRuleNewName" placeholder="{{::$ctrl.localizedResultOfApplyingMappingRule}}" readonly/><spinner ng-show="$ctrl.isTestRuleRequestPending"></spinner></div></div></section></section><footer><div class="buttons"><spinner ng-show="$ctrl.isUpdateDataSourceRequestPending"></spinner> <button class="biButton primary" type="button" localize="OK_ButtonText" ng-disabled="false" ng-click="$ctrl.saveChangesAndExit()"></button> <button class="biButton" type="button" localize="Cancel_ButtonText" ng-click="$ctrl.closeUpnMappingPane()"></button></div></footer></div>'),e.put("views/datasourceUsersView.html",'<div class="formContainer verticalPaneContainer"><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_UsersAllowed"></label><div class="addEmailAddress"><emails-list view-model="viewModel.pendingUsers" allow-security-groups="true" allow-unified-groups="true"></emails-list> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddUsers()"></button></div></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><table><tr ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" style="display:block"><td><div class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved" ng-attr-aria-label="{{editableUser.name}}"> <label class="form-label">{{editableUser.name}}</label></div></td><td><pbi-icon class="overrideEffectiveIdentity" name="permissions" size="small" ng-if="::editableUser.accessRight === 9" tooltip tooltip-config="{tooltipLocalizeDescription: \'OverrideEffectiveIdentityAccessRight_Icon_Tooltip\', tooltipArrowPosition: 1}"></pbi-icon></td></tr></table></div></div> <button localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedUsers()"></button> <button class="rightSideButton" ng-if="upnMappingEnabled" localize="UpnMappingPane_Title" ng-disabled="!viewModel.editableUsers || viewModel.editableUsers.length === 0" ng-click="mapUserNames()"></button></section></div></div>'),e.put("views/datasourceView.html",'<div class="settingsContainer"><div class="tabHeader"><ul><li ng-class="{selected: viewModel.tabSelectionType === 1}"> <button class="tabHeaderButton" ng-click="onTabSelected(1)" localize="SettingsDataSource_SettingsTitle"></button></li><li ng-class="{selected: viewModel.tabSelectionType === 2}" ng-if="viewModel.id !== -1"> <button class="tabHeaderButton" ng-click="onTabSelected(2)" localize="SettingsDataSource_UsersTitle"></button></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><datasource-settings ng-switch-when="1" datasource-model="viewModel"></datasource-settings><datasource-users ng-switch-when="2" datasource-model="viewModel"></datasource-users></div></div>'),e.put("views/gatewayAdministratorsView.html",'<div class="formContainer verticalPaneContainer"><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_AdminsAllowed"></label><div class="addEmailAddress"><emails-list view-model="viewModel.pendingUsers" allow-security-groups="true" allow-unified-groups="true"></emails-list> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddAdministrators()"></button></div></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved" ng-attr-aria-label="{{editableUser.name}}"> <label ng-class="{\'userWithNoEmailAddress\': editableUser.emailAddress === null}" class="form-label">{{editableUser.name}}</label></div></div></div> <button class="rightSideButton" localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedAdminstrators()"></button></section></div></div>'),e.put("views/gatewaySettingsView.html",'<div class="formContainer"><header ng-switch="viewModel.isLoadingStatus"><div ng-switch-when="false" ng-switch="viewModel.status"><div ng-switch-when="1"><inline-message use-error-icon trace-details="viewModel.traceDetails"><span ng-bind="viewModel.connectionError"></span></inline-message></div><div ng-switch-when="2"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsGateway_ConnectedText"></span><div class="warning" ng-if="viewModel.traceDetails.details.length > 0"><inline-message class="inlineInfo" trace-details="viewModel.traceDetails"><span ng-bind="viewModel.connectionError"></span></inline-message></div></div></div><div ng-switch-when="true"><div class="statusContainer"><spinner class="settingsLoadingSpinner"></spinner><span localize="SettingsGateway_WaitingForConnectinonText"></span></div></div><div class="warning" ng-show="viewModel.gatewayUpgradeState === \'UpgradeRequired\'"><inline-message><span localize="SettingsGateway_UpgradeRequiredText"></span><a localize="UpgradeDialogButtonText_UpgradeNow" target="onPremGatewayUpgrade" href="//go.microsoft.com/fwlink/?linkid=856106" class="upgradeLink"></a></inline-message></div><div class="warning" role="alert" ng-if="viewModel.gatewayVersionStatuses.length > 0"><inline-message class="inlineInfo"><span localize="SettingsGateway_UpgradeAvailableText"></span><ul><li ng-repeat="gateway in viewModel.gatewayVersionStatuses"><span ng-bind="gateway.gatewayName"></span><span ng-bind="gateway.gatewayStatus"></span></li></ul><span localize="SettingsGateway_UpgradeText"></span><a localize="Capacity_Metrics_Notification_Message_Link" target="onPremGatewayUpgrade" href="//go.microsoft.com/fwlink/?linkid=856106" class="upgradeLink"></a></inline-message></div><div class="warning" ng-if="viewModel.status === 2 && viewModel.dataSources.length === 0"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><a href=\'\' localize="AddDataSourceToGatewayText" ng-click="addDataSource()"></a></inline-message></div></header><form name="settingsForm" autocomplete="off"><section><label id="gatewayClusterNameLabel" for="gatewayName" class="input-field-label" localize="SettingsGatewayCluster_Name"></label> <input id="gatewayName" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.displayName ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDepartment" class="input-field-label" localize="SettingsGateways_Department"></label> <input id="gatewayDepartment" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.gatewayAnnotation.gatewayDepartment ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDescription" class="input-field-label" localize="Description"></label><textarea id="gatewayDescription" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.description" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"></textarea></section><section><label for="gatewayContactInfo" class="input-field-label" localize="SettingsGateway_ContactInformation"></label><textarea id="gatewayContactInfo" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.contactInformationString" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"></textarea></section><div ng-if="isEnterpriseGatewayType()"><div class="gatewayConfigContainer"> <input id="cloudRefreshCheckbox" type="checkbox" class="input-field-checkbox" ng-model="viewModel.allowCloudDatasourceRefreshThroughGateway" ng-change="updateDirtyFlag()"/><label class="form-label" localize="SettingsGateway_AllowCloudDataSourceRefreshThroughGateway" for="cloudRefreshCheckbox"></label><a target="_blank" rel="noopener noreferrer" href="https://go.microsoft.com/fwlink/?linkid=2005525" localize="LearnMore"></a></div><div class="gatewayConfigContainer" ng-if="!isCustomConnectorsDisabled(viewModel.allowCustomConnectorsThroughGateway)"> <input id="customConnectorsCheckbox" type="checkbox" class="input-field-checkbox" ng-model="viewModel.allowCustomConnectorsThroughGateway" ng-change="updateDirtyFlag()"/><label class="form-label" localize="SettingsGateway_AllowCustomConnectorsThroughGateway" for="customConnectorsCheckbox"></label><a target="_blank" rel="noopener noreferrer" href="https://go.microsoft.com/fwlink/?linkid=2003934" localize="LearnMore"></a><div class="customConnectorsUnsupportedInformation" ng-show="!hasSupportedCustomConnectorsStaticCapabilities()"><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon"></span><label class="input-field-label" localize="SettingsGateway_CustomConnectorsUnsupportedInformation"></label></div></div><div class="gatewayConfigContainer"> <input id="basicLoadBalancingCheckbox" type="checkbox" class="input-field-checkbox" ng-model="viewModel.isBasicLoadBalancingEnabled" ng-change="updateDirtyFlag()"/><label class="form-label" localize="SettingsGateway_EnableBasicLoadBalancing" for="basicLoadBalancingCheckbox"></label><a target="_blank" rel="noopener noreferrer" href="https://go.microsoft.com/fwlink/?linkid=2005428" localize="LearnMore"></a></div></div><div class="buttonsContainer"> <button class="biButton primary" localize="Apply" ng-disabled="!viewModel.isDirty" ng-click="applyChanges()"></button> <button class="biButton" localize="SettingsDataSource_SettingsDiscard" ng-disabled="!viewModel.isDirty" ng-click="discardChanges()"></button></div></form></div>'),e.put("views/gatewaysView.html",'<div class="gatewaysSliderContentView" ng-if="::gatewayDataService" ng-switch="isLoading"><div class="gatewaysLayoutTop"><div class="sliderContentHeader"><spinner [size]="\'large\'" class="settingsLoadingSpinner" ng-switch-when="true"></spinner></div></div><div class="gatewaysLayoutBody" ng-switch-when="false" ng-switch="viewModel.gateways.length > 0"><div ng-switch-when="true"> <button class="settingsAddDataSource" ng-click="tryAddDataSource()" localize="AddDataSourceText" pbi-auto-focus></button><div class="settingsGateways"><div class="settingsGatewaysLeftColumn"><div><span id="gatewayClustersSpan" localize="SettingsGatewayClusters_SettingsTitle"></span></div><div class="gatewayTree"><ul><li class="navTreeItem" ng-repeat="gateway in viewModel.gateways" ng-class="{expanded: gateway.isExpanded}"><div ng-class="{selected: gateway.isExpanded ? viewModel.currentGatewayObjectId === gateway.objectId && viewModel.currentDataSourceObjectId === null : viewModel.currentGatewayObjectId === gateway.objectId}" ng-click="onItemSelected(gateway.objectId, null)"><div class="gatewayTreeItem"> <button class="expanderContainer" ng-disabled="gateway.dataSources.length === 0" ng-click="gateway.isExpanded = !gateway.isExpanded; $event.stopPropagation();"><i ng-if="gateway.dataSources.length > 0" class="glyphicon refreshSectionExpander pbi-glyph-chevronrightmedium expandIcon"></i></button> <button class="gatewayLabel trimmedTextWithEllipsis" ng-bind="gateway.displayName"></button><div class="gatewayIconContainer" ng-switch="gateway.gatewayType"><span ng-switch-when="0|1" ng-switch-when-separator="|" class="glyphicon pbi-glyph-cloudimportexport glyph-small egwIcon"></span><span ng-switch-when="2" class="glyphicon pbi-glyph-virtualnetwork glyph-small vnetIcon"></span></div><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="gateway.status != 2"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="gateway.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></div></div><div class="expandableInnerContainer" ng-show="gateway.isExpanded"><ul><li ng-repeat="dataSource in gateway.dataSources" class="gatewayTreeItem" ng-class="{selected: viewModel.currentGatewayObjectId === gateway.objectId && viewModel.currentDataSourceObjectId === dataSource.objectId}" ng-click="onItemSelected(gateway.objectId, dataSource.objectId)"> <button class="gatewayLabel trimmedTextWithEllipsis" ng-bind="dataSource.displayName"></button><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="(dataSource.connectionError && !dataSource.connected) || dataSource.compositeErrorMessage"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="dataSource.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></li></ul></div></li></ul></div><div class="testConnectionContainer"> <button class="biButton" localize="SettingsGateway_TestConnections" ng-click="testConnections()"></button></div></div><div class="settingsGatewaysRightColumn"><div ng-switch on="getSelectionType()"><gateway ng-switch-when="1" view-model="viewModel.currentGateway"></gateway><datasource ng-switch-when="2" view-model="viewModel.currentDataSource"></datasource></div></div></div></div><div class="gatewaysEmpty unselectable" ng-switch-when="false"><i class="glyphicon pbi-glyph-warning glyph-med warningIcon"></i><h2 localize="Gateways_NoGatewaysWarningTitle"></h2><p localize="Gateways_NoGatewaysWarningText"></p><a href="https://go.microsoft.com/fwlink/?LinkId=627094" localize-tooltip="Gateways_LearnMore_Title" target="_blank" localize="LearnMore" pbi-auto-focus></a></div></div></div>'),e.put("views/gatewayView.html",'<div class="settingsContainer"><div class="tabHeader"><ul><li ng-class="{selected: viewModel.tabSelectionType === 1}"> <button id="gatewayClusterSettingsTitleSpan" class="tabHeaderButton" ng-click="onTabSelected(1)" localize="SettingsGatewayCluster_SettingsTitle"></button></li><li ng-class="{selected: viewModel.tabSelectionType === 2}"> <button class="tabHeaderButton" ng-click="onTabSelected(2)" localize="GatewayDataSource_SettingsAdministrators"></button></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><gateway-settings ng-switch-when="1" view-model="viewModel"></gateway-settings><gateway-administrators ng-switch-when="2" gateway-model="viewModel"></gateway-administrators></div></div>')}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).GatewaySettings=function(){this.restrict="E",this.templateUrl="views/gatewaySettingsView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewaySettingsController)}})(powerbi=powerbi||{}),(function(e){(e=(e=e.gateways||(e.gateways={})).constants||(e.constants={})).switchToUserTabEventName="gatewaySettingsSwitchToUserTab",e.dataSourceCreatedEventName="gatewaySettingsDataSourceCreated",e.onDirtyGatewaySelectionChanging="gatewayOnDirtyGatewaySelectionChanging",e.onGatewaySelectionChanged="gatewayOnGatewaySelectionChanged",e.discardAddingDataSourceEventName="gatewaySettingsDiscardAddingDataSource",e.addDataSourceEventName="gatewayAddDataSource",e.gatewaySelectionDiscardedEventName="gatewaySettingsGatewaySelectionDiscarded",e.selectGatewayStatusReadyEventName="gatewaySettingsSelectGatewayStatusReady",e.DataSourceTypePrefix="SettingsDataSourceType_",e.AuthenticationMethodPrefix="SettingsAuthenticationMethod_",e.LabelPrefix="SettingsLabel_",e.ServerError_ModelHasNoPowerBIDMMoniker="ModelHasNoPowerBIDMMoniker",e.ExtensionDataSourceKind="ExtensionDataSourceKind",e.extensionDataSourcePath="extensionDataSourcePath",e.database="database",e.server="server",e.warehouse="warehouse",e.dataSourceInformation="dataSourceInformation",e.PublishDatasourceToClusterErrorCode="DMTS_PublishDatasourceToClusterErrorCode",e.UpdateClusterDatasourceCredentialsErrorCode="DMTS_UpdateClusterDatasourceCredentialsErrorCode",e.UnsupportedConnectionStringErrorCode="DMTS_UnsupportedConnectionStringError",e.UnsupportedDatasourceKindErrorCode="DMTS_UnsupportedDatasourceKindErrorCode",e.GatewayMissingCustomConnectorErrorCode="DMTS_GatewayMissingCustomConnectorErrorCode",e.CreateMonikerDatasourceErrorCode="DMTS_CreateMonikerDatasourceErrorCode",e.GatewayUnreachableErrorCode="DM_GWPipeline_Client_GatewayUnreachable",e.mashupExtensionKindAllowListLowerCase=["impala","netezza","snowflake","spark"],e.PBIXContentProviderId=7,e.DynamicDataSourcesIsNotSupportedForRefreshErrorCode="DynamicDataSourcesIsNotSupportedForRefresh",e.DataSourcesV3serverErrorCodes=["DynamicDataSourcesIsNotSupportedForRefresh","DatasourceAnalysisFailedDueToGatewayUnreachableError","DatasourceAnalysisFailedDueToInvalidFormat","DatasourceAnalysisFailedDueToMissingExtension","DatasourceAnalysisFailedDueToUnknownError","DatasourceAnalysisFailedWithUnknownFunctions","DatasourceAnalysisFailedWithUnknownNativeQueries","DatasourceAnalysisFailedWithUnsupportedGatewayError","DatasourceAnalysisFailedWithUnknownOrUnsupportedDataSources"]})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).models||(e.models={})).DataSourceSettingsModel=function(){}})(powerbi=powerbi||{}),(function(e){var t,a;t=(t=e.gateways||(e.gateways={})).models||(t.models={}),a=e.common.models.EmailsListModel,t.DataSourceUserModel=function(){this.pendingUsers=new a,this.editableUsers=[],this.isAdding=!1,this.isReloadingList=!1}})(powerbi=powerbi||{}),(function(a){var S,e,y,h,s,o,n,r;function i(t,e,a){var i=f(t.allowableOptions),n=b(t.allowableOptions);return{displayName:t.gatewayName,objectId:t.gatewayObjectId,id:t.gatewayId,isLoadingDataSources:!1,isLoadingStatus:!1,status:M(t.gatewayStatus),dataSources:e?l(_.filter(e,(function(e){return e.gatewayObjectId===t.gatewayObjectId}))):[],isExpanded:!1,description:t.gatewayDescription,enableAutoUpdate:!1,joinImprovmentProgram:!1,administrators:null,tabSelectionType:1,publicKey:t.gatewayPublicKey,isWaitingForGatewayUpdate:!1,isDirty:!1,contactInformationString:null,connectionError:null,originalValues:null,traceDetails:null,contextMenuItem:null,gatewayAnnotation:g(t.gatewayAnnotation),staticCapabilities:null,allowCloudDatasourceRefreshThroughGateway:i,allowCustomConnectorsThroughGateway:n,allowableOptions:t.allowableOptions,gatewayVersionStatuses:[{gatewayName:t.gatewayName,gatewayStatus:t.versionStatus}],expiryDate:t.expiryDate,gatewayType:t.gatewayType,isDisabled:!a&&t.gatewayType===o.VirtualNetwork,permission:t.permission}}function c(e,t){var a=p(e),i=w(e),n=null!==i&&1===i.selector,o=f(e.allowableOptions),r=b(e.allowableOptions),t=(function(e,t){for(var a="",i=[],n=0,o=e.gateways;n<o.length;n++){var r=o[n];null!==r.gatewayVersionStatus&&""!==r.gatewayVersionStatus&&"Latest"!==r.gatewayVersionStatus&&(a="SupportedUntilDate"===r.gatewayVersionStatus?t.format("SettingsGateways_VersionStatus_SupportedUntilDate",[(function(e,t){void 0===t&&(t=1);if(_.isEmpty(e)&&0!==t)return null;return new Date(new Date(e).getTime()+864e5*t).toDateString()})(r.expiryDate,1).toString()]):t.get("SettingsGateways_VersionStatus_"+r.gatewayVersionStatus),i.push({gatewayName:r.gatewayName,gatewayStatus:a}))}return i})(e,t);return{displayName:e.name,id:e.gatewayId,objectId:e.objectId,isLoadingDataSources:!1,isLoadingStatus:!1,status:M(s.Installed),dataSources:[],isExpanded:!1,description:e.description,enableAutoUpdate:!1,joinImprovmentProgram:!1,administrators:null,tabSelectionType:1,publicKey:e.publicKey,isWaitingForGatewayUpdate:!1,isDirty:!1,contactInformationString:null,connectionError:null,originalValues:null,traceDetails:null,contextMenuItem:null,gatewayAnnotation:a,staticCapabilities:null,allowCloudDatasourceRefreshThroughGateway:o,allowCustomConnectorsThroughGateway:r,loadBalancingClusterSettings:i,isBasicLoadBalancingEnabled:n,gateways:e.gateways,allowableOptions:e.allowableOptions,gatewayVersionStatuses:t,expiryDate:e.expiryDate,gatewayType:e.type}}function l(e){return _.map(e,t)}function t(e){var t={id:e.dataSourceId,objectId:e.dataSourceObjectId,displayName:e.dataSourceName,onPremGatewayRequired:e.onPremGatewayRequired,dataSourceType:e.dataSourceType,connectionInfo:{connectionDetails:e.connectionDetails,credentialDetails:e.credentialDetails},users:null,tabSelectionType:1,singleSignOnType:e.singleSignOnType,key:e.key};return t.dataSourceAnnotation=d(e.dataSourceAnnotation),t}function d(e){var t={dataSourceAnnotationUPNMapping:{connectionStringPropertyName:a.common.contracts.gateway.ConnectionStringPropertyName.EffectiveUserName,mappingRules:[]}};if(!e)return t;try{return JSON.parse(e)}catch(e){return t}}function u(e,t){for(var a=[],i=0,n=e;i<n.length;i++){var o,r,s,c=n[i],l=c.dataSourceType===h.Extension?c.extensionDataSourceKind:h[c.dataSourceType];null!=l&&null!=(o=D(S.constants.DataSourceTypePrefix,l,t))&&(r=_.map(c.dataSourceCredentialTypes,(function(e){return{id:e,name:D(S.constants.AuthenticationMethodPrefix,y[e],t)}})),s=_.map(c.dataSourceLabels,(function(e){return{name:e.name,displayName:D(S.constants.LabelPrefix,e.name,t),type:C(e.name),isRequired:!0}})),a.push({dataSourceKind:l,name:o,dataSourceType:c.dataSourceType,extensionDataSourceKind:c.extensionDataSourceKind,labels:s,nestedParameters:null,credentialTypeOptions:r,isEncryptedConnectionSupported:c.isEncryptedConnectionSupported}))}return a}function v(e,t,a){for(var i=[],n=0;n<e.length;n++)i.push({name:t&&t[n]||e[n],caption:a&&a[n]||e[n],value:e[n]});return i}function p(e){return g(e.annotation)}function g(e){if(e)try{return JSON.parse(e)}catch(e){}return null}function w(e){return m(e.loadBalancingSettings)}function m(e){if(e)try{return JSON.parse(e)}catch(e){}return null}function f(e){return T(e,1)}function b(e){return T(e,2)}function M(e){return e===s.Live?a.connectivity.models.GatewayStatus.Live:a.connectivity.models.GatewayStatus.NotReachable}function D(e,t,a){t=0<t.length?t.charAt(0).toUpperCase()+t.slice(1):"";return a.getOptional("SettingsDataSource_"+e+t)||t}function C(e){switch(e.toLocaleLowerCase()){case"url":case"nullable url":case"sharepointsiteurl":return"url";case"number":case"nullable number":return"number";case"record":case"nullable record":return"record";default:return"text"}}function T(e,t){return(e&t)===t}S=a.gateways||(a.gateways={}),e=S.models||(S.models={}),y=a.common.contracts.gateway.CredentialType,h=a.common.contracts.gateway.DataSourceType,s=a.common.contracts.gateway.GatewayStatus,o=a.common.contracts.gateway.GatewayType,n=a.common.contracts.gateway.SingleSignOnType,r=a.common.models.TestConnectionState,(e=e.GatewayModelConverter||(e.GatewayModelConverter={})).convertSettingsGateways=function(e,t,a){return _.map(e,(function(e){return i(e,t,a)}))},e.convertGateway=i,e.convertSettingsClusters=function(e,t){return _.map(e,(function(e){return c(e,t)}))},e.convertClusters=c,e.convertDataSources=l,e.convertDataSource=t,e.convertToOAuthDatasourceModel=function(e,t,a,i){return{modelId:e.isAddingDataSource?-1:t.id,gatewayId:t.gateway.id,gatewayObjectId:t.gateway.objectId,datasourceId:e.isAddingDataSource?-1:t.id,name:a,oAuth2URL:i.OAuthEndpoint,oAuth2Nonce:i.OAuthNonce,datasourceType:h.Extension,credentialTypes:[y.OAuth2],credentialTypesNames:["OAuth2"],connectionStringGeneralProperties:null,alreadyExecutedTestConnection:!1,testConnectionState:r.Failed,testConnectionErrorMessage:null,onpremGatewayRequired:!0,isCloudDirectQuery:!1,packageId:null,contentProviderId:null,packageContentProviderId:null,fullName:a,displayName:a,useEGW:!0,singleSignOnType:n.None}},e.convertDataSourceAnnotation=d,e.convertUsers=function(e,t){return[{accessRight:t,principalList:e}]},e.convertToPrincipalAccessEntry=function(e,t){return[{accessRight:t,principalList:e}]},e.convertSupportedDataSourcesToDataSourceMetadataMap=function(e,t){var a={},i=u(e.builtInDataSourceTypes,t),e=null==(e=e.mashupExtensionsMetadata)?[]:(function(e,t){for(var a=[],i=0,n=e;i<n.length;i++){var o=n[i],r=o.moduleName,s=o.dataSourceKind,c=o.version,l=_.map(o.authenticationInfo,(function(e){e=e.credentialType;return{id:e,name:D(S.constants.AuthenticationMethodPrefix,y[e],t)}})),d=(o.functions.length,"extension has more than one function for module: ".concat(r,". Multiple functions are not supported"),o.functions[0]),u=d.documentation["Documentation.Name"],p=(function n(e){return _.reduce(e,(function(e,t){var a=t.parameterType.toLocaleLowerCase(),i="nullable ";switch("record"===(a=_.startsWith(a,i)?a.slice(i.length):a)&&(t.recordParameters=n(t.recordParameters),0<t.recordParameters.length)&&e.push(t),a){case"url":case"text":case"number":case"sharepointsiteurl":e.push(t)}return e}),[])})(d.parameters),g=(function a(e){return _.reduce(e,(function(e,t){return null!=t.recordParameters?e.push.apply(e,a(t.recordParameters)):t.allowedValues?e.push({name:t.name,displayName:t.fieldCaption||_.upperFirst(t.name),type:C(t.parameterType),options:v(t.allowedValues,t.enumNames,t.enumCaptions),isRequired:t.isRequired,isSelectableList:!0}):e.push({name:t.name,displayName:t.fieldCaption||_.upperFirst(t.name),type:C(t.parameterType),isRequired:t.isRequired}),e}),[])})(p),c={functionName:d.name,moduleName:r,moduleVersion:c};a.push({dataSourceKind:s,name:null===u?_.upperFirst(r):u,dataSourceType:h.Extension,labels:g,nestedParameters:p,credentialTypeOptions:l,mashupExtensionsFunctionDetails:c,extensionDataSourceKind:s,isEncryptedConnectionSupported:o.isEncryptedConnectionSupported,isDirectQuerySupported:d.publish.SupportsDirectQuery})}return a})(e,t);i.push.apply(i,e||[]);for(var n=0,o=_.sortBy(i,(function(e){return e.name}));n<o.length;n++){var r=o[n];a[r.dataSourceKind]=r}return a},e.convertBuiltInDatasourcesMetadata=u,e.convertGatewayDetailsAndStatusToDetails=function(e){var t;return{gatewayId:e.gatewayId,gatewayObjectId:e.gatewayObjectId,gatewayName:e.gatewayName,gatewayDescription:e.gatewayDescription,gatewayPublicKey:e.gatewayPublicKey,gatewayStatus:null==(t=e.gatewayStatusJson)?void 0:t.gatewayStatus,gatewayAnnotation:e.gatewayAnnotation,gatewayType:e.gatewayType,allowableOptions:e.allowableOptions}},e.getDataSourceKind=function(e){return e.dataSourceType===h.Extension?JSON.parse(e.connectionInfo.connectionDetails).extensionDataSourceKind:h[e.dataSourceType]},e.getGatewayAnnotation=function(e){return g(e.gatewayAnnotation)},e.getGatewayAnnotationFromClusterDetails=p,e.getGatewayAnnotationFromString=g,e.getLoadBalancingClusterSettingsFromClusterDetails=w,e.getLoadBalancingClusterSettingsFromString=m,e.isAllowCloudDatasourceRefreshThroughGateway=f,e.isAllowCustomConnectorsThroughGateway=b,e.getLocalizedString=D,e.getLabelType=C})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).models||(e.models={})).SelectGatewayModel=function(e,t,a,i){this.modelId=e,this.selectedGatewayObjectId=void 0,this.title=null,this.showStatus=!0,this.showHeader=t,this.showVNetWarning=!1,this.allowPersonalGateway=a,this.egwStatusLoaded=!1,this.isCloudScheduleRefresh=i,this.cachedDatasourceStatusResponse=[]}})(powerbi=powerbi||{}),(function(e){((e=(e=e.gateways||(e.gateways={})).utils||(e.utils={})).GatewaysUtils||(e.GatewaysUtils={})).getNameFromPrincipalEntry=function(e,t){return e.displayName&&0<e.displayName.length?e.displayName:e.givenName&&0<e.givenName.length?t.format("Capacity_User_DisplayName",[e.givenName,e.familyName||""]):e.emailAddress}})(powerbi=powerbi||{}),(function(e){var i;function t(e,t){var a=this;this.scope=e,this.scope.onTabSelected=function(e){return a.onTabSelected(e)},this.scope.$on(i.constants.switchToUserTabEventName,(function(e){return a.switchToUserTabListener(e)}))}i=e.gateways||(e.gateways={}),e=i.controllers||(i.controllers={}),t.prototype.switchToUserTabListener=function(e){e.stopPropagation(),this.onTabSelected(2)},t.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},e.DataSourceController=t})(powerbi=powerbi||{}),(function(a){var i,e,t,o;function n(e,t){var a=this;this.scope=e,this.services=t,this.dataSourceModel=e.dataSourceModel,this.viewModel=this.scope.viewModel=new i.models.DataSourceUserModel,this.scope.tryAddUsers=function(){return a.tryAddUsers()},this.scope.tryRemoveSelectedUsers=function(){return a.tryRemoveSelectedUsers()},this.scope.shouldDisableRemoveButton=function(){return a.shouldDisableRemoveButton()},this.scope.mapUserNames=function(){return a.mapUserNames()},this.getDataSourceUsers(),this.setupUpnMappingButton(),this.startWatchDataSourceModel(),this.scope.dataSourceModel.isDirty=function(){return!1}}i=a.gateways||(a.gateways={}),e=i.controllers||(i.controllers={}),t=a.common.contracts.gateway.DataSourceType,o=a.gateways.utils.GatewaysUtils,n.createOptions=function(){return{additionalServices:["errorService","localizationService","taskPaneSliderService","telemetryService","lazyProviderModern"]}},n.prototype.$onInit=function(){return __awaiter(this,void 0,a.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),[2]}}))}))},n.prototype.ensureGatewaysMetadataServiceLoaded=function(){return __awaiter(this,void 0,a.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.startWatchDataSourceModel=function(){var a=this;this.scope.$watch("dataSourceModel",(function(e,t){t!==e&&(a.dataSourceModel=a.scope.dataSourceModel,a.getDataSourceUsers(),a.setupUpnMappingButton())}))},n.prototype.setupUpnMappingButton=function(){this.scope.upnMappingEnabled=this.dataSourceModel&&this.dataSourceModel.dataSourceType===t.AnalysisServices},n.prototype.tryAddUsers=function(){var t=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),0<this.viewModel.pendingUsers.validEmailsList.length?this.gatewaysMetadataService.addDataSourcePrincipals(this.dataSourceModel.gateway.objectId,this.dataSourceModel.objectId,i.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,1)).then((function(){t.viewModel.isAdding=!1,t.viewModel.pendingUsers.inputUserList=[],t.getDataSourceUsers()}),(function(e){t.viewModel.isAdding=!1,t.services.errorService.error(t.services.localizationService.get(a.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddDataSourceUser_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},n.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_.uniq(this.arrayStringsToLowerCase(this.viewModel.pendingUsers.validEmailsList));var e=this.arrayStringsToLowerCase(_.map(this.viewModel.editableUsers,(function(e){return e.emailAddress||""})));this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},n.prototype.arrayStringsToLowerCase=function(e){return _.map(e,(function(e){return e.toLowerCase()}))},n.prototype.tryRemoveSelectedUsers=function(){var t=this,e=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),e=_.map(e,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.gatewaysMetadataService.deleteDataSourcePrincipals(this.dataSourceModel.gateway.objectId,this.dataSourceModel.objectId,i.models.GatewayModelConverter.convertToPrincipalAccessEntry(e,0)).then((function(){t.getDataSourceUsers()}),(function(e){t.viewModel.isReloadingList=!1,t.services.errorService.error(t.services.localizationService.get(a.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddDataSourceUser_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},n.prototype.getDataSourceUsers=function(){return __awaiter(this,void 0,a.Promise,(function(){var n=this;return __generator(this,(function(e){switch(e.label){case 0:return this.viewModel.isReloadingList=!0,[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),this.gatewaysMetadataService.getDataSourcePrincipals(this.dataSourceModel.gateway.objectId,this.dataSourceModel.objectId).then((function(e){for(var a=[],t=0,i=e;t<i.length;t++)!(function(t){var e;1!==t.accessRight&&9!==t.accessRight||(e=_.map(t.principalList,(function(e){return{objectId:e.objectId,name:o.getNameFromPrincipalEntry(e,n.services.localizationService),emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1,accessRight:t.accessRight}})),a=a.concat(e))})(i[t]);n.viewModel.editableUsers=_.sortBy(a,(function(e){return e.name.toLowerCase()})),n.viewModel.isReloadingList=!1}),(function(e){var t=e.error&&e.error.code||"UnknownError";n.services.errorService.error(n.services.localizationService.get(a.ServiceErrorHelper.serverErrorPrefix+t),"GetDataSourceUsers_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()}),n.viewModel.isReloadingList=!1})),[2]}}))}))},n.prototype.shouldDisableRemoveButton=function(){return _.every(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},n.prototype.mapUserNames=function(){this.services.telemetryService.logEvent(a.telemetry.SettingsOpenGatewayDatasourceUPNMappingPane),this.services.taskPaneSliderService.expandPane(8,3)},e.DataSourceUsersController=n})(powerbi=powerbi||{}),(function(a){var i,e,n;function t(e,t){var a=this;this.scope=e,this.services=t,this.gatewayModel=e.gatewayModel,this.viewModel=this.scope.viewModel=new i.models.DataSourceUserModel,this.scope.tryAddAdministrators=function(){return a.tryAddAdministrators()},this.scope.tryRemoveSelectedAdminstrators=function(){return a.tryRemoveSelectedAdministrators()},this.scope.shouldDisableRemoveButton=function(){return a.shouldDisableRemoveButton()},this.getGatewayAdministrators(),this.startWatchGatewayModel()}i=a.gateways||(a.gateways={}),e=i.controllers||(i.controllers={}),n=a.gateways.utils.GatewaysUtils,t.createOptions=function(){return{additionalServices:["errorService","localizationService","lazyProviderModern"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,a.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),[2]}}))}))},t.prototype.ensureGatewaysMetadataServiceLoaded=function(){return __awaiter(this,void 0,a.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.startWatchGatewayModel=function(){var a=this;this.scope.$watch("gatewayModel",(function(e,t){t!==e&&(a.gatewayModel=a.scope.gatewayModel,a.getGatewayAdministrators())}))},t.prototype.tryAddAdministrators=function(){var t=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),0<this.viewModel.pendingUsers.validEmailsList.length?this.gatewaysMetadataService.addGatewayPrincipals(this.gatewayModel.objectId,i.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,3)).then((function(){t.viewModel.isAdding=!1,t.viewModel.pendingUsers.inputUserList=[],t.getGatewayAdministrators()}),(function(e){t.viewModel.isAdding=!1,t.services.errorService.error(t.services.localizationService.get(a.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddGatewayAdmin_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},t.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_(this.viewModel.pendingUsers.validEmailsList).map((function(e){return e?e.toLowerCase():null})).uniq().value();var e=_(this.viewModel.editableUsers).map((function(e){return e.emailAddress})).map((function(e){return e?e.toLowerCase():null})).value();this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},t.prototype.tryRemoveSelectedAdministrators=function(){var t=this,e=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),e=_.map(e,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.gatewaysMetadataService.deleteGatewayPrincipals(this.gatewayModel.objectId,i.models.GatewayModelConverter.convertToPrincipalAccessEntry(e,0)).then((function(){t.getGatewayAdministrators()}),(function(e){t.viewModel.isReloadingList=!1,t.services.errorService.error(t.services.localizationService.get(a.ServiceErrorHelper.serverErrorPrefix+e.error.code),"AddGatewayAdmin_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},t.prototype.getGatewayAdministrators=function(){return __awaiter(this,void 0,a.Promise,(function(){var t=this;return __generator(this,(function(e){switch(e.label){case 0:return[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),this.viewModel.isReloadingList=!0,this.gatewaysMetadataService.getGatewayPrincipals(this.gatewayModel.objectId).then((function(e){e=_.filter(e,(function(e){return 3&e.accessRight})),e=_.flatten(_.map(e,(function(e){return e.principalList})));t.viewModel.editableUsers=_.map(e,(function(e){return{objectId:e.objectId,name:n.getNameFromPrincipalEntry(e,t.services.localizationService),emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1,accessRight:3}})),t.viewModel.isReloadingList=!1}),(function(e){t.services.errorService.error(t.services.localizationService.get(a.ServiceErrorHelper.serverErrorPrefix+e.error.code),"GetGatewaysAdmins_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()}),t.viewModel.isReloadingList=!1})),[2]}}))}))},t.prototype.shouldDisableRemoveButton=function(){return _.every(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},e.GatewayAdministratorsController=t})(powerbi=powerbi||{}),(function(e){function t(e,t){var a=this;this.scope=e,this.scope.onTabSelected=function(e){return a.onTabSelected(e)}}e=(e=e.gateways||(e.gateways={})).controllers||(e.controllers={}),t.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},e.GatewayController=t})(powerbi=powerbi||{}),(function(p){var o,e,n,i,r,g,s,S;function t(e,t){var a=this;this.scope=e,this.services=t,this.scope.onItemSelected=function(e,t){return a.onItemSelected(e,t)},this.scope.getSelectionType=function(){return a.getSelectionType()},this.scope.tryAddDataSource=function(){return a.tryAddDataSource(a.scope.viewModel.currentGateway)},this.scope.testConnections=function(){return a.testConnections()},this.scope.isLoading=!1}o=p.gateways||(p.gateways={}),e=o.controllers||(o.controllers={}),n=p.common.constants,i=p.connectivity.models.DataSourceContextMenuItemModel,r=p.connectivity.models.GatewayContextMenuItemModel,g=p.connectivity.models.GatewayStatus,s=p.common.contracts.gateway.SingleSignOnType,S=window,t.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","lazy","localizationService","navigation","promiseFactory","datasourceService","downgradedRouterUtilities","lazyProviderModern"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,p.Promise,(function(){var a=this;return __generator(this,(function(e){switch(e.label){case 0:return[4,this.loadGatewayClusters()];case 1:return e.sent(),this.scope.$on(o.constants.dataSourceCreatedEventName,(function(e,t){return a.updateCurrentDataSource(e,t[0])})),this.scope.$on(o.constants.discardAddingDataSourceEventName,(function(e){return a.discardAddingDataSource(e)})),this.scope.$on(o.constants.addDataSourceEventName,(function(){return a.tryAddDataSource(a.scope.viewModel.currentGateway)})),this.ensureGatewayDataServiceInitialized(),[2]}}))}))},t.prototype.ensureGatewaysMetadataServiceLoaded=function(){return __awaiter(this,void 0,p.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.updateCurrentDataSource=function(e,t){e.stopPropagation(),this.scope.viewModel.currentDataSourceObjectId=t,this.backNavigation?this.services.navigation.navigateToDatasetSettings(this.backNavigation.settingsGroup,this.backNavigation.settingsId):this.loadDataSourceContextMenu(this.scope.viewModel.currentDataSource)},t.prototype.discardAddingDataSource=function(e){e.stopPropagation(),this.scope.viewModel.currentGateway.dataSources.pop(),this.backNavigation?this.services.navigation.navigateToDatasetSettings(this.backNavigation.settingsGroup,this.backNavigation.settingsId):this.openItem(this.scope.viewModel.currentGatewayObjectId,null)},t.prototype.gatewayExists=function(t){var e=_.find(this.scope.viewModel.gateways,(function(e){return e.objectId===t}));return null!=e},t.prototype.dataSourceExists=function(e,t){e=_.find(e.dataSources,(function(e){return e.objectId===t}));return null!=e},t.prototype.getGatewaysRouteParams=function(){var e=this.services.downgradedRouterUtilities.getCurrentActivatedRouteSnapshotLeaf();return{gatewayObjectId:e.paramMap.get(o.services.gatewayObjectIdParamName),dataSourceObjectId:e.paramMap.get(o.services.dataSourceObjectIdParamName)}},t.prototype.tryInitializeGatewaySelection=function(){var e,t;0<this.scope.viewModel.gateways.length&&(e=(t=this.getGatewaysRouteParams()).dataSourceObjectId,null!==(t=t.gatewayObjectId)&&this.gatewayExists(t)?e||this.onItemSelected(t,null):(t=this.scope.viewModel.gateways[0].objectId,this.onItemSelected(t,null)))},t.prototype.tryInitializeDataSourceSelection=function(e){var t=this.getGatewaysRouteParams(),a=t.dataSourceObjectId,t=t.gatewayObjectId;e.objectId===t&&a&&(a===n.EmptyGuid?(this.onItemSelected(t,null),this.tryAddDataSource(e)):this.dataSourceExists(e,a)?this.onItemSelected(t,a):this.onItemSelected(t,null))},t.prototype.loadGatewaysState=function(){for(var e=0,t=this.scope.viewModel.gateways;e<t.length;e++){var a=t[e];this.loadGatewayContextMenu(a),null===this.scope.viewModel.gatewayClusters?this.loadGatewayStatus(a):this.loadClusterStatus(a),this.loadDataSources(a)}},t.prototype.loadGatewayContextMenu=function(e){var t=this,a=new r(e);a.actions=[],a.actions.push({text:this.services.localizationService.get("AddDataSourceText"),action:function(){t.tryAddDataSource(e)}}),a.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){t.tryDeleteGateway(e)}}),a.metadata=[],a.metadata.push({type:p.common.models.ContextMenuItemMetadataType.Status,status:p.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),e.contextMenuItem=a},t.prototype.tryDeleteGateway=function(e){var t=this,a=this.services.errorService.control(),i=this.services.localizationService.get("SettingsGateway_DeleteWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),i=[new InJs.ModalDialogAction(i,function(){a.hideDialog(),t.deleteGateway(e)}),new InJs.ModalDialogAction(n,function(){a.hideDialog()})],o=this.services.localizationService.get("SettingsGateway_DeleteWarning_Title"),r=this.services.localizationService.get("SettingsGateway_DeleteWarning_Message");a.showCustomDialog(o,$("<div></div>").text(r),i,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0)},t.prototype.deleteGateway=function(t){var a=this;t&&this.gatewaysMetadataService.deleteGateway(t.objectId).then((function(){var e=a.scope.viewModel.gateways.indexOf(t);-1<e&&(a.scope.viewModel.gateways.splice(e,1),0<a.scope.viewModel.gateways.length?a.onItemSelected(a.scope.viewModel.gateways[0].objectId,null):a.onItemSelected(null,null))}),(function(e){a.services.errorService.error(a.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+e.error.code),"Gateways_Error_FailedToDelete",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},t.prototype.getCurrentGateway=function(){return this.scope.viewModel.currentGateway},t.prototype.getCurrentDataSource=function(){return this.scope.viewModel.currentDataSource},t.prototype.loadGatewayStatus=function(c){return __awaiter(this,void 0,p.Promise,(function(){var t,a,i,n,o,r,s;return __generator(this,(function(e){switch(e.label){case 0:c.isLoadingStatus=!0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.gatewaysMetadataService.getGatewayStatus(c.objectId)];case 2:return t=e.sent(),c.status=g.Live,c.staticCapabilities=t.gatewayStaticCapabilities,c.isLoadingStatus=!1,c.gatewayVersion=t.gatewayVersion,c.gatewayUpgradeState=t.gatewayUpgradeState,c.contextMenuItem&&((i=c.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Success,i.value=this.services.localizationService.get("SettingsGateway_OnlineMessage")),[3,4];case 3:if(e.sent(),c.isLoadingStatus=!1,c.status=g.NotReachable,a=p.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(t.error,this.services.localizationService),c.connectionError=this.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+t.error.code),c.contextMenuItem&&((i=c.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Error,i.value=this.services.localizationService.get("SettingsGateway_NotConnectedMessage")),n=[],a&&a.displayableErrorInfo)for(o=0,r=a.displayableErrorInfo;o<r.length;o++)s=r[o],n.push({key:s.errorInfoKey,value:s.errorInfoValue});return c.traceDetails={requestId:t.requestId,activityId:t.activityId,clusterUri:S.clusterUri,errorCode:t.status.toString(),error:t.error.code,details:n,time:(new Date).toString(),version:p.getBuild(),clientVersion:p.getClientVersion(),linkText:this.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"},[3,4];case 4:return[2]}}))}))},t.prototype.loadClusterStatus=function(u){return __awaiter(this,void 0,p.Promise,(function(){var t,a,i,n,o,r,s,c,l,d;return __generator(this,(function(e){switch(e.label){case 0:this.ensureGatewaysMetadataServiceLoaded(),u.isLoadingStatus=!0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.gatewaysMetadataService.getGatewayClusterStatus(u.objectId)];case 2:if(t=e.sent(),u.isLoadingStatus=!1,u.staticCapabilities=t.data.gatewayStaticCapabilities,u.gatewayVersion=t.data.gatewayVersion,u.gatewayUpgradeState=t.data.gatewayUpgradeState,1===t.data.clusterStatus?(u.status=g.Live,u.contextMenuItem&&((r=u.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Success,r.value=this.services.localizationService.get("SettingsGateway_OnlineMessage"))):(u.status=g.NotReachable,u.contextMenuItem&&((r=u.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Error,r.value=this.services.localizationService.get("SettingsGateway_NotConnectedMessage"))),a=t.data.gatewayNameToErrorResponseDictionary,0<Object.keys(a).length){for(i in u.connectionError=u.status===g.Live?this.services.localizationService.get("ServerError_DMTS_NotAllGatewaySucceeded"):this.services.localizationService.get("ServerError_DMTS_NoneGatewaySucceeded"),s=[],a)n=a[i],(o=p.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(n.error,this.services.localizationService))&&o.displayableErrorInfo&&o.message&&s.push({key:i,value:o.message});u.traceDetails={requestId:t.requestId,activityId:t.activityId,clusterUri:S.clusterUri,errorCode:"",details:s,time:(new Date).toString(),version:p.getBuild(),clientVersion:p.getClientVersion()}}return[3,4];case 3:if(e.sent(),u.isLoadingStatus=!1,u.status=g.NotReachable,o=p.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(t.error,this.services.localizationService),u.connectionError=this.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+t.error.code),u.contextMenuItem&&((r=u.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Error,r.value=this.services.localizationService.get("SettingsGateway_NotConnectedMessage")),s=[],o&&o.displayableErrorInfo)for(c=0,l=o.displayableErrorInfo;c<l.length;c++)d=l[c],s.push({key:d.errorInfoKey,value:d.errorInfoValue});return u.traceDetails={requestId:t.requestId,activityId:t.activityId,clusterUri:S.clusterUri,errorCode:t.status.toString(),error:t.error.code,details:s,time:(new Date).toString(),version:p.getBuild(),clientVersion:p.getClientVersion(),linkText:this.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"},[3,4];case 4:return[2]}}))}))},t.prototype.loadDataSources=function(t){var a=this;t.isLoadingDataSources=!0,this.gatewaysMetadataService.getDataSources(t.objectId).then((function(e){t.dataSources=o.models.GatewayModelConverter.convertDataSources(e),t.isLoadingDataSources=!1,a.tryInitializeDataSourceSelection(t),a.loadDataSourcesState(t)}),(function(e){a.services.errorService.error(a.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+e.error.code),"SettingsDataSources_Error_FailedToLoad",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})}))},t.prototype.loadDataSourcesState=function(t){for(var e=0,a=t.dataSources;e<a.length;e++){var i=a[e];i.gateway=t,(i.gatewayCluster=null)!==this.scope.viewModel.gatewayClusters&&(i.gatewayCluster=_.find(this.scope.viewModel.gatewayClusters,(function(e){return t.objectId===e.objectId}))),this.loadDataSourceContextMenu(i),this.loadDataSourceStatus(t,i)}},t.prototype.loadDataSourceContextMenu=function(e){var t=this,a=new i(e);a.actions=[],a.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){t.tryDeleteDataSource(e)}}),a.metadata=[],a.metadata.push({type:p.common.models.ContextMenuItemMetadataType.Status,status:p.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),e.contextMenuItem=a},t.prototype.tryDeleteDataSource=function(e){var t=this,a=this.services.errorService.control(),i=this.services.localizationService.get("SettingsDataSource_DeleteWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),i=[new InJs.ModalDialogAction(i,function(){a.hideDialog(),t.deleteDataSource(e)}),new InJs.ModalDialogAction(n,function(){a.hideDialog()})],o=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Title"),r=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Message");a.showCustomDialog(o,$("<div></div>").text(r),i,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0)},t.prototype.deleteDataSource=function(t){var e,a=this,i=t.gateway;i&&t&&(t.objectId===n.EmptyGuid?-1<(e=i.dataSources.indexOf(t))&&(i.dataSources.splice(e,1),this.openItem(i.objectId,null)):this.gatewaysMetadataService.deleteDataSource(i.objectId,t.objectId).then((function(){var e=i.dataSources.indexOf(t);-1<e&&(i.dataSources.splice(e,1),a.onItemSelected(i.objectId,null))}),(function(e){a.services.errorService.error(a.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+e.error.code),"DataSources_Error_FailedToDelete",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})})))},t.prototype.loadDataSourceStatus=function(e,s){var c=this;if(s.objectId!==n.EmptyGuid)return null!==s.gatewayCluster?this.loadClusterDataSourceStatus(e,s):void this.gatewaysMetadataService.getDataSourceStatus(e.objectId,s.objectId).then((function(){var e;s.connected=!0,s.connectionError=null,s.contextMenuItem&&((e=s.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Success,e.value=c.services.localizationService.get("SettingsGateway_OnlineMessage"))}),(function(e){s.connected=!1,s.gateway.isExpanded=!0;var t,a=p.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,c.services.localizationService),i=(s.connectionError=c.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+e.error.code),s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage")),[]);if(a&&a.displayableErrorInfo)for(var n=0,o=a.displayableErrorInfo;n<o.length;n++){var r=o[n];i.push({key:r.errorInfoKey,value:r.errorInfoValue})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:S.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:i,time:(new Date).toString(),version:p.getBuild(),clientVersion:p.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))},t.prototype.loadClusterDataSourceStatus=function(e,s){var c=this;this.gatewaysMetadataService.getClusterDataSourceStatus(e.objectId,s.objectId).then((function(e){var t;if(s.connectionError=null,s.connected=1===e.data.status,s.contextMenuItem&&(t=s.contextMenuItem.metadata[0],s.connected?(t.status=p.common.models.ContextMenuItemMetadataStatus.Success,t.value=c.services.localizationService.get("SettingsGateway_OnlineMessage")):(t.status=p.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage"))),!_.isEmpty(e.data.errors)){s.connectionError=s.connected?c.services.localizationService.get("ServerError_DMTS_GetClusterDataSourceStatusError"):c.services.localizationService.get("ServerError_DMTS_GetClusterDataSourceStatusNotConnectedError"),s.gateway.isExpanded=!0;for(var a=[],i=0,n=e.data.errors;i<n.length;i++){var o=n[i],r=c.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+o.errorCode);a.push({key:o.gatewayName,value:r||o.errorMessage})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:S.clusterUri,errorCode:"",details:a,time:(new Date).toString(),version:p.getBuild(),clientVersion:p.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}}),(function(e){s.connected=!1,s.gateway.isExpanded=!0;var t,a=p.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,c.services.localizationService),i=(s.connectionError=c.services.localizationService.get(p.ServiceErrorHelper.serverErrorPrefix+e.error.code),s.contextMenuItem&&((t=s.contextMenuItem.metadata[0]).status=p.common.models.ContextMenuItemMetadataStatus.Error,t.value=c.services.localizationService.get("SettingsGateway_NotConnectedMessage")),[]);if(a&&a.displayableErrorInfo)for(var n=0,o=a.displayableErrorInfo;n<o.length;n++){var r=o[n];i.push({key:r.errorInfoKey,value:r.errorInfoValue})}s.traceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:S.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:i,time:(new Date).toString(),version:p.getBuild(),clientVersion:p.getClientVersion(),linkText:c.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))},t.prototype.generateUniqueDataSourceName=function(){if(!this.scope.viewModel.currentGateway)return null;for(var e=this.services.localizationService.get("NewDataSourceName"),t=e,a=0;_.find(this.scope.viewModel.currentGateway.dataSources,(function(e){return e.displayName===t}));)t=e+" "+ ++a;return t},t.prototype.tryAddDataSource=function(e){var t=this;this.backNavigation=this.services.datasourceService.getAndResetLastUpdatedDatasource(),this.scope.viewModel.currentDataSourceObjectId!==n.EmptyGuid&&(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){t.addDataSource(e)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(o.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){t.addDataSource(e),t.scope.$apply()})):this.addDataSource(e))},t.prototype.addDataSource=function(t){var e={objectId:n.EmptyGuid,displayName:this.generateUniqueDataSourceName(),dataSourceType:void 0,gateway:t,connectionInfo:{},users:null,tabSelectionType:1,gatewayCluster:null,singleSignOnType:s.None},a=this.services.datasourceService.getAndResetConnectionInfo(),i=this.services.datasourceService.getAndResetDataSourceType();a&&null!=i&&(e.connectionInfo=a,e.dataSourceType=i),null!==this.scope.viewModel.gatewayClusters&&(e.gatewayCluster=_.find(this.scope.viewModel.gatewayClusters,(function(e){return t.objectId===e.objectId}))),t.dataSources.push(e),this.loadDataSourceContextMenu(e),this.openItem(t.objectId,e.objectId)},t.prototype.onItemSelected=function(e,t){var a=this;e===this.scope.viewModel.currentGatewayObjectId&&t===this.scope.viewModel.currentDataSourceObjectId||(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){a.scope.viewModel.currentDataSourceObjectId===n.EmptyGuid&&a.scope.viewModel.currentGateway.dataSources.pop(),a.openItem(e,t)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(o.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){a.openItem(e,t),a.scope.$apply()})):(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSourceObjectId===n.EmptyGuid&&this.scope.viewModel.currentGateway.dataSources.pop(),this.openItem(e,t)))},t.prototype.openItem=function(i,n){return __awaiter(this,void 0,p.Promise,(function(){var t,a=this;return __generator(this,(function(e){switch(e.label){case 0:return(t=this.scope.viewModel).currentGatewayObjectId=i,t.currentDataSourceObjectId=n,t.currentGateway=this.getCurrentGatewayModel(),t.currentDataSource=this.getCurrentDataSourceModel(),[4,this.ensureGatewayDataServiceInitialized()];case 1:return e.sent(),this.scope.gatewayDataService.setSelectedGatewayDataSource(this.getCurrentDataSourceModel()),n?this.scope.viewModel.currentGateway.isExpanded=!0:requestAnimationFrame((function(){return a.scope.$broadcast(o.constants.onGatewaySelectionChanged)})),this.services.navigation&&this.services.navigation.navigateToGatewayItem(i,n),[2]}}))}))},t.prototype.ensureGatewayDataServiceInitialized=function(){return __awaiter(this,void 0,p.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.scope.gatewayDataService?[3,2]:(t=this.scope,[4,this.services.lazy("gatewayDataService")]);case 1:t.gatewayDataService=e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.getSelectionType=function(){return this.scope.viewModel.currentGatewayObjectId?this.scope.viewModel.currentDataSourceObjectId?p.connectivity.models.GatewaysSelectionType.DataSource:p.connectivity.models.GatewaysSelectionType.Gateway:p.connectivity.models.GatewaysSelectionType.None},t.prototype.getCurrentGatewayModel=function(){var t=this;return _.find(this.scope.viewModel.gateways,(function(e){return e.objectId===t.scope.viewModel.currentGatewayObjectId}))},t.prototype.getCurrentDataSourceModel=function(){var t=this.scope.viewModel.currentDataSourceObjectId;if(t){var e=this.getCurrentGatewayModel();if(e)return _.find(e.dataSources,(function(e){return e.objectId===t}))}return null},t.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService.control(),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),i=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),a=[new InJs.ModalDialogAction(a,function(){t.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(i,function(){t.hideDialog(),e.reject()})],n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return t.showCustomDialog(n,$("<div></div>").text(o),a,(function(e){e.parent().find('input[value="'+i+'"]').focus()}),!0,!0),e.promise},t.prototype.testConnections=function(){return __awaiter(this,void 0,p.Promise,(function(){var t,a,i,n,o,r;return __generator(this,(function(e){switch(e.label){case 0:if(!this.scope.viewModel.gateways)return[2];t=0,a=this.scope.viewModel.gateways,e.label=1;case 1:return t<a.length?(i=a[t],null!==this.scope.viewModel.gatewayClusters?[3,2]:(this.loadGatewayStatus(i),[3,4])):[3,6];case 2:return[4,this.loadClusterStatus(i)];case 3:e.sent(),e.label=4;case 4:if(!i.dataSources)return[3,5];for(n=0,o=i.dataSources;n<o.length;n++)r=o[n],this.loadDataSourceStatus(i,r);e.label=5;case 5:return t++,[3,1];case 6:return[2]}}))}))},t.prototype.loadGatewayClusters=function(){return __awaiter(this,void 0,p.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.scope.isLoading=!0,[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.gatewaysMetadataService.getGatewayClusters()];case 3:return t=e.sent(),t=o.models.GatewayModelConverter.convertSettingsClusters(t,this.services.localizationService),this.scope.viewModel={gateways:t,currentGatewayObjectId:n.EmptyGuid,currentDataSourceObjectId:n.EmptyGuid,currentGateway:null,currentDataSource:null,gatewayClusters:t},this.scope.isLoading=!1,this.tryInitializeGatewaySelection(),this.loadGatewaysState(),[3,5];case 4:return e.sent(),this.scope.isLoading=!1,this.services.errorService.error(this.services.localizationService.get("SettingsGateways_Error_FailedToLoad"),"SettingsGateways_Error_FailedToLoad"),[3,5];case 5:return[2]}}))}))},e.GatewaysController=t})(powerbi=powerbi||{}),(function(t){var o,e,r;function a(e,t){var i=this,a=(this.scope=e,this.services=t,this.scope.updateDirtyFlag=function(){return i.updateDirtyFlag()},this.scope.applyChanges=function(){return i.applyChanges()},this.scope.discardChanges=function(){return i.discardChanges()},this.scope.addDataSource=function(){return i.addDataSource()},this.scope.hasSupportedCustomConnectorsStaticCapabilities=function(){return i.hasSupportedCustomConnectorsStaticCapabilities()},this.scope.isCustomConnectorsDisabled=function(e){return i.isCustomConnectorsDisabled(e)},this.scope.isEnterpriseGatewayType=function(){return void 0===i.scope.viewModel.gatewayType||i.scope.viewModel.gatewayType===r.Resource},this.scope.$on(o.constants.onDirtyGatewaySelectionChanging,(function(e,t,a){return i.discardOrCancel(t,a)}))),n=this.scope.$on(o.constants.onGatewaySelectionChanged,(function(){return i.initializeGateway()}));this.initializeGateway(),this.scope.$on("$destroy",(function(){a(),n()}))}o=t.gateways||(t.gateways={}),e=o.controllers||(o.controllers={}),r=t.common.contracts.gateway.GatewayType,a.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","localizationService","telemetryService","lazyProviderModern"]}},a.prototype.$onInit=function(){return __awaiter(this,void 0,t.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),[2]}}))}))},a.prototype.ensureGatewaysMetadataServiceLoaded=function(){return __awaiter(this,void 0,t.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return[2]}}))}))},a.prototype.initializeGateway=function(){var e=this.scope.viewModel;e.contactInformationString=this.getContactInformationString(e.gatewayAnnotation.gatewayContactInformation),this.initializeOriginalValues()},a.prototype.updateDirtyFlag=function(){var e=this.scope.viewModel,t=e.allowCloudDatasourceRefreshThroughGateway!==e.originalValues.allowCloudDatasourceRefreshThroughGateway||e.allowCustomConnectorsThroughGateway!==e.originalValues.allowCustomConnectorsThroughGateway;e.isDirty=e.displayName!==e.originalValues.name||e.description!==e.originalValues.description||e.gatewayAnnotation.gatewayDepartment!==e.originalValues.department||e.contactInformationString!==e.originalValues.contactInformationString||e.isBasicLoadBalancingEnabled!==e.originalValues.isBasicLoadBalancingEnabled||t,t&&this.updateAllowableOptions()},a.prototype.discardOrCancel=function(e,t){var a=this,i=this.services.errorService.control(),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),n=[new InJs.ModalDialogAction(n,function(){a.restoreOriginalValues(),a.scope.$apply(),i.hideDialog(),t&&t()}),new InJs.ModalDialogAction(o,function(){i.hideDialog()})],r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),e=this.services.localizationService.get(e);i.showCustomDialog(r,$("<div></div>").text(e),n,(function(e){e.parent().find('input[value="'+o+'"]').focus()}),!0,!0)},a.prototype.restoreOriginalValues=function(){var e=this.scope.viewModel;e.displayName=e.originalValues.name,e.description=e.originalValues.description,e.gatewayAnnotation.gatewayDepartment=e.originalValues.department,e.contactInformationString=e.originalValues.contactInformationString,e.allowCloudDatasourceRefreshThroughGateway=e.originalValues.allowCloudDatasourceRefreshThroughGateway,e.allowCustomConnectorsThroughGateway=e.originalValues.allowCustomConnectorsThroughGateway,e.allowableOptions=e.originalValues.allowableOptions,e.isBasicLoadBalancingEnabled=e.originalValues.isBasicLoadBalancingEnabled,e.isDirty=!1},a.prototype.initializeOriginalValues=function(){var e=this.scope.viewModel;e.originalValues={name:e.displayName,description:e.description,department:e.gatewayAnnotation.gatewayDepartment,contactInformationString:e.contactInformationString,allowCloudDatasourceRefreshThroughGateway:e.allowCloudDatasourceRefreshThroughGateway,allowCustomConnectorsThroughGateway:e.allowCustomConnectorsThroughGateway,isBasicLoadBalancingEnabled:e.isBasicLoadBalancingEnabled,allowableOptions:e.allowableOptions},e.isDirty=!1},a.prototype.getContactInformationString=function(e){var t="";return t=e?e.join(";"):t},a.prototype.parseContactInformation=function(e){return e.split(";")},a.prototype.applyChanges=function(){return __awaiter(this,void 0,t.Promise,(function(){var t,a,i=this;return __generator(this,(function(e){switch(e.label){case 0:return this.scope.viewModel.gatewayAnnotation.gatewayContactInformation=this.parseContactInformation(this.scope.viewModel.contactInformationString),this.scope.viewModel.isWaitingForGatewayUpdate=!0,this.scope.viewModel.allowableOptions=this.updateAllowableOptions(),t={name:this.scope.viewModel.displayName,description:this.scope.viewModel.description,annotation:JSON.stringify(this.scope.viewModel.gatewayAnnotation),allowableOptions:this.scope.viewModel.allowableOptions},this.scope.viewModel.isBasicLoadBalancingEnabled!==this.scope.viewModel.originalValues.isBasicLoadBalancingEnabled&&(a=!0===this.scope.viewModel.isBasicLoadBalancingEnabled?1:0,this.scope.viewModel.loadBalancingClusterSettings=__assign(__assign({},this.scope.viewModel.loadBalancingClusterSettings),{selector:a}),t.loadBalancingSettings=JSON.stringify(this.scope.viewModel.loadBalancingClusterSettings)),[4,(a=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:return a.gatewaysMetadataService=e.sent(),this.gatewaysMetadataService.updateGatewayCluster(this.scope.viewModel.objectId,t).then((function(){i.successCallback()}),(function(e){i.errorCallback(e)})),[2]}}))}))},a.prototype.discardChanges=function(){this.discardOrCancel("SettingsGateway_DiscardChangesWarning_GatewaySettingsMessage",null)},a.prototype.addDataSource=function(){this.scope.$emit(o.constants.addDataSourceEventName)},a.prototype.successCallback=function(){this.scope.viewModel.isWaitingForGatewayUpdate=!1,this.initializeOriginalValues()},a.prototype.errorCallback=function(e){this.scope.viewModel.isWaitingForGatewayUpdate=!1,this.services.errorService.error(this.services.localizationService.get(t.ServiceErrorHelper.serverErrorPrefix+e.error.code),"UpdateGateway_Error",{requestId:e.requestId,ecsCorrelationId:e.activityId,statusCode:e.status.toString()})},a.prototype.updateAllowableOptions=function(){var e=this.scope.viewModel,t=this.scope.viewModel.originalValues.allowableOptions;return e.allowCloudDatasourceRefreshThroughGateway?t|=1:t&=-2,e.allowCustomConnectorsThroughGateway?t|=2:t&=-3,t},a.prototype.hasSupportedCustomConnectorsStaticCapabilities=function(){return 128==(128&this.scope.viewModel.staticCapabilities)},a.prototype.isCustomConnectorsDisabled=function(e){return!1===e&&!this.hasSupportedCustomConnectorsStaticCapabilities()&&this.scope.viewModel.allowCustomConnectorsThroughGateway===this.scope.viewModel.originalValues.allowCustomConnectorsThroughGateway},e.GatewaySettingsController=a})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).Datasource=function(){this.restrict="E",this.templateUrl="views/datasourceView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.DataSourceController)}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).DatasourceUsers=function(){this.restrict="E",this.templateUrl="views/datasourceUsersView.html",this.replace=!0,this.scope={dataSourceModel:"=datasourceModel"},this.controller=e.common.createController(t.controllers.DataSourceUsersController)}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).Gateway=function(){this.restrict="E",this.templateUrl="views/gatewayView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewayController)}})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).directives||(t.directives={})).GatewayAdministrators=function(){this.restrict="E",this.templateUrl="views/gatewayAdministratorsView.html",this.replace=!0,this.scope={gatewayModel:"= gatewayModel"},this.controller=e.common.createController(t.controllers.GatewayAdministratorsController)}})(powerbi=powerbi||{}),(function(t){var a;((a=t.gateways||(t.gateways={})).directives||(a.directives={})).Gateways=function(e){this.featureSwitchService=e,this.restrict="E",this.templateUrl="views/gatewaysView.html",this.replace=!0,this.controller=t.common.createController(a.controllers.GatewaysController)}})(powerbi=powerbi||{}),(function(e){((e=e.gateways||(e.gateways={})).directives||(e.directives={})).IgnoreDirty=function(){this.restrict="A",this.require="ngModel",this.link=function(e,t,a,i){i.$setPristine=function(){},i.$pristine=!1}}})(powerbi=powerbi||{}),(function(c){var l,e,t,d,r,n,o,u,p,g,a,S;function y(e,t){this.scope=e,this.services=t,this.viewModel=new l.models.DataSourceSettingsModel,this.viewModel.isLoadingForm=!0,this.viewModel.advancedSettingsExpanded=!1,this.enterpriseGatewayETLEnabled=this.services.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled,this.kerberosSSOForDQAndRefreshEnabled=this.services.featureSwitchService.featureSwitches.kerberosDqRefresh,this.scope.authDialogParameters=new c.common.models.AuthDialogModel}l=c.gateways||(c.gateways={}),e=l.controllers||(l.controllers={}),t=jsCommon.BrowserUtils,d=c.common.constants,r=c.common.contracts.gateway.CredentialType,n=c.common.contracts.gateway.DataSourceType,o=c.common.EncryptionContext,u=l.models.GatewayModelConverter,p=c.common.contracts.gateway.PrivacyLevel,g=c.common.contracts.gateway.SingleSignOnType,a=c.common.contracts.gateway.GatewayType,S=window,y.createOptions=function(){return{additionalServices:["credentialParameterService","errorService","featureSwitchService","lazy","localizationService","promiseFactory","lazyProviderModern","globalEventBridge"]}},y.prototype.$onInit=function(){return __awaiter(this,void 0,c.Promise,(function(){var t,a=this;return __generator(this,(function(e){switch(e.label){case 0:return[4,this.initEntropy()];case 1:return e.sent(),this.initializePlaceholder(),this.startWatchFormControl(),t=this.services.globalEventBridge.createChannelSubscriptionManager().subscribe(c.common.constants.datasetShowAuthDialogEvent,(function(e,t){a.showAuthDialog(t)})),this.scope.$on(c.common.constants.scopeDestroyEventName,(function(){t&&t.unsubscribeAll()})),[2]}}))}))},y.prototype.$onChanges=function(){return __awaiter(this,void 0,c.Promise,(function(){var t,a=this;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return this.initViewModelOptions().then((function(){a.loadViewModelData(),a.datasourceModel.isDirty=function(){return a.scope.settingsForm.$dirty}})),[2]}}))}))},y.prototype.initEntropy=function(){return __awaiter(this,void 0,c.Promise,(function(){var t,n=this;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return this.gatewaysMetadataService.getEntropy().then((function(e){if(n.entropy=[],e)for(var t=atob(e),a=t.length,i=0;i<a;i++)n.entropy.push(t.charCodeAt(i));else n.entropy=o.generateEntropy()}),(function(){})),[2]}}))}))},y.prototype.initializePlaceholder=function(){y.Placeholder||(t.isChrome()?y.Placeholder="••••••••••••":y.Placeholder="●●●●●●●●●●●●")},y.prototype.initViewModelOptions=function(){return __awaiter(this,void 0,c.Promise,(function(){var t,a=this;return __generator(this,(function(e){return t=this.services.promiseFactory.defer(),this.gatewaysMetadataService.supportedDataSources(this.datasourceModel.gateway.objectId,this.services.localizationService.currentLanguageLocale).then((function(e){a.viewModel.dataSourceMetadataMap=u.convertSupportedDataSourcesToDataSourceMetadataMap(e,a.services.localizationService)}),(function(){})).finally((function(){t.resolve(null)})),[2,t.promise]}))}))},y.prototype.getPrepopulateDatasourceDefaultAuthType=function(e){if(void 0!==e&&void 0!==this.viewModel.dataSourceMetadataMap[e]){e=this.viewModel.dataSourceMetadataMap[e].credentialTypeOptions;if(!_.isEmpty(e))return e[0].id}},y.prototype.loadViewModelData=function(){var e=this.datasourceModel,t=this.viewModel,a=t.isAddingDataSource=e.objectId===d.EmptyGuid,i=u.getDataSourceKind(e),n=a?this.getPrepopulateDatasourceDefaultAuthType(i):e.connectionInfo.credentialDetails.credentialType,o=this.services.credentialParameterService.create(i,n);if(this.scope.authDialogParameters.credentialData=void 0,t.singleSignOnType=e.singleSignOnType,this.isSingleSignOnKerberosEnabled=t.singleSignOnType===g.Kerberos,this.isSingleSignOnSAMLEnabled=t.singleSignOnType===g.SAML,this.isSingleSignOnKerberosForDQAndRefreshEnabled=t.singleSignOnType===g.KerberosDQAndRefresh,this.isSingleSignOnAADEnabled=t.singleSignOnType===g.AzureActiveDirectory,!a)for(var r=0,s=o;r<s.length;r++){var c=s[r];"select"===c.type?c.value=null:c.value=y.Placeholder,!this.isSingleSignOnKerberosForDQAndRefreshEnabled||"username"!==c.name&&"password"!==c.name||(c.disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled",c.required="!ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled",c.value=null)}var l=this.createDataSourceConnectionParameters(i,a);t.editableSettings={dataSourceKind:i,dataSourceName:e.displayName,dataSourceType:e.dataSourceType,requiredDataSourceConnectionParameters:l.filter((function(e){return!0===e.isRequired})),optionalDataSourceConnectionParameters:l.filter((function(e){return!1===e.isRequired})),encryptedConnection:this.getEncryptedConnection(a,i),encryptedConnectionEdited:!1,credentialType:n,credentialTypeEdited:!1,credentialParameters:o,privacyLevel:a?p.Organizational:e.connectionInfo.credentialDetails.privacyLevel,singleSignOnType:e.singleSignOnType,privacyLevelEdited:!1,skipTestConnection:!a&&e.connectionInfo.credentialDetails.skipTestConnection},t.waitingForDataSourceStatus=!1,t.hasTestConnectionFailure=!1,t.isLoadingForm=!1,t.messageState=0,e.compositeErrorMessage="",this.scope.settingsForm&&(a?this.scope.settingsForm.$setDirty():this.scope.settingsForm.$setPristine()),this.isSkipTestConnectionSelected=t.editableSettings.skipTestConnection,this.privacyLevelString=this.viewModel.editableSettings.privacyLevel&&this.viewModel.editableSettings.privacyLevel.toString(),this.encryptedConnectionString=null!=this.viewModel.editableSettings.encryptedConnection&&this.viewModel.editableSettings.encryptedConnection.toString(),this.isAutoDetectEncryptedConnectionVisible=!a&&this.showEncryptedConnection()&&1===this.datasourceModel.connectionInfo.credentialDetails.encryptedConnection,this.isAutoDetectEncryptedConnectionEnabled=this.isAutoDetectEncryptedConnectionVisible,this.isNonImportSSOCheckboxDisabled=!this.viewModel.isAddingDataSource&&this.isSingleSignOnKerberosForDQAndRefreshEnabled},y.prototype.startWatchFormControl=function(){var t=this,a=this.scope.$watch("settingsForm",(function(e){e&&(t.datasourceModel.isDirty=function(){return e.$dirty},t.viewModel.isAddingDataSource&&t.scope.settingsForm.$setDirty(),a())}))},y.prototype.tryApplyChanges=function(e){var t,a,i,n,o=this;this.isFormValid(e)&&(t=(e=this.datasourceModel).gateway,a=this.viewModel.editableSettings.dataSourceName!==e.displayName,i=this.viewModel.singleSignOnType!==e.singleSignOnType&&this.allowSingleSignOn(),(a||i)&&(n={dataSourceName:a?this.viewModel.editableSettings.dataSourceName:null,dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:null,supportedAuthenticationTypes:null,singleSignOnType:i?this.viewModel.singleSignOnType:null},this.gatewaysMetadataService.updateDataSource(t.objectId,e.objectId,n).then((function(){a&&(o.datasourceModel.displayName=o.viewModel.editableSettings.dataSourceName),i&&(o.datasourceModel.singleSignOnType=o.viewModel.singleSignOnType),o.isEditableSettingsChanged()||o.loadViewModelData()}),(function(e){o.showDataSourceError(e)}))),this.isEditableSettingsChanged())&&(null===this.datasourceModel.gatewayCluster?this.updateCredentials():this.updateClusterCredentials())},y.prototype.tryAddDataSource=function(e){this.isFormValid(e)&&(null===this.datasourceModel.gatewayCluster?this.addDataSourceToGateway():this.addDataSourceToCluster())},y.prototype.tryDiscardChanges=function(){var e=this;this.showDiscardPopup().then((function(){e.viewModel.isAddingDataSource?e.scope.$emit(l.constants.discardAddingDataSourceEventName):e.loadViewModelData()}))},y.prototype.onDataSourceTypeChange=function(){var e=this.viewModel.editableSettings,t=this.getDefaultCredentialType(),a=e.dataSourceKind,i=this.viewModel.dataSourceMetadataMap[a];e.dataSourceType=i.dataSourceType,e.credentialType=t,this.scope.authDialogParameters.credentialData=void 0,this.skipTestConnectionOldValue=!1,this.isSkipTestConnectionSelected=!1,this.UncheckCurrentSingleSignOnOption(),e.credentialParameters=this.services.credentialParameterService.create(a,t);for(var n=0,o=e.credentialParameters;n<o.length;n++)o[n].edited=!1;e.encryptedConnection=this.getEncryptedConnection(this.viewModel.isAddingDataSource,a),this.encryptedConnectionString=null!=e.encryptedConnection&&e.encryptedConnection.toString();t=this.createDataSourceConnectionParameters(i.dataSourceKind,!0);e.requiredDataSourceConnectionParameters=t.filter((function(e){return!0===e.isRequired})),e.optionalDataSourceConnectionParameters=t.filter((function(e){return!1===e.isRequired}))},y.prototype.onPrivacyLevelChange=function(){var e=parseInt(this.privacyLevelString,10);_.isNumber(e),this.viewModel.editableSettings.privacyLevel=e,this.viewModel.editableSettings.privacyLevelEdited=!0},y.prototype.onEncryptedConnectionChange=function(){var e=parseInt(this.encryptedConnectionString,10);_.isNumber(e),this.viewModel.editableSettings.encryptedConnection=e,this.viewModel.editableSettings.encryptedConnectionEdited=!0},y.prototype.onAutoDetectEncryptedConnectionChange=function(){this.isAutoDetectEncryptedConnectionEnabled?this.encryptedConnectionString=1..toString():this.encryptedConnectionString=0..toString(),this.onEncryptedConnectionChange()},y.prototype.onSkipTestConnectionChange=function(){this.viewModel.editableSettings.skipTestConnection=this.isSkipTestConnectionSelected},y.prototype.UncheckCurrentSingleSignOnOption=function(){switch(this.viewModel.singleSignOnType){case g.KerberosDQAndRefresh:this.isSkipTestConnectionSelected=this.skipTestConnectionOldValue,this.isSingleSignOnKerberosForDQAndRefreshEnabled=!1;break;case g.Kerberos:this.isSingleSignOnKerberosEnabled=!1;break;case g.SAML:this.isSingleSignOnSAMLEnabled=!1;break;case g.AzureActiveDirectory:this.isSingleSignOnAADEnabled=!1}this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnKerberosChange=function(){this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnKerberosEnabled?this.viewModel.singleSignOnType=g.Kerberos:this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnKerberosForDQAndRefreshChange=function(){if(this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnKerberosForDQAndRefreshEnabled){this.skipTestConnectionOldValue=this.isSkipTestConnectionSelected,this.isSkipTestConnectionSelected=!0,this.viewModel.editableSettings.skipTestConnection=!0,this.viewModel.singleSignOnType=g.KerberosDQAndRefresh,this.viewModel.editableSettings.credentialType!==r.Windows&&(this.viewModel.editableSettings.credentialType=r.Windows,this.onCredentialMethodChange());for(var e=0,t=this.viewModel.editableSettings.credentialParameters;e<t.length;e++){var a=t[e];"username"!==a.name&&"password"!==a.name||(a.value=null)}}else this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnSAMLChange=function(){this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnSAMLEnabled?this.viewModel.singleSignOnType=g.SAML:this.viewModel.singleSignOnType=g.None},y.prototype.onSingleSignOnAADChange=function(){this.UncheckCurrentSingleSignOnOption(),this.isSingleSignOnAADEnabled?this.viewModel.singleSignOnType=g.AzureActiveDirectory:this.viewModel.singleSignOnType=g.None},y.prototype.onCredentialMethodChange=function(){var e=this.viewModel.editableSettings,t=e.credentialType,a=e.dataSourceKind;e.credentialType=t,e.credentialTypeEdited=!0,e.credentialParameters=this.services.credentialParameterService.create(a,t);for(var i=0,n=e.credentialParameters;i<n.length;i++){var o=n[i];o.edited=!0,this.showKerberosSSOForDQAndRefresh&&this.allowSingleSignOn&&("username"!==o.name&&"password"!==o.name||(o.disabled="ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled",o.required="!ctrl.isSingleSignOnKerberosForDQAndRefreshEnabled"))}},y.prototype.onCredentialParameterChange=function(e){for(var t=this.viewModel.editableSettings.credentialParameters,a=0;a<t.length;a++){var i=t[a];a===e?i.edited=!0:i.edited||(void 0!==i.defaultValue?i.value=i.defaultValue:i.value="",i.edited=!0)}},y.prototype.onCredentialParameterFocus=function(e){e=this.viewModel.editableSettings.credentialParameters[e];this.viewModel.isAddingDataSource||e.edited||(e.value="")},y.prototype.onCredentialParameterBlur=function(e){e=this.viewModel.editableSettings.credentialParameters[e];this.viewModel.isAddingDataSource||e.edited||(e.value=y.Placeholder)},y.prototype.switchToUserTab=function(){this.scope.$emit(l.constants.switchToUserTabEventName)},y.prototype.showSAPBWSncLibWarningMessage=function(){var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];if(e&&(e.dataSourceType===n.SAPBW||e.dataSourceType===n.SAPBWMessageServer))for(var t=0,a=this.viewModel.editableSettings.credentialParameters;t<a.length;t++){var i=a[t];if("SNCLibrarySelect"===i.name&&"default"===i.value)return!0}return!1},y.prototype.isOnPremSingleSignOnSupportedForDataSourceType=function(e,t){switch(e){case n.SqlServer:case n.Oracle:case n.SAP:case n.SAPBW:case n.SAPBWMessageServer:case n.Teradata:return!0;case n.Extension:switch(t){case"Impala":case"Spark":case"DenodoForPowerBI":case"ApacheHive":case"TibcoTdv":return!0;default:return!1}default:return!1}},y.prototype.isUpdateDataSourceDisabled=function(){return this.viewModel.waitingForDataSourceStatus||!(this.scope.settingsForm.$dirty||this.viewModel.editableSettings.credentialType===r.OAuth2&&void 0!==this.scope.authDialogParameters.credentialData)},y.prototype.isAddDataSourceDisabled=function(){return this.viewModel.waitingForDataSourceStatus||this.viewModel.editableSettings.credentialType===r.OAuth2&&void 0===this.scope.authDialogParameters.credentialData},y.prototype.showEncryptedConnection=function(){var e;return!!(this.viewModel.dataSourceMetadataMap&&this.viewModel.editableSettings.dataSourceKind&&(e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind])&&e.isEncryptedConnectionSupported)},y.prototype.hasOptionalParameters=function(){var e;return!(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind||(e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind],!_.find(e.labels,(function(e){return!e.isRequired}))))},y.prototype.disableEncryptedConnection=function(){return this.viewModel.waitingForDataSourceStatus||this.isAutoDetectEncryptedConnectionEnabled},y.prototype.allowSingleSignOn=function(){return!(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)&&(this.isSingleSignOnAADSupported()||this.allowOnPremSingleSignOn())},y.prototype.allowOnPremSingleSignOn=function(){var e;return!(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)&&(e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind],(this.datasourceModel.gateway.gatewayType||a.Resource)===a.Resource)&&null!=this.datasourceModel.gateway.staticCapabilities&&32==(32&this.datasourceModel.gateway.staticCapabilities)&&this.isOnPremSingleSignOnSupportedForDataSourceType(e.dataSourceType,e.extensionDataSourceKind)},y.prototype.isSingleSignOnAADSupported=function(){if(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind)return!1;if((this.datasourceModel.gateway.gatewayType||a.Resource)===a.Resource&&!this.services.featureSwitchService.featureSwitches.aADSSOForGatewayEnabled)return!1;var e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind];switch(e.dataSourceType){case n.SqlServer:return!0;case n.Extension:return e.isDirectQuerySupported&&!!_.find(e.credentialTypeOptions,(function(e){return e.id===r.OAuth2}));default:return!1}},y.prototype.isSingleSignOnSAMLAllowed=function(){var e;return!(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind||!(e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind])||e.dataSourceType!==n.SAP)},y.prototype.isSkipTestConnectionAllowed=function(){var e;return!(!this.viewModel.dataSourceMetadataMap||!this.viewModel.editableSettings.dataSourceKind||!(e=this.viewModel.dataSourceMetadataMap[this.viewModel.editableSettings.dataSourceKind])||e.dataSourceType===n.AnalysisServices||4096!=(4096&this.datasourceModel.gateway.staticCapabilities))},y.prototype.showSSOTestConnection=function(){var e=!this.viewModel.isAddingDataSource,t=this.services.featureSwitchService.featureSwitches.singleSignOnTestConnection,a=this.allowOnPremSingleSignOn(),i=this.isSingleSignOnKerberosEnabled||this.isSingleSignOnSAMLEnabled||this.isSingleSignOnKerberosForDQAndRefreshEnabled;return t&&e&&a&&i},y.prototype.showKerberosSSOForDQAndRefresh=function(){return this.kerberosSSOForDQAndRefreshEnabled},y.prototype.isDataSourceTestConnectionSuccessful=function(){return this.datasourceModel.gateway.gatewayType!==a.VirtualNetwork&&!this.viewModel.hasTestConnectionFailure&&this.datasourceModel.connected},y.prototype.oauthEditCredentialButton=function(e){var t=this;this.isFormValid(e)&&(e=this.viewModel.editableSettings.dataSourceKind,this.viewModel.isAddingDataSource?(e={datasourceType:this.viewModel.editableSettings.dataSourceType,connectionDetails:this.getConnectionDetailsString(e),mashupTestConnectionDetails:this.createMashupTestConnectionDetails(e)},this.gatewaysMetadataService.initiateOAuthLoginOnGatewayCluster(this.datasourceModel.gateway.objectId,e).then((function(e){t.prepareAndShowOAuthDialog(e)}),(function(e){t.showDataSourceError(e),t.viewModel.hasTestConnectionFailure=!0}))):this.gatewaysMetadataService.getDataSourceOAuthDetailsForGatewayCluster(this.datasourceModel.gateway.objectId,this.datasourceModel.objectId).then((function(e){t.prepareAndShowOAuthDialog(e)}),(function(e){t.showDataSourceError(e),t.viewModel.hasTestConnectionFailure=!0})))},y.prototype.prepareAndShowOAuthDialog=function(e){this.scope.authDialogParameters.datasource=this.createDataSourceForAuthDialog(e),this.showAuthDialog({dsIndex:0})},y.prototype.showAuthDialog=function(e){var t=this.scope.authDialogParameters;t.showAuthDialog=!0,t.isImportScenario=!1,t.showError=!1,t.selectedAuthenticationIndex=0,t.providerId=l.constants.PBIXContentProviderId,t.dialogTitle=this.viewModel.editableSettings.dataSourceKind,t.showAuthDialog=!0,t.showModalDialog=!0,t.validateParameters=e.validateParameters||!1,t.allowSingleSignOn=!1,t.isManageGatewaysScenario=!0},y.prototype.createDataSourceForAuthDialog=function(e){var t=this.viewModel.editableSettings.dataSourceKind;return u.convertToOAuthDatasourceModel(this.viewModel,this.datasourceModel,t,e)},y.prototype.createDataSourceConnectionParameters=function(e,t){var a;return t||this.datasourceModel.dataSourceType!==n.Extension&&!this.isExtensionDataSourceType(e)||this.isMashupExtensionAllowListed(e)?(t=this.viewModel.dataSourceMetadataMap[e])?(a=this.getParsedConnectionDetails(e)||{},e=t.labels,_.map(e,(function(e){var t=e.name;return{name:t,displayName:e.displayName,type:e.type,value:a[t]||a[t.toLowerCase()]||"",options:e.options||[],isSelectableList:e.isSelectableList,isRequired:e.isRequired}}))):[]:this.createDataSourceInformationLabel()},y.prototype.createDataSourceInformationLabel=function(){var e=jsCommon.JsonExtensions.tryParseJSON(this.datasourceModel.connectionInfo.connectionDetails);return e?[{name:l.constants.dataSourceInformation,displayName:u.getLocalizedString(l.constants.LabelPrefix,_.upperFirst(l.constants.dataSourceInformation),this.services.localizationService),type:"text",isRequired:!0,value:e[l.constants.extensionDataSourcePath]||""}]:null},y.prototype.isFormValid=function(e){return!(!e||(e=this.viewModel.editableSettings.dataSourceName!==this.datasourceModel.displayName,(this.viewModel.isAddingDataSource||e)&&!this.isDataSourceNameUnique(this.viewModel.editableSettings.dataSourceName,this.datasourceModel)&&(this.datasourceModel.errorTitle="",this.datasourceModel.compositeErrorMessage=this.services.localizationService.get("SettingsDatasources_DuplicateDataSourceName"),this.viewModel.messageState=2)))},y.prototype.isDataSourceNameUnique=function(t,a){return!_.find(this.datasourceModel.gateway.dataSources,(function(e){return e.displayName===t&&e!==a}))},y.prototype.isEditableSettingsChanged=function(){var e=this.viewModel.editableSettings,t=this.viewModel.editableSettings.credentialParameters;return!!e.credentialTypeEdited||!(!e.privacyLevelEdited&&!e.encryptedConnectionEdited&&!t.some((function(e){return e.edited}))&&_.isEmpty(this.scope.authDialogParameters.credentialData)&&this.viewModel.editableSettings.skipTestConnection===this.datasourceModel.connectionInfo.credentialDetails.skipTestConnection)},y.prototype.isExtensionDataSourceType=function(e){e=this.viewModel.dataSourceMetadataMap[e];return e&&e.dataSourceType===n.Extension},y.prototype.isMashupExtensionAllowListed=function(e){return this.isExtensionDataSourceType(e)&&_.includes(l.constants.mashupExtensionKindAllowListLowerCase,e.toLowerCase())},y.prototype.getParsedConnectionDetails=function(e){var t,a,i=this.datasourceModel.connectionInfo.connectionDetails;return i?(i=jsCommon.JsonExtensions.tryParseJSON(i),this.isMashupExtensionAllowListed(e)&&((t=i[l.constants.extensionDataSourcePath].split(";")).length,"".concat(l.constants.extensionDataSourcePath," had ").concat(t.length," but expected at most 2"),i[l.constants.server]=t[0],a=this.viewModel.dataSourceMetadataMap[e].mashupExtensionsFunctionDetails,2===t.length&&("Snowflake"===_.upperFirst(e)&&a?i[l.constants.warehouse]=t[1]:i[l.constants.database]=t[1]),delete i[l.constants.extensionDataSourcePath]),i):null},y.prototype.isMashupExtensionsMetadata=function(e){return this.isExtensionDataSourceType(e)&&void 0!==this.viewModel.dataSourceMetadataMap[e].mashupExtensionsFunctionDetails&&null!=this.viewModel.dataSourceMetadataMap[e].mashupExtensionsFunctionDetails},y.prototype.createMashupTestConnectionDetails=function(e){var t;return this.isMashupExtensionsMetadata(e)?(e=this.viewModel.dataSourceMetadataMap[e],(t=_.assign({},e.mashupExtensionsFunctionDetails)).parameters=this.createParameterValues(e.nestedParameters),t):null},y.prototype.createParameterValues=function(e){var a=this;return null===e?null:_.map(e,(function(e){var t=u.getLabelType(e.parameterType);return"record"===t?{name:e.name,isRequired:e.isRequired,type:t,value:null,recordParameters:a.createParameterValues(e.recordParameters)}:(t=a.getDataSourceConnectionParameter(e.name),{name:e.name,isRequired:e.isRequired,type:t.type,value:t.value})}))},y.prototype.getEncryptedConnection=function(e,t){return null!=this.viewModel.dataSourceMetadataMap&&null!=t&&(t=this.viewModel.dataSourceMetadataMap[t])&&t.isEncryptedConnectionSupported?e?0:this.datasourceModel.connectionInfo.credentialDetails.encryptedConnection:1},y.prototype.getConnectionDetailsString=function(e){for(var t,a={},i=0,n=this.viewModel.dataSourceMetadataMap[e].labels;i<n.length;i++){var o=n[i];a[o.name]=this.getDataSourceConnectionParameter(o.name).value}return this.isExtensionDataSourceType(e)&&this.isMashupExtensionAllowListed(e)&&(a[l.constants.ExtensionDataSourceKind]=e,t=a[l.constants.server],'expected the property "'.concat(l.constants.server,'" to be in connectionDetails'),t.length,'expected the property "'.concat(l.constants.server,'" to be a non-empty string'),"Spark"===e&&((e=_.startsWith(t.toLowerCase(),"standard/"))&&"s"===t[0]?a[l.constants.server]=t.replace("s","S"):e||_.startsWith(t.toLowerCase(),"http")||(a[l.constants.server]="Standard/".concat(t))),null!=(e=a[l.constants.database])?(e.length,'expected the property "'.concat(l.constants.database,'" to be a non-empty string'),a[l.constants.extensionDataSourcePath]="".concat(t,";").concat(a[l.constants.database]),delete a[l.constants.database]):a[l.constants.extensionDataSourcePath]=t,delete a[l.constants.server]),JSON.stringify(a)},y.prototype.getDefaultCredentialType=function(){var e=this.viewModel.editableSettings,e=this.viewModel.dataSourceMetadataMap[e.dataSourceKind].credentialTypeOptions;if(1===e.length)return e[0].id},y.prototype.getDataSourceName=function(e){var t=this.viewModel.dataSourceMetadataMap[e.dataSourceKind].labels;return 0<t.length?e[t[0].name]:""},y.prototype.getDataSourceConnectionParameter=function(t){var e=_.concat(this.viewModel.editableSettings.requiredDataSourceConnectionParameters,this.viewModel.editableSettings.optionalDataSourceConnectionParameters),e=_.find(e,(function(e){return e.name===t}));return"DataSourceConnectionParameter with the name ".concat(t," could not be found"),e},y.prototype.getGatewayErrorDetails=function(e){var t,a=[];for(t in e)if(e.hasOwnProperty(t)){var i=e[t],i=c.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(i.error,this.services.localizationService);if(i&&i.displayableErrorInfo){i.message&&a.push({key:t,value:i.message});for(var n=0,o=i.displayableErrorInfo;n<o.length;n++){var r=o[n];a.push({key:r.errorInfoKey,value:r.errorInfoValue})}}}return a},y.prototype.addDataSourceToGateway=function(){var c=this;this.services.lazy("gatewayDataService").then((function(a){var e=c.datasourceModel,i=c.viewModel.editableSettings,n=c.viewModel.dataSourceMetadataMap,o=i.dataSourceKind,r=e.gateway,e=a.getDecodedPublicKey(e.gateway.publicKey),s={credentialData:c.services.credentialParameterService.convert({credentialParameters:i.credentialParameters,credentialType:i.credentialType,dataSourceKind:i.dataSourceKind})};a.prepareCredentials(s,e,i.credentialType,c.entropy).then((function(e){c.viewModel.waitingForDataSourceStatus=!0,e.privacyLevel=i.privacyLevel,e.skipTestConnection=i.skipTestConnection,e.encryptedConnection=i.encryptedConnection;var t=n[o].dataSourceType,t={dataSourceName:i.dataSourceName,dataSourceType:t,onPremGatewayRequired:!0,connectionDetails:c.getConnectionDetailsString(o),credentialDetails:e,supportedAuthenticationTypes:null,singleSignOnType:c.viewModel.singleSignOnType};a.createDataSourceWithRetry(r,t,s,i.credentialType,c.entropy).then((function(e){c.viewModel.waitingForDataSourceStatus=!1,c.datasourceModel.id=e.dataSourceId,c.datasourceModel.objectId=e.dataSourceObjectId,c.datasourceModel.displayName=e.dataSourceName,c.datasourceModel.dataSourceType=e.dataSourceType,c.datasourceModel.connectionInfo.connectionDetails=e.connectionDetails,c.datasourceModel.connectionInfo.credentialDetails=e.credentialDetails,c.datasourceModel.dataSourceAnnotation=u.convertDataSourceAnnotation(""),c.datasourceModel.singleSignOnType=e.singleSignOnType||g.None,c.loadViewModelData(),c.datasourceModel.connected=!0,c.datasourceModel.connectionError=null,c.viewModel.messageState=1,c.scope.$emit(l.constants.dataSourceCreatedEventName,[e.dataSourceObjectId])}),(function(e){c.showDataSourceError(e),c.datasourceModel.connected=!1}))}))}))},y.prototype.addDataSourceToCluster=function(){var n=this;this.services.lazy("gatewayDataService").then((function(e){n.viewModel.waitingForDataSourceStatus=!0;var t=n.viewModel.editableSettings,a=n.viewModel.editableSettings.dataSourceKind,i=n.createMashupTestConnectionDetails(a),a={credentialData:t.credentialType===r.OAuth2?n.scope.authDialogParameters.credentialData:{credentialData:n.services.credentialParameterService.convert({credentialParameters:t.credentialParameters,credentialType:t.credentialType,dataSourceKind:t.dataSourceKind})},credentialType:t.credentialType,connectionDetails:n.getConnectionDetailsString(a),dataSourceModel:n.datasourceModel,dataSourceName:t.dataSourceName,dataSourceType:t.dataSourceType,entropy:n.entropy,singleSignOnType:n.viewModel.singleSignOnType,privacyLevel:t.privacyLevel,encryptedConnection:t.encryptedConnection,mashupTestConnectionDetails:i,skipTestConnection:t.skipTestConnection};e.createClusterDataSourceWithRetry(a).then((function(e){var t=e.data;n.viewModel.waitingForDataSourceStatus=!1,n.datasourceModel.id=t.datasourceDetails.dataSourceId,n.datasourceModel.objectId=t.datasourceDetails.dataSourceObjectId,n.datasourceModel.displayName=t.datasourceDetails.dataSourceName,n.datasourceModel.dataSourceType=t.datasourceDetails.dataSourceType,n.datasourceModel.connectionInfo.connectionDetails=t.datasourceDetails.connectionDetails,n.datasourceModel.connectionInfo.credentialDetails=t.datasourceDetails.credentialDetails,n.datasourceModel.dataSourceAnnotation=u.convertDataSourceAnnotation(""),n.datasourceModel.singleSignOnType=t.datasourceDetails.singleSignOnType||g.None,n.loadViewModelData(),n.datasourceModel.connected=!0,n.datasourceModel.connectionError=null,n.viewModel.messageState=1,n.scope.$emit(l.constants.dataSourceCreatedEventName,[t.datasourceDetails.dataSourceObjectId]),n.showGatewayError(e.requestId,e.activityId,e.data.gatewayNameToErrorResponseDictionary,"ServerError_DMTS_PublishDatasourceToClusterErrorCode")}),(function(e){n.showDataSourceError(e),n.datasourceModel.connected=!1}))}))},y.prototype.updateCredentials=function(){var s=this;this.services.lazy("gatewayDataService").then((function(t){var a=s.datasourceModel,i=s.viewModel.editableSettings,e=i.dataSourceKind,n=a.gateway,o=t.getDecodedPublicKey(s.datasourceModel.gateway.publicKey),e={credentialType:i.credentialType,credentialParameters:s.viewModel.editableSettings.credentialParameters,dataSourceKind:e},r={credentialData:s.services.credentialParameterService.convert(e)};t.prepareCredentials(r,o,i.credentialType,s.entropy).then((function(e){s.viewModel.waitingForDataSourceStatus=!0,e.privacyLevel=i.privacyLevel,e.skipTestConnection=i.skipTestConnection,e.encryptedConnection=i.encryptedConnection,t.updateCredentialsWithRetry(n,a.objectId,r,i.credentialType,e,s.entropy).then((function(){s.viewModel.waitingForDataSourceStatus=!1,s.datasourceModel.connectionInfo.credentialDetails.credentialType=s.viewModel.editableSettings.credentialType,s.datasourceModel.connectionInfo.credentialDetails.privacyLevel=s.viewModel.editableSettings.privacyLevel,s.datasourceModel.connectionInfo.credentialDetails.skipTestConnection=s.viewModel.editableSettings.skipTestConnection,s.datasourceModel.connectionInfo.credentialDetails.encryptedConnection=s.viewModel.editableSettings.encryptedConnection,s.loadViewModelData(),s.datasourceModel.connected=!0,s.datasourceModel.connectionError=null}),(function(e){s.showDataSourceError(e),s.viewModel.hasTestConnectionFailure=!0}))}))}))},y.prototype.updateClusterCredentials=function(){var o=this;this.services.lazy("gatewayDataService").then((function(e){o.viewModel.waitingForDataSourceStatus=!0;var t=o.viewModel.editableSettings,a=null,i=t.privacyLevel,n=t.encryptedConnection,a=t.credentialType===r.OAuth2?o.scope.authDialogParameters.credentialData:{credentialData:o.services.credentialParameterService.convert({credentialParameters:t.credentialParameters,credentialType:t.credentialType,dataSourceKind:t.dataSourceKind})};e.updateClusterCredentialsWithRetry(o.datasourceModel,i,n,a,t.credentialType,t.skipTestConnection,o.entropy).then((function(e){o.viewModel.waitingForDataSourceStatus=!1,o.datasourceModel.connectionInfo.credentialDetails.credentialType=t.credentialType,o.datasourceModel.connectionInfo.credentialDetails.privacyLevel=t.privacyLevel,o.datasourceModel.connectionInfo.credentialDetails.skipTestConnection=o.viewModel.editableSettings.skipTestConnection,o.datasourceModel.connectionInfo.credentialDetails.encryptedConnection=t.encryptedConnection,o.loadViewModelData(),o.datasourceModel.connected=!0,o.datasourceModel.connectionError=null,o.showGatewayError(e.requestId,e.activityId,e.data.gatewayNameToErrorResponseDictionary,"ServerError_DMTS_UpdateClusterDatasourceCredentialsErrorCode")}),(function(e){o.showDataSourceError(e),o.viewModel.hasTestConnectionFailure=!0}))}))},y.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService.control(),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),i=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),a=[new InJs.ModalDialogAction(a,function(){t.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(i,function(){t.hideDialog(),e.reject()})],n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return t.showCustomDialog(n,$("<div></div>").text(o),a,(function(e){e.parent().find('input[value="'+i+'"]').focus()}),!0,!0),e.promise},y.prototype.showGatewayError=function(e,t,a,i){0<Object.keys(a).length&&(this.datasourceModel.connectionError=this.services.localizationService.get(i),i=this.getGatewayErrorDetails(a),this.datasourceModel.traceDetails={requestId:e,activityId:t,clusterUri:S.clusterUri,errorCode:"",details:i,time:(new Date).toString(),version:c.getBuild(),clientVersion:c.getClientVersion()},this.viewModel.waitingForDataSourceStatus=!1)},y.prototype.showDataSourceError=function(e){var t=c.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,this.services.localizationService),a=c.ServiceErrorHelper.serverErrorPrefix+e.error.code,i=this.services.localizationService.get(a),n=("ServerError_DMTS_DuplicateDatasourceError"===a?(this.datasourceModel.errorTitle="",this.datasourceModel.compositeErrorMessage=i):(this.datasourceModel.errorTitle=this.services.localizationService.get("SettingsDataSource_SettingsConnectionErrorTitle"),this.datasourceModel.compositeErrorMessage=this.services.localizationService.format("SettingsDataSource_SettingsConnectionErrorMessage",[this.getDataSourceName(this.viewModel.editableSettings),i])),[]);if(t&&t.displayableErrorInfo)if(e.error.code===l.constants.PublishDatasourceToClusterErrorCode||e.error.code===l.constants.UpdateClusterDatasourceCredentialsErrorCode)0<t.displayableErrorInfo.length&&(a=t.displayableErrorInfo[0].errorInfoValue,n=this.getGatewayErrorDetails(JSON.parse(a)));else for(var o=0,r=t.displayableErrorInfo;o<r.length;o++){var s=r[o];n.push({key:s.errorInfoKey,value:s.errorInfoValue})}this.datasourceModel.compositeTraceDetails={requestId:e.requestId,activityId:e.activityId,clusterUri:S.clusterUri,errorCode:e.status.toString(),error:e.error.code,details:n,time:(new Date).toString(),version:c.getBuild(),clientVersion:c.getClientVersion(),linkText:this.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"},this.viewModel.waitingForDataSourceStatus=!1,this.viewModel.messageState=2},e.DatasourceSettingsController=y})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).DatasourceSettings={templateUrl:"components/datasourceSettings/datasourceSettingsView.html",bindings:{datasourceModel:"<"},controllerAs:"ctrl",controller:e.common.createController(t.controllers.DatasourceSettingsController)}})(powerbi=powerbi||{}),(function(o){var i,e;function t(e,t){var a=this;this.scope=e,this.services=t,this.localizedOriginalName=t.localizationService.get("UpnMappingPane_OriginalName"),this.localizedNewName=t.localizationService.get("New_Name"),this.localizedResultOfApplyingMappingRule=t.localizationService.get("UpnMappingPane_AfterRuleAppliedPlaceHolder"),this.resetNewRule(),this.services.lazy("gatewayDataService").then((function(e){var t=(a.gatewayDataService=e).getSelectedGatewayDataSource();t.dataSourceAnnotation&&t.dataSourceAnnotation.dataSourceAnnotationUPNMapping||(t.dataSourceAnnotation=i.models.GatewayModelConverter.convertDataSourceAnnotation("")),a.viewModel=_.cloneDeep(e.getSelectedGatewayDataSource().dataSourceAnnotation.dataSourceAnnotationUPNMapping)}))}i=o.gateways||(o.gateways={}),e=i.controllers||(i.controllers={}),t.createOptions=function(){return{additionalServices:["lazy","localizationService","errorService","telemetryService","notificationToast","promiseFactory","taskPaneSliderService","lazyProviderModern"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,o.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),[2]}}))}))},t.prototype.ensureGatewaysMetadataServiceLoaded=function(){return __awaiter(this,void 0,o.Promise,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.addNewRule=function(){var e=this.newRule;this.viewModel.mappingRules.push({algorithm:e.algorithm,searchString:e.searchString,replacementString:e.replacementString}),this.resetNewRule()},t.prototype.deleteRule=function(){var e;this.selectedRule&&(e=this.viewModel.mappingRules.indexOf(this.selectedRule),this.viewModel.mappingRules.splice(e,1))},t.prototype.testRule=function(){return __awaiter(this,void 0,o.Promise,(function(){var t=this;return __generator(this,(function(e){switch(e.label){case 0:return this.testRuleOriginalName?(this.isTestRuleRequestPending=!0,[4,this.ensureGatewaysMetadataServiceLoaded()]):[3,2];case 1:e.sent(),this.gatewaysMetadataService.getUPNMappingResult([this.testRuleOriginalName],this.viewModel).then((function(e){_.isEmpty(e.upns)||(e=e.upns[0],t.testRuleNewName=e.result)}),(function(){t.services.errorService.error(t.services.localizationService.get("UpnMappingPane_FailToTestUPNRuleMessage"),"FailToTestUPNRuleMessage")})).finally((function(){t.isTestRuleRequestPending=!1})),e.label=2;case 2:return[2]}}))}))},t.prototype.saveChangesAndExit=function(){return __awaiter(this,void 0,o.Promise,(function(){var t,a,i,n=this;return __generator(this,(function(e){switch(e.label){case 0:return this.isUpdateDataSourceRequestPending=!0,t=JSON.stringify({dataSourceAnnotationUPNMapping:{connectionStringPropertyName:this.viewModel.connectionStringPropertyName,mappingRules:this.viewModel.mappingRules}}),a=this.gatewayDataService.getSelectedGatewayDataSource(),i=this.services.telemetryService.startEvent(o.telemetry.SettingsUpdateGatewayDatasourceUPNMapping),[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),this.gatewaysMetadataService.updateDataSource(a.gateway.objectId,a.objectId,{dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:t,supportedAuthenticationTypes:null}).then((function(){a.dataSourceAnnotation.dataSourceAnnotationUPNMapping=_.cloneDeep(n.viewModel),n.closeUpnMappingPane(),n.services.notificationToast.notify({title:n.services.localizationService.get("UpnMappingPane_SuccessfulMessage"),notificationType:7}),i.resolve()}),(function(){n.services.errorService.error(n.services.localizationService.get("UpnMappingPane_FailToUpdateMessage"),"FailToUpdateGatewayUPNMapping"),i.reject()})).finally((function(){n.isUpdateDataSourceRequestPending=!1})),[2]}}))}))},t.prototype.closeUpnMappingPane=function(){this.services.taskPaneSliderService.collapsePane()},t.prototype.selectPre=function(){var e,t=this.viewModel.mappingRules,a=t.indexOf(this.selectedRule);1<t.length&&0<a&&(e=t[a],t[a]=t[a-1],t[a-1]=e,this.selectedRule=t[a-1])},t.prototype.selectNext=function(){var e,t=this.viewModel.mappingRules,a=t.indexOf(this.selectedRule);1<t.length&&a<t.length-1&&(e=t[a],t[a]=t[a+1],t[a+1]=e,this.selectedRule=t[a+1])},t.prototype.resetNewRule=function(){this.newRule={algorithm:o.common.contracts.gateway.DataSourceAnnotationUPNMappingAlgorithm.SubstringReplacement,searchString:"",replacementString:""}},e.UpnMappingPaneController=t})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).UpnMappingPane={templateUrl:"components/upnMappingPane/upnMappingPaneView.html",controller:e.common.createController(t.controllers.UpnMappingPaneController)}})(powerbi=powerbi||{}),(function(t){var e,o,a;function i(e,t){var a=this;this.attachDatasourceName=function(e){e&&e["pbi.error"]&&(null==(e=e["pbi.error"]).parameters&&(e.parameters=[]),_.isEmpty(e.parameters))&&(_.isArray(e.parameters)?e.parameters[0]={Key:"0",Value:a.datasourceModel.displayName}:e.parameters[0]=a.datasourceModel.displayName)},this.services=t}e=(e=t.gateways||(t.gateways={})).controllers||(e.controllers={}),(a=o=e.SSOTestConnectionStatus||(e.SSOTestConnectionStatus={})).NoResults="NoResults",a.Running="Running",a.Success="Success",a.Failed="Failed",i.prototype.$onInit=function(){return __awaiter(this,void 0,t.Promise,(function(){return __generator(this,(function(e){return this.resetComponent(),this.ssoTestConnectionExpanded=!1,[2]}))}))},i.prototype.$onChanges=function(){return __awaiter(this,void 0,t.Promise,(function(){return __generator(this,(function(e){return this.resetComponent(),this.ssoTestConnectionExpanded=!0,[2]}))}))},i.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","lazy","localizationService","lazyProviderModern"]}},i.prototype.executeSSOTestConnection=function(){return __awaiter(this,void 0,t.Promise,(function(){var t,a,i,n;return __generator(this,(function(e){switch(e.label){case 0:this.testStatus=o.Running,this.testResults=null,this.testTimestamp="",e.label=1;case 1:return(e.trys.push([1,5,,6]),this.gatewaysMetadataService)?[3,3]:[4,(t=this).services.lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 2:t.gatewaysMetadataService=e.sent(),e.label=3;case 3:return[4,this.gatewaysMetadataService.getSSOTestConnection(this.datasourceModel.gatewayCluster.objectId,this.datasourceModel.objectId,this.upn,this.singleSignOnType)];case 4:return a=e.sent(),i=a.data,this.testTimestamp=(new Date).toString(),i=_.chain(i.results).map((function(e){return e.testSuccessful})).reduce((function(e,t){return e&&t})).value(),this.testResults=a,this.testStatus=i?o.Success:o.Failed,[3,6];case 5:return a=e.sent(),i=a,this.testStatus=o.NoResults,n="WebRequestFailed",400===i.status&&i.data&&i.data.error&&"DMTS_RequestInvalidErrorCode"===i.data.error.code&&(n="InvalidEmailAddress"),this.services.errorService.error(this.services.localizationService.get(n),"Gateways_SSOTestConnection_Failure",{requestId:i.requestId,ecsCorrelationId:i.activityId,statusCode:i.status.toString()}),[3,6];case 6:return[2]}}))}))},i.prototype.setDisplayDetailedResults=function(e){this.displayDetailedResults=e},i.prototype.convertToErrorMessage=function(e){this.attachDatasourceName(e);e=t.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e,this.services.localizationService);return null!=e.message?e.message:""},i.prototype.getGatewayNameFromObjectId=function(e){return this.gatewayObjectIdToName[e]},i.prototype.gatewayUpgradeRequired=function(){var e=this.datasourceModel.gateway.staticCapabilities;return null!=e&&131072!=(131072&e)},i.prototype.disableStartTestButton=function(){return this.gatewayUpgradeRequired()||!(0<this.upn.length)||this.testStatus===o.Running},i.prototype.resetComponent=function(){this.testStatus=o.NoResults,this.upn="",this.displayDetailedResults=!1,this.dialogModel=new t.common.models.ModalDialogModel(!1,"",!0,this.services.localizationService,!1,!0),this.dialogModel.hideCancelButton=!0,this.buildGatewayObjectIdToNameDict()},i.prototype.buildGatewayObjectIdToNameDict=function(){this.gatewayObjectIdToName={};for(var e=0,t=this.datasourceModel.gatewayCluster.gateways;e<t.length;e++){var a=t[e];this.gatewayObjectIdToName[a.gatewayObjectId]=a.gatewayName}},a=i,e.SSOTestConnectionController=a})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).SSOTestConnection={templateUrl:"components/ssoTestConnection/ssoTestConnectionView.html",bindings:{datasourceModel:"<",singleSignOnType:"<"},controller:e.common.createController(t.controllers.SSOTestConnectionController)}})(powerbi=powerbi||{}),(function(e){var t,a;function i(e,t){}t=(t=e.gateways||(e.gateways={})).controllers||(t.controllers={}),a=e.common.contracts.gateway.GatewayStatus,i.createOptions=function(){return{additionalServices:["telemetryService","errorService","localizationService","featureSwitchService"]}},i.prototype.showPersonalGatewayFirstTimeInstallNow=function(){return!this.isCloudScheduleRefresh&&this.gatewayStatus===a.NotInstalled},i.prototype.showPersonalGatewayUpgradeRequired=function(){return!this.isCloudScheduleRefresh&&this.gatewayStatus!==a.NotInstalled&&"UpgradeRequired"===this.gatewayUpgradeState},t.PgwWarningBoxController=i})(powerbi=powerbi||{}),(function(e){var t;((t=e.gateways||(e.gateways={})).components||(t.components={})).PgwWarningBox={templateUrl:"components/pgwWarningBox/pgwWarningBoxView.html",bindings:{isCloudScheduleRefresh:"<",gatewayStatus:"<",gatewayUpgradeState:"<",allowPersonalGateway:"<"},controller:e.common.createController(t.controllers.PgwWarningBoxController)}})(powerbi=powerbi||{}),(function(e){var t=e.gateways||(e.gateways={}),a=e.common.contracts.gateway.CredentialType,i=(t.createCredentialParameterService=function(e,t){return new i(e,t)},n.prototype.create=function(e,t){if(null==t)return[];switch(t){case a.NotSpecified:case a.Anonymous:case a.EffectiveUserName:case a.OAuth2:case a.SingleSignOn:case a.WindowsWithoutImpersonation:return[];case a.Basic:switch(e){case"SAP":return this.createSapBasic();case"SAPBW":case"SAPBWMessageServer":return this.createSapBwBasic();case"ODBC":return this.createUsernamePassword(e,!1);default:return this.createUsernamePassword(e)}case a.Windows:switch(e){case"Spark":return this.createExtensionSparkWindows();case"SAP":return this.createSapBasic();case"SAPBW":case"SAPBWMessageServer":return this.createSapBwWindows();default:return this.createUsernamePassword(e)}case a.Key:return"AzureTable"!==e?this.createKey():this.createAzureTableKey();case a.SAS:return this.createSAS();default:"unknown credentialType '".concat(t,"', can't init parameters")}},n.prototype.convert=function(e){switch(e.dataSourceKind){case"SAP":return this.convertSap(e);case"SAPBW":case"SAPBWMessageServer":return this.convertSapBw(e)}for(var t=[],a=0,i=e.credentialParameters;a<i.length;a++){var n=i[a];"select"===n.type&&"default"===n.value.toLocaleLowerCase()||t.push({name:n.name,value:n.value})}return t},n.prototype.createSapBasic=function(){var e=[{type:"select",name:"SSLValidateServerCertificate",displayName:this.localizationService.get("SettingsDataSource_SettingsSslValidateServerCertificate"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1,value:"true",defaultValue:"true",options:[{Name:this.localizationService.get("Yes"),Value:"true"},{Name:this.localizationService.get("No"),Value:"false"}]},{type:"select",name:"SSLCryptoProvider",displayName:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider"),shouldDisplay:"true",disabled:"".concat("ctrl.viewModel.waitingForDataSourceStatus"," || ctrl.viewModel.editableSettings.credentialParameters[0].value !== '").concat("true","'"),required:"".concat("parameter.shouldDisplay"," && ctrl.viewModel.editableSettings.credentialParameters[0].value === '").concat("true","'"),edited:!1,value:"mscrypto",defaultValue:"mscrypto",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider_SapCrypto"),Value:"sapcrypto"},{Name:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider_CommonCrypto"),Value:"commoncrypto"},{Name:this.localizationService.get("SettingsDataSource_SettingsSslCryptoProvider_MsCrypto"),Value:"mscrypto"}]},{type:"text",name:"SSLKeyStore",displayName:this.localizationService.get("Key_Store"),shouldDisplay:"true",placeholder:this.localizationService.get("SettingsDataSource_SettingsSslPlaceholder"),disabled:"".concat("ctrl.viewModel.waitingForDataSourceStatus"," || ctrl.viewModel.editableSettings.credentialParameters[0].value !== '").concat("true","' || ctrl.viewModel.editableSettings.credentialParameters[1].value === '").concat("mscrypto","'"),required:"false",edited:!1},{type:"text",name:"SSLTrustStore",displayName:this.localizationService.get("Trust_Store"),shouldDisplay:"true",placeholder:this.localizationService.get("SettingsDataSource_SettingsSslPlaceholder"),disabled:"".concat("ctrl.viewModel.waitingForDataSourceStatus"," || ctrl.viewModel.editableSettings.credentialParameters[0].value !== '").concat("true","' || ctrl.viewModel.editableSettings.credentialParameters[1].value === '").concat("mscrypto","'"),required:"false",edited:!1}];return e.push.apply(e,this.createUsernamePassword()||[]),e},n.prototype.createExtensionSparkWindows=function(){var e=[{type:"text",name:"Realm",displayName:this.localizationService.get("Realm"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"text",name:"HostFQDN",displayName:this.localizationService.get("Host_FQDN"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"text",name:"ServiceName",displayName:this.localizationService.get("Service_Name"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1}];return e.push.apply(e,this.createUsernamePassword()||[]),e},n.prototype.createSapBwBasic=function(){var e="ctrl.isSingleSignOnKerberosEnabled",t="ctrl.viewModel.editableSettings.credentialParameters[1].value",e=[{type:"text",name:"SNCPartnerName",displayName:this.localizationService.get("SettingsDataSource_SettingsSncPartnerName"),shouldDisplay:e,disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:e,edited:!1},{type:"select",name:"SNCLibrarySelect",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelect"),shouldDisplay:e,disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:e,edited:!1,value:"default",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectSncLib"),Value:"default"},{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectNtlm"),Value:"NTLM"},{Name:this.localizationService.get("Custom"),Value:"custom"}]},{type:"text",name:"SNCLibraryCustom",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustom"),shouldDisplay:e,placeholder:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustomPlaceholder"),disabled:"".concat("ctrl.viewModel.waitingForDataSourceStatus"," || ").concat(t," !== '").concat("custom","'"),required:"".concat("parameter.shouldDisplay"," && ").concat(t," === '").concat("custom","'"),edited:!1}];return e.push.apply(e,this.createUsernamePassword()||[]),e},n.prototype.createSapBwWindows=function(){var e=[{type:"text",name:"SNCPartnerName",displayName:this.localizationService.get("SettingsDataSource_SettingsSncPartnerName"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"select",name:"SNCLibrarySelect",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelect"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1,value:"default",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectSncLib"),Value:"default"},{Name:this.localizationService.get("SettingsDataSource_SettingsSncLibrarySelectNtlm"),Value:"NTLM"},{Name:this.localizationService.get("Custom"),Value:"custom"}]},{type:"text",name:"SNCLibraryCustom",displayName:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustom"),shouldDisplay:"true",placeholder:this.localizationService.get("SettingsDataSource_SettingsSncLibraryCustomPlaceholder"),disabled:"".concat("ctrl.viewModel.waitingForDataSourceStatus"," || ctrl.viewModel.editableSettings.credentialParameters[1].value !== '").concat("custom","'"),required:"".concat("parameter.shouldDisplay"," && ctrl.viewModel.editableSettings.credentialParameters[1].value === '").concat("custom","'"),edited:!1}];return e.push.apply(e,this.createUsernamePassword()||[]),e},n.prototype.createUsernamePassword=function(e,t){return void 0===t&&(t=!0),[{type:"text",shouldDisplay:"true",name:"username",displayName:this.getUserNameLabel(e),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1},{type:"password",shouldDisplay:"true",name:"password",displayName:this.getPasswordLabel(e),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:t?"parameter.shouldDisplay":"parameter.optional",edited:!1}]},n.prototype.createAzureTableKey=function(){var e=[{type:"select",name:"SNCLibrarySelect",displayName:this.localizationService.get("SettingsDataSource_SettingsAuthenticationMethod"),shouldDisplay:"true",disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1,value:"default",options:[{Name:this.localizationService.get("SettingsDataSource_SettingsAuthenticationMethod_Key"),Value:"default"}]}];return e.push.apply(e,this.createKey()||[]),e},n.prototype.createKey=function(){return[{type:"text",shouldDisplay:"true",name:"key",displayName:this.localizationService.get("SettingsDataSource_SettingsAccountKey"),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1}]},n.prototype.createSAS=function(){return[{type:"text",shouldDisplay:"true",name:"Token",displayName:this.localizationService.get("AuthDialog_FieldName_SAS"),disabled:"ctrl.viewModel.waitingForDataSourceStatus",required:"parameter.shouldDisplay",edited:!1}]},n.prototype.getUserNameLabel=function(e){return"File"===e||"Folder"===e?this.localizationService.get("SettingsDataSource_SettingsWindowsUsername"):this.localizationService.get("SettingsDataSource_SettingsUsername")},n.prototype.getPasswordLabel=function(e){return"File"===e||"Folder"===e?this.localizationService.get("SettingsDataSource_SettingsWindowsPassword"):this.localizationService.get("SettingsDataSource_SettingsPassword")},n.prototype.convertSap=function(e){for(var t,a,i,n,o=[],r=0,s=e.credentialParameters;r<s.length;r++){var c=s[r];"SSLValidateServerCertificate"===c.name?t=c.value:"SSLCryptoProvider"===c.name?a=c.value:"SSLKeyStore"===c.name?i=c.value:"SSLTrustStore"===c.name?n=c.value:o.push({name:c.name,value:c.value})}if("true"===t)for(var l=0,d=[["SSLValidateServerCertificate",t],["SSLCryptoProvider",a],["SSLKeyStore",i],["SSLTrustStore",n]];l<d.length;l++){var u=d[l],p=u[0],u=u[1];u&&o.push({name:p,value:u})}return o},n.prototype.convertSapBw=function(e){for(var t,a,i="SNCLibrary",n=[],o=0,r=e.credentialParameters;o<r.length;o++){var s=r[o];"select"===s.type&&"default"===s.value.toLocaleLowerCase()||("SNCLibrarySelect"===s.name?t=s.value:"SNCLibraryCustom"===s.name?a=s.value:n.push({name:s.name,value:s.value}))}return"custom"===t&&a?n.push({name:i,value:a}):t&&n.push({name:i,value:t}),n},n);function n(e,t){this.localizationService=t}t.CredentialParameterService=i})(powerbi=powerbi||{}),(function(e){(e=(e=(e=e.gateways||(e.gateways={})).services||(e.services={})).events||(e.events={})).dataSourcesOnDatasetStaleArtifact={name:"dataSourcesOnDatasetStaleArtifact",type:4},e.refreshGateways={name:"refreshGateways",type:4},e.selectGatewayStatusReadyEventName={name:"gatewaySettingsSelectGatewayStatusReady",type:4},e.gatewaySelectionDiscardedEventName={name:"gatewaySettingsGatewaySelectionDiscarded",type:4}})(powerbi=powerbi||{}),define("Gateways/services/gatewayDataService",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GatewayDataService=t.create=void 0;var d=powerbi.gateways.constants,u=powerbi.gateways.models,s=powerbi.common.EncryptionContext,c=powerbi.common.contracts.gateway.PrivacyLevel,l=powerbi.common.contracts.gateway.GatewayType;t.create=function(e,t,a,i,n){return new o(e,t,a,i,n)};a.prototype.ensureGatewaysMetadataServiceLoaded=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return this.gatewaysMetadataService?[3,2]:[4,(t=this).lazyProviderModern.get("@powerbi/Connectivity/connectivity.module#ConnectivityModule","gatewaysMetadataService")];case 1:t.gatewaysMetadataService=e.sent(),e.label=2;case 2:return[2]}}))}))},a.prototype.getSelectedGatewayDataSource=function(){return this.selectedGatewayDatasource},a.prototype.setSelectedGatewayDataSource=function(e){this.selectedGatewayDatasource=e},a.prototype.getDecodedPublicKey=function(e){return atob(e).split(/<\/Modulus>|<Modulus>/)[1]},a.prototype.prepareCredentials=function(e,t,a,i,n){var o=this.promiseFactory.defer(),r={credentials:null,credentialType:a,encryptedConnection:this.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled?2:0,privacyLevel:c.Public,encryptionAlgorithm:null};return n&&n===l.VirtualNetwork?(r.credentials=JSON.stringify(e),r.encryptionAlgorithm="NONE",o.resolve(r)):s.create(JSON.stringify(e),t,i,(function(e){r.credentials=e,r.encryptionAlgorithm="RSA-OAEP",o.resolve(r)}),this.moduleLoader).then((function(e){e.rsaEncrypt()})),o.promise},a.prototype.createDataSourceWithRetry=function(i,n,o,r,s){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,a=this;return __generator(this,(function(e){switch(e.label){case 0:return t=this.promiseFactory.defer(),[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),this.gatewaysMetadataService.createDataSource(i.objectId,n).then((function(e){t.resolve(e)}),(function(e){a.updateGatewayPublicKeyIfNeed(i,o,r,s,e).then((function(e){n.credentialDetails=e,a.gatewaysMetadataService.createDataSource(i.objectId,n).then((function(e){t.resolve(e)}),(function(e){t.reject(e)}))}),(function(){t.reject(e)}))})),[2,t.promise]}}))}))},a.prototype.createClusterDataSourceWithRetry=function(t){var a=this,n=this.promiseFactory.defer();return this.createClusterDataSource(t).then((function(i){return __awaiter(a,void 0,void 0,(function(){var t,a;return __generator(this,(function(e){switch(e.label){case 0:return a=(t=n).resolve,[4,i];case 1:return a.apply(t,[e.sent()]),[2]}}))}))}),(function(e){e.error.code===d.PublishDatasourceToClusterErrorCode?a.getGatewayClusterIfUpdated(t.dataSourceModel).then((function(e){t.dataSourceModel.gatewayCluster=u.GatewayModelConverter.convertClusters(e,a.localizationService),a.createClusterDataSource(t).then((function(i){return __awaiter(a,void 0,void 0,(function(){var t,a;return __generator(this,(function(e){switch(e.label){case 0:return a=(t=n).resolve,[4,i];case 1:return a.apply(t,[e.sent()]),[2]}}))}))}),(function(e){n.reject(e)}))}),(function(){n.reject(e)})):n.reject(e)})),n.promise},a.prototype.createClusterDataSource=function(u){return __awaiter(this,void 0,void 0,(function(){var t,a,i,n,o,r,s,c,l,d=this;return __generator(this,(function(e){switch(e.label){case 0:return t=this.promiseFactory.defer(),a=u.dataSourceModel.gatewayCluster,i={},n=[],[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:for(e.sent(),o=function(t){var e=r.getDecodedPublicKey(t.gatewayPublicKey);n.push(r.prepareCredentials(u.credentialData,e,u.credentialType,u.entropy,a.gatewayType).then((function(e){e.privacyLevel=u.privacyLevel,e.skipTestConnection=u.skipTestConnection,e.encryptedConnection=u.encryptedConnection,i[t.gatewayObjectId]=e})))},r=this,s=0,c=a.gateways;s<c.length;s++)l=c[s],o(l);return this.promiseFactory.all(n).then((function(){var e={dataSourceName:u.dataSourceName,dataSourceType:u.dataSourceType,onPremGatewayRequired:!0,connectionDetails:u.connectionDetails,supportedAuthenticationTypes:null,singleSignOnType:u.singleSignOnType,credentialDetailsDictionary:i,mashupTestConnectionDetails:u.mashupTestConnectionDetails};d.gatewaysMetadataService.createDataSourceToCluster(a.objectId,e).then((function(e){t.resolve(e)}),(function(e){t.reject(e)}))})),[2,t.promise]}}))}))},a.prototype.updateCredentialsWithRetry=function(i,n,o,r,s,c){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,a=this;return __generator(this,(function(e){switch(e.label){case 0:return t=this.promiseFactory.defer(),[4,this.ensureGatewaysMetadataServiceLoaded()];case 1:return e.sent(),this.gatewaysMetadataService.updateCredentials(i.objectId,n,s).then((function(){t.resolve(null)}),(function(e){a.updateGatewayPublicKeyIfNeed(i,o,r,c,e).then((function(e){e.privacyLevel=s.privacyLevel,e.skipTestConnection=s.skipTestConnection,e.encryptedConnection=s.encryptedConnection,a.gatewaysMetadataService.updateCredentials(i.objectId,n,e).then((function(){t.resolve(null)}),(function(e){t.reject(e)}))}),(function(){t.reject(e)}))})),[2,t.promise]}}))}))},a.prototype.updateClusterCredentialsWithRetry=function(t,a,i,n,o,r,s){var c=this,l=this.promiseFactory.defer();return this.updateClusterCredentials(t,a,i,n,o,r,s).then((function(e){l.resolve(e)}),(function(e){e.error.code===d.UpdateClusterDatasourceCredentialsErrorCode?c.getGatewayClusterIfUpdated(t).then((function(e){t.gatewayCluster=u.GatewayModelConverter.convertClusters(e,c.localizationService),c.updateClusterCredentials(t,a,i,n,o,r,s).then((function(e){l.resolve(e)}),(function(e){l.reject(e)}))}),(function(){l.reject(e)})):l.reject(e)})),l.promise},a.prototype.updateClusterCredentials=function(t,a,i,n,o,r,s){for(var c=this,l=this.promiseFactory.defer(),d=t.gatewayCluster,u={},p=[],g=(this.ensureGatewaysMetadataServiceLoaded(),this),e=0,S=d.gateways;e<S.length;e++)!(function(t){var e=g.getDecodedPublicKey(t.gatewayPublicKey);p.push(g.prepareCredentials(n,e,o,s,d.gatewayType).then((function(e){e.privacyLevel=a,e.skipTestConnection=r,e.encryptedConnection=i,u[t.gatewayObjectId]=e})))})(S[e]);return this.promiseFactory.all(p).then((function(){var e={gatewayObjectIdToCredentialDetailsDictionary:u};c.gatewaysMetadataService.updateClusterCredentials(d.objectId,t.objectId,e).then((function(e){l.resolve(e)}),(function(e){l.reject(e)}))})),l.promise},a.prototype.updateGatewayPublicKeyIfNeed=function(t,a,i,n,e){var o,r=this,s=this.promiseFactory.defer(),e=powerbi.helpers.PowerBIServiceExceptionErrorHelper.generateErrorMessage(e.error,this.localizationService);return this.ensureGatewaysMetadataServiceLoaded(),e&&e.displayableErrorInfo&&(o=this.localizationService.get("ServerError_DM_ErrorDetailNameCode_UnderlyingErrorMessage"),_.filter(e.displayableErrorInfo,(function(e){return e.errorInfoKey===o})))&&this.gatewaysMetadataService.getGateways().then((function(e){var e=_.filter(e,(function(e){return e.gatewayObjectId===t.objectId&&t.publicKey!==e.gatewayPublicKey}));_.isEmpty(e)?s.reject():(t.publicKey=e[0].gatewayPublicKey,e=r.getDecodedPublicKey(t.publicKey),r.prepareCredentials(a,e,i,n).then((function(e){s.resolve(e)}),(function(){s.reject()})))}),(function(){s.reject()})),s.promise},a.prototype.getGatewayClusterIfUpdated=function(a){var t=this.promiseFactory.defer();return this.ensureGatewaysMetadataServiceLoaded(),this.gatewaysMetadataService.getGatewayClusters().then((function(e){e=_.find(e,(function(e){return e.objectId===a.gatewayCluster.objectId}));e&&_.find(e.gateways,(function(t){var e=_.find(a.gatewayCluster.gateways,(function(e){return e.gatewayObjectId===t.gatewayObjectId}));return!e||e.gatewayPublicKey!==t.gatewayPublicKey}))?t.resolve(e):t.reject()}),(function(){t.reject()})),t.promise};var o=a;function a(e,t,a,i,n){this.featureSwitchService=e,this.lazyProviderModern=t,this.localizationService=a,this.moduleLoader=i,this.promiseFactory=n}t.GatewayDataService=o})),(function(e){(e=(e=e.gateways||(e.gateways={})).services||(e.services={})).gatewayObjectIdParamName="gatewayObjectId",e.dataSourceObjectIdParamName="dataSourceObjectId"})(powerbi=powerbi||{}),(function(e){var e=e.gateways||(e.gateways={}),t=(e.createDatasourceService=function(){return new t},a.prototype.getAndResetConnectionInfo=function(){var e=this.connectionInfo;return this.connectionInfo=null,e},a.prototype.getAndResetDataSourceType=function(){var e=this.dataSourceType;return this.dataSourceType=null,e},a.prototype.getAndResetLastUpdatedDatasource=function(){var e=this.lastUpdatedDatasource;return this.lastUpdatedDatasource=null,e},a.prototype.setConnectionInfo=function(e){this.connectionInfo=e},a.prototype.setDataSourceType=function(e){this.dataSourceType=e},a.prototype.setLastUpdatedDatasource=function(e,t){this.lastUpdatedDatasource={settingsGroup:e,settingsId:t}},a);function a(){}e.DatasourceService=t})(powerbi=powerbi||{}),(function(a){var i,e,n;function t(){n||(a.common.initializeAngularModule(),a.connectivity.initializeAngularModule(),angular.module("powerbi.gateways.directives",[]),angular.module("powerbi.gateways.components",[]),angular.module("powerbi.gateways.controllers",[]),angular.module("powerbi.gateways",["powerbi.common","powerbi.connectivity","powerbi.gateways.directives","powerbi.gateways.controllers","powerbi.gateways.components"]).factory("credentialParameterService",["featureSwitchService","localizationService",function(e,t){return i.createCredentialParameterService(e,t)}]).factory("datasourceService",[function(){return i.createDatasourceService()}]).config(["lazyProvider",function(e){e.factories.gatewayDataService={source:{javascript:"Gateways/services/gatewayDataService"},ng:["featureSwitchService","lazyProviderModern","localizationService","moduleLoader","promiseFactory"],fn:function(e,t,a,i,n,o){return e.create(t,a,i,n,o)}}}]).run(["$templateCache",e]),o(8),n=!0,window.gatewaysModuleDefined=!0)}function o(e){var t;n||(t=[{name:"Gateways",dependencies:["featureSwitchService"],blockType:1,consumerHostFlags:8,factory:a.gateways.directives.Gateways},{name:"Gateway",blockType:1,consumerHostFlags:8,factory:a.gateways.directives.Gateway},{name:"GatewaySettings",blockType:1,consumerHostFlags:8,factory:a.gateways.directives.GatewaySettings},{name:"GatewayAdministrators",blockType:1,consumerHostFlags:8,factory:a.gateways.directives.GatewayAdministrators},{name:"IgnoreDirty",blockType:1,consumerHostFlags:8,factory:a.gateways.directives.IgnoreDirty},{name:"DatasourceUsers",blockType:1,consumerHostFlags:8,factory:a.gateways.directives.DatasourceUsers},{name:"Datasource",blockType:1,consumerHostFlags:8,factory:a.gateways.directives.Datasource},{name:"DatasourceSettings",blockType:2,consumerHostFlags:8,factory:a.gateways.components.DatasourceSettings},{name:"PgwWarningBox",blockType:2,consumerHostFlags:8,factory:a.gateways.components.PgwWarningBox},{name:"SSOTestConnection",blockType:2,consumerHostFlags:8,factory:a.gateways.components.SSOTestConnection},{name:"UpnMappingPane",blockType:2,consumerHostFlags:8,factory:a.gateways.components.UpnMappingPane}],a.common.registerBuildingBlocksForHost(e,t,{directivesTarget:"powerbi.gateways.directives",componentsTarget:"powerbi.gateways.components"}))}i=a.gateways||(a.gateways={}),e=a.gateways.htmlTemplate.put,i.initializeAngularModule=t,i.registerBuildingBlocksForHost=o,n=!1,t()})(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] || (this.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
