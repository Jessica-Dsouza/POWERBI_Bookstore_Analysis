"use strict";var powerbi,__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,n,s,l){return new(s=s||Promise)(function(i,t){function o(e){try{a(l.next(e))}catch(e){t(e)}}function r(e){try{a(l.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,r)}a((l=l.apply(e,n||[])).next())})},__generator=this&&this.__generator||function(o,r){var a,n,s,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(i){return function(e){var t=[i,e];if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(s=2&t[0]?n.return:t[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,t[1])).done)return s;switch(n=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(s=0<(s=l.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))l.label=t[1];else if(6===t[0]&&l.label<s[1])l.label=s[1],s=t;else{if(!(s&&l.label<s[2])){s[2]&&l.ops.pop(),l.trys.pop();continue}l.label=s[2],l.ops.push(t)}}t=r.call(o,l)}catch(e){t=[6,e],n=0}finally{a=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}};!function(e){var t,i;(t=(t=e.dataServices||(e.dataServices={})).constants||(t.constants={})).contentPackDirtyShowNotification="contentPackDirty",t.reportDeletedEventName="reportDeleted",t.onDatasetAddedEventName="onDatasetAdded",t.deleteModelFailedEventName="deleteModelFailed",t.deleteModelStartedEventName="deleteModelStarted",t.onDashboardShallowEditEventName="onDashboardShallowEdit",t.mergeDashboardContainerModelsReportsAndPackagesEventName="mergeDashboardContainerModelsReportsAndPackages",t.updateDashboardContainerEventName="updateDashboardContainer",t.addOrUpdateDashboardEventName="addOrUpdateDashboard",t.samplesContentProviderId=-1,t.initialDashboardContainerLoadingState="#loading#",t.initialDashboardContainerErrorState="#error#",t.initialDashboardContainerReadyEventName="initialDashboardContainerReady",t.CannotDeleteModelPublishedToOrganizationalAppHeader="CannotDeleteModelPublishedToOrganizationalApp",t.seenDashboardsStorageKey="seenSharedDashboards",t.ScopedInstanceProviderName="dataServices",t.dashboardElementName=".dashboard",(i=t.workbook||(t.workbook={})).reloadExcelWorkbookEventName="reloadExcelWorkbook",i.pinClickedEventName="pinClicked",i.editInExcelOnlineClickedEventName="editInExcelOnlineClicked",i.editInExcelClickedEventName="editInExcelClicked",i.calculateWorkbookClickedEventName="calculateWorkbookClicked",i.openWorkbookContextMenuEventName="openWorkbookContextMenu",i.renameWorkbookEventName="renameWorkbook",i.editWorkbookEventName="editWorkbook",i.scheduleRefreshWorkbookEventName="scheduleRefreshWorkbook",i.refreshNowWorkbookEventName="refreshNowWorkbook",i.excelWebAppScriptsLoaded="excelWebAppScriptsLoaded",i.defaultKeepOriginalContentSize=!1,t.SingleValueRealTimeWindow=250,t.MultipleValueRealTimeWindow=6e4,t.RealTimeIntervals=[1,5,10,15,20,25,30,45,60],t.RealTimeDataSourceName="_RealTimeSchema_",t.modelPlaceholderImageUrl="/"+e.getBuild()+"/images/modelPlaceholder.png",(i=t.upgrader||(t.upgrader={})).TileConfigVersion="1.6",i.NoVisualType="No visual type"}(powerbi=powerbi||{}),function(t){var i=t.telemetry||(t.telemetry={}),e=jsCommon.Utility,o=t.telemetryEventFactory,r=t.telemetry.EventFactories;e?e.generateGuid:Function.prototype,i.TileDataUpdateExceptionEventName="PBI.TileDataUpdateException",i.TileDataUpdateException=r[i.TileDataUpdateExceptionEventName]=function(e){return o({name:i.TileDataUpdateExceptionEventName,info:e,category:t.TelemetryCategory.CriticalError,loggers:i.TileDataUpdateExceptionLoggers})},i.DashboardTileErrorEventName="PBI.Dashboard.TileError",i.DashboardTileError=r[i.DashboardTileErrorEventName]=function(e){return o({name:i.DashboardTileErrorEventName,info:e,category:t.TelemetryCategory.CriticalError,loggers:i.DashboardTileErrorLoggers})}}(powerbi=powerbi||{}),function(e){var t;e=(e=e.dataServices||(e.dataServices={})).contracts||(e.contracts={}),(t=e.TileType||(e.TileType={}))[t.composite=0]="composite",t[t.iframe=1]="iframe",t[t.image=2]="image",t[t.model=3]="model",t[t.ssrs=4]="ssrs",t[t.workbook=5]="workbook",t[t.report=6]="report",t[t.realTime=8]="realTime",(t=e.EwaNamedItemType||(e.EwaNamedItemType={}))[t.NamedRange=0]="NamedRange",t[t.Parameter=1]="Parameter",t[t.Table=2]="Table",t[t.PivotTable=3]="PivotTable",t[t.Chart=4]="Chart",t[t.WebExtension=5]="WebExtension",(t=e.QueryResultErrorType||(e.QueryResultErrorType={}))[t.PowerBIServiceException=0]="PowerBIServiceException",t[t.DSRException=1]="DSRException"}(powerbi=powerbi||{}),function(e){(e=(e=e.dataServices||(e.dataServices={})).contracts||(e.contracts={})).BuiltInThemeNamesResourceValues={Light:"Light",Dark:"Dark","Color-blind friendly":"Color_Blind_Friendly",Custom:"Custom"},e.createBuiltInThemesFactory=function(){var e={Light:{name:"Light",foreground:"#000000",background:"#EAEAEA",dataColors:["#01B8AA","#374649","#FD625E","#F2C80F","#5F6B6D","#8AD4EB","#FE9666","#A66999"],tiles:{background:"#FFFFFF",color:"#000000"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#000000"}}}]}}}},Dark:{name:"Dark",foreground:"#FFFFFF",background:"#484644",dataColors:["#51CFBE","#F55965","#FE9666","#92BEFF","#B577DF","#29B9EF","#3599B8","#DFBFBF"],tableAccent:"#E2A84E",tiles:{background:"#2B2B30",color:"#FFFFFF"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#FFFFFF"}}},{labelColor:{solid:{color:"#CECECE"}}}]}}}},"Color-blind friendly":{name:"Color-blind friendly",background:"#EAEAEA",foreground:"#000000",dataColors:["#074650","#009292","#FE6DB6","#FEB5DA","#480091","#B66DFF","#B5DAFE","#6DB6FF","#914800","#23FD23"],tiles:{background:"#FFFFFF",color:"#000000"},visualStyles:{"*":{"*":{"*":[{color:{solid:{color:"#000000"}}}]}}}}};return e}}(powerbi=powerbi||{}),function(e){(e=(e=(e=e.dataServices||(e.dataServices={})).models||(e.models={})).ContentPackItems||(e.ContentPackItems={}))[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report",e[e.Model=2]="Model",e[e.Workbook=3]="Workbook"}(powerbi=powerbi||{}),function(e){(e=(e=e.dataServices||(e.dataServices={})).models||(e.models={})).AppModelIconColors=["#000","#FFF"],e.AppModelIconBackgroundColors=[{color:"#374649",fontColor:"#FFF"},{color:"#01B8AA",fontColor:"#000"},{color:"#FD625E",fontColor:"#FFF"},{color:"#F2C80F",fontColor:"#000"},{color:"#5F6B6D",fontColor:"#000"},{color:"#8AD4EB",fontColor:"#000"},{color:"#FE9666",fontColor:"#000"},{color:"#A66999",fontColor:"#000"},{color:"#3599B8",fontColor:"#000"},{color:"#DFBFBF",fontColor:"#000"}],e.ServiceAppFallbackColors={color:"#374649",fontColor:"#FFF"},e.AppModelIcons=["financial","emi","group","realtime","image","pc1","paintbrush","world","streaming-data","user","barchart","gauge","globe","piedouble","areachart","comment","visualinteraction","code","shapes","piechart","stackedcolumn","scatter","database","home","insight"]}(powerbi=powerbi||{}),function(e){var t,i,o,r;function a(e){this.contract=e,this.isEnabled=!0,this.isUsedByContentPack=!1,this.isLoaded=e&&null!=e.tiles,this.hitCount=0,this.lazyTiles=null,this.uniqueId="".concat(o.Dashboard,"_").concat(this.contract.id)}t=e.dataServices||(e.dataServices={}),i=t.models||(t.models={}),o=e.common.contracts.ContentTileType,r=jsCommon.Lazy,i.DashboardAsyncLayoutDelayMs=100,a.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&null!=(e=this.getPermissionsCallback())?e:this.contract&&this.contract.permissions},a.prototype.increaseHitCount=function(){this.hitCount++},Object.defineProperty(a.prototype,"tiles",{get:function(){return this.lazyTiles||(this.lazyTiles=new r(function(){return[]})),this.lazyTiles.getValue()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"folderId",{get:function(){return this.contract.folderId},set:function(e){this.contract.folderId=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"canEdit",{get:function(){return t.DashboardUtils.isWriteable(this.contract)&&!(this.gridLayoutService&&this.gridLayoutService.strategy.isLayoutLocked)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"contentTileType",{get:function(){return o.Dashboard},enumerable:!1,configurable:!0}),a.prototype.isFilled=function(){return this.contract.tiles&&this.tiles.length===this.contract.tiles.length},a.prototype.calculateLayout=function(){this.layoutRequired=!1;var e=this.tiles;if(!_.isEmpty(e))for(var t=0,i=e;t<i.length;t++)i[t].calculateLayout()},a.prototype.applyLayout=function(){var e=this.tiles;if(!_.isEmpty(e))for(var t=0,i=e;t<i.length;t++)i[t].applyLayout()},a.prototype.runLayoutIfRequired=function(){this.layoutRequired&&(this.calculateLayout(),this.applyLayout())},a.prototype.scheduleDelayedLayout=function(e){var t=this;void 0===e&&(e=!1),this.layoutRequired||(this.layoutRequired=!0,e)||setTimeout(function(){t.layoutRequired&&(t.calculateLayout(),t.applyLayout())},i.DashboardAsyncLayoutDelayMs)},a.prototype.findTile=function(t){return _.find(this.tiles,function(e){return e.id===t})},a.prototype.findTileByObjectIdOrOriginalObjectId=function(t,i){if(t||i)return _.find(this.tiles,function(e){return!_.isEmpty(t)&&e.contract.objectId===t||!_.isEmpty(i)&&e.contract.originalTileObjectId===i})},a.prototype.getTileIndex=function(t){return _.findIndex(this.tiles,function(e){return e.id===t})},a.prototype.getTileContractIndex=function(t){return _.findIndex(this.contract.tiles,function(e){return e.id===t})},a.prototype.getUniquePackageId=function(){var e=this.contract;return e.originalPackageId||(e.packageIds&&1===e.packageIds.length?e.packageIds[0]:void 0)},a.prototype.hasModel=function(t){return _.some(this.tiles,function(e){return e.contract.modelId===t})},a.prototype.hasOwnerInfo=function(){return!_.isEmpty(this.ownerFullname)||!_.isEmpty(this.ownerMail)},i.Dashboard=a}(powerbi=powerbi||{}),function(e){function t(e){this.contract=e}e=(e=e.dataServices||(e.dataServices={})).models||(e.models={}),t.prototype.getPermissions=function(){var e;return(e=this.getPermissionsCallback?this.getPermissionsCallback():e)||this.contract&&this.contract.permissions},t.prototype.hasUpdate=function(){return this.version&&this.latestVersion&&this.version!==this.latestVersion},e.Package=t}(powerbi=powerbi||{}),function(e){var r,i;function a(e,t){this.datasetInfo=e,this.definition=t}r=e.dataServices||(e.dataServices={}),e=r.models||(r.models={}),i=window,Object.defineProperty(a.prototype,"databaseName",{get:function(){return this.datasetInfo.databaseName},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"primaryKey",{get:function(){return this.datasetInfo.resourceKey},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"secondaryKey",{get:function(){return this.datasetInfo.resourceKeySecondary},enumerable:!1,configurable:!0}),a.prototype.getPushUrl=function(){var e=window.tenantId,t=window.apiUri,e=("https://wabi-staging-us-east-redirect.analysis.windows.net"===i.clusterUri&&(t="https://powerbistagingapi.analysis.windows.net"),"/beta/"+e+"/datasets/"+this.databaseName+"/rows"),t=jsCommon.Utility.urlCombine(t,e),e={};return e.key=this.primaryKey,jsCommon.QueryStringUtil.addOrUpdateQueryStringToUrl(t,e)},a.createRealTimeDatasetDefinition=function(e,t,i){var i=i.schema(r.constants.RealTimeDataSourceName).entities,i=(i&&i.length,_.head(i)),o=[];return _.map(i.properties,function(e){o.push({name:e.displayName,dataType:a.convertToRealTimeDataType(e.type)})}),{name:e,columns:o,mode:t,tableName:i.name}},a.convertToRealTimeDataType=function(e){switch(e.primitiveType){case 3:case 4:return 1;case 7:return 2;case 1:return 0;case 5:return 3}},e.RealTimeModel=a}(powerbi=powerbi||{}),function(o){var t,e,r,i,a;function n(e,t,i){void 0===i&&(i=!0);var o=r.call(this)||this;return o.displayWidth=e,o.displayHeight=t,o.ignoreScrollbarWidth=i,o.minNumOfColumns=2,o.isLayoutLocked=!0,o}t=o.dataServices||(o.dataServices={}),e=t.models||(t.models={}),i=o.common.models.DefaultGridLayoutStrategy,a=o.common.directives.InViewport,__extends(n,r=i),n.prototype.calculateDisplayPositions=function(e){r.prototype.calculateDisplayPositions.call(this,e),this.scaleDashboard(e)},n.prototype.scaleDashboard=function(e){var e=this.getDashboardSize(e),t=n.calculateDashboardScaleFactor(e.width,this.displayWidth);t<=0||(e={transform:"scale("+t+")",width:e.width+"px",height:this.displayHeight/t+"px",left:0},$(o.dataServices.constants.dashboardElementName).css(e),a.getRefreshAllHandler()())},n.prototype.getDashboardSize=function(e){var t=this.getMaxColumnInLayout(e),e=this.getMaxRowInLayout(e),i=(t<this.minNumOfColumns&&(t=this.minNumOfColumns),o.common.GridLayoutConstants.defaultGridItemSpacing);return{width:t*this.gridWidth+i+this.getScrollbarWidth(),height:e*this.gridHeight+i}},n.calculateDashboardScaleFactor=function(e,t){return t/e},n.prototype.getMaxRowInLayout=function(e){return _.maxBy(_.map(e,function(e){return e.displayRow-1+e.displaySize.rowSpan}))},n.prototype.getMaxColumnInLayout=function(e){return _.maxBy(_.map(e,function(e){return e.displayCol-1+e.displaySize.colSpan}))},n.prototype.getScrollbarWidth=function(){var e;return null==this.scrollbarWidth&&(this.ignoreScrollbarWidth?this.scrollbarWidth=0:(e=t.DashboardUtils.calcDashboardScrollbarWidth(),this.scrollbarWidth=e<0?0:e/2)),this.scrollbarWidth},i=n,e.PhoneLandscapeTileLayoutStrategy=i}(powerbi=powerbi||{}),function(a){var e,i,t,o;function r(e){this.isLayoutLocked=!0,this.willOverrideDisplayPosition=!0,this.gridItemSpacing=i.tileSpacing,this.isDynamic=!1,this.tileTypeRowSpanMap={},this.visualTypeRowSpanMap={},this.gridWidth=e-this.gridItemSpacing,this.gridHeight=Math.round(this.gridWidth*i.aspectRatio),this.gridMinWidthOnResize=this.gridWidth-i.resizeBuffer,this.gridMinHeightOnResize=this.gridHeight-i.resizeBuffer,this.gridMaxWidthOnResize=this.gridWidth*a.common.models.gridLayoutConstants.getGridMaxColSpan(),this.gridMaxHeightOnResize=this.gridHeight*a.common.models.gridLayoutConstants.getGridMaxColSpan(),this.tileTypeRowSpanMap[t.report]=i.mediumTileRowSpan,this.visualTypeRowSpanMap[a.visuals.plugins.card.name]=i.smallTileRowSpan,this.visualTypeRowSpanMap[a.visuals.plugins.animatedNumber.name]=i.smallTileRowSpan,this.visualTypeRowSpanMap[a.visuals.plugins.textbox.name]=i.smallTileRowSpan}e=(e=a.dataServices||(a.dataServices={})).models||(e.models={}),t=a.dataServices.contracts.TileType,(o=i=e.PhoneTileLayoutConstants||(e.PhoneTileLayoutConstants={})).tileSpacing=12,o.smallTileRowSpan=4,o.defaultTileRowSpan=6,o.mediumTileRowSpan=7,o.largeTileRowSpan=9,o.resizeBuffer=10,o.aspectRatio=.1111,r.prototype.calculateDisplayPositions=function(e){for(var t=1,i=0,o=a.dataServices.DashboardUtils.orderItems(_.map(e,function(e){return{pos:e.getLayoutPosition(),item:e}}));i<o.length;i++){var r=o[i];r.displayCol=1,r.displayRow=t,this.calculateDisplaySize(r),t+=r.displaySize.rowSpan}this.removeScale()},r.prototype.calculateDisplaySize=function(e){var t=this.getRowSpan(e);e.displaySize={colSpan:1,rowSpan:t}},r.prototype.getRowSpan=function(e){var e=e.gridItem,t=this.tileTypeRowSpanMap[e.type];return(t=!t&&e.composite&&null!==(e=e.composite)?this.visualTypeRowSpanMap[e.visual.type]:t)||i.defaultTileRowSpan},r.prototype.removeScale=function(){$(a.dataServices.constants.dashboardElementName).removeAttr("style")},o=r,e.PhonePortraitTileLayoutStrategy=o}(powerbi=powerbi||{}),function(e){var t,i,o;function r(e,t){e=i.call(this,e,t)||this;return e.maxColumnsToDisaply=7,e.minColumnsToDisplay=3,e.portionOfNextColumn=.2,e}t=(t=e.dataServices||(e.dataServices={})).models||(t.models={}),o=e.common.GridLayoutConstants,i=t.PhoneLandscapeTileLayoutStrategy,__extends(r,i),r.prototype.getDashboardSize=function(e){var t=this.getMaxColumnInLayout(e),e=this.getMaxRowInLayout(e),i=(t>this.maxColumnsToDisaply?t=this.maxColumnsToDisaply+this.portionOfNextColumn:t<this.minColumnsToDisplay&&(t=this.minColumnsToDisplay),o.defaultGridItemSpacing);return{width:t*this.gridWidth+i,height:e*this.gridHeight+i}},t.TabletTileLayoutStrategy=r}(powerbi=powerbi||{}),function(i){var o,r,a,t,n,s,l,b;function c(e,t){return e.webUri&&e.etagHash?"".concat(e.webUri,"/_layouts/WopiFrame.aspx?sourcedoc={").concat(e.etagHash,"}&action=").concat(t):""}function e(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m,g,y,f,v,T){this.authenticationService=e,this.explorationSerializer=t,this.featureSwitchService=i,this.geocoder=o,this.geolocationService=r,this.localizationService=a,this.moduleLoader=n,this.permissionService=s,this.promiseFactory=l,this.reportModelConverter=c,this.telemetryService=u,this.themeService=d,this.tileConfigUpgraderService=p,this.visualHostTooltipService=h,this.visualPluginOps=m,this.visualPlugins=g,this.appModelConverter=y,this.$injector=f,this.datasetModelConverter=v,this.packageModelConverter=T}o=i.dataServices||(i.dataServices={}),r=o.models||(o.models={}),a=jsCommon.ArrayExtensions,t=i.common.models.CdsaContentTile,n=jsCommon.Lazy,s=i.common.models.Report,l=o.contracts.TileType,r.createDataServiceModelConverter=function(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m,g,y,f,v,T){return new b(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m,g,y,f,v,T)},r.getWorkbookActionUrl=c,e.prototype.setModelMerger=function(e){this.modelMerger=e},e.prototype.convertCompositeTile=function(e){return this.tileModelConverter.convertCompositeTile(e)},e.prototype.convertTileData=function(e){return this.tileModelConverter.convertTileData(e)},e.prototype.convertDashboard=function(e,t,i,o){var r=this,a=this.convertDashboardShallow(e);return e.tiles&&(a.lazyTiles=new n(function(){return _.map(e.tiles,function(e){return r.convertTile(e,t,i,o)})})),a},e.prototype.convertDashboardShallow=function(e){var t=this,i=new r.Dashboard(e);return i.getPermissionsCallback=function(){return t.permissionService.getDashboardEffectivePermissions(e)},i.dataClassificationId=e.dataClassificationId,i.folderId=e.folderId,this.modelMerger.mergeDashboardShallow(i,e),i},e.prototype.convertIframeTile=function(e){var t,i;return e&&e.type===l.iframe?(t=new r.IframeTileModel(e),i=this.convertTileConfig(e),this.convertTileLayoutConfig(e),i&&i.iframe&&(t.srcUrl=i.iframe.srcUrl,t.embedCode=i.iframe.embedCode),t.isLoading=r.TileFactory.isTileLoading(e),t):null},e.prototype.convertImageTile=function(e){var t;return e&&e.type===l.image?(t=new r.ImageTileModel(e),this.convertTileLayoutConfig(e),t.displayText=e.displayText,t.subDisplayText=e.subDisplayText,"number"!=typeof t.contract.reportId||e.config?(t.isStatic=!1,t.imageUrl=this.getImageUrl(e)):(t.isStatic=!0,t.imageUrl=o.constants.modelPlaceholderImageUrl),t.isLoading=r.TileFactory.isTileLoading(e),t):null},e.prototype.convertContentPackBase=function(e){return this.appModelConverter.convertContentPackBase(e)},e.prototype.convertAppModelBase=function(e){return this.appModelConverter.convertAppModelBase(e)},e.prototype.convertInstalledAppModel=function(e,t){return this.appModelConverter.convertInstalledAppModel(e,t)},e.prototype.convertModel=function(e){return this.datasetModelConverter.convertModel(e)},e.prototype.convertModelTile=function(e){var t;return e&&e.type===l.model?(t=new r.ModelTileModel(e),this.convertTileLayoutConfig(e),t.displayText=e.displayText,t.isLoading=r.TileFactory.isTileLoading(e),t.subDisplayText=e.subDisplayText,t):null},e.prototype.convertCdsaModel=function(e){var t=this.convertCdsaModelShallow(e);return t.permissions=e.permissions,t.name=e.name,t.displayName=e.displayName,t.description=e.description,t.id=e.id,t},e.prototype.convertCdsaModelShallow=function(e){return new t(e)},e.prototype.convertPackage=function(e){return this.packageModelConverter.convertPackage(e)},e.prototype.convertRealTimeTile=function(e){var t={authenticationService:this.authenticationService,featureSwitchService:this.featureSwitchService,geocoder:this.geocoder,geolocationService:this.geolocationService,localizationService:this.localizationService,moduleLoader:this.moduleLoader,promiseFactory:this.promiseFactory,telemetryService:this.telemetryService,themeService:this.themeService,tileModelConverter:this.tileModelConverter,visualHostTooltipService:this.visualHostTooltipService,visualPlugin:this.visualPlugins,visualPluginOps:this.visualPluginOps};return i.dataServices.models.convertRealTimeTile(e,t)},e.prototype.convertReport=function(e){return this.reportModelConverter.convertReport(e)},e.prototype.convertReportTile=function(e){return e&&e.type===l.report?(this.convertTileLayoutConfig(e),new r.ReportTileModel(e)):null},e.prototype.convertSpecificTileShallow=function(e,t){switch(this.convertTileLayoutConfig(e),e.type){case l.composite:var i=this.convertTileConfig(e);i&&i.visualContainer&&(t.composite=new r.SingleVisualCompositeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService,this.licenseUIManagerFactory)),t.composite&&(i=o.ContractUtils.getMasterLayoutPosition(e),t.composite.size={rowSpan:i.height,colSpan:i.width},t.composite.isLoading=r.TileFactory.isTileLoading(e));break;case l.iframe:t.iframe=new r.IframeTileModel(e),t.iframe.isLoading=r.TileFactory.isTileLoading(e);break;case l.image:t.image=new r.ImageTileModel(e),t.image.isLoading=r.TileFactory.isTileLoading(e);break;case l.model:t.model=new r.ModelTileModel(e),t.model.isLoading=r.TileFactory.isTileLoading(e);break;case l.ssrs:t.model=new r.SsrsTileModel(e),t.model.isLoading=r.TileFactory.isTileLoading(e);break;case l.workbook:t.workbook=new r.WorkbookTileModel(e,t),t.workbook.isLoading=r.TileFactory.isTileLoading(e);break;case l.report:t.model=new r.ReportTileModel(e),t.model.isLoading=r.TileFactory.isTileLoading(e);break;case l.realTime:this.convertTileConfig(e),t.realTime=new r.RealTimeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService)}},e.prototype.convertSsrsTile=function(e){if(!e||e.type!==l.ssrs)return null;this.convertTileLayoutConfig(e);var t=new r.SsrsTileModel(e);return e.config&&(t.imageUrl=this.getSsrsImageUrl(e)),t.isLoading=r.TileFactory.isTileLoading(e),t},e.prototype.convertTile=function(e,t,i,o){this.convertTileLayoutConfig(e);var r=this.convertTileShallow(e,t,i);return this.modelMerger.mergeTile(r,e,t,i,o),null!=e.reportId&&(t=this.getTileReport(e.reportId,i))&&(r.report=r.report||new s(t),this.fillReport(r.report,t)),r},e.prototype.convertTileLayoutConfig=function(e){return this.tileModelConverter.convertTileLayoutConfig(e)},e.prototype.convertTileAction=function(e){var t,i=e.$action;if(!i){if(e.action&&0===e.action.indexOf("{"))try{t=JSON.parse(e.action)}catch(e){}else t={action:e.action};i=e.$action=t}return i},e.prototype.convertTileConfig=function(e){return this.tileModelConverter.convertTileConfig(e)},e.prototype.convertTileShallow=function(e,t,i){this.convertTileLayoutConfig(e);var o=new r.Tile(e,this.localizationService,this.forceOpenCustomLinksInNewTab);return this.modelMerger.mergeTileShallow(o,e,t,i),o},e.prototype.convertWorkbook=function(e){var t=this,i=this.convertWorkbookShallow(e);return e&&(i.id=e.id,i.modelId=e.modelId,i.viewUrl=this.getWorkbookViewUrl(e),i.editUrl=this.getWorkbookEditUrl(e),i.embedUrl=this.getWorkbookEmbedView(e),i.name=e.name,i.displayName=e.displayName,i.description=e.description,i.fileName=e.fileName,i.packageId=e.packageId,i.isNew=e.isNew,i.getPermissionsCallback=function(){return t.permissionService.getWorkbookEffectivePermissions(e)}),i},e.prototype.convertWorkbookShallow=function(e){return new r.Workbook(e)},e.prototype.convertWorkbookTile=function(e,t,i){if(!e||e.type!==l.workbook)return null;this.convertTileLayoutConfig(e);i=new r.WorkbookTileModel(e,i),i.displayText=e.displayText,i.subDisplayText=e.subDisplayText,i.isLoading=r.TileFactory.isTileLoading(e),i.image=e.tileDataBinaryBase64Encoded,e.$config.workbookTile&&e.$config.workbookTile.keepOriginalContentSize?i.keepOriginalContentSize=e.$config.workbookTile.keepOriginalContentSize:i.keepOriginalContentSize=o.constants.workbook.defaultKeepOriginalContentSize,e=e.$config.workbookTile;return t&&(e&&(i.embedUrl=t.embedUrl+"&item="+e.item),t.contract)&&(i.webUri=t.contract.webUri),i},e.prototype.fillDashboardChildren=function(e,t,i,o){var r=this,a=e.contract;e.displayName!==a.displayName&&(e.displayName=a.displayName),a.tiles&&(e.lazyTiles=new n(function(){return a.tiles.map(function(e){return r.convertTile(e,t,i,o)})}))},e.prototype.fillReport=function(e,t){this.reportModelConverter.fillReport(e,t)},e.prototype.getImageUrl=function(e){e=this.convertTileConfig(e);if(e&&e.imageTile)return e.imageTile.imageUrl},e.prototype.getSsrsImageUrl=function(e){e=this.convertTileConfig(e);if(e&&e.ssrsTile)return e.ssrsTile.imageUrl},e.prototype.getTileModel=function(t,e){var i,o;return i=e&&-1!==(o=a.indexOf(e,function(e){return e&&e.id===t}))?e[o]:i},e.prototype.getTileReport=function(t,e){var i,o;return i=e&&-1!==(o=a.indexOf(e,function(e){return e&&e.id===t}))?e[o]:i},e.prototype.getTileWorkbook=function(t,i,e){var o,r;return o=e&&-1!==(r=a.indexOf(e,function(e){return e.id===t&&e.packageId===i}))?e[r]:o},e.prototype.resolveTilePackage=function(t,e){var i;t.packageId&&-1!==(i=a.indexOf(e,function(e){return e.id===t.packageId}))&&(t.tilePackage=e[i])},e.prototype.getWorkbookViewUrl=function(e){return c(e,"view")},e.prototype.getWorkbookEditUrl=function(e){return c(e,"edit")},e.prototype.getWorkbookEmbedView=function(e){return c(e,"embedview")},Object.defineProperty(e.prototype,"forceOpenCustomLinksInNewTab",{get:function(){var t;try{t=this.$injector.get("forceOpenCustomLinksInNewTab")}catch(e){t=!1}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"licenseUIManagerFactory",{get:function(){return this._licenseUIManagerFactory||(this._licenseUIManagerFactory=this.$injector.get("licenseUIManagerFactory")),this._licenseUIManagerFactory},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileModelConverter",{get:function(){return this._tileModelConverter||(this._tileModelConverter=r.createTileModelConverter(this.geolocationService,this.telemetryService,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geocoder,this.promiseFactory,this.moduleLoader,this.tileConfigUpgraderService,this.explorationSerializer,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService,this.licenseUIManagerFactory)),this._tileModelConverter},enumerable:!1,configurable:!0}),b=e}(powerbi=powerbi||{}),function(e){var a,d,o,i,r,n;function t(e,t){this.modelConverter=e,this.permissionService=t}a=e.dataServices||(e.dataServices={}),d=a.models||(a.models={}),o=jsCommon.ArrayExtensions,i=jsCommon.Lazy,r=e.common.helpers.UserInfoHelper,d.createDataServiceModelMerger=function(e,t){return new n(e,t)},t.prototype.mergeDashboard=function(e,t,n,s,l){var c=this,u=this.modelConverter.convertDashboard(t,n,s,l),d=(e.contract=t,e.displayName=u.displayName,e.getPermissionsCallback=function(){return c.permissionService.getDashboardEffectivePermissions(t)},e.contract.modelIds=t.modelIds,e.contract.reportIds=t.reportIds,e.contract.packageIds=t.packageIds,e.contract.workbookIds=t.workbookIds,e.qnaEnabled=t.qnaEnabled,e.gravityEnabled=t.gravityEnabled,e.annotationsEnabled=t.annotationsEnabled,e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup,e.isHidden=t.isHidden,e.tiles);e.lazyTiles=new i(function(){var e=[];if(!_.isEmpty(u.tiles))for(var t=_.keyBy(d,function(e){return e&&e.id}),i=0,o=u.tiles;i<o.length;i++){var r=o[i],a=t[r.id];a?(e.push(a),c.mergeTile(a,r.contract,n,s,l)):e.push(r)}return e})},t.prototype.mergeArtifactOwnerInfo=function(e,t){e.ownerFullname=r.getFullName(t.givenName,t.familyName),e.ownerMail=t.emailAddress,t.userObjectId&&(e.ownerUserObjectId=t.userObjectId),t.groupObjectId&&(e.ownerGroupObjectId=t.groupObjectId),e.contract.ownerInfo||(e.contract.ownerInfo=t)},t.prototype.mergeDashboardShallow=function(e,t){var i,o=this;t.displayName&&(e.displayName=t.displayName),void 0!==t.permissions&&(e.getPermissionsCallback=function(){return o.permissionService.getDashboardEffectivePermissions(t)},e.contract.permissions=t.permissions),t.modelIds&&(e.contract.modelIds=t.modelIds),t.reportIds&&(e.contract.reportIds=t.reportIds),t.workbookIds&&(e.contract.workbookIds=t.workbookIds),t.packageIds&&(e.contract.packageIds=t.packageIds),void 0!==t.isStaging&&(e.contract.isStaging=t.isStaging),void 0!==t.qnaEnabled&&(e.qnaEnabled=t.qnaEnabled),void 0!==t.gravityEnabled&&(e.gravityEnabled=t.gravityEnabled),void 0!==t.annotationsEnabled&&(e.annotationsEnabled=t.annotationsEnabled),void 0!==t.isSharedFromSecurityGroup&&(e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup),void 0!==t.isHidden&&(e.isHidden=t.isHidden),void 0!==t.ownerInfo&&(i=t.ownerInfo,this.mergeArtifactOwnerInfo(e,i)),e.sharedTime=t.sharedTime||"/Date(0)/"},t.prototype.mergeDashboardTiles=function(e,t){var i=t.models||[],o=t.reports||[],r=t.workbooks||[],a=t.packages||[],t=e.contract.tiles;if(t)for(var n=0,s=t;n<s.length;n++){var l=s[n];this.modelConverter.resolveTilePackage(l,a)}t=e.tiles;if(t)for(var c=0,u=t;c<u.length;c++){var d=u[c];this.mergeTile(d,d.contract,i,o,r)}},t.prototype.mergeModelContentProviderId=function(e,t){if(e)for(var i=0,o=e;i<o.length;i++){var r=o[i];r.contentProviderId=r.contentProviderId||a.ContractUtils.findContentProviderId(t,r.packageId)}},t.prototype.mergeTileShallow=function(e,t,i,o){this.modelConverter.convertTileLayoutConfig(t),e.contract=t,e.type=t.type,this.mergeTileLayoutConfig(e,t),e.displayText=t.displayText,e.subDisplayText=t.subDisplayText,e.backgroundImageUrl=this.modelConverter.getImageUrl(t),e.errorCode=t.errorCode;o=this.modelConverter.getTileReport(t.reportId,o);t.query&&t.query.modelQuery&&(e.utterance=t.query.modelQuery.utterance),e.action=this.modelConverter.convertTileAction(t),e.config=this.modelConverter.convertTileConfig(t),e.isLoading=d.TileFactory.isTileLoading(t),e.isLocked=d.TileFactory.isTileLocked(t),t.modelId&&(i=this.modelConverter.getTileModel(t.modelId,i))&&(e.vsName=i.vsName,e.dbName=i.dbName),t.reportId&&(e.report=e.report||this.modelConverter.convertReport(o),e.report.id=t.reportId),o&&(this.modelConverter.fillReport(e.report,o),e.action||(e.action={action:"/openReport"})),this.modelConverter.convertSpecificTileShallow(t,e)},t.prototype.mergeTileLayoutConfig=function(e,t){var i;t.$layoutConfig,e.layoutPosition.x&&e.layoutPosition.y&&e.layoutPosition.width&&e.layoutPosition.height||(t=o.extendWithId(t.$layoutConfig.layouts),i=(i=e.gridLayoutContext)?i.getActiveLayout():0,(t=t.withId(i))&&this.mergeLayoutPosition(e.layoutPosition,t.position))},t.prototype.mergeLayoutPosition=function(e,t){t&&(e.x=e.x||t.x,e.y=e.y||t.y,e.width=e.width||t.width,e.height=e.height||t.height)},t.prototype.mergeTile=function(e,t,i,o,r,a){var n=e.composite,s=e.realTime,n=(this.mergeTileShallow(e,t,i,o),e.composite=this.modelConverter.convertCompositeTile(t),n&&e.composite&&(e.composite.setDataLoadEventDelegate(n.dataLoadEventDelegate),e.composite.copyDependencies(n),n instanceof d.SingleVisualCompositeTileModel&&e.composite instanceof d.SingleVisualCompositeTileModel&&this.mergeVisual(e.composite.visual,n.visual),n.tileDataIsVolatile)&&n.tileData&&n.tileData.data&&(e.composite.tileData=n.tileData),e.iframe=this.modelConverter.convertIframeTile(t),e.image=this.modelConverter.convertImageTile(t),e.model=this.modelConverter.convertModelTile(t),e.ssrs=this.modelConverter.convertSsrsTile(t),this.modelConverter.convertRealTimeTile(t));if(this.updateTileRealTimeModel(e,s,n),e&&e.reportTile?(s=e.reportTile.exploration,e.reportTile=this.modelConverter.convertReportTile(t),e.reportTile.exploration=s):e.reportTile=this.modelConverter.convertReportTile(t),_.isEmpty(r)||(n=this.modelConverter.getTileWorkbook(t.workbookId,t.packageId,r))&&(s=this.modelConverter.convertWorkbook(n),e.workbook=this.modelConverter.convertWorkbookTile(t,s,e)),o){r=this.modelConverter.getTileReport(t.reportId,o);r?(e.report=e.report||this.modelConverter.convertReport(r),this.modelConverter.fillReport(e.report,r)):e.report=null,e.contractsReport=this.modelConverter.getTileReport(t.reportId,o)}else if(a){for(var l=void 0,c=0,u=a.length;c<u;c++)if(t.reportId===a[c].id){l=a[c];break}l&&(e.report=e.report||l,this.modelConverter.fillReport(e.report,l.contract),e.contractsReport=l.contract)}t.modelId&&(e.contractsModel=this.modelConverter.getTileModel(t.modelId,i))},t.prototype.mergeWorkbook=function(e,t){var i=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.getPermissionsCallback=function(){return i.permissionService.getWorkbookEffectivePermissions(t)},e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.packageId=t.packageId||e.packageId)},t.prototype.mergeInstalledAppModel=function(e,t,i){t=this.modelConverter.convertInstalledAppModel(t,i);delete t.isFavorite,delete t.isFavoriteDisabled,delete t.favoriteInfo,_.extend(e,t)},t.prototype.updateTileRealTimeModel=function(e,t,i){e.realTime=i,t&&e.realTime&&e.realTime.copyRealTimeModelDependencies(t)},t.prototype.mergeVisual=function(e,t){t.visual&&e.type===t.type&&(e.visual=t.visual),e.viewport=t.viewport},n=t,d.DataServiceModelMerger=n}(powerbi=powerbi||{}),function(l){var m,e,g,y,c,u,f,d,v,T,o;function r(e,t){t=t,function(e,t,i,o,r,a,n,s,l){o&&(e.layoutType=o);i&&(e.elements=i);r&&(e.queryMetadata=r);n&&(e.heading1=n);a&&(e.heading2=a);s&&(e.heading3=s);t&&(e.transform=u.serializeTransformActions(u.serializeDataViewTransformActions(t,l&&l.objects)))}(o={$visualContainer:(i=e).visualContainer,$modelExtensions:i.modelExtensions,themeCollection:l.visualHost.ThemeUtils.cloneThemeCollection(i.themeCollection),dataSourceVariables:i.dataSourceVariables},i.dataTransforms,i.elements,i.tileLayoutType,i.queryMetadata,i.tileFilterDetails,i.tileHeading,i.tileSubDisplay,t);var i=o,t={version:v},o=null==(o=null==(o=e.visualContainer.config.singleVisual.vcObjects)?void 0:o.title)?void 0:o.find(function(e){return!e.selector});return t.hideTitle=!1===(null==(o=null==(o=null==o?void 0:o.properties)?void 0:o.show)?void 0:o.value),null!=e.realTimeDataWindow?((o=i).dataWindow=e.realTimeDataWindow,t.realTimeVisual=o):t.visualContainer=i,t}function a(e,t){var i=[],e=function(e,t){e=[{id:1,title:t.get("AddWidgetModal_IframeOption_Title"),description:t.get("AddWidgetModal_IframeOption_Description"),iconClass:"pbi-glyph-iframe",template:"<edit-iframe-widget></edit-iframe-widget>",defaultTileContract:{type:T.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:1,name:"webContent"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()},disabled:!e,tooltip:e?void 0:t.get("Dashboard_WebContentTiles_Disabled")},{id:2,title:t.get("Image"),description:t.get("AddWidgetModal_ImageOption_Description"),iconClass:"pbi-glyph-image",template:"<edit-image-widget></edit-image-widget>",defaultTileContract:{type:T.image,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{imageTile:{imageUrl:""},version:"1.0",widget:{id:2,name:"image"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()}},{id:3,title:t.get("Textbox"),description:t.get("AddWidgetModal_TextOption_Description"),iconClass:"pbi-glyph-font",template:"<edit-text-widget></edit-text-widget>",defaultTileContract:{type:T.composite,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{version:"1.0",visualContainer:{layoutType:0,$visualContainer:{name:o.generateGuid(),config:{singleVisual:{objects:{},visualType:"textbox"}}},themeCollection:{}},widget:{id:3,name:"textbox"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()}},{id:4,title:t.get("AddWidgetModal_VideoOption_Title"),description:t.get("AddWidgetModal_VideoOption_Description"),iconClass:"pbi-glyph-slideshow",template:"<edit-video-widget></edit-video-widget>",defaultTileContract:{type:T.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:4,name:"video"}},$layoutConfig:m.ContractUtils.createMasterLayoutConfig()}}];return{title:t.get("Add_Widgets_Section_Title"),tiles:e}}(e,t),t=(e&&!_.isEmpty(e.tiles)&&i.push(e),(e=[]).push({id:6,title:(t=t).get("Realtime_TileTitle"),description:t.get("Realtime_TileDetails"),iconClass:"pbi-glyph-streaming-data",defaultTileContract:{type:T.realTime,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{realTimeVisual:{dataWindow:null,layoutType:0,$visualContainer:{name:o.generateGuid(),config:{singleVisual:null}},themeCollection:{}},version:"1.0"},$layoutConfig:m.ContractUtils.createMasterLayoutConfig({width:y.gridItemSmallLandscapeColSpan,height:y.gridItemSmallLandscapeRowSpan})}}),{title:t.get("Add_Realtime_Section_Title"),tiles:e});return _.isEmpty(t.tiles)||i.push(t),_.cloneDeep(i)}function n(e,t,i,o,r){t!==T.composite&&T.realTime;var a=y.gridItemMediumLandscapeColSpan,n=y.gridItemMediumLandscapeRowSpan,i=(m.TileUtils.getVisualType(e)===l.visuals.plugins.card.name&&(a=y.gridItemSmallLandscapeColSpan,n=y.gridItemSmallLandscapeRowSpan),i?{modelQuery:{sq:JSON.stringify(i)}}:null),a=m.ContractUtils.createMasterLayoutConfig({width:a,height:n}),n={id:++g,type:t,query:i,$config:e,tileData:o?function(e){if(void 0!==e)return JSON.stringify(e,function(e,t){return e&&e.charAt&&"$"===e.charAt(0)?void 0:t})}(o.data):null,tileDataSet:o,layoutConfig:JSON.stringify(a),$layoutConfig:a},t=e.visualContainer;return t&&(n.displayText=t.heading1,n.subDisplayText=t.heading3),r&&(n.modelId=r.id),n}m=l.dataServices||(l.dataServices={}),e=m.models||(m.models={}),y=l.common.GridLayoutConstants,c=l.data.services.DataViewObjectSerializer,u=l.data.services.DataViewTransformActionsSerializer,f=l.common.models.gridLayoutConstants,d=l.data.SQExpr,v=m.constants.upgrader.TileConfigVersion,T=m.contracts.TileType,o=jsCommon.Utility,e=e.TileFactory||(e.TileFactory={}),g=100,e.findModel=function(e,t,i){for(var o=0,r=i.length;o<r;o++){var a=i[o];if(a.vsName===e&&a.dbName===t)return a}},e.createCompositeTile=function(e,t,i,o){return n(e,T.composite,t,i,o)},e.createTileConfig=r,e.createTileForPinData=function(e,t,i){return t=r(e,t),e.tileDataType&&(t.tileDataType=e.tileDataType),(t=n(t,null!=e.realTimeDataWindow?T.realTime:T.composite,e.query,e.dataViewSource,i)).publishState=2,e.action&&(t.action=JSON.stringify(e.action)),null!=e.utterance&&(t.query.modelQuery.utterance=e.utterance),e.name&&(t.name=e.name),t.reportId=e.reportId,e.modelId&&(t.modelId=e.modelId),e.packageId&&(t.packageId=e.packageId),t.resourcePackageIds=e.resourcePackageIds,t},e.createNonVisualTileFromExisting=function(e){var t=_.omitBy({id:++g,type:e.type,query:e.query,action:e.action,$config:e.$config,tileData:e.tileData,tileDataSet:e.tileDataSet,publishState:e.publishState,displayText:e.displayText,subDisplayText:e.subDisplayText,modelId:e.modelId,reportId:e.reportId,workbookId:e.workbookId,packageId:e.packageId,name:e.name},function(e){return void 0===e}),e=m.ContractUtils.getMasterLayoutPosition(e),e=m.ContractUtils.createMasterLayoutConfig({height:e.height,width:e.width});return t.$layoutConfig=e,t.layoutConfig=JSON.stringify(e),t},e.createReportTileForExploreData=function(e,t,i,o,r,a,n,s,l,c,u,d){var p,h={version:v},s=((s||l)&&(h.reportTile={pod:s,filters:l}),c&&(p={modelQuery:{utterance:c}}),2*y.defaultGridWidth),l=2*y.defaultGridHeight,c=u?u/s:2,u=d?d/l:2,s=(0===Math.round(c)&&(c=2),0===Math.round(u)&&(c=2),Math.round(y.gridItemMediumLandscapeColSpan*c)),d=Math.round(y.gridItemMediumLandscapeRowSpan*u),s=s>f.getGridMaxColSpan()?f.getGridMaxColSpan():s,d=d>f.getGridMaxRowSpan()?f.getGridMaxRowSpan():d,l=m.ContractUtils.createMasterLayoutConfig({width:s,height:d});return{id:++g,type:T.report,displayText:r,subDisplayText:a,action:JSON.stringify(n),reportId:e,sectionId:o,modelId:t,packageId:i,publishState:2,query:p,config:h?JSON.stringify(h):void 0,$config:h,layoutConfig:JSON.stringify(l),$layoutConfig:l}},e.isTileLoading=function(e){return 1===e.publishState},e.isTileLocked=function(e){return 20===e.errorCode},e.getTileGalleryGroups=a,e.getTileTemplate=function(t,e){for(var i=0,o=a(!0,e);i<o.length;i++){var r=o[i],r=_.find(r.tiles,function(e){return e.id===t});if(null!=r)return r.template}return null},e.serializeTileConfig=function(e,t,i,o){var r,a,n,s;if(e)return(a=(r=_.cloneDeep(e)).realTimeVisual||r.visualContainer)&&(o?(n=e.realTimeVisual||e.visualContainer,a.visualContainer=t.serializeVisualContainer(n.$visualContainer)):(o=a.$visualContainer.config.singleVisual,(s=l.data.DataViewObjectDefinitions.getValue(o.vcObjects,{objectName:"stylePreset",propertyName:"name"},void 0))&&d.isConstant(s)&&s.value&&(a.stylePresetName=s.value),a.visual=o.visualType,a.columnProperties=o.columnProperties,(s=(n=e.realTimeVisual||e.visualContainer).$visualContainer.config.singleVisual.objects)&&(i=i.capabilities(o.visualType))&&i.objects&&(a.objects=c.serializeObjects(s,i.objects)),(o=e.visualContainer&&n.$visualContainer.config.singleVisual.vcObjects)&&(a.vcObjects=c.serializeObjects(o,l.explore.contracts.VisualContainer.CommonObjectDescriptors)),r.visualContainer&&(r.visual=a,delete r.visualContainer),r.version="0.1"),a.$modelExtensions&&(a.modelExtensions=t.serializeModelExtensions(a.$modelExtensions)),delete a.$visualContainer,delete a.$modelExtensions),JSON.stringify(r)}}(powerbi=powerbi||{}),function(e){var t,i,o,r;function a(e){var t=i.call(this,void 0===e?0:e.id,1,void 0===e?0:e.packageId)||this;return t.contract=e,t}t=(t=e.dataServices||(e.dataServices={})).models||(t.models={}),o=e.common.contracts.ContentTileType,r=jsCommon.EnumExtensions,e=e.common.models.ReportResource,__extends(a,i=e),a.prototype.getPermissions=function(){var e;return(e=this.getPermissionsCallback?this.getPermissionsCallback():e)||this.contract&&this.contract.permissions},Object.defineProperty(a.prototype,"contentTileType",{get:function(){return o.Workbook},enumerable:!1,configurable:!0}),a.prototype.isOwner=function(){return r.hasFlag(this.getPermissions(),7)},a.prototype.isPersonalized=function(){var e=this.getPermissions();return r.hasFlag(e,11)&&!r.hasFlag(e,7)},a.prototype.isEditable=function(){var e=this.editUrl;return this.isOwner()&&null!=e&&""!==e},Object.defineProperty(a.prototype,"displayNameWithExtension",{get:function(){var e=jsCommon.FileUtils.getFileExtension(this.contract.sourceFilePath);return this.displayName.concat(".").concat(e)},enumerable:!1,configurable:!0}),e=a,t.Workbook=e}(powerbi=powerbi||{}),function(n){var l,o,t,s,r,i,c,a,u,e,g;function d(e,t,i){this.useSmallPlotArea=!1,this.contract=e,this.visualPluginService=t,this.pluginOps=i}function p(e,t,i,o,r,a,n,s,l,c,u,d,p,h){var m=g.call(this,e,t,i)||this,e=(m.featureSwitchService=o,m.geolocationService=r,m.geocoder=a,m.promiseFactory=n,m.moduleLoader=s,m.telemetryService=l,m.themeService=c,m.authenticationService=u,m.localizationService=d,m.visualHostTooltipService=p,m.requiresResize=!1,h&&(m.licenseUIManager=h.create()),{onNotifyLicense:function(e){return m.onNotifyLicense(e)},onClearLicenseNotification:function(){return m.onClearLicenseNotification()},onNotifyFeatureBlocked:function(e){return m.onNotifyFeatureBlocked(e)}});return m._visual={hostServices:m.createHostServices(h?e:void 0),themeCollection:{}},m}l=n.dataServices||(n.dataServices={}),o=l.models||(l.models={}),t=n.explore.services.createVisualHostServices,s=n.data.services.DataViewTransformActionsSerializer,r=n.common.models.gridLayoutConstants,i=n.common.helpers.ModelConverterHelper,c=n.data.SQExpr,a=n.explore.util.ThemeUtils,u=n.explore.util.VisualContainerUtils,Object.defineProperty(d.prototype,"type",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"tileData",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"tileDataIsVolatile",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"isError",{get:function(){return this._isError},set:function(e){this._isError=e,this.onErrorDelegate&&this.onErrorDelegate()},enumerable:!1,configurable:!0}),d.prototype.isDataStale=function(e){return!1},Object.defineProperty(d.prototype,"heading1",{get:function(){return this.config.heading1||""},enumerable:!1,configurable:!0}),d.prototype.setDependencies=function(e){this.dataProxy=e},d.prototype.setDataLoadEventDelegate=function(e){this.dataLoadEventDelegate=e},d.prototype.copyDependencies=function(e){e.dataProxy&&this.setDependencies(e.dataProxy)},e=d,o.CompositeTileModel=e,o.staleDataDeltaInMs=36e5,__extends(p,g=e),Object.defineProperty(p.prototype,"type",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"visual",{get:function(){return this._visual},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"themeCollection",{get:function(){return this._visual&&this._visual.themeCollection},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"heading1",{get:function(){var e,t,i,o=this.config.heading1||"";return this.visual&&((t=this.visual.dataTransforms)&&(e=t.selects),(t=this.visual.data)&&(i=t.dataView),!1!==this.cachedShow&&void 0===this.cachedHeading&&(t=u.evaluateObjectDefinitions(this.themeCollection,this.themeService,this.config.$visualContainer,this.featureSwitchService.featureSwitches,!1,i,e)).dataViewObjects&&(void 0===this.cachedShow&&(this.cachedShow=n.DataViewObjects.getValue(t.dataViewObjects,{objectName:"title",propertyName:"show"},!0)),this.cachedShow)&&(null!==(i=n.DataViewObjects.getValue(t.dataViewObjects,{objectName:"title",propertyName:"text"},null))?this.cachedHeading=i:_.isEmpty(o)&&(o=" ")),this.cachedHeading)||o},enumerable:!1,configurable:!0}),p.prototype.setThemeName=function(e){this.ensureVisual();var t=this._visual.themeCollection;t.customTheme=t.customTheme||a.getThemeMetadata(e,1),t.customTheme.name=e},p.prototype.isDataStale=function(e){var t;return!!e&&(t=this.contract,!!(t=(t=i.convertRefreshTimeToJsDateTime(t.tileDataUpdatedTime))&&t.getTime()))&&e-t>o.staleDataDeltaInMs},p.prototype.setData=function(e,t,i){try{this.ensureVisual(),this._visual.data=e,this._visual.dataTransforms=t,this._visual.type=i,this.clearCache()}catch(e){this.telemetryService.logEvent(n.telemetry.TileDataUpdateException,{visualType:i,source:e.fileName,lineNumber:e.lineNumber,columnNumber:e.columnNumber,stack:e.stack,message:e.message})}},p.prototype.createHostServices=function(e){return t({geocoder:this.geocoder,geolocation:this.geolocationService,localizationService:this.localizationService,moduleLoader:this.moduleLoader,promiseFactory:this.promiseFactory,visualHostTooltipService:this.visualHostTooltipService,authenticationService:this.authenticationService,canExpandCollapse:function(){return!0},onNotifyLicense:e&&e.onNotifyLicense,onClearLicenseNotification:e&&e.onClearLicenseNotification,onNotifyFeatureBlocked:e&&e.onNotifyFeatureBlocked})},p.prototype.ensureVisual=function(){this._visual||(this._visual={hostServices:this.createHostServices(),themeCollection:{}},this.calculateLayout())},Object.defineProperty(p.prototype,"config",{get:function(){return this._config},set:function(e){var t,i,o,r,a;this._config=e,this._visual&&(a=(t=e.$visualContainer.config.singleVisual).visualType,this._visual.type=a,r=n.data.DataViewObjectDefinitions.getValue(t.vcObjects,{objectName:"stylePreset",propertyName:"name"},void 0),this._visual.stylePresetName=r&&c.isConstant(r)&&r.value,this._visual.themeCollection=_.cloneDeep(e.themeCollection),(r=this.visualPluginService.capabilities(a))&&(i=r.objects,o=t.objects),a=jsCommon.JsonExtensions.tryParseJSON(e.transform),this._visual.dataTransforms=a?s.deserializeDataViewTransformActions(a,r):s.createTransformActions(e.queryMetadata,e.elements,i,o))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"tileData",{get:function(){return this._tileData},set:function(e){this._tileData=e,this.readDataView(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"tileDataIsVolatile",{get:function(){return this.contract.tileDataIsVolatile},enumerable:!1,configurable:!0}),p.prototype.refreshData=function(){this.readDataView(!1)},p.prototype.setDependencies=function(e){var t=!this.dataProxy&&this._tileData&&!this.isLoading;g.prototype.setDependencies.call(this,e),t&&this.refreshData()},p.prototype.readDataView=function(s){return __awaiter(this,void 0,n.Promise,function(){var t,i,o,r,a,n;return __generator(this,function(e){switch(e.label){case 0:if(o=this._visual.type,this.visual&&!this.requiresData())return this._visual.data={dataView:null},[2];if(this._tileData,!(t=this.dataProxy))return[2];if(this.contract.queryResultError&&((i=l.TileUtils.getTileErrorDetailsFromQueryResultError(this.contract.queryResultError,this.localizationService))?(this.isError=!0,this.errorDetails=i,this.errorText=i.message):this.errorText=this.localizationService.get("Tile_ErrorText")),!this._tileData||!this._tileData.data)return this.isLoading=!this.isError,[2];i=this._tileData,o={type:i.type,query:{dataSources:null,command:i.data},allowResultFromClientCache:s,perfId:o,kinds:this.pluginOps.dataViewKinds(o)},r=null,this.dataLoadEventDelegate&&(r=this.dataLoadEventDelegate(),this.dataLoadEventDelegate=null),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.execute(o)];case 2:return n=e.sent(),a={dataView:n&&n.dataReaderResult?n.dataReaderResult.dataView:null,dataViewSource:n&&n.dataViewSource?n.dataViewSource:null},n=n.dataReaderResult.error,this._visual.data=a,this.isError=this.isError||null!=n,r&&(this.isError?r.reject():r.resolve()),[3,4];case 3:return e.sent(),this.isError=!0,r&&r.reject(),[3,4];case 4:return[2]}})})},p.prototype.applyLayout=function(e,t){var i;this.requiresResize&&(t||(t=this.visual)&&t.visual&&(i=t.visual,e=e===r.changeType.resized?2:e===r.changeType.resizing?1:void 0,i.update({viewport:t.viewport,dataViews:t.dataViews,suppressAnimations:!0,type:n.VisualUpdateType.Resize,resizeMode:e})),this.requiresResize=!1)},p.prototype.calculateLayout=function(e,t,i){void 0===i&&(i=1),e&&(this.viewport&&this.viewport.height===e.height&&this.viewport.width===e.width||(this.requiresResize=!0),this.viewport=e),null!=t&&this.useSmallPlotArea!==t&&(this.useSmallPlotArea=t,this.requiresResize=!0),this.viewport&&(e=this.viewport.height,t=this.viewport.width,1!==(this._config&&this._config.layoutType)&&(this.useSmallPlotArea?e-=o.TileConstants.VisualSmallVerticalMargin:e-=o.TileConstants.VisualVerticalMargin,t-=o.TileConstants.VisualHorizontalMargin),this._visual)&&(this._visual.viewport={height:e,width:t,scale:i})},p.prototype.canResizeTo=function(e){var t=this._visual&&this._visual.visual;return!!t&&(!t.canResizeTo||t.canResizeTo(n.common.GridLayoutConstants.getDefaultGridItemViewport(e)))},p.prototype.getErrorLocId=function(e,t){return""},p.prototype.requiresData=function(){var e=this.visual,t=this.pluginOps;if(e){if(e&&e.type){if(!t)return!0;if(!t.isQueryVisual(e.type))return!1}return!0}},p.prototype.updateVisualInteractivityOptions=function(e){var t=this.visualPluginService.getInteractivityOptions(this._visual.type);void 0!==t.isInteractiveLegend&&(t.isInteractiveLegend=t.isInteractiveLegend&&e),this._visual.interactivityOptions=t},p.prototype.clearCache=function(){this.cachedHeading=void 0},p.prototype.onNotifyLicense=function(e){0!==e&&this.licenseUIManager.displayNotification(e)},p.prototype.onNotifyFeatureBlocked=function(e){this.licenseUIManager.displayFeatureBlockedBanner(e)},p.prototype.onClearLicenseNotification=function(){this.licenseUIManager.clearNotification()},e=p,o.SingleVisualCompositeTileModel=p}(powerbi=powerbi||{}),function(t){var e;function i(e){this.contract=e}e=(e=t.dataServices||(t.dataServices={})).models||(e.models={}),i.prototype.canResizeTo=function(e){return e.rowSpan===t.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===t.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},i.prototype.getErrorLocId=function(e,t){return""},e.IframeTileModel=i}(powerbi=powerbi||{}),function(t){var e;function i(e){this.contract=e}e=(e=t.dataServices||(t.dataServices={})).models||(e.models={}),Object.defineProperty(i.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){(this._imageUrl=e)&&!this.isStatic&&0!==e.indexOf("data:")&&(this._imageUrl=jsCommon.Utility.getAbsoluteUri(e))},enumerable:!1,configurable:!0}),i.prototype.canResizeTo=function(e){return e.rowSpan===t.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===t.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},i.prototype.getErrorLocId=function(e,t){return""},e.ImageTileModel=i}(powerbi=powerbi||{}),function(t){var e;function i(e){this.contract=e}e=(e=t.dataServices||(t.dataServices={})).models||(e.models={}),i.prototype.canResizeTo=function(e){return e.rowSpan===t.common.GridLayoutConstants.gridItemSmallLandscapeRowSpan},i.prototype.getErrorLocId=function(e,t){return""},e.ModelTileModel=i}(powerbi=powerbi||{}),function(r){var a,n,h,s,l,t;function e(e,t,i,o,r,a,n,s,l,c,u,d,p){e=h.call(this,e,t,i,o,r,a,n,s,l,c,u,d,p)||this;return e._visual=null,e._localizationService=d,e}a=r.dataServices||(r.dataServices={}),n=a.models||(a.models={}),s=a.constants.SingleValueRealTimeWindow,l=r.data.EmptyDataClientError,t=r.data.FailedRealTimeUpdateClientError,h=n.SingleVisualCompositeTileModel,__extends(e,h),e.prototype.setModelId=function(t){return __awaiter(this,void 0,r.Promise,function(){return __generator(this,function(e){switch(e.label){case 0:return this.contract.modelId=t,[4,this.initialize()];case 1:return e.sent(),[2]}})})},e.prototype.getRealTimeModelId=function(){return __awaiter(this,void 0,r.Promise,function(){var i,o=this;return __generator(this,function(e){return this.datasetStore?(i=this.contract,[2,this.datasetStore.findAll(i.modelId,!0).then(function(e){var t;if(!_.isEmpty(e))return{id:(t=(t=(t=_.find(e,function(e){return null==i.packageId||e.packageId===i.packageId}))||_.find(e,function(e){return jsCommon.EnumExtensions.hasFlag(e.permissions,7)}))||_.first(e)).id,originalModelId:t.originalModelId,tableName:o.getSchemaTableName(),schema:o.getRealTimeConceptualSchema(),packageId:i.packageId}})]):[2,void 0]})})},e.prototype.setRealTimeModelDependencies=function(e,t,i,o,r){h.prototype.setDependencies.call(this,e),this.visualQueryGenerator=t,this.conceptualSchemaProxy=i,this.realTimeDataService=o,this.datasetStore=r},e.prototype.copyRealTimeModelDependencies=function(i){return __awaiter(this,void 0,r.Promise,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(i.schema&&(this.schema=i.schema),i.dataProxy&&i.realTimeDataService&&i.visualQueryGenerator&&i.conceptualSchemaProxy)?(this.setRealTimeModelDependencies(i.dataProxy,i.visualQueryGenerator,i.conceptualSchemaProxy,i.realTimeDataService,i.datasetStore),i.onErrorDelegate&&!this.onErrorDelegate&&(this.onErrorDelegate=i.onErrorDelegate),[4,i.getRealTimeModelId()]):[2];case 1:return t=e.sent(),this.realTimeDataService.replaceListener(t,i,this),[2]}})})},e.prototype.onDataChanged=function(){return __awaiter(this,void 0,r.Promise,function(){var t,i,o,r,a=this;return __generator(this,function(e){switch(e.label){case 0:return(this.visualQueryGenerator,this.dataProxy,this.singleVisualConfig)?(t=s,(i=this.config)&&i.dataWindow&&(t=i.dataWindow),[4,this.getDatasources()]):[2];case 1:return i=e.sent(),!(o=this.visualQueryGenerator.execute({dataSources:i,schema:this.schema,config:this.singleVisualConfig,additionalFilters:null,dataWindow:t}))||o.error?(r=void 0,o&&o.error&&(r=o.error.getDetails(this._localizationService)),this.onError(r)):this.dataProxy.execute(o.options).then(function(e){a.isError=!1;var e={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null},t=a.lastCategoryValue;try{var i=n.RealTimeModelUtility.getLastDateOrNumericCategoryValue(e.dataView);if(null!=t&&null!=i&&t.valueOf()>=i.valueOf())return;a.lastCategoryValue=i}catch(e){}a.setData(e,o.transforms,a.config.$visualContainer.config.singleVisual.visualType),a.isLoading=!1},function(e){e instanceof l||(e=e&&e.getDetails(a._localizationService),a.onError(e))}),[2]}})})},e.prototype.onError=function(e){e=e||(new t).getDetails(this._localizationService),this.setErrorDetails(e)},e.prototype.getDatasources=function(){return __awaiter(this,void 0,r.Promise,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getRealTimeModelId()];case 1:return(t=e.sent())?[2,n.RealTimeModelUtility.getRealTimeDataSource(t.id,t.originalModelId)]:[2,void 0]}})})},Object.defineProperty(e.prototype,"singleVisualConfig",{get:function(){return this.config.$visualContainer.config.singleVisual},set:function(e){this.config.$visualContainer.config.singleVisual=e,this.onDataChanged()},enumerable:!1,configurable:!0}),e.prototype.isDataStale=function(){return!1},e.prototype.initialize=function(){return __awaiter(this,void 0,r.Promise,function(){var t,i=this;return __generator(this,function(e){return t=a.ContractUtils.getMasterLayoutPosition(this.contract),this.size={rowSpan:t.height,colSpan:t.width},[2,this.getDatasources().then(function(e){if(e)return i.conceptualSchemaProxy.get(e).then(function(e){return i.fixUpSchema(e),i.schema=e,i.getRealTimeModelId().then(function(e){i.realTimeDataService.subscribe(e,i)})})})]})})},e.prototype.unsubscribe=function(){return __awaiter(this,void 0,r.Promise,function(){var t=this;return __generator(this,function(e){return[2,this.getRealTimeModelId().then(function(e){if(e&&e.tableName)return t.realTimeDataService.unsubscribe(e,t)})]})})},e.prototype.fixUpSchema=function(e){e=e.schema(a.constants.RealTimeDataSourceName).entities;e&&e.length;for(var t=0,i=e[0].properties;t<i.length;t++){var o=i[t];o.type!==r.ValueType.fromDescriptor({numeric:!0})&&o.type!==r.ValueType.fromDescriptor({integer:!0})||(o.kind=1)}},e.prototype.getSchemaTableName=function(){var e=this.getRealTimeConceptualSchema();if(e)return(e=e.entities).length,_.head(e).name},e.prototype.getRealTimeConceptualSchema=function(){if(this.schema)return this.schema.schema(a.constants.RealTimeDataSourceName)},e.prototype.setErrorDetails=function(e){this.errorDetails=e,this.errorText=e.message,this.isError=!0},n.RealTimeTileModel=e}(powerbi=powerbi||{}),function(a){var i,e,n;i=a.dataServices||(a.dataServices={}),e=i.models||(i.models={}),n=e.RealTimeModel,(e=e.RealTimeModelUtility||(e.RealTimeModelUtility={})).getRealTimeDataSource=function(e,t){if(e&&!(e<0))return a.explore.contracts.createDataSourceArray([{id:e,type:a.data.tabular.type,name:i.constants.RealTimeDataSourceName,tabular:{modelId:null!=t?t:e}}])},e.convertToColumnsDefinition=function(e){if(e=a.data.tabular.getColumnsMetadata(e)){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i];t.push({name:r.name,dataType:n.convertToRealTimeDataType(a.ValueType.fromDescriptor(r.type))})}return t}},e.getLastDateOrNumericCategoryValue=function(e){if(e=e&&e.categorical)return e=(e=_.head(e.categories))&&e.values,!_.isEmpty(e)&&(e=_.last(e))&&!_.isBoolean(e)&&(_.isDate(e)||_.isNumber(e))?e:void 0}}(powerbi=powerbi||{}),function(t){var e;function i(e){this.contract=e,this.exploration={contract:void 0,exploreCanvas:void 0,sections:[]},this.isError=!1,this.tilesUpdated=!1}e=(e=t.dataServices||(t.dataServices={})).models||(e.models={}),i.prototype.canResizeTo=function(e){return e.rowSpan===t.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===t.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},i.prototype.getErrorLocId=function(e,t){return""},e.ReportTileModel=i}(powerbi=powerbi||{}),function(t){var e;function i(e){this.contract=e}e=(e=t.dataServices||(t.dataServices={})).models||(e.models={}),Object.defineProperty(i.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){e&&(0!==e.indexOf("data:")?this._imageUrl=jsCommon.Utility.getAbsoluteUri(e):this._imageUrl=e)},enumerable:!1,configurable:!0}),i.prototype.canResizeTo=function(e){return e.rowSpan===t.common.GridLayoutConstants.gridItemLargeLandscapeRowSpan||e.colSpan===t.common.GridLayoutConstants.gridItemLargeLandscapeColSpan},i.prototype.getErrorLocId=function(e,t){return""},e.SsrsTileModel=i}(powerbi=powerbi||{}),function(e){var r,a,t,i,n,s,o,l,c;function u(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.DashboardIntraDomainNavigationPrefix)}function d(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.ReportIntraDomainNavigationPrefix)}function p(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.RdlReportIntraDomainNavigationPrefix)}function h(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(t.WorkbookIntraDomainNavigationPrefix)}function m(e){return u(e)||d(e)||p(e)||h(e)}function g(e,t,i){this.forceOpenCustomLinksInNewTab=i,this.isSelected=!1,this.hasConversation=!1,this.hasSpotlight=!1,this.contract=e,this.tileHeaderSize=1,this.layoutPosition={},this.localizationService=t,this.themeName="Light",this.tileStyles={},this.tileHeaderStyles={},this.tileBackground={}}r=e.dataServices||(e.dataServices={}),t=r.models||(r.models={}),i=jsCommon.ArrayExtensions,n=jsCommon.DateExtensions,s=e.common.utils.DateFormatter,o=e.common.helpers.ModelConverterHelper,l=jsCommon.UrlUtils,(e=t.IntraDomainNavigationType||(t.IntraDomainNavigationType={}))[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report",e[e.RdlReport=2]="RdlReport",t.getDashboardGuidFromUrl=function(e){if(!(_.isEmpty(e)||e.length<t.DashboardIntraDomainNavigationPrefix.length)&&u(e))return e.substr(t.DashboardIntraDomainNavigationPrefix.length)},t.IsDashboardIntraDomainPrefix=u,t.IsReportIntraDomainPrefix=d,t.IsRdlReportIntraDomainPrefix=p,t.IsWorkbookIntraDomainPrefix=h,t.IsValidIntraDomainPrefix=m,t.DashboardIntraDomainNavigationPrefix="/dashboards/",t.ReportIntraDomainNavigationPrefix="/reports/",t.RdlReportIntraDomainNavigationPrefix="/rdlreports/",t.WorkbookIntraDomainNavigationPrefix="/workbooks/",(e=a=t.TileConstants||(t.TileConstants={})).SubtitleHeight=10,e.TileDefaultPadding=10,e.RegularHeaderHeight=50,e.SmallHeaderHeight=42,e.LargeHeaderHeight=65,e.sensitivityDesktopBannerHeight=44,e.sensitivityMobileBannerHeight=40,e.sensitivityMobileExpendBannerHeight=64,e.VisualVerticalMargin=20,e.VisualHorizontalMargin=20,e.VisualSmallVerticalMargin=8,Object.defineProperty(g.prototype,"gridLayouts",{get:function(){return this.contract.$layoutConfig.layouts},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"details",{get:function(){switch(this.type){case r.contracts.TileType.composite:return this.composite;case r.contracts.TileType.iframe:return this.iframe;case r.contracts.TileType.image:return this.image;case r.contracts.TileType.model:return this.model;case r.contracts.TileType.ssrs:return this.ssrs;case r.contracts.TileType.workbook:return this.workbook;case r.contracts.TileType.report:return this.reportTile;case r.contracts.TileType.realTime:return this.realTime;default:return null}},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"shouldBeIncludedInTelemetryMeasurement",{get:function(){return this.details&&!!this.details.shouldBeIncludedInTelemetryMeasurement},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isTemporary",{get:function(){return this.id<=0},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isTileLoading",{get:function(){return this.composite?this.composite.isLoading&&!this.composite.isError:this.isLoading},enumerable:!1,configurable:!0}),g.prototype.calculateLayout=function(e,t){var i,o=this.getHeaderSizeByType(this.tileHeaderSize);_.isNil(this.currentViewPort)||!_.isNil(e)||_.isNil(t)||(e=this.currentViewPort),this.compositeTile&&e&&(e=e,i=2===this.tileHeaderSize,_.isNil(t)||_.isNil(this.currentViewPort)?(i?this.hasTitle()?e.height-=o:1!==(this.composite&&this.composite.config&&this.composite.config.layoutType)&&(e.height-=a.TileDefaultPadding):this.hasTitle()&&(this.hasSubtitle()?e.height-=o:e.height-=o-a.SubtitleHeight),this.currentViewPort=e):0<t&&((o={width:this.currentViewPort.width,height:this.currentViewPort.height}).height-=t,o.height<=0||(e=o)),this.compositeTile.calculateLayout(e,i))},g.prototype.getTileHeight=function(){return this.hasTitle()?this.getHeaderSizeByType(this.tileHeaderSize):0},g.prototype.applyLayout=function(e,t){this.compositeTile&&this.compositeTile.applyLayout(e,t)},g.prototype.invalidateLayout=function(){this.tryPopulateLayoutPositionValues()&&this.gridLayoutContext.onLayoutInvalidated()},g.prototype.tryPopulateLayoutPositionValues=function(){var e;return!(!this.gridLayoutContext||this.gridLayoutContext.isLayoutUpdateLocked||(e=this.gridLayoutContext.getActiveLayout(),(e=i.extendWithId(this.contract.$layoutConfig.layouts).withId(e))&&e.position&&(this.layoutPosition=_.cloneDeep(e.position)),0))},g.prototype.applyChanges=function(){var e,t;this.contract&&this.gridLayoutContext&&(e=_.cloneDeep(this.layoutPosition),t=this.contract.$layoutConfig,r.TileUtils.addOrUpdateLayoutPosition(t,e,this.gridLayoutContext.getActiveLayout()),this.contract.layoutConfig=JSON.stringify(this.contract.$layoutConfig))},g.isValidUrl=function(e,t){return!_.isEmpty(e)&&(l.isValidHttpUrl(e,!1)||t&&m(e))},g.prototype.getDisplayText=function(){return this.displayText||(this.compositeTile?this.compositeTile.heading1:"")},g.prototype.getSubDisplayText=function(){if(this.displayText&&this.subDisplayText)return this.subDisplayText;if(this.compositeTile){var e=this.compositeTile.config;if(!this.displayText&&e&&!_.isEmpty(e.heading3))return e.heading3}return""},g.prototype.shouldPlaceBulletSeperator=function(){return this.displayText&&0<this.displayText.length&&this.subDisplayText&&0<this.subDisplayText.length&&this.config&&this.config.lastRefreshTimeEnabled},Object.defineProperty(g.prototype,"hrefTarget",{get:function(){return this.action.openInSameTab&&!this.forceOpenCustomLinksInNewTab?"_self":"_blank"},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"lastRefreshTimeInLocaleString",{get:function(){var e=o.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime),t="";return e?t=e.toLocaleString():this.datasetModel&&(t=this.datasetModel.lastRefreshTimeInLocaleString),t||""},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"formattedTime",{get:function(){var e;return(e=this.workbook?(e=this.contract.tilePackage)?o.convertRefreshTimeToJsDateTime(e.lastRefreshTime):null:o.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime))?this.cachedRefreshTime&&e.getTime()===this.cachedRefreshTime.getTime()?this.cachedRefreshString:(this.cachedRefreshTime=e,this.cachedRefreshString=this.getFormattedDateString(e)):this.datasetModel?this.datasetModel.lastRefreshTimeInLocaleString:void 0},enumerable:!1,configurable:!0}),g.prototype.getFormattedDateString=function(e){var t=c,i=n.isContainedInTimeFrame,o=n.isMomentPresent();return o&&i(e,t.Minute,t.MaxMinuteThreshold,!1)?s.getPrettyRelativeDate(e,this.localizationService):o&&i(e,t.Day,t.SameDayThreshold,!0)?n.GetTime(this.localizationService.currentLanguageLocale,e):o&&i(e,t.Day,t.YesterdayThreshold,!0)?this.localizationService.format("DashboardTile_YesterdayTemplate",[n.GetTime(this.localizationService.currentLanguageLocale,e)]):o&&i(e,t.Day,t.WeekThreshold,!0)?n.GetDayWithTime(this.localizationService.currentLanguageLocale,e):n.GetFullDateWithTime(this.localizationService.currentLanguageLocale,e)},g.prototype.setDatasetModelAndPackageInfo=function(e,t){e&&(this.datasetModel=e,t)&&(this.datasetModel.packagePublishStatus=t.publishOrRefreshStatus)},g.prototype.hasTitle=function(){return(!this.config||!this.config.hideTitle)&&(!_.isEmpty(this.displayText)||this.compositeTile&&!_.isEmpty(this.compositeTile.heading1))},g.prototype.hasSubtitle=function(){var e=this.config;return(!e||!e.hideTitle)&&(!_.isEmpty(this.subDisplayText)||e&&e.lastRefreshTimeEnabled)},g.prototype.lastRefreshTimeInLocaleWithLabel=function(){if(this.config&&this.config.lastRefreshTimeEnabled)return this.localizationService.format("Refreshed",[this.formattedTime])},g.prototype.setTileHeaderSize=function(e){this.tileHeaderSize!==e&&(this.tileHeaderSize=e,this.invalidateLayout())},Object.defineProperty(g.prototype,"compositeTile",{get:function(){return this.composite||this.realTime},enumerable:!1,configurable:!0}),g.prototype.hasLayoutDefinition=function(e){return!!i.extendWithId(this.contract.$layoutConfig.layouts).withId(e)},g.prototype.hasLayoutPosition=function(e){return!!r.ContractUtils.getLayoutPosition(this.contract,e)},g.prototype.removeLayoutPosition=function(e){return this.hasLayoutDefinition(e=void 0===e?1:e)&&(this.addLayout({id:e,position:null},e),this.resetTileLayoutSizeAndPosition()),this.getCurrentTileLayoutDescriptor()},g.prototype.resetTileLayoutSizeAndPosition=function(){this.layoutPosition.x=null,this.layoutPosition.y=null,this.layoutPosition.height=null,this.layoutPosition.width=null,this.gridLayoutContext=null},g.prototype.removeLayoutDefinition=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.hasLayoutDefinition(t)&&(_.remove(this.contract.$layoutConfig.layouts,function(e){return e.id===t}),e)&&this.resetTileLayoutSizeAndPosition(),this.getCurrentTileLayoutDescriptor()},g.prototype.applyLayoutSize=function(e,t,i){this.compositeTile&&(this.compositeTile.size={colSpan:e.colSpan,rowSpan:e.rowSpan}),this.applyLayout(t,i)},g.prototype.getCurrentTileLayoutDescriptor=function(e,t,i){e=e||this.contract.$layoutConfig;return r.TileUtils.getCurrentTileLayoutDescriptor(this.contract,e,t,i)},g.prototype.buildLayoutDescriptor=function(){var e=_.cloneDeep(this.layoutPosition),t=_.cloneDeep(this.contract.$layoutConfig),i=(r.TileUtils.addOrUpdateLayoutPosition(t,e,this.gridLayoutContext.getActiveLayout()),this.composite&&this.composite.contract&&this.composite.contract.query),e=i&&r.TileUtils.getTileQueryAfterResize(i,e),o=null;return i&&e&&(this.composite.contract.query.modelQuery.sq=JSON.stringify(e),o=JSON.stringify(this.composite.contract.query)),r.TileUtils.getCurrentTileLayoutDescriptor(this.contract,t,i,o)},g.prototype.addLayout=function(e,t){return this.removeLayoutDefinition(t),this.contract.$layoutConfig.layouts.push(e),this.getCurrentTileLayoutDescriptor()},g.prototype.getHeaderSizeByType=function(e){switch(e){case 0:return a.LargeHeaderHeight;case 2:return a.SmallHeaderHeight;default:return a.RegularHeaderHeight}},e=g,t.Tile=e,(e=c=c||{}).Minute="minute",e.Day="day",e.MaxMinuteThreshold=15,e.SameDayThreshold=0,e.YesterdayThreshold=1,e.WeekThreshold=6}(powerbi=powerbi||{}),function(t){var e;function i(e,t){this.contract=e,this.tileModel=t}e=(e=t.dataServices||(t.dataServices={})).models||(e.models={}),i.prototype.canResizeTo=function(e){return e.rowSpan===t.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||e.colSpan===t.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},i.prototype.getErrorLocId=function(e,t){var i,o=[];switch(e){case 10:i="WorkbookTile_GeneralError";break;case 11:i="WorkbookTile_FileNotFound";break;case 12:i="WorkbookTile_ObjectNotFound",o=this.contract.$config.workbookTile?[this.contract.$config.workbookTile.item]:["pinned object"];break;case 13:i="WorkbookTile_Unauthorized";break;default:return""}return t.format(i,o)},i.prototype.hasImages=function(){return this.hasWorkbookTileConfig&&this.tileModel.config.workbookTile.images&&0<this.tileModel.config.workbookTile.images.length},Object.defineProperty(i.prototype,"images",{get:function(){return this.hasWorkbookTileConfig?this.tileModel.config.workbookTile.images:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasWorkbookTileConfig",{get:function(){return!!this.tileModel&&!!this.tileModel.config&&!!this.tileModel.config.workbookTile},enumerable:!1,configurable:!0}),e.WorkbookTileModel=i}(powerbi=powerbi||{}),function(e){var i;function t(e){if(e&&e.modelQuery&&e.modelQuery.sq){var t,i;try{t=JSON.parse(e.modelQuery.sq)}catch(e){}if(t)return e=null,(i=t).dataQuery&&i.dataQuery.Commands&&0<i.dataQuery.Commands.length?e=t.dataQuery:(i=t).Commands&&0<i.Commands.length?e=t:t.defn&&(e={Commands:[{SemanticQueryDataShapeCommand:{Query:t.defn,Binding:t.shape}}]}),e}}function o(e,t){e.$layoutConfig,e.$layoutConfig.layouts;e=i.extendWithId(e.$layoutConfig.layouts).withId(t);return e?e.position:null}e=e.dataServices||(e.dataServices={}),i=jsCommon.ArrayExtensions,(e=e.ContractUtils||(e.ContractUtils={})).findContentProviderId=function(e,t){if(e)for(var i=e.length,o=0;o<i;o++)if(e[o].id===t)return e[o].contentProviderId;return null},e.convertToSemanticQueryWithDataShapeBinding=function(e){return(e=t(e))&&e.Commands&&0<e.Commands.length?{defn:(e=e.Commands[0].SemanticQueryDataShapeCommand).Query,shape:e.Binding}:null},e.convertToTileDataQuery=t,e.createMasterLayoutConfig=function(e){return{layouts:[{id:0,position:e=void 0===e?{}:e}]}},e.getMasterLayoutPosition=function(e){return e=o(e,0)},e.getLayoutPosition=o,e.reportTypeToString=function(e){switch(e){case 0:return"pbix";case 1:return"rdl";default:return"unknown"}}}(powerbi=powerbi||{}),function(e){var i,o;e=e.dataServices||(e.dataServices={}),i=jsCommon.DateExtensions,o=jsCommon.Utility,(e.DateUtils||(e.DateUtils={})).convertDate=function(e){var t=o.getDateFromWcfJsonString(e,!0);return t=t||i.parseIsoDate(e)}}(powerbi=powerbi||{}),function(o){var i,e,t,r,a,n;function s(e){return e&&5===e.category}function l(e){return 7===e.category||6===e.category||3===e.category}function c(e){return e.originalPackageId||(e.packageIds&&1===e.packageIds.length?e.packageIds[0]:void 0)}function u(e,t){if(e)return(t=t.getAppInstance(e))&&t.providerContract.providerKey}function d(e){return!(e.icon||_.isEmpty(e.iconUrl)&&_.isEmpty(e.localAppLogoImageData))}function p(e,t){if(d(e))return e.localAppLogoImageData||(e.iconUrl?a.urlCombine(t,e.iconUrl):void 0)}function h(t,e){e=_.find(e.packages,function(e){return e.contract.folderId===t&&e.contract.serviceAppObjectId});if(e)return e.id}function m(e,t){e=t.findPackage(e);if(e&&e.contract&&e.contract.folderId)return h(e.contract.folderId,t)}i=o.dataServices||(o.dataServices={}),t=jsCommon.Color,r=o.common.models.Model,a=jsCommon.Utility,n=i.models.Workbook,(e=i.AppUtils||(i.AppUtils={})).isOrgApp=s,e.isOrgAppInstance=function(e,t){return(t=t.getAppInstance(e))&&s(t.providerContract)},e.isParameterizedApp=l,e.isParameterizedAppInstance=function(e,t){return(t=t.getAppInstance(e))&&l(t.providerContract)},e.getDashboardAppGUID=function(e,t){if(e&&e.contract)return u(e.getUniquePackageId&&e.getUniquePackageId(),t)},e.getDashboardAppGUIDByContract=function(e,t){if(e)return u(c(e),t)},e.getUniquePackageId=c,e.getResourceAppGUID=function(e,t){if(e)return u(e.packageId,t)},e.getAppGUIDByPackageId=u,e.convertDisplayDate=function(e,t){return(e=i.DateUtils.convertDate(e))&&e.toLocaleDateString(t.currentLanguageLocale,{month:"short",day:"numeric",year:"numeric"})},e.hasAppLogoImage=d,e.getAppLogoImageUrl=p,e.getAppLogoImageUrlStyle=function(e,t){if(d(e))return"url(".concat(p(e,t),")")},e.getAppHeaderFontColor=function(e){return e?125<.299*(e=t.parseColorString(e)).R+.587*e.G+.144*e.B?"#000":"#FFF":"inherit"},e.getAppHeaderBackgroundColor=function(e){if(e)return t.calculateHighlightColor(t.parseColorString(e),.8,.2)},e.getAppContentModelObjectId=function(e){return e instanceof r?e.dbName:e instanceof n?e.uniqueId:e.objectId},e.getAppAuthor=function(e){if(e=jsCommon.JsonExtensions.tryParseJSON(e.providerConfig))return e.author},e.getServiceAppWorkspacePackageIdByFolderId=h,e.getServiceAppWorkspacePackageId=m,e.isServiceApp=function(e,t){return null!=m(e,t)},e.findContentProviderName=function(e,t){var i="Unknown";return e&&t&&(6===t?i="Excel Workbook":7===t?i="Power BI Designer File":17===t?i="OrgContent":60===t?i="CSV File":(e=_.find(e,{id:t}))&&(i=e.clientCategory===o.common.contracts.ContentProviderClientCategory.Organizational?"OrgContent":e.displayText)),i}}(powerbi=powerbi||{}),function(r){var e,t,o;function D(e,t,i){var o=e[e.length-1];!_.isEmpty(e)&&t>=o.startPosition&&t<o.startPosition+o.size?t+i>o.startPosition+o.size&&(o.size=t+i-o.startPosition):e.push({startPosition:t,size:i})}function I(e,t,i){return 1<e.length&&i&&t<=o}e=r.dataServices||(r.dataServices={}),t=r.common.helpers.ModelConverterHelper,o=3,(e=e.DashboardUtils||(e.DashboardUtils={})).isWriteable=function(e){return 2==(2&e.permissions)},e.notifyReadOnly=function(e,t,i,o){return e="NotifiedReadOnlyDashboard"+e.id,(o=o||!r.common.sessionStorageService.getData(e))&&(t.notify({title:i.get("Warning_Title"),message:i.get("DashboardReadOnlyWarning_Message"),notificationType:1}),r.common.sessionStorageService.setData(e,!0)),o},e.isQnaSupportedModel=function(e){return!!e&&t.getIsQnaSupported(e)},e.getDashboardModels=function(e,t){var i=[];if(e){var o=[],r=e.modelIds,r=(_.isEmpty(r)||(o=r.slice(0)),e.tiles);if(_.map(r,function(e){null!=e.modelId&&o.push(e.modelId)}),!_.isEmpty(o))for(var o=_.uniq(o),a=0,n=o.length;a<n;a++){var s=_.filter(t,function(e){return e.id===o[a]});_.isEmpty(s)||i.push(s[0])}}return i},e.orderItems=function(e,t){for(var i=_.filter(e,function(e){var t;return 0<(null==(t=e.pos)?void 0:t.x)&&0<(null==(t=e.pos)?void 0:t.y)}),o=[],r=_.sortBy(i,function(e){e=e.pos;return 1e3*e.y+e.x}),a=0,n=r;a<n.length;a++)D(o,(s=n[a].pos).y,s.height);for(var s,l=[],i=_.sortBy(i,function(e){e=e.pos;return 1e3*e.x+e.y}),c=0,u=i;c<u.length;c++)D(l,(s=u[c].pos).x,s.width);for(var d=function(t,i){var e=_.isEmpty(t)?-1/0:_.maxBy(t,function(e){return e.size}).size,o=_.isEmpty(i)?-1/0:_.maxBy(i,function(e){return e.size}).size,r=_.every(t,function(e){return e.size===t[0].size}),a=_.every(i,function(e){return e.size===i[0].size});r=I(t,e,r)||!I(i,o,a)&&e<=o?0:1;return r}(o,l),p=0===d?o:l,i=0===d?i:r,h=[],m=0,g=0,y=p;g<y.length;g++){for(var f=y[g],v=m+1;v<f.startPosition;v++)h.push(void 0);for(var T=f.startPosition;T<f.startPosition+f.size;T++)h.push(f.startPosition),m=T}for(var b=_.groupBy(i,function(e){e=0===d?e.pos.y:e.pos.x;return h[e-1]}),S=[],C=0,w=p;C<w.length;C++)f=w[C],S=S.concat(b[f.startPosition]);return r=_.map(S,function(e){return e.item}),t&&(i=_.filter(e,function(e){var t;return!(0<(null==(t=e.pos)?void 0:t.x)&&0<(null==(t=e.pos)?void 0:t.y))}),p=_.map(i,function(e){return e.item}),r.push.apply(r,p)),r},e.containsLayout=function(e,t,i){if(!i||!i.tiles)return!1;switch(e){case 0:return _.some(i.tiles,function(e){return e.hasLayoutDefinition(t)});case 1:return _.some(i.tiles,function(e){return e.hasLayoutPosition(t)})}},e.markTilesAsNewIfNeeded=function(e){for(var t=[],i=0,o=e.tiles;i<o.length;i++){var r=o[i];r.hasLayoutDefinition(1)?r.shouldNewBadgeAppear=!1:t.push(r.addLayout({id:1,position:null},1))}return t},e.calcDashboardScrollbarWidth=function(){var e=document.createElement("div"),t=(e.style.visibility="hidden",e.style.overflow="scroll",document.body.appendChild(e),document.createElement("div")),t=(e.appendChild(t),e.offsetWidth-t.offsetWidth);return e.parentNode.removeChild(e),0<t?t:8}}(powerbi=powerbi||{}),function(e){var t,o,i,r,a;t=e.dataServices||(e.dataServices={}),r=t.contracts,e=e.visuals.plugins,a="__default__",t=t.TileDefaultSizesUtils||(t.TileDefaultSizesUtils={}),o={},(i={})[r.TileType[r.TileType.report]]=6,i[e.card.name]=2,i[e.animatedNumber.name]=2,i[e.textbox.name]=2,i[a]=3,o[1]=i,t.getRowSpan=function(e,t){var i;return(t=o[t=void 0===t?1:t])?t[i=!t[i=r.TileType[e.type]]&&e.composite&&(e=e.composite)?e.visual.type:i]||t[a]:1}}(powerbi=powerbi||{}),function(h){var m,i,c,r,o,l,g,t;function e(){this.rScriptCount=0,this.pythonScriptCount=0}function y(e,t,i,o,r,a,n,s){s=s.execute({dataSources:e,schema:r,config:t,additionalFilters:null,dataWindow:i}),a=a.getPinData({name:"tile",config:{singleVisual:t},layouts:void 0},0,e,{},null,null,s,r),a.realTimeDataWindow=i,t=n.capabilities(l.getVisualType(a));return m.models.TileFactory.createTileForPinData(a,t,o)}m=h.dataServices||(h.dataServices={}),r=jsCommon.ArrayExtensions,o=jsCommon.JsonExtensions,l=h.explore.contracts.PinData,g=m.contracts.TileType,t=jsCommon.Version,i=m.TileUtils||(m.TileUtils={}),Object.defineProperty(e.prototype,"hasScriptVisuals",{get:function(){return 0<this.rScriptCount||0<this.pythonScriptCount},enumerable:!1,configurable:!0}),c=e,i.ScriptVisualCounts=c,i.getUpdatedContract=y,i.UpdateRealTimeTile=function(r,a,n,s,l,c,u,d,p){return __awaiter(this,void 0,h.Promise,function(){var t,i,o;return __generator(this,function(e){switch(e.label){case 0:return r.type===m.contracts.TileType.realTime&&r.realTime,[4,(t=r.realTime).getDatasources()];case 1:return o=e.sent(),o=y(o,a,n,s,l,c,u,d),(i=o.$config)?(i.hideTitle=r.config.hideTitle,r.config=i,r.realTime.config=i.realTimeVisual,(i=r.contract).query=o.query,i.modelId=o.modelId,r.isTemporary&&(i=m.ContractUtils.getMasterLayoutPosition(i),o=m.ContractUtils.getMasterLayoutPosition(o),i.width=o.width,i.height=o.height,o={colSpan:i.width,rowSpan:i.height},r.calculateLayout(h.common.GridLayoutConstants.getDefaultGridItemViewport(o)),r.invalidateLayout()),t.singleVisualConfig=a):p.logEvent(h.telemetry.DashboardTileError,{tileType:g[g.realTime],message:"Invalid tile config object"}),[2]}})})},i.getVisualType=function(e){return(e=e&&(e.visualContainer||e.realTimeVisual))&&e.$visualContainer?e.$visualContainer.config.singleVisual.visualType:void 0},i.tileContainsScriptVisuals=function(e,t){return i.isScriptVisualTile(e,t)||i.countTileScriptVisuals(e,t).hasScriptVisuals},i.isScriptVisualTile=function(e,t){return e&&e.type===g.composite&&t.isScriptVisual(i.getVisualType(e.config))},i.countTileScriptVisuals=function(e,t){var i=new c,o=e&&e.reportTile&&e.reportTile.exploration&&e.reportTile.exploration.sections;if(o&&e.type===g.report)for(var r=0,a=o;r<a.length;r++)for(var n=0,s=a[r].contract.visualContainers;n<s.length;n++){var l=s[n],l=h.explore.util.VisualContainerUtils.getVisualType(l);if(l&&t&&t.isScriptVisual(l))switch(h.explore.util.ScriptVisualsUtil.getScriptVisualType(l)){case 0:i.rScriptCount++;break;case 1:i.pythonScriptCount++}}return i},i.tileTrackerFn=function(e,t){return"tile_"+e.id+"_dash_"+t},i.createDefaultPhoneByTile=function(e,t,i){var o=m.TileDefaultSizesUtils.getRowSpan(i,1),r=i.addLayout({id:1,position:{y:e,x:t,width:6,height:o}},1);return i.layoutPosition.y=e,i.layoutPosition.x=t,i.layoutPosition.height=o,i.layoutPosition.width=6,r},i.getTileErrorDetailsFromQueryResultError=function(e,t){if((e=o.tryParseJSON(e.errorDetail))&&!_.isEmpty(e.DataShapes)){e=e.DataShapes[0]["odata.error"];if(e)return new h.DsrClientError(e).getDetails(t)}},i.convertTileLayoutConfig=function(e){if(e.$layoutConfig)return e.$layoutConfig;var t={x:e.col,y:e.row,width:e.colSpan,height:e.rowSpan},i=void 0;if(e.layoutConfig)try{i=JSON.parse(e.layoutConfig);r.extendWithId(i.layouts).withId(0).position=t}catch(e){}else i={layouts:[{id:0,position:t}]};return i},i.addOrUpdateLayoutPosition=function(e,t,i){var o=(e=r.extendWithId(e.layouts)).withId(i);o||e.push(o={id:i,position:{}}),o.position=t},i.getCurrentTileLayoutDescriptor=function(e,t,i,o){return{id:e.id,row:null,col:null,rowSpan:null,colSpan:null,layoutConfig:JSON.stringify(t),query:o?i:null,updatedQuery:o,modelId:e.modelId,objectId:e.objectId}},i.getTileQueryAfterResize=function(e,t){if(e=m.ContractUtils.convertToTileDataQuery(e)){for(var i=t.width*h.common.GridLayoutConstants.defaultGridWidth,o=t.height*h.common.GridLayoutConstants.defaultGridHeight,r=!1,a=0,n=e.Commands;a<n.length;a++){var s,l,c=n[a],u=c.ScriptVisualCommand;u&&(s=u.ViewportWidthPx,l=u.ViewportHeightPx,s===i&&l===o||(u.ViewportWidthPx=i,u.ViewportHeightPx=o,c.ScriptVisualCommand=u,r=!0))}return r?e:void 0}},i.deserializeTileConfig=function(e){return e=null==(e=o.tryParseJSON(e))?{version:t.ZeroStr}:e}}(powerbi=powerbi||{}),function(e){var t,i,o;t=e.dataServices||(e.dataServices={}),i=jsCommon.EnumExtensions,o=e.common.contracts.PackageType,(t=t.PermissionsUtils||(t.PermissionsUtils={})).isPackageTemplateInstance=function(e){return!(!e||e.packageType!==o.AppInstance||!e.contentProviderId&&!e.serviceContentProviderId)},t.canReshare=function(e){return i.hasFlag(e,6)},t.hasWriteFlag=function(e){return jsCommon.EnumExtensions.hasFlag(e,2)}}(powerbi=powerbi||{}),function(e){(e=(e=e.dataServices||(e.dataServices={})).events||(e.events={})).syncServiceDashboardEditedEvent={name:"syncServiceDashboardEdited",type:4},e.syncServiceDashboardDeepEditedEvent={name:"syncServiceDashboardDeepEdited",type:4},e.syncServiceTilesAddedOrUpdated={name:"syncServiceTilesAddedOrUpdated",type:4},e.syncServiceCustomTilesUpdate={name:"syncServiceCustomTilesUpdate",type:4},e.syncServiceTileDeleted={name:"syncServiceTileDeleted",type:4}}(powerbi=powerbi||{}),function(e){var t,o,r,a;t=(t=e.dataServices||(e.dataServices={})).models||(t.models={}),o=e.dataServices.ContractUtils,r=e.dataServices.models.RealTimeTileModel,a=e.dataServices.contracts.TileType,t.convertRealTimeTile=function(e,t){var i;if(e&&e.type===a.realTime)return i=t.tileModelConverter.convertTileConfig(e),t.tileModelConverter.convertTileLayoutConfig(e),t=new r(e,t.visualPlugin,t.visualPluginOps,t.featureSwitchService,t.geolocationService,t.geocoder,t.promiseFactory,t.moduleLoader,t.telemetryService,t.themeService,t.authenticationService,t.localizationService,t.visualHostTooltipService),i&&i.realTimeVisual&&(t.config=i.realTimeVisual),t.displayText=e.displayText,t.subDisplayText=e.subDisplayText,i=o.getMasterLayoutPosition(e),t.size={rowSpan:i.height,colSpan:i.width},t}}(powerbi=powerbi||{}),function(o){var r,a,n,s,l,i,c,g;function e(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m){this.geolocationService=e,this.telemetryService=t,this.visualPlugins=i,this.visualPluginOps=o,this.featureSwitchService=r,this.geocoder=a,this.promiseFactory=n,this.moduleLoader=s,this.tileConfigUpgraderService=l,this.explorationSerializer=c,this.themeService=u,this.authenticationService=d,this.localizationService=p,this.visualHostTooltipService=h,this.licenseUIManagerFactory=m}r=o.dataServices||(o.dataServices={}),a=r.models||(r.models={}),n=jsCommon.GzipUtility,s=jsCommon.PerfTimer,l=r.contracts.TileType,i=jsCommon.Utility,c=o.dataServices.TileUtils,a.createTileModelConverter=function(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m){return new g(e,t,i,o,r,a,n,s,l,c,u,d,p,h,m)},e.prototype.convertCompositeTile=function(e){if(!e||e.type!==l.composite)return null;var t,i=this.convertTileConfig(e);if(this.convertTileLayoutConfig(e),!i||!i.visualContainer)return null;(t=new a.SingleVisualCompositeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader,this.telemetryService,this.themeService,this.authenticationService,this.localizationService,this.visualHostTooltipService,this.licenseUIManagerFactory)).config=i.visualContainer,t.displayText=e.displayText,t.subDisplayText=e.subDisplayText;var i=r.ContractUtils.getMasterLayoutPosition(e);return t.size={rowSpan:i.height,colSpan:i.width},t.isLoading=a.TileFactory.isTileLoading(e),e.queryResultError&&(t.isError=!0,i=e.queryResultError,this.telemetryService.logEvent(o.telemetry.DashboardTileError,{tileType:l[l.composite],message:jsCommon.StringExtensions.format("{0}:{1} with rootActivityId:{2}, modelId:{3} and tileId:{4}",jsCommon.EnumExtensions.toString(r.contracts.QueryResultErrorType,i.type),i.errorDetail,i.rootActivityId,e.modelId.toString(),e.id.toString())}),(e=c.getTileErrorDetailsFromQueryResultError(i,this.localizationService))?(t.errorDetails=e,t.errorText=e.message):t.errorText=this.localizationService.get("Tile_ErrorText")),t},e.prototype.convertTileData=function(t){if(!t.tileDataSet){var e=this.convertTileConfig(t);try{t.tileDataSet=this.parseTileData(t,e.tileDataType)}catch(e){throw this.telemetryService.logEvent(o.telemetry.DashboardTileError,{tileType:l[l.composite],message:jsCommon.StringExtensions.format("DsrParseError:{0} with modelId:{1} and tileId:{2}",e.message,t.modelId.toString(),t.id.toString())}),i.ensureError(e)}}return t.tileDataSet},e.prototype.convertTileConfig=function(e){if(!(i=e.$config)){var t=s.start("Parse tile config");try{var i,o=(i=e.$config=c.deserializeTileConfig(e.config)).visualContainer||i.realTimeVisual,r=(this.deserializeVisualContainer(o),o||i.visual);this.deserializeModelExtensions(r),this.tileConfigUpgraderService.upgrade(e.id,i,e.query)}catch(e){}finally{t()}}return i},e.prototype.convertTileLayoutConfig=function(e){var t;return e.$layoutConfig||(t=c.convertTileLayoutConfig(e),e.$layoutConfig=t,e.layoutConfig=JSON.stringify(t)),e.$layoutConfig},e.prototype.deserializeVisualContainer=function(e){e&&e.visualContainer&&!e.$visualContainer&&(e.$visualContainer=this.explorationSerializer.deserializeCanvasItem(e.visualContainer))},e.prototype.deserializeModelExtensions=function(e){e&&e.modelExtensions&&!e.$modelExtensions&&(e.$modelExtensions=this.explorationSerializer.deserializeModelExtensions(e.modelExtensions))},e.prototype.parseTileData=function(e,t){var i,o,r=s.start("Parse tile data");try{return e.tileDataBinaryBase64Encoded?(i=n.uncompress(e.tileDataBinaryBase64Encoded),o=JSON.parse(i)):e.tileData&&(o=JSON.parse(e.tileData)),{type:t,data:o}}finally{r()}},g=e}(powerbi=powerbi||{});